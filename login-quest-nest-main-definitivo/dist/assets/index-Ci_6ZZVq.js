var zN=e=>{throw TypeError(e)};var CC=(e,t,i)=>t.has(e)||zN("Cannot "+i);var ot=(e,t,i)=>(CC(e,t,"read from private field"),i?i.call(e):t.get(e)),Rn=(e,t,i)=>t.has(e)?zN("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),Yr=(e,t,i,c)=>(CC(e,t,"write to private field"),c?c.call(e,i):t.set(e,i),i),Si=(e,t,i)=>(CC(e,t,"access private method"),i);var Aw=(e,t,i,c)=>({set _(f){Yr(e,t,f,i)},get _(){return ot(e,t,c)}});function xF(e,t){for(var i=0;i<t.length;i++){const c=t[i];if(typeof c!="string"&&!Array.isArray(c)){for(const f in c)if(f!=="default"&&!(f in e)){const _=Object.getOwnPropertyDescriptor(c,f);_&&Object.defineProperty(e,f,_.get?_:{enumerable:!0,get:()=>c[f]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))c(f);new MutationObserver(f=>{for(const _ of f)if(_.type==="childList")for(const x of _.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&c(x)}).observe(document,{childList:!0,subtree:!0});function i(f){const _={};return f.integrity&&(_.integrity=f.integrity),f.referrerPolicy&&(_.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?_.credentials="include":f.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function c(f){if(f.ep)return;f.ep=!0;const _=i(f);fetch(f.href,_)}})();var yW=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function MP(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function vW(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var i=function c(){return this instanceof c?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach(function(c){var f=Object.getOwnPropertyDescriptor(e,c);Object.defineProperty(i,c,f.get?f:{enumerable:!0,get:function(){return e[c]}})}),i}var bF={exports:{}},jT={},wF={exports:{}},Di={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var db=Symbol.for("react.element"),xW=Symbol.for("react.portal"),bW=Symbol.for("react.fragment"),wW=Symbol.for("react.strict_mode"),SW=Symbol.for("react.profiler"),TW=Symbol.for("react.provider"),EW=Symbol.for("react.context"),CW=Symbol.for("react.forward_ref"),AW=Symbol.for("react.suspense"),IW=Symbol.for("react.memo"),PW=Symbol.for("react.lazy"),FN=Symbol.iterator;function kW(e){return e===null||typeof e!="object"?null:(e=FN&&e[FN]||e["@@iterator"],typeof e=="function"?e:null)}var SF={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},TF=Object.assign,EF={};function jy(e,t,i){this.props=e,this.context=t,this.refs=EF,this.updater=i||SF}jy.prototype.isReactComponent={};jy.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};jy.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function CF(){}CF.prototype=jy.prototype;function DP(e,t,i){this.props=e,this.context=t,this.refs=EF,this.updater=i||SF}var NP=DP.prototype=new CF;NP.constructor=DP;TF(NP,jy.prototype);NP.isPureReactComponent=!0;var BN=Array.isArray,AF=Object.prototype.hasOwnProperty,OP={current:null},IF={key:!0,ref:!0,__self:!0,__source:!0};function PF(e,t,i){var c,f={},_=null,x=null;if(t!=null)for(c in t.ref!==void 0&&(x=t.ref),t.key!==void 0&&(_=""+t.key),t)AF.call(t,c)&&!IF.hasOwnProperty(c)&&(f[c]=t[c]);var o=arguments.length-2;if(o===1)f.children=i;else if(1<o){for(var I=Array(o),P=0;P<o;P++)I[P]=arguments[P+2];f.children=I}if(e&&e.defaultProps)for(c in o=e.defaultProps,o)f[c]===void 0&&(f[c]=o[c]);return{$$typeof:db,type:e,key:_,ref:x,props:f,_owner:OP.current}}function jW(e,t){return{$$typeof:db,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function LP(e){return typeof e=="object"&&e!==null&&e.$$typeof===db}function RW(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(i){return t[i]})}var VN=/\/+/g;function AC(e,t){return typeof e=="object"&&e!==null&&e.key!=null?RW(""+e.key):t.toString(36)}function dS(e,t,i,c,f){var _=typeof e;(_==="undefined"||_==="boolean")&&(e=null);var x=!1;if(e===null)x=!0;else switch(_){case"string":case"number":x=!0;break;case"object":switch(e.$$typeof){case db:case xW:x=!0}}if(x)return x=e,f=f(x),e=c===""?"."+AC(x,0):c,BN(f)?(i="",e!=null&&(i=e.replace(VN,"$&/")+"/"),dS(f,t,i,"",function(P){return P})):f!=null&&(LP(f)&&(f=jW(f,i+(!f.key||x&&x.key===f.key?"":(""+f.key).replace(VN,"$&/")+"/")+e)),t.push(f)),1;if(x=0,c=c===""?".":c+":",BN(e))for(var o=0;o<e.length;o++){_=e[o];var I=c+AC(_,o);x+=dS(_,t,i,I,f)}else if(I=kW(e),typeof I=="function")for(e=I.call(e),o=0;!(_=e.next()).done;)_=_.value,I=c+AC(_,o++),x+=dS(_,t,i,I,f);else if(_==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return x}function Iw(e,t,i){if(e==null)return e;var c=[],f=0;return dS(e,c,"","",function(_){return t.call(i,_,f++)}),c}function MW(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(i){(e._status===0||e._status===-1)&&(e._status=1,e._result=i)},function(i){(e._status===0||e._status===-1)&&(e._status=2,e._result=i)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Ya={current:null},hS={transition:null},DW={ReactCurrentDispatcher:Ya,ReactCurrentBatchConfig:hS,ReactCurrentOwner:OP};function kF(){throw Error("act(...) is not supported in production builds of React.")}Di.Children={map:Iw,forEach:function(e,t,i){Iw(e,function(){t.apply(this,arguments)},i)},count:function(e){var t=0;return Iw(e,function(){t++}),t},toArray:function(e){return Iw(e,function(t){return t})||[]},only:function(e){if(!LP(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Di.Component=jy;Di.Fragment=bW;Di.Profiler=SW;Di.PureComponent=DP;Di.StrictMode=wW;Di.Suspense=AW;Di.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=DW;Di.act=kF;Di.cloneElement=function(e,t,i){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var c=TF({},e.props),f=e.key,_=e.ref,x=e._owner;if(t!=null){if(t.ref!==void 0&&(_=t.ref,x=OP.current),t.key!==void 0&&(f=""+t.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(I in t)AF.call(t,I)&&!IF.hasOwnProperty(I)&&(c[I]=t[I]===void 0&&o!==void 0?o[I]:t[I])}var I=arguments.length-2;if(I===1)c.children=i;else if(1<I){o=Array(I);for(var P=0;P<I;P++)o[P]=arguments[P+2];c.children=o}return{$$typeof:db,type:e.type,key:f,ref:_,props:c,_owner:x}};Di.createContext=function(e){return e={$$typeof:EW,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:TW,_context:e},e.Consumer=e};Di.createElement=PF;Di.createFactory=function(e){var t=PF.bind(null,e);return t.type=e,t};Di.createRef=function(){return{current:null}};Di.forwardRef=function(e){return{$$typeof:CW,render:e}};Di.isValidElement=LP;Di.lazy=function(e){return{$$typeof:PW,_payload:{_status:-1,_result:e},_init:MW}};Di.memo=function(e,t){return{$$typeof:IW,type:e,compare:t===void 0?null:t}};Di.startTransition=function(e){var t=hS.transition;hS.transition={};try{e()}finally{hS.transition=t}};Di.unstable_act=kF;Di.useCallback=function(e,t){return Ya.current.useCallback(e,t)};Di.useContext=function(e){return Ya.current.useContext(e)};Di.useDebugValue=function(){};Di.useDeferredValue=function(e){return Ya.current.useDeferredValue(e)};Di.useEffect=function(e,t){return Ya.current.useEffect(e,t)};Di.useId=function(){return Ya.current.useId()};Di.useImperativeHandle=function(e,t,i){return Ya.current.useImperativeHandle(e,t,i)};Di.useInsertionEffect=function(e,t){return Ya.current.useInsertionEffect(e,t)};Di.useLayoutEffect=function(e,t){return Ya.current.useLayoutEffect(e,t)};Di.useMemo=function(e,t){return Ya.current.useMemo(e,t)};Di.useReducer=function(e,t,i){return Ya.current.useReducer(e,t,i)};Di.useRef=function(e){return Ya.current.useRef(e)};Di.useState=function(e){return Ya.current.useState(e)};Di.useSyncExternalStore=function(e,t,i){return Ya.current.useSyncExternalStore(e,t,i)};Di.useTransition=function(){return Ya.current.useTransition()};Di.version="18.3.1";wF.exports=Di;var V=wF.exports;const nr=MP(V),zP=xF({__proto__:null,default:nr},[V]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var NW=V,OW=Symbol.for("react.element"),LW=Symbol.for("react.fragment"),zW=Object.prototype.hasOwnProperty,FW=NW.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,BW={key:!0,ref:!0,__self:!0,__source:!0};function jF(e,t,i){var c,f={},_=null,x=null;i!==void 0&&(_=""+i),t.key!==void 0&&(_=""+t.key),t.ref!==void 0&&(x=t.ref);for(c in t)zW.call(t,c)&&!BW.hasOwnProperty(c)&&(f[c]=t[c]);if(e&&e.defaultProps)for(c in t=e.defaultProps,t)f[c]===void 0&&(f[c]=t[c]);return{$$typeof:OW,type:e,key:_,ref:x,props:f,_owner:FW.current}}jT.Fragment=LW;jT.jsx=jF;jT.jsxs=jF;bF.exports=jT;var h=bF.exports,RF={exports:{}},Hl={},MF={exports:{}},DF={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t($e,_t){var mt=$e.length;$e.push(_t);e:for(;0<mt;){var rt=mt-1>>>1,Tt=$e[rt];if(0<f(Tt,_t))$e[rt]=_t,$e[mt]=Tt,mt=rt;else break e}}function i($e){return $e.length===0?null:$e[0]}function c($e){if($e.length===0)return null;var _t=$e[0],mt=$e.pop();if(mt!==_t){$e[0]=mt;e:for(var rt=0,Tt=$e.length,Vt=Tt>>>1;rt<Vt;){var it=2*(rt+1)-1,ir=$e[it],wr=it+1,Bt=$e[wr];if(0>f(ir,mt))wr<Tt&&0>f(Bt,ir)?($e[rt]=Bt,$e[wr]=mt,rt=wr):($e[rt]=ir,$e[it]=mt,rt=it);else if(wr<Tt&&0>f(Bt,mt))$e[rt]=Bt,$e[wr]=mt,rt=wr;else break e}}return _t}function f($e,_t){var mt=$e.sortIndex-_t.sortIndex;return mt!==0?mt:$e.id-_t.id}if(typeof performance=="object"&&typeof performance.now=="function"){var _=performance;e.unstable_now=function(){return _.now()}}else{var x=Date,o=x.now();e.unstable_now=function(){return x.now()-o}}var I=[],P=[],N=1,U=null,$=3,B=!1,Y=!1,H=!1,K=typeof setTimeout=="function"?setTimeout:null,re=typeof clearTimeout=="function"?clearTimeout:null,G=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function X($e){for(var _t=i(P);_t!==null;){if(_t.callback===null)c(P);else if(_t.startTime<=$e)c(P),_t.sortIndex=_t.expirationTime,t(I,_t);else break;_t=i(P)}}function ue($e){if(H=!1,X($e),!Y)if(i(I)!==null)Y=!0,qe(Ee);else{var _t=i(P);_t!==null&&We(ue,_t.startTime-$e)}}function Ee($e,_t){Y=!1,H&&(H=!1,re(lt),lt=-1),B=!0;var mt=$;try{for(X(_t),U=i(I);U!==null&&(!(U.expirationTime>_t)||$e&&!yt());){var rt=U.callback;if(typeof rt=="function"){U.callback=null,$=U.priorityLevel;var Tt=rt(U.expirationTime<=_t);_t=e.unstable_now(),typeof Tt=="function"?U.callback=Tt:U===i(I)&&c(I),X(_t)}else c(I);U=i(I)}if(U!==null)var Vt=!0;else{var it=i(P);it!==null&&We(ue,it.startTime-_t),Vt=!1}return Vt}finally{U=null,$=mt,B=!1}}var xe=!1,Ne=null,lt=-1,Pt=5,tt=-1;function yt(){return!(e.unstable_now()-tt<Pt)}function Me(){if(Ne!==null){var $e=e.unstable_now();tt=$e;var _t=!0;try{_t=Ne(!0,$e)}finally{_t?be():(xe=!1,Ne=null)}}else xe=!1}var be;if(typeof G=="function")be=function(){G(Me)};else if(typeof MessageChannel<"u"){var je=new MessageChannel,Ye=je.port2;je.port1.onmessage=Me,be=function(){Ye.postMessage(null)}}else be=function(){K(Me,0)};function qe($e){Ne=$e,xe||(xe=!0,be())}function We($e,_t){lt=K(function(){$e(e.unstable_now())},_t)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function($e){$e.callback=null},e.unstable_continueExecution=function(){Y||B||(Y=!0,qe(Ee))},e.unstable_forceFrameRate=function($e){0>$e||125<$e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Pt=0<$e?Math.floor(1e3/$e):5},e.unstable_getCurrentPriorityLevel=function(){return $},e.unstable_getFirstCallbackNode=function(){return i(I)},e.unstable_next=function($e){switch($){case 1:case 2:case 3:var _t=3;break;default:_t=$}var mt=$;$=_t;try{return $e()}finally{$=mt}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function($e,_t){switch($e){case 1:case 2:case 3:case 4:case 5:break;default:$e=3}var mt=$;$=$e;try{return _t()}finally{$=mt}},e.unstable_scheduleCallback=function($e,_t,mt){var rt=e.unstable_now();switch(typeof mt=="object"&&mt!==null?(mt=mt.delay,mt=typeof mt=="number"&&0<mt?rt+mt:rt):mt=rt,$e){case 1:var Tt=-1;break;case 2:Tt=250;break;case 5:Tt=1073741823;break;case 4:Tt=1e4;break;default:Tt=5e3}return Tt=mt+Tt,$e={id:N++,callback:_t,priorityLevel:$e,startTime:mt,expirationTime:Tt,sortIndex:-1},mt>rt?($e.sortIndex=mt,t(P,$e),i(I)===null&&$e===i(P)&&(H?(re(lt),lt=-1):H=!0,We(ue,mt-rt))):($e.sortIndex=Tt,t(I,$e),Y||B||(Y=!0,qe(Ee))),$e},e.unstable_shouldYield=yt,e.unstable_wrapCallback=function($e){var _t=$;return function(){var mt=$;$=_t;try{return $e.apply(this,arguments)}finally{$=mt}}}})(DF);MF.exports=DF;var VW=MF.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var UW=V,$l=VW;function xr(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var NF=new Set,I0={};function Om(e,t){hy(e,t),hy(e+"Capture",t)}function hy(e,t){for(I0[e]=t,e=0;e<t.length;e++)NF.add(t[e])}var Vd=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),DA=Object.prototype.hasOwnProperty,$W=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,UN={},$N={};function qW(e){return DA.call($N,e)?!0:DA.call(UN,e)?!1:$W.test(e)?$N[e]=!0:(UN[e]=!0,!1)}function GW(e,t,i,c){if(i!==null&&i.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return c?!1:i!==null?!i.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function WW(e,t,i,c){if(t===null||typeof t>"u"||GW(e,t,i,c))return!0;if(c)return!1;if(i!==null)switch(i.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Ja(e,t,i,c,f,_,x){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=c,this.attributeNamespace=f,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=_,this.removeEmptyString=x}var la={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){la[e]=new Ja(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];la[t]=new Ja(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){la[e]=new Ja(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){la[e]=new Ja(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){la[e]=new Ja(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){la[e]=new Ja(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){la[e]=new Ja(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){la[e]=new Ja(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){la[e]=new Ja(e,5,!1,e.toLowerCase(),null,!1,!1)});var FP=/[\-:]([a-z])/g;function BP(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(FP,BP);la[t]=new Ja(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(FP,BP);la[t]=new Ja(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(FP,BP);la[t]=new Ja(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){la[e]=new Ja(e,1,!1,e.toLowerCase(),null,!1,!1)});la.xlinkHref=new Ja("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){la[e]=new Ja(e,1,!1,e.toLowerCase(),null,!0,!0)});function VP(e,t,i,c){var f=la.hasOwnProperty(t)?la[t]:null;(f!==null?f.type!==0:c||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(WW(t,i,f,c)&&(i=null),c||f===null?qW(t)&&(i===null?e.removeAttribute(t):e.setAttribute(t,""+i)):f.mustUseProperty?e[f.propertyName]=i===null?f.type===3?!1:"":i:(t=f.attributeName,c=f.attributeNamespace,i===null?e.removeAttribute(t):(f=f.type,i=f===3||f===4&&i===!0?"":""+i,c?e.setAttributeNS(c,t,i):e.setAttribute(t,i))))}var Zd=UW.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Pw=Symbol.for("react.element"),P_=Symbol.for("react.portal"),k_=Symbol.for("react.fragment"),UP=Symbol.for("react.strict_mode"),NA=Symbol.for("react.profiler"),OF=Symbol.for("react.provider"),LF=Symbol.for("react.context"),$P=Symbol.for("react.forward_ref"),OA=Symbol.for("react.suspense"),LA=Symbol.for("react.suspense_list"),qP=Symbol.for("react.memo"),Qh=Symbol.for("react.lazy"),zF=Symbol.for("react.offscreen"),qN=Symbol.iterator;function Hx(e){return e===null||typeof e!="object"?null:(e=qN&&e[qN]||e["@@iterator"],typeof e=="function"?e:null)}var Ys=Object.assign,IC;function s0(e){if(IC===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);IC=t&&t[1]||""}return`
`+IC+e}var PC=!1;function kC(e,t){if(!e||PC)return"";PC=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(P){var c=P}Reflect.construct(e,[],t)}else{try{t.call()}catch(P){c=P}e.call(t.prototype)}else{try{throw Error()}catch(P){c=P}e()}}catch(P){if(P&&c&&typeof P.stack=="string"){for(var f=P.stack.split(`
`),_=c.stack.split(`
`),x=f.length-1,o=_.length-1;1<=x&&0<=o&&f[x]!==_[o];)o--;for(;1<=x&&0<=o;x--,o--)if(f[x]!==_[o]){if(x!==1||o!==1)do if(x--,o--,0>o||f[x]!==_[o]){var I=`
`+f[x].replace(" at new "," at ");return e.displayName&&I.includes("<anonymous>")&&(I=I.replace("<anonymous>",e.displayName)),I}while(1<=x&&0<=o);break}}}finally{PC=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?s0(e):""}function HW(e){switch(e.tag){case 5:return s0(e.type);case 16:return s0("Lazy");case 13:return s0("Suspense");case 19:return s0("SuspenseList");case 0:case 2:case 15:return e=kC(e.type,!1),e;case 11:return e=kC(e.type.render,!1),e;case 1:return e=kC(e.type,!0),e;default:return""}}function zA(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case k_:return"Fragment";case P_:return"Portal";case NA:return"Profiler";case UP:return"StrictMode";case OA:return"Suspense";case LA:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case LF:return(e.displayName||"Context")+".Consumer";case OF:return(e._context.displayName||"Context")+".Provider";case $P:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case qP:return t=e.displayName||null,t!==null?t:zA(e.type)||"Memo";case Qh:t=e._payload,e=e._init;try{return zA(e(t))}catch{}}return null}function ZW(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return zA(t);case 8:return t===UP?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Rf(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function FF(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function XW(e){var t=FF(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),c=""+e[t];if(!e.hasOwnProperty(t)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var f=i.get,_=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return f.call(this)},set:function(x){c=""+x,_.call(this,x)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return c},setValue:function(x){c=""+x},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function kw(e){e._valueTracker||(e._valueTracker=XW(e))}function BF(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),c="";return e&&(c=FF(e)?e.checked?"true":"false":e.value),e=c,e!==i?(t.setValue(e),!0):!1}function RS(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function FA(e,t){var i=t.checked;return Ys({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??e._wrapperState.initialChecked})}function GN(e,t){var i=t.defaultValue==null?"":t.defaultValue,c=t.checked!=null?t.checked:t.defaultChecked;i=Rf(t.value!=null?t.value:i),e._wrapperState={initialChecked:c,initialValue:i,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function VF(e,t){t=t.checked,t!=null&&VP(e,"checked",t,!1)}function BA(e,t){VF(e,t);var i=Rf(t.value),c=t.type;if(i!=null)c==="number"?(i===0&&e.value===""||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if(c==="submit"||c==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?VA(e,t.type,i):t.hasOwnProperty("defaultValue")&&VA(e,t.type,Rf(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function WN(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var c=t.type;if(!(c!=="submit"&&c!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}i=e.name,i!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,i!==""&&(e.name=i)}function VA(e,t,i){(t!=="number"||RS(e.ownerDocument)!==e)&&(i==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var o0=Array.isArray;function U_(e,t,i,c){if(e=e.options,t){t={};for(var f=0;f<i.length;f++)t["$"+i[f]]=!0;for(i=0;i<e.length;i++)f=t.hasOwnProperty("$"+e[i].value),e[i].selected!==f&&(e[i].selected=f),f&&c&&(e[i].defaultSelected=!0)}else{for(i=""+Rf(i),t=null,f=0;f<e.length;f++){if(e[f].value===i){e[f].selected=!0,c&&(e[f].defaultSelected=!0);return}t!==null||e[f].disabled||(t=e[f])}t!==null&&(t.selected=!0)}}function UA(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(xr(91));return Ys({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function HN(e,t){var i=t.value;if(i==null){if(i=t.children,t=t.defaultValue,i!=null){if(t!=null)throw Error(xr(92));if(o0(i)){if(1<i.length)throw Error(xr(93));i=i[0]}t=i}t==null&&(t=""),i=t}e._wrapperState={initialValue:Rf(i)}}function UF(e,t){var i=Rf(t.value),c=Rf(t.defaultValue);i!=null&&(i=""+i,i!==e.value&&(e.value=i),t.defaultValue==null&&e.defaultValue!==i&&(e.defaultValue=i)),c!=null&&(e.defaultValue=""+c)}function ZN(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function $F(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function $A(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?$F(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var jw,qF=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,i,c,f){MSApp.execUnsafeLocalFunction(function(){return e(t,i,c,f)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(jw=jw||document.createElement("div"),jw.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=jw.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function P0(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var f0={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},KW=["Webkit","ms","Moz","O"];Object.keys(f0).forEach(function(e){KW.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),f0[t]=f0[e]})});function GF(e,t,i){return t==null||typeof t=="boolean"||t===""?"":i||typeof t!="number"||t===0||f0.hasOwnProperty(e)&&f0[e]?(""+t).trim():t+"px"}function WF(e,t){e=e.style;for(var i in t)if(t.hasOwnProperty(i)){var c=i.indexOf("--")===0,f=GF(i,t[i],c);i==="float"&&(i="cssFloat"),c?e.setProperty(i,f):e[i]=f}}var YW=Ys({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function qA(e,t){if(t){if(YW[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(xr(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(xr(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(xr(61))}if(t.style!=null&&typeof t.style!="object")throw Error(xr(62))}}function GA(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var WA=null;function GP(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var HA=null,$_=null,q_=null;function XN(e){if(e=pb(e)){if(typeof HA!="function")throw Error(xr(280));var t=e.stateNode;t&&(t=OT(t),HA(e.stateNode,e.type,t))}}function HF(e){$_?q_?q_.push(e):q_=[e]:$_=e}function ZF(){if($_){var e=$_,t=q_;if(q_=$_=null,XN(e),t)for(e=0;e<t.length;e++)XN(t[e])}}function XF(e,t){return e(t)}function KF(){}var jC=!1;function YF(e,t,i){if(jC)return e(t,i);jC=!0;try{return XF(e,t,i)}finally{jC=!1,($_!==null||q_!==null)&&(KF(),ZF())}}function k0(e,t){var i=e.stateNode;if(i===null)return null;var c=OT(i);if(c===null)return null;i=c[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(e=e.type,c=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!c;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(xr(231,t,typeof i));return i}var ZA=!1;if(Vd)try{var Zx={};Object.defineProperty(Zx,"passive",{get:function(){ZA=!0}}),window.addEventListener("test",Zx,Zx),window.removeEventListener("test",Zx,Zx)}catch{ZA=!1}function JW(e,t,i,c,f,_,x,o,I){var P=Array.prototype.slice.call(arguments,3);try{t.apply(i,P)}catch(N){this.onError(N)}}var p0=!1,MS=null,DS=!1,XA=null,QW={onError:function(e){p0=!0,MS=e}};function eH(e,t,i,c,f,_,x,o,I){p0=!1,MS=null,JW.apply(QW,arguments)}function tH(e,t,i,c,f,_,x,o,I){if(eH.apply(this,arguments),p0){if(p0){var P=MS;p0=!1,MS=null}else throw Error(xr(198));DS||(DS=!0,XA=P)}}function Lm(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function JF(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function KN(e){if(Lm(e)!==e)throw Error(xr(188))}function rH(e){var t=e.alternate;if(!t){if(t=Lm(e),t===null)throw Error(xr(188));return t!==e?null:e}for(var i=e,c=t;;){var f=i.return;if(f===null)break;var _=f.alternate;if(_===null){if(c=f.return,c!==null){i=c;continue}break}if(f.child===_.child){for(_=f.child;_;){if(_===i)return KN(f),e;if(_===c)return KN(f),t;_=_.sibling}throw Error(xr(188))}if(i.return!==c.return)i=f,c=_;else{for(var x=!1,o=f.child;o;){if(o===i){x=!0,i=f,c=_;break}if(o===c){x=!0,c=f,i=_;break}o=o.sibling}if(!x){for(o=_.child;o;){if(o===i){x=!0,i=_,c=f;break}if(o===c){x=!0,c=_,i=f;break}o=o.sibling}if(!x)throw Error(xr(189))}}if(i.alternate!==c)throw Error(xr(190))}if(i.tag!==3)throw Error(xr(188));return i.stateNode.current===i?e:t}function QF(e){return e=rH(e),e!==null?e3(e):null}function e3(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=e3(e);if(t!==null)return t;e=e.sibling}return null}var t3=$l.unstable_scheduleCallback,YN=$l.unstable_cancelCallback,nH=$l.unstable_shouldYield,iH=$l.unstable_requestPaint,yo=$l.unstable_now,sH=$l.unstable_getCurrentPriorityLevel,WP=$l.unstable_ImmediatePriority,r3=$l.unstable_UserBlockingPriority,NS=$l.unstable_NormalPriority,oH=$l.unstable_LowPriority,n3=$l.unstable_IdlePriority,RT=null,Vu=null;function aH(e){if(Vu&&typeof Vu.onCommitFiberRoot=="function")try{Vu.onCommitFiberRoot(RT,e,void 0,(e.current.flags&128)===128)}catch{}}var Kc=Math.clz32?Math.clz32:uH,lH=Math.log,cH=Math.LN2;function uH(e){return e>>>=0,e===0?32:31-(lH(e)/cH|0)|0}var Rw=64,Mw=4194304;function a0(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function OS(e,t){var i=e.pendingLanes;if(i===0)return 0;var c=0,f=e.suspendedLanes,_=e.pingedLanes,x=i&268435455;if(x!==0){var o=x&~f;o!==0?c=a0(o):(_&=x,_!==0&&(c=a0(_)))}else x=i&~f,x!==0?c=a0(x):_!==0&&(c=a0(_));if(c===0)return 0;if(t!==0&&t!==c&&!(t&f)&&(f=c&-c,_=t&-t,f>=_||f===16&&(_&4194240)!==0))return t;if(c&4&&(c|=i&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=c;0<t;)i=31-Kc(t),f=1<<i,c|=e[i],t&=~f;return c}function dH(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function hH(e,t){for(var i=e.suspendedLanes,c=e.pingedLanes,f=e.expirationTimes,_=e.pendingLanes;0<_;){var x=31-Kc(_),o=1<<x,I=f[x];I===-1?(!(o&i)||o&c)&&(f[x]=dH(o,t)):I<=t&&(e.expiredLanes|=o),_&=~o}}function KA(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function i3(){var e=Rw;return Rw<<=1,!(Rw&4194240)&&(Rw=64),e}function RC(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function hb(e,t,i){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Kc(t),e[t]=i}function fH(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var c=e.eventTimes;for(e=e.expirationTimes;0<i;){var f=31-Kc(i),_=1<<f;t[f]=0,c[f]=-1,e[f]=-1,i&=~_}}function HP(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var c=31-Kc(i),f=1<<c;f&t|e[c]&t&&(e[c]|=t),i&=~f}}var ys=0;function s3(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var o3,ZP,a3,l3,c3,YA=!1,Dw=[],bf=null,wf=null,Sf=null,j0=new Map,R0=new Map,rf=[],pH="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function JN(e,t){switch(e){case"focusin":case"focusout":bf=null;break;case"dragenter":case"dragleave":wf=null;break;case"mouseover":case"mouseout":Sf=null;break;case"pointerover":case"pointerout":j0.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":R0.delete(t.pointerId)}}function Xx(e,t,i,c,f,_){return e===null||e.nativeEvent!==_?(e={blockedOn:t,domEventName:i,eventSystemFlags:c,nativeEvent:_,targetContainers:[f]},t!==null&&(t=pb(t),t!==null&&ZP(t)),e):(e.eventSystemFlags|=c,t=e.targetContainers,f!==null&&t.indexOf(f)===-1&&t.push(f),e)}function mH(e,t,i,c,f){switch(t){case"focusin":return bf=Xx(bf,e,t,i,c,f),!0;case"dragenter":return wf=Xx(wf,e,t,i,c,f),!0;case"mouseover":return Sf=Xx(Sf,e,t,i,c,f),!0;case"pointerover":var _=f.pointerId;return j0.set(_,Xx(j0.get(_)||null,e,t,i,c,f)),!0;case"gotpointercapture":return _=f.pointerId,R0.set(_,Xx(R0.get(_)||null,e,t,i,c,f)),!0}return!1}function u3(e){var t=nm(e.target);if(t!==null){var i=Lm(t);if(i!==null){if(t=i.tag,t===13){if(t=JF(i),t!==null){e.blockedOn=t,c3(e.priority,function(){a3(i)});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function fS(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=JA(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(i===null){i=e.nativeEvent;var c=new i.constructor(i.type,i);WA=c,i.target.dispatchEvent(c),WA=null}else return t=pb(i),t!==null&&ZP(t),e.blockedOn=i,!1;t.shift()}return!0}function QN(e,t,i){fS(e)&&i.delete(t)}function gH(){YA=!1,bf!==null&&fS(bf)&&(bf=null),wf!==null&&fS(wf)&&(wf=null),Sf!==null&&fS(Sf)&&(Sf=null),j0.forEach(QN),R0.forEach(QN)}function Kx(e,t){e.blockedOn===t&&(e.blockedOn=null,YA||(YA=!0,$l.unstable_scheduleCallback($l.unstable_NormalPriority,gH)))}function M0(e){function t(f){return Kx(f,e)}if(0<Dw.length){Kx(Dw[0],e);for(var i=1;i<Dw.length;i++){var c=Dw[i];c.blockedOn===e&&(c.blockedOn=null)}}for(bf!==null&&Kx(bf,e),wf!==null&&Kx(wf,e),Sf!==null&&Kx(Sf,e),j0.forEach(t),R0.forEach(t),i=0;i<rf.length;i++)c=rf[i],c.blockedOn===e&&(c.blockedOn=null);for(;0<rf.length&&(i=rf[0],i.blockedOn===null);)u3(i),i.blockedOn===null&&rf.shift()}var G_=Zd.ReactCurrentBatchConfig,LS=!0;function _H(e,t,i,c){var f=ys,_=G_.transition;G_.transition=null;try{ys=1,XP(e,t,i,c)}finally{ys=f,G_.transition=_}}function yH(e,t,i,c){var f=ys,_=G_.transition;G_.transition=null;try{ys=4,XP(e,t,i,c)}finally{ys=f,G_.transition=_}}function XP(e,t,i,c){if(LS){var f=JA(e,t,i,c);if(f===null)UC(e,t,c,zS,i),JN(e,c);else if(mH(f,e,t,i,c))c.stopPropagation();else if(JN(e,c),t&4&&-1<pH.indexOf(e)){for(;f!==null;){var _=pb(f);if(_!==null&&o3(_),_=JA(e,t,i,c),_===null&&UC(e,t,c,zS,i),_===f)break;f=_}f!==null&&c.stopPropagation()}else UC(e,t,c,null,i)}}var zS=null;function JA(e,t,i,c){if(zS=null,e=GP(c),e=nm(e),e!==null)if(t=Lm(e),t===null)e=null;else if(i=t.tag,i===13){if(e=JF(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return zS=e,null}function d3(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(sH()){case WP:return 1;case r3:return 4;case NS:case oH:return 16;case n3:return 536870912;default:return 16}default:return 16}}var gf=null,KP=null,pS=null;function h3(){if(pS)return pS;var e,t=KP,i=t.length,c,f="value"in gf?gf.value:gf.textContent,_=f.length;for(e=0;e<i&&t[e]===f[e];e++);var x=i-e;for(c=1;c<=x&&t[i-c]===f[_-c];c++);return pS=f.slice(e,1<c?1-c:void 0)}function mS(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Nw(){return!0}function eO(){return!1}function Zl(e){function t(i,c,f,_,x){this._reactName=i,this._targetInst=f,this.type=c,this.nativeEvent=_,this.target=x,this.currentTarget=null;for(var o in e)e.hasOwnProperty(o)&&(i=e[o],this[o]=i?i(_):_[o]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?Nw:eO,this.isPropagationStopped=eO,this}return Ys(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=Nw)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=Nw)},persist:function(){},isPersistent:Nw}),t}var Ry={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},YP=Zl(Ry),fb=Ys({},Ry,{view:0,detail:0}),vH=Zl(fb),MC,DC,Yx,MT=Ys({},fb,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:JP,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Yx&&(Yx&&e.type==="mousemove"?(MC=e.screenX-Yx.screenX,DC=e.screenY-Yx.screenY):DC=MC=0,Yx=e),MC)},movementY:function(e){return"movementY"in e?e.movementY:DC}}),tO=Zl(MT),xH=Ys({},MT,{dataTransfer:0}),bH=Zl(xH),wH=Ys({},fb,{relatedTarget:0}),NC=Zl(wH),SH=Ys({},Ry,{animationName:0,elapsedTime:0,pseudoElement:0}),TH=Zl(SH),EH=Ys({},Ry,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),CH=Zl(EH),AH=Ys({},Ry,{data:0}),rO=Zl(AH),IH={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},PH={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kH={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function jH(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=kH[e])?!!t[e]:!1}function JP(){return jH}var RH=Ys({},fb,{key:function(e){if(e.key){var t=IH[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=mS(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?PH[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:JP,charCode:function(e){return e.type==="keypress"?mS(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?mS(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),MH=Zl(RH),DH=Ys({},MT,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),nO=Zl(DH),NH=Ys({},fb,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:JP}),OH=Zl(NH),LH=Ys({},Ry,{propertyName:0,elapsedTime:0,pseudoElement:0}),zH=Zl(LH),FH=Ys({},MT,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),BH=Zl(FH),VH=[9,13,27,32],QP=Vd&&"CompositionEvent"in window,m0=null;Vd&&"documentMode"in document&&(m0=document.documentMode);var UH=Vd&&"TextEvent"in window&&!m0,f3=Vd&&(!QP||m0&&8<m0&&11>=m0),iO=" ",sO=!1;function p3(e,t){switch(e){case"keyup":return VH.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function m3(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var j_=!1;function $H(e,t){switch(e){case"compositionend":return m3(t);case"keypress":return t.which!==32?null:(sO=!0,iO);case"textInput":return e=t.data,e===iO&&sO?null:e;default:return null}}function qH(e,t){if(j_)return e==="compositionend"||!QP&&p3(e,t)?(e=h3(),pS=KP=gf=null,j_=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return f3&&t.locale!=="ko"?null:t.data;default:return null}}var GH={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function oO(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!GH[e.type]:t==="textarea"}function g3(e,t,i,c){HF(c),t=FS(t,"onChange"),0<t.length&&(i=new YP("onChange","change",null,i,c),e.push({event:i,listeners:t}))}var g0=null,D0=null;function WH(e){A3(e,0)}function DT(e){var t=D_(e);if(BF(t))return e}function HH(e,t){if(e==="change")return t}var _3=!1;if(Vd){var OC;if(Vd){var LC="oninput"in document;if(!LC){var aO=document.createElement("div");aO.setAttribute("oninput","return;"),LC=typeof aO.oninput=="function"}OC=LC}else OC=!1;_3=OC&&(!document.documentMode||9<document.documentMode)}function lO(){g0&&(g0.detachEvent("onpropertychange",y3),D0=g0=null)}function y3(e){if(e.propertyName==="value"&&DT(D0)){var t=[];g3(t,D0,e,GP(e)),YF(WH,t)}}function ZH(e,t,i){e==="focusin"?(lO(),g0=t,D0=i,g0.attachEvent("onpropertychange",y3)):e==="focusout"&&lO()}function XH(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return DT(D0)}function KH(e,t){if(e==="click")return DT(t)}function YH(e,t){if(e==="input"||e==="change")return DT(t)}function JH(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Jc=typeof Object.is=="function"?Object.is:JH;function N0(e,t){if(Jc(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),c=Object.keys(t);if(i.length!==c.length)return!1;for(c=0;c<i.length;c++){var f=i[c];if(!DA.call(t,f)||!Jc(e[f],t[f]))return!1}return!0}function cO(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function uO(e,t){var i=cO(e);e=0;for(var c;i;){if(i.nodeType===3){if(c=e+i.textContent.length,e<=t&&c>=t)return{node:i,offset:t-e};e=c}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=cO(i)}}function v3(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?v3(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function x3(){for(var e=window,t=RS();t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=RS(e.document)}return t}function ek(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function QH(e){var t=x3(),i=e.focusedElem,c=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&v3(i.ownerDocument.documentElement,i)){if(c!==null&&ek(i)){if(t=c.start,e=c.end,e===void 0&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if(e=(t=i.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var f=i.textContent.length,_=Math.min(c.start,f);c=c.end===void 0?_:Math.min(c.end,f),!e.extend&&_>c&&(f=c,c=_,_=f),f=uO(i,_);var x=uO(i,c);f&&x&&(e.rangeCount!==1||e.anchorNode!==f.node||e.anchorOffset!==f.offset||e.focusNode!==x.node||e.focusOffset!==x.offset)&&(t=t.createRange(),t.setStart(f.node,f.offset),e.removeAllRanges(),_>c?(e.addRange(t),e.extend(x.node,x.offset)):(t.setEnd(x.node,x.offset),e.addRange(t)))}}for(t=[],e=i;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<t.length;i++)e=t[i],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var e9=Vd&&"documentMode"in document&&11>=document.documentMode,R_=null,QA=null,_0=null,eI=!1;function dO(e,t,i){var c=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;eI||R_==null||R_!==RS(c)||(c=R_,"selectionStart"in c&&ek(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),_0&&N0(_0,c)||(_0=c,c=FS(QA,"onSelect"),0<c.length&&(t=new YP("onSelect","select",null,t,i),e.push({event:t,listeners:c}),t.target=R_)))}function Ow(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var M_={animationend:Ow("Animation","AnimationEnd"),animationiteration:Ow("Animation","AnimationIteration"),animationstart:Ow("Animation","AnimationStart"),transitionend:Ow("Transition","TransitionEnd")},zC={},b3={};Vd&&(b3=document.createElement("div").style,"AnimationEvent"in window||(delete M_.animationend.animation,delete M_.animationiteration.animation,delete M_.animationstart.animation),"TransitionEvent"in window||delete M_.transitionend.transition);function NT(e){if(zC[e])return zC[e];if(!M_[e])return e;var t=M_[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in b3)return zC[e]=t[i];return e}var w3=NT("animationend"),S3=NT("animationiteration"),T3=NT("animationstart"),E3=NT("transitionend"),C3=new Map,hO="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Bf(e,t){C3.set(e,t),Om(t,[e])}for(var FC=0;FC<hO.length;FC++){var BC=hO[FC],t9=BC.toLowerCase(),r9=BC[0].toUpperCase()+BC.slice(1);Bf(t9,"on"+r9)}Bf(w3,"onAnimationEnd");Bf(S3,"onAnimationIteration");Bf(T3,"onAnimationStart");Bf("dblclick","onDoubleClick");Bf("focusin","onFocus");Bf("focusout","onBlur");Bf(E3,"onTransitionEnd");hy("onMouseEnter",["mouseout","mouseover"]);hy("onMouseLeave",["mouseout","mouseover"]);hy("onPointerEnter",["pointerout","pointerover"]);hy("onPointerLeave",["pointerout","pointerover"]);Om("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Om("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Om("onBeforeInput",["compositionend","keypress","textInput","paste"]);Om("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Om("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Om("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var l0="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),n9=new Set("cancel close invalid load scroll toggle".split(" ").concat(l0));function fO(e,t,i){var c=e.type||"unknown-event";e.currentTarget=i,tH(c,t,void 0,e),e.currentTarget=null}function A3(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var c=e[i],f=c.event;c=c.listeners;e:{var _=void 0;if(t)for(var x=c.length-1;0<=x;x--){var o=c[x],I=o.instance,P=o.currentTarget;if(o=o.listener,I!==_&&f.isPropagationStopped())break e;fO(f,o,P),_=I}else for(x=0;x<c.length;x++){if(o=c[x],I=o.instance,P=o.currentTarget,o=o.listener,I!==_&&f.isPropagationStopped())break e;fO(f,o,P),_=I}}}if(DS)throw e=XA,DS=!1,XA=null,e}function Ds(e,t){var i=t[sI];i===void 0&&(i=t[sI]=new Set);var c=e+"__bubble";i.has(c)||(I3(t,e,2,!1),i.add(c))}function VC(e,t,i){var c=0;t&&(c|=4),I3(i,e,c,t)}var Lw="_reactListening"+Math.random().toString(36).slice(2);function O0(e){if(!e[Lw]){e[Lw]=!0,NF.forEach(function(i){i!=="selectionchange"&&(n9.has(i)||VC(i,!1,e),VC(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Lw]||(t[Lw]=!0,VC("selectionchange",!1,t))}}function I3(e,t,i,c){switch(d3(t)){case 1:var f=_H;break;case 4:f=yH;break;default:f=XP}i=f.bind(null,t,i,e),f=void 0,!ZA||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(f=!0),c?f!==void 0?e.addEventListener(t,i,{capture:!0,passive:f}):e.addEventListener(t,i,!0):f!==void 0?e.addEventListener(t,i,{passive:f}):e.addEventListener(t,i,!1)}function UC(e,t,i,c,f){var _=c;if(!(t&1)&&!(t&2)&&c!==null)e:for(;;){if(c===null)return;var x=c.tag;if(x===3||x===4){var o=c.stateNode.containerInfo;if(o===f||o.nodeType===8&&o.parentNode===f)break;if(x===4)for(x=c.return;x!==null;){var I=x.tag;if((I===3||I===4)&&(I=x.stateNode.containerInfo,I===f||I.nodeType===8&&I.parentNode===f))return;x=x.return}for(;o!==null;){if(x=nm(o),x===null)return;if(I=x.tag,I===5||I===6){c=_=x;continue e}o=o.parentNode}}c=c.return}YF(function(){var P=_,N=GP(i),U=[];e:{var $=C3.get(e);if($!==void 0){var B=YP,Y=e;switch(e){case"keypress":if(mS(i)===0)break e;case"keydown":case"keyup":B=MH;break;case"focusin":Y="focus",B=NC;break;case"focusout":Y="blur",B=NC;break;case"beforeblur":case"afterblur":B=NC;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":B=tO;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":B=bH;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":B=OH;break;case w3:case S3:case T3:B=TH;break;case E3:B=zH;break;case"scroll":B=vH;break;case"wheel":B=BH;break;case"copy":case"cut":case"paste":B=CH;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":B=nO}var H=(t&4)!==0,K=!H&&e==="scroll",re=H?$!==null?$+"Capture":null:$;H=[];for(var G=P,X;G!==null;){X=G;var ue=X.stateNode;if(X.tag===5&&ue!==null&&(X=ue,re!==null&&(ue=k0(G,re),ue!=null&&H.push(L0(G,ue,X)))),K)break;G=G.return}0<H.length&&($=new B($,Y,null,i,N),U.push({event:$,listeners:H}))}}if(!(t&7)){e:{if($=e==="mouseover"||e==="pointerover",B=e==="mouseout"||e==="pointerout",$&&i!==WA&&(Y=i.relatedTarget||i.fromElement)&&(nm(Y)||Y[Ud]))break e;if((B||$)&&($=N.window===N?N:($=N.ownerDocument)?$.defaultView||$.parentWindow:window,B?(Y=i.relatedTarget||i.toElement,B=P,Y=Y?nm(Y):null,Y!==null&&(K=Lm(Y),Y!==K||Y.tag!==5&&Y.tag!==6)&&(Y=null)):(B=null,Y=P),B!==Y)){if(H=tO,ue="onMouseLeave",re="onMouseEnter",G="mouse",(e==="pointerout"||e==="pointerover")&&(H=nO,ue="onPointerLeave",re="onPointerEnter",G="pointer"),K=B==null?$:D_(B),X=Y==null?$:D_(Y),$=new H(ue,G+"leave",B,i,N),$.target=K,$.relatedTarget=X,ue=null,nm(N)===P&&(H=new H(re,G+"enter",Y,i,N),H.target=X,H.relatedTarget=K,ue=H),K=ue,B&&Y)t:{for(H=B,re=Y,G=0,X=H;X;X=m_(X))G++;for(X=0,ue=re;ue;ue=m_(ue))X++;for(;0<G-X;)H=m_(H),G--;for(;0<X-G;)re=m_(re),X--;for(;G--;){if(H===re||re!==null&&H===re.alternate)break t;H=m_(H),re=m_(re)}H=null}else H=null;B!==null&&pO(U,$,B,H,!1),Y!==null&&K!==null&&pO(U,K,Y,H,!0)}}e:{if($=P?D_(P):window,B=$.nodeName&&$.nodeName.toLowerCase(),B==="select"||B==="input"&&$.type==="file")var Ee=HH;else if(oO($))if(_3)Ee=YH;else{Ee=XH;var xe=ZH}else(B=$.nodeName)&&B.toLowerCase()==="input"&&($.type==="checkbox"||$.type==="radio")&&(Ee=KH);if(Ee&&(Ee=Ee(e,P))){g3(U,Ee,i,N);break e}xe&&xe(e,$,P),e==="focusout"&&(xe=$._wrapperState)&&xe.controlled&&$.type==="number"&&VA($,"number",$.value)}switch(xe=P?D_(P):window,e){case"focusin":(oO(xe)||xe.contentEditable==="true")&&(R_=xe,QA=P,_0=null);break;case"focusout":_0=QA=R_=null;break;case"mousedown":eI=!0;break;case"contextmenu":case"mouseup":case"dragend":eI=!1,dO(U,i,N);break;case"selectionchange":if(e9)break;case"keydown":case"keyup":dO(U,i,N)}var Ne;if(QP)e:{switch(e){case"compositionstart":var lt="onCompositionStart";break e;case"compositionend":lt="onCompositionEnd";break e;case"compositionupdate":lt="onCompositionUpdate";break e}lt=void 0}else j_?p3(e,i)&&(lt="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(lt="onCompositionStart");lt&&(f3&&i.locale!=="ko"&&(j_||lt!=="onCompositionStart"?lt==="onCompositionEnd"&&j_&&(Ne=h3()):(gf=N,KP="value"in gf?gf.value:gf.textContent,j_=!0)),xe=FS(P,lt),0<xe.length&&(lt=new rO(lt,e,null,i,N),U.push({event:lt,listeners:xe}),Ne?lt.data=Ne:(Ne=m3(i),Ne!==null&&(lt.data=Ne)))),(Ne=UH?$H(e,i):qH(e,i))&&(P=FS(P,"onBeforeInput"),0<P.length&&(N=new rO("onBeforeInput","beforeinput",null,i,N),U.push({event:N,listeners:P}),N.data=Ne))}A3(U,t)})}function L0(e,t,i){return{instance:e,listener:t,currentTarget:i}}function FS(e,t){for(var i=t+"Capture",c=[];e!==null;){var f=e,_=f.stateNode;f.tag===5&&_!==null&&(f=_,_=k0(e,i),_!=null&&c.unshift(L0(e,_,f)),_=k0(e,t),_!=null&&c.push(L0(e,_,f))),e=e.return}return c}function m_(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function pO(e,t,i,c,f){for(var _=t._reactName,x=[];i!==null&&i!==c;){var o=i,I=o.alternate,P=o.stateNode;if(I!==null&&I===c)break;o.tag===5&&P!==null&&(o=P,f?(I=k0(i,_),I!=null&&x.unshift(L0(i,I,o))):f||(I=k0(i,_),I!=null&&x.push(L0(i,I,o)))),i=i.return}x.length!==0&&e.push({event:t,listeners:x})}var i9=/\r\n?/g,s9=/\u0000|\uFFFD/g;function mO(e){return(typeof e=="string"?e:""+e).replace(i9,`
`).replace(s9,"")}function zw(e,t,i){if(t=mO(t),mO(e)!==t&&i)throw Error(xr(425))}function BS(){}var tI=null,rI=null;function nI(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var iI=typeof setTimeout=="function"?setTimeout:void 0,o9=typeof clearTimeout=="function"?clearTimeout:void 0,gO=typeof Promise=="function"?Promise:void 0,a9=typeof queueMicrotask=="function"?queueMicrotask:typeof gO<"u"?function(e){return gO.resolve(null).then(e).catch(l9)}:iI;function l9(e){setTimeout(function(){throw e})}function $C(e,t){var i=t,c=0;do{var f=i.nextSibling;if(e.removeChild(i),f&&f.nodeType===8)if(i=f.data,i==="/$"){if(c===0){e.removeChild(f),M0(t);return}c--}else i!=="$"&&i!=="$?"&&i!=="$!"||c++;i=f}while(i);M0(t)}function Tf(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function _O(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(t===0)return e;t--}else i==="/$"&&t++}e=e.previousSibling}return null}var My=Math.random().toString(36).slice(2),Du="__reactFiber$"+My,z0="__reactProps$"+My,Ud="__reactContainer$"+My,sI="__reactEvents$"+My,c9="__reactListeners$"+My,u9="__reactHandles$"+My;function nm(e){var t=e[Du];if(t)return t;for(var i=e.parentNode;i;){if(t=i[Ud]||i[Du]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=_O(e);e!==null;){if(i=e[Du])return i;e=_O(e)}return t}e=i,i=e.parentNode}return null}function pb(e){return e=e[Du]||e[Ud],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function D_(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(xr(33))}function OT(e){return e[z0]||null}var oI=[],N_=-1;function Vf(e){return{current:e}}function Ns(e){0>N_||(e.current=oI[N_],oI[N_]=null,N_--)}function Is(e,t){N_++,oI[N_]=e.current,e.current=t}var Mf={},Ta=Vf(Mf),bl=Vf(!1),xm=Mf;function fy(e,t){var i=e.type.contextTypes;if(!i)return Mf;var c=e.stateNode;if(c&&c.__reactInternalMemoizedUnmaskedChildContext===t)return c.__reactInternalMemoizedMaskedChildContext;var f={},_;for(_ in i)f[_]=t[_];return c&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=f),f}function wl(e){return e=e.childContextTypes,e!=null}function VS(){Ns(bl),Ns(Ta)}function yO(e,t,i){if(Ta.current!==Mf)throw Error(xr(168));Is(Ta,t),Is(bl,i)}function P3(e,t,i){var c=e.stateNode;if(t=t.childContextTypes,typeof c.getChildContext!="function")return i;c=c.getChildContext();for(var f in c)if(!(f in t))throw Error(xr(108,ZW(e)||"Unknown",f));return Ys({},i,c)}function US(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Mf,xm=Ta.current,Is(Ta,e),Is(bl,bl.current),!0}function vO(e,t,i){var c=e.stateNode;if(!c)throw Error(xr(169));i?(e=P3(e,t,xm),c.__reactInternalMemoizedMergedChildContext=e,Ns(bl),Ns(Ta),Is(Ta,e)):Ns(bl),Is(bl,i)}var Id=null,LT=!1,qC=!1;function k3(e){Id===null?Id=[e]:Id.push(e)}function d9(e){LT=!0,k3(e)}function Uf(){if(!qC&&Id!==null){qC=!0;var e=0,t=ys;try{var i=Id;for(ys=1;e<i.length;e++){var c=i[e];do c=c(!0);while(c!==null)}Id=null,LT=!1}catch(f){throw Id!==null&&(Id=Id.slice(e+1)),t3(WP,Uf),f}finally{ys=t,qC=!1}}return null}var O_=[],L_=0,$S=null,qS=0,oc=[],ac=0,bm=null,Rd=1,Md="";function Yp(e,t){O_[L_++]=qS,O_[L_++]=$S,$S=e,qS=t}function j3(e,t,i){oc[ac++]=Rd,oc[ac++]=Md,oc[ac++]=bm,bm=e;var c=Rd;e=Md;var f=32-Kc(c)-1;c&=~(1<<f),i+=1;var _=32-Kc(t)+f;if(30<_){var x=f-f%5;_=(c&(1<<x)-1).toString(32),c>>=x,f-=x,Rd=1<<32-Kc(t)+f|i<<f|c,Md=_+e}else Rd=1<<_|i<<f|c,Md=e}function tk(e){e.return!==null&&(Yp(e,1),j3(e,1,0))}function rk(e){for(;e===$S;)$S=O_[--L_],O_[L_]=null,qS=O_[--L_],O_[L_]=null;for(;e===bm;)bm=oc[--ac],oc[ac]=null,Md=oc[--ac],oc[ac]=null,Rd=oc[--ac],oc[ac]=null}var Vl=null,Bl=null,Bs=!1,Wc=null;function R3(e,t){var i=cc(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)}function xO(e,t){switch(e.tag){case 5:var i=e.type;return t=t.nodeType!==1||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Vl=e,Bl=Tf(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Vl=e,Bl=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(i=bm!==null?{id:Rd,overflow:Md}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},i=cc(18,null,null,0),i.stateNode=t,i.return=e,e.child=i,Vl=e,Bl=null,!0):!1;default:return!1}}function aI(e){return(e.mode&1)!==0&&(e.flags&128)===0}function lI(e){if(Bs){var t=Bl;if(t){var i=t;if(!xO(e,t)){if(aI(e))throw Error(xr(418));t=Tf(i.nextSibling);var c=Vl;t&&xO(e,t)?R3(c,i):(e.flags=e.flags&-4097|2,Bs=!1,Vl=e)}}else{if(aI(e))throw Error(xr(418));e.flags=e.flags&-4097|2,Bs=!1,Vl=e}}}function bO(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Vl=e}function Fw(e){if(e!==Vl)return!1;if(!Bs)return bO(e),Bs=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!nI(e.type,e.memoizedProps)),t&&(t=Bl)){if(aI(e))throw M3(),Error(xr(418));for(;t;)R3(e,t),t=Tf(t.nextSibling)}if(bO(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(xr(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"){if(t===0){Bl=Tf(e.nextSibling);break e}t--}else i!=="$"&&i!=="$!"&&i!=="$?"||t++}e=e.nextSibling}Bl=null}}else Bl=Vl?Tf(e.stateNode.nextSibling):null;return!0}function M3(){for(var e=Bl;e;)e=Tf(e.nextSibling)}function py(){Bl=Vl=null,Bs=!1}function nk(e){Wc===null?Wc=[e]:Wc.push(e)}var h9=Zd.ReactCurrentBatchConfig;function Jx(e,t,i){if(e=i.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(xr(309));var c=i.stateNode}if(!c)throw Error(xr(147,e));var f=c,_=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===_?t.ref:(t=function(x){var o=f.refs;x===null?delete o[_]:o[_]=x},t._stringRef=_,t)}if(typeof e!="string")throw Error(xr(284));if(!i._owner)throw Error(xr(290,e))}return e}function Bw(e,t){throw e=Object.prototype.toString.call(t),Error(xr(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function wO(e){var t=e._init;return t(e._payload)}function D3(e){function t(re,G){if(e){var X=re.deletions;X===null?(re.deletions=[G],re.flags|=16):X.push(G)}}function i(re,G){if(!e)return null;for(;G!==null;)t(re,G),G=G.sibling;return null}function c(re,G){for(re=new Map;G!==null;)G.key!==null?re.set(G.key,G):re.set(G.index,G),G=G.sibling;return re}function f(re,G){return re=If(re,G),re.index=0,re.sibling=null,re}function _(re,G,X){return re.index=X,e?(X=re.alternate,X!==null?(X=X.index,X<G?(re.flags|=2,G):X):(re.flags|=2,G)):(re.flags|=1048576,G)}function x(re){return e&&re.alternate===null&&(re.flags|=2),re}function o(re,G,X,ue){return G===null||G.tag!==6?(G=YC(X,re.mode,ue),G.return=re,G):(G=f(G,X),G.return=re,G)}function I(re,G,X,ue){var Ee=X.type;return Ee===k_?N(re,G,X.props.children,ue,X.key):G!==null&&(G.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===Qh&&wO(Ee)===G.type)?(ue=f(G,X.props),ue.ref=Jx(re,G,X),ue.return=re,ue):(ue=wS(X.type,X.key,X.props,null,re.mode,ue),ue.ref=Jx(re,G,X),ue.return=re,ue)}function P(re,G,X,ue){return G===null||G.tag!==4||G.stateNode.containerInfo!==X.containerInfo||G.stateNode.implementation!==X.implementation?(G=JC(X,re.mode,ue),G.return=re,G):(G=f(G,X.children||[]),G.return=re,G)}function N(re,G,X,ue,Ee){return G===null||G.tag!==7?(G=ym(X,re.mode,ue,Ee),G.return=re,G):(G=f(G,X),G.return=re,G)}function U(re,G,X){if(typeof G=="string"&&G!==""||typeof G=="number")return G=YC(""+G,re.mode,X),G.return=re,G;if(typeof G=="object"&&G!==null){switch(G.$$typeof){case Pw:return X=wS(G.type,G.key,G.props,null,re.mode,X),X.ref=Jx(re,null,G),X.return=re,X;case P_:return G=JC(G,re.mode,X),G.return=re,G;case Qh:var ue=G._init;return U(re,ue(G._payload),X)}if(o0(G)||Hx(G))return G=ym(G,re.mode,X,null),G.return=re,G;Bw(re,G)}return null}function $(re,G,X,ue){var Ee=G!==null?G.key:null;if(typeof X=="string"&&X!==""||typeof X=="number")return Ee!==null?null:o(re,G,""+X,ue);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case Pw:return X.key===Ee?I(re,G,X,ue):null;case P_:return X.key===Ee?P(re,G,X,ue):null;case Qh:return Ee=X._init,$(re,G,Ee(X._payload),ue)}if(o0(X)||Hx(X))return Ee!==null?null:N(re,G,X,ue,null);Bw(re,X)}return null}function B(re,G,X,ue,Ee){if(typeof ue=="string"&&ue!==""||typeof ue=="number")return re=re.get(X)||null,o(G,re,""+ue,Ee);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case Pw:return re=re.get(ue.key===null?X:ue.key)||null,I(G,re,ue,Ee);case P_:return re=re.get(ue.key===null?X:ue.key)||null,P(G,re,ue,Ee);case Qh:var xe=ue._init;return B(re,G,X,xe(ue._payload),Ee)}if(o0(ue)||Hx(ue))return re=re.get(X)||null,N(G,re,ue,Ee,null);Bw(G,ue)}return null}function Y(re,G,X,ue){for(var Ee=null,xe=null,Ne=G,lt=G=0,Pt=null;Ne!==null&&lt<X.length;lt++){Ne.index>lt?(Pt=Ne,Ne=null):Pt=Ne.sibling;var tt=$(re,Ne,X[lt],ue);if(tt===null){Ne===null&&(Ne=Pt);break}e&&Ne&&tt.alternate===null&&t(re,Ne),G=_(tt,G,lt),xe===null?Ee=tt:xe.sibling=tt,xe=tt,Ne=Pt}if(lt===X.length)return i(re,Ne),Bs&&Yp(re,lt),Ee;if(Ne===null){for(;lt<X.length;lt++)Ne=U(re,X[lt],ue),Ne!==null&&(G=_(Ne,G,lt),xe===null?Ee=Ne:xe.sibling=Ne,xe=Ne);return Bs&&Yp(re,lt),Ee}for(Ne=c(re,Ne);lt<X.length;lt++)Pt=B(Ne,re,lt,X[lt],ue),Pt!==null&&(e&&Pt.alternate!==null&&Ne.delete(Pt.key===null?lt:Pt.key),G=_(Pt,G,lt),xe===null?Ee=Pt:xe.sibling=Pt,xe=Pt);return e&&Ne.forEach(function(yt){return t(re,yt)}),Bs&&Yp(re,lt),Ee}function H(re,G,X,ue){var Ee=Hx(X);if(typeof Ee!="function")throw Error(xr(150));if(X=Ee.call(X),X==null)throw Error(xr(151));for(var xe=Ee=null,Ne=G,lt=G=0,Pt=null,tt=X.next();Ne!==null&&!tt.done;lt++,tt=X.next()){Ne.index>lt?(Pt=Ne,Ne=null):Pt=Ne.sibling;var yt=$(re,Ne,tt.value,ue);if(yt===null){Ne===null&&(Ne=Pt);break}e&&Ne&&yt.alternate===null&&t(re,Ne),G=_(yt,G,lt),xe===null?Ee=yt:xe.sibling=yt,xe=yt,Ne=Pt}if(tt.done)return i(re,Ne),Bs&&Yp(re,lt),Ee;if(Ne===null){for(;!tt.done;lt++,tt=X.next())tt=U(re,tt.value,ue),tt!==null&&(G=_(tt,G,lt),xe===null?Ee=tt:xe.sibling=tt,xe=tt);return Bs&&Yp(re,lt),Ee}for(Ne=c(re,Ne);!tt.done;lt++,tt=X.next())tt=B(Ne,re,lt,tt.value,ue),tt!==null&&(e&&tt.alternate!==null&&Ne.delete(tt.key===null?lt:tt.key),G=_(tt,G,lt),xe===null?Ee=tt:xe.sibling=tt,xe=tt);return e&&Ne.forEach(function(Me){return t(re,Me)}),Bs&&Yp(re,lt),Ee}function K(re,G,X,ue){if(typeof X=="object"&&X!==null&&X.type===k_&&X.key===null&&(X=X.props.children),typeof X=="object"&&X!==null){switch(X.$$typeof){case Pw:e:{for(var Ee=X.key,xe=G;xe!==null;){if(xe.key===Ee){if(Ee=X.type,Ee===k_){if(xe.tag===7){i(re,xe.sibling),G=f(xe,X.props.children),G.return=re,re=G;break e}}else if(xe.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===Qh&&wO(Ee)===xe.type){i(re,xe.sibling),G=f(xe,X.props),G.ref=Jx(re,xe,X),G.return=re,re=G;break e}i(re,xe);break}else t(re,xe);xe=xe.sibling}X.type===k_?(G=ym(X.props.children,re.mode,ue,X.key),G.return=re,re=G):(ue=wS(X.type,X.key,X.props,null,re.mode,ue),ue.ref=Jx(re,G,X),ue.return=re,re=ue)}return x(re);case P_:e:{for(xe=X.key;G!==null;){if(G.key===xe)if(G.tag===4&&G.stateNode.containerInfo===X.containerInfo&&G.stateNode.implementation===X.implementation){i(re,G.sibling),G=f(G,X.children||[]),G.return=re,re=G;break e}else{i(re,G);break}else t(re,G);G=G.sibling}G=JC(X,re.mode,ue),G.return=re,re=G}return x(re);case Qh:return xe=X._init,K(re,G,xe(X._payload),ue)}if(o0(X))return Y(re,G,X,ue);if(Hx(X))return H(re,G,X,ue);Bw(re,X)}return typeof X=="string"&&X!==""||typeof X=="number"?(X=""+X,G!==null&&G.tag===6?(i(re,G.sibling),G=f(G,X),G.return=re,re=G):(i(re,G),G=YC(X,re.mode,ue),G.return=re,re=G),x(re)):i(re,G)}return K}var my=D3(!0),N3=D3(!1),GS=Vf(null),WS=null,z_=null,ik=null;function sk(){ik=z_=WS=null}function ok(e){var t=GS.current;Ns(GS),e._currentValue=t}function cI(e,t,i){for(;e!==null;){var c=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,c!==null&&(c.childLanes|=t)):c!==null&&(c.childLanes&t)!==t&&(c.childLanes|=t),e===i)break;e=e.return}}function W_(e,t){WS=e,ik=z_=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(vl=!0),e.firstContext=null)}function dc(e){var t=e._currentValue;if(ik!==e)if(e={context:e,memoizedValue:t,next:null},z_===null){if(WS===null)throw Error(xr(308));z_=e,WS.dependencies={lanes:0,firstContext:e}}else z_=z_.next=e;return t}var im=null;function ak(e){im===null?im=[e]:im.push(e)}function O3(e,t,i,c){var f=t.interleaved;return f===null?(i.next=i,ak(t)):(i.next=f.next,f.next=i),t.interleaved=i,$d(e,c)}function $d(e,t){e.lanes|=t;var i=e.alternate;for(i!==null&&(i.lanes|=t),i=e,e=e.return;e!==null;)e.childLanes|=t,i=e.alternate,i!==null&&(i.childLanes|=t),i=e,e=e.return;return i.tag===3?i.stateNode:null}var ef=!1;function lk(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function L3(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Od(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ef(e,t,i){var c=e.updateQueue;if(c===null)return null;if(c=c.shared,Ji&2){var f=c.pending;return f===null?t.next=t:(t.next=f.next,f.next=t),c.pending=t,$d(e,i)}return f=c.interleaved,f===null?(t.next=t,ak(c)):(t.next=f.next,f.next=t),c.interleaved=t,$d(e,i)}function gS(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194240)!==0)){var c=t.lanes;c&=e.pendingLanes,i|=c,t.lanes=i,HP(e,i)}}function SO(e,t){var i=e.updateQueue,c=e.alternate;if(c!==null&&(c=c.updateQueue,i===c)){var f=null,_=null;if(i=i.firstBaseUpdate,i!==null){do{var x={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};_===null?f=_=x:_=_.next=x,i=i.next}while(i!==null);_===null?f=_=t:_=_.next=t}else f=_=t;i={baseState:c.baseState,firstBaseUpdate:f,lastBaseUpdate:_,shared:c.shared,effects:c.effects},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function HS(e,t,i,c){var f=e.updateQueue;ef=!1;var _=f.firstBaseUpdate,x=f.lastBaseUpdate,o=f.shared.pending;if(o!==null){f.shared.pending=null;var I=o,P=I.next;I.next=null,x===null?_=P:x.next=P,x=I;var N=e.alternate;N!==null&&(N=N.updateQueue,o=N.lastBaseUpdate,o!==x&&(o===null?N.firstBaseUpdate=P:o.next=P,N.lastBaseUpdate=I))}if(_!==null){var U=f.baseState;x=0,N=P=I=null,o=_;do{var $=o.lane,B=o.eventTime;if((c&$)===$){N!==null&&(N=N.next={eventTime:B,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var Y=e,H=o;switch($=t,B=i,H.tag){case 1:if(Y=H.payload,typeof Y=="function"){U=Y.call(B,U,$);break e}U=Y;break e;case 3:Y.flags=Y.flags&-65537|128;case 0:if(Y=H.payload,$=typeof Y=="function"?Y.call(B,U,$):Y,$==null)break e;U=Ys({},U,$);break e;case 2:ef=!0}}o.callback!==null&&o.lane!==0&&(e.flags|=64,$=f.effects,$===null?f.effects=[o]:$.push(o))}else B={eventTime:B,lane:$,tag:o.tag,payload:o.payload,callback:o.callback,next:null},N===null?(P=N=B,I=U):N=N.next=B,x|=$;if(o=o.next,o===null){if(o=f.shared.pending,o===null)break;$=o,o=$.next,$.next=null,f.lastBaseUpdate=$,f.shared.pending=null}}while(!0);if(N===null&&(I=U),f.baseState=I,f.firstBaseUpdate=P,f.lastBaseUpdate=N,t=f.shared.interleaved,t!==null){f=t;do x|=f.lane,f=f.next;while(f!==t)}else _===null&&(f.shared.lanes=0);Sm|=x,e.lanes=x,e.memoizedState=U}}function TO(e,t,i){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var c=e[t],f=c.callback;if(f!==null){if(c.callback=null,c=i,typeof f!="function")throw Error(xr(191,f));f.call(c)}}}var mb={},Uu=Vf(mb),F0=Vf(mb),B0=Vf(mb);function sm(e){if(e===mb)throw Error(xr(174));return e}function ck(e,t){switch(Is(B0,t),Is(F0,e),Is(Uu,mb),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:$A(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=$A(t,e)}Ns(Uu),Is(Uu,t)}function gy(){Ns(Uu),Ns(F0),Ns(B0)}function z3(e){sm(B0.current);var t=sm(Uu.current),i=$A(t,e.type);t!==i&&(Is(F0,e),Is(Uu,i))}function uk(e){F0.current===e&&(Ns(Uu),Ns(F0))}var Ws=Vf(0);function ZS(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var GC=[];function dk(){for(var e=0;e<GC.length;e++)GC[e]._workInProgressVersionPrimary=null;GC.length=0}var _S=Zd.ReactCurrentDispatcher,WC=Zd.ReactCurrentBatchConfig,wm=0,Xs=null,Bo=null,Xo=null,XS=!1,y0=!1,V0=0,f9=0;function ya(){throw Error(xr(321))}function hk(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!Jc(e[i],t[i]))return!1;return!0}function fk(e,t,i,c,f,_){if(wm=_,Xs=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,_S.current=e===null||e.memoizedState===null?_9:y9,e=i(c,f),y0){_=0;do{if(y0=!1,V0=0,25<=_)throw Error(xr(301));_+=1,Xo=Bo=null,t.updateQueue=null,_S.current=v9,e=i(c,f)}while(y0)}if(_S.current=KS,t=Bo!==null&&Bo.next!==null,wm=0,Xo=Bo=Xs=null,XS=!1,t)throw Error(xr(300));return e}function pk(){var e=V0!==0;return V0=0,e}function ku(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xo===null?Xs.memoizedState=Xo=e:Xo=Xo.next=e,Xo}function hc(){if(Bo===null){var e=Xs.alternate;e=e!==null?e.memoizedState:null}else e=Bo.next;var t=Xo===null?Xs.memoizedState:Xo.next;if(t!==null)Xo=t,Bo=e;else{if(e===null)throw Error(xr(310));Bo=e,e={memoizedState:Bo.memoizedState,baseState:Bo.baseState,baseQueue:Bo.baseQueue,queue:Bo.queue,next:null},Xo===null?Xs.memoizedState=Xo=e:Xo=Xo.next=e}return Xo}function U0(e,t){return typeof t=="function"?t(e):t}function HC(e){var t=hc(),i=t.queue;if(i===null)throw Error(xr(311));i.lastRenderedReducer=e;var c=Bo,f=c.baseQueue,_=i.pending;if(_!==null){if(f!==null){var x=f.next;f.next=_.next,_.next=x}c.baseQueue=f=_,i.pending=null}if(f!==null){_=f.next,c=c.baseState;var o=x=null,I=null,P=_;do{var N=P.lane;if((wm&N)===N)I!==null&&(I=I.next={lane:0,action:P.action,hasEagerState:P.hasEagerState,eagerState:P.eagerState,next:null}),c=P.hasEagerState?P.eagerState:e(c,P.action);else{var U={lane:N,action:P.action,hasEagerState:P.hasEagerState,eagerState:P.eagerState,next:null};I===null?(o=I=U,x=c):I=I.next=U,Xs.lanes|=N,Sm|=N}P=P.next}while(P!==null&&P!==_);I===null?x=c:I.next=o,Jc(c,t.memoizedState)||(vl=!0),t.memoizedState=c,t.baseState=x,t.baseQueue=I,i.lastRenderedState=c}if(e=i.interleaved,e!==null){f=e;do _=f.lane,Xs.lanes|=_,Sm|=_,f=f.next;while(f!==e)}else f===null&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function ZC(e){var t=hc(),i=t.queue;if(i===null)throw Error(xr(311));i.lastRenderedReducer=e;var c=i.dispatch,f=i.pending,_=t.memoizedState;if(f!==null){i.pending=null;var x=f=f.next;do _=e(_,x.action),x=x.next;while(x!==f);Jc(_,t.memoizedState)||(vl=!0),t.memoizedState=_,t.baseQueue===null&&(t.baseState=_),i.lastRenderedState=_}return[_,c]}function F3(){}function B3(e,t){var i=Xs,c=hc(),f=t(),_=!Jc(c.memoizedState,f);if(_&&(c.memoizedState=f,vl=!0),c=c.queue,mk($3.bind(null,i,c,e),[e]),c.getSnapshot!==t||_||Xo!==null&&Xo.memoizedState.tag&1){if(i.flags|=2048,$0(9,U3.bind(null,i,c,f,t),void 0,null),Ko===null)throw Error(xr(349));wm&30||V3(i,t,f)}return f}function V3(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=Xs.updateQueue,t===null?(t={lastEffect:null,stores:null},Xs.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function U3(e,t,i,c){t.value=i,t.getSnapshot=c,q3(t)&&G3(e)}function $3(e,t,i){return i(function(){q3(t)&&G3(e)})}function q3(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!Jc(e,i)}catch{return!0}}function G3(e){var t=$d(e,1);t!==null&&Yc(t,e,1,-1)}function EO(e){var t=ku();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:U0,lastRenderedState:e},t.queue=e,e=e.dispatch=g9.bind(null,Xs,e),[t.memoizedState,e]}function $0(e,t,i,c){return e={tag:e,create:t,destroy:i,deps:c,next:null},t=Xs.updateQueue,t===null?(t={lastEffect:null,stores:null},Xs.updateQueue=t,t.lastEffect=e.next=e):(i=t.lastEffect,i===null?t.lastEffect=e.next=e:(c=i.next,i.next=e,e.next=c,t.lastEffect=e)),e}function W3(){return hc().memoizedState}function yS(e,t,i,c){var f=ku();Xs.flags|=e,f.memoizedState=$0(1|t,i,void 0,c===void 0?null:c)}function zT(e,t,i,c){var f=hc();c=c===void 0?null:c;var _=void 0;if(Bo!==null){var x=Bo.memoizedState;if(_=x.destroy,c!==null&&hk(c,x.deps)){f.memoizedState=$0(t,i,_,c);return}}Xs.flags|=e,f.memoizedState=$0(1|t,i,_,c)}function CO(e,t){return yS(8390656,8,e,t)}function mk(e,t){return zT(2048,8,e,t)}function H3(e,t){return zT(4,2,e,t)}function Z3(e,t){return zT(4,4,e,t)}function X3(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function K3(e,t,i){return i=i!=null?i.concat([e]):null,zT(4,4,X3.bind(null,t,e),i)}function gk(){}function Y3(e,t){var i=hc();t=t===void 0?null:t;var c=i.memoizedState;return c!==null&&t!==null&&hk(t,c[1])?c[0]:(i.memoizedState=[e,t],e)}function J3(e,t){var i=hc();t=t===void 0?null:t;var c=i.memoizedState;return c!==null&&t!==null&&hk(t,c[1])?c[0]:(e=e(),i.memoizedState=[e,t],e)}function Q3(e,t,i){return wm&21?(Jc(i,t)||(i=i3(),Xs.lanes|=i,Sm|=i,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,vl=!0),e.memoizedState=i)}function p9(e,t){var i=ys;ys=i!==0&&4>i?i:4,e(!0);var c=WC.transition;WC.transition={};try{e(!1),t()}finally{ys=i,WC.transition=c}}function eB(){return hc().memoizedState}function m9(e,t,i){var c=Af(e);if(i={lane:c,action:i,hasEagerState:!1,eagerState:null,next:null},tB(e))rB(t,i);else if(i=O3(e,t,i,c),i!==null){var f=Ka();Yc(i,e,c,f),nB(i,t,c)}}function g9(e,t,i){var c=Af(e),f={lane:c,action:i,hasEagerState:!1,eagerState:null,next:null};if(tB(e))rB(t,f);else{var _=e.alternate;if(e.lanes===0&&(_===null||_.lanes===0)&&(_=t.lastRenderedReducer,_!==null))try{var x=t.lastRenderedState,o=_(x,i);if(f.hasEagerState=!0,f.eagerState=o,Jc(o,x)){var I=t.interleaved;I===null?(f.next=f,ak(t)):(f.next=I.next,I.next=f),t.interleaved=f;return}}catch{}finally{}i=O3(e,t,f,c),i!==null&&(f=Ka(),Yc(i,e,c,f),nB(i,t,c))}}function tB(e){var t=e.alternate;return e===Xs||t!==null&&t===Xs}function rB(e,t){y0=XS=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function nB(e,t,i){if(i&4194240){var c=t.lanes;c&=e.pendingLanes,i|=c,t.lanes=i,HP(e,i)}}var KS={readContext:dc,useCallback:ya,useContext:ya,useEffect:ya,useImperativeHandle:ya,useInsertionEffect:ya,useLayoutEffect:ya,useMemo:ya,useReducer:ya,useRef:ya,useState:ya,useDebugValue:ya,useDeferredValue:ya,useTransition:ya,useMutableSource:ya,useSyncExternalStore:ya,useId:ya,unstable_isNewReconciler:!1},_9={readContext:dc,useCallback:function(e,t){return ku().memoizedState=[e,t===void 0?null:t],e},useContext:dc,useEffect:CO,useImperativeHandle:function(e,t,i){return i=i!=null?i.concat([e]):null,yS(4194308,4,X3.bind(null,t,e),i)},useLayoutEffect:function(e,t){return yS(4194308,4,e,t)},useInsertionEffect:function(e,t){return yS(4,2,e,t)},useMemo:function(e,t){var i=ku();return t=t===void 0?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var c=ku();return t=i!==void 0?i(t):t,c.memoizedState=c.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},c.queue=e,e=e.dispatch=m9.bind(null,Xs,e),[c.memoizedState,e]},useRef:function(e){var t=ku();return e={current:e},t.memoizedState=e},useState:EO,useDebugValue:gk,useDeferredValue:function(e){return ku().memoizedState=e},useTransition:function(){var e=EO(!1),t=e[0];return e=p9.bind(null,e[1]),ku().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var c=Xs,f=ku();if(Bs){if(i===void 0)throw Error(xr(407));i=i()}else{if(i=t(),Ko===null)throw Error(xr(349));wm&30||V3(c,t,i)}f.memoizedState=i;var _={value:i,getSnapshot:t};return f.queue=_,CO($3.bind(null,c,_,e),[e]),c.flags|=2048,$0(9,U3.bind(null,c,_,i,t),void 0,null),i},useId:function(){var e=ku(),t=Ko.identifierPrefix;if(Bs){var i=Md,c=Rd;i=(c&~(1<<32-Kc(c)-1)).toString(32)+i,t=":"+t+"R"+i,i=V0++,0<i&&(t+="H"+i.toString(32)),t+=":"}else i=f9++,t=":"+t+"r"+i.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},y9={readContext:dc,useCallback:Y3,useContext:dc,useEffect:mk,useImperativeHandle:K3,useInsertionEffect:H3,useLayoutEffect:Z3,useMemo:J3,useReducer:HC,useRef:W3,useState:function(){return HC(U0)},useDebugValue:gk,useDeferredValue:function(e){var t=hc();return Q3(t,Bo.memoizedState,e)},useTransition:function(){var e=HC(U0)[0],t=hc().memoizedState;return[e,t]},useMutableSource:F3,useSyncExternalStore:B3,useId:eB,unstable_isNewReconciler:!1},v9={readContext:dc,useCallback:Y3,useContext:dc,useEffect:mk,useImperativeHandle:K3,useInsertionEffect:H3,useLayoutEffect:Z3,useMemo:J3,useReducer:ZC,useRef:W3,useState:function(){return ZC(U0)},useDebugValue:gk,useDeferredValue:function(e){var t=hc();return Bo===null?t.memoizedState=e:Q3(t,Bo.memoizedState,e)},useTransition:function(){var e=ZC(U0)[0],t=hc().memoizedState;return[e,t]},useMutableSource:F3,useSyncExternalStore:B3,useId:eB,unstable_isNewReconciler:!1};function Bc(e,t){if(e&&e.defaultProps){t=Ys({},t),e=e.defaultProps;for(var i in e)t[i]===void 0&&(t[i]=e[i]);return t}return t}function uI(e,t,i,c){t=e.memoizedState,i=i(c,t),i=i==null?t:Ys({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var FT={isMounted:function(e){return(e=e._reactInternals)?Lm(e)===e:!1},enqueueSetState:function(e,t,i){e=e._reactInternals;var c=Ka(),f=Af(e),_=Od(c,f);_.payload=t,i!=null&&(_.callback=i),t=Ef(e,_,f),t!==null&&(Yc(t,e,f,c),gS(t,e,f))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var c=Ka(),f=Af(e),_=Od(c,f);_.tag=1,_.payload=t,i!=null&&(_.callback=i),t=Ef(e,_,f),t!==null&&(Yc(t,e,f,c),gS(t,e,f))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=Ka(),c=Af(e),f=Od(i,c);f.tag=2,t!=null&&(f.callback=t),t=Ef(e,f,c),t!==null&&(Yc(t,e,c,i),gS(t,e,c))}};function AO(e,t,i,c,f,_,x){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(c,_,x):t.prototype&&t.prototype.isPureReactComponent?!N0(i,c)||!N0(f,_):!0}function iB(e,t,i){var c=!1,f=Mf,_=t.contextType;return typeof _=="object"&&_!==null?_=dc(_):(f=wl(t)?xm:Ta.current,c=t.contextTypes,_=(c=c!=null)?fy(e,f):Mf),t=new t(i,_),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=FT,e.stateNode=t,t._reactInternals=e,c&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=f,e.__reactInternalMemoizedMaskedChildContext=_),t}function IO(e,t,i,c){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,c),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,c),t.state!==e&&FT.enqueueReplaceState(t,t.state,null)}function dI(e,t,i,c){var f=e.stateNode;f.props=i,f.state=e.memoizedState,f.refs={},lk(e);var _=t.contextType;typeof _=="object"&&_!==null?f.context=dc(_):(_=wl(t)?xm:Ta.current,f.context=fy(e,_)),f.state=e.memoizedState,_=t.getDerivedStateFromProps,typeof _=="function"&&(uI(e,t,_,i),f.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof f.getSnapshotBeforeUpdate=="function"||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(t=f.state,typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount(),t!==f.state&&FT.enqueueReplaceState(f,f.state,null),HS(e,i,f,c),f.state=e.memoizedState),typeof f.componentDidMount=="function"&&(e.flags|=4194308)}function _y(e,t){try{var i="",c=t;do i+=HW(c),c=c.return;while(c);var f=i}catch(_){f=`
Error generating stack: `+_.message+`
`+_.stack}return{value:e,source:t,stack:f,digest:null}}function XC(e,t,i){return{value:e,source:null,stack:i??null,digest:t??null}}function hI(e,t){try{console.error(t.value)}catch(i){setTimeout(function(){throw i})}}var x9=typeof WeakMap=="function"?WeakMap:Map;function sB(e,t,i){i=Od(-1,i),i.tag=3,i.payload={element:null};var c=t.value;return i.callback=function(){JS||(JS=!0,wI=c),hI(e,t)},i}function oB(e,t,i){i=Od(-1,i),i.tag=3;var c=e.type.getDerivedStateFromError;if(typeof c=="function"){var f=t.value;i.payload=function(){return c(f)},i.callback=function(){hI(e,t)}}var _=e.stateNode;return _!==null&&typeof _.componentDidCatch=="function"&&(i.callback=function(){hI(e,t),typeof c!="function"&&(Cf===null?Cf=new Set([this]):Cf.add(this));var x=t.stack;this.componentDidCatch(t.value,{componentStack:x!==null?x:""})}),i}function PO(e,t,i){var c=e.pingCache;if(c===null){c=e.pingCache=new x9;var f=new Set;c.set(t,f)}else f=c.get(t),f===void 0&&(f=new Set,c.set(t,f));f.has(i)||(f.add(i),e=D9.bind(null,e,t,i),t.then(e,e))}function kO(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function jO(e,t,i,c,f){return e.mode&1?(e.flags|=65536,e.lanes=f,e):(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(t=Od(-1,1),t.tag=2,Ef(i,t,1))),i.lanes|=1),e)}var b9=Zd.ReactCurrentOwner,vl=!1;function qa(e,t,i,c){t.child=e===null?N3(t,null,i,c):my(t,e.child,i,c)}function RO(e,t,i,c,f){i=i.render;var _=t.ref;return W_(t,f),c=fk(e,t,i,c,_,f),i=pk(),e!==null&&!vl?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~f,qd(e,t,f)):(Bs&&i&&tk(t),t.flags|=1,qa(e,t,c,f),t.child)}function MO(e,t,i,c,f){if(e===null){var _=i.type;return typeof _=="function"&&!Tk(_)&&_.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(t.tag=15,t.type=_,aB(e,t,_,c,f)):(e=wS(i.type,null,c,t,t.mode,f),e.ref=t.ref,e.return=t,t.child=e)}if(_=e.child,!(e.lanes&f)){var x=_.memoizedProps;if(i=i.compare,i=i!==null?i:N0,i(x,c)&&e.ref===t.ref)return qd(e,t,f)}return t.flags|=1,e=If(_,c),e.ref=t.ref,e.return=t,t.child=e}function aB(e,t,i,c,f){if(e!==null){var _=e.memoizedProps;if(N0(_,c)&&e.ref===t.ref)if(vl=!1,t.pendingProps=c=_,(e.lanes&f)!==0)e.flags&131072&&(vl=!0);else return t.lanes=e.lanes,qd(e,t,f)}return fI(e,t,i,c,f)}function lB(e,t,i){var c=t.pendingProps,f=c.children,_=e!==null?e.memoizedState:null;if(c.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Is(B_,Nl),Nl|=i;else{if(!(i&1073741824))return e=_!==null?_.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Is(B_,Nl),Nl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},c=_!==null?_.baseLanes:i,Is(B_,Nl),Nl|=c}else _!==null?(c=_.baseLanes|i,t.memoizedState=null):c=i,Is(B_,Nl),Nl|=c;return qa(e,t,f,i),t.child}function cB(e,t){var i=t.ref;(e===null&&i!==null||e!==null&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function fI(e,t,i,c,f){var _=wl(i)?xm:Ta.current;return _=fy(t,_),W_(t,f),i=fk(e,t,i,c,_,f),c=pk(),e!==null&&!vl?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~f,qd(e,t,f)):(Bs&&c&&tk(t),t.flags|=1,qa(e,t,i,f),t.child)}function DO(e,t,i,c,f){if(wl(i)){var _=!0;US(t)}else _=!1;if(W_(t,f),t.stateNode===null)vS(e,t),iB(t,i,c),dI(t,i,c,f),c=!0;else if(e===null){var x=t.stateNode,o=t.memoizedProps;x.props=o;var I=x.context,P=i.contextType;typeof P=="object"&&P!==null?P=dc(P):(P=wl(i)?xm:Ta.current,P=fy(t,P));var N=i.getDerivedStateFromProps,U=typeof N=="function"||typeof x.getSnapshotBeforeUpdate=="function";U||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(o!==c||I!==P)&&IO(t,x,c,P),ef=!1;var $=t.memoizedState;x.state=$,HS(t,c,x,f),I=t.memoizedState,o!==c||$!==I||bl.current||ef?(typeof N=="function"&&(uI(t,i,N,c),I=t.memoizedState),(o=ef||AO(t,i,o,c,$,I,P))?(U||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(t.flags|=4194308)):(typeof x.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=c,t.memoizedState=I),x.props=c,x.state=I,x.context=P,c=o):(typeof x.componentDidMount=="function"&&(t.flags|=4194308),c=!1)}else{x=t.stateNode,L3(e,t),o=t.memoizedProps,P=t.type===t.elementType?o:Bc(t.type,o),x.props=P,U=t.pendingProps,$=x.context,I=i.contextType,typeof I=="object"&&I!==null?I=dc(I):(I=wl(i)?xm:Ta.current,I=fy(t,I));var B=i.getDerivedStateFromProps;(N=typeof B=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(o!==U||$!==I)&&IO(t,x,c,I),ef=!1,$=t.memoizedState,x.state=$,HS(t,c,x,f);var Y=t.memoizedState;o!==U||$!==Y||bl.current||ef?(typeof B=="function"&&(uI(t,i,B,c),Y=t.memoizedState),(P=ef||AO(t,i,P,c,$,Y,I)||!1)?(N||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(c,Y,I),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(c,Y,I)),typeof x.componentDidUpdate=="function"&&(t.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof x.componentDidUpdate!="function"||o===e.memoizedProps&&$===e.memoizedState||(t.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&$===e.memoizedState||(t.flags|=1024),t.memoizedProps=c,t.memoizedState=Y),x.props=c,x.state=Y,x.context=I,c=P):(typeof x.componentDidUpdate!="function"||o===e.memoizedProps&&$===e.memoizedState||(t.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&$===e.memoizedState||(t.flags|=1024),c=!1)}return pI(e,t,i,c,_,f)}function pI(e,t,i,c,f,_){cB(e,t);var x=(t.flags&128)!==0;if(!c&&!x)return f&&vO(t,i,!1),qd(e,t,_);c=t.stateNode,b9.current=t;var o=x&&typeof i.getDerivedStateFromError!="function"?null:c.render();return t.flags|=1,e!==null&&x?(t.child=my(t,e.child,null,_),t.child=my(t,null,o,_)):qa(e,t,o,_),t.memoizedState=c.state,f&&vO(t,i,!0),t.child}function uB(e){var t=e.stateNode;t.pendingContext?yO(e,t.pendingContext,t.pendingContext!==t.context):t.context&&yO(e,t.context,!1),ck(e,t.containerInfo)}function NO(e,t,i,c,f){return py(),nk(f),t.flags|=256,qa(e,t,i,c),t.child}var mI={dehydrated:null,treeContext:null,retryLane:0};function gI(e){return{baseLanes:e,cachePool:null,transitions:null}}function dB(e,t,i){var c=t.pendingProps,f=Ws.current,_=!1,x=(t.flags&128)!==0,o;if((o=x)||(o=e!==null&&e.memoizedState===null?!1:(f&2)!==0),o?(_=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(f|=1),Is(Ws,f&1),e===null)return lI(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(x=c.children,e=c.fallback,_?(c=t.mode,_=t.child,x={mode:"hidden",children:x},!(c&1)&&_!==null?(_.childLanes=0,_.pendingProps=x):_=UT(x,c,0,null),e=ym(e,c,i,null),_.return=t,e.return=t,_.sibling=e,t.child=_,t.child.memoizedState=gI(i),t.memoizedState=mI,e):_k(t,x));if(f=e.memoizedState,f!==null&&(o=f.dehydrated,o!==null))return w9(e,t,x,c,o,f,i);if(_){_=c.fallback,x=t.mode,f=e.child,o=f.sibling;var I={mode:"hidden",children:c.children};return!(x&1)&&t.child!==f?(c=t.child,c.childLanes=0,c.pendingProps=I,t.deletions=null):(c=If(f,I),c.subtreeFlags=f.subtreeFlags&14680064),o!==null?_=If(o,_):(_=ym(_,x,i,null),_.flags|=2),_.return=t,c.return=t,c.sibling=_,t.child=c,c=_,_=t.child,x=e.child.memoizedState,x=x===null?gI(i):{baseLanes:x.baseLanes|i,cachePool:null,transitions:x.transitions},_.memoizedState=x,_.childLanes=e.childLanes&~i,t.memoizedState=mI,c}return _=e.child,e=_.sibling,c=If(_,{mode:"visible",children:c.children}),!(t.mode&1)&&(c.lanes=i),c.return=t,c.sibling=null,e!==null&&(i=t.deletions,i===null?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=c,t.memoizedState=null,c}function _k(e,t){return t=UT({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Vw(e,t,i,c){return c!==null&&nk(c),my(t,e.child,null,i),e=_k(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function w9(e,t,i,c,f,_,x){if(i)return t.flags&256?(t.flags&=-257,c=XC(Error(xr(422))),Vw(e,t,x,c)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(_=c.fallback,f=t.mode,c=UT({mode:"visible",children:c.children},f,0,null),_=ym(_,f,x,null),_.flags|=2,c.return=t,_.return=t,c.sibling=_,t.child=c,t.mode&1&&my(t,e.child,null,x),t.child.memoizedState=gI(x),t.memoizedState=mI,_);if(!(t.mode&1))return Vw(e,t,x,null);if(f.data==="$!"){if(c=f.nextSibling&&f.nextSibling.dataset,c)var o=c.dgst;return c=o,_=Error(xr(419)),c=XC(_,c,void 0),Vw(e,t,x,c)}if(o=(x&e.childLanes)!==0,vl||o){if(c=Ko,c!==null){switch(x&-x){case 4:f=2;break;case 16:f=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:f=32;break;case 536870912:f=268435456;break;default:f=0}f=f&(c.suspendedLanes|x)?0:f,f!==0&&f!==_.retryLane&&(_.retryLane=f,$d(e,f),Yc(c,e,f,-1))}return Sk(),c=XC(Error(xr(421))),Vw(e,t,x,c)}return f.data==="$?"?(t.flags|=128,t.child=e.child,t=N9.bind(null,e),f._reactRetry=t,null):(e=_.treeContext,Bl=Tf(f.nextSibling),Vl=t,Bs=!0,Wc=null,e!==null&&(oc[ac++]=Rd,oc[ac++]=Md,oc[ac++]=bm,Rd=e.id,Md=e.overflow,bm=t),t=_k(t,c.children),t.flags|=4096,t)}function OO(e,t,i){e.lanes|=t;var c=e.alternate;c!==null&&(c.lanes|=t),cI(e.return,t,i)}function KC(e,t,i,c,f){var _=e.memoizedState;_===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:c,tail:i,tailMode:f}:(_.isBackwards=t,_.rendering=null,_.renderingStartTime=0,_.last=c,_.tail=i,_.tailMode=f)}function hB(e,t,i){var c=t.pendingProps,f=c.revealOrder,_=c.tail;if(qa(e,t,c.children,i),c=Ws.current,c&2)c=c&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&OO(e,i,t);else if(e.tag===19)OO(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}c&=1}if(Is(Ws,c),!(t.mode&1))t.memoizedState=null;else switch(f){case"forwards":for(i=t.child,f=null;i!==null;)e=i.alternate,e!==null&&ZS(e)===null&&(f=i),i=i.sibling;i=f,i===null?(f=t.child,t.child=null):(f=i.sibling,i.sibling=null),KC(t,!1,f,i,_);break;case"backwards":for(i=null,f=t.child,t.child=null;f!==null;){if(e=f.alternate,e!==null&&ZS(e)===null){t.child=f;break}e=f.sibling,f.sibling=i,i=f,f=e}KC(t,!0,i,null,_);break;case"together":KC(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function vS(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function qd(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),Sm|=t.lanes,!(i&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(xr(153));if(t.child!==null){for(e=t.child,i=If(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=If(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function S9(e,t,i){switch(t.tag){case 3:uB(t),py();break;case 5:z3(t);break;case 1:wl(t.type)&&US(t);break;case 4:ck(t,t.stateNode.containerInfo);break;case 10:var c=t.type._context,f=t.memoizedProps.value;Is(GS,c._currentValue),c._currentValue=f;break;case 13:if(c=t.memoizedState,c!==null)return c.dehydrated!==null?(Is(Ws,Ws.current&1),t.flags|=128,null):i&t.child.childLanes?dB(e,t,i):(Is(Ws,Ws.current&1),e=qd(e,t,i),e!==null?e.sibling:null);Is(Ws,Ws.current&1);break;case 19:if(c=(i&t.childLanes)!==0,e.flags&128){if(c)return hB(e,t,i);t.flags|=128}if(f=t.memoizedState,f!==null&&(f.rendering=null,f.tail=null,f.lastEffect=null),Is(Ws,Ws.current),c)break;return null;case 22:case 23:return t.lanes=0,lB(e,t,i)}return qd(e,t,i)}var fB,_I,pB,mB;fB=function(e,t){for(var i=t.child;i!==null;){if(i.tag===5||i.tag===6)e.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};_I=function(){};pB=function(e,t,i,c){var f=e.memoizedProps;if(f!==c){e=t.stateNode,sm(Uu.current);var _=null;switch(i){case"input":f=FA(e,f),c=FA(e,c),_=[];break;case"select":f=Ys({},f,{value:void 0}),c=Ys({},c,{value:void 0}),_=[];break;case"textarea":f=UA(e,f),c=UA(e,c),_=[];break;default:typeof f.onClick!="function"&&typeof c.onClick=="function"&&(e.onclick=BS)}qA(i,c);var x;i=null;for(P in f)if(!c.hasOwnProperty(P)&&f.hasOwnProperty(P)&&f[P]!=null)if(P==="style"){var o=f[P];for(x in o)o.hasOwnProperty(x)&&(i||(i={}),i[x]="")}else P!=="dangerouslySetInnerHTML"&&P!=="children"&&P!=="suppressContentEditableWarning"&&P!=="suppressHydrationWarning"&&P!=="autoFocus"&&(I0.hasOwnProperty(P)?_||(_=[]):(_=_||[]).push(P,null));for(P in c){var I=c[P];if(o=f!=null?f[P]:void 0,c.hasOwnProperty(P)&&I!==o&&(I!=null||o!=null))if(P==="style")if(o){for(x in o)!o.hasOwnProperty(x)||I&&I.hasOwnProperty(x)||(i||(i={}),i[x]="");for(x in I)I.hasOwnProperty(x)&&o[x]!==I[x]&&(i||(i={}),i[x]=I[x])}else i||(_||(_=[]),_.push(P,i)),i=I;else P==="dangerouslySetInnerHTML"?(I=I?I.__html:void 0,o=o?o.__html:void 0,I!=null&&o!==I&&(_=_||[]).push(P,I)):P==="children"?typeof I!="string"&&typeof I!="number"||(_=_||[]).push(P,""+I):P!=="suppressContentEditableWarning"&&P!=="suppressHydrationWarning"&&(I0.hasOwnProperty(P)?(I!=null&&P==="onScroll"&&Ds("scroll",e),_||o===I||(_=[])):(_=_||[]).push(P,I))}i&&(_=_||[]).push("style",i);var P=_;(t.updateQueue=P)&&(t.flags|=4)}};mB=function(e,t,i,c){i!==c&&(t.flags|=4)};function Qx(e,t){if(!Bs)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var c=null;i!==null;)i.alternate!==null&&(c=i),i=i.sibling;c===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:c.sibling=null}}function va(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,c=0;if(t)for(var f=e.child;f!==null;)i|=f.lanes|f.childLanes,c|=f.subtreeFlags&14680064,c|=f.flags&14680064,f.return=e,f=f.sibling;else for(f=e.child;f!==null;)i|=f.lanes|f.childLanes,c|=f.subtreeFlags,c|=f.flags,f.return=e,f=f.sibling;return e.subtreeFlags|=c,e.childLanes=i,t}function T9(e,t,i){var c=t.pendingProps;switch(rk(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return va(t),null;case 1:return wl(t.type)&&VS(),va(t),null;case 3:return c=t.stateNode,gy(),Ns(bl),Ns(Ta),dk(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(e===null||e.child===null)&&(Fw(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Wc!==null&&(EI(Wc),Wc=null))),_I(e,t),va(t),null;case 5:uk(t);var f=sm(B0.current);if(i=t.type,e!==null&&t.stateNode!=null)pB(e,t,i,c,f),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!c){if(t.stateNode===null)throw Error(xr(166));return va(t),null}if(e=sm(Uu.current),Fw(t)){c=t.stateNode,i=t.type;var _=t.memoizedProps;switch(c[Du]=t,c[z0]=_,e=(t.mode&1)!==0,i){case"dialog":Ds("cancel",c),Ds("close",c);break;case"iframe":case"object":case"embed":Ds("load",c);break;case"video":case"audio":for(f=0;f<l0.length;f++)Ds(l0[f],c);break;case"source":Ds("error",c);break;case"img":case"image":case"link":Ds("error",c),Ds("load",c);break;case"details":Ds("toggle",c);break;case"input":GN(c,_),Ds("invalid",c);break;case"select":c._wrapperState={wasMultiple:!!_.multiple},Ds("invalid",c);break;case"textarea":HN(c,_),Ds("invalid",c)}qA(i,_),f=null;for(var x in _)if(_.hasOwnProperty(x)){var o=_[x];x==="children"?typeof o=="string"?c.textContent!==o&&(_.suppressHydrationWarning!==!0&&zw(c.textContent,o,e),f=["children",o]):typeof o=="number"&&c.textContent!==""+o&&(_.suppressHydrationWarning!==!0&&zw(c.textContent,o,e),f=["children",""+o]):I0.hasOwnProperty(x)&&o!=null&&x==="onScroll"&&Ds("scroll",c)}switch(i){case"input":kw(c),WN(c,_,!0);break;case"textarea":kw(c),ZN(c);break;case"select":case"option":break;default:typeof _.onClick=="function"&&(c.onclick=BS)}c=f,t.updateQueue=c,c!==null&&(t.flags|=4)}else{x=f.nodeType===9?f:f.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=$F(i)),e==="http://www.w3.org/1999/xhtml"?i==="script"?(e=x.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof c.is=="string"?e=x.createElement(i,{is:c.is}):(e=x.createElement(i),i==="select"&&(x=e,c.multiple?x.multiple=!0:c.size&&(x.size=c.size))):e=x.createElementNS(e,i),e[Du]=t,e[z0]=c,fB(e,t,!1,!1),t.stateNode=e;e:{switch(x=GA(i,c),i){case"dialog":Ds("cancel",e),Ds("close",e),f=c;break;case"iframe":case"object":case"embed":Ds("load",e),f=c;break;case"video":case"audio":for(f=0;f<l0.length;f++)Ds(l0[f],e);f=c;break;case"source":Ds("error",e),f=c;break;case"img":case"image":case"link":Ds("error",e),Ds("load",e),f=c;break;case"details":Ds("toggle",e),f=c;break;case"input":GN(e,c),f=FA(e,c),Ds("invalid",e);break;case"option":f=c;break;case"select":e._wrapperState={wasMultiple:!!c.multiple},f=Ys({},c,{value:void 0}),Ds("invalid",e);break;case"textarea":HN(e,c),f=UA(e,c),Ds("invalid",e);break;default:f=c}qA(i,f),o=f;for(_ in o)if(o.hasOwnProperty(_)){var I=o[_];_==="style"?WF(e,I):_==="dangerouslySetInnerHTML"?(I=I?I.__html:void 0,I!=null&&qF(e,I)):_==="children"?typeof I=="string"?(i!=="textarea"||I!=="")&&P0(e,I):typeof I=="number"&&P0(e,""+I):_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&_!=="autoFocus"&&(I0.hasOwnProperty(_)?I!=null&&_==="onScroll"&&Ds("scroll",e):I!=null&&VP(e,_,I,x))}switch(i){case"input":kw(e),WN(e,c,!1);break;case"textarea":kw(e),ZN(e);break;case"option":c.value!=null&&e.setAttribute("value",""+Rf(c.value));break;case"select":e.multiple=!!c.multiple,_=c.value,_!=null?U_(e,!!c.multiple,_,!1):c.defaultValue!=null&&U_(e,!!c.multiple,c.defaultValue,!0);break;default:typeof f.onClick=="function"&&(e.onclick=BS)}switch(i){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}}c&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return va(t),null;case 6:if(e&&t.stateNode!=null)mB(e,t,e.memoizedProps,c);else{if(typeof c!="string"&&t.stateNode===null)throw Error(xr(166));if(i=sm(B0.current),sm(Uu.current),Fw(t)){if(c=t.stateNode,i=t.memoizedProps,c[Du]=t,(_=c.nodeValue!==i)&&(e=Vl,e!==null))switch(e.tag){case 3:zw(c.nodeValue,i,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&zw(c.nodeValue,i,(e.mode&1)!==0)}_&&(t.flags|=4)}else c=(i.nodeType===9?i:i.ownerDocument).createTextNode(c),c[Du]=t,t.stateNode=c}return va(t),null;case 13:if(Ns(Ws),c=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Bs&&Bl!==null&&t.mode&1&&!(t.flags&128))M3(),py(),t.flags|=98560,_=!1;else if(_=Fw(t),c!==null&&c.dehydrated!==null){if(e===null){if(!_)throw Error(xr(318));if(_=t.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(xr(317));_[Du]=t}else py(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;va(t),_=!1}else Wc!==null&&(EI(Wc),Wc=null),_=!0;if(!_)return t.flags&65536?t:null}return t.flags&128?(t.lanes=i,t):(c=c!==null,c!==(e!==null&&e.memoizedState!==null)&&c&&(t.child.flags|=8192,t.mode&1&&(e===null||Ws.current&1?Uo===0&&(Uo=3):Sk())),t.updateQueue!==null&&(t.flags|=4),va(t),null);case 4:return gy(),_I(e,t),e===null&&O0(t.stateNode.containerInfo),va(t),null;case 10:return ok(t.type._context),va(t),null;case 17:return wl(t.type)&&VS(),va(t),null;case 19:if(Ns(Ws),_=t.memoizedState,_===null)return va(t),null;if(c=(t.flags&128)!==0,x=_.rendering,x===null)if(c)Qx(_,!1);else{if(Uo!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(x=ZS(e),x!==null){for(t.flags|=128,Qx(_,!1),c=x.updateQueue,c!==null&&(t.updateQueue=c,t.flags|=4),t.subtreeFlags=0,c=i,i=t.child;i!==null;)_=i,e=c,_.flags&=14680066,x=_.alternate,x===null?(_.childLanes=0,_.lanes=e,_.child=null,_.subtreeFlags=0,_.memoizedProps=null,_.memoizedState=null,_.updateQueue=null,_.dependencies=null,_.stateNode=null):(_.childLanes=x.childLanes,_.lanes=x.lanes,_.child=x.child,_.subtreeFlags=0,_.deletions=null,_.memoizedProps=x.memoizedProps,_.memoizedState=x.memoizedState,_.updateQueue=x.updateQueue,_.type=x.type,e=x.dependencies,_.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return Is(Ws,Ws.current&1|2),t.child}e=e.sibling}_.tail!==null&&yo()>yy&&(t.flags|=128,c=!0,Qx(_,!1),t.lanes=4194304)}else{if(!c)if(e=ZS(x),e!==null){if(t.flags|=128,c=!0,i=e.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),Qx(_,!0),_.tail===null&&_.tailMode==="hidden"&&!x.alternate&&!Bs)return va(t),null}else 2*yo()-_.renderingStartTime>yy&&i!==1073741824&&(t.flags|=128,c=!0,Qx(_,!1),t.lanes=4194304);_.isBackwards?(x.sibling=t.child,t.child=x):(i=_.last,i!==null?i.sibling=x:t.child=x,_.last=x)}return _.tail!==null?(t=_.tail,_.rendering=t,_.tail=t.sibling,_.renderingStartTime=yo(),t.sibling=null,i=Ws.current,Is(Ws,c?i&1|2:i&1),t):(va(t),null);case 22:case 23:return wk(),c=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==c&&(t.flags|=8192),c&&t.mode&1?Nl&1073741824&&(va(t),t.subtreeFlags&6&&(t.flags|=8192)):va(t),null;case 24:return null;case 25:return null}throw Error(xr(156,t.tag))}function E9(e,t){switch(rk(t),t.tag){case 1:return wl(t.type)&&VS(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return gy(),Ns(bl),Ns(Ta),dk(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return uk(t),null;case 13:if(Ns(Ws),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(xr(340));py()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Ns(Ws),null;case 4:return gy(),null;case 10:return ok(t.type._context),null;case 22:case 23:return wk(),null;case 24:return null;default:return null}}var Uw=!1,wa=!1,C9=typeof WeakSet=="function"?WeakSet:Set,sn=null;function F_(e,t){var i=e.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(c){ho(e,t,c)}else i.current=null}function yI(e,t,i){try{i()}catch(c){ho(e,t,c)}}var LO=!1;function A9(e,t){if(tI=LS,e=x3(),ek(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var c=i.getSelection&&i.getSelection();if(c&&c.rangeCount!==0){i=c.anchorNode;var f=c.anchorOffset,_=c.focusNode;c=c.focusOffset;try{i.nodeType,_.nodeType}catch{i=null;break e}var x=0,o=-1,I=-1,P=0,N=0,U=e,$=null;t:for(;;){for(var B;U!==i||f!==0&&U.nodeType!==3||(o=x+f),U!==_||c!==0&&U.nodeType!==3||(I=x+c),U.nodeType===3&&(x+=U.nodeValue.length),(B=U.firstChild)!==null;)$=U,U=B;for(;;){if(U===e)break t;if($===i&&++P===f&&(o=x),$===_&&++N===c&&(I=x),(B=U.nextSibling)!==null)break;U=$,$=U.parentNode}U=B}i=o===-1||I===-1?null:{start:o,end:I}}else i=null}i=i||{start:0,end:0}}else i=null;for(rI={focusedElem:e,selectionRange:i},LS=!1,sn=t;sn!==null;)if(t=sn,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,sn=e;else for(;sn!==null;){t=sn;try{var Y=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(Y!==null){var H=Y.memoizedProps,K=Y.memoizedState,re=t.stateNode,G=re.getSnapshotBeforeUpdate(t.elementType===t.type?H:Bc(t.type,H),K);re.__reactInternalSnapshotBeforeUpdate=G}break;case 3:var X=t.stateNode.containerInfo;X.nodeType===1?X.textContent="":X.nodeType===9&&X.documentElement&&X.removeChild(X.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(xr(163))}}catch(ue){ho(t,t.return,ue)}if(e=t.sibling,e!==null){e.return=t.return,sn=e;break}sn=t.return}return Y=LO,LO=!1,Y}function v0(e,t,i){var c=t.updateQueue;if(c=c!==null?c.lastEffect:null,c!==null){var f=c=c.next;do{if((f.tag&e)===e){var _=f.destroy;f.destroy=void 0,_!==void 0&&yI(t,i,_)}f=f.next}while(f!==c)}}function BT(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var i=t=t.next;do{if((i.tag&e)===e){var c=i.create;i.destroy=c()}i=i.next}while(i!==t)}}function vI(e){var t=e.ref;if(t!==null){var i=e.stateNode;switch(e.tag){case 5:e=i;break;default:e=i}typeof t=="function"?t(e):t.current=e}}function gB(e){var t=e.alternate;t!==null&&(e.alternate=null,gB(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Du],delete t[z0],delete t[sI],delete t[c9],delete t[u9])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function _B(e){return e.tag===5||e.tag===3||e.tag===4}function zO(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||_B(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function xI(e,t,i){var c=e.tag;if(c===5||c===6)e=e.stateNode,t?i.nodeType===8?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(i.nodeType===8?(t=i.parentNode,t.insertBefore(e,i)):(t=i,t.appendChild(e)),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=BS));else if(c!==4&&(e=e.child,e!==null))for(xI(e,t,i),e=e.sibling;e!==null;)xI(e,t,i),e=e.sibling}function bI(e,t,i){var c=e.tag;if(c===5||c===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(c!==4&&(e=e.child,e!==null))for(bI(e,t,i),e=e.sibling;e!==null;)bI(e,t,i),e=e.sibling}var ia=null,qc=!1;function Wh(e,t,i){for(i=i.child;i!==null;)yB(e,t,i),i=i.sibling}function yB(e,t,i){if(Vu&&typeof Vu.onCommitFiberUnmount=="function")try{Vu.onCommitFiberUnmount(RT,i)}catch{}switch(i.tag){case 5:wa||F_(i,t);case 6:var c=ia,f=qc;ia=null,Wh(e,t,i),ia=c,qc=f,ia!==null&&(qc?(e=ia,i=i.stateNode,e.nodeType===8?e.parentNode.removeChild(i):e.removeChild(i)):ia.removeChild(i.stateNode));break;case 18:ia!==null&&(qc?(e=ia,i=i.stateNode,e.nodeType===8?$C(e.parentNode,i):e.nodeType===1&&$C(e,i),M0(e)):$C(ia,i.stateNode));break;case 4:c=ia,f=qc,ia=i.stateNode.containerInfo,qc=!0,Wh(e,t,i),ia=c,qc=f;break;case 0:case 11:case 14:case 15:if(!wa&&(c=i.updateQueue,c!==null&&(c=c.lastEffect,c!==null))){f=c=c.next;do{var _=f,x=_.destroy;_=_.tag,x!==void 0&&(_&2||_&4)&&yI(i,t,x),f=f.next}while(f!==c)}Wh(e,t,i);break;case 1:if(!wa&&(F_(i,t),c=i.stateNode,typeof c.componentWillUnmount=="function"))try{c.props=i.memoizedProps,c.state=i.memoizedState,c.componentWillUnmount()}catch(o){ho(i,t,o)}Wh(e,t,i);break;case 21:Wh(e,t,i);break;case 22:i.mode&1?(wa=(c=wa)||i.memoizedState!==null,Wh(e,t,i),wa=c):Wh(e,t,i);break;default:Wh(e,t,i)}}function FO(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var i=e.stateNode;i===null&&(i=e.stateNode=new C9),t.forEach(function(c){var f=O9.bind(null,e,c);i.has(c)||(i.add(c),c.then(f,f))})}}function Nc(e,t){var i=t.deletions;if(i!==null)for(var c=0;c<i.length;c++){var f=i[c];try{var _=e,x=t,o=x;e:for(;o!==null;){switch(o.tag){case 5:ia=o.stateNode,qc=!1;break e;case 3:ia=o.stateNode.containerInfo,qc=!0;break e;case 4:ia=o.stateNode.containerInfo,qc=!0;break e}o=o.return}if(ia===null)throw Error(xr(160));yB(_,x,f),ia=null,qc=!1;var I=f.alternate;I!==null&&(I.return=null),f.return=null}catch(P){ho(f,t,P)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)vB(t,e),t=t.sibling}function vB(e,t){var i=e.alternate,c=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Nc(t,e),Pu(e),c&4){try{v0(3,e,e.return),BT(3,e)}catch(H){ho(e,e.return,H)}try{v0(5,e,e.return)}catch(H){ho(e,e.return,H)}}break;case 1:Nc(t,e),Pu(e),c&512&&i!==null&&F_(i,i.return);break;case 5:if(Nc(t,e),Pu(e),c&512&&i!==null&&F_(i,i.return),e.flags&32){var f=e.stateNode;try{P0(f,"")}catch(H){ho(e,e.return,H)}}if(c&4&&(f=e.stateNode,f!=null)){var _=e.memoizedProps,x=i!==null?i.memoizedProps:_,o=e.type,I=e.updateQueue;if(e.updateQueue=null,I!==null)try{o==="input"&&_.type==="radio"&&_.name!=null&&VF(f,_),GA(o,x);var P=GA(o,_);for(x=0;x<I.length;x+=2){var N=I[x],U=I[x+1];N==="style"?WF(f,U):N==="dangerouslySetInnerHTML"?qF(f,U):N==="children"?P0(f,U):VP(f,N,U,P)}switch(o){case"input":BA(f,_);break;case"textarea":UF(f,_);break;case"select":var $=f._wrapperState.wasMultiple;f._wrapperState.wasMultiple=!!_.multiple;var B=_.value;B!=null?U_(f,!!_.multiple,B,!1):$!==!!_.multiple&&(_.defaultValue!=null?U_(f,!!_.multiple,_.defaultValue,!0):U_(f,!!_.multiple,_.multiple?[]:"",!1))}f[z0]=_}catch(H){ho(e,e.return,H)}}break;case 6:if(Nc(t,e),Pu(e),c&4){if(e.stateNode===null)throw Error(xr(162));f=e.stateNode,_=e.memoizedProps;try{f.nodeValue=_}catch(H){ho(e,e.return,H)}}break;case 3:if(Nc(t,e),Pu(e),c&4&&i!==null&&i.memoizedState.isDehydrated)try{M0(t.containerInfo)}catch(H){ho(e,e.return,H)}break;case 4:Nc(t,e),Pu(e);break;case 13:Nc(t,e),Pu(e),f=e.child,f.flags&8192&&(_=f.memoizedState!==null,f.stateNode.isHidden=_,!_||f.alternate!==null&&f.alternate.memoizedState!==null||(xk=yo())),c&4&&FO(e);break;case 22:if(N=i!==null&&i.memoizedState!==null,e.mode&1?(wa=(P=wa)||N,Nc(t,e),wa=P):Nc(t,e),Pu(e),c&8192){if(P=e.memoizedState!==null,(e.stateNode.isHidden=P)&&!N&&e.mode&1)for(sn=e,N=e.child;N!==null;){for(U=sn=N;sn!==null;){switch($=sn,B=$.child,$.tag){case 0:case 11:case 14:case 15:v0(4,$,$.return);break;case 1:F_($,$.return);var Y=$.stateNode;if(typeof Y.componentWillUnmount=="function"){c=$,i=$.return;try{t=c,Y.props=t.memoizedProps,Y.state=t.memoizedState,Y.componentWillUnmount()}catch(H){ho(c,i,H)}}break;case 5:F_($,$.return);break;case 22:if($.memoizedState!==null){VO(U);continue}}B!==null?(B.return=$,sn=B):VO(U)}N=N.sibling}e:for(N=null,U=e;;){if(U.tag===5){if(N===null){N=U;try{f=U.stateNode,P?(_=f.style,typeof _.setProperty=="function"?_.setProperty("display","none","important"):_.display="none"):(o=U.stateNode,I=U.memoizedProps.style,x=I!=null&&I.hasOwnProperty("display")?I.display:null,o.style.display=GF("display",x))}catch(H){ho(e,e.return,H)}}}else if(U.tag===6){if(N===null)try{U.stateNode.nodeValue=P?"":U.memoizedProps}catch(H){ho(e,e.return,H)}}else if((U.tag!==22&&U.tag!==23||U.memoizedState===null||U===e)&&U.child!==null){U.child.return=U,U=U.child;continue}if(U===e)break e;for(;U.sibling===null;){if(U.return===null||U.return===e)break e;N===U&&(N=null),U=U.return}N===U&&(N=null),U.sibling.return=U.return,U=U.sibling}}break;case 19:Nc(t,e),Pu(e),c&4&&FO(e);break;case 21:break;default:Nc(t,e),Pu(e)}}function Pu(e){var t=e.flags;if(t&2){try{e:{for(var i=e.return;i!==null;){if(_B(i)){var c=i;break e}i=i.return}throw Error(xr(160))}switch(c.tag){case 5:var f=c.stateNode;c.flags&32&&(P0(f,""),c.flags&=-33);var _=zO(e);bI(e,_,f);break;case 3:case 4:var x=c.stateNode.containerInfo,o=zO(e);xI(e,o,x);break;default:throw Error(xr(161))}}catch(I){ho(e,e.return,I)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function I9(e,t,i){sn=e,xB(e)}function xB(e,t,i){for(var c=(e.mode&1)!==0;sn!==null;){var f=sn,_=f.child;if(f.tag===22&&c){var x=f.memoizedState!==null||Uw;if(!x){var o=f.alternate,I=o!==null&&o.memoizedState!==null||wa;o=Uw;var P=wa;if(Uw=x,(wa=I)&&!P)for(sn=f;sn!==null;)x=sn,I=x.child,x.tag===22&&x.memoizedState!==null?UO(f):I!==null?(I.return=x,sn=I):UO(f);for(;_!==null;)sn=_,xB(_),_=_.sibling;sn=f,Uw=o,wa=P}BO(e)}else f.subtreeFlags&8772&&_!==null?(_.return=f,sn=_):BO(e)}}function BO(e){for(;sn!==null;){var t=sn;if(t.flags&8772){var i=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:wa||BT(5,t);break;case 1:var c=t.stateNode;if(t.flags&4&&!wa)if(i===null)c.componentDidMount();else{var f=t.elementType===t.type?i.memoizedProps:Bc(t.type,i.memoizedProps);c.componentDidUpdate(f,i.memoizedState,c.__reactInternalSnapshotBeforeUpdate)}var _=t.updateQueue;_!==null&&TO(t,_,c);break;case 3:var x=t.updateQueue;if(x!==null){if(i=null,t.child!==null)switch(t.child.tag){case 5:i=t.child.stateNode;break;case 1:i=t.child.stateNode}TO(t,x,i)}break;case 5:var o=t.stateNode;if(i===null&&t.flags&4){i=o;var I=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":I.autoFocus&&i.focus();break;case"img":I.src&&(i.src=I.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var P=t.alternate;if(P!==null){var N=P.memoizedState;if(N!==null){var U=N.dehydrated;U!==null&&M0(U)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(xr(163))}wa||t.flags&512&&vI(t)}catch($){ho(t,t.return,$)}}if(t===e){sn=null;break}if(i=t.sibling,i!==null){i.return=t.return,sn=i;break}sn=t.return}}function VO(e){for(;sn!==null;){var t=sn;if(t===e){sn=null;break}var i=t.sibling;if(i!==null){i.return=t.return,sn=i;break}sn=t.return}}function UO(e){for(;sn!==null;){var t=sn;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{BT(4,t)}catch(I){ho(t,i,I)}break;case 1:var c=t.stateNode;if(typeof c.componentDidMount=="function"){var f=t.return;try{c.componentDidMount()}catch(I){ho(t,f,I)}}var _=t.return;try{vI(t)}catch(I){ho(t,_,I)}break;case 5:var x=t.return;try{vI(t)}catch(I){ho(t,x,I)}}}catch(I){ho(t,t.return,I)}if(t===e){sn=null;break}var o=t.sibling;if(o!==null){o.return=t.return,sn=o;break}sn=t.return}}var P9=Math.ceil,YS=Zd.ReactCurrentDispatcher,yk=Zd.ReactCurrentOwner,uc=Zd.ReactCurrentBatchConfig,Ji=0,Ko=null,ko=null,aa=0,Nl=0,B_=Vf(0),Uo=0,q0=null,Sm=0,VT=0,vk=0,x0=null,yl=null,xk=0,yy=1/0,Cd=null,JS=!1,wI=null,Cf=null,$w=!1,_f=null,QS=0,b0=0,SI=null,xS=-1,bS=0;function Ka(){return Ji&6?yo():xS!==-1?xS:xS=yo()}function Af(e){return e.mode&1?Ji&2&&aa!==0?aa&-aa:h9.transition!==null?(bS===0&&(bS=i3()),bS):(e=ys,e!==0||(e=window.event,e=e===void 0?16:d3(e.type)),e):1}function Yc(e,t,i,c){if(50<b0)throw b0=0,SI=null,Error(xr(185));hb(e,i,c),(!(Ji&2)||e!==Ko)&&(e===Ko&&(!(Ji&2)&&(VT|=i),Uo===4&&nf(e,aa)),Sl(e,c),i===1&&Ji===0&&!(t.mode&1)&&(yy=yo()+500,LT&&Uf()))}function Sl(e,t){var i=e.callbackNode;hH(e,t);var c=OS(e,e===Ko?aa:0);if(c===0)i!==null&&YN(i),e.callbackNode=null,e.callbackPriority=0;else if(t=c&-c,e.callbackPriority!==t){if(i!=null&&YN(i),t===1)e.tag===0?d9($O.bind(null,e)):k3($O.bind(null,e)),a9(function(){!(Ji&6)&&Uf()}),i=null;else{switch(s3(c)){case 1:i=WP;break;case 4:i=r3;break;case 16:i=NS;break;case 536870912:i=n3;break;default:i=NS}i=IB(i,bB.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function bB(e,t){if(xS=-1,bS=0,Ji&6)throw Error(xr(327));var i=e.callbackNode;if(H_()&&e.callbackNode!==i)return null;var c=OS(e,e===Ko?aa:0);if(c===0)return null;if(c&30||c&e.expiredLanes||t)t=eT(e,c);else{t=c;var f=Ji;Ji|=2;var _=SB();(Ko!==e||aa!==t)&&(Cd=null,yy=yo()+500,_m(e,t));do try{R9();break}catch(o){wB(e,o)}while(!0);sk(),YS.current=_,Ji=f,ko!==null?t=0:(Ko=null,aa=0,t=Uo)}if(t!==0){if(t===2&&(f=KA(e),f!==0&&(c=f,t=TI(e,f))),t===1)throw i=q0,_m(e,0),nf(e,c),Sl(e,yo()),i;if(t===6)nf(e,c);else{if(f=e.current.alternate,!(c&30)&&!k9(f)&&(t=eT(e,c),t===2&&(_=KA(e),_!==0&&(c=_,t=TI(e,_))),t===1))throw i=q0,_m(e,0),nf(e,c),Sl(e,yo()),i;switch(e.finishedWork=f,e.finishedLanes=c,t){case 0:case 1:throw Error(xr(345));case 2:Jp(e,yl,Cd);break;case 3:if(nf(e,c),(c&130023424)===c&&(t=xk+500-yo(),10<t)){if(OS(e,0)!==0)break;if(f=e.suspendedLanes,(f&c)!==c){Ka(),e.pingedLanes|=e.suspendedLanes&f;break}e.timeoutHandle=iI(Jp.bind(null,e,yl,Cd),t);break}Jp(e,yl,Cd);break;case 4:if(nf(e,c),(c&4194240)===c)break;for(t=e.eventTimes,f=-1;0<c;){var x=31-Kc(c);_=1<<x,x=t[x],x>f&&(f=x),c&=~_}if(c=f,c=yo()-c,c=(120>c?120:480>c?480:1080>c?1080:1920>c?1920:3e3>c?3e3:4320>c?4320:1960*P9(c/1960))-c,10<c){e.timeoutHandle=iI(Jp.bind(null,e,yl,Cd),c);break}Jp(e,yl,Cd);break;case 5:Jp(e,yl,Cd);break;default:throw Error(xr(329))}}}return Sl(e,yo()),e.callbackNode===i?bB.bind(null,e):null}function TI(e,t){var i=x0;return e.current.memoizedState.isDehydrated&&(_m(e,t).flags|=256),e=eT(e,t),e!==2&&(t=yl,yl=i,t!==null&&EI(t)),e}function EI(e){yl===null?yl=e:yl.push.apply(yl,e)}function k9(e){for(var t=e;;){if(t.flags&16384){var i=t.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var c=0;c<i.length;c++){var f=i[c],_=f.getSnapshot;f=f.value;try{if(!Jc(_(),f))return!1}catch{return!1}}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function nf(e,t){for(t&=~vk,t&=~VT,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-Kc(t),c=1<<i;e[i]=-1,t&=~c}}function $O(e){if(Ji&6)throw Error(xr(327));H_();var t=OS(e,0);if(!(t&1))return Sl(e,yo()),null;var i=eT(e,t);if(e.tag!==0&&i===2){var c=KA(e);c!==0&&(t=c,i=TI(e,c))}if(i===1)throw i=q0,_m(e,0),nf(e,t),Sl(e,yo()),i;if(i===6)throw Error(xr(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Jp(e,yl,Cd),Sl(e,yo()),null}function bk(e,t){var i=Ji;Ji|=1;try{return e(t)}finally{Ji=i,Ji===0&&(yy=yo()+500,LT&&Uf())}}function Tm(e){_f!==null&&_f.tag===0&&!(Ji&6)&&H_();var t=Ji;Ji|=1;var i=uc.transition,c=ys;try{if(uc.transition=null,ys=1,e)return e()}finally{ys=c,uc.transition=i,Ji=t,!(Ji&6)&&Uf()}}function wk(){Nl=B_.current,Ns(B_)}function _m(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(i!==-1&&(e.timeoutHandle=-1,o9(i)),ko!==null)for(i=ko.return;i!==null;){var c=i;switch(rk(c),c.tag){case 1:c=c.type.childContextTypes,c!=null&&VS();break;case 3:gy(),Ns(bl),Ns(Ta),dk();break;case 5:uk(c);break;case 4:gy();break;case 13:Ns(Ws);break;case 19:Ns(Ws);break;case 10:ok(c.type._context);break;case 22:case 23:wk()}i=i.return}if(Ko=e,ko=e=If(e.current,null),aa=Nl=t,Uo=0,q0=null,vk=VT=Sm=0,yl=x0=null,im!==null){for(t=0;t<im.length;t++)if(i=im[t],c=i.interleaved,c!==null){i.interleaved=null;var f=c.next,_=i.pending;if(_!==null){var x=_.next;_.next=f,c.next=x}i.pending=c}im=null}return e}function wB(e,t){do{var i=ko;try{if(sk(),_S.current=KS,XS){for(var c=Xs.memoizedState;c!==null;){var f=c.queue;f!==null&&(f.pending=null),c=c.next}XS=!1}if(wm=0,Xo=Bo=Xs=null,y0=!1,V0=0,yk.current=null,i===null||i.return===null){Uo=1,q0=t,ko=null;break}e:{var _=e,x=i.return,o=i,I=t;if(t=aa,o.flags|=32768,I!==null&&typeof I=="object"&&typeof I.then=="function"){var P=I,N=o,U=N.tag;if(!(N.mode&1)&&(U===0||U===11||U===15)){var $=N.alternate;$?(N.updateQueue=$.updateQueue,N.memoizedState=$.memoizedState,N.lanes=$.lanes):(N.updateQueue=null,N.memoizedState=null)}var B=kO(x);if(B!==null){B.flags&=-257,jO(B,x,o,_,t),B.mode&1&&PO(_,P,t),t=B,I=P;var Y=t.updateQueue;if(Y===null){var H=new Set;H.add(I),t.updateQueue=H}else Y.add(I);break e}else{if(!(t&1)){PO(_,P,t),Sk();break e}I=Error(xr(426))}}else if(Bs&&o.mode&1){var K=kO(x);if(K!==null){!(K.flags&65536)&&(K.flags|=256),jO(K,x,o,_,t),nk(_y(I,o));break e}}_=I=_y(I,o),Uo!==4&&(Uo=2),x0===null?x0=[_]:x0.push(_),_=x;do{switch(_.tag){case 3:_.flags|=65536,t&=-t,_.lanes|=t;var re=sB(_,I,t);SO(_,re);break e;case 1:o=I;var G=_.type,X=_.stateNode;if(!(_.flags&128)&&(typeof G.getDerivedStateFromError=="function"||X!==null&&typeof X.componentDidCatch=="function"&&(Cf===null||!Cf.has(X)))){_.flags|=65536,t&=-t,_.lanes|=t;var ue=oB(_,o,t);SO(_,ue);break e}}_=_.return}while(_!==null)}EB(i)}catch(Ee){t=Ee,ko===i&&i!==null&&(ko=i=i.return);continue}break}while(!0)}function SB(){var e=YS.current;return YS.current=KS,e===null?KS:e}function Sk(){(Uo===0||Uo===3||Uo===2)&&(Uo=4),Ko===null||!(Sm&268435455)&&!(VT&268435455)||nf(Ko,aa)}function eT(e,t){var i=Ji;Ji|=2;var c=SB();(Ko!==e||aa!==t)&&(Cd=null,_m(e,t));do try{j9();break}catch(f){wB(e,f)}while(!0);if(sk(),Ji=i,YS.current=c,ko!==null)throw Error(xr(261));return Ko=null,aa=0,Uo}function j9(){for(;ko!==null;)TB(ko)}function R9(){for(;ko!==null&&!nH();)TB(ko)}function TB(e){var t=AB(e.alternate,e,Nl);e.memoizedProps=e.pendingProps,t===null?EB(e):ko=t,yk.current=null}function EB(e){var t=e;do{var i=t.alternate;if(e=t.return,t.flags&32768){if(i=E9(i,t),i!==null){i.flags&=32767,ko=i;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Uo=6,ko=null;return}}else if(i=T9(i,t,Nl),i!==null){ko=i;return}if(t=t.sibling,t!==null){ko=t;return}ko=t=e}while(t!==null);Uo===0&&(Uo=5)}function Jp(e,t,i){var c=ys,f=uc.transition;try{uc.transition=null,ys=1,M9(e,t,i,c)}finally{uc.transition=f,ys=c}return null}function M9(e,t,i,c){do H_();while(_f!==null);if(Ji&6)throw Error(xr(327));i=e.finishedWork;var f=e.finishedLanes;if(i===null)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(xr(177));e.callbackNode=null,e.callbackPriority=0;var _=i.lanes|i.childLanes;if(fH(e,_),e===Ko&&(ko=Ko=null,aa=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||$w||($w=!0,IB(NS,function(){return H_(),null})),_=(i.flags&15990)!==0,i.subtreeFlags&15990||_){_=uc.transition,uc.transition=null;var x=ys;ys=1;var o=Ji;Ji|=4,yk.current=null,A9(e,i),vB(i,e),QH(rI),LS=!!tI,rI=tI=null,e.current=i,I9(i),iH(),Ji=o,ys=x,uc.transition=_}else e.current=i;if($w&&($w=!1,_f=e,QS=f),_=e.pendingLanes,_===0&&(Cf=null),aH(i.stateNode),Sl(e,yo()),t!==null)for(c=e.onRecoverableError,i=0;i<t.length;i++)f=t[i],c(f.value,{componentStack:f.stack,digest:f.digest});if(JS)throw JS=!1,e=wI,wI=null,e;return QS&1&&e.tag!==0&&H_(),_=e.pendingLanes,_&1?e===SI?b0++:(b0=0,SI=e):b0=0,Uf(),null}function H_(){if(_f!==null){var e=s3(QS),t=uc.transition,i=ys;try{if(uc.transition=null,ys=16>e?16:e,_f===null)var c=!1;else{if(e=_f,_f=null,QS=0,Ji&6)throw Error(xr(331));var f=Ji;for(Ji|=4,sn=e.current;sn!==null;){var _=sn,x=_.child;if(sn.flags&16){var o=_.deletions;if(o!==null){for(var I=0;I<o.length;I++){var P=o[I];for(sn=P;sn!==null;){var N=sn;switch(N.tag){case 0:case 11:case 15:v0(8,N,_)}var U=N.child;if(U!==null)U.return=N,sn=U;else for(;sn!==null;){N=sn;var $=N.sibling,B=N.return;if(gB(N),N===P){sn=null;break}if($!==null){$.return=B,sn=$;break}sn=B}}}var Y=_.alternate;if(Y!==null){var H=Y.child;if(H!==null){Y.child=null;do{var K=H.sibling;H.sibling=null,H=K}while(H!==null)}}sn=_}}if(_.subtreeFlags&2064&&x!==null)x.return=_,sn=x;else e:for(;sn!==null;){if(_=sn,_.flags&2048)switch(_.tag){case 0:case 11:case 15:v0(9,_,_.return)}var re=_.sibling;if(re!==null){re.return=_.return,sn=re;break e}sn=_.return}}var G=e.current;for(sn=G;sn!==null;){x=sn;var X=x.child;if(x.subtreeFlags&2064&&X!==null)X.return=x,sn=X;else e:for(x=G;sn!==null;){if(o=sn,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:BT(9,o)}}catch(Ee){ho(o,o.return,Ee)}if(o===x){sn=null;break e}var ue=o.sibling;if(ue!==null){ue.return=o.return,sn=ue;break e}sn=o.return}}if(Ji=f,Uf(),Vu&&typeof Vu.onPostCommitFiberRoot=="function")try{Vu.onPostCommitFiberRoot(RT,e)}catch{}c=!0}return c}finally{ys=i,uc.transition=t}}return!1}function qO(e,t,i){t=_y(i,t),t=sB(e,t,1),e=Ef(e,t,1),t=Ka(),e!==null&&(hb(e,1,t),Sl(e,t))}function ho(e,t,i){if(e.tag===3)qO(e,e,i);else for(;t!==null;){if(t.tag===3){qO(t,e,i);break}else if(t.tag===1){var c=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(Cf===null||!Cf.has(c))){e=_y(i,e),e=oB(t,e,1),t=Ef(t,e,1),e=Ka(),t!==null&&(hb(t,1,e),Sl(t,e));break}}t=t.return}}function D9(e,t,i){var c=e.pingCache;c!==null&&c.delete(t),t=Ka(),e.pingedLanes|=e.suspendedLanes&i,Ko===e&&(aa&i)===i&&(Uo===4||Uo===3&&(aa&130023424)===aa&&500>yo()-xk?_m(e,0):vk|=i),Sl(e,t)}function CB(e,t){t===0&&(e.mode&1?(t=Mw,Mw<<=1,!(Mw&130023424)&&(Mw=4194304)):t=1);var i=Ka();e=$d(e,t),e!==null&&(hb(e,t,i),Sl(e,i))}function N9(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),CB(e,i)}function O9(e,t){var i=0;switch(e.tag){case 13:var c=e.stateNode,f=e.memoizedState;f!==null&&(i=f.retryLane);break;case 19:c=e.stateNode;break;default:throw Error(xr(314))}c!==null&&c.delete(t),CB(e,i)}var AB;AB=function(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps||bl.current)vl=!0;else{if(!(e.lanes&i)&&!(t.flags&128))return vl=!1,S9(e,t,i);vl=!!(e.flags&131072)}else vl=!1,Bs&&t.flags&1048576&&j3(t,qS,t.index);switch(t.lanes=0,t.tag){case 2:var c=t.type;vS(e,t),e=t.pendingProps;var f=fy(t,Ta.current);W_(t,i),f=fk(null,t,c,e,f,i);var _=pk();return t.flags|=1,typeof f=="object"&&f!==null&&typeof f.render=="function"&&f.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,wl(c)?(_=!0,US(t)):_=!1,t.memoizedState=f.state!==null&&f.state!==void 0?f.state:null,lk(t),f.updater=FT,t.stateNode=f,f._reactInternals=t,dI(t,c,e,i),t=pI(null,t,c,!0,_,i)):(t.tag=0,Bs&&_&&tk(t),qa(null,t,f,i),t=t.child),t;case 16:c=t.elementType;e:{switch(vS(e,t),e=t.pendingProps,f=c._init,c=f(c._payload),t.type=c,f=t.tag=z9(c),e=Bc(c,e),f){case 0:t=fI(null,t,c,e,i);break e;case 1:t=DO(null,t,c,e,i);break e;case 11:t=RO(null,t,c,e,i);break e;case 14:t=MO(null,t,c,Bc(c.type,e),i);break e}throw Error(xr(306,c,""))}return t;case 0:return c=t.type,f=t.pendingProps,f=t.elementType===c?f:Bc(c,f),fI(e,t,c,f,i);case 1:return c=t.type,f=t.pendingProps,f=t.elementType===c?f:Bc(c,f),DO(e,t,c,f,i);case 3:e:{if(uB(t),e===null)throw Error(xr(387));c=t.pendingProps,_=t.memoizedState,f=_.element,L3(e,t),HS(t,c,null,i);var x=t.memoizedState;if(c=x.element,_.isDehydrated)if(_={element:c,isDehydrated:!1,cache:x.cache,pendingSuspenseBoundaries:x.pendingSuspenseBoundaries,transitions:x.transitions},t.updateQueue.baseState=_,t.memoizedState=_,t.flags&256){f=_y(Error(xr(423)),t),t=NO(e,t,c,i,f);break e}else if(c!==f){f=_y(Error(xr(424)),t),t=NO(e,t,c,i,f);break e}else for(Bl=Tf(t.stateNode.containerInfo.firstChild),Vl=t,Bs=!0,Wc=null,i=N3(t,null,c,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(py(),c===f){t=qd(e,t,i);break e}qa(e,t,c,i)}t=t.child}return t;case 5:return z3(t),e===null&&lI(t),c=t.type,f=t.pendingProps,_=e!==null?e.memoizedProps:null,x=f.children,nI(c,f)?x=null:_!==null&&nI(c,_)&&(t.flags|=32),cB(e,t),qa(e,t,x,i),t.child;case 6:return e===null&&lI(t),null;case 13:return dB(e,t,i);case 4:return ck(t,t.stateNode.containerInfo),c=t.pendingProps,e===null?t.child=my(t,null,c,i):qa(e,t,c,i),t.child;case 11:return c=t.type,f=t.pendingProps,f=t.elementType===c?f:Bc(c,f),RO(e,t,c,f,i);case 7:return qa(e,t,t.pendingProps,i),t.child;case 8:return qa(e,t,t.pendingProps.children,i),t.child;case 12:return qa(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(c=t.type._context,f=t.pendingProps,_=t.memoizedProps,x=f.value,Is(GS,c._currentValue),c._currentValue=x,_!==null)if(Jc(_.value,x)){if(_.children===f.children&&!bl.current){t=qd(e,t,i);break e}}else for(_=t.child,_!==null&&(_.return=t);_!==null;){var o=_.dependencies;if(o!==null){x=_.child;for(var I=o.firstContext;I!==null;){if(I.context===c){if(_.tag===1){I=Od(-1,i&-i),I.tag=2;var P=_.updateQueue;if(P!==null){P=P.shared;var N=P.pending;N===null?I.next=I:(I.next=N.next,N.next=I),P.pending=I}}_.lanes|=i,I=_.alternate,I!==null&&(I.lanes|=i),cI(_.return,i,t),o.lanes|=i;break}I=I.next}}else if(_.tag===10)x=_.type===t.type?null:_.child;else if(_.tag===18){if(x=_.return,x===null)throw Error(xr(341));x.lanes|=i,o=x.alternate,o!==null&&(o.lanes|=i),cI(x,i,t),x=_.sibling}else x=_.child;if(x!==null)x.return=_;else for(x=_;x!==null;){if(x===t){x=null;break}if(_=x.sibling,_!==null){_.return=x.return,x=_;break}x=x.return}_=x}qa(e,t,f.children,i),t=t.child}return t;case 9:return f=t.type,c=t.pendingProps.children,W_(t,i),f=dc(f),c=c(f),t.flags|=1,qa(e,t,c,i),t.child;case 14:return c=t.type,f=Bc(c,t.pendingProps),f=Bc(c.type,f),MO(e,t,c,f,i);case 15:return aB(e,t,t.type,t.pendingProps,i);case 17:return c=t.type,f=t.pendingProps,f=t.elementType===c?f:Bc(c,f),vS(e,t),t.tag=1,wl(c)?(e=!0,US(t)):e=!1,W_(t,i),iB(t,c,f),dI(t,c,f,i),pI(null,t,c,!0,e,i);case 19:return hB(e,t,i);case 22:return lB(e,t,i)}throw Error(xr(156,t.tag))};function IB(e,t){return t3(e,t)}function L9(e,t,i,c){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function cc(e,t,i,c){return new L9(e,t,i,c)}function Tk(e){return e=e.prototype,!(!e||!e.isReactComponent)}function z9(e){if(typeof e=="function")return Tk(e)?1:0;if(e!=null){if(e=e.$$typeof,e===$P)return 11;if(e===qP)return 14}return 2}function If(e,t){var i=e.alternate;return i===null?(i=cc(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&14680064,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function wS(e,t,i,c,f,_){var x=2;if(c=e,typeof e=="function")Tk(e)&&(x=1);else if(typeof e=="string")x=5;else e:switch(e){case k_:return ym(i.children,f,_,t);case UP:x=8,f|=8;break;case NA:return e=cc(12,i,t,f|2),e.elementType=NA,e.lanes=_,e;case OA:return e=cc(13,i,t,f),e.elementType=OA,e.lanes=_,e;case LA:return e=cc(19,i,t,f),e.elementType=LA,e.lanes=_,e;case zF:return UT(i,f,_,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case OF:x=10;break e;case LF:x=9;break e;case $P:x=11;break e;case qP:x=14;break e;case Qh:x=16,c=null;break e}throw Error(xr(130,e==null?e:typeof e,""))}return t=cc(x,i,t,f),t.elementType=e,t.type=c,t.lanes=_,t}function ym(e,t,i,c){return e=cc(7,e,c,t),e.lanes=i,e}function UT(e,t,i,c){return e=cc(22,e,c,t),e.elementType=zF,e.lanes=i,e.stateNode={isHidden:!1},e}function YC(e,t,i){return e=cc(6,e,null,t),e.lanes=i,e}function JC(e,t,i){return t=cc(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function F9(e,t,i,c,f){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=RC(0),this.expirationTimes=RC(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=RC(0),this.identifierPrefix=c,this.onRecoverableError=f,this.mutableSourceEagerHydrationData=null}function Ek(e,t,i,c,f,_,x,o,I){return e=new F9(e,t,i,o,I),t===1?(t=1,_===!0&&(t|=8)):t=0,_=cc(3,null,null,t),e.current=_,_.stateNode=e,_.memoizedState={element:c,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},lk(_),e}function B9(e,t,i){var c=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:P_,key:c==null?null:""+c,children:e,containerInfo:t,implementation:i}}function PB(e){if(!e)return Mf;e=e._reactInternals;e:{if(Lm(e)!==e||e.tag!==1)throw Error(xr(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(wl(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(xr(171))}if(e.tag===1){var i=e.type;if(wl(i))return P3(e,i,t)}return t}function kB(e,t,i,c,f,_,x,o,I){return e=Ek(i,c,!0,e,f,_,x,o,I),e.context=PB(null),i=e.current,c=Ka(),f=Af(i),_=Od(c,f),_.callback=t??null,Ef(i,_,f),e.current.lanes=f,hb(e,f,c),Sl(e,c),e}function $T(e,t,i,c){var f=t.current,_=Ka(),x=Af(f);return i=PB(i),t.context===null?t.context=i:t.pendingContext=i,t=Od(_,x),t.payload={element:e},c=c===void 0?null:c,c!==null&&(t.callback=c),e=Ef(f,t,x),e!==null&&(Yc(e,f,x,_),gS(e,f,x)),x}function tT(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function GO(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function Ck(e,t){GO(e,t),(e=e.alternate)&&GO(e,t)}function V9(){return null}var jB=typeof reportError=="function"?reportError:function(e){console.error(e)};function Ak(e){this._internalRoot=e}qT.prototype.render=Ak.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(xr(409));$T(e,t,null,null)};qT.prototype.unmount=Ak.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Tm(function(){$T(null,e,null,null)}),t[Ud]=null}};function qT(e){this._internalRoot=e}qT.prototype.unstable_scheduleHydration=function(e){if(e){var t=l3();e={blockedOn:null,target:e,priority:t};for(var i=0;i<rf.length&&t!==0&&t<rf[i].priority;i++);rf.splice(i,0,e),i===0&&u3(e)}};function Ik(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function GT(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function WO(){}function U9(e,t,i,c,f){if(f){if(typeof c=="function"){var _=c;c=function(){var P=tT(x);_.call(P)}}var x=kB(t,c,e,0,null,!1,!1,"",WO);return e._reactRootContainer=x,e[Ud]=x.current,O0(e.nodeType===8?e.parentNode:e),Tm(),x}for(;f=e.lastChild;)e.removeChild(f);if(typeof c=="function"){var o=c;c=function(){var P=tT(I);o.call(P)}}var I=Ek(e,0,!1,null,null,!1,!1,"",WO);return e._reactRootContainer=I,e[Ud]=I.current,O0(e.nodeType===8?e.parentNode:e),Tm(function(){$T(t,I,i,c)}),I}function WT(e,t,i,c,f){var _=i._reactRootContainer;if(_){var x=_;if(typeof f=="function"){var o=f;f=function(){var I=tT(x);o.call(I)}}$T(t,x,e,f)}else x=U9(i,t,e,f,c);return tT(x)}o3=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=a0(t.pendingLanes);i!==0&&(HP(t,i|1),Sl(t,yo()),!(Ji&6)&&(yy=yo()+500,Uf()))}break;case 13:Tm(function(){var c=$d(e,1);if(c!==null){var f=Ka();Yc(c,e,1,f)}}),Ck(e,1)}};ZP=function(e){if(e.tag===13){var t=$d(e,134217728);if(t!==null){var i=Ka();Yc(t,e,134217728,i)}Ck(e,134217728)}};a3=function(e){if(e.tag===13){var t=Af(e),i=$d(e,t);if(i!==null){var c=Ka();Yc(i,e,t,c)}Ck(e,t)}};l3=function(){return ys};c3=function(e,t){var i=ys;try{return ys=e,t()}finally{ys=i}};HA=function(e,t,i){switch(t){case"input":if(BA(e,i),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var c=i[t];if(c!==e&&c.form===e.form){var f=OT(c);if(!f)throw Error(xr(90));BF(c),BA(c,f)}}}break;case"textarea":UF(e,i);break;case"select":t=i.value,t!=null&&U_(e,!!i.multiple,t,!1)}};XF=bk;KF=Tm;var $9={usingClientEntryPoint:!1,Events:[pb,D_,OT,HF,ZF,bk]},e0={findFiberByHostInstance:nm,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},q9={bundleType:e0.bundleType,version:e0.version,rendererPackageName:e0.rendererPackageName,rendererConfig:e0.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Zd.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=QF(e),e===null?null:e.stateNode},findFiberByHostInstance:e0.findFiberByHostInstance||V9,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var qw=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!qw.isDisabled&&qw.supportsFiber)try{RT=qw.inject(q9),Vu=qw}catch{}}Hl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$9;Hl.createPortal=function(e,t){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ik(t))throw Error(xr(200));return B9(e,t,null,i)};Hl.createRoot=function(e,t){if(!Ik(e))throw Error(xr(299));var i=!1,c="",f=jB;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(c=t.identifierPrefix),t.onRecoverableError!==void 0&&(f=t.onRecoverableError)),t=Ek(e,1,!1,null,null,i,!1,c,f),e[Ud]=t.current,O0(e.nodeType===8?e.parentNode:e),new Ak(t)};Hl.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(xr(188)):(e=Object.keys(e).join(","),Error(xr(268,e)));return e=QF(t),e=e===null?null:e.stateNode,e};Hl.flushSync=function(e){return Tm(e)};Hl.hydrate=function(e,t,i){if(!GT(t))throw Error(xr(200));return WT(null,e,t,!0,i)};Hl.hydrateRoot=function(e,t,i){if(!Ik(e))throw Error(xr(405));var c=i!=null&&i.hydratedSources||null,f=!1,_="",x=jB;if(i!=null&&(i.unstable_strictMode===!0&&(f=!0),i.identifierPrefix!==void 0&&(_=i.identifierPrefix),i.onRecoverableError!==void 0&&(x=i.onRecoverableError)),t=kB(t,null,e,1,i??null,f,!1,_,x),e[Ud]=t.current,O0(e),c)for(e=0;e<c.length;e++)i=c[e],f=i._getVersion,f=f(i._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[i,f]:t.mutableSourceEagerHydrationData.push(i,f);return new qT(t)};Hl.render=function(e,t,i){if(!GT(t))throw Error(xr(200));return WT(null,e,t,!1,i)};Hl.unmountComponentAtNode=function(e){if(!GT(e))throw Error(xr(40));return e._reactRootContainer?(Tm(function(){WT(null,null,e,!1,function(){e._reactRootContainer=null,e[Ud]=null})}),!0):!1};Hl.unstable_batchedUpdates=bk;Hl.unstable_renderSubtreeIntoContainer=function(e,t,i,c){if(!GT(i))throw Error(xr(200));if(e==null||e._reactInternals===void 0)throw Error(xr(38));return WT(e,t,i,!1,c)};Hl.version="18.3.1-next-f1338f8080-20240426";function RB(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(RB)}catch(e){console.error(e)}}RB(),RF.exports=Hl;var zm=RF.exports;const MB=MP(zm);var DB,HO=zm;DB=HO.createRoot,HO.hydrateRoot;const G9=1,W9=1e6;let QC=0;function H9(){return QC=(QC+1)%Number.MAX_SAFE_INTEGER,QC.toString()}const eA=new Map,ZO=e=>{if(eA.has(e))return;const t=setTimeout(()=>{eA.delete(e),w0({type:"REMOVE_TOAST",toastId:e})},W9);eA.set(e,t)},Z9=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,G9)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(i=>i.id===t.toast.id?{...i,...t.toast}:i)};case"DISMISS_TOAST":{const{toastId:i}=t;return i?ZO(i):e.toasts.forEach(c=>{ZO(c.id)}),{...e,toasts:e.toasts.map(c=>c.id===i||i===void 0?{...c,open:!1}:c)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(i=>i.id!==t.toastId)}}},SS=[];let TS={toasts:[]};function w0(e){TS=Z9(TS,e),SS.forEach(t=>{t(TS)})}function Hn({...e}){const t=H9(),i=f=>w0({type:"UPDATE_TOAST",toast:{...f,id:t}}),c=()=>w0({type:"DISMISS_TOAST",toastId:t});return w0({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:f=>{f||c()}}}),{id:t,dismiss:c,update:i}}function $f(){const[e,t]=V.useState(TS);return V.useEffect(()=>(SS.push(t),()=>{const i=SS.indexOf(t);i>-1&&SS.splice(i,1)}),[e]),{...e,toast:Hn,dismiss:i=>w0({type:"DISMISS_TOAST",toastId:i})}}function Un(e,t,{checkForDefaultPrevented:i=!0}={}){return function(f){if(e==null||e(f),i===!1||!f.defaultPrevented)return t==null?void 0:t(f)}}function XO(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function NB(...e){return t=>{let i=!1;const c=e.map(f=>{const _=XO(f,t);return!i&&typeof _=="function"&&(i=!0),_});if(i)return()=>{for(let f=0;f<c.length;f++){const _=c[f];typeof _=="function"?_():XO(e[f],null)}}}}function vs(...e){return V.useCallback(NB(...e),e)}function X9(e,t){const i=V.createContext(t),c=_=>{const{children:x,...o}=_,I=V.useMemo(()=>o,Object.values(o));return h.jsx(i.Provider,{value:I,children:x})};c.displayName=e+"Provider";function f(_){const x=V.useContext(i);if(x)return x;if(t!==void 0)return t;throw new Error(`\`${_}\` must be used within \`${e}\``)}return[c,f]}function Xd(e,t=[]){let i=[];function c(_,x){const o=V.createContext(x),I=i.length;i=[...i,x];const P=U=>{var re;const{scope:$,children:B,...Y}=U,H=((re=$==null?void 0:$[e])==null?void 0:re[I])||o,K=V.useMemo(()=>Y,Object.values(Y));return h.jsx(H.Provider,{value:K,children:B})};P.displayName=_+"Provider";function N(U,$){var H;const B=((H=$==null?void 0:$[e])==null?void 0:H[I])||o,Y=V.useContext(B);if(Y)return Y;if(x!==void 0)return x;throw new Error(`\`${U}\` must be used within \`${_}\``)}return[P,N]}const f=()=>{const _=i.map(x=>V.createContext(x));return function(o){const I=(o==null?void 0:o[e])||_;return V.useMemo(()=>({[`__scope${e}`]:{...o,[e]:I}}),[o,I])}};return f.scopeName=e,[c,K9(f,...t)]}function K9(...e){const t=e[0];if(e.length===1)return t;const i=()=>{const c=e.map(f=>({useScope:f(),scopeName:f.scopeName}));return function(_){const x=c.reduce((o,{useScope:I,scopeName:P})=>{const U=I(_)[`__scope${P}`];return{...o,...U}},{});return V.useMemo(()=>({[`__scope${t.scopeName}`]:x}),[x])}};return i.scopeName=t.scopeName,i}function vy(e){const t=Y9(e),i=V.forwardRef((c,f)=>{const{children:_,...x}=c,o=V.Children.toArray(_),I=o.find(J9);if(I){const P=I.props.children,N=o.map(U=>U===I?V.Children.count(P)>1?V.Children.only(null):V.isValidElement(P)?P.props.children:null:U);return h.jsx(t,{...x,ref:f,children:V.isValidElement(P)?V.cloneElement(P,void 0,N):null})}return h.jsx(t,{...x,ref:f,children:_})});return i.displayName=`${e}.Slot`,i}var Fm=vy("Slot");function Y9(e){const t=V.forwardRef((i,c)=>{const{children:f,..._}=i;if(V.isValidElement(f)){const x=e7(f),o=Q9(_,f.props);return f.type!==V.Fragment&&(o.ref=c?NB(c,x):x),V.cloneElement(f,o)}return V.Children.count(f)>1?V.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var OB=Symbol("radix.slottable");function LB(e){const t=({children:i})=>h.jsx(h.Fragment,{children:i});return t.displayName=`${e}.Slottable`,t.__radixId=OB,t}function J9(e){return V.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===OB}function Q9(e,t){const i={...t};for(const c in t){const f=e[c],_=t[c];/^on[A-Z]/.test(c)?f&&_?i[c]=(...o)=>{const I=_(...o);return f(...o),I}:f&&(i[c]=f):c==="style"?i[c]={...f,..._}:c==="className"&&(i[c]=[f,_].filter(Boolean).join(" "))}return{...e,...i}}function e7(e){var c,f;let t=(c=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:c.get,i=t&&"isReactWarning"in t&&t.isReactWarning;return i?e.ref:(t=(f=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:f.get,i=t&&"isReactWarning"in t&&t.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}function Pk(e){const t=e+"CollectionProvider",[i,c]=Xd(t),[f,_]=i(t,{collectionRef:{current:null},itemMap:new Map}),x=H=>{const{scope:K,children:re}=H,G=nr.useRef(null),X=nr.useRef(new Map).current;return h.jsx(f,{scope:K,itemMap:X,collectionRef:G,children:re})};x.displayName=t;const o=e+"CollectionSlot",I=vy(o),P=nr.forwardRef((H,K)=>{const{scope:re,children:G}=H,X=_(o,re),ue=vs(K,X.collectionRef);return h.jsx(I,{ref:ue,children:G})});P.displayName=o;const N=e+"CollectionItemSlot",U="data-radix-collection-item",$=vy(N),B=nr.forwardRef((H,K)=>{const{scope:re,children:G,...X}=H,ue=nr.useRef(null),Ee=vs(K,ue),xe=_(N,re);return nr.useEffect(()=>(xe.itemMap.set(ue,{ref:ue,...X}),()=>void xe.itemMap.delete(ue))),h.jsx($,{[U]:"",ref:Ee,children:G})});B.displayName=N;function Y(H){const K=_(e+"CollectionConsumer",H);return nr.useCallback(()=>{const G=K.collectionRef.current;if(!G)return[];const X=Array.from(G.querySelectorAll(`[${U}]`));return Array.from(K.itemMap.values()).sort((xe,Ne)=>X.indexOf(xe.ref.current)-X.indexOf(Ne.ref.current))},[K.collectionRef,K.itemMap])}return[{Provider:x,Slot:P,ItemSlot:B},Y,c]}var t7=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],xi=t7.reduce((e,t)=>{const i=vy(`Primitive.${t}`),c=V.forwardRef((f,_)=>{const{asChild:x,...o}=f,I=x?i:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),h.jsx(I,{...o,ref:_})});return c.displayName=`Primitive.${t}`,{...e,[t]:c}},{});function zB(e,t){e&&zm.flushSync(()=>e.dispatchEvent(t))}function fc(e){const t=V.useRef(e);return V.useEffect(()=>{t.current=e}),V.useMemo(()=>(...i)=>{var c;return(c=t.current)==null?void 0:c.call(t,...i)},[])}function r7(e,t=globalThis==null?void 0:globalThis.document){const i=fc(e);V.useEffect(()=>{const c=f=>{f.key==="Escape"&&i(f)};return t.addEventListener("keydown",c,{capture:!0}),()=>t.removeEventListener("keydown",c,{capture:!0})},[i,t])}var n7="DismissableLayer",CI="dismissableLayer.update",i7="dismissableLayer.pointerDownOutside",s7="dismissableLayer.focusOutside",KO,FB=V.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),gb=V.forwardRef((e,t)=>{const{disableOutsidePointerEvents:i=!1,onEscapeKeyDown:c,onPointerDownOutside:f,onFocusOutside:_,onInteractOutside:x,onDismiss:o,...I}=e,P=V.useContext(FB),[N,U]=V.useState(null),$=(N==null?void 0:N.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,B]=V.useState({}),Y=vs(t,Ne=>U(Ne)),H=Array.from(P.layers),[K]=[...P.layersWithOutsidePointerEventsDisabled].slice(-1),re=H.indexOf(K),G=N?H.indexOf(N):-1,X=P.layersWithOutsidePointerEventsDisabled.size>0,ue=G>=re,Ee=a7(Ne=>{const lt=Ne.target,Pt=[...P.branches].some(tt=>tt.contains(lt));!ue||Pt||(f==null||f(Ne),x==null||x(Ne),Ne.defaultPrevented||o==null||o())},$),xe=l7(Ne=>{const lt=Ne.target;[...P.branches].some(tt=>tt.contains(lt))||(_==null||_(Ne),x==null||x(Ne),Ne.defaultPrevented||o==null||o())},$);return r7(Ne=>{G===P.layers.size-1&&(c==null||c(Ne),!Ne.defaultPrevented&&o&&(Ne.preventDefault(),o()))},$),V.useEffect(()=>{if(N)return i&&(P.layersWithOutsidePointerEventsDisabled.size===0&&(KO=$.body.style.pointerEvents,$.body.style.pointerEvents="none"),P.layersWithOutsidePointerEventsDisabled.add(N)),P.layers.add(N),YO(),()=>{i&&P.layersWithOutsidePointerEventsDisabled.size===1&&($.body.style.pointerEvents=KO)}},[N,$,i,P]),V.useEffect(()=>()=>{N&&(P.layers.delete(N),P.layersWithOutsidePointerEventsDisabled.delete(N),YO())},[N,P]),V.useEffect(()=>{const Ne=()=>B({});return document.addEventListener(CI,Ne),()=>document.removeEventListener(CI,Ne)},[]),h.jsx(xi.div,{...I,ref:Y,style:{pointerEvents:X?ue?"auto":"none":void 0,...e.style},onFocusCapture:Un(e.onFocusCapture,xe.onFocusCapture),onBlurCapture:Un(e.onBlurCapture,xe.onBlurCapture),onPointerDownCapture:Un(e.onPointerDownCapture,Ee.onPointerDownCapture)})});gb.displayName=n7;var o7="DismissableLayerBranch",BB=V.forwardRef((e,t)=>{const i=V.useContext(FB),c=V.useRef(null),f=vs(t,c);return V.useEffect(()=>{const _=c.current;if(_)return i.branches.add(_),()=>{i.branches.delete(_)}},[i.branches]),h.jsx(xi.div,{...e,ref:f})});BB.displayName=o7;function a7(e,t=globalThis==null?void 0:globalThis.document){const i=fc(e),c=V.useRef(!1),f=V.useRef(()=>{});return V.useEffect(()=>{const _=o=>{if(o.target&&!c.current){let I=function(){VB(i7,i,P,{discrete:!0})};const P={originalEvent:o};o.pointerType==="touch"?(t.removeEventListener("click",f.current),f.current=I,t.addEventListener("click",f.current,{once:!0})):I()}else t.removeEventListener("click",f.current);c.current=!1},x=window.setTimeout(()=>{t.addEventListener("pointerdown",_)},0);return()=>{window.clearTimeout(x),t.removeEventListener("pointerdown",_),t.removeEventListener("click",f.current)}},[t,i]),{onPointerDownCapture:()=>c.current=!0}}function l7(e,t=globalThis==null?void 0:globalThis.document){const i=fc(e),c=V.useRef(!1);return V.useEffect(()=>{const f=_=>{_.target&&!c.current&&VB(s7,i,{originalEvent:_},{discrete:!1})};return t.addEventListener("focusin",f),()=>t.removeEventListener("focusin",f)},[t,i]),{onFocusCapture:()=>c.current=!0,onBlurCapture:()=>c.current=!1}}function YO(){const e=new CustomEvent(CI);document.dispatchEvent(e)}function VB(e,t,i,{discrete:c}){const f=i.originalEvent.target,_=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:i});t&&f.addEventListener(e,t,{once:!0}),c?zB(f,_):f.dispatchEvent(_)}var c7=gb,u7=BB,ca=globalThis!=null&&globalThis.document?V.useLayoutEffect:()=>{},d7="Portal",HT=V.forwardRef((e,t)=>{var o;const{container:i,...c}=e,[f,_]=V.useState(!1);ca(()=>_(!0),[]);const x=i||f&&((o=globalThis==null?void 0:globalThis.document)==null?void 0:o.body);return x?MB.createPortal(h.jsx(xi.div,{...c,ref:t}),x):null});HT.displayName=d7;function h7(e,t){return V.useReducer((i,c)=>t[i][c]??i,e)}var Bm=e=>{const{present:t,children:i}=e,c=f7(t),f=typeof i=="function"?i({present:c.isPresent}):V.Children.only(i),_=vs(c.ref,p7(f));return typeof i=="function"||c.isPresent?V.cloneElement(f,{ref:_}):null};Bm.displayName="Presence";function f7(e){const[t,i]=V.useState(),c=V.useRef(null),f=V.useRef(e),_=V.useRef("none"),x=e?"mounted":"unmounted",[o,I]=h7(x,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return V.useEffect(()=>{const P=Gw(c.current);_.current=o==="mounted"?P:"none"},[o]),ca(()=>{const P=c.current,N=f.current;if(N!==e){const $=_.current,B=Gw(P);e?I("MOUNT"):B==="none"||(P==null?void 0:P.display)==="none"?I("UNMOUNT"):I(N&&$!==B?"ANIMATION_OUT":"UNMOUNT"),f.current=e}},[e,I]),ca(()=>{if(t){let P;const N=t.ownerDocument.defaultView??window,U=B=>{const H=Gw(c.current).includes(B.animationName);if(B.target===t&&H&&(I("ANIMATION_END"),!f.current)){const K=t.style.animationFillMode;t.style.animationFillMode="forwards",P=N.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=K)})}},$=B=>{B.target===t&&(_.current=Gw(c.current))};return t.addEventListener("animationstart",$),t.addEventListener("animationcancel",U),t.addEventListener("animationend",U),()=>{N.clearTimeout(P),t.removeEventListener("animationstart",$),t.removeEventListener("animationcancel",U),t.removeEventListener("animationend",U)}}else I("ANIMATION_END")},[t,I]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:V.useCallback(P=>{c.current=P?getComputedStyle(P):null,i(P)},[])}}function Gw(e){return(e==null?void 0:e.animationName)||"none"}function p7(e){var c,f;let t=(c=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:c.get,i=t&&"isReactWarning"in t&&t.isReactWarning;return i?e.ref:(t=(f=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:f.get,i=t&&"isReactWarning"in t&&t.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}var m7=zP[" useInsertionEffect ".trim().toString()]||ca;function Em({prop:e,defaultProp:t,onChange:i=()=>{},caller:c}){const[f,_,x]=g7({defaultProp:t,onChange:i}),o=e!==void 0,I=o?e:f;{const N=V.useRef(e!==void 0);V.useEffect(()=>{const U=N.current;U!==o&&console.warn(`${c} is changing from ${U?"controlled":"uncontrolled"} to ${o?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),N.current=o},[o,c])}const P=V.useCallback(N=>{var U;if(o){const $=_7(N)?N(e):N;$!==e&&((U=x.current)==null||U.call(x,$))}else _(N)},[o,e,_,x]);return[I,P]}function g7({defaultProp:e,onChange:t}){const[i,c]=V.useState(e),f=V.useRef(i),_=V.useRef(t);return m7(()=>{_.current=t},[t]),V.useEffect(()=>{var x;f.current!==i&&((x=_.current)==null||x.call(_,i),f.current=i)},[i,f]),[i,c,_]}function _7(e){return typeof e=="function"}var UB=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),y7="VisuallyHidden",ZT=V.forwardRef((e,t)=>h.jsx(xi.span,{...e,ref:t,style:{...UB,...e.style}}));ZT.displayName=y7;var v7=ZT,kk="ToastProvider",[jk,x7,b7]=Pk("Toast"),[$B,Ace]=Xd("Toast",[b7]),[w7,XT]=$B(kk),qB=e=>{const{__scopeToast:t,label:i="Notification",duration:c=5e3,swipeDirection:f="right",swipeThreshold:_=50,children:x}=e,[o,I]=V.useState(null),[P,N]=V.useState(0),U=V.useRef(!1),$=V.useRef(!1);return i.trim()||console.error(`Invalid prop \`label\` supplied to \`${kk}\`. Expected non-empty \`string\`.`),h.jsx(jk.Provider,{scope:t,children:h.jsx(w7,{scope:t,label:i,duration:c,swipeDirection:f,swipeThreshold:_,toastCount:P,viewport:o,onViewportChange:I,onToastAdd:V.useCallback(()=>N(B=>B+1),[]),onToastRemove:V.useCallback(()=>N(B=>B-1),[]),isFocusedToastEscapeKeyDownRef:U,isClosePausedRef:$,children:x})})};qB.displayName=kk;var GB="ToastViewport",S7=["F8"],AI="toast.viewportPause",II="toast.viewportResume",WB=V.forwardRef((e,t)=>{const{__scopeToast:i,hotkey:c=S7,label:f="Notifications ({hotkey})",..._}=e,x=XT(GB,i),o=x7(i),I=V.useRef(null),P=V.useRef(null),N=V.useRef(null),U=V.useRef(null),$=vs(t,U,x.onViewportChange),B=c.join("+").replace(/Key/g,"").replace(/Digit/g,""),Y=x.toastCount>0;V.useEffect(()=>{const K=re=>{var X;c.length!==0&&c.every(ue=>re[ue]||re.code===ue)&&((X=U.current)==null||X.focus())};return document.addEventListener("keydown",K),()=>document.removeEventListener("keydown",K)},[c]),V.useEffect(()=>{const K=I.current,re=U.current;if(Y&&K&&re){const G=()=>{if(!x.isClosePausedRef.current){const xe=new CustomEvent(AI);re.dispatchEvent(xe),x.isClosePausedRef.current=!0}},X=()=>{if(x.isClosePausedRef.current){const xe=new CustomEvent(II);re.dispatchEvent(xe),x.isClosePausedRef.current=!1}},ue=xe=>{!K.contains(xe.relatedTarget)&&X()},Ee=()=>{K.contains(document.activeElement)||X()};return K.addEventListener("focusin",G),K.addEventListener("focusout",ue),K.addEventListener("pointermove",G),K.addEventListener("pointerleave",Ee),window.addEventListener("blur",G),window.addEventListener("focus",X),()=>{K.removeEventListener("focusin",G),K.removeEventListener("focusout",ue),K.removeEventListener("pointermove",G),K.removeEventListener("pointerleave",Ee),window.removeEventListener("blur",G),window.removeEventListener("focus",X)}}},[Y,x.isClosePausedRef]);const H=V.useCallback(({tabbingDirection:K})=>{const G=o().map(X=>{const ue=X.ref.current,Ee=[ue,...O7(ue)];return K==="forwards"?Ee:Ee.reverse()});return(K==="forwards"?G.reverse():G).flat()},[o]);return V.useEffect(()=>{const K=U.current;if(K){const re=G=>{var Ee,xe,Ne;const X=G.altKey||G.ctrlKey||G.metaKey;if(G.key==="Tab"&&!X){const lt=document.activeElement,Pt=G.shiftKey;if(G.target===K&&Pt){(Ee=P.current)==null||Ee.focus();return}const Me=H({tabbingDirection:Pt?"backwards":"forwards"}),be=Me.findIndex(je=>je===lt);tA(Me.slice(be+1))?G.preventDefault():Pt?(xe=P.current)==null||xe.focus():(Ne=N.current)==null||Ne.focus()}};return K.addEventListener("keydown",re),()=>K.removeEventListener("keydown",re)}},[o,H]),h.jsxs(u7,{ref:I,role:"region","aria-label":f.replace("{hotkey}",B),tabIndex:-1,style:{pointerEvents:Y?void 0:"none"},children:[Y&&h.jsx(PI,{ref:P,onFocusFromOutsideViewport:()=>{const K=H({tabbingDirection:"forwards"});tA(K)}}),h.jsx(jk.Slot,{scope:i,children:h.jsx(xi.ol,{tabIndex:-1,..._,ref:$})}),Y&&h.jsx(PI,{ref:N,onFocusFromOutsideViewport:()=>{const K=H({tabbingDirection:"backwards"});tA(K)}})]})});WB.displayName=GB;var HB="ToastFocusProxy",PI=V.forwardRef((e,t)=>{const{__scopeToast:i,onFocusFromOutsideViewport:c,...f}=e,_=XT(HB,i);return h.jsx(ZT,{"aria-hidden":!0,tabIndex:0,...f,ref:t,style:{position:"fixed"},onFocus:x=>{var P;const o=x.relatedTarget;!((P=_.viewport)!=null&&P.contains(o))&&c()}})});PI.displayName=HB;var _b="Toast",T7="toast.swipeStart",E7="toast.swipeMove",C7="toast.swipeCancel",A7="toast.swipeEnd",ZB=V.forwardRef((e,t)=>{const{forceMount:i,open:c,defaultOpen:f,onOpenChange:_,...x}=e,[o,I]=Em({prop:c,defaultProp:f??!0,onChange:_,caller:_b});return h.jsx(Bm,{present:i||o,children:h.jsx(k7,{open:o,...x,ref:t,onClose:()=>I(!1),onPause:fc(e.onPause),onResume:fc(e.onResume),onSwipeStart:Un(e.onSwipeStart,P=>{P.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Un(e.onSwipeMove,P=>{const{x:N,y:U}=P.detail.delta;P.currentTarget.setAttribute("data-swipe","move"),P.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${N}px`),P.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${U}px`)}),onSwipeCancel:Un(e.onSwipeCancel,P=>{P.currentTarget.setAttribute("data-swipe","cancel"),P.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),P.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),P.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),P.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Un(e.onSwipeEnd,P=>{const{x:N,y:U}=P.detail.delta;P.currentTarget.setAttribute("data-swipe","end"),P.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),P.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),P.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${N}px`),P.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${U}px`),I(!1)})})})});ZB.displayName=_b;var[I7,P7]=$B(_b,{onClose(){}}),k7=V.forwardRef((e,t)=>{const{__scopeToast:i,type:c="foreground",duration:f,open:_,onClose:x,onEscapeKeyDown:o,onPause:I,onResume:P,onSwipeStart:N,onSwipeMove:U,onSwipeCancel:$,onSwipeEnd:B,...Y}=e,H=XT(_b,i),[K,re]=V.useState(null),G=vs(t,je=>re(je)),X=V.useRef(null),ue=V.useRef(null),Ee=f||H.duration,xe=V.useRef(0),Ne=V.useRef(Ee),lt=V.useRef(0),{onToastAdd:Pt,onToastRemove:tt}=H,yt=fc(()=>{var Ye;(K==null?void 0:K.contains(document.activeElement))&&((Ye=H.viewport)==null||Ye.focus()),x()}),Me=V.useCallback(je=>{!je||je===1/0||(window.clearTimeout(lt.current),xe.current=new Date().getTime(),lt.current=window.setTimeout(yt,je))},[yt]);V.useEffect(()=>{const je=H.viewport;if(je){const Ye=()=>{Me(Ne.current),P==null||P()},qe=()=>{const We=new Date().getTime()-xe.current;Ne.current=Ne.current-We,window.clearTimeout(lt.current),I==null||I()};return je.addEventListener(AI,qe),je.addEventListener(II,Ye),()=>{je.removeEventListener(AI,qe),je.removeEventListener(II,Ye)}}},[H.viewport,Ee,I,P,Me]),V.useEffect(()=>{_&&!H.isClosePausedRef.current&&Me(Ee)},[_,Ee,H.isClosePausedRef,Me]),V.useEffect(()=>(Pt(),()=>tt()),[Pt,tt]);const be=V.useMemo(()=>K?t4(K):null,[K]);return H.viewport?h.jsxs(h.Fragment,{children:[be&&h.jsx(j7,{__scopeToast:i,role:"status","aria-live":c==="foreground"?"assertive":"polite","aria-atomic":!0,children:be}),h.jsx(I7,{scope:i,onClose:yt,children:zm.createPortal(h.jsx(jk.ItemSlot,{scope:i,children:h.jsx(c7,{asChild:!0,onEscapeKeyDown:Un(o,()=>{H.isFocusedToastEscapeKeyDownRef.current||yt(),H.isFocusedToastEscapeKeyDownRef.current=!1}),children:h.jsx(xi.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":_?"open":"closed","data-swipe-direction":H.swipeDirection,...Y,ref:G,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:Un(e.onKeyDown,je=>{je.key==="Escape"&&(o==null||o(je.nativeEvent),je.nativeEvent.defaultPrevented||(H.isFocusedToastEscapeKeyDownRef.current=!0,yt()))}),onPointerDown:Un(e.onPointerDown,je=>{je.button===0&&(X.current={x:je.clientX,y:je.clientY})}),onPointerMove:Un(e.onPointerMove,je=>{if(!X.current)return;const Ye=je.clientX-X.current.x,qe=je.clientY-X.current.y,We=!!ue.current,$e=["left","right"].includes(H.swipeDirection),_t=["left","up"].includes(H.swipeDirection)?Math.min:Math.max,mt=$e?_t(0,Ye):0,rt=$e?0:_t(0,qe),Tt=je.pointerType==="touch"?10:2,Vt={x:mt,y:rt},it={originalEvent:je,delta:Vt};We?(ue.current=Vt,Ww(E7,U,it,{discrete:!1})):JO(Vt,H.swipeDirection,Tt)?(ue.current=Vt,Ww(T7,N,it,{discrete:!1}),je.target.setPointerCapture(je.pointerId)):(Math.abs(Ye)>Tt||Math.abs(qe)>Tt)&&(X.current=null)}),onPointerUp:Un(e.onPointerUp,je=>{const Ye=ue.current,qe=je.target;if(qe.hasPointerCapture(je.pointerId)&&qe.releasePointerCapture(je.pointerId),ue.current=null,X.current=null,Ye){const We=je.currentTarget,$e={originalEvent:je,delta:Ye};JO(Ye,H.swipeDirection,H.swipeThreshold)?Ww(A7,B,$e,{discrete:!0}):Ww(C7,$,$e,{discrete:!0}),We.addEventListener("click",_t=>_t.preventDefault(),{once:!0})}})})})}),H.viewport)})]}):null}),j7=e=>{const{__scopeToast:t,children:i,...c}=e,f=XT(_b,t),[_,x]=V.useState(!1),[o,I]=V.useState(!1);return D7(()=>x(!0)),V.useEffect(()=>{const P=window.setTimeout(()=>I(!0),1e3);return()=>window.clearTimeout(P)},[]),o?null:h.jsx(HT,{asChild:!0,children:h.jsx(ZT,{...c,children:_&&h.jsxs(h.Fragment,{children:[f.label," ",i]})})})},R7="ToastTitle",XB=V.forwardRef((e,t)=>{const{__scopeToast:i,...c}=e;return h.jsx(xi.div,{...c,ref:t})});XB.displayName=R7;var M7="ToastDescription",KB=V.forwardRef((e,t)=>{const{__scopeToast:i,...c}=e;return h.jsx(xi.div,{...c,ref:t})});KB.displayName=M7;var YB="ToastAction",JB=V.forwardRef((e,t)=>{const{altText:i,...c}=e;return i.trim()?h.jsx(e4,{altText:i,asChild:!0,children:h.jsx(Rk,{...c,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${YB}\`. Expected non-empty \`string\`.`),null)});JB.displayName=YB;var QB="ToastClose",Rk=V.forwardRef((e,t)=>{const{__scopeToast:i,...c}=e,f=P7(QB,i);return h.jsx(e4,{asChild:!0,children:h.jsx(xi.button,{type:"button",...c,ref:t,onClick:Un(e.onClick,f.onClose)})})});Rk.displayName=QB;var e4=V.forwardRef((e,t)=>{const{__scopeToast:i,altText:c,...f}=e;return h.jsx(xi.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":c||void 0,...f,ref:t})});function t4(e){const t=[];return Array.from(e.childNodes).forEach(c=>{if(c.nodeType===c.TEXT_NODE&&c.textContent&&t.push(c.textContent),N7(c)){const f=c.ariaHidden||c.hidden||c.style.display==="none",_=c.dataset.radixToastAnnounceExclude==="";if(!f)if(_){const x=c.dataset.radixToastAnnounceAlt;x&&t.push(x)}else t.push(...t4(c))}}),t}function Ww(e,t,i,{discrete:c}){const f=i.originalEvent.currentTarget,_=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:i});t&&f.addEventListener(e,t,{once:!0}),c?zB(f,_):f.dispatchEvent(_)}var JO=(e,t,i=0)=>{const c=Math.abs(e.x),f=Math.abs(e.y),_=c>f;return t==="left"||t==="right"?_&&c>i:!_&&f>i};function D7(e=()=>{}){const t=fc(e);ca(()=>{let i=0,c=0;return i=window.requestAnimationFrame(()=>c=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(i),window.cancelAnimationFrame(c)}},[t])}function N7(e){return e.nodeType===e.ELEMENT_NODE}function O7(e){const t=[],i=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:c=>{const f=c.tagName==="INPUT"&&c.type==="hidden";return c.disabled||c.hidden||f?NodeFilter.FILTER_SKIP:c.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;i.nextNode();)t.push(i.currentNode);return t}function tA(e){const t=document.activeElement;return e.some(i=>i===t?!0:(i.focus(),document.activeElement!==t))}var L7=qB,r4=WB,n4=ZB,i4=XB,s4=KB,o4=JB,a4=Rk;function l4(e){var t,i,c="";if(typeof e=="string"||typeof e=="number")c+=e;else if(typeof e=="object")if(Array.isArray(e)){var f=e.length;for(t=0;t<f;t++)e[t]&&(i=l4(e[t]))&&(c&&(c+=" "),c+=i)}else for(i in e)e[i]&&(c&&(c+=" "),c+=i);return c}function c4(){for(var e,t,i=0,c="",f=arguments.length;i<f;i++)(e=arguments[i])&&(t=l4(e))&&(c&&(c+=" "),c+=t);return c}const QO=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,eL=c4,Dy=(e,t)=>i=>{var c;if((t==null?void 0:t.variants)==null)return eL(e,i==null?void 0:i.class,i==null?void 0:i.className);const{variants:f,defaultVariants:_}=t,x=Object.keys(f).map(P=>{const N=i==null?void 0:i[P],U=_==null?void 0:_[P];if(N===null)return null;const $=QO(N)||QO(U);return f[P][$]}),o=i&&Object.entries(i).reduce((P,N)=>{let[U,$]=N;return $===void 0||(P[U]=$),P},{}),I=t==null||(c=t.compoundVariants)===null||c===void 0?void 0:c.reduce((P,N)=>{let{class:U,className:$,...B}=N;return Object.entries(B).every(Y=>{let[H,K]=Y;return Array.isArray(K)?K.includes({..._,...o}[H]):{..._,...o}[H]===K})?[...P,U,$]:P},[]);return eL(e,x,I,i==null?void 0:i.class,i==null?void 0:i.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z7=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),u4=(...e)=>e.filter((t,i,c)=>!!t&&t.trim()!==""&&c.indexOf(t)===i).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var F7={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B7=V.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:i=2,absoluteStrokeWidth:c,className:f="",children:_,iconNode:x,...o},I)=>V.createElement("svg",{ref:I,...F7,width:t,height:t,stroke:e,strokeWidth:c?Number(i)*24/Number(t):i,className:u4("lucide",f),...o},[...x.map(([P,N])=>V.createElement(P,N)),...Array.isArray(_)?_:[_]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bn=(e,t)=>{const i=V.forwardRef(({className:c,...f},_)=>V.createElement(B7,{ref:_,iconNode:t,className:u4(`lucide-${z7(e)}`,c),...f}));return i.displayName=`${e}`,i};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ES=bn("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tL=bn("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Df=bn("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V7=bn("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U7=bn("CalendarOff",[["path",{d:"M4.2 4.2A2 2 0 0 0 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 1.82-1.18",key:"16swn3"}],["path",{d:"M21 15.5V6a2 2 0 0 0-2-2H9.5",key:"yhw86o"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h7",key:"1wap6i"}],["path",{d:"M21 10h-5.5",key:"quycpq"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $u=bn("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kI=bn("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $7=bn("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d4=bn("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h4=bn("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f4=bn("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q7=bn("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V_=bn("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yb=bn("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p4=bn("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mk=bn("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rT=bn("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vb=bn("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G7=bn("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dk=bn("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gd=bn("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W7=bn("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H7=bn("Headphones",[["path",{d:"M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3",key:"1xhozi"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m4=bn("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z7=bn("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X7=bn("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jI=bn("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rL=bn("ListOrdered",[["path",{d:"M10 12h11",key:"6m4ad9"}],["path",{d:"M10 18h11",key:"11hvi2"}],["path",{d:"M10 6h11",key:"c7qv1k"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xu=bn("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K7=bn("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y7=bn("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J7=bn("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nf=bn("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G0=bn("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dd=bn("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q7=bn("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g4=bn("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eZ=bn("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tZ=bn("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=bn("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xb=bn("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KT=bn("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xc=bn("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rZ=bn("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nZ=bn("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nk=bn("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mc=bn("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iZ=bn("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const El=bn("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ok=bn("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vm=bn("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sZ=bn("Unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oZ=bn("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nT=bn("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aZ=bn("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nL=bn("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W0=bn("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ld=bn("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vm=bn("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Lk="-",lZ=e=>{const t=uZ(e),{conflictingClassGroups:i,conflictingClassGroupModifiers:c}=e;return{getClassGroupId:x=>{const o=x.split(Lk);return o[0]===""&&o.length!==1&&o.shift(),_4(o,t)||cZ(x)},getConflictingClassGroupIds:(x,o)=>{const I=i[x]||[];return o&&c[x]?[...I,...c[x]]:I}}},_4=(e,t)=>{var x;if(e.length===0)return t.classGroupId;const i=e[0],c=t.nextPart.get(i),f=c?_4(e.slice(1),c):void 0;if(f)return f;if(t.validators.length===0)return;const _=e.join(Lk);return(x=t.validators.find(({validator:o})=>o(_)))==null?void 0:x.classGroupId},iL=/^\[(.+)\]$/,cZ=e=>{if(iL.test(e)){const t=iL.exec(e)[1],i=t==null?void 0:t.substring(0,t.indexOf(":"));if(i)return"arbitrary.."+i}},uZ=e=>{const{theme:t,prefix:i}=e,c={nextPart:new Map,validators:[]};return hZ(Object.entries(e.classGroups),i).forEach(([_,x])=>{RI(x,c,_,t)}),c},RI=(e,t,i,c)=>{e.forEach(f=>{if(typeof f=="string"){const _=f===""?t:sL(t,f);_.classGroupId=i;return}if(typeof f=="function"){if(dZ(f)){RI(f(c),t,i,c);return}t.validators.push({validator:f,classGroupId:i});return}Object.entries(f).forEach(([_,x])=>{RI(x,sL(t,_),i,c)})})},sL=(e,t)=>{let i=e;return t.split(Lk).forEach(c=>{i.nextPart.has(c)||i.nextPart.set(c,{nextPart:new Map,validators:[]}),i=i.nextPart.get(c)}),i},dZ=e=>e.isThemeGetter,hZ=(e,t)=>t?e.map(([i,c])=>{const f=c.map(_=>typeof _=="string"?t+_:typeof _=="object"?Object.fromEntries(Object.entries(_).map(([x,o])=>[t+x,o])):_);return[i,f]}):e,fZ=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,i=new Map,c=new Map;const f=(_,x)=>{i.set(_,x),t++,t>e&&(t=0,c=i,i=new Map)};return{get(_){let x=i.get(_);if(x!==void 0)return x;if((x=c.get(_))!==void 0)return f(_,x),x},set(_,x){i.has(_)?i.set(_,x):f(_,x)}}},y4="!",pZ=e=>{const{separator:t,experimentalParseClassName:i}=e,c=t.length===1,f=t[0],_=t.length,x=o=>{const I=[];let P=0,N=0,U;for(let K=0;K<o.length;K++){let re=o[K];if(P===0){if(re===f&&(c||o.slice(K,K+_)===t)){I.push(o.slice(N,K)),N=K+_;continue}if(re==="/"){U=K;continue}}re==="["?P++:re==="]"&&P--}const $=I.length===0?o:o.substring(N),B=$.startsWith(y4),Y=B?$.substring(1):$,H=U&&U>N?U-N:void 0;return{modifiers:I,hasImportantModifier:B,baseClassName:Y,maybePostfixModifierPosition:H}};return i?o=>i({className:o,parseClassName:x}):x},mZ=e=>{if(e.length<=1)return e;const t=[];let i=[];return e.forEach(c=>{c[0]==="["?(t.push(...i.sort(),c),i=[]):i.push(c)}),t.push(...i.sort()),t},gZ=e=>({cache:fZ(e.cacheSize),parseClassName:pZ(e),...lZ(e)}),_Z=/\s+/,yZ=(e,t)=>{const{parseClassName:i,getClassGroupId:c,getConflictingClassGroupIds:f}=t,_=[],x=e.trim().split(_Z);let o="";for(let I=x.length-1;I>=0;I-=1){const P=x[I],{modifiers:N,hasImportantModifier:U,baseClassName:$,maybePostfixModifierPosition:B}=i(P);let Y=!!B,H=c(Y?$.substring(0,B):$);if(!H){if(!Y){o=P+(o.length>0?" "+o:o);continue}if(H=c($),!H){o=P+(o.length>0?" "+o:o);continue}Y=!1}const K=mZ(N).join(":"),re=U?K+y4:K,G=re+H;if(_.includes(G))continue;_.push(G);const X=f(H,Y);for(let ue=0;ue<X.length;++ue){const Ee=X[ue];_.push(re+Ee)}o=P+(o.length>0?" "+o:o)}return o};function vZ(){let e=0,t,i,c="";for(;e<arguments.length;)(t=arguments[e++])&&(i=v4(t))&&(c&&(c+=" "),c+=i);return c}const v4=e=>{if(typeof e=="string")return e;let t,i="";for(let c=0;c<e.length;c++)e[c]&&(t=v4(e[c]))&&(i&&(i+=" "),i+=t);return i};function xZ(e,...t){let i,c,f,_=x;function x(I){const P=t.reduce((N,U)=>U(N),e());return i=gZ(P),c=i.cache.get,f=i.cache.set,_=o,o(I)}function o(I){const P=c(I);if(P)return P;const N=yZ(I,i);return f(I,N),N}return function(){return _(vZ.apply(null,arguments))}}const Ms=e=>{const t=i=>i[e]||[];return t.isThemeGetter=!0,t},x4=/^\[(?:([a-z-]+):)?(.+)\]$/i,bZ=/^\d+\/\d+$/,wZ=new Set(["px","full","screen"]),SZ=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,TZ=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,EZ=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,CZ=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,AZ=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,wd=e=>Z_(e)||wZ.has(e)||bZ.test(e),Hh=e=>Ny(e,"length",NZ),Z_=e=>!!e&&!Number.isNaN(Number(e)),rA=e=>Ny(e,"number",Z_),t0=e=>!!e&&Number.isInteger(Number(e)),IZ=e=>e.endsWith("%")&&Z_(e.slice(0,-1)),vi=e=>x4.test(e),Zh=e=>SZ.test(e),PZ=new Set(["length","size","percentage"]),kZ=e=>Ny(e,PZ,b4),jZ=e=>Ny(e,"position",b4),RZ=new Set(["image","url"]),MZ=e=>Ny(e,RZ,LZ),DZ=e=>Ny(e,"",OZ),r0=()=>!0,Ny=(e,t,i)=>{const c=x4.exec(e);return c?c[1]?typeof t=="string"?c[1]===t:t.has(c[1]):i(c[2]):!1},NZ=e=>TZ.test(e)&&!EZ.test(e),b4=()=>!1,OZ=e=>CZ.test(e),LZ=e=>AZ.test(e),zZ=()=>{const e=Ms("colors"),t=Ms("spacing"),i=Ms("blur"),c=Ms("brightness"),f=Ms("borderColor"),_=Ms("borderRadius"),x=Ms("borderSpacing"),o=Ms("borderWidth"),I=Ms("contrast"),P=Ms("grayscale"),N=Ms("hueRotate"),U=Ms("invert"),$=Ms("gap"),B=Ms("gradientColorStops"),Y=Ms("gradientColorStopPositions"),H=Ms("inset"),K=Ms("margin"),re=Ms("opacity"),G=Ms("padding"),X=Ms("saturate"),ue=Ms("scale"),Ee=Ms("sepia"),xe=Ms("skew"),Ne=Ms("space"),lt=Ms("translate"),Pt=()=>["auto","contain","none"],tt=()=>["auto","hidden","clip","visible","scroll"],yt=()=>["auto",vi,t],Me=()=>[vi,t],be=()=>["",wd,Hh],je=()=>["auto",Z_,vi],Ye=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],qe=()=>["solid","dashed","dotted","double","none"],We=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],$e=()=>["start","end","center","between","around","evenly","stretch"],_t=()=>["","0",vi],mt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],rt=()=>[Z_,vi];return{cacheSize:500,separator:":",theme:{colors:[r0],spacing:[wd,Hh],blur:["none","",Zh,vi],brightness:rt(),borderColor:[e],borderRadius:["none","","full",Zh,vi],borderSpacing:Me(),borderWidth:be(),contrast:rt(),grayscale:_t(),hueRotate:rt(),invert:_t(),gap:Me(),gradientColorStops:[e],gradientColorStopPositions:[IZ,Hh],inset:yt(),margin:yt(),opacity:rt(),padding:Me(),saturate:rt(),scale:rt(),sepia:_t(),skew:rt(),space:Me(),translate:Me()},classGroups:{aspect:[{aspect:["auto","square","video",vi]}],container:["container"],columns:[{columns:[Zh]}],"break-after":[{"break-after":mt()}],"break-before":[{"break-before":mt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Ye(),vi]}],overflow:[{overflow:tt()}],"overflow-x":[{"overflow-x":tt()}],"overflow-y":[{"overflow-y":tt()}],overscroll:[{overscroll:Pt()}],"overscroll-x":[{"overscroll-x":Pt()}],"overscroll-y":[{"overscroll-y":Pt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[H]}],"inset-x":[{"inset-x":[H]}],"inset-y":[{"inset-y":[H]}],start:[{start:[H]}],end:[{end:[H]}],top:[{top:[H]}],right:[{right:[H]}],bottom:[{bottom:[H]}],left:[{left:[H]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",t0,vi]}],basis:[{basis:yt()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",vi]}],grow:[{grow:_t()}],shrink:[{shrink:_t()}],order:[{order:["first","last","none",t0,vi]}],"grid-cols":[{"grid-cols":[r0]}],"col-start-end":[{col:["auto",{span:["full",t0,vi]},vi]}],"col-start":[{"col-start":je()}],"col-end":[{"col-end":je()}],"grid-rows":[{"grid-rows":[r0]}],"row-start-end":[{row:["auto",{span:[t0,vi]},vi]}],"row-start":[{"row-start":je()}],"row-end":[{"row-end":je()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",vi]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",vi]}],gap:[{gap:[$]}],"gap-x":[{"gap-x":[$]}],"gap-y":[{"gap-y":[$]}],"justify-content":[{justify:["normal",...$e()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...$e(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...$e(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[G]}],px:[{px:[G]}],py:[{py:[G]}],ps:[{ps:[G]}],pe:[{pe:[G]}],pt:[{pt:[G]}],pr:[{pr:[G]}],pb:[{pb:[G]}],pl:[{pl:[G]}],m:[{m:[K]}],mx:[{mx:[K]}],my:[{my:[K]}],ms:[{ms:[K]}],me:[{me:[K]}],mt:[{mt:[K]}],mr:[{mr:[K]}],mb:[{mb:[K]}],ml:[{ml:[K]}],"space-x":[{"space-x":[Ne]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Ne]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",vi,t]}],"min-w":[{"min-w":[vi,t,"min","max","fit"]}],"max-w":[{"max-w":[vi,t,"none","full","min","max","fit","prose",{screen:[Zh]},Zh]}],h:[{h:[vi,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[vi,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[vi,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[vi,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Zh,Hh]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",rA]}],"font-family":[{font:[r0]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",vi]}],"line-clamp":[{"line-clamp":["none",Z_,rA]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",wd,vi]}],"list-image":[{"list-image":["none",vi]}],"list-style-type":[{list:["none","disc","decimal",vi]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[re]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[re]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...qe(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",wd,Hh]}],"underline-offset":[{"underline-offset":["auto",wd,vi]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Me()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",vi]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",vi]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[re]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Ye(),jZ]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",kZ]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},MZ]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[Y]}],"gradient-via-pos":[{via:[Y]}],"gradient-to-pos":[{to:[Y]}],"gradient-from":[{from:[B]}],"gradient-via":[{via:[B]}],"gradient-to":[{to:[B]}],rounded:[{rounded:[_]}],"rounded-s":[{"rounded-s":[_]}],"rounded-e":[{"rounded-e":[_]}],"rounded-t":[{"rounded-t":[_]}],"rounded-r":[{"rounded-r":[_]}],"rounded-b":[{"rounded-b":[_]}],"rounded-l":[{"rounded-l":[_]}],"rounded-ss":[{"rounded-ss":[_]}],"rounded-se":[{"rounded-se":[_]}],"rounded-ee":[{"rounded-ee":[_]}],"rounded-es":[{"rounded-es":[_]}],"rounded-tl":[{"rounded-tl":[_]}],"rounded-tr":[{"rounded-tr":[_]}],"rounded-br":[{"rounded-br":[_]}],"rounded-bl":[{"rounded-bl":[_]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[re]}],"border-style":[{border:[...qe(),"hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[re]}],"divide-style":[{divide:qe()}],"border-color":[{border:[f]}],"border-color-x":[{"border-x":[f]}],"border-color-y":[{"border-y":[f]}],"border-color-s":[{"border-s":[f]}],"border-color-e":[{"border-e":[f]}],"border-color-t":[{"border-t":[f]}],"border-color-r":[{"border-r":[f]}],"border-color-b":[{"border-b":[f]}],"border-color-l":[{"border-l":[f]}],"divide-color":[{divide:[f]}],"outline-style":[{outline:["",...qe()]}],"outline-offset":[{"outline-offset":[wd,vi]}],"outline-w":[{outline:[wd,Hh]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:be()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[re]}],"ring-offset-w":[{"ring-offset":[wd,Hh]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",Zh,DZ]}],"shadow-color":[{shadow:[r0]}],opacity:[{opacity:[re]}],"mix-blend":[{"mix-blend":[...We(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":We()}],filter:[{filter:["","none"]}],blur:[{blur:[i]}],brightness:[{brightness:[c]}],contrast:[{contrast:[I]}],"drop-shadow":[{"drop-shadow":["","none",Zh,vi]}],grayscale:[{grayscale:[P]}],"hue-rotate":[{"hue-rotate":[N]}],invert:[{invert:[U]}],saturate:[{saturate:[X]}],sepia:[{sepia:[Ee]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[i]}],"backdrop-brightness":[{"backdrop-brightness":[c]}],"backdrop-contrast":[{"backdrop-contrast":[I]}],"backdrop-grayscale":[{"backdrop-grayscale":[P]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[N]}],"backdrop-invert":[{"backdrop-invert":[U]}],"backdrop-opacity":[{"backdrop-opacity":[re]}],"backdrop-saturate":[{"backdrop-saturate":[X]}],"backdrop-sepia":[{"backdrop-sepia":[Ee]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[x]}],"border-spacing-x":[{"border-spacing-x":[x]}],"border-spacing-y":[{"border-spacing-y":[x]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",vi]}],duration:[{duration:rt()}],ease:[{ease:["linear","in","out","in-out",vi]}],delay:[{delay:rt()}],animate:[{animate:["none","spin","ping","pulse","bounce",vi]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[ue]}],"scale-x":[{"scale-x":[ue]}],"scale-y":[{"scale-y":[ue]}],rotate:[{rotate:[t0,vi]}],"translate-x":[{"translate-x":[lt]}],"translate-y":[{"translate-y":[lt]}],"skew-x":[{"skew-x":[xe]}],"skew-y":[{"skew-y":[xe]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",vi]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",vi]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Me()}],"scroll-mx":[{"scroll-mx":Me()}],"scroll-my":[{"scroll-my":Me()}],"scroll-ms":[{"scroll-ms":Me()}],"scroll-me":[{"scroll-me":Me()}],"scroll-mt":[{"scroll-mt":Me()}],"scroll-mr":[{"scroll-mr":Me()}],"scroll-mb":[{"scroll-mb":Me()}],"scroll-ml":[{"scroll-ml":Me()}],"scroll-p":[{"scroll-p":Me()}],"scroll-px":[{"scroll-px":Me()}],"scroll-py":[{"scroll-py":Me()}],"scroll-ps":[{"scroll-ps":Me()}],"scroll-pe":[{"scroll-pe":Me()}],"scroll-pt":[{"scroll-pt":Me()}],"scroll-pr":[{"scroll-pr":Me()}],"scroll-pb":[{"scroll-pb":Me()}],"scroll-pl":[{"scroll-pl":Me()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",vi]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[wd,Hh,rA]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},FZ=xZ(zZ);function yr(...e){return FZ(c4(e))}const BZ=L7,w4=V.forwardRef(({className:e,...t},i)=>h.jsx(r4,{ref:i,className:yr("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));w4.displayName=r4.displayName;const VZ=Dy("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),S4=V.forwardRef(({className:e,variant:t,...i},c)=>h.jsx(n4,{ref:c,className:yr(VZ({variant:t}),e),...i}));S4.displayName=n4.displayName;const UZ=V.forwardRef(({className:e,...t},i)=>h.jsx(o4,{ref:i,className:yr("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",e),...t}));UZ.displayName=o4.displayName;const T4=V.forwardRef(({className:e,...t},i)=>h.jsx(a4,{ref:i,className:yr("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:h.jsx(Vm,{className:"h-4 w-4"})}));T4.displayName=a4.displayName;const E4=V.forwardRef(({className:e,...t},i)=>h.jsx(i4,{ref:i,className:yr("text-sm font-semibold",e),...t}));E4.displayName=i4.displayName;const C4=V.forwardRef(({className:e,...t},i)=>h.jsx(s4,{ref:i,className:yr("text-sm opacity-90",e),...t}));C4.displayName=s4.displayName;function $Z(){const{toasts:e}=$f();return h.jsxs(BZ,{children:[e.map(function({id:t,title:i,description:c,action:f,..._}){return h.jsxs(S4,{..._,children:[h.jsxs("div",{className:"grid gap-1",children:[i&&h.jsx(E4,{children:i}),c&&h.jsx(C4,{children:c})]}),f,h.jsx(T4,{})]},t)}),h.jsx(w4,{})]})}var oL=["light","dark"],qZ="(prefers-color-scheme: dark)",GZ=V.createContext(void 0),WZ={setTheme:e=>{},themes:[]},HZ=()=>{var e;return(e=V.useContext(GZ))!=null?e:WZ};V.memo(({forcedTheme:e,storageKey:t,attribute:i,enableSystem:c,enableColorScheme:f,defaultTheme:_,value:x,attrs:o,nonce:I})=>{let P=_==="system",N=i==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${o.map(Y=>`'${Y}'`).join(",")})`};`:`var d=document.documentElement,n='${i}',s='setAttribute';`,U=f?oL.includes(_)&&_?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${_}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",$=(Y,H=!1,K=!0)=>{let re=x?x[Y]:Y,G=H?Y+"|| ''":`'${re}'`,X="";return f&&K&&!H&&oL.includes(Y)&&(X+=`d.style.colorScheme = '${Y}';`),i==="class"?H||re?X+=`c.add(${G})`:X+="null":re&&(X+=`d[s](n,${G})`),X},B=e?`!function(){${N}${$(e)}}()`:c?`!function(){try{${N}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${P})){var t='${qZ}',m=window.matchMedia(t);if(m.media!==t||m.matches){${$("dark")}}else{${$("light")}}}else if(e){${x?`var x=${JSON.stringify(x)};`:""}${$(x?"x[e]":"e",!0)}}${P?"":"else{"+$(_,!1,!1)+"}"}${U}}catch(e){}}()`:`!function(){try{${N}var e=localStorage.getItem('${t}');if(e){${x?`var x=${JSON.stringify(x)};`:""}${$(x?"x[e]":"e",!0)}}else{${$(_,!1,!1)};}${U}}catch(t){}}();`;return V.createElement("script",{nonce:I,dangerouslySetInnerHTML:{__html:B}})});var ZZ=e=>{switch(e){case"success":return YZ;case"info":return QZ;case"warning":return JZ;case"error":return eX;default:return null}},XZ=Array(12).fill(0),KZ=({visible:e,className:t})=>nr.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},nr.createElement("div",{className:"sonner-spinner"},XZ.map((i,c)=>nr.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${c}`})))),YZ=nr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},nr.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),JZ=nr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},nr.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),QZ=nr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},nr.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),eX=nr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},nr.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),tX=nr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},nr.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),nr.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),rX=()=>{let[e,t]=nr.useState(document.hidden);return nr.useEffect(()=>{let i=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",i),()=>window.removeEventListener("visibilitychange",i)},[]),e},MI=1,nX=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:i,...c}=e,f=typeof(e==null?void 0:e.id)=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:MI++,_=this.toasts.find(o=>o.id===f),x=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(f)&&this.dismissedToasts.delete(f),_?this.toasts=this.toasts.map(o=>o.id===f?(this.publish({...o,...e,id:f,title:i}),{...o,...e,id:f,dismissible:x,title:i}):o):this.addToast({title:i,...c,dismissible:x,id:f}),f},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(t=>{this.subscribers.forEach(i=>i({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let i;t.loading!==void 0&&(i=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let c=e instanceof Promise?e:e(),f=i!==void 0,_,x=c.then(async I=>{if(_=["resolve",I],nr.isValidElement(I))f=!1,this.create({id:i,type:"default",message:I});else if(sX(I)&&!I.ok){f=!1;let P=typeof t.error=="function"?await t.error(`HTTP error! status: ${I.status}`):t.error,N=typeof t.description=="function"?await t.description(`HTTP error! status: ${I.status}`):t.description;this.create({id:i,type:"error",message:P,description:N})}else if(t.success!==void 0){f=!1;let P=typeof t.success=="function"?await t.success(I):t.success,N=typeof t.description=="function"?await t.description(I):t.description;this.create({id:i,type:"success",message:P,description:N})}}).catch(async I=>{if(_=["reject",I],t.error!==void 0){f=!1;let P=typeof t.error=="function"?await t.error(I):t.error,N=typeof t.description=="function"?await t.description(I):t.description;this.create({id:i,type:"error",message:P,description:N})}}).finally(()=>{var I;f&&(this.dismiss(i),i=void 0),(I=t.finally)==null||I.call(t)}),o=()=>new Promise((I,P)=>x.then(()=>_[0]==="reject"?P(_[1]):I(_[1])).catch(P));return typeof i!="string"&&typeof i!="number"?{unwrap:o}:Object.assign(i,{unwrap:o})},this.custom=(e,t)=>{let i=(t==null?void 0:t.id)||MI++;return this.create({jsx:e(i),id:i,...t}),i},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},_l=new nX,iX=(e,t)=>{let i=(t==null?void 0:t.id)||MI++;return _l.addToast({title:e,...t,id:i}),i},sX=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",oX=iX,aX=()=>_l.toasts,lX=()=>_l.getActiveToasts(),mr=Object.assign(oX,{success:_l.success,info:_l.info,warning:_l.warning,error:_l.error,custom:_l.custom,message:_l.message,promise:_l.promise,dismiss:_l.dismiss,loading:_l.loading},{getHistory:aX,getToasts:lX});function cX(e,{insertAt:t}={}){if(typeof document>"u")return;let i=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css",t==="top"&&i.firstChild?i.insertBefore(c,i.firstChild):i.appendChild(c),c.styleSheet?c.styleSheet.cssText=e:c.appendChild(document.createTextNode(e))}cX(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function Hw(e){return e.label!==void 0}var uX=3,dX="32px",hX="16px",aL=4e3,fX=356,pX=14,mX=20,gX=200;function Oc(...e){return e.filter(Boolean).join(" ")}function _X(e){let[t,i]=e.split("-"),c=[];return t&&c.push(t),i&&c.push(i),c}var yX=e=>{var t,i,c,f,_,x,o,I,P,N,U;let{invert:$,toast:B,unstyled:Y,interacting:H,setHeights:K,visibleToasts:re,heights:G,index:X,toasts:ue,expanded:Ee,removeToast:xe,defaultRichColors:Ne,closeButton:lt,style:Pt,cancelButtonStyle:tt,actionButtonStyle:yt,className:Me="",descriptionClassName:be="",duration:je,position:Ye,gap:qe,loadingIcon:We,expandByDefault:$e,classNames:_t,icons:mt,closeButtonAriaLabel:rt="Close toast",pauseWhenPageIsHidden:Tt}=e,[Vt,it]=nr.useState(null),[ir,wr]=nr.useState(null),[Bt,Wr]=nr.useState(!1),[Er,Vr]=nr.useState(!1),[Ur,jn]=nr.useState(!1),[yn,os]=nr.useState(!1),[qi,ps]=nr.useState(!1),[Os,Ei]=nr.useState(0),[po,et]=nr.useState(0),Et=nr.useRef(B.duration||je||aL),Wt=nr.useRef(null),Ar=nr.useRef(null),pr=X===0,gr=X+1<=re,Or=B.type,Ln=B.dismissible!==!1,gi=B.className||"",Fi=B.descriptionClassName||"",to=nr.useMemo(()=>G.findIndex(qn=>qn.toastId===B.id)||0,[G,B.id]),Ss=nr.useMemo(()=>{var qn;return(qn=B.closeButton)!=null?qn:lt},[B.closeButton,lt]),ua=nr.useMemo(()=>B.duration||je||aL,[B.duration,je]),jo=nr.useRef(0),Yt=nr.useRef(0),$n=nr.useRef(0),as=nr.useRef(null),[Ts,bi]=Ye.split("-"),rs=nr.useMemo(()=>G.reduce((qn,Ni,ls)=>ls>=to?qn:qn+Ni.height,0),[G,to]),fi=rX(),ro=B.invert||$,Cl=Or==="loading";Yt.current=nr.useMemo(()=>to*qe+rs,[to,rs]),nr.useEffect(()=>{Et.current=ua},[ua]),nr.useEffect(()=>{Wr(!0)},[]),nr.useEffect(()=>{let qn=Ar.current;if(qn){let Ni=qn.getBoundingClientRect().height;return et(Ni),K(ls=>[{toastId:B.id,height:Ni,position:B.position},...ls]),()=>K(ls=>ls.filter(bo=>bo.toastId!==B.id))}},[K,B.id]),nr.useLayoutEffect(()=>{if(!Bt)return;let qn=Ar.current,Ni=qn.style.height;qn.style.height="auto";let ls=qn.getBoundingClientRect().height;qn.style.height=Ni,et(ls),K(bo=>bo.find(xt=>xt.toastId===B.id)?bo.map(xt=>xt.toastId===B.id?{...xt,height:ls}:xt):[{toastId:B.id,height:ls,position:B.position},...bo])},[Bt,B.title,B.description,K,B.id]);let Ro=nr.useCallback(()=>{Vr(!0),Ei(Yt.current),K(qn=>qn.filter(Ni=>Ni.toastId!==B.id)),setTimeout(()=>{xe(B)},gX)},[B,xe,K,Yt]);nr.useEffect(()=>{if(B.promise&&Or==="loading"||B.duration===1/0||B.type==="loading")return;let qn;return Ee||H||Tt&&fi?(()=>{if($n.current<jo.current){let Ni=new Date().getTime()-jo.current;Et.current=Et.current-Ni}$n.current=new Date().getTime()})():Et.current!==1/0&&(jo.current=new Date().getTime(),qn=setTimeout(()=>{var Ni;(Ni=B.onAutoClose)==null||Ni.call(B,B),Ro()},Et.current)),()=>clearTimeout(qn)},[Ee,H,B,Or,Tt,fi,Ro]),nr.useEffect(()=>{B.delete&&Ro()},[Ro,B.delete]);function Yo(){var qn,Ni,ls;return mt!=null&&mt.loading?nr.createElement("div",{className:Oc(_t==null?void 0:_t.loader,(qn=B==null?void 0:B.classNames)==null?void 0:qn.loader,"sonner-loader"),"data-visible":Or==="loading"},mt.loading):We?nr.createElement("div",{className:Oc(_t==null?void 0:_t.loader,(Ni=B==null?void 0:B.classNames)==null?void 0:Ni.loader,"sonner-loader"),"data-visible":Or==="loading"},We):nr.createElement(KZ,{className:Oc(_t==null?void 0:_t.loader,(ls=B==null?void 0:B.classNames)==null?void 0:ls.loader),visible:Or==="loading"})}return nr.createElement("li",{tabIndex:0,ref:Ar,className:Oc(Me,gi,_t==null?void 0:_t.toast,(t=B==null?void 0:B.classNames)==null?void 0:t.toast,_t==null?void 0:_t.default,_t==null?void 0:_t[Or],(i=B==null?void 0:B.classNames)==null?void 0:i[Or]),"data-sonner-toast":"","data-rich-colors":(c=B.richColors)!=null?c:Ne,"data-styled":!(B.jsx||B.unstyled||Y),"data-mounted":Bt,"data-promise":!!B.promise,"data-swiped":qi,"data-removed":Er,"data-visible":gr,"data-y-position":Ts,"data-x-position":bi,"data-index":X,"data-front":pr,"data-swiping":Ur,"data-dismissible":Ln,"data-type":Or,"data-invert":ro,"data-swipe-out":yn,"data-swipe-direction":ir,"data-expanded":!!(Ee||$e&&Bt),style:{"--index":X,"--toasts-before":X,"--z-index":ue.length-X,"--offset":`${Er?Os:Yt.current}px`,"--initial-height":$e?"auto":`${po}px`,...Pt,...B.style},onDragEnd:()=>{jn(!1),it(null),as.current=null},onPointerDown:qn=>{Cl||!Ln||(Wt.current=new Date,Ei(Yt.current),qn.target.setPointerCapture(qn.pointerId),qn.target.tagName!=="BUTTON"&&(jn(!0),as.current={x:qn.clientX,y:qn.clientY}))},onPointerUp:()=>{var qn,Ni,ls,bo;if(yn||!Ln)return;as.current=null;let xt=Number(((qn=Ar.current)==null?void 0:qn.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),wo=Number(((Ni=Ar.current)==null?void 0:Ni.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Ea=new Date().getTime()-((ls=Wt.current)==null?void 0:ls.getTime()),Mo=Vt==="x"?xt:wo,ln=Math.abs(Mo)/Ea;if(Math.abs(Mo)>=mX||ln>.11){Ei(Yt.current),(bo=B.onDismiss)==null||bo.call(B,B),wr(Vt==="x"?xt>0?"right":"left":wo>0?"down":"up"),Ro(),os(!0),ps(!1);return}jn(!1),it(null)},onPointerMove:qn=>{var Ni,ls,bo,xt;if(!as.current||!Ln||((Ni=window.getSelection())==null?void 0:Ni.toString().length)>0)return;let wo=qn.clientY-as.current.y,Ea=qn.clientX-as.current.x,Mo=(ls=e.swipeDirections)!=null?ls:_X(Ye);!Vt&&(Math.abs(Ea)>1||Math.abs(wo)>1)&&it(Math.abs(Ea)>Math.abs(wo)?"x":"y");let ln={x:0,y:0};Vt==="y"?(Mo.includes("top")||Mo.includes("bottom"))&&(Mo.includes("top")&&wo<0||Mo.includes("bottom")&&wo>0)&&(ln.y=wo):Vt==="x"&&(Mo.includes("left")||Mo.includes("right"))&&(Mo.includes("left")&&Ea<0||Mo.includes("right")&&Ea>0)&&(ln.x=Ea),(Math.abs(ln.x)>0||Math.abs(ln.y)>0)&&ps(!0),(bo=Ar.current)==null||bo.style.setProperty("--swipe-amount-x",`${ln.x}px`),(xt=Ar.current)==null||xt.style.setProperty("--swipe-amount-y",`${ln.y}px`)}},Ss&&!B.jsx?nr.createElement("button",{"aria-label":rt,"data-disabled":Cl,"data-close-button":!0,onClick:Cl||!Ln?()=>{}:()=>{var qn;Ro(),(qn=B.onDismiss)==null||qn.call(B,B)},className:Oc(_t==null?void 0:_t.closeButton,(f=B==null?void 0:B.classNames)==null?void 0:f.closeButton)},(_=mt==null?void 0:mt.close)!=null?_:tX):null,B.jsx||V.isValidElement(B.title)?B.jsx?B.jsx:typeof B.title=="function"?B.title():B.title:nr.createElement(nr.Fragment,null,Or||B.icon||B.promise?nr.createElement("div",{"data-icon":"",className:Oc(_t==null?void 0:_t.icon,(x=B==null?void 0:B.classNames)==null?void 0:x.icon)},B.promise||B.type==="loading"&&!B.icon?B.icon||Yo():null,B.type!=="loading"?B.icon||(mt==null?void 0:mt[Or])||ZZ(Or):null):null,nr.createElement("div",{"data-content":"",className:Oc(_t==null?void 0:_t.content,(o=B==null?void 0:B.classNames)==null?void 0:o.content)},nr.createElement("div",{"data-title":"",className:Oc(_t==null?void 0:_t.title,(I=B==null?void 0:B.classNames)==null?void 0:I.title)},typeof B.title=="function"?B.title():B.title),B.description?nr.createElement("div",{"data-description":"",className:Oc(be,Fi,_t==null?void 0:_t.description,(P=B==null?void 0:B.classNames)==null?void 0:P.description)},typeof B.description=="function"?B.description():B.description):null),V.isValidElement(B.cancel)?B.cancel:B.cancel&&Hw(B.cancel)?nr.createElement("button",{"data-button":!0,"data-cancel":!0,style:B.cancelButtonStyle||tt,onClick:qn=>{var Ni,ls;Hw(B.cancel)&&Ln&&((ls=(Ni=B.cancel).onClick)==null||ls.call(Ni,qn),Ro())},className:Oc(_t==null?void 0:_t.cancelButton,(N=B==null?void 0:B.classNames)==null?void 0:N.cancelButton)},B.cancel.label):null,V.isValidElement(B.action)?B.action:B.action&&Hw(B.action)?nr.createElement("button",{"data-button":!0,"data-action":!0,style:B.actionButtonStyle||yt,onClick:qn=>{var Ni,ls;Hw(B.action)&&((ls=(Ni=B.action).onClick)==null||ls.call(Ni,qn),!qn.defaultPrevented&&Ro())},className:Oc(_t==null?void 0:_t.actionButton,(U=B==null?void 0:B.classNames)==null?void 0:U.actionButton)},B.action.label):null))};function lL(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function vX(e,t){let i={};return[e,t].forEach((c,f)=>{let _=f===1,x=_?"--mobile-offset":"--offset",o=_?hX:dX;function I(P){["top","right","bottom","left"].forEach(N=>{i[`${x}-${N}`]=typeof P=="number"?`${P}px`:P})}typeof c=="number"||typeof c=="string"?I(c):typeof c=="object"?["top","right","bottom","left"].forEach(P=>{c[P]===void 0?i[`${x}-${P}`]=o:i[`${x}-${P}`]=typeof c[P]=="number"?`${c[P]}px`:c[P]}):I(o)}),i}var xX=V.forwardRef(function(e,t){let{invert:i,position:c="bottom-right",hotkey:f=["altKey","KeyT"],expand:_,closeButton:x,className:o,offset:I,mobileOffset:P,theme:N="light",richColors:U,duration:$,style:B,visibleToasts:Y=uX,toastOptions:H,dir:K=lL(),gap:re=pX,loadingIcon:G,icons:X,containerAriaLabel:ue="Notifications",pauseWhenPageIsHidden:Ee}=e,[xe,Ne]=nr.useState([]),lt=nr.useMemo(()=>Array.from(new Set([c].concat(xe.filter(Tt=>Tt.position).map(Tt=>Tt.position)))),[xe,c]),[Pt,tt]=nr.useState([]),[yt,Me]=nr.useState(!1),[be,je]=nr.useState(!1),[Ye,qe]=nr.useState(N!=="system"?N:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),We=nr.useRef(null),$e=f.join("+").replace(/Key/g,"").replace(/Digit/g,""),_t=nr.useRef(null),mt=nr.useRef(!1),rt=nr.useCallback(Tt=>{Ne(Vt=>{var it;return(it=Vt.find(ir=>ir.id===Tt.id))!=null&&it.delete||_l.dismiss(Tt.id),Vt.filter(({id:ir})=>ir!==Tt.id)})},[]);return nr.useEffect(()=>_l.subscribe(Tt=>{if(Tt.dismiss){Ne(Vt=>Vt.map(it=>it.id===Tt.id?{...it,delete:!0}:it));return}setTimeout(()=>{MB.flushSync(()=>{Ne(Vt=>{let it=Vt.findIndex(ir=>ir.id===Tt.id);return it!==-1?[...Vt.slice(0,it),{...Vt[it],...Tt},...Vt.slice(it+1)]:[Tt,...Vt]})})})}),[]),nr.useEffect(()=>{if(N!=="system"){qe(N);return}if(N==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?qe("dark"):qe("light")),typeof window>"u")return;let Tt=window.matchMedia("(prefers-color-scheme: dark)");try{Tt.addEventListener("change",({matches:Vt})=>{qe(Vt?"dark":"light")})}catch{Tt.addListener(({matches:it})=>{try{qe(it?"dark":"light")}catch(ir){console.error(ir)}})}},[N]),nr.useEffect(()=>{xe.length<=1&&Me(!1)},[xe]),nr.useEffect(()=>{let Tt=Vt=>{var it,ir;f.every(wr=>Vt[wr]||Vt.code===wr)&&(Me(!0),(it=We.current)==null||it.focus()),Vt.code==="Escape"&&(document.activeElement===We.current||(ir=We.current)!=null&&ir.contains(document.activeElement))&&Me(!1)};return document.addEventListener("keydown",Tt),()=>document.removeEventListener("keydown",Tt)},[f]),nr.useEffect(()=>{if(We.current)return()=>{_t.current&&(_t.current.focus({preventScroll:!0}),_t.current=null,mt.current=!1)}},[We.current]),nr.createElement("section",{ref:t,"aria-label":`${ue} ${$e}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},lt.map((Tt,Vt)=>{var it;let[ir,wr]=Tt.split("-");return xe.length?nr.createElement("ol",{key:Tt,dir:K==="auto"?lL():K,tabIndex:-1,ref:We,className:o,"data-sonner-toaster":!0,"data-theme":Ye,"data-y-position":ir,"data-lifted":yt&&xe.length>1&&!_,"data-x-position":wr,style:{"--front-toast-height":`${((it=Pt[0])==null?void 0:it.height)||0}px`,"--width":`${fX}px`,"--gap":`${re}px`,...B,...vX(I,P)},onBlur:Bt=>{mt.current&&!Bt.currentTarget.contains(Bt.relatedTarget)&&(mt.current=!1,_t.current&&(_t.current.focus({preventScroll:!0}),_t.current=null))},onFocus:Bt=>{Bt.target instanceof HTMLElement&&Bt.target.dataset.dismissible==="false"||mt.current||(mt.current=!0,_t.current=Bt.relatedTarget)},onMouseEnter:()=>Me(!0),onMouseMove:()=>Me(!0),onMouseLeave:()=>{be||Me(!1)},onDragEnd:()=>Me(!1),onPointerDown:Bt=>{Bt.target instanceof HTMLElement&&Bt.target.dataset.dismissible==="false"||je(!0)},onPointerUp:()=>je(!1)},xe.filter(Bt=>!Bt.position&&Vt===0||Bt.position===Tt).map((Bt,Wr)=>{var Er,Vr;return nr.createElement(yX,{key:Bt.id,icons:X,index:Wr,toast:Bt,defaultRichColors:U,duration:(Er=H==null?void 0:H.duration)!=null?Er:$,className:H==null?void 0:H.className,descriptionClassName:H==null?void 0:H.descriptionClassName,invert:i,visibleToasts:Y,closeButton:(Vr=H==null?void 0:H.closeButton)!=null?Vr:x,interacting:be,position:Tt,style:H==null?void 0:H.style,unstyled:H==null?void 0:H.unstyled,classNames:H==null?void 0:H.classNames,cancelButtonStyle:H==null?void 0:H.cancelButtonStyle,actionButtonStyle:H==null?void 0:H.actionButtonStyle,removeToast:rt,toasts:xe.filter(Ur=>Ur.position==Bt.position),heights:Pt.filter(Ur=>Ur.position==Bt.position),setHeights:tt,expandByDefault:_,gap:re,loadingIcon:G,expanded:yt,pauseWhenPageIsHidden:Ee,swipeDirections:e.swipeDirections})})):null}))});const bX=({...e})=>{const{theme:t="system"}=HZ();return h.jsx(xX,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})};var wX=zP[" useId ".trim().toString()]||(()=>{}),SX=0;function zd(e){const[t,i]=V.useState(wX());return ca(()=>{i(c=>c??String(SX++))},[e]),t?`radix-${t}`:""}const TX=["top","right","bottom","left"],Of=Math.min,Ll=Math.max,iT=Math.round,Zw=Math.floor,qu=e=>({x:e,y:e}),EX={left:"right",right:"left",bottom:"top",top:"bottom"},CX={start:"end",end:"start"};function DI(e,t,i){return Ll(e,Of(t,i))}function Wd(e,t){return typeof e=="function"?e(t):e}function Hd(e){return e.split("-")[0]}function Oy(e){return e.split("-")[1]}function zk(e){return e==="x"?"y":"x"}function Fk(e){return e==="y"?"height":"width"}const AX=new Set(["top","bottom"]);function zu(e){return AX.has(Hd(e))?"y":"x"}function Bk(e){return zk(zu(e))}function IX(e,t,i){i===void 0&&(i=!1);const c=Oy(e),f=Bk(e),_=Fk(f);let x=f==="x"?c===(i?"end":"start")?"right":"left":c==="start"?"bottom":"top";return t.reference[_]>t.floating[_]&&(x=sT(x)),[x,sT(x)]}function PX(e){const t=sT(e);return[NI(e),t,NI(t)]}function NI(e){return e.replace(/start|end/g,t=>CX[t])}const cL=["left","right"],uL=["right","left"],kX=["top","bottom"],jX=["bottom","top"];function RX(e,t,i){switch(e){case"top":case"bottom":return i?t?uL:cL:t?cL:uL;case"left":case"right":return t?kX:jX;default:return[]}}function MX(e,t,i,c){const f=Oy(e);let _=RX(Hd(e),i==="start",c);return f&&(_=_.map(x=>x+"-"+f),t&&(_=_.concat(_.map(NI)))),_}function sT(e){return e.replace(/left|right|bottom|top/g,t=>EX[t])}function DX(e){return{top:0,right:0,bottom:0,left:0,...e}}function A4(e){return typeof e!="number"?DX(e):{top:e,right:e,bottom:e,left:e}}function oT(e){const{x:t,y:i,width:c,height:f}=e;return{width:c,height:f,top:i,left:t,right:t+c,bottom:i+f,x:t,y:i}}function dL(e,t,i){let{reference:c,floating:f}=e;const _=zu(t),x=Bk(t),o=Fk(x),I=Hd(t),P=_==="y",N=c.x+c.width/2-f.width/2,U=c.y+c.height/2-f.height/2,$=c[o]/2-f[o]/2;let B;switch(I){case"top":B={x:N,y:c.y-f.height};break;case"bottom":B={x:N,y:c.y+c.height};break;case"right":B={x:c.x+c.width,y:U};break;case"left":B={x:c.x-f.width,y:U};break;default:B={x:c.x,y:c.y}}switch(Oy(t)){case"start":B[x]-=$*(i&&P?-1:1);break;case"end":B[x]+=$*(i&&P?-1:1);break}return B}const NX=async(e,t,i)=>{const{placement:c="bottom",strategy:f="absolute",middleware:_=[],platform:x}=i,o=_.filter(Boolean),I=await(x.isRTL==null?void 0:x.isRTL(t));let P=await x.getElementRects({reference:e,floating:t,strategy:f}),{x:N,y:U}=dL(P,c,I),$=c,B={},Y=0;for(let H=0;H<o.length;H++){const{name:K,fn:re}=o[H],{x:G,y:X,data:ue,reset:Ee}=await re({x:N,y:U,initialPlacement:c,placement:$,strategy:f,middlewareData:B,rects:P,platform:x,elements:{reference:e,floating:t}});N=G??N,U=X??U,B={...B,[K]:{...B[K],...ue}},Ee&&Y<=50&&(Y++,typeof Ee=="object"&&(Ee.placement&&($=Ee.placement),Ee.rects&&(P=Ee.rects===!0?await x.getElementRects({reference:e,floating:t,strategy:f}):Ee.rects),{x:N,y:U}=dL(P,$,I)),H=-1)}return{x:N,y:U,placement:$,strategy:f,middlewareData:B}};async function H0(e,t){var i;t===void 0&&(t={});const{x:c,y:f,platform:_,rects:x,elements:o,strategy:I}=e,{boundary:P="clippingAncestors",rootBoundary:N="viewport",elementContext:U="floating",altBoundary:$=!1,padding:B=0}=Wd(t,e),Y=A4(B),K=o[$?U==="floating"?"reference":"floating":U],re=oT(await _.getClippingRect({element:(i=await(_.isElement==null?void 0:_.isElement(K)))==null||i?K:K.contextElement||await(_.getDocumentElement==null?void 0:_.getDocumentElement(o.floating)),boundary:P,rootBoundary:N,strategy:I})),G=U==="floating"?{x:c,y:f,width:x.floating.width,height:x.floating.height}:x.reference,X=await(_.getOffsetParent==null?void 0:_.getOffsetParent(o.floating)),ue=await(_.isElement==null?void 0:_.isElement(X))?await(_.getScale==null?void 0:_.getScale(X))||{x:1,y:1}:{x:1,y:1},Ee=oT(_.convertOffsetParentRelativeRectToViewportRelativeRect?await _.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:G,offsetParent:X,strategy:I}):G);return{top:(re.top-Ee.top+Y.top)/ue.y,bottom:(Ee.bottom-re.bottom+Y.bottom)/ue.y,left:(re.left-Ee.left+Y.left)/ue.x,right:(Ee.right-re.right+Y.right)/ue.x}}const OX=e=>({name:"arrow",options:e,async fn(t){const{x:i,y:c,placement:f,rects:_,platform:x,elements:o,middlewareData:I}=t,{element:P,padding:N=0}=Wd(e,t)||{};if(P==null)return{};const U=A4(N),$={x:i,y:c},B=Bk(f),Y=Fk(B),H=await x.getDimensions(P),K=B==="y",re=K?"top":"left",G=K?"bottom":"right",X=K?"clientHeight":"clientWidth",ue=_.reference[Y]+_.reference[B]-$[B]-_.floating[Y],Ee=$[B]-_.reference[B],xe=await(x.getOffsetParent==null?void 0:x.getOffsetParent(P));let Ne=xe?xe[X]:0;(!Ne||!await(x.isElement==null?void 0:x.isElement(xe)))&&(Ne=o.floating[X]||_.floating[Y]);const lt=ue/2-Ee/2,Pt=Ne/2-H[Y]/2-1,tt=Of(U[re],Pt),yt=Of(U[G],Pt),Me=tt,be=Ne-H[Y]-yt,je=Ne/2-H[Y]/2+lt,Ye=DI(Me,je,be),qe=!I.arrow&&Oy(f)!=null&&je!==Ye&&_.reference[Y]/2-(je<Me?tt:yt)-H[Y]/2<0,We=qe?je<Me?je-Me:je-be:0;return{[B]:$[B]+We,data:{[B]:Ye,centerOffset:je-Ye-We,...qe&&{alignmentOffset:We}},reset:qe}}}),LX=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var i,c;const{placement:f,middlewareData:_,rects:x,initialPlacement:o,platform:I,elements:P}=t,{mainAxis:N=!0,crossAxis:U=!0,fallbackPlacements:$,fallbackStrategy:B="bestFit",fallbackAxisSideDirection:Y="none",flipAlignment:H=!0,...K}=Wd(e,t);if((i=_.arrow)!=null&&i.alignmentOffset)return{};const re=Hd(f),G=zu(o),X=Hd(o)===o,ue=await(I.isRTL==null?void 0:I.isRTL(P.floating)),Ee=$||(X||!H?[sT(o)]:PX(o)),xe=Y!=="none";!$&&xe&&Ee.push(...MX(o,H,Y,ue));const Ne=[o,...Ee],lt=await H0(t,K),Pt=[];let tt=((c=_.flip)==null?void 0:c.overflows)||[];if(N&&Pt.push(lt[re]),U){const je=IX(f,x,ue);Pt.push(lt[je[0]],lt[je[1]])}if(tt=[...tt,{placement:f,overflows:Pt}],!Pt.every(je=>je<=0)){var yt,Me;const je=(((yt=_.flip)==null?void 0:yt.index)||0)+1,Ye=Ne[je];if(Ye&&(!(U==="alignment"?G!==zu(Ye):!1)||tt.every($e=>$e.overflows[0]>0&&zu($e.placement)===G)))return{data:{index:je,overflows:tt},reset:{placement:Ye}};let qe=(Me=tt.filter(We=>We.overflows[0]<=0).sort((We,$e)=>We.overflows[1]-$e.overflows[1])[0])==null?void 0:Me.placement;if(!qe)switch(B){case"bestFit":{var be;const We=(be=tt.filter($e=>{if(xe){const _t=zu($e.placement);return _t===G||_t==="y"}return!0}).map($e=>[$e.placement,$e.overflows.filter(_t=>_t>0).reduce((_t,mt)=>_t+mt,0)]).sort(($e,_t)=>$e[1]-_t[1])[0])==null?void 0:be[0];We&&(qe=We);break}case"initialPlacement":qe=o;break}if(f!==qe)return{reset:{placement:qe}}}return{}}}};function hL(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function fL(e){return TX.some(t=>e[t]>=0)}const zX=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:i}=t,{strategy:c="referenceHidden",...f}=Wd(e,t);switch(c){case"referenceHidden":{const _=await H0(t,{...f,elementContext:"reference"}),x=hL(_,i.reference);return{data:{referenceHiddenOffsets:x,referenceHidden:fL(x)}}}case"escaped":{const _=await H0(t,{...f,altBoundary:!0}),x=hL(_,i.floating);return{data:{escapedOffsets:x,escaped:fL(x)}}}default:return{}}}}},I4=new Set(["left","top"]);async function FX(e,t){const{placement:i,platform:c,elements:f}=e,_=await(c.isRTL==null?void 0:c.isRTL(f.floating)),x=Hd(i),o=Oy(i),I=zu(i)==="y",P=I4.has(x)?-1:1,N=_&&I?-1:1,U=Wd(t,e);let{mainAxis:$,crossAxis:B,alignmentAxis:Y}=typeof U=="number"?{mainAxis:U,crossAxis:0,alignmentAxis:null}:{mainAxis:U.mainAxis||0,crossAxis:U.crossAxis||0,alignmentAxis:U.alignmentAxis};return o&&typeof Y=="number"&&(B=o==="end"?Y*-1:Y),I?{x:B*N,y:$*P}:{x:$*P,y:B*N}}const BX=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var i,c;const{x:f,y:_,placement:x,middlewareData:o}=t,I=await FX(t,e);return x===((i=o.offset)==null?void 0:i.placement)&&(c=o.arrow)!=null&&c.alignmentOffset?{}:{x:f+I.x,y:_+I.y,data:{...I,placement:x}}}}},VX=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:i,y:c,placement:f}=t,{mainAxis:_=!0,crossAxis:x=!1,limiter:o={fn:K=>{let{x:re,y:G}=K;return{x:re,y:G}}},...I}=Wd(e,t),P={x:i,y:c},N=await H0(t,I),U=zu(Hd(f)),$=zk(U);let B=P[$],Y=P[U];if(_){const K=$==="y"?"top":"left",re=$==="y"?"bottom":"right",G=B+N[K],X=B-N[re];B=DI(G,B,X)}if(x){const K=U==="y"?"top":"left",re=U==="y"?"bottom":"right",G=Y+N[K],X=Y-N[re];Y=DI(G,Y,X)}const H=o.fn({...t,[$]:B,[U]:Y});return{...H,data:{x:H.x-i,y:H.y-c,enabled:{[$]:_,[U]:x}}}}}},UX=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:i,y:c,placement:f,rects:_,middlewareData:x}=t,{offset:o=0,mainAxis:I=!0,crossAxis:P=!0}=Wd(e,t),N={x:i,y:c},U=zu(f),$=zk(U);let B=N[$],Y=N[U];const H=Wd(o,t),K=typeof H=="number"?{mainAxis:H,crossAxis:0}:{mainAxis:0,crossAxis:0,...H};if(I){const X=$==="y"?"height":"width",ue=_.reference[$]-_.floating[X]+K.mainAxis,Ee=_.reference[$]+_.reference[X]-K.mainAxis;B<ue?B=ue:B>Ee&&(B=Ee)}if(P){var re,G;const X=$==="y"?"width":"height",ue=I4.has(Hd(f)),Ee=_.reference[U]-_.floating[X]+(ue&&((re=x.offset)==null?void 0:re[U])||0)+(ue?0:K.crossAxis),xe=_.reference[U]+_.reference[X]+(ue?0:((G=x.offset)==null?void 0:G[U])||0)-(ue?K.crossAxis:0);Y<Ee?Y=Ee:Y>xe&&(Y=xe)}return{[$]:B,[U]:Y}}}},$X=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var i,c;const{placement:f,rects:_,platform:x,elements:o}=t,{apply:I=()=>{},...P}=Wd(e,t),N=await H0(t,P),U=Hd(f),$=Oy(f),B=zu(f)==="y",{width:Y,height:H}=_.floating;let K,re;U==="top"||U==="bottom"?(K=U,re=$===(await(x.isRTL==null?void 0:x.isRTL(o.floating))?"start":"end")?"left":"right"):(re=U,K=$==="end"?"top":"bottom");const G=H-N.top-N.bottom,X=Y-N.left-N.right,ue=Of(H-N[K],G),Ee=Of(Y-N[re],X),xe=!t.middlewareData.shift;let Ne=ue,lt=Ee;if((i=t.middlewareData.shift)!=null&&i.enabled.x&&(lt=X),(c=t.middlewareData.shift)!=null&&c.enabled.y&&(Ne=G),xe&&!$){const tt=Ll(N.left,0),yt=Ll(N.right,0),Me=Ll(N.top,0),be=Ll(N.bottom,0);B?lt=Y-2*(tt!==0||yt!==0?tt+yt:Ll(N.left,N.right)):Ne=H-2*(Me!==0||be!==0?Me+be:Ll(N.top,N.bottom))}await I({...t,availableWidth:lt,availableHeight:Ne});const Pt=await x.getDimensions(o.floating);return Y!==Pt.width||H!==Pt.height?{reset:{rects:!0}}:{}}}};function YT(){return typeof window<"u"}function Ly(e){return P4(e)?(e.nodeName||"").toLowerCase():"#document"}function Ul(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Ku(e){var t;return(t=(P4(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function P4(e){return YT()?e instanceof Node||e instanceof Ul(e).Node:!1}function Qc(e){return YT()?e instanceof Element||e instanceof Ul(e).Element:!1}function Wu(e){return YT()?e instanceof HTMLElement||e instanceof Ul(e).HTMLElement:!1}function pL(e){return!YT()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Ul(e).ShadowRoot}const qX=new Set(["inline","contents"]);function bb(e){const{overflow:t,overflowX:i,overflowY:c,display:f}=eu(e);return/auto|scroll|overlay|hidden|clip/.test(t+c+i)&&!qX.has(f)}const GX=new Set(["table","td","th"]);function WX(e){return GX.has(Ly(e))}const HX=[":popover-open",":modal"];function JT(e){return HX.some(t=>{try{return e.matches(t)}catch{return!1}})}const ZX=["transform","translate","scale","rotate","perspective"],XX=["transform","translate","scale","rotate","perspective","filter"],KX=["paint","layout","strict","content"];function Vk(e){const t=Uk(),i=Qc(e)?eu(e):e;return ZX.some(c=>i[c]?i[c]!=="none":!1)||(i.containerType?i.containerType!=="normal":!1)||!t&&(i.backdropFilter?i.backdropFilter!=="none":!1)||!t&&(i.filter?i.filter!=="none":!1)||XX.some(c=>(i.willChange||"").includes(c))||KX.some(c=>(i.contain||"").includes(c))}function YX(e){let t=Lf(e);for(;Wu(t)&&!xy(t);){if(Vk(t))return t;if(JT(t))return null;t=Lf(t)}return null}function Uk(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const JX=new Set(["html","body","#document"]);function xy(e){return JX.has(Ly(e))}function eu(e){return Ul(e).getComputedStyle(e)}function QT(e){return Qc(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Lf(e){if(Ly(e)==="html")return e;const t=e.assignedSlot||e.parentNode||pL(e)&&e.host||Ku(e);return pL(t)?t.host:t}function k4(e){const t=Lf(e);return xy(t)?e.ownerDocument?e.ownerDocument.body:e.body:Wu(t)&&bb(t)?t:k4(t)}function Z0(e,t,i){var c;t===void 0&&(t=[]),i===void 0&&(i=!0);const f=k4(e),_=f===((c=e.ownerDocument)==null?void 0:c.body),x=Ul(f);if(_){const o=OI(x);return t.concat(x,x.visualViewport||[],bb(f)?f:[],o&&i?Z0(o):[])}return t.concat(f,Z0(f,[],i))}function OI(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function j4(e){const t=eu(e);let i=parseFloat(t.width)||0,c=parseFloat(t.height)||0;const f=Wu(e),_=f?e.offsetWidth:i,x=f?e.offsetHeight:c,o=iT(i)!==_||iT(c)!==x;return o&&(i=_,c=x),{width:i,height:c,$:o}}function $k(e){return Qc(e)?e:e.contextElement}function X_(e){const t=$k(e);if(!Wu(t))return qu(1);const i=t.getBoundingClientRect(),{width:c,height:f,$:_}=j4(t);let x=(_?iT(i.width):i.width)/c,o=(_?iT(i.height):i.height)/f;return(!x||!Number.isFinite(x))&&(x=1),(!o||!Number.isFinite(o))&&(o=1),{x,y:o}}const QX=qu(0);function R4(e){const t=Ul(e);return!Uk()||!t.visualViewport?QX:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function eK(e,t,i){return t===void 0&&(t=!1),!i||t&&i!==Ul(e)?!1:t}function Cm(e,t,i,c){t===void 0&&(t=!1),i===void 0&&(i=!1);const f=e.getBoundingClientRect(),_=$k(e);let x=qu(1);t&&(c?Qc(c)&&(x=X_(c)):x=X_(e));const o=eK(_,i,c)?R4(_):qu(0);let I=(f.left+o.x)/x.x,P=(f.top+o.y)/x.y,N=f.width/x.x,U=f.height/x.y;if(_){const $=Ul(_),B=c&&Qc(c)?Ul(c):c;let Y=$,H=OI(Y);for(;H&&c&&B!==Y;){const K=X_(H),re=H.getBoundingClientRect(),G=eu(H),X=re.left+(H.clientLeft+parseFloat(G.paddingLeft))*K.x,ue=re.top+(H.clientTop+parseFloat(G.paddingTop))*K.y;I*=K.x,P*=K.y,N*=K.x,U*=K.y,I+=X,P+=ue,Y=Ul(H),H=OI(Y)}}return oT({width:N,height:U,x:I,y:P})}function qk(e,t){const i=QT(e).scrollLeft;return t?t.left+i:Cm(Ku(e)).left+i}function M4(e,t,i){i===void 0&&(i=!1);const c=e.getBoundingClientRect(),f=c.left+t.scrollLeft-(i?0:qk(e,c)),_=c.top+t.scrollTop;return{x:f,y:_}}function tK(e){let{elements:t,rect:i,offsetParent:c,strategy:f}=e;const _=f==="fixed",x=Ku(c),o=t?JT(t.floating):!1;if(c===x||o&&_)return i;let I={scrollLeft:0,scrollTop:0},P=qu(1);const N=qu(0),U=Wu(c);if((U||!U&&!_)&&((Ly(c)!=="body"||bb(x))&&(I=QT(c)),Wu(c))){const B=Cm(c);P=X_(c),N.x=B.x+c.clientLeft,N.y=B.y+c.clientTop}const $=x&&!U&&!_?M4(x,I,!0):qu(0);return{width:i.width*P.x,height:i.height*P.y,x:i.x*P.x-I.scrollLeft*P.x+N.x+$.x,y:i.y*P.y-I.scrollTop*P.y+N.y+$.y}}function rK(e){return Array.from(e.getClientRects())}function nK(e){const t=Ku(e),i=QT(e),c=e.ownerDocument.body,f=Ll(t.scrollWidth,t.clientWidth,c.scrollWidth,c.clientWidth),_=Ll(t.scrollHeight,t.clientHeight,c.scrollHeight,c.clientHeight);let x=-i.scrollLeft+qk(e);const o=-i.scrollTop;return eu(c).direction==="rtl"&&(x+=Ll(t.clientWidth,c.clientWidth)-f),{width:f,height:_,x,y:o}}function iK(e,t){const i=Ul(e),c=Ku(e),f=i.visualViewport;let _=c.clientWidth,x=c.clientHeight,o=0,I=0;if(f){_=f.width,x=f.height;const P=Uk();(!P||P&&t==="fixed")&&(o=f.offsetLeft,I=f.offsetTop)}return{width:_,height:x,x:o,y:I}}const sK=new Set(["absolute","fixed"]);function oK(e,t){const i=Cm(e,!0,t==="fixed"),c=i.top+e.clientTop,f=i.left+e.clientLeft,_=Wu(e)?X_(e):qu(1),x=e.clientWidth*_.x,o=e.clientHeight*_.y,I=f*_.x,P=c*_.y;return{width:x,height:o,x:I,y:P}}function mL(e,t,i){let c;if(t==="viewport")c=iK(e,i);else if(t==="document")c=nK(Ku(e));else if(Qc(t))c=oK(t,i);else{const f=R4(e);c={x:t.x-f.x,y:t.y-f.y,width:t.width,height:t.height}}return oT(c)}function D4(e,t){const i=Lf(e);return i===t||!Qc(i)||xy(i)?!1:eu(i).position==="fixed"||D4(i,t)}function aK(e,t){const i=t.get(e);if(i)return i;let c=Z0(e,[],!1).filter(o=>Qc(o)&&Ly(o)!=="body"),f=null;const _=eu(e).position==="fixed";let x=_?Lf(e):e;for(;Qc(x)&&!xy(x);){const o=eu(x),I=Vk(x);!I&&o.position==="fixed"&&(f=null),(_?!I&&!f:!I&&o.position==="static"&&!!f&&sK.has(f.position)||bb(x)&&!I&&D4(e,x))?c=c.filter(N=>N!==x):f=o,x=Lf(x)}return t.set(e,c),c}function lK(e){let{element:t,boundary:i,rootBoundary:c,strategy:f}=e;const x=[...i==="clippingAncestors"?JT(t)?[]:aK(t,this._c):[].concat(i),c],o=x[0],I=x.reduce((P,N)=>{const U=mL(t,N,f);return P.top=Ll(U.top,P.top),P.right=Of(U.right,P.right),P.bottom=Of(U.bottom,P.bottom),P.left=Ll(U.left,P.left),P},mL(t,o,f));return{width:I.right-I.left,height:I.bottom-I.top,x:I.left,y:I.top}}function cK(e){const{width:t,height:i}=j4(e);return{width:t,height:i}}function uK(e,t,i){const c=Wu(t),f=Ku(t),_=i==="fixed",x=Cm(e,!0,_,t);let o={scrollLeft:0,scrollTop:0};const I=qu(0);function P(){I.x=qk(f)}if(c||!c&&!_)if((Ly(t)!=="body"||bb(f))&&(o=QT(t)),c){const B=Cm(t,!0,_,t);I.x=B.x+t.clientLeft,I.y=B.y+t.clientTop}else f&&P();_&&!c&&f&&P();const N=f&&!c&&!_?M4(f,o):qu(0),U=x.left+o.scrollLeft-I.x-N.x,$=x.top+o.scrollTop-I.y-N.y;return{x:U,y:$,width:x.width,height:x.height}}function nA(e){return eu(e).position==="static"}function gL(e,t){if(!Wu(e)||eu(e).position==="fixed")return null;if(t)return t(e);let i=e.offsetParent;return Ku(e)===i&&(i=i.ownerDocument.body),i}function N4(e,t){const i=Ul(e);if(JT(e))return i;if(!Wu(e)){let f=Lf(e);for(;f&&!xy(f);){if(Qc(f)&&!nA(f))return f;f=Lf(f)}return i}let c=gL(e,t);for(;c&&WX(c)&&nA(c);)c=gL(c,t);return c&&xy(c)&&nA(c)&&!Vk(c)?i:c||YX(e)||i}const dK=async function(e){const t=this.getOffsetParent||N4,i=this.getDimensions,c=await i(e.floating);return{reference:uK(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:c.width,height:c.height}}};function hK(e){return eu(e).direction==="rtl"}const fK={convertOffsetParentRelativeRectToViewportRelativeRect:tK,getDocumentElement:Ku,getClippingRect:lK,getOffsetParent:N4,getElementRects:dK,getClientRects:rK,getDimensions:cK,getScale:X_,isElement:Qc,isRTL:hK};function O4(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function pK(e,t){let i=null,c;const f=Ku(e);function _(){var o;clearTimeout(c),(o=i)==null||o.disconnect(),i=null}function x(o,I){o===void 0&&(o=!1),I===void 0&&(I=1),_();const P=e.getBoundingClientRect(),{left:N,top:U,width:$,height:B}=P;if(o||t(),!$||!B)return;const Y=Zw(U),H=Zw(f.clientWidth-(N+$)),K=Zw(f.clientHeight-(U+B)),re=Zw(N),X={rootMargin:-Y+"px "+-H+"px "+-K+"px "+-re+"px",threshold:Ll(0,Of(1,I))||1};let ue=!0;function Ee(xe){const Ne=xe[0].intersectionRatio;if(Ne!==I){if(!ue)return x();Ne?x(!1,Ne):c=setTimeout(()=>{x(!1,1e-7)},1e3)}Ne===1&&!O4(P,e.getBoundingClientRect())&&x(),ue=!1}try{i=new IntersectionObserver(Ee,{...X,root:f.ownerDocument})}catch{i=new IntersectionObserver(Ee,X)}i.observe(e)}return x(!0),_}function mK(e,t,i,c){c===void 0&&(c={});const{ancestorScroll:f=!0,ancestorResize:_=!0,elementResize:x=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:I=!1}=c,P=$k(e),N=f||_?[...P?Z0(P):[],...Z0(t)]:[];N.forEach(re=>{f&&re.addEventListener("scroll",i,{passive:!0}),_&&re.addEventListener("resize",i)});const U=P&&o?pK(P,i):null;let $=-1,B=null;x&&(B=new ResizeObserver(re=>{let[G]=re;G&&G.target===P&&B&&(B.unobserve(t),cancelAnimationFrame($),$=requestAnimationFrame(()=>{var X;(X=B)==null||X.observe(t)})),i()}),P&&!I&&B.observe(P),B.observe(t));let Y,H=I?Cm(e):null;I&&K();function K(){const re=Cm(e);H&&!O4(H,re)&&i(),H=re,Y=requestAnimationFrame(K)}return i(),()=>{var re;N.forEach(G=>{f&&G.removeEventListener("scroll",i),_&&G.removeEventListener("resize",i)}),U==null||U(),(re=B)==null||re.disconnect(),B=null,I&&cancelAnimationFrame(Y)}}const gK=BX,_K=VX,yK=LX,vK=$X,xK=zX,_L=OX,bK=UX,wK=(e,t,i)=>{const c=new Map,f={platform:fK,...i},_={...f.platform,_c:c};return NX(e,t,{...f,platform:_})};var SK=typeof document<"u",TK=function(){},CS=SK?V.useLayoutEffect:TK;function aT(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let i,c,f;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(i=e.length,i!==t.length)return!1;for(c=i;c--!==0;)if(!aT(e[c],t[c]))return!1;return!0}if(f=Object.keys(e),i=f.length,i!==Object.keys(t).length)return!1;for(c=i;c--!==0;)if(!{}.hasOwnProperty.call(t,f[c]))return!1;for(c=i;c--!==0;){const _=f[c];if(!(_==="_owner"&&e.$$typeof)&&!aT(e[_],t[_]))return!1}return!0}return e!==e&&t!==t}function L4(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function yL(e,t){const i=L4(e);return Math.round(t*i)/i}function iA(e){const t=V.useRef(e);return CS(()=>{t.current=e}),t}function EK(e){e===void 0&&(e={});const{placement:t="bottom",strategy:i="absolute",middleware:c=[],platform:f,elements:{reference:_,floating:x}={},transform:o=!0,whileElementsMounted:I,open:P}=e,[N,U]=V.useState({x:0,y:0,strategy:i,placement:t,middlewareData:{},isPositioned:!1}),[$,B]=V.useState(c);aT($,c)||B(c);const[Y,H]=V.useState(null),[K,re]=V.useState(null),G=V.useCallback($e=>{$e!==xe.current&&(xe.current=$e,H($e))},[]),X=V.useCallback($e=>{$e!==Ne.current&&(Ne.current=$e,re($e))},[]),ue=_||Y,Ee=x||K,xe=V.useRef(null),Ne=V.useRef(null),lt=V.useRef(N),Pt=I!=null,tt=iA(I),yt=iA(f),Me=iA(P),be=V.useCallback(()=>{if(!xe.current||!Ne.current)return;const $e={placement:t,strategy:i,middleware:$};yt.current&&($e.platform=yt.current),wK(xe.current,Ne.current,$e).then(_t=>{const mt={..._t,isPositioned:Me.current!==!1};je.current&&!aT(lt.current,mt)&&(lt.current=mt,zm.flushSync(()=>{U(mt)}))})},[$,t,i,yt,Me]);CS(()=>{P===!1&&lt.current.isPositioned&&(lt.current.isPositioned=!1,U($e=>({...$e,isPositioned:!1})))},[P]);const je=V.useRef(!1);CS(()=>(je.current=!0,()=>{je.current=!1}),[]),CS(()=>{if(ue&&(xe.current=ue),Ee&&(Ne.current=Ee),ue&&Ee){if(tt.current)return tt.current(ue,Ee,be);be()}},[ue,Ee,be,tt,Pt]);const Ye=V.useMemo(()=>({reference:xe,floating:Ne,setReference:G,setFloating:X}),[G,X]),qe=V.useMemo(()=>({reference:ue,floating:Ee}),[ue,Ee]),We=V.useMemo(()=>{const $e={position:i,left:0,top:0};if(!qe.floating)return $e;const _t=yL(qe.floating,N.x),mt=yL(qe.floating,N.y);return o?{...$e,transform:"translate("+_t+"px, "+mt+"px)",...L4(qe.floating)>=1.5&&{willChange:"transform"}}:{position:i,left:_t,top:mt}},[i,o,qe.floating,N.x,N.y]);return V.useMemo(()=>({...N,update:be,refs:Ye,elements:qe,floatingStyles:We}),[N,be,Ye,qe,We])}const CK=e=>{function t(i){return{}.hasOwnProperty.call(i,"current")}return{name:"arrow",options:e,fn(i){const{element:c,padding:f}=typeof e=="function"?e(i):e;return c&&t(c)?c.current!=null?_L({element:c.current,padding:f}).fn(i):{}:c?_L({element:c,padding:f}).fn(i):{}}}},AK=(e,t)=>({...gK(e),options:[e,t]}),IK=(e,t)=>({..._K(e),options:[e,t]}),PK=(e,t)=>({...bK(e),options:[e,t]}),kK=(e,t)=>({...yK(e),options:[e,t]}),jK=(e,t)=>({...vK(e),options:[e,t]}),RK=(e,t)=>({...xK(e),options:[e,t]}),MK=(e,t)=>({...CK(e),options:[e,t]});var DK="Arrow",z4=V.forwardRef((e,t)=>{const{children:i,width:c=10,height:f=5,..._}=e;return h.jsx(xi.svg,{..._,ref:t,width:c,height:f,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?i:h.jsx("polygon",{points:"0,0 30,0 15,10"})})});z4.displayName=DK;var NK=z4;function OK(e){const[t,i]=V.useState(void 0);return ca(()=>{if(e){i({width:e.offsetWidth,height:e.offsetHeight});const c=new ResizeObserver(f=>{if(!Array.isArray(f)||!f.length)return;const _=f[0];let x,o;if("borderBoxSize"in _){const I=_.borderBoxSize,P=Array.isArray(I)?I[0]:I;x=P.inlineSize,o=P.blockSize}else x=e.offsetWidth,o=e.offsetHeight;i({width:x,height:o})});return c.observe(e,{box:"border-box"}),()=>c.unobserve(e)}else i(void 0)},[e]),t}var Gk="Popper",[F4,e2]=Xd(Gk),[LK,B4]=F4(Gk),V4=e=>{const{__scopePopper:t,children:i}=e,[c,f]=V.useState(null);return h.jsx(LK,{scope:t,anchor:c,onAnchorChange:f,children:i})};V4.displayName=Gk;var U4="PopperAnchor",$4=V.forwardRef((e,t)=>{const{__scopePopper:i,virtualRef:c,...f}=e,_=B4(U4,i),x=V.useRef(null),o=vs(t,x);return V.useEffect(()=>{_.onAnchorChange((c==null?void 0:c.current)||x.current)}),c?null:h.jsx(xi.div,{...f,ref:o})});$4.displayName=U4;var Wk="PopperContent",[zK,FK]=F4(Wk),q4=V.forwardRef((e,t)=>{var Bt,Wr,Er,Vr,Ur,jn;const{__scopePopper:i,side:c="bottom",sideOffset:f=0,align:_="center",alignOffset:x=0,arrowPadding:o=0,avoidCollisions:I=!0,collisionBoundary:P=[],collisionPadding:N=0,sticky:U="partial",hideWhenDetached:$=!1,updatePositionStrategy:B="optimized",onPlaced:Y,...H}=e,K=B4(Wk,i),[re,G]=V.useState(null),X=vs(t,yn=>G(yn)),[ue,Ee]=V.useState(null),xe=OK(ue),Ne=(xe==null?void 0:xe.width)??0,lt=(xe==null?void 0:xe.height)??0,Pt=c+(_!=="center"?"-"+_:""),tt=typeof N=="number"?N:{top:0,right:0,bottom:0,left:0,...N},yt=Array.isArray(P)?P:[P],Me=yt.length>0,be={padding:tt,boundary:yt.filter(VK),altBoundary:Me},{refs:je,floatingStyles:Ye,placement:qe,isPositioned:We,middlewareData:$e}=EK({strategy:"fixed",placement:Pt,whileElementsMounted:(...yn)=>mK(...yn,{animationFrame:B==="always"}),elements:{reference:K.anchor},middleware:[AK({mainAxis:f+lt,alignmentAxis:x}),I&&IK({mainAxis:!0,crossAxis:!1,limiter:U==="partial"?PK():void 0,...be}),I&&kK({...be}),jK({...be,apply:({elements:yn,rects:os,availableWidth:qi,availableHeight:ps})=>{const{width:Os,height:Ei}=os.reference,po=yn.floating.style;po.setProperty("--radix-popper-available-width",`${qi}px`),po.setProperty("--radix-popper-available-height",`${ps}px`),po.setProperty("--radix-popper-anchor-width",`${Os}px`),po.setProperty("--radix-popper-anchor-height",`${Ei}px`)}}),ue&&MK({element:ue,padding:o}),UK({arrowWidth:Ne,arrowHeight:lt}),$&&RK({strategy:"referenceHidden",...be})]}),[_t,mt]=H4(qe),rt=fc(Y);ca(()=>{We&&(rt==null||rt())},[We,rt]);const Tt=(Bt=$e.arrow)==null?void 0:Bt.x,Vt=(Wr=$e.arrow)==null?void 0:Wr.y,it=((Er=$e.arrow)==null?void 0:Er.centerOffset)!==0,[ir,wr]=V.useState();return ca(()=>{re&&wr(window.getComputedStyle(re).zIndex)},[re]),h.jsx("div",{ref:je.setFloating,"data-radix-popper-content-wrapper":"",style:{...Ye,transform:We?Ye.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ir,"--radix-popper-transform-origin":[(Vr=$e.transformOrigin)==null?void 0:Vr.x,(Ur=$e.transformOrigin)==null?void 0:Ur.y].join(" "),...((jn=$e.hide)==null?void 0:jn.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:h.jsx(zK,{scope:i,placedSide:_t,onArrowChange:Ee,arrowX:Tt,arrowY:Vt,shouldHideArrow:it,children:h.jsx(xi.div,{"data-side":_t,"data-align":mt,...H,ref:X,style:{...H.style,animation:We?void 0:"none"}})})})});q4.displayName=Wk;var G4="PopperArrow",BK={top:"bottom",right:"left",bottom:"top",left:"right"},W4=V.forwardRef(function(t,i){const{__scopePopper:c,...f}=t,_=FK(G4,c),x=BK[_.placedSide];return h.jsx("span",{ref:_.onArrowChange,style:{position:"absolute",left:_.arrowX,top:_.arrowY,[x]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[_.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[_.placedSide],visibility:_.shouldHideArrow?"hidden":void 0},children:h.jsx(NK,{...f,ref:i,style:{...f.style,display:"block"}})})});W4.displayName=G4;function VK(e){return e!==null}var UK=e=>({name:"transformOrigin",options:e,fn(t){var K,re,G;const{placement:i,rects:c,middlewareData:f}=t,x=((K=f.arrow)==null?void 0:K.centerOffset)!==0,o=x?0:e.arrowWidth,I=x?0:e.arrowHeight,[P,N]=H4(i),U={start:"0%",center:"50%",end:"100%"}[N],$=(((re=f.arrow)==null?void 0:re.x)??0)+o/2,B=(((G=f.arrow)==null?void 0:G.y)??0)+I/2;let Y="",H="";return P==="bottom"?(Y=x?U:`${$}px`,H=`${-I}px`):P==="top"?(Y=x?U:`${$}px`,H=`${c.floating.height+I}px`):P==="right"?(Y=`${-I}px`,H=x?U:`${B}px`):P==="left"&&(Y=`${c.floating.width+I}px`,H=x?U:`${B}px`),{data:{x:Y,y:H}}}});function H4(e){const[t,i="center"]=e.split("-");return[t,i]}var Z4=V4,X4=$4,K4=q4,Y4=W4,[t2,Ice]=Xd("Tooltip",[e2]),r2=e2(),J4="TooltipProvider",$K=700,LI="tooltip.open",[qK,Hk]=t2(J4),Q4=e=>{const{__scopeTooltip:t,delayDuration:i=$K,skipDelayDuration:c=300,disableHoverableContent:f=!1,children:_}=e,x=V.useRef(!0),o=V.useRef(!1),I=V.useRef(0);return V.useEffect(()=>{const P=I.current;return()=>window.clearTimeout(P)},[]),h.jsx(qK,{scope:t,isOpenDelayedRef:x,delayDuration:i,onOpen:V.useCallback(()=>{window.clearTimeout(I.current),x.current=!1},[]),onClose:V.useCallback(()=>{window.clearTimeout(I.current),I.current=window.setTimeout(()=>x.current=!0,c)},[c]),isPointerInTransitRef:o,onPointerInTransitChange:V.useCallback(P=>{o.current=P},[]),disableHoverableContent:f,children:_})};Q4.displayName=J4;var X0="Tooltip",[GK,n2]=t2(X0),e5=e=>{const{__scopeTooltip:t,children:i,open:c,defaultOpen:f,onOpenChange:_,disableHoverableContent:x,delayDuration:o}=e,I=Hk(X0,e.__scopeTooltip),P=r2(t),[N,U]=V.useState(null),$=zd(),B=V.useRef(0),Y=x??I.disableHoverableContent,H=o??I.delayDuration,K=V.useRef(!1),[re,G]=Em({prop:c,defaultProp:f??!1,onChange:Ne=>{Ne?(I.onOpen(),document.dispatchEvent(new CustomEvent(LI))):I.onClose(),_==null||_(Ne)},caller:X0}),X=V.useMemo(()=>re?K.current?"delayed-open":"instant-open":"closed",[re]),ue=V.useCallback(()=>{window.clearTimeout(B.current),B.current=0,K.current=!1,G(!0)},[G]),Ee=V.useCallback(()=>{window.clearTimeout(B.current),B.current=0,G(!1)},[G]),xe=V.useCallback(()=>{window.clearTimeout(B.current),B.current=window.setTimeout(()=>{K.current=!0,G(!0),B.current=0},H)},[H,G]);return V.useEffect(()=>()=>{B.current&&(window.clearTimeout(B.current),B.current=0)},[]),h.jsx(Z4,{...P,children:h.jsx(GK,{scope:t,contentId:$,open:re,stateAttribute:X,trigger:N,onTriggerChange:U,onTriggerEnter:V.useCallback(()=>{I.isOpenDelayedRef.current?xe():ue()},[I.isOpenDelayedRef,xe,ue]),onTriggerLeave:V.useCallback(()=>{Y?Ee():(window.clearTimeout(B.current),B.current=0)},[Ee,Y]),onOpen:ue,onClose:Ee,disableHoverableContent:Y,children:i})})};e5.displayName=X0;var zI="TooltipTrigger",t5=V.forwardRef((e,t)=>{const{__scopeTooltip:i,...c}=e,f=n2(zI,i),_=Hk(zI,i),x=r2(i),o=V.useRef(null),I=vs(t,o,f.onTriggerChange),P=V.useRef(!1),N=V.useRef(!1),U=V.useCallback(()=>P.current=!1,[]);return V.useEffect(()=>()=>document.removeEventListener("pointerup",U),[U]),h.jsx(X4,{asChild:!0,...x,children:h.jsx(xi.button,{"aria-describedby":f.open?f.contentId:void 0,"data-state":f.stateAttribute,...c,ref:I,onPointerMove:Un(e.onPointerMove,$=>{$.pointerType!=="touch"&&!N.current&&!_.isPointerInTransitRef.current&&(f.onTriggerEnter(),N.current=!0)}),onPointerLeave:Un(e.onPointerLeave,()=>{f.onTriggerLeave(),N.current=!1}),onPointerDown:Un(e.onPointerDown,()=>{f.open&&f.onClose(),P.current=!0,document.addEventListener("pointerup",U,{once:!0})}),onFocus:Un(e.onFocus,()=>{P.current||f.onOpen()}),onBlur:Un(e.onBlur,f.onClose),onClick:Un(e.onClick,f.onClose)})})});t5.displayName=zI;var WK="TooltipPortal",[Pce,HK]=t2(WK,{forceMount:void 0}),by="TooltipContent",r5=V.forwardRef((e,t)=>{const i=HK(by,e.__scopeTooltip),{forceMount:c=i.forceMount,side:f="top",..._}=e,x=n2(by,e.__scopeTooltip);return h.jsx(Bm,{present:c||x.open,children:x.disableHoverableContent?h.jsx(n5,{side:f,..._,ref:t}):h.jsx(ZK,{side:f,..._,ref:t})})}),ZK=V.forwardRef((e,t)=>{const i=n2(by,e.__scopeTooltip),c=Hk(by,e.__scopeTooltip),f=V.useRef(null),_=vs(t,f),[x,o]=V.useState(null),{trigger:I,onClose:P}=i,N=f.current,{onPointerInTransitChange:U}=c,$=V.useCallback(()=>{o(null),U(!1)},[U]),B=V.useCallback((Y,H)=>{const K=Y.currentTarget,re={x:Y.clientX,y:Y.clientY},G=QK(re,K.getBoundingClientRect()),X=eY(re,G),ue=tY(H.getBoundingClientRect()),Ee=nY([...X,...ue]);o(Ee),U(!0)},[U]);return V.useEffect(()=>()=>$(),[$]),V.useEffect(()=>{if(I&&N){const Y=K=>B(K,N),H=K=>B(K,I);return I.addEventListener("pointerleave",Y),N.addEventListener("pointerleave",H),()=>{I.removeEventListener("pointerleave",Y),N.removeEventListener("pointerleave",H)}}},[I,N,B,$]),V.useEffect(()=>{if(x){const Y=H=>{const K=H.target,re={x:H.clientX,y:H.clientY},G=(I==null?void 0:I.contains(K))||(N==null?void 0:N.contains(K)),X=!rY(re,x);G?$():X&&($(),P())};return document.addEventListener("pointermove",Y),()=>document.removeEventListener("pointermove",Y)}},[I,N,x,P,$]),h.jsx(n5,{...e,ref:_})}),[XK,KK]=t2(X0,{isInside:!1}),YK=LB("TooltipContent"),n5=V.forwardRef((e,t)=>{const{__scopeTooltip:i,children:c,"aria-label":f,onEscapeKeyDown:_,onPointerDownOutside:x,...o}=e,I=n2(by,i),P=r2(i),{onClose:N}=I;return V.useEffect(()=>(document.addEventListener(LI,N),()=>document.removeEventListener(LI,N)),[N]),V.useEffect(()=>{if(I.trigger){const U=$=>{const B=$.target;B!=null&&B.contains(I.trigger)&&N()};return window.addEventListener("scroll",U,{capture:!0}),()=>window.removeEventListener("scroll",U,{capture:!0})}},[I.trigger,N]),h.jsx(gb,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:_,onPointerDownOutside:x,onFocusOutside:U=>U.preventDefault(),onDismiss:N,children:h.jsxs(K4,{"data-state":I.stateAttribute,...P,...o,ref:t,style:{...o.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[h.jsx(YK,{children:c}),h.jsx(XK,{scope:i,isInside:!0,children:h.jsx(v7,{id:I.contentId,role:"tooltip",children:f||c})})]})})});r5.displayName=by;var i5="TooltipArrow",JK=V.forwardRef((e,t)=>{const{__scopeTooltip:i,...c}=e,f=r2(i);return KK(i5,i).isInside?null:h.jsx(Y4,{...f,...c,ref:t})});JK.displayName=i5;function QK(e,t){const i=Math.abs(t.top-e.y),c=Math.abs(t.bottom-e.y),f=Math.abs(t.right-e.x),_=Math.abs(t.left-e.x);switch(Math.min(i,c,f,_)){case _:return"left";case f:return"right";case i:return"top";case c:return"bottom";default:throw new Error("unreachable")}}function eY(e,t,i=5){const c=[];switch(t){case"top":c.push({x:e.x-i,y:e.y+i},{x:e.x+i,y:e.y+i});break;case"bottom":c.push({x:e.x-i,y:e.y-i},{x:e.x+i,y:e.y-i});break;case"left":c.push({x:e.x+i,y:e.y-i},{x:e.x+i,y:e.y+i});break;case"right":c.push({x:e.x-i,y:e.y-i},{x:e.x-i,y:e.y+i});break}return c}function tY(e){const{top:t,right:i,bottom:c,left:f}=e;return[{x:f,y:t},{x:i,y:t},{x:i,y:c},{x:f,y:c}]}function rY(e,t){const{x:i,y:c}=e;let f=!1;for(let _=0,x=t.length-1;_<t.length;x=_++){const o=t[_],I=t[x],P=o.x,N=o.y,U=I.x,$=I.y;N>c!=$>c&&i<(U-P)*(c-N)/($-N)+P&&(f=!f)}return f}function nY(e){const t=e.slice();return t.sort((i,c)=>i.x<c.x?-1:i.x>c.x?1:i.y<c.y?-1:i.y>c.y?1:0),iY(t)}function iY(e){if(e.length<=1)return e.slice();const t=[];for(let c=0;c<e.length;c++){const f=e[c];for(;t.length>=2;){const _=t[t.length-1],x=t[t.length-2];if((_.x-x.x)*(f.y-x.y)>=(_.y-x.y)*(f.x-x.x))t.pop();else break}t.push(f)}t.pop();const i=[];for(let c=e.length-1;c>=0;c--){const f=e[c];for(;i.length>=2;){const _=i[i.length-1],x=i[i.length-2];if((_.x-x.x)*(f.y-x.y)>=(_.y-x.y)*(f.x-x.x))i.pop();else break}i.push(f)}return i.pop(),t.length===1&&i.length===1&&t[0].x===i[0].x&&t[0].y===i[0].y?t:t.concat(i)}var sY=Q4,oY=e5,aY=t5,s5=r5;const o5=sY,lY=oY,cY=aY,a5=V.forwardRef(({className:e,sideOffset:t=4,...i},c)=>h.jsx(s5,{ref:c,sideOffset:t,className:yr("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...i}));a5.displayName=s5.displayName;var zy=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Am=typeof window>"u"||"Deno"in globalThis;function Ga(){}function uY(e,t){return typeof e=="function"?e(t):e}function FI(e){return typeof e=="number"&&e>=0&&e!==1/0}function l5(e,t){return Math.max(e+(t||0)-Date.now(),0)}function Pf(e,t){return typeof e=="function"?e(t):e}function sc(e,t){return typeof e=="function"?e(t):e}function vL(e,t){const{type:i="all",exact:c,fetchStatus:f,predicate:_,queryKey:x,stale:o}=e;if(x){if(c){if(t.queryHash!==Zk(x,t.options))return!1}else if(!K0(t.queryKey,x))return!1}if(i!=="all"){const I=t.isActive();if(i==="active"&&!I||i==="inactive"&&I)return!1}return!(typeof o=="boolean"&&t.isStale()!==o||f&&f!==t.state.fetchStatus||_&&!_(t))}function xL(e,t){const{exact:i,status:c,predicate:f,mutationKey:_}=e;if(_){if(!t.options.mutationKey)return!1;if(i){if(Im(t.options.mutationKey)!==Im(_))return!1}else if(!K0(t.options.mutationKey,_))return!1}return!(c&&t.state.status!==c||f&&!f(t))}function Zk(e,t){return((t==null?void 0:t.queryKeyHashFn)||Im)(e)}function Im(e){return JSON.stringify(e,(t,i)=>BI(i)?Object.keys(i).sort().reduce((c,f)=>(c[f]=i[f],c),{}):i)}function K0(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(i=>K0(e[i],t[i])):!1}function c5(e,t){if(e===t)return e;const i=bL(e)&&bL(t);if(i||BI(e)&&BI(t)){const c=i?e:Object.keys(e),f=c.length,_=i?t:Object.keys(t),x=_.length,o=i?[]:{},I=new Set(c);let P=0;for(let N=0;N<x;N++){const U=i?N:_[N];(!i&&I.has(U)||i)&&e[U]===void 0&&t[U]===void 0?(o[U]=void 0,P++):(o[U]=c5(e[U],t[U]),o[U]===e[U]&&e[U]!==void 0&&P++)}return f===x&&P===f?e:o}return t}function lT(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(e[i]!==t[i])return!1;return!0}function bL(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function BI(e){if(!wL(e))return!1;const t=e.constructor;if(t===void 0)return!0;const i=t.prototype;return!(!wL(i)||!i.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function wL(e){return Object.prototype.toString.call(e)==="[object Object]"}function dY(e){return new Promise(t=>{setTimeout(t,e)})}function VI(e,t,i){return typeof i.structuralSharing=="function"?i.structuralSharing(e,t):i.structuralSharing!==!1?c5(e,t):t}function hY(e,t,i=0){const c=[...e,t];return i&&c.length>i?c.slice(1):c}function fY(e,t,i=0){const c=[t,...e];return i&&c.length>i?c.slice(0,-1):c}var Xk=Symbol();function u5(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===Xk?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function d5(e,t){return typeof e=="function"?e(...t):!!e}var lm,of,ey,uF,pY=(uF=class extends zy{constructor(){super();Rn(this,lm);Rn(this,of);Rn(this,ey);Yr(this,ey,t=>{if(!Am&&window.addEventListener){const i=()=>t();return window.addEventListener("visibilitychange",i,!1),()=>{window.removeEventListener("visibilitychange",i)}}})}onSubscribe(){ot(this,of)||this.setEventListener(ot(this,ey))}onUnsubscribe(){var t;this.hasListeners()||((t=ot(this,of))==null||t.call(this),Yr(this,of,void 0))}setEventListener(t){var i;Yr(this,ey,t),(i=ot(this,of))==null||i.call(this),Yr(this,of,t(c=>{typeof c=="boolean"?this.setFocused(c):this.onFocus()}))}setFocused(t){ot(this,lm)!==t&&(Yr(this,lm,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(i=>{i(t)})}isFocused(){var t;return typeof ot(this,lm)=="boolean"?ot(this,lm):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},lm=new WeakMap,of=new WeakMap,ey=new WeakMap,uF),Kk=new pY,ty,af,ry,dF,mY=(dF=class extends zy{constructor(){super();Rn(this,ty,!0);Rn(this,af);Rn(this,ry);Yr(this,ry,t=>{if(!Am&&window.addEventListener){const i=()=>t(!0),c=()=>t(!1);return window.addEventListener("online",i,!1),window.addEventListener("offline",c,!1),()=>{window.removeEventListener("online",i),window.removeEventListener("offline",c)}}})}onSubscribe(){ot(this,af)||this.setEventListener(ot(this,ry))}onUnsubscribe(){var t;this.hasListeners()||((t=ot(this,af))==null||t.call(this),Yr(this,af,void 0))}setEventListener(t){var i;Yr(this,ry,t),(i=ot(this,af))==null||i.call(this),Yr(this,af,t(this.setOnline.bind(this)))}setOnline(t){ot(this,ty)!==t&&(Yr(this,ty,t),this.listeners.forEach(c=>{c(t)}))}isOnline(){return ot(this,ty)}},ty=new WeakMap,af=new WeakMap,ry=new WeakMap,dF),cT=new mY;function UI(){let e,t;const i=new Promise((f,_)=>{e=f,t=_});i.status="pending",i.catch(()=>{});function c(f){Object.assign(i,f),delete i.resolve,delete i.reject}return i.resolve=f=>{c({status:"fulfilled",value:f}),e(f)},i.reject=f=>{c({status:"rejected",reason:f}),t(f)},i}function gY(e){return Math.min(1e3*2**e,3e4)}function h5(e){return(e??"online")==="online"?cT.isOnline():!0}var f5=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function sA(e){return e instanceof f5}function p5(e){let t=!1,i=0,c=!1,f;const _=UI(),x=H=>{var K;c||($(new f5(H)),(K=e.abort)==null||K.call(e))},o=()=>{t=!0},I=()=>{t=!1},P=()=>Kk.isFocused()&&(e.networkMode==="always"||cT.isOnline())&&e.canRun(),N=()=>h5(e.networkMode)&&e.canRun(),U=H=>{var K;c||(c=!0,(K=e.onSuccess)==null||K.call(e,H),f==null||f(),_.resolve(H))},$=H=>{var K;c||(c=!0,(K=e.onError)==null||K.call(e,H),f==null||f(),_.reject(H))},B=()=>new Promise(H=>{var K;f=re=>{(c||P())&&H(re)},(K=e.onPause)==null||K.call(e)}).then(()=>{var H;f=void 0,c||(H=e.onContinue)==null||H.call(e)}),Y=()=>{if(c)return;let H;const K=i===0?e.initialPromise:void 0;try{H=K??e.fn()}catch(re){H=Promise.reject(re)}Promise.resolve(H).then(U).catch(re=>{var xe;if(c)return;const G=e.retry??(Am?0:3),X=e.retryDelay??gY,ue=typeof X=="function"?X(i,re):X,Ee=G===!0||typeof G=="number"&&i<G||typeof G=="function"&&G(i,re);if(t||!Ee){$(re);return}i++,(xe=e.onFail)==null||xe.call(e,i,re),dY(ue).then(()=>P()?void 0:B()).then(()=>{t?$(re):Y()})})};return{promise:_,cancel:x,continue:()=>(f==null||f(),_),cancelRetry:o,continueRetry:I,canStart:N,start:()=>(N()?Y():B().then(Y),_)}}var _Y=e=>setTimeout(e,0);function yY(){let e=[],t=0,i=o=>{o()},c=o=>{o()},f=_Y;const _=o=>{t?e.push(o):f(()=>{i(o)})},x=()=>{const o=e;e=[],o.length&&f(()=>{c(()=>{o.forEach(I=>{i(I)})})})};return{batch:o=>{let I;t++;try{I=o()}finally{t--,t||x()}return I},batchCalls:o=>(...I)=>{_(()=>{o(...I)})},schedule:_,setNotifyFunction:o=>{i=o},setBatchNotifyFunction:o=>{c=o},setScheduler:o=>{f=o}}}var Vo=yY(),cm,hF,m5=(hF=class{constructor(){Rn(this,cm)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),FI(this.gcTime)&&Yr(this,cm,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(Am?1/0:5*60*1e3))}clearGcTimeout(){ot(this,cm)&&(clearTimeout(ot(this,cm)),Yr(this,cm,void 0))}},cm=new WeakMap,hF),ny,um,ic,dm,ba,ab,hm,Uc,Ed,fF,vY=(fF=class extends m5{constructor(t){super();Rn(this,Uc);Rn(this,ny);Rn(this,um);Rn(this,ic);Rn(this,dm);Rn(this,ba);Rn(this,ab);Rn(this,hm);Yr(this,hm,!1),Yr(this,ab,t.defaultOptions),this.setOptions(t.options),this.observers=[],Yr(this,dm,t.client),Yr(this,ic,ot(this,dm).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,Yr(this,ny,xY(this.options)),this.state=t.state??ot(this,ny),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=ot(this,ba))==null?void 0:t.promise}setOptions(t){this.options={...ot(this,ab),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&ot(this,ic).remove(this)}setData(t,i){const c=VI(this.state.data,t,this.options);return Si(this,Uc,Ed).call(this,{data:c,type:"success",dataUpdatedAt:i==null?void 0:i.updatedAt,manual:i==null?void 0:i.manual}),c}setState(t,i){Si(this,Uc,Ed).call(this,{type:"setState",state:t,setStateOptions:i})}cancel(t){var c,f;const i=(c=ot(this,ba))==null?void 0:c.promise;return(f=ot(this,ba))==null||f.cancel(t),i?i.then(Ga).catch(Ga):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(ot(this,ny))}isActive(){return this.observers.some(t=>sc(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Xk||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>Pf(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!l5(this.state.dataUpdatedAt,t)}onFocus(){var i;const t=this.observers.find(c=>c.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(i=ot(this,ba))==null||i.continue()}onOnline(){var i;const t=this.observers.find(c=>c.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(i=ot(this,ba))==null||i.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),ot(this,ic).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(i=>i!==t),this.observers.length||(ot(this,ba)&&(ot(this,hm)?ot(this,ba).cancel({revert:!0}):ot(this,ba).cancelRetry()),this.scheduleGc()),ot(this,ic).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Si(this,Uc,Ed).call(this,{type:"invalidate"})}fetch(t,i){var P,N,U;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(i!=null&&i.cancelRefetch))this.cancel({silent:!0});else if(ot(this,ba))return ot(this,ba).continueRetry(),ot(this,ba).promise}if(t&&this.setOptions(t),!this.options.queryFn){const $=this.observers.find(B=>B.options.queryFn);$&&this.setOptions($.options)}const c=new AbortController,f=$=>{Object.defineProperty($,"signal",{enumerable:!0,get:()=>(Yr(this,hm,!0),c.signal)})},_=()=>{const $=u5(this.options,i),Y=(()=>{const H={client:ot(this,dm),queryKey:this.queryKey,meta:this.meta};return f(H),H})();return Yr(this,hm,!1),this.options.persister?this.options.persister($,Y,this):$(Y)},o=(()=>{const $={fetchOptions:i,options:this.options,queryKey:this.queryKey,client:ot(this,dm),state:this.state,fetchFn:_};return f($),$})();(P=this.options.behavior)==null||P.onFetch(o,this),Yr(this,um,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((N=o.fetchOptions)==null?void 0:N.meta))&&Si(this,Uc,Ed).call(this,{type:"fetch",meta:(U=o.fetchOptions)==null?void 0:U.meta});const I=$=>{var B,Y,H,K;sA($)&&$.silent||Si(this,Uc,Ed).call(this,{type:"error",error:$}),sA($)||((Y=(B=ot(this,ic).config).onError)==null||Y.call(B,$,this),(K=(H=ot(this,ic).config).onSettled)==null||K.call(H,this.state.data,$,this)),this.scheduleGc()};return Yr(this,ba,p5({initialPromise:i==null?void 0:i.initialPromise,fn:o.fetchFn,abort:c.abort.bind(c),onSuccess:$=>{var B,Y,H,K;if($===void 0){I(new Error(`${this.queryHash} data is undefined`));return}try{this.setData($)}catch(re){I(re);return}(Y=(B=ot(this,ic).config).onSuccess)==null||Y.call(B,$,this),(K=(H=ot(this,ic).config).onSettled)==null||K.call(H,$,this.state.error,this),this.scheduleGc()},onError:I,onFail:($,B)=>{Si(this,Uc,Ed).call(this,{type:"failed",failureCount:$,error:B})},onPause:()=>{Si(this,Uc,Ed).call(this,{type:"pause"})},onContinue:()=>{Si(this,Uc,Ed).call(this,{type:"continue"})},retry:o.options.retry,retryDelay:o.options.retryDelay,networkMode:o.options.networkMode,canRun:()=>!0})),ot(this,ba).start()}},ny=new WeakMap,um=new WeakMap,ic=new WeakMap,dm=new WeakMap,ba=new WeakMap,ab=new WeakMap,hm=new WeakMap,Uc=new WeakSet,Ed=function(t){const i=c=>{switch(t.type){case"failed":return{...c,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...c,fetchStatus:"paused"};case"continue":return{...c,fetchStatus:"fetching"};case"fetch":return{...c,...g5(c.data,this.options),fetchMeta:t.meta??null};case"success":return Yr(this,um,void 0),{...c,data:t.data,dataUpdateCount:c.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const f=t.error;return sA(f)&&f.revert&&ot(this,um)?{...ot(this,um),fetchStatus:"idle"}:{...c,error:f,errorUpdateCount:c.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:c.fetchFailureCount+1,fetchFailureReason:f,fetchStatus:"idle",status:"error"};case"invalidate":return{...c,isInvalidated:!0};case"setState":return{...c,...t.state}}};this.state=i(this.state),Vo.batch(()=>{this.observers.forEach(c=>{c.onQueryUpdate()}),ot(this,ic).notify({query:this,type:"updated",action:t})})},fF);function g5(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:h5(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function xY(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,i=t!==void 0,c=i?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:i?c??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:i?"success":"pending",fetchStatus:"idle"}}var ju,pF,bY=(pF=class extends zy{constructor(t={}){super();Rn(this,ju);this.config=t,Yr(this,ju,new Map)}build(t,i,c){const f=i.queryKey,_=i.queryHash??Zk(f,i);let x=this.get(_);return x||(x=new vY({client:t,queryKey:f,queryHash:_,options:t.defaultQueryOptions(i),state:c,defaultOptions:t.getQueryDefaults(f)}),this.add(x)),x}add(t){ot(this,ju).has(t.queryHash)||(ot(this,ju).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const i=ot(this,ju).get(t.queryHash);i&&(t.destroy(),i===t&&ot(this,ju).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Vo.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return ot(this,ju).get(t)}getAll(){return[...ot(this,ju).values()]}find(t){const i={exact:!0,...t};return this.getAll().find(c=>vL(i,c))}findAll(t={}){const i=this.getAll();return Object.keys(t).length>0?i.filter(c=>vL(t,c)):i}notify(t){Vo.batch(()=>{this.listeners.forEach(i=>{i(t)})})}onFocus(){Vo.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){Vo.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},ju=new WeakMap,pF),Ru,Ua,fm,Mu,Yh,mF,wY=(mF=class extends m5{constructor(t){super();Rn(this,Mu);Rn(this,Ru);Rn(this,Ua);Rn(this,fm);this.mutationId=t.mutationId,Yr(this,Ua,t.mutationCache),Yr(this,Ru,[]),this.state=t.state||_5(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){ot(this,Ru).includes(t)||(ot(this,Ru).push(t),this.clearGcTimeout(),ot(this,Ua).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){Yr(this,Ru,ot(this,Ru).filter(i=>i!==t)),this.scheduleGc(),ot(this,Ua).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){ot(this,Ru).length||(this.state.status==="pending"?this.scheduleGc():ot(this,Ua).remove(this))}continue(){var t;return((t=ot(this,fm))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var _,x,o,I,P,N,U,$,B,Y,H,K,re,G,X,ue,Ee,xe,Ne,lt;const i=()=>{Si(this,Mu,Yh).call(this,{type:"continue"})};Yr(this,fm,p5({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(Pt,tt)=>{Si(this,Mu,Yh).call(this,{type:"failed",failureCount:Pt,error:tt})},onPause:()=>{Si(this,Mu,Yh).call(this,{type:"pause"})},onContinue:i,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>ot(this,Ua).canRun(this)}));const c=this.state.status==="pending",f=!ot(this,fm).canStart();try{if(c)i();else{Si(this,Mu,Yh).call(this,{type:"pending",variables:t,isPaused:f}),await((x=(_=ot(this,Ua).config).onMutate)==null?void 0:x.call(_,t,this));const tt=await((I=(o=this.options).onMutate)==null?void 0:I.call(o,t));tt!==this.state.context&&Si(this,Mu,Yh).call(this,{type:"pending",context:tt,variables:t,isPaused:f})}const Pt=await ot(this,fm).start();return await((N=(P=ot(this,Ua).config).onSuccess)==null?void 0:N.call(P,Pt,t,this.state.context,this)),await(($=(U=this.options).onSuccess)==null?void 0:$.call(U,Pt,t,this.state.context)),await((Y=(B=ot(this,Ua).config).onSettled)==null?void 0:Y.call(B,Pt,null,this.state.variables,this.state.context,this)),await((K=(H=this.options).onSettled)==null?void 0:K.call(H,Pt,null,t,this.state.context)),Si(this,Mu,Yh).call(this,{type:"success",data:Pt}),Pt}catch(Pt){try{throw await((G=(re=ot(this,Ua).config).onError)==null?void 0:G.call(re,Pt,t,this.state.context,this)),await((ue=(X=this.options).onError)==null?void 0:ue.call(X,Pt,t,this.state.context)),await((xe=(Ee=ot(this,Ua).config).onSettled)==null?void 0:xe.call(Ee,void 0,Pt,this.state.variables,this.state.context,this)),await((lt=(Ne=this.options).onSettled)==null?void 0:lt.call(Ne,void 0,Pt,t,this.state.context)),Pt}finally{Si(this,Mu,Yh).call(this,{type:"error",error:Pt})}}finally{ot(this,Ua).runNext(this)}}},Ru=new WeakMap,Ua=new WeakMap,fm=new WeakMap,Mu=new WeakSet,Yh=function(t){const i=c=>{switch(t.type){case"failed":return{...c,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...c,isPaused:!0};case"continue":return{...c,isPaused:!1};case"pending":return{...c,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...c,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...c,data:void 0,error:t.error,failureCount:c.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=i(this.state),Vo.batch(()=>{ot(this,Ru).forEach(c=>{c.onMutationUpdate(t)}),ot(this,Ua).notify({mutation:this,type:"updated",action:t})})},mF);function _5(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Pd,$c,lb,gF,SY=(gF=class extends zy{constructor(t={}){super();Rn(this,Pd);Rn(this,$c);Rn(this,lb);this.config=t,Yr(this,Pd,new Set),Yr(this,$c,new Map),Yr(this,lb,0)}build(t,i,c){const f=new wY({mutationCache:this,mutationId:++Aw(this,lb)._,options:t.defaultMutationOptions(i),state:c});return this.add(f),f}add(t){ot(this,Pd).add(t);const i=Xw(t);if(typeof i=="string"){const c=ot(this,$c).get(i);c?c.push(t):ot(this,$c).set(i,[t])}this.notify({type:"added",mutation:t})}remove(t){if(ot(this,Pd).delete(t)){const i=Xw(t);if(typeof i=="string"){const c=ot(this,$c).get(i);if(c)if(c.length>1){const f=c.indexOf(t);f!==-1&&c.splice(f,1)}else c[0]===t&&ot(this,$c).delete(i)}}this.notify({type:"removed",mutation:t})}canRun(t){const i=Xw(t);if(typeof i=="string"){const c=ot(this,$c).get(i),f=c==null?void 0:c.find(_=>_.state.status==="pending");return!f||f===t}else return!0}runNext(t){var c;const i=Xw(t);if(typeof i=="string"){const f=(c=ot(this,$c).get(i))==null?void 0:c.find(_=>_!==t&&_.state.isPaused);return(f==null?void 0:f.continue())??Promise.resolve()}else return Promise.resolve()}clear(){Vo.batch(()=>{ot(this,Pd).forEach(t=>{this.notify({type:"removed",mutation:t})}),ot(this,Pd).clear(),ot(this,$c).clear()})}getAll(){return Array.from(ot(this,Pd))}find(t){const i={exact:!0,...t};return this.getAll().find(c=>xL(i,c))}findAll(t={}){return this.getAll().filter(i=>xL(t,i))}notify(t){Vo.batch(()=>{this.listeners.forEach(i=>{i(t)})})}resumePausedMutations(){const t=this.getAll().filter(i=>i.state.isPaused);return Vo.batch(()=>Promise.all(t.map(i=>i.continue().catch(Ga))))}},Pd=new WeakMap,$c=new WeakMap,lb=new WeakMap,gF);function Xw(e){var t;return(t=e.options.scope)==null?void 0:t.id}function SL(e){return{onFetch:(t,i)=>{var N,U,$,B,Y;const c=t.options,f=($=(U=(N=t.fetchOptions)==null?void 0:N.meta)==null?void 0:U.fetchMore)==null?void 0:$.direction,_=((B=t.state.data)==null?void 0:B.pages)||[],x=((Y=t.state.data)==null?void 0:Y.pageParams)||[];let o={pages:[],pageParams:[]},I=0;const P=async()=>{let H=!1;const K=X=>{Object.defineProperty(X,"signal",{enumerable:!0,get:()=>(t.signal.aborted?H=!0:t.signal.addEventListener("abort",()=>{H=!0}),t.signal)})},re=u5(t.options,t.fetchOptions),G=async(X,ue,Ee)=>{if(H)return Promise.reject();if(ue==null&&X.pages.length)return Promise.resolve(X);const Ne=(()=>{const yt={client:t.client,queryKey:t.queryKey,pageParam:ue,direction:Ee?"backward":"forward",meta:t.options.meta};return K(yt),yt})(),lt=await re(Ne),{maxPages:Pt}=t.options,tt=Ee?fY:hY;return{pages:tt(X.pages,lt,Pt),pageParams:tt(X.pageParams,ue,Pt)}};if(f&&_.length){const X=f==="backward",ue=X?TY:TL,Ee={pages:_,pageParams:x},xe=ue(c,Ee);o=await G(Ee,xe,X)}else{const X=e??_.length;do{const ue=I===0?x[0]??c.initialPageParam:TL(c,o);if(I>0&&ue==null)break;o=await G(o,ue),I++}while(I<X)}return o};t.options.persister?t.fetchFn=()=>{var H,K;return(K=(H=t.options).persister)==null?void 0:K.call(H,P,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},i)}:t.fetchFn=P}}}function TL(e,{pages:t,pageParams:i}){const c=t.length-1;return t.length>0?e.getNextPageParam(t[c],t,i[c],i):void 0}function TY(e,{pages:t,pageParams:i}){var c;return t.length>0?(c=e.getPreviousPageParam)==null?void 0:c.call(e,t[0],t,i[0],i):void 0}var co,lf,cf,iy,sy,uf,oy,ay,_F,EY=(_F=class{constructor(e={}){Rn(this,co);Rn(this,lf);Rn(this,cf);Rn(this,iy);Rn(this,sy);Rn(this,uf);Rn(this,oy);Rn(this,ay);Yr(this,co,e.queryCache||new bY),Yr(this,lf,e.mutationCache||new SY),Yr(this,cf,e.defaultOptions||{}),Yr(this,iy,new Map),Yr(this,sy,new Map),Yr(this,uf,0)}mount(){Aw(this,uf)._++,ot(this,uf)===1&&(Yr(this,oy,Kk.subscribe(async e=>{e&&(await this.resumePausedMutations(),ot(this,co).onFocus())})),Yr(this,ay,cT.subscribe(async e=>{e&&(await this.resumePausedMutations(),ot(this,co).onOnline())})))}unmount(){var e,t;Aw(this,uf)._--,ot(this,uf)===0&&((e=ot(this,oy))==null||e.call(this),Yr(this,oy,void 0),(t=ot(this,ay))==null||t.call(this),Yr(this,ay,void 0))}isFetching(e){return ot(this,co).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return ot(this,lf).findAll({...e,status:"pending"}).length}getQueryData(e){var i;const t=this.defaultQueryOptions({queryKey:e});return(i=ot(this,co).get(t.queryHash))==null?void 0:i.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),i=ot(this,co).build(this,t),c=i.state.data;return c===void 0?this.fetchQuery(e):(e.revalidateIfStale&&i.isStaleByTime(Pf(t.staleTime,i))&&this.prefetchQuery(t),Promise.resolve(c))}getQueriesData(e){return ot(this,co).findAll(e).map(({queryKey:t,state:i})=>{const c=i.data;return[t,c]})}setQueryData(e,t,i){const c=this.defaultQueryOptions({queryKey:e}),f=ot(this,co).get(c.queryHash),_=f==null?void 0:f.state.data,x=uY(t,_);if(x!==void 0)return ot(this,co).build(this,c).setData(x,{...i,manual:!0})}setQueriesData(e,t,i){return Vo.batch(()=>ot(this,co).findAll(e).map(({queryKey:c})=>[c,this.setQueryData(c,t,i)]))}getQueryState(e){var i;const t=this.defaultQueryOptions({queryKey:e});return(i=ot(this,co).get(t.queryHash))==null?void 0:i.state}removeQueries(e){const t=ot(this,co);Vo.batch(()=>{t.findAll(e).forEach(i=>{t.remove(i)})})}resetQueries(e,t){const i=ot(this,co);return Vo.batch(()=>(i.findAll(e).forEach(c=>{c.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const i={revert:!0,...t},c=Vo.batch(()=>ot(this,co).findAll(e).map(f=>f.cancel(i)));return Promise.all(c).then(Ga).catch(Ga)}invalidateQueries(e,t={}){return Vo.batch(()=>(ot(this,co).findAll(e).forEach(i=>{i.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const i={...t,cancelRefetch:t.cancelRefetch??!0},c=Vo.batch(()=>ot(this,co).findAll(e).filter(f=>!f.isDisabled()&&!f.isStatic()).map(f=>{let _=f.fetch(void 0,i);return i.throwOnError||(_=_.catch(Ga)),f.state.fetchStatus==="paused"?Promise.resolve():_}));return Promise.all(c).then(Ga)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const i=ot(this,co).build(this,t);return i.isStaleByTime(Pf(t.staleTime,i))?i.fetch(t):Promise.resolve(i.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(Ga).catch(Ga)}fetchInfiniteQuery(e){return e.behavior=SL(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(Ga).catch(Ga)}ensureInfiniteQueryData(e){return e.behavior=SL(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return cT.isOnline()?ot(this,lf).resumePausedMutations():Promise.resolve()}getQueryCache(){return ot(this,co)}getMutationCache(){return ot(this,lf)}getDefaultOptions(){return ot(this,cf)}setDefaultOptions(e){Yr(this,cf,e)}setQueryDefaults(e,t){ot(this,iy).set(Im(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...ot(this,iy).values()],i={};return t.forEach(c=>{K0(e,c.queryKey)&&Object.assign(i,c.defaultOptions)}),i}setMutationDefaults(e,t){ot(this,sy).set(Im(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...ot(this,sy).values()],i={};return t.forEach(c=>{K0(e,c.mutationKey)&&Object.assign(i,c.defaultOptions)}),i}defaultQueryOptions(e){if(e._defaulted)return e;const t={...ot(this,cf).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=Zk(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===Xk&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...ot(this,cf).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){ot(this,co).clear(),ot(this,lf).clear()}},co=new WeakMap,lf=new WeakMap,cf=new WeakMap,iy=new WeakMap,sy=new WeakMap,uf=new WeakMap,oy=new WeakMap,ay=new WeakMap,_F),pl,$i,cb,$a,pm,ly,df,hf,ub,cy,uy,mm,gm,ff,dy,fs,c0,$I,qI,GI,WI,HI,ZI,XI,y5,yF,CY=(yF=class extends zy{constructor(t,i){super();Rn(this,fs);Rn(this,pl);Rn(this,$i);Rn(this,cb);Rn(this,$a);Rn(this,pm);Rn(this,ly);Rn(this,df);Rn(this,hf);Rn(this,ub);Rn(this,cy);Rn(this,uy);Rn(this,mm);Rn(this,gm);Rn(this,ff);Rn(this,dy,new Set);this.options=i,Yr(this,pl,t),Yr(this,hf,null),Yr(this,df,UI()),this.options.experimental_prefetchInRender||ot(this,df).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(i)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(ot(this,$i).addObserver(this),EL(ot(this,$i),this.options)?Si(this,fs,c0).call(this):this.updateResult(),Si(this,fs,WI).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return KI(ot(this,$i),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return KI(ot(this,$i),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,Si(this,fs,HI).call(this),Si(this,fs,ZI).call(this),ot(this,$i).removeObserver(this)}setOptions(t){const i=this.options,c=ot(this,$i);if(this.options=ot(this,pl).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof sc(this.options.enabled,ot(this,$i))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");Si(this,fs,XI).call(this),ot(this,$i).setOptions(this.options),i._defaulted&&!lT(this.options,i)&&ot(this,pl).getQueryCache().notify({type:"observerOptionsUpdated",query:ot(this,$i),observer:this});const f=this.hasListeners();f&&CL(ot(this,$i),c,this.options,i)&&Si(this,fs,c0).call(this),this.updateResult(),f&&(ot(this,$i)!==c||sc(this.options.enabled,ot(this,$i))!==sc(i.enabled,ot(this,$i))||Pf(this.options.staleTime,ot(this,$i))!==Pf(i.staleTime,ot(this,$i)))&&Si(this,fs,$I).call(this);const _=Si(this,fs,qI).call(this);f&&(ot(this,$i)!==c||sc(this.options.enabled,ot(this,$i))!==sc(i.enabled,ot(this,$i))||_!==ot(this,ff))&&Si(this,fs,GI).call(this,_)}getOptimisticResult(t){const i=ot(this,pl).getQueryCache().build(ot(this,pl),t),c=this.createResult(i,t);return IY(this,c)&&(Yr(this,$a,c),Yr(this,ly,this.options),Yr(this,pm,ot(this,$i).state)),c}getCurrentResult(){return ot(this,$a)}trackResult(t,i){return new Proxy(t,{get:(c,f)=>(this.trackProp(f),i==null||i(f),Reflect.get(c,f))})}trackProp(t){ot(this,dy).add(t)}getCurrentQuery(){return ot(this,$i)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const i=ot(this,pl).defaultQueryOptions(t),c=ot(this,pl).getQueryCache().build(ot(this,pl),i);return c.fetch().then(()=>this.createResult(c,i))}fetch(t){return Si(this,fs,c0).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),ot(this,$a)))}createResult(t,i){var Pt;const c=ot(this,$i),f=this.options,_=ot(this,$a),x=ot(this,pm),o=ot(this,ly),P=t!==c?t.state:ot(this,cb),{state:N}=t;let U={...N},$=!1,B;if(i._optimisticResults){const tt=this.hasListeners(),yt=!tt&&EL(t,i),Me=tt&&CL(t,c,i,f);(yt||Me)&&(U={...U,...g5(N.data,t.options)}),i._optimisticResults==="isRestoring"&&(U.fetchStatus="idle")}let{error:Y,errorUpdatedAt:H,status:K}=U;B=U.data;let re=!1;if(i.placeholderData!==void 0&&B===void 0&&K==="pending"){let tt;_!=null&&_.isPlaceholderData&&i.placeholderData===(o==null?void 0:o.placeholderData)?(tt=_.data,re=!0):tt=typeof i.placeholderData=="function"?i.placeholderData((Pt=ot(this,uy))==null?void 0:Pt.state.data,ot(this,uy)):i.placeholderData,tt!==void 0&&(K="success",B=VI(_==null?void 0:_.data,tt,i),$=!0)}if(i.select&&B!==void 0&&!re)if(_&&B===(x==null?void 0:x.data)&&i.select===ot(this,ub))B=ot(this,cy);else try{Yr(this,ub,i.select),B=i.select(B),B=VI(_==null?void 0:_.data,B,i),Yr(this,cy,B),Yr(this,hf,null)}catch(tt){Yr(this,hf,tt)}ot(this,hf)&&(Y=ot(this,hf),B=ot(this,cy),H=Date.now(),K="error");const G=U.fetchStatus==="fetching",X=K==="pending",ue=K==="error",Ee=X&&G,xe=B!==void 0,lt={status:K,fetchStatus:U.fetchStatus,isPending:X,isSuccess:K==="success",isError:ue,isInitialLoading:Ee,isLoading:Ee,data:B,dataUpdatedAt:U.dataUpdatedAt,error:Y,errorUpdatedAt:H,failureCount:U.fetchFailureCount,failureReason:U.fetchFailureReason,errorUpdateCount:U.errorUpdateCount,isFetched:U.dataUpdateCount>0||U.errorUpdateCount>0,isFetchedAfterMount:U.dataUpdateCount>P.dataUpdateCount||U.errorUpdateCount>P.errorUpdateCount,isFetching:G,isRefetching:G&&!X,isLoadingError:ue&&!xe,isPaused:U.fetchStatus==="paused",isPlaceholderData:$,isRefetchError:ue&&xe,isStale:Yk(t,i),refetch:this.refetch,promise:ot(this,df),isEnabled:sc(i.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const tt=be=>{lt.status==="error"?be.reject(lt.error):lt.data!==void 0&&be.resolve(lt.data)},yt=()=>{const be=Yr(this,df,lt.promise=UI());tt(be)},Me=ot(this,df);switch(Me.status){case"pending":t.queryHash===c.queryHash&&tt(Me);break;case"fulfilled":(lt.status==="error"||lt.data!==Me.value)&&yt();break;case"rejected":(lt.status!=="error"||lt.error!==Me.reason)&&yt();break}}return lt}updateResult(){const t=ot(this,$a),i=this.createResult(ot(this,$i),this.options);if(Yr(this,pm,ot(this,$i).state),Yr(this,ly,this.options),ot(this,pm).data!==void 0&&Yr(this,uy,ot(this,$i)),lT(i,t))return;Yr(this,$a,i);const c=()=>{if(!t)return!0;const{notifyOnChangeProps:f}=this.options,_=typeof f=="function"?f():f;if(_==="all"||!_&&!ot(this,dy).size)return!0;const x=new Set(_??ot(this,dy));return this.options.throwOnError&&x.add("error"),Object.keys(ot(this,$a)).some(o=>{const I=o;return ot(this,$a)[I]!==t[I]&&x.has(I)})};Si(this,fs,y5).call(this,{listeners:c()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&Si(this,fs,WI).call(this)}},pl=new WeakMap,$i=new WeakMap,cb=new WeakMap,$a=new WeakMap,pm=new WeakMap,ly=new WeakMap,df=new WeakMap,hf=new WeakMap,ub=new WeakMap,cy=new WeakMap,uy=new WeakMap,mm=new WeakMap,gm=new WeakMap,ff=new WeakMap,dy=new WeakMap,fs=new WeakSet,c0=function(t){Si(this,fs,XI).call(this);let i=ot(this,$i).fetch(this.options,t);return t!=null&&t.throwOnError||(i=i.catch(Ga)),i},$I=function(){Si(this,fs,HI).call(this);const t=Pf(this.options.staleTime,ot(this,$i));if(Am||ot(this,$a).isStale||!FI(t))return;const c=l5(ot(this,$a).dataUpdatedAt,t)+1;Yr(this,mm,setTimeout(()=>{ot(this,$a).isStale||this.updateResult()},c))},qI=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(ot(this,$i)):this.options.refetchInterval)??!1},GI=function(t){Si(this,fs,ZI).call(this),Yr(this,ff,t),!(Am||sc(this.options.enabled,ot(this,$i))===!1||!FI(ot(this,ff))||ot(this,ff)===0)&&Yr(this,gm,setInterval(()=>{(this.options.refetchIntervalInBackground||Kk.isFocused())&&Si(this,fs,c0).call(this)},ot(this,ff)))},WI=function(){Si(this,fs,$I).call(this),Si(this,fs,GI).call(this,Si(this,fs,qI).call(this))},HI=function(){ot(this,mm)&&(clearTimeout(ot(this,mm)),Yr(this,mm,void 0))},ZI=function(){ot(this,gm)&&(clearInterval(ot(this,gm)),Yr(this,gm,void 0))},XI=function(){const t=ot(this,pl).getQueryCache().build(ot(this,pl),this.options);if(t===ot(this,$i))return;const i=ot(this,$i);Yr(this,$i,t),Yr(this,cb,t.state),this.hasListeners()&&(i==null||i.removeObserver(this),t.addObserver(this))},y5=function(t){Vo.batch(()=>{t.listeners&&this.listeners.forEach(i=>{i(ot(this,$a))}),ot(this,pl).getQueryCache().notify({query:ot(this,$i),type:"observerResultsUpdated"})})},yF);function AY(e,t){return sc(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function EL(e,t){return AY(e,t)||e.state.data!==void 0&&KI(e,t,t.refetchOnMount)}function KI(e,t,i){if(sc(t.enabled,e)!==!1&&Pf(t.staleTime,e)!=="static"){const c=typeof i=="function"?i(e):i;return c==="always"||c!==!1&&Yk(e,t)}return!1}function CL(e,t,i,c){return(e!==t||sc(c.enabled,e)===!1)&&(!i.suspense||e.state.status!=="error")&&Yk(e,i)}function Yk(e,t){return sc(t.enabled,e)!==!1&&e.isStaleByTime(Pf(t.staleTime,e))}function IY(e,t){return!lT(e.getCurrentResult(),t)}var pf,mf,ml,kd,Bd,AS,YI,vF,PY=(vF=class extends zy{constructor(i,c){super();Rn(this,Bd);Rn(this,pf);Rn(this,mf);Rn(this,ml);Rn(this,kd);Yr(this,pf,i),this.setOptions(c),this.bindMethods(),Si(this,Bd,AS).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(i){var f;const c=this.options;this.options=ot(this,pf).defaultMutationOptions(i),lT(this.options,c)||ot(this,pf).getMutationCache().notify({type:"observerOptionsUpdated",mutation:ot(this,ml),observer:this}),c!=null&&c.mutationKey&&this.options.mutationKey&&Im(c.mutationKey)!==Im(this.options.mutationKey)?this.reset():((f=ot(this,ml))==null?void 0:f.state.status)==="pending"&&ot(this,ml).setOptions(this.options)}onUnsubscribe(){var i;this.hasListeners()||(i=ot(this,ml))==null||i.removeObserver(this)}onMutationUpdate(i){Si(this,Bd,AS).call(this),Si(this,Bd,YI).call(this,i)}getCurrentResult(){return ot(this,mf)}reset(){var i;(i=ot(this,ml))==null||i.removeObserver(this),Yr(this,ml,void 0),Si(this,Bd,AS).call(this),Si(this,Bd,YI).call(this)}mutate(i,c){var f;return Yr(this,kd,c),(f=ot(this,ml))==null||f.removeObserver(this),Yr(this,ml,ot(this,pf).getMutationCache().build(ot(this,pf),this.options)),ot(this,ml).addObserver(this),ot(this,ml).execute(i)}},pf=new WeakMap,mf=new WeakMap,ml=new WeakMap,kd=new WeakMap,Bd=new WeakSet,AS=function(){var c;const i=((c=ot(this,ml))==null?void 0:c.state)??_5();Yr(this,mf,{...i,isPending:i.status==="pending",isSuccess:i.status==="success",isError:i.status==="error",isIdle:i.status==="idle",mutate:this.mutate,reset:this.reset})},YI=function(i){Vo.batch(()=>{var c,f,_,x,o,I,P,N;if(ot(this,kd)&&this.hasListeners()){const U=ot(this,mf).variables,$=ot(this,mf).context;(i==null?void 0:i.type)==="success"?((f=(c=ot(this,kd)).onSuccess)==null||f.call(c,i.data,U,$),(x=(_=ot(this,kd)).onSettled)==null||x.call(_,i.data,null,U,$)):(i==null?void 0:i.type)==="error"&&((I=(o=ot(this,kd)).onError)==null||I.call(o,i.error,U,$),(N=(P=ot(this,kd)).onSettled)==null||N.call(P,void 0,i.error,U,$))}this.listeners.forEach(U=>{U(ot(this,mf))})})},vF),v5=V.createContext(void 0),i2=e=>{const t=V.useContext(v5);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},kY=({client:e,children:t})=>(V.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),h.jsx(v5.Provider,{value:e,children:t})),x5=V.createContext(!1),jY=()=>V.useContext(x5);x5.Provider;function RY(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var MY=V.createContext(RY()),DY=()=>V.useContext(MY),NY=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},OY=e=>{V.useEffect(()=>{e.clearReset()},[e])},LY=({result:e,errorResetBoundary:t,throwOnError:i,query:c,suspense:f})=>e.isError&&!t.isReset()&&!e.isFetching&&c&&(f&&e.data===void 0||d5(i,[e.error,c])),zY=e=>{if(e.suspense){const t=c=>c==="static"?c:Math.max(c??1e3,1e3),i=e.staleTime;e.staleTime=typeof i=="function"?(...c)=>t(i(...c)):t(i),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},FY=(e,t)=>e.isLoading&&e.isFetching&&!t,BY=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,AL=(e,t,i)=>t.fetchOptimistic(e).catch(()=>{i.clearReset()});function VY(e,t,i){var U,$,B,Y,H;const c=jY(),f=DY(),_=i2(),x=_.defaultQueryOptions(e);($=(U=_.getDefaultOptions().queries)==null?void 0:U._experimental_beforeQuery)==null||$.call(U,x),x._optimisticResults=c?"isRestoring":"optimistic",zY(x),NY(x,f),OY(f);const o=!_.getQueryCache().get(x.queryHash),[I]=V.useState(()=>new t(_,x)),P=I.getOptimisticResult(x),N=!c&&e.subscribed!==!1;if(V.useSyncExternalStore(V.useCallback(K=>{const re=N?I.subscribe(Vo.batchCalls(K)):Ga;return I.updateResult(),re},[I,N]),()=>I.getCurrentResult(),()=>I.getCurrentResult()),V.useEffect(()=>{I.setOptions(x)},[x,I]),BY(x,P))throw AL(x,I,f);if(LY({result:P,errorResetBoundary:f,throwOnError:x.throwOnError,query:_.getQueryCache().get(x.queryHash),suspense:x.suspense}))throw P.error;if((Y=(B=_.getDefaultOptions().queries)==null?void 0:B._experimental_afterQuery)==null||Y.call(B,x,P),x.experimental_prefetchInRender&&!Am&&FY(P,c)){const K=o?AL(x,I,f):(H=_.getQueryCache().get(x.queryHash))==null?void 0:H.promise;K==null||K.catch(Ga).finally(()=>{I.updateResult()})}return x.notifyOnChangeProps?P:I.trackResult(P)}function vo(e,t){return VY(e,CY)}function Kw(e,t){const i=i2(),[c]=V.useState(()=>new PY(i,e));V.useEffect(()=>{c.setOptions(e)},[c,e]);const f=V.useSyncExternalStore(V.useCallback(x=>c.subscribe(Vo.batchCalls(x)),[c]),()=>c.getCurrentResult(),()=>c.getCurrentResult()),_=V.useCallback((x,o)=>{c.mutate(x,o).catch(Ga)},[c]);if(f.error&&d5(c.options.throwOnError,[f.error]))throw f.error;return{...f,mutate:_,mutateAsync:f.mutate}}/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Y0(){return Y0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(e[c]=i[c])}return e},Y0.apply(this,arguments)}var yf;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(yf||(yf={}));const IL="popstate";function UY(e){e===void 0&&(e={});function t(c,f){let{pathname:_,search:x,hash:o}=c.location;return JI("",{pathname:_,search:x,hash:o},f.state&&f.state.usr||null,f.state&&f.state.key||"default")}function i(c,f){return typeof f=="string"?f:uT(f)}return qY(t,i,null,e)}function Ks(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function b5(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function $Y(){return Math.random().toString(36).substr(2,8)}function PL(e,t){return{usr:e.state,key:e.key,idx:t}}function JI(e,t,i,c){return i===void 0&&(i=null),Y0({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Fy(t):t,{state:i,key:t&&t.key||c||$Y()})}function uT(e){let{pathname:t="/",search:i="",hash:c=""}=e;return i&&i!=="?"&&(t+=i.charAt(0)==="?"?i:"?"+i),c&&c!=="#"&&(t+=c.charAt(0)==="#"?c:"#"+c),t}function Fy(e){let t={};if(e){let i=e.indexOf("#");i>=0&&(t.hash=e.substr(i),e=e.substr(0,i));let c=e.indexOf("?");c>=0&&(t.search=e.substr(c),e=e.substr(0,c)),e&&(t.pathname=e)}return t}function qY(e,t,i,c){c===void 0&&(c={});let{window:f=document.defaultView,v5Compat:_=!1}=c,x=f.history,o=yf.Pop,I=null,P=N();P==null&&(P=0,x.replaceState(Y0({},x.state,{idx:P}),""));function N(){return(x.state||{idx:null}).idx}function U(){o=yf.Pop;let K=N(),re=K==null?null:K-P;P=K,I&&I({action:o,location:H.location,delta:re})}function $(K,re){o=yf.Push;let G=JI(H.location,K,re);P=N()+1;let X=PL(G,P),ue=H.createHref(G);try{x.pushState(X,"",ue)}catch(Ee){if(Ee instanceof DOMException&&Ee.name==="DataCloneError")throw Ee;f.location.assign(ue)}_&&I&&I({action:o,location:H.location,delta:1})}function B(K,re){o=yf.Replace;let G=JI(H.location,K,re);P=N();let X=PL(G,P),ue=H.createHref(G);x.replaceState(X,"",ue),_&&I&&I({action:o,location:H.location,delta:0})}function Y(K){let re=f.location.origin!=="null"?f.location.origin:f.location.href,G=typeof K=="string"?K:uT(K);return G=G.replace(/ $/,"%20"),Ks(re,"No window.location.(origin|href) available to create URL for href: "+G),new URL(G,re)}let H={get action(){return o},get location(){return e(f,x)},listen(K){if(I)throw new Error("A history only accepts one active listener");return f.addEventListener(IL,U),I=K,()=>{f.removeEventListener(IL,U),I=null}},createHref(K){return t(f,K)},createURL:Y,encodeLocation(K){let re=Y(K);return{pathname:re.pathname,search:re.search,hash:re.hash}},push:$,replace:B,go(K){return x.go(K)}};return H}var kL;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(kL||(kL={}));function GY(e,t,i){return i===void 0&&(i="/"),WY(e,t,i,!1)}function WY(e,t,i,c){let f=typeof t=="string"?Fy(t):t,_=wy(f.pathname||"/",i);if(_==null)return null;let x=w5(e);HY(x);let o=null;for(let I=0;o==null&&I<x.length;++I){let P=iJ(_);o=rJ(x[I],P,c)}return o}function w5(e,t,i,c){t===void 0&&(t=[]),i===void 0&&(i=[]),c===void 0&&(c="");let f=(_,x,o)=>{let I={relativePath:o===void 0?_.path||"":o,caseSensitive:_.caseSensitive===!0,childrenIndex:x,route:_};I.relativePath.startsWith("/")&&(Ks(I.relativePath.startsWith(c),'Absolute route path "'+I.relativePath+'" nested under path '+('"'+c+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),I.relativePath=I.relativePath.slice(c.length));let P=kf([c,I.relativePath]),N=i.concat(I);_.children&&_.children.length>0&&(Ks(_.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+P+'".')),w5(_.children,t,N,P)),!(_.path==null&&!_.index)&&t.push({path:P,score:eJ(P,_.index),routesMeta:N})};return e.forEach((_,x)=>{var o;if(_.path===""||!((o=_.path)!=null&&o.includes("?")))f(_,x);else for(let I of S5(_.path))f(_,x,I)}),t}function S5(e){let t=e.split("/");if(t.length===0)return[];let[i,...c]=t,f=i.endsWith("?"),_=i.replace(/\?$/,"");if(c.length===0)return f?[_,""]:[_];let x=S5(c.join("/")),o=[];return o.push(...x.map(I=>I===""?_:[_,I].join("/"))),f&&o.push(...x),o.map(I=>e.startsWith("/")&&I===""?"/":I)}function HY(e){e.sort((t,i)=>t.score!==i.score?i.score-t.score:tJ(t.routesMeta.map(c=>c.childrenIndex),i.routesMeta.map(c=>c.childrenIndex)))}const ZY=/^:[\w-]+$/,XY=3,KY=2,YY=1,JY=10,QY=-2,jL=e=>e==="*";function eJ(e,t){let i=e.split("/"),c=i.length;return i.some(jL)&&(c+=QY),t&&(c+=KY),i.filter(f=>!jL(f)).reduce((f,_)=>f+(ZY.test(_)?XY:_===""?YY:JY),c)}function tJ(e,t){return e.length===t.length&&e.slice(0,-1).every((c,f)=>c===t[f])?e[e.length-1]-t[t.length-1]:0}function rJ(e,t,i){let{routesMeta:c}=e,f={},_="/",x=[];for(let o=0;o<c.length;++o){let I=c[o],P=o===c.length-1,N=_==="/"?t:t.slice(_.length)||"/",U=dT({path:I.relativePath,caseSensitive:I.caseSensitive,end:P},N),$=I.route;if(!U&&P&&i&&!c[c.length-1].route.index&&(U=dT({path:I.relativePath,caseSensitive:I.caseSensitive,end:!1},N)),!U)return null;Object.assign(f,U.params),x.push({params:f,pathname:kf([_,U.pathname]),pathnameBase:lJ(kf([_,U.pathnameBase])),route:$}),U.pathnameBase!=="/"&&(_=kf([_,U.pathnameBase]))}return x}function dT(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[i,c]=nJ(e.path,e.caseSensitive,e.end),f=t.match(i);if(!f)return null;let _=f[0],x=_.replace(/(.)\/+$/,"$1"),o=f.slice(1);return{params:c.reduce((P,N,U)=>{let{paramName:$,isOptional:B}=N;if($==="*"){let H=o[U]||"";x=_.slice(0,_.length-H.length).replace(/(.)\/+$/,"$1")}const Y=o[U];return B&&!Y?P[$]=void 0:P[$]=(Y||"").replace(/%2F/g,"/"),P},{}),pathname:_,pathnameBase:x,pattern:e}}function nJ(e,t,i){t===void 0&&(t=!1),i===void 0&&(i=!0),b5(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let c=[],f="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(x,o,I)=>(c.push({paramName:o,isOptional:I!=null}),I?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(c.push({paramName:"*"}),f+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?f+="\\/*$":e!==""&&e!=="/"&&(f+="(?:(?=\\/|$))"),[new RegExp(f,t?void 0:"i"),c]}function iJ(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return b5(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function wy(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,c=e.charAt(i);return c&&c!=="/"?null:e.slice(i)||"/"}function sJ(e,t){t===void 0&&(t="/");let{pathname:i,search:c="",hash:f=""}=typeof e=="string"?Fy(e):e;return{pathname:i?i.startsWith("/")?i:oJ(i,t):t,search:cJ(c),hash:uJ(f)}}function oJ(e,t){let i=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(f=>{f===".."?i.length>1&&i.pop():f!=="."&&i.push(f)}),i.length>1?i.join("/"):"/"}function oA(e,t,i,c){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(c)+"].  Please separate it out to the ")+("`to."+i+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function aJ(e){return e.filter((t,i)=>i===0||t.route.path&&t.route.path.length>0)}function Jk(e,t){let i=aJ(e);return t?i.map((c,f)=>f===i.length-1?c.pathname:c.pathnameBase):i.map(c=>c.pathnameBase)}function Qk(e,t,i,c){c===void 0&&(c=!1);let f;typeof e=="string"?f=Fy(e):(f=Y0({},e),Ks(!f.pathname||!f.pathname.includes("?"),oA("?","pathname","search",f)),Ks(!f.pathname||!f.pathname.includes("#"),oA("#","pathname","hash",f)),Ks(!f.search||!f.search.includes("#"),oA("#","search","hash",f)));let _=e===""||f.pathname==="",x=_?"/":f.pathname,o;if(x==null)o=i;else{let U=t.length-1;if(!c&&x.startsWith("..")){let $=x.split("/");for(;$[0]==="..";)$.shift(),U-=1;f.pathname=$.join("/")}o=U>=0?t[U]:"/"}let I=sJ(f,o),P=x&&x!=="/"&&x.endsWith("/"),N=(_||x===".")&&i.endsWith("/");return!I.pathname.endsWith("/")&&(P||N)&&(I.pathname+="/"),I}const kf=e=>e.join("/").replace(/\/\/+/g,"/"),lJ=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),cJ=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,uJ=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function dJ(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const T5=["post","put","patch","delete"];new Set(T5);const hJ=["get",...T5];new Set(hJ);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function J0(){return J0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(e[c]=i[c])}return e},J0.apply(this,arguments)}const s2=V.createContext(null),E5=V.createContext(null),Kd=V.createContext(null),o2=V.createContext(null),qf=V.createContext({outlet:null,matches:[],isDataRoute:!1}),C5=V.createContext(null);function fJ(e,t){let{relative:i}=t===void 0?{}:t;By()||Ks(!1);let{basename:c,navigator:f}=V.useContext(Kd),{hash:_,pathname:x,search:o}=a2(e,{relative:i}),I=x;return c!=="/"&&(I=x==="/"?c:kf([c,x])),f.createHref({pathname:I,search:o,hash:_})}function By(){return V.useContext(o2)!=null}function Gf(){return By()||Ks(!1),V.useContext(o2).location}function A5(e){V.useContext(Kd).static||V.useLayoutEffect(e)}function cu(){let{isDataRoute:e}=V.useContext(qf);return e?CJ():pJ()}function pJ(){By()||Ks(!1);let e=V.useContext(s2),{basename:t,future:i,navigator:c}=V.useContext(Kd),{matches:f}=V.useContext(qf),{pathname:_}=Gf(),x=JSON.stringify(Jk(f,i.v7_relativeSplatPath)),o=V.useRef(!1);return A5(()=>{o.current=!0}),V.useCallback(function(P,N){if(N===void 0&&(N={}),!o.current)return;if(typeof P=="number"){c.go(P);return}let U=Qk(P,JSON.parse(x),_,N.relative==="path");e==null&&t!=="/"&&(U.pathname=U.pathname==="/"?t:kf([t,U.pathname])),(N.replace?c.replace:c.push)(U,N.state,N)},[t,c,x,_,e])}function a2(e,t){let{relative:i}=t===void 0?{}:t,{future:c}=V.useContext(Kd),{matches:f}=V.useContext(qf),{pathname:_}=Gf(),x=JSON.stringify(Jk(f,c.v7_relativeSplatPath));return V.useMemo(()=>Qk(e,JSON.parse(x),_,i==="path"),[e,x,_,i])}function mJ(e,t){return gJ(e,t)}function gJ(e,t,i,c){By()||Ks(!1);let{navigator:f}=V.useContext(Kd),{matches:_}=V.useContext(qf),x=_[_.length-1],o=x?x.params:{};x&&x.pathname;let I=x?x.pathnameBase:"/";x&&x.route;let P=Gf(),N;if(t){var U;let K=typeof t=="string"?Fy(t):t;I==="/"||(U=K.pathname)!=null&&U.startsWith(I)||Ks(!1),N=K}else N=P;let $=N.pathname||"/",B=$;if(I!=="/"){let K=I.replace(/^\//,"").split("/");B="/"+$.replace(/^\//,"").split("/").slice(K.length).join("/")}let Y=GY(e,{pathname:B}),H=bJ(Y&&Y.map(K=>Object.assign({},K,{params:Object.assign({},o,K.params),pathname:kf([I,f.encodeLocation?f.encodeLocation(K.pathname).pathname:K.pathname]),pathnameBase:K.pathnameBase==="/"?I:kf([I,f.encodeLocation?f.encodeLocation(K.pathnameBase).pathname:K.pathnameBase])})),_,i,c);return t&&H?V.createElement(o2.Provider,{value:{location:J0({pathname:"/",search:"",hash:"",state:null,key:"default"},N),navigationType:yf.Pop}},H):H}function _J(){let e=EJ(),t=dJ(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),i=e instanceof Error?e.stack:null,f={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return V.createElement(V.Fragment,null,V.createElement("h2",null,"Unexpected Application Error!"),V.createElement("h3",{style:{fontStyle:"italic"}},t),i?V.createElement("pre",{style:f},i):null,null)}const yJ=V.createElement(_J,null);class vJ extends V.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,i){return i.location!==t.location||i.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:i.error,location:i.location,revalidation:t.revalidation||i.revalidation}}componentDidCatch(t,i){console.error("React Router caught the following error during render",t,i)}render(){return this.state.error!==void 0?V.createElement(qf.Provider,{value:this.props.routeContext},V.createElement(C5.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function xJ(e){let{routeContext:t,match:i,children:c}=e,f=V.useContext(s2);return f&&f.static&&f.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(f.staticContext._deepestRenderedBoundaryId=i.route.id),V.createElement(qf.Provider,{value:t},c)}function bJ(e,t,i,c){var f;if(t===void 0&&(t=[]),i===void 0&&(i=null),c===void 0&&(c=null),e==null){var _;if(!i)return null;if(i.errors)e=i.matches;else if((_=c)!=null&&_.v7_partialHydration&&t.length===0&&!i.initialized&&i.matches.length>0)e=i.matches;else return null}let x=e,o=(f=i)==null?void 0:f.errors;if(o!=null){let N=x.findIndex(U=>U.route.id&&(o==null?void 0:o[U.route.id])!==void 0);N>=0||Ks(!1),x=x.slice(0,Math.min(x.length,N+1))}let I=!1,P=-1;if(i&&c&&c.v7_partialHydration)for(let N=0;N<x.length;N++){let U=x[N];if((U.route.HydrateFallback||U.route.hydrateFallbackElement)&&(P=N),U.route.id){let{loaderData:$,errors:B}=i,Y=U.route.loader&&$[U.route.id]===void 0&&(!B||B[U.route.id]===void 0);if(U.route.lazy||Y){I=!0,P>=0?x=x.slice(0,P+1):x=[x[0]];break}}}return x.reduceRight((N,U,$)=>{let B,Y=!1,H=null,K=null;i&&(B=o&&U.route.id?o[U.route.id]:void 0,H=U.route.errorElement||yJ,I&&(P<0&&$===0?(Y=!0,K=null):P===$&&(Y=!0,K=U.route.hydrateFallbackElement||null)));let re=t.concat(x.slice(0,$+1)),G=()=>{let X;return B?X=H:Y?X=K:U.route.Component?X=V.createElement(U.route.Component,null):U.route.element?X=U.route.element:X=N,V.createElement(xJ,{match:U,routeContext:{outlet:N,matches:re,isDataRoute:i!=null},children:X})};return i&&(U.route.ErrorBoundary||U.route.errorElement||$===0)?V.createElement(vJ,{location:i.location,revalidation:i.revalidation,component:H,error:B,children:G(),routeContext:{outlet:null,matches:re,isDataRoute:!0}}):G()},null)}var I5=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(I5||{}),hT=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(hT||{});function wJ(e){let t=V.useContext(s2);return t||Ks(!1),t}function SJ(e){let t=V.useContext(E5);return t||Ks(!1),t}function TJ(e){let t=V.useContext(qf);return t||Ks(!1),t}function P5(e){let t=TJ(),i=t.matches[t.matches.length-1];return i.route.id||Ks(!1),i.route.id}function EJ(){var e;let t=V.useContext(C5),i=SJ(hT.UseRouteError),c=P5(hT.UseRouteError);return t!==void 0?t:(e=i.errors)==null?void 0:e[c]}function CJ(){let{router:e}=wJ(I5.UseNavigateStable),t=P5(hT.UseNavigateStable),i=V.useRef(!1);return A5(()=>{i.current=!0}),V.useCallback(function(f,_){_===void 0&&(_={}),i.current&&(typeof f=="number"?e.navigate(f):e.navigate(f,J0({fromRouteId:t},_)))},[e,t])}function AJ(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function IJ(e){let{to:t,replace:i,state:c,relative:f}=e;By()||Ks(!1);let{future:_,static:x}=V.useContext(Kd),{matches:o}=V.useContext(qf),{pathname:I}=Gf(),P=cu(),N=Qk(t,Jk(o,_.v7_relativeSplatPath),I,f==="path"),U=JSON.stringify(N);return V.useEffect(()=>P(JSON.parse(U),{replace:i,state:c,relative:f}),[P,U,f,i,c]),null}function lo(e){Ks(!1)}function PJ(e){let{basename:t="/",children:i=null,location:c,navigationType:f=yf.Pop,navigator:_,static:x=!1,future:o}=e;By()&&Ks(!1);let I=t.replace(/^\/*/,"/"),P=V.useMemo(()=>({basename:I,navigator:_,static:x,future:J0({v7_relativeSplatPath:!1},o)}),[I,o,_,x]);typeof c=="string"&&(c=Fy(c));let{pathname:N="/",search:U="",hash:$="",state:B=null,key:Y="default"}=c,H=V.useMemo(()=>{let K=wy(N,I);return K==null?null:{location:{pathname:K,search:U,hash:$,state:B,key:Y},navigationType:f}},[I,N,U,$,B,Y,f]);return H==null?null:V.createElement(Kd.Provider,{value:P},V.createElement(o2.Provider,{children:i,value:H}))}function kJ(e){let{children:t,location:i}=e;return mJ(QI(t),i)}new Promise(()=>{});function QI(e,t){t===void 0&&(t=[]);let i=[];return V.Children.forEach(e,(c,f)=>{if(!V.isValidElement(c))return;let _=[...t,f];if(c.type===V.Fragment){i.push.apply(i,QI(c.props.children,_));return}c.type!==lo&&Ks(!1),!c.props.index||!c.props.children||Ks(!1);let x={id:c.props.id||_.join("-"),caseSensitive:c.props.caseSensitive,element:c.props.element,Component:c.props.Component,index:c.props.index,path:c.props.path,loader:c.props.loader,action:c.props.action,errorElement:c.props.errorElement,ErrorBoundary:c.props.ErrorBoundary,hasErrorBoundary:c.props.ErrorBoundary!=null||c.props.errorElement!=null,shouldRevalidate:c.props.shouldRevalidate,handle:c.props.handle,lazy:c.props.lazy};c.props.children&&(x.children=QI(c.props.children,_)),i.push(x)}),i}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function fT(){return fT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(e[c]=i[c])}return e},fT.apply(this,arguments)}function k5(e,t){if(e==null)return{};var i={},c=Object.keys(e),f,_;for(_=0;_<c.length;_++)f=c[_],!(t.indexOf(f)>=0)&&(i[f]=e[f]);return i}function jJ(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function RJ(e,t){return e.button===0&&(!t||t==="_self")&&!jJ(e)}const MJ=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],DJ=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],NJ="6";try{window.__reactRouterVersion=NJ}catch{}const OJ=V.createContext({isTransitioning:!1}),LJ="startTransition",RL=zP[LJ];function zJ(e){let{basename:t,children:i,future:c,window:f}=e,_=V.useRef();_.current==null&&(_.current=UY({window:f,v5Compat:!0}));let x=_.current,[o,I]=V.useState({action:x.action,location:x.location}),{v7_startTransition:P}=c||{},N=V.useCallback(U=>{P&&RL?RL(()=>I(U)):I(U)},[I,P]);return V.useLayoutEffect(()=>x.listen(N),[x,N]),V.useEffect(()=>AJ(c),[c]),V.createElement(PJ,{basename:t,children:i,location:o.location,navigationType:o.action,navigator:x,future:c})}const FJ=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",BJ=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,VJ=V.forwardRef(function(t,i){let{onClick:c,relative:f,reloadDocument:_,replace:x,state:o,target:I,to:P,preventScrollReset:N,viewTransition:U}=t,$=k5(t,MJ),{basename:B}=V.useContext(Kd),Y,H=!1;if(typeof P=="string"&&BJ.test(P)&&(Y=P,FJ))try{let X=new URL(window.location.href),ue=P.startsWith("//")?new URL(X.protocol+P):new URL(P),Ee=wy(ue.pathname,B);ue.origin===X.origin&&Ee!=null?P=Ee+ue.search+ue.hash:H=!0}catch{}let K=fJ(P,{relative:f}),re=qJ(P,{replace:x,state:o,target:I,preventScrollReset:N,relative:f,viewTransition:U});function G(X){c&&c(X),X.defaultPrevented||re(X)}return V.createElement("a",fT({},$,{href:Y||K,onClick:H||_?c:G,ref:i,target:I}))}),UJ=V.forwardRef(function(t,i){let{"aria-current":c="page",caseSensitive:f=!1,className:_="",end:x=!1,style:o,to:I,viewTransition:P,children:N}=t,U=k5(t,DJ),$=a2(I,{relative:U.relative}),B=Gf(),Y=V.useContext(E5),{navigator:H,basename:K}=V.useContext(Kd),re=Y!=null&&GJ($)&&P===!0,G=H.encodeLocation?H.encodeLocation($).pathname:$.pathname,X=B.pathname,ue=Y&&Y.navigation&&Y.navigation.location?Y.navigation.location.pathname:null;f||(X=X.toLowerCase(),ue=ue?ue.toLowerCase():null,G=G.toLowerCase()),ue&&K&&(ue=wy(ue,K)||ue);const Ee=G!=="/"&&G.endsWith("/")?G.length-1:G.length;let xe=X===G||!x&&X.startsWith(G)&&X.charAt(Ee)==="/",Ne=ue!=null&&(ue===G||!x&&ue.startsWith(G)&&ue.charAt(G.length)==="/"),lt={isActive:xe,isPending:Ne,isTransitioning:re},Pt=xe?c:void 0,tt;typeof _=="function"?tt=_(lt):tt=[_,xe?"active":null,Ne?"pending":null,re?"transitioning":null].filter(Boolean).join(" ");let yt=typeof o=="function"?o(lt):o;return V.createElement(VJ,fT({},U,{"aria-current":Pt,className:tt,ref:i,style:yt,to:I,viewTransition:P}),typeof N=="function"?N(lt):N)});var eP;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(eP||(eP={}));var ML;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(ML||(ML={}));function $J(e){let t=V.useContext(s2);return t||Ks(!1),t}function qJ(e,t){let{target:i,replace:c,state:f,preventScrollReset:_,relative:x,viewTransition:o}=t===void 0?{}:t,I=cu(),P=Gf(),N=a2(e,{relative:x});return V.useCallback(U=>{if(RJ(U,i)){U.preventDefault();let $=c!==void 0?c:uT(P)===uT(N);I(e,{replace:$,state:f,preventScrollReset:_,relative:x,viewTransition:o})}},[P,I,N,c,f,i,e,_,x,o])}function GJ(e,t){t===void 0&&(t={});let i=V.useContext(OJ);i==null&&Ks(!1);let{basename:c}=$J(eP.useViewTransitionState),f=a2(e,{relative:t.relative});if(!i.isTransitioning)return!1;let _=wy(i.currentLocation.pathname,c)||i.currentLocation.pathname,x=wy(i.nextLocation.pathname,c)||i.nextLocation.pathname;return dT(f.pathname,x)!=null||dT(f.pathname,_)!=null}var tP=function(e,t){return tP=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,c){i.__proto__=c}||function(i,c){for(var f in c)Object.prototype.hasOwnProperty.call(c,f)&&(i[f]=c[f])},tP(e,t)};function j5(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");tP(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}var lc=function(){return lc=Object.assign||function(t){for(var i,c=1,f=arguments.length;c<f;c++){i=arguments[c];for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&(t[_]=i[_])}return t},lc.apply(this,arguments)};function Wf(e,t){var i={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&t.indexOf(c)<0&&(i[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)t.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(i[c[f]]=e[c[f]]);return i}function R5(e,t,i,c){var f=arguments.length,_=f<3?t:c===null?c=Object.getOwnPropertyDescriptor(t,i):c,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(e,t,i,c);else for(var o=e.length-1;o>=0;o--)(x=e[o])&&(_=(f<3?x(_):f>3?x(t,i,_):x(t,i))||_);return f>3&&_&&Object.defineProperty(t,i,_),_}function M5(e,t){return function(i,c){t(i,c,e)}}function D5(e,t,i,c,f,_){function x(re){if(re!==void 0&&typeof re!="function")throw new TypeError("Function expected");return re}for(var o=c.kind,I=o==="getter"?"get":o==="setter"?"set":"value",P=!t&&e?c.static?e:e.prototype:null,N=t||(P?Object.getOwnPropertyDescriptor(P,c.name):{}),U,$=!1,B=i.length-1;B>=0;B--){var Y={};for(var H in c)Y[H]=H==="access"?{}:c[H];for(var H in c.access)Y.access[H]=c.access[H];Y.addInitializer=function(re){if($)throw new TypeError("Cannot add initializers after decoration has completed");_.push(x(re||null))};var K=(0,i[B])(o==="accessor"?{get:N.get,set:N.set}:N[I],Y);if(o==="accessor"){if(K===void 0)continue;if(K===null||typeof K!="object")throw new TypeError("Object expected");(U=x(K.get))&&(N.get=U),(U=x(K.set))&&(N.set=U),(U=x(K.init))&&f.unshift(U)}else(U=x(K))&&(o==="field"?f.unshift(U):N[I]=U)}P&&Object.defineProperty(P,c.name,N),$=!0}function N5(e,t,i){for(var c=arguments.length>2,f=0;f<t.length;f++)i=c?t[f].call(e,i):t[f].call(e);return c?i:void 0}function O5(e){return typeof e=="symbol"?e:"".concat(e)}function L5(e,t,i){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:i?"".concat(i," ",t):t})}function z5(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function _n(e,t,i,c){function f(_){return _ instanceof i?_:new i(function(x){x(_)})}return new(i||(i=Promise))(function(_,x){function o(N){try{P(c.next(N))}catch(U){x(U)}}function I(N){try{P(c.throw(N))}catch(U){x(U)}}function P(N){N.done?_(N.value):f(N.value).then(o,I)}P((c=c.apply(e,t||[])).next())})}function F5(e,t){var i={label:0,sent:function(){if(_[0]&1)throw _[1];return _[1]},trys:[],ops:[]},c,f,_,x=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return x.next=o(0),x.throw=o(1),x.return=o(2),typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function o(P){return function(N){return I([P,N])}}function I(P){if(c)throw new TypeError("Generator is already executing.");for(;x&&(x=0,P[0]&&(i=0)),i;)try{if(c=1,f&&(_=P[0]&2?f.return:P[0]?f.throw||((_=f.return)&&_.call(f),0):f.next)&&!(_=_.call(f,P[1])).done)return _;switch(f=0,_&&(P=[P[0]&2,_.value]),P[0]){case 0:case 1:_=P;break;case 4:return i.label++,{value:P[1],done:!1};case 5:i.label++,f=P[1],P=[0];continue;case 7:P=i.ops.pop(),i.trys.pop();continue;default:if(_=i.trys,!(_=_.length>0&&_[_.length-1])&&(P[0]===6||P[0]===2)){i=0;continue}if(P[0]===3&&(!_||P[1]>_[0]&&P[1]<_[3])){i.label=P[1];break}if(P[0]===6&&i.label<_[1]){i.label=_[1],_=P;break}if(_&&i.label<_[2]){i.label=_[2],i.ops.push(P);break}_[2]&&i.ops.pop(),i.trys.pop();continue}P=t.call(e,i)}catch(N){P=[6,N],f=0}finally{c=_=0}if(P[0]&5)throw P[1];return{value:P[0]?P[1]:void 0,done:!0}}}var l2=Object.create?function(e,t,i,c){c===void 0&&(c=i);var f=Object.getOwnPropertyDescriptor(t,i);(!f||("get"in f?!t.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,c,f)}:function(e,t,i,c){c===void 0&&(c=i),e[c]=t[i]};function B5(e,t){for(var i in e)i!=="default"&&!Object.prototype.hasOwnProperty.call(t,i)&&l2(t,e,i)}function pT(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],c=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&c>=e.length&&(e=void 0),{value:e&&e[c++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ej(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var c=i.call(e),f,_=[],x;try{for(;(t===void 0||t-- >0)&&!(f=c.next()).done;)_.push(f.value)}catch(o){x={error:o}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(x)throw x.error}}return _}function V5(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(ej(arguments[t]));return e}function U5(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;for(var c=Array(e),f=0,t=0;t<i;t++)for(var _=arguments[t],x=0,o=_.length;x<o;x++,f++)c[f]=_[x];return c}function tj(e,t,i){if(i||arguments.length===2)for(var c=0,f=t.length,_;c<f;c++)(_||!(c in t))&&(_||(_=Array.prototype.slice.call(t,0,c)),_[c]=t[c]);return e.concat(_||Array.prototype.slice.call(t))}function Sy(e){return this instanceof Sy?(this.v=e,this):new Sy(e)}function $5(e,t,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=i.apply(e,t||[]),f,_=[];return f=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",x),f[Symbol.asyncIterator]=function(){return this},f;function x(B){return function(Y){return Promise.resolve(Y).then(B,U)}}function o(B,Y){c[B]&&(f[B]=function(H){return new Promise(function(K,re){_.push([B,H,K,re])>1||I(B,H)})},Y&&(f[B]=Y(f[B])))}function I(B,Y){try{P(c[B](Y))}catch(H){$(_[0][3],H)}}function P(B){B.value instanceof Sy?Promise.resolve(B.value.v).then(N,U):$(_[0][2],B)}function N(B){I("next",B)}function U(B){I("throw",B)}function $(B,Y){B(Y),_.shift(),_.length&&I(_[0][0],_[0][1])}}function q5(e){var t,i;return t={},c("next"),c("throw",function(f){throw f}),c("return"),t[Symbol.iterator]=function(){return this},t;function c(f,_){t[f]=e[f]?function(x){return(i=!i)?{value:Sy(e[f](x)),done:!1}:_?_(x):x}:_}}function G5(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],i;return t?t.call(e):(e=typeof pT=="function"?pT(e):e[Symbol.iterator](),i={},c("next"),c("throw"),c("return"),i[Symbol.asyncIterator]=function(){return this},i);function c(_){i[_]=e[_]&&function(x){return new Promise(function(o,I){x=e[_](x),f(o,I,x.done,x.value)})}}function f(_,x,o,I){Promise.resolve(I).then(function(P){_({value:P,done:o})},x)}}function W5(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var WJ=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},rP=function(e){return rP=Object.getOwnPropertyNames||function(t){var i=[];for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&(i[i.length]=c);return i},rP(e)};function H5(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i=rP(e),c=0;c<i.length;c++)i[c]!=="default"&&l2(t,e,i[c]);return WJ(t,e),t}function Z5(e){return e&&e.__esModule?e:{default:e}}function X5(e,t,i,c){if(i==="a"&&!c)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!c:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?c:i==="a"?c.call(e):c?c.value:t.get(e)}function K5(e,t,i,c,f){if(c==="m")throw new TypeError("Private method is not writable");if(c==="a"&&!f)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!f:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return c==="a"?f.call(e,i):f?f.value=i:t.set(e,i),i}function Y5(e,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof e=="function"?t===e:e.has(t)}function J5(e,t,i){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var c,f;if(i){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");c=t[Symbol.asyncDispose]}if(c===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");c=t[Symbol.dispose],i&&(f=c)}if(typeof c!="function")throw new TypeError("Object not disposable.");f&&(c=function(){try{f.call(this)}catch(_){return Promise.reject(_)}}),e.stack.push({value:t,dispose:c,async:i})}else i&&e.stack.push({async:!0});return t}var HJ=typeof SuppressedError=="function"?SuppressedError:function(e,t,i){var c=new Error(i);return c.name="SuppressedError",c.error=e,c.suppressed=t,c};function Q5(e){function t(_){e.error=e.hasError?new HJ(_,e.error,"An error was suppressed during disposal."):_,e.hasError=!0}var i,c=0;function f(){for(;i=e.stack.pop();)try{if(!i.async&&c===1)return c=0,e.stack.push(i),Promise.resolve().then(f);if(i.dispose){var _=i.dispose.call(i.value);if(i.async)return c|=2,Promise.resolve(_).then(f,function(x){return t(x),f()})}else c|=1}catch(x){t(x)}if(c===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return f()}function eV(e,t){return typeof e=="string"&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(i,c,f,_,x){return c?t?".jsx":".js":f&&(!_||!x)?i:f+_+"."+x.toLowerCase()+"js"}):e}const ZJ={__extends:j5,__assign:lc,__rest:Wf,__decorate:R5,__param:M5,__esDecorate:D5,__runInitializers:N5,__propKey:O5,__setFunctionName:L5,__metadata:z5,__awaiter:_n,__generator:F5,__createBinding:l2,__exportStar:B5,__values:pT,__read:ej,__spread:V5,__spreadArrays:U5,__spreadArray:tj,__await:Sy,__asyncGenerator:$5,__asyncDelegator:q5,__asyncValues:G5,__makeTemplateObject:W5,__importStar:H5,__importDefault:Z5,__classPrivateFieldGet:X5,__classPrivateFieldSet:K5,__classPrivateFieldIn:Y5,__addDisposableResource:J5,__disposeResources:Q5,__rewriteRelativeImportExtension:eV},XJ=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:J5,get __assign(){return lc},__asyncDelegator:q5,__asyncGenerator:$5,__asyncValues:G5,__await:Sy,__awaiter:_n,__classPrivateFieldGet:X5,__classPrivateFieldIn:Y5,__classPrivateFieldSet:K5,__createBinding:l2,__decorate:R5,__disposeResources:Q5,__esDecorate:D5,__exportStar:B5,__extends:j5,__generator:F5,__importDefault:Z5,__importStar:H5,__makeTemplateObject:W5,__metadata:z5,__param:M5,__propKey:O5,__read:ej,__rest:Wf,__rewriteRelativeImportExtension:eV,__runInitializers:N5,__setFunctionName:L5,__spread:V5,__spreadArray:tj,__spreadArrays:U5,__values:pT,default:ZJ},Symbol.toStringTag,{value:"Module"})),KJ=e=>e?(...t)=>e(...t):(...t)=>fetch(...t);class rj extends Error{constructor(t,i="FunctionsError",c){super(t),this.name=i,this.context=c}}class DL extends rj{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class NL extends rj{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class OL extends rj{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var nP;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(nP||(nP={}));class YJ{constructor(t,{headers:i={},customFetch:c,region:f=nP.Any}={}){this.url=t,this.headers=i,this.region=f,this.fetch=KJ(c)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return _n(this,arguments,void 0,function*(i,c={}){var f;try{const{headers:_,method:x,body:o,signal:I}=c;let P={},{region:N}=c;N||(N=this.region);const U=new URL(`${this.url}/${i}`);N&&N!=="any"&&(P["x-region"]=N,U.searchParams.set("forceFunctionRegion",N));let $;o&&(_&&!Object.prototype.hasOwnProperty.call(_,"Content-Type")||!_)?typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(P["Content-Type"]="application/octet-stream",$=o):typeof o=="string"?(P["Content-Type"]="text/plain",$=o):typeof FormData<"u"&&o instanceof FormData?$=o:(P["Content-Type"]="application/json",$=JSON.stringify(o)):$=o;const B=yield this.fetch(U.toString(),{method:x||"POST",headers:Object.assign(Object.assign(Object.assign({},P),this.headers),_),body:$,signal:I}).catch(re=>{throw re.name==="AbortError"?re:new DL(re)}),Y=B.headers.get("x-relay-error");if(Y&&Y==="true")throw new NL(B);if(!B.ok)throw new OL(B);let H=((f=B.headers.get("Content-Type"))!==null&&f!==void 0?f:"text/plain").split(";")[0].trim(),K;return H==="application/json"?K=yield B.json():H==="application/octet-stream"||H==="application/pdf"?K=yield B.blob():H==="text/event-stream"?K=B:H==="multipart/form-data"?K=yield B.formData():K=yield B.text(),{data:K,error:null,response:B}}catch(_){return _ instanceof Error&&_.name==="AbortError"?{data:null,error:new DL(_)}:{data:null,error:_,response:_ instanceof OL||_ instanceof NL?_.context:void 0}}})}}var Za={};const Vy=vW(XJ);var Yw={},Jw={},Qw={},eS={},tS={},rS={},LL;function tV(){if(LL)return rS;LL=1,Object.defineProperty(rS,"__esModule",{value:!0});class e extends Error{constructor(i){super(i.message),this.name="PostgrestError",this.details=i.details,this.hint=i.hint,this.code=i.code}}return rS.default=e,rS}var zL;function rV(){if(zL)return tS;zL=1,Object.defineProperty(tS,"__esModule",{value:!0});const t=Vy.__importDefault(tV());class i{constructor(f){var _,x;this.shouldThrowOnError=!1,this.method=f.method,this.url=f.url,this.headers=new Headers(f.headers),this.schema=f.schema,this.body=f.body,this.shouldThrowOnError=(_=f.shouldThrowOnError)!==null&&_!==void 0?_:!1,this.signal=f.signal,this.isMaybeSingle=(x=f.isMaybeSingle)!==null&&x!==void 0?x:!1,f.fetch?this.fetch=f.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(f,_){return this.headers=new Headers(this.headers),this.headers.set(f,_),this}then(f,_){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const x=this.fetch;let o=x(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async I=>{var P,N,U,$;let B=null,Y=null,H=null,K=I.status,re=I.statusText;if(I.ok){if(this.method!=="HEAD"){const Ee=await I.text();Ee===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((P=this.headers.get("Accept"))===null||P===void 0)&&P.includes("application/vnd.pgrst.plan+text"))?Y=Ee:Y=JSON.parse(Ee))}const X=(N=this.headers.get("Prefer"))===null||N===void 0?void 0:N.match(/count=(exact|planned|estimated)/),ue=(U=I.headers.get("content-range"))===null||U===void 0?void 0:U.split("/");X&&ue&&ue.length>1&&(H=parseInt(ue[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(Y)&&(Y.length>1?(B={code:"PGRST116",details:`Results contain ${Y.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},Y=null,H=null,K=406,re="Not Acceptable"):Y.length===1?Y=Y[0]:Y=null)}else{const X=await I.text();try{B=JSON.parse(X),Array.isArray(B)&&I.status===404&&(Y=[],B=null,K=200,re="OK")}catch{I.status===404&&X===""?(K=204,re="No Content"):B={message:X}}if(B&&this.isMaybeSingle&&(!(($=B==null?void 0:B.details)===null||$===void 0)&&$.includes("0 rows"))&&(B=null,K=200,re="OK"),B&&this.shouldThrowOnError)throw new t.default(B)}return{error:B,data:Y,count:H,status:K,statusText:re}});return this.shouldThrowOnError||(o=o.catch(I=>{var P,N,U;return{error:{message:`${(P=I==null?void 0:I.name)!==null&&P!==void 0?P:"FetchError"}: ${I==null?void 0:I.message}`,details:`${(N=I==null?void 0:I.stack)!==null&&N!==void 0?N:""}`,hint:"",code:`${(U=I==null?void 0:I.code)!==null&&U!==void 0?U:""}`},data:null,count:null,status:0,statusText:""}})),o.then(f,_)}returns(){return this}overrideTypes(){return this}}return tS.default=i,tS}var FL;function nV(){if(FL)return eS;FL=1,Object.defineProperty(eS,"__esModule",{value:!0});const t=Vy.__importDefault(rV());class i extends t.default{select(f){let _=!1;const x=(f??"*").split("").map(o=>/\s/.test(o)&&!_?"":(o==='"'&&(_=!_),o)).join("");return this.url.searchParams.set("select",x),this.headers.append("Prefer","return=representation"),this}order(f,{ascending:_=!0,nullsFirst:x,foreignTable:o,referencedTable:I=o}={}){const P=I?`${I}.order`:"order",N=this.url.searchParams.get(P);return this.url.searchParams.set(P,`${N?`${N},`:""}${f}.${_?"asc":"desc"}${x===void 0?"":x?".nullsfirst":".nullslast"}`),this}limit(f,{foreignTable:_,referencedTable:x=_}={}){const o=typeof x>"u"?"limit":`${x}.limit`;return this.url.searchParams.set(o,`${f}`),this}range(f,_,{foreignTable:x,referencedTable:o=x}={}){const I=typeof o>"u"?"offset":`${o}.offset`,P=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(I,`${f}`),this.url.searchParams.set(P,`${_-f+1}`),this}abortSignal(f){return this.signal=f,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:f=!1,verbose:_=!1,settings:x=!1,buffers:o=!1,wal:I=!1,format:P="text"}={}){var N;const U=[f?"analyze":null,_?"verbose":null,x?"settings":null,o?"buffers":null,I?"wal":null].filter(Boolean).join("|"),$=(N=this.headers.get("Accept"))!==null&&N!==void 0?N:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${P}; for="${$}"; options=${U};`),P==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(f){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${f}`),this}}return eS.default=i,eS}var BL;function nj(){if(BL)return Qw;BL=1,Object.defineProperty(Qw,"__esModule",{value:!0});const t=Vy.__importDefault(nV()),i=new RegExp("[,()]");class c extends t.default{eq(_,x){return this.url.searchParams.append(_,`eq.${x}`),this}neq(_,x){return this.url.searchParams.append(_,`neq.${x}`),this}gt(_,x){return this.url.searchParams.append(_,`gt.${x}`),this}gte(_,x){return this.url.searchParams.append(_,`gte.${x}`),this}lt(_,x){return this.url.searchParams.append(_,`lt.${x}`),this}lte(_,x){return this.url.searchParams.append(_,`lte.${x}`),this}like(_,x){return this.url.searchParams.append(_,`like.${x}`),this}likeAllOf(_,x){return this.url.searchParams.append(_,`like(all).{${x.join(",")}}`),this}likeAnyOf(_,x){return this.url.searchParams.append(_,`like(any).{${x.join(",")}}`),this}ilike(_,x){return this.url.searchParams.append(_,`ilike.${x}`),this}ilikeAllOf(_,x){return this.url.searchParams.append(_,`ilike(all).{${x.join(",")}}`),this}ilikeAnyOf(_,x){return this.url.searchParams.append(_,`ilike(any).{${x.join(",")}}`),this}is(_,x){return this.url.searchParams.append(_,`is.${x}`),this}in(_,x){const o=Array.from(new Set(x)).map(I=>typeof I=="string"&&i.test(I)?`"${I}"`:`${I}`).join(",");return this.url.searchParams.append(_,`in.(${o})`),this}contains(_,x){return typeof x=="string"?this.url.searchParams.append(_,`cs.${x}`):Array.isArray(x)?this.url.searchParams.append(_,`cs.{${x.join(",")}}`):this.url.searchParams.append(_,`cs.${JSON.stringify(x)}`),this}containedBy(_,x){return typeof x=="string"?this.url.searchParams.append(_,`cd.${x}`):Array.isArray(x)?this.url.searchParams.append(_,`cd.{${x.join(",")}}`):this.url.searchParams.append(_,`cd.${JSON.stringify(x)}`),this}rangeGt(_,x){return this.url.searchParams.append(_,`sr.${x}`),this}rangeGte(_,x){return this.url.searchParams.append(_,`nxl.${x}`),this}rangeLt(_,x){return this.url.searchParams.append(_,`sl.${x}`),this}rangeLte(_,x){return this.url.searchParams.append(_,`nxr.${x}`),this}rangeAdjacent(_,x){return this.url.searchParams.append(_,`adj.${x}`),this}overlaps(_,x){return typeof x=="string"?this.url.searchParams.append(_,`ov.${x}`):this.url.searchParams.append(_,`ov.{${x.join(",")}}`),this}textSearch(_,x,{config:o,type:I}={}){let P="";I==="plain"?P="pl":I==="phrase"?P="ph":I==="websearch"&&(P="w");const N=o===void 0?"":`(${o})`;return this.url.searchParams.append(_,`${P}fts${N}.${x}`),this}match(_){return Object.entries(_).forEach(([x,o])=>{this.url.searchParams.append(x,`eq.${o}`)}),this}not(_,x,o){return this.url.searchParams.append(_,`not.${x}.${o}`),this}or(_,{foreignTable:x,referencedTable:o=x}={}){const I=o?`${o}.or`:"or";return this.url.searchParams.append(I,`(${_})`),this}filter(_,x,o){return this.url.searchParams.append(_,`${x}.${o}`),this}}return Qw.default=c,Qw}var VL;function iV(){if(VL)return Jw;VL=1,Object.defineProperty(Jw,"__esModule",{value:!0});const t=Vy.__importDefault(nj());class i{constructor(f,{headers:_={},schema:x,fetch:o}){this.url=f,this.headers=new Headers(_),this.schema=x,this.fetch=o}select(f,_){const{head:x=!1,count:o}=_??{},I=x?"HEAD":"GET";let P=!1;const N=(f??"*").split("").map(U=>/\s/.test(U)&&!P?"":(U==='"'&&(P=!P),U)).join("");return this.url.searchParams.set("select",N),o&&this.headers.append("Prefer",`count=${o}`),new t.default({method:I,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(f,{count:_,defaultToNull:x=!0}={}){var o;const I="POST";if(_&&this.headers.append("Prefer",`count=${_}`),x||this.headers.append("Prefer","missing=default"),Array.isArray(f)){const P=f.reduce((N,U)=>N.concat(Object.keys(U)),[]);if(P.length>0){const N=[...new Set(P)].map(U=>`"${U}"`);this.url.searchParams.set("columns",N.join(","))}}return new t.default({method:I,url:this.url,headers:this.headers,schema:this.schema,body:f,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}upsert(f,{onConflict:_,ignoreDuplicates:x=!1,count:o,defaultToNull:I=!0}={}){var P;const N="POST";if(this.headers.append("Prefer",`resolution=${x?"ignore":"merge"}-duplicates`),_!==void 0&&this.url.searchParams.set("on_conflict",_),o&&this.headers.append("Prefer",`count=${o}`),I||this.headers.append("Prefer","missing=default"),Array.isArray(f)){const U=f.reduce(($,B)=>$.concat(Object.keys(B)),[]);if(U.length>0){const $=[...new Set(U)].map(B=>`"${B}"`);this.url.searchParams.set("columns",$.join(","))}}return new t.default({method:N,url:this.url,headers:this.headers,schema:this.schema,body:f,fetch:(P=this.fetch)!==null&&P!==void 0?P:fetch})}update(f,{count:_}={}){var x;const o="PATCH";return _&&this.headers.append("Prefer",`count=${_}`),new t.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:f,fetch:(x=this.fetch)!==null&&x!==void 0?x:fetch})}delete({count:f}={}){var _;const x="DELETE";return f&&this.headers.append("Prefer",`count=${f}`),new t.default({method:x,url:this.url,headers:this.headers,schema:this.schema,fetch:(_=this.fetch)!==null&&_!==void 0?_:fetch})}}return Jw.default=i,Jw}var UL;function JJ(){if(UL)return Yw;UL=1,Object.defineProperty(Yw,"__esModule",{value:!0});const e=Vy,t=e.__importDefault(iV()),i=e.__importDefault(nj());class c{constructor(_,{headers:x={},schema:o,fetch:I}={}){this.url=_,this.headers=new Headers(x),this.schemaName=o,this.fetch=I}from(_){const x=new URL(`${this.url}/${_}`);return new t.default(x,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(_){return new c(this.url,{headers:this.headers,schema:_,fetch:this.fetch})}rpc(_,x={},{head:o=!1,get:I=!1,count:P}={}){var N;let U;const $=new URL(`${this.url}/rpc/${_}`);let B;o||I?(U=o?"HEAD":"GET",Object.entries(x).filter(([H,K])=>K!==void 0).map(([H,K])=>[H,Array.isArray(K)?`{${K.join(",")}}`:`${K}`]).forEach(([H,K])=>{$.searchParams.append(H,K)})):(U="POST",B=x);const Y=new Headers(this.headers);return P&&Y.set("Prefer",`count=${P}`),new i.default({method:U,url:$,headers:Y,schema:this.schemaName,body:B,fetch:(N=this.fetch)!==null&&N!==void 0?N:fetch})}}return Yw.default=c,Yw}Object.defineProperty(Za,"__esModule",{value:!0});var sV=Za.PostgrestError=mV=Za.PostgrestBuilder=fV=Za.PostgrestTransformBuilder=dV=Za.PostgrestFilterBuilder=cV=Za.PostgrestQueryBuilder=aV=Za.PostgrestClient=void 0;const Uy=Vy,oV=Uy.__importDefault(JJ());var aV=Za.PostgrestClient=oV.default;const lV=Uy.__importDefault(iV());var cV=Za.PostgrestQueryBuilder=lV.default;const uV=Uy.__importDefault(nj());var dV=Za.PostgrestFilterBuilder=uV.default;const hV=Uy.__importDefault(nV());var fV=Za.PostgrestTransformBuilder=hV.default;const pV=Uy.__importDefault(rV());var mV=Za.PostgrestBuilder=pV.default;const gV=Uy.__importDefault(tV());sV=Za.PostgrestError=gV.default;var _V=Za.default={PostgrestClient:oV.default,PostgrestQueryBuilder:lV.default,PostgrestFilterBuilder:uV.default,PostgrestTransformBuilder:hV.default,PostgrestBuilder:pV.default,PostgrestError:gV.default};const QJ=xF({__proto__:null,get PostgrestBuilder(){return mV},get PostgrestClient(){return aV},get PostgrestError(){return sV},get PostgrestFilterBuilder(){return dV},get PostgrestQueryBuilder(){return cV},get PostgrestTransformBuilder(){return fV},default:_V},[Za]),{PostgrestClient:eQ,PostgrestQueryBuilder:jce,PostgrestFilterBuilder:Rce,PostgrestTransformBuilder:Mce,PostgrestBuilder:Dce,PostgrestError:Nce}=_V||QJ;class tQ{static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const i=process.versions;if(i&&i.node){const c=i.node,f=parseInt(c.replace(/^v/,"").split(".")[0]);return f>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${f} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${f} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let i=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(i+=`

Suggested solution: ${t.workaround}`),new Error(i)}static createWebSocket(t,i){const c=this.getWebSocketConstructor();return new c(t,i)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const rQ="2.80.0",nQ=`realtime-js/${rQ}`,iQ="1.0.0",iP=1e4,sQ=1e3,oQ=100;var S0;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(S0||(S0={}));var zo;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(zo||(zo={}));var Gc;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(Gc||(Gc={}));var sP;(function(e){e.websocket="websocket"})(sP||(sP={}));var tm;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(tm||(tm={}));class aQ{constructor(){this.HEADER_LENGTH=1}decode(t,i){return t.constructor===ArrayBuffer?i(this._binaryDecode(t)):i(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const i=new DataView(t),c=new TextDecoder;return this._decodeBroadcast(t,i,c)}_decodeBroadcast(t,i,c){const f=i.getUint8(1),_=i.getUint8(2);let x=this.HEADER_LENGTH+2;const o=c.decode(t.slice(x,x+f));x=x+f;const I=c.decode(t.slice(x,x+_));x=x+_;const P=JSON.parse(c.decode(t.slice(x,t.byteLength)));return{ref:null,topic:o,event:I,payload:P}}}class yV{constructor(t,i){this.callback=t,this.timerCalc=i,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=i}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var As;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(As||(As={}));const $L=(e,t,i={})=>{var c;const f=(c=i.skipTypes)!==null&&c!==void 0?c:[];return t?Object.keys(t).reduce((_,x)=>(_[x]=lQ(x,e,t,f),_),{}):{}},lQ=(e,t,i,c)=>{const f=t.find(o=>o.name===e),_=f==null?void 0:f.type,x=i[e];return _&&!c.includes(_)?vV(_,x):oP(x)},vV=(e,t)=>{if(e.charAt(0)==="_"){const i=e.slice(1,e.length);return hQ(t,i)}switch(e){case As.bool:return cQ(t);case As.float4:case As.float8:case As.int2:case As.int4:case As.int8:case As.numeric:case As.oid:return uQ(t);case As.json:case As.jsonb:return dQ(t);case As.timestamp:return fQ(t);case As.abstime:case As.date:case As.daterange:case As.int4range:case As.int8range:case As.money:case As.reltime:case As.text:case As.time:case As.timestamptz:case As.timetz:case As.tsrange:case As.tstzrange:return oP(t);default:return oP(t)}},oP=e=>e,cQ=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},uQ=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},dQ=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},hQ=(e,t)=>{if(typeof e!="string")return e;const i=e.length-1,c=e[i];if(e[0]==="{"&&c==="}"){let _;const x=e.slice(1,i);try{_=JSON.parse("["+x+"]")}catch{_=x?x.split(","):[]}return _.map(o=>vV(t,o))}return e},fQ=e=>typeof e=="string"?e.replace(" ","T"):e,xV=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class aA{constructor(t,i,c={},f=iP){this.channel=t,this.event=i,this.payload=c,this.timeout=f,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,i){var c;return this._hasReceived(t)&&i((c=this.receivedResp)===null||c===void 0?void 0:c.response),this.recHooks.push({status:t,callback:i}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=i=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=i,this._matchReceive(i)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,i){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:i})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:i}){this.recHooks.filter(c=>c.status===t).forEach(c=>c.callback(i))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var qL;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(qL||(qL={}));class T0{constructor(t,i){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const c=(i==null?void 0:i.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(c.state,{},f=>{const{onJoin:_,onLeave:x,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=T0.syncState(this.state,f,_,x),this.pendingDiffs.forEach(I=>{this.state=T0.syncDiff(this.state,I,_,x)}),this.pendingDiffs=[],o()}),this.channel._on(c.diff,{},f=>{const{onJoin:_,onLeave:x,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(f):(this.state=T0.syncDiff(this.state,f,_,x),o())}),this.onJoin((f,_,x)=>{this.channel._trigger("presence",{event:"join",key:f,currentPresences:_,newPresences:x})}),this.onLeave((f,_,x)=>{this.channel._trigger("presence",{event:"leave",key:f,currentPresences:_,leftPresences:x})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,i,c,f){const _=this.cloneDeep(t),x=this.transformState(i),o={},I={};return this.map(_,(P,N)=>{x[P]||(I[P]=N)}),this.map(x,(P,N)=>{const U=_[P];if(U){const $=N.map(K=>K.presence_ref),B=U.map(K=>K.presence_ref),Y=N.filter(K=>B.indexOf(K.presence_ref)<0),H=U.filter(K=>$.indexOf(K.presence_ref)<0);Y.length>0&&(o[P]=Y),H.length>0&&(I[P]=H)}else o[P]=N}),this.syncDiff(_,{joins:o,leaves:I},c,f)}static syncDiff(t,i,c,f){const{joins:_,leaves:x}={joins:this.transformState(i.joins),leaves:this.transformState(i.leaves)};return c||(c=()=>{}),f||(f=()=>{}),this.map(_,(o,I)=>{var P;const N=(P=t[o])!==null&&P!==void 0?P:[];if(t[o]=this.cloneDeep(I),N.length>0){const U=t[o].map(B=>B.presence_ref),$=N.filter(B=>U.indexOf(B.presence_ref)<0);t[o].unshift(...$)}c(o,N,I)}),this.map(x,(o,I)=>{let P=t[o];if(!P)return;const N=I.map(U=>U.presence_ref);P=P.filter(U=>N.indexOf(U.presence_ref)<0),t[o]=P,f(o,P,I),P.length===0&&delete t[o]}),t}static map(t,i){return Object.getOwnPropertyNames(t).map(c=>i(c,t[c]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((i,c)=>{const f=t[c];return"metas"in f?i[c]=f.metas.map(_=>(_.presence_ref=_.phx_ref,delete _.phx_ref,delete _.phx_ref_prev,_)):i[c]=f,i},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var GL;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(GL||(GL={}));var E0;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(E0||(E0={}));var Ad;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(Ad||(Ad={}));class ij{constructor(t,i={config:{}},c){var f,_;if(this.topic=t,this.params=i,this.socket=c,this.bindings={},this.state=zo.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},i.config),this.timeout=this.socket.timeout,this.joinPush=new aA(this,Gc.join,this.params,this.timeout),this.rejoinTimer=new yV(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=zo.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(x=>x.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=zo.closed,this.socket._remove(this)}),this._onError(x=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,x),this.state=zo.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=zo.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",x=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,x),this.state=zo.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Gc.reply,{},(x,o)=>{this._trigger(this._replyEventName(o),x)}),this.presence=new T0(this),this.broadcastEndpointURL=xV(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((_=(f=this.params.config)===null||f===void 0?void 0:f.broadcast)===null||_===void 0)&&_.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,i=this.timeout){var c,f,_;if(this.socket.isConnected()||this.socket.connect(),this.state==zo.closed){const{config:{broadcast:x,presence:o,private:I}}=this.params,P=(f=(c=this.bindings.postgres_changes)===null||c===void 0?void 0:c.map(B=>B.filter))!==null&&f!==void 0?f:[],N=!!this.bindings[E0.PRESENCE]&&this.bindings[E0.PRESENCE].length>0||((_=this.params.config.presence)===null||_===void 0?void 0:_.enabled)===!0,U={},$={broadcast:x,presence:Object.assign(Object.assign({},o),{enabled:N}),postgres_changes:P,private:I};this.socket.accessTokenValue&&(U.access_token=this.socket.accessTokenValue),this._onError(B=>t==null?void 0:t(Ad.CHANNEL_ERROR,B)),this._onClose(()=>t==null?void 0:t(Ad.CLOSED)),this.updateJoinPayload(Object.assign({config:$},U)),this.joinedOnce=!0,this._rejoin(i),this.joinPush.receive("ok",async({postgres_changes:B})=>{var Y;if(this.socket.setAuth(),B===void 0){t==null||t(Ad.SUBSCRIBED);return}else{const H=this.bindings.postgres_changes,K=(Y=H==null?void 0:H.length)!==null&&Y!==void 0?Y:0,re=[];for(let G=0;G<K;G++){const X=H[G],{filter:{event:ue,schema:Ee,table:xe,filter:Ne}}=X,lt=B&&B[G];if(lt&&lt.event===ue&&lt.schema===Ee&&lt.table===xe&&lt.filter===Ne)re.push(Object.assign(Object.assign({},X),{id:lt.id}));else{this.unsubscribe(),this.state=zo.errored,t==null||t(Ad.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=re,t&&t(Ad.SUBSCRIBED);return}}).receive("error",B=>{this.state=zo.errored,t==null||t(Ad.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(B).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(Ad.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,i={}){return await this.send({type:"presence",event:"track",payload:t},i.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,i,c){return this.state===zo.joined&&t===E0.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,i,c)}async httpSend(t,i,c={}){var f;const _=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(i==null)return Promise.reject("Payload is required for httpSend()");const x={method:"POST",headers:{Authorization:_,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:i,private:this.private}]})},o=await this._fetchWithTimeout(this.broadcastEndpointURL,x,(f=c.timeout)!==null&&f!==void 0?f:this.timeout);if(o.status===202)return{success:!0};let I=o.statusText;try{const P=await o.json();I=P.error||P.message||I}catch{}return Promise.reject(new Error(I))}async send(t,i={}){var c,f;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:_,payload:x}=t,I={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:_,payload:x,private:this.private}]})};try{const P=await this._fetchWithTimeout(this.broadcastEndpointURL,I,(c=i.timeout)!==null&&c!==void 0?c:this.timeout);return await((f=P.body)===null||f===void 0?void 0:f.cancel()),P.ok?"ok":"error"}catch(P){return P.name==="AbortError"?"timed out":"error"}}else return new Promise(_=>{var x,o,I;const P=this._push(t.type,t,i.timeout||this.timeout);t.type==="broadcast"&&!(!((I=(o=(x=this.params)===null||x===void 0?void 0:x.config)===null||o===void 0?void 0:o.broadcast)===null||I===void 0)&&I.ack)&&_("ok"),P.receive("ok",()=>_("ok")),P.receive("error",()=>_("error")),P.receive("timeout",()=>_("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=zo.leaving;const i=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Gc.close,"leave",this._joinRef())};this.joinPush.destroy();let c=null;return new Promise(f=>{c=new aA(this,Gc.leave,{},t),c.receive("ok",()=>{i(),f("ok")}).receive("timeout",()=>{i(),f("timed out")}).receive("error",()=>{f("error")}),c.send(),this._canPush()||c.trigger("ok",{})}).finally(()=>{c==null||c.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=zo.closed,this.bindings={}}async _fetchWithTimeout(t,i,c){const f=new AbortController,_=setTimeout(()=>f.abort(),c),x=await this.socket.fetch(t,Object.assign(Object.assign({},i),{signal:f.signal}));return clearTimeout(_),x}_push(t,i,c=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let f=new aA(this,t,i,c);return this._canPush()?f.send():this._addToPushBuffer(f),f}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>oQ){const i=this.pushBuffer.shift();i&&(i.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${i.event}`,i.payload))}}_onMessage(t,i,c){return i}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,i,c){var f,_;const x=t.toLocaleLowerCase(),{close:o,error:I,leave:P,join:N}=Gc;if(c&&[o,I,P,N].indexOf(x)>=0&&c!==this._joinRef())return;let $=this._onMessage(x,i,c);if(i&&!$)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(x)?(f=this.bindings.postgres_changes)===null||f===void 0||f.filter(B=>{var Y,H,K;return((Y=B.filter)===null||Y===void 0?void 0:Y.event)==="*"||((K=(H=B.filter)===null||H===void 0?void 0:H.event)===null||K===void 0?void 0:K.toLocaleLowerCase())===x}).map(B=>B.callback($,c)):(_=this.bindings[x])===null||_===void 0||_.filter(B=>{var Y,H,K,re,G,X;if(["broadcast","presence","postgres_changes"].includes(x))if("id"in B){const ue=B.id,Ee=(Y=B.filter)===null||Y===void 0?void 0:Y.event;return ue&&((H=i.ids)===null||H===void 0?void 0:H.includes(ue))&&(Ee==="*"||(Ee==null?void 0:Ee.toLocaleLowerCase())===((K=i.data)===null||K===void 0?void 0:K.type.toLocaleLowerCase()))}else{const ue=(G=(re=B==null?void 0:B.filter)===null||re===void 0?void 0:re.event)===null||G===void 0?void 0:G.toLocaleLowerCase();return ue==="*"||ue===((X=i==null?void 0:i.event)===null||X===void 0?void 0:X.toLocaleLowerCase())}else return B.type.toLocaleLowerCase()===x}).map(B=>{if(typeof $=="object"&&"ids"in $){const Y=$.data,{schema:H,table:K,commit_timestamp:re,type:G,errors:X}=Y;$=Object.assign(Object.assign({},{schema:H,table:K,commit_timestamp:re,eventType:G,new:{},old:{},errors:X}),this._getPayloadRecords(Y))}B.callback($,c)})}_isClosed(){return this.state===zo.closed}_isJoined(){return this.state===zo.joined}_isJoining(){return this.state===zo.joining}_isLeaving(){return this.state===zo.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,i,c){const f=t.toLocaleLowerCase(),_={type:f,filter:i,callback:c};return this.bindings[f]?this.bindings[f].push(_):this.bindings[f]=[_],this}_off(t,i){const c=t.toLocaleLowerCase();return this.bindings[c]&&(this.bindings[c]=this.bindings[c].filter(f=>{var _;return!(((_=f.type)===null||_===void 0?void 0:_.toLocaleLowerCase())===c&&ij.isEqual(f.filter,i))})),this}static isEqual(t,i){if(Object.keys(t).length!==Object.keys(i).length)return!1;for(const c in t)if(t[c]!==i[c])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Gc.close,{},t)}_onError(t){this._on(Gc.error,{},i=>t(i))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=zo.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const i={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(i.new=$L(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(i.old=$L(t.columns,t.old_record)),i}}const lA=()=>{},nS={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},pQ=[1e3,2e3,5e3,1e4],mQ=1e4,gQ=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class _Q{constructor(t,i){var c;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=iP,this.transport=null,this.heartbeatIntervalMs=nS.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=lA,this.ref=0,this.reconnectTimer=null,this.logger=lA,this.conn=null,this.sendBuffer=[],this.serializer=new aQ,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=f=>f?(..._)=>f(..._):(..._)=>fetch(..._),!(!((c=i==null?void 0:i.params)===null||c===void 0)&&c.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=i.params.apikey,this.endPoint=`${t}/${sP.websocket}`,this.httpEndpoint=xV(t),this._initializeOptions(i),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(i==null?void 0:i.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=tQ.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const i=t.message;throw i.includes("Node.js")?new Error(`${i}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${i}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:iQ}))}disconnect(t,i){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const c=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(c),this._setConnectionState("disconnected")},t?this.conn.close(t,i??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const i=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),i}async removeAllChannels(){const t=await Promise.all(this.channels.map(i=>i.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,i,c){this.logger(t,i,c)}connectionState(){switch(this.conn&&this.conn.readyState){case S0.connecting:return tm.Connecting;case S0.open:return tm.Open;case S0.closing:return tm.Closing;default:return tm.Closed}}isConnected(){return this.connectionState()===tm.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,i={config:{}}){const c=`realtime:${t}`,f=this.getChannels().find(_=>_.topic===c);if(f)return f;{const _=new ij(`realtime:${t}`,i,this);return this.channels.push(_),_}}push(t){const{topic:i,event:c,payload:f,ref:_}=t,x=()=>{this.encode(t,o=>{var I;(I=this.conn)===null||I===void 0||I.send(o)})};this.log("push",`${i} ${c} (${_})`,f),this.isConnected()?x():this.sendBuffer.push(x)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(i){this.log("error","error in heartbeat callback",i)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(i){this.log("error","error in heartbeat callback",i)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(sQ,"heartbeat timeout"),setTimeout(()=>{var i;this.isConnected()||(i=this.reconnectTimer)===null||i===void 0||i.scheduleTimeout()},nS.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(i){this.log("error","error in heartbeat callback",i)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let i=this.channels.find(c=>c.topic===t&&(c._isJoined()||c._isJoining()));i&&(this.log("transport",`leaving duplicate topic "${t}"`),i.unsubscribe())}_remove(t){this.channels=this.channels.filter(i=>i.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,i=>{if(i.topic==="phoenix"&&i.event==="phx_reply")try{this.heartbeatCallback(i.payload.status==="ok"?"ok":"error")}catch(P){this.log("error","error in heartbeat callback",P)}i.ref&&i.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:c,event:f,payload:_,ref:x}=i,o=x?`(${x})`:"",I=_.status||"";this.log("receive",`${I} ${c} ${f} ${o}`.trim(),_),this.channels.filter(P=>P._isMember(c)).forEach(P=>P._trigger(f,_,x)),this._triggerStateCallbacks("message",i)})}_clearTimer(t){var i;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((i=this.reconnectTimer)===null||i===void 0||i.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=i=>{this.log("worker","worker error",i.message),this.workerRef.terminate()},this.workerRef.onmessage=i=>{i.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var i;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(i=this.reconnectTimer)===null||i===void 0||i.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(Gc.error))}_appendParams(t,i){if(Object.keys(i).length===0)return t;const c=t.match(/\?/)?"&":"?",f=new URLSearchParams(i);return`${t}${c}${f}`}_workerObjectUrl(t){let i;if(t)i=t;else{const c=new Blob([gQ],{type:"application/javascript"});i=URL.createObjectURL(c)}return i}_setConnectionState(t,i=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=i)}async _performAuth(t=null){let i;t?i=t:this.accessToken?i=await this.accessToken():i=this.accessTokenValue,this.accessTokenValue!=i&&(this.accessTokenValue=i,this.channels.forEach(c=>{const f={access_token:i,version:nQ};i&&c.updateJoinPayload(f),c.joinedOnce&&c._isJoined()&&c._push(Gc.access_token,{access_token:i})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(i=>{this.log("error",`error setting auth in ${t}`,i)})}_triggerStateCallbacks(t,i){try{this.stateChangeCallbacks[t].forEach(c=>{try{c(i)}catch(f){this.log("error",`error in ${t} callback`,f)}})}catch(c){this.log("error",`error triggering ${t} callbacks`,c)}}_setupReconnectionTimer(){this.reconnectTimer=new yV(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},nS.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var i,c,f,_,x,o,I,P,N;if(this.transport=(i=t==null?void 0:t.transport)!==null&&i!==void 0?i:null,this.timeout=(c=t==null?void 0:t.timeout)!==null&&c!==void 0?c:iP,this.heartbeatIntervalMs=(f=t==null?void 0:t.heartbeatIntervalMs)!==null&&f!==void 0?f:nS.HEARTBEAT_INTERVAL,this.worker=(_=t==null?void 0:t.worker)!==null&&_!==void 0?_:!1,this.accessToken=(x=t==null?void 0:t.accessToken)!==null&&x!==void 0?x:null,this.heartbeatCallback=(o=t==null?void 0:t.heartbeatCallback)!==null&&o!==void 0?o:lA,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(I=t==null?void 0:t.reconnectAfterMs)!==null&&I!==void 0?I:U=>pQ[U-1]||mQ,this.encode=(P=t==null?void 0:t.encode)!==null&&P!==void 0?P:(U,$)=>$(JSON.stringify(U)),this.decode=(N=t==null?void 0:t.decode)!==null&&N!==void 0?N:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}class sj extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function Gs(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class yQ extends sj{constructor(t,i,c){super(t),this.name="StorageApiError",this.status=i,this.statusCode=c}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class aP extends sj{constructor(t,i){super(t),this.name="StorageUnknownError",this.originalError=i}}const oj=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),vQ=()=>Response,lP=e=>{if(Array.isArray(e))return e.map(i=>lP(i));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([i,c])=>{const f=i.replace(/([-_][a-z])/gi,_=>_.toUpperCase().replace(/[-_]/g,""));t[f]=lP(c)}),t},xQ=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},cA=e=>{var t;return e.msg||e.message||e.error_description||(typeof e.error=="string"?e.error:(t=e.error)===null||t===void 0?void 0:t.message)||JSON.stringify(e)},bQ=(e,t,i)=>_n(void 0,void 0,void 0,function*(){const c=yield vQ();e instanceof c&&!(i!=null&&i.noResolveJson)?e.json().then(f=>{const _=e.status||500,x=(f==null?void 0:f.statusCode)||_+"";t(new yQ(cA(f),_,x))}).catch(f=>{t(new aP(cA(f),f))}):t(new aP(cA(e),e))}),wQ=(e,t,i,c)=>{const f={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"||!c?f:(xQ(c)?(f.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),f.body=JSON.stringify(c)):f.body=c,t!=null&&t.duplex&&(f.duplex=t.duplex),Object.assign(Object.assign({},f),i))};function wb(e,t,i,c,f,_){return _n(this,void 0,void 0,function*(){return new Promise((x,o)=>{e(i,wQ(t,c,f,_)).then(I=>{if(!I.ok)throw I;return c!=null&&c.noResolveJson?I:I.json()}).then(I=>x(I)).catch(I=>bQ(I,o,c))})})}function Q0(e,t,i,c){return _n(this,void 0,void 0,function*(){return wb(e,"GET",t,i,c)})}function Vc(e,t,i,c,f){return _n(this,void 0,void 0,function*(){return wb(e,"POST",t,c,f,i)})}function cP(e,t,i,c,f){return _n(this,void 0,void 0,function*(){return wb(e,"PUT",t,c,f,i)})}function SQ(e,t,i,c){return _n(this,void 0,void 0,function*(){return wb(e,"HEAD",t,Object.assign(Object.assign({},i),{noResolveJson:!0}),c)})}function aj(e,t,i,c,f){return _n(this,void 0,void 0,function*(){return wb(e,"DELETE",t,c,f,i)})}class TQ{constructor(t,i){this.downloadFn=t,this.shouldThrowOnError=i}then(t,i){return this.execute().then(t,i)}execute(){return _n(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Gs(t))return{data:null,error:t};throw t}})}}var bV;class EQ{constructor(t,i){this.downloadFn=t,this.shouldThrowOnError=i,this[bV]="BlobDownloadBuilder",this.promise=null}asStream(){return new TQ(this.downloadFn,this.shouldThrowOnError)}then(t,i){return this.getPromise().then(t,i)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return _n(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Gs(t))return{data:null,error:t};throw t}})}}bV=Symbol.toStringTag;const CQ={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},WL={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class AQ{constructor(t,i={},c,f){this.shouldThrowOnError=!1,this.url=t,this.headers=i,this.bucketId=c,this.fetch=oj(f)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(t,i,c,f){return _n(this,void 0,void 0,function*(){try{let _;const x=Object.assign(Object.assign({},WL),f);let o=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(x.upsert)});const I=x.metadata;typeof Blob<"u"&&c instanceof Blob?(_=new FormData,_.append("cacheControl",x.cacheControl),I&&_.append("metadata",this.encodeMetadata(I)),_.append("",c)):typeof FormData<"u"&&c instanceof FormData?(_=c,_.has("cacheControl")||_.append("cacheControl",x.cacheControl),I&&!_.has("metadata")&&_.append("metadata",this.encodeMetadata(I))):(_=c,o["cache-control"]=`max-age=${x.cacheControl}`,o["content-type"]=x.contentType,I&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(I))),(typeof ReadableStream<"u"&&_ instanceof ReadableStream||_&&typeof _=="object"&&"pipe"in _&&typeof _.pipe=="function")&&!x.duplex&&(x.duplex="half")),f!=null&&f.headers&&(o=Object.assign(Object.assign({},o),f.headers));const P=this._removeEmptyFolders(i),N=this._getFinalPath(P),U=yield(t=="PUT"?cP:Vc)(this.fetch,`${this.url}/object/${N}`,_,Object.assign({headers:o},x!=null&&x.duplex?{duplex:x.duplex}:{}));return{data:{path:P,id:U.Id,fullPath:U.Key},error:null}}catch(_){if(this.shouldThrowOnError)throw _;if(Gs(_))return{data:null,error:_};throw _}})}upload(t,i,c){return _n(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,i,c)})}uploadToSignedUrl(t,i,c,f){return _n(this,void 0,void 0,function*(){const _=this._removeEmptyFolders(t),x=this._getFinalPath(_),o=new URL(this.url+`/object/upload/sign/${x}`);o.searchParams.set("token",i);try{let I;const P=Object.assign({upsert:WL.upsert},f),N=Object.assign(Object.assign({},this.headers),{"x-upsert":String(P.upsert)});typeof Blob<"u"&&c instanceof Blob?(I=new FormData,I.append("cacheControl",P.cacheControl),I.append("",c)):typeof FormData<"u"&&c instanceof FormData?(I=c,I.append("cacheControl",P.cacheControl)):(I=c,N["cache-control"]=`max-age=${P.cacheControl}`,N["content-type"]=P.contentType);const U=yield cP(this.fetch,o.toString(),I,{headers:N});return{data:{path:_,fullPath:U.Key},error:null}}catch(I){if(this.shouldThrowOnError)throw I;if(Gs(I))return{data:null,error:I};throw I}})}createSignedUploadUrl(t,i){return _n(this,void 0,void 0,function*(){try{let c=this._getFinalPath(t);const f=Object.assign({},this.headers);i!=null&&i.upsert&&(f["x-upsert"]="true");const _=yield Vc(this.fetch,`${this.url}/object/upload/sign/${c}`,{},{headers:f}),x=new URL(this.url+_.url),o=x.searchParams.get("token");if(!o)throw new sj("No token returned by API");return{data:{signedUrl:x.toString(),path:t,token:o},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Gs(c))return{data:null,error:c};throw c}})}update(t,i,c){return _n(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,i,c)})}move(t,i,c){return _n(this,void 0,void 0,function*(){try{return{data:yield Vc(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:i,destinationBucket:c==null?void 0:c.destinationBucket},{headers:this.headers}),error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(Gs(f))return{data:null,error:f};throw f}})}copy(t,i,c){return _n(this,void 0,void 0,function*(){try{return{data:{path:(yield Vc(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:i,destinationBucket:c==null?void 0:c.destinationBucket},{headers:this.headers})).Key},error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(Gs(f))return{data:null,error:f};throw f}})}createSignedUrl(t,i,c){return _n(this,void 0,void 0,function*(){try{let f=this._getFinalPath(t),_=yield Vc(this.fetch,`${this.url}/object/sign/${f}`,Object.assign({expiresIn:i},c!=null&&c.transform?{transform:c.transform}:{}),{headers:this.headers});const x=c!=null&&c.download?`&download=${c.download===!0?"":c.download}`:"";return _={signedUrl:encodeURI(`${this.url}${_.signedURL}${x}`)},{data:_,error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(Gs(f))return{data:null,error:f};throw f}})}createSignedUrls(t,i,c){return _n(this,void 0,void 0,function*(){try{const f=yield Vc(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:i,paths:t},{headers:this.headers}),_=c!=null&&c.download?`&download=${c.download===!0?"":c.download}`:"";return{data:f.map(x=>Object.assign(Object.assign({},x),{signedUrl:x.signedURL?encodeURI(`${this.url}${x.signedURL}${_}`):null})),error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(Gs(f))return{data:null,error:f};throw f}})}download(t,i){const f=typeof(i==null?void 0:i.transform)<"u"?"render/image/authenticated":"object",_=this.transformOptsToQueryString((i==null?void 0:i.transform)||{}),x=_?`?${_}`:"",o=this._getFinalPath(t),I=()=>Q0(this.fetch,`${this.url}/${f}/${o}${x}`,{headers:this.headers,noResolveJson:!0});return new EQ(I,this.shouldThrowOnError)}info(t){return _n(this,void 0,void 0,function*(){const i=this._getFinalPath(t);try{const c=yield Q0(this.fetch,`${this.url}/object/info/${i}`,{headers:this.headers});return{data:lP(c),error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Gs(c))return{data:null,error:c};throw c}})}exists(t){return _n(this,void 0,void 0,function*(){const i=this._getFinalPath(t);try{return yield SQ(this.fetch,`${this.url}/object/${i}`,{headers:this.headers}),{data:!0,error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Gs(c)&&c instanceof aP){const f=c.originalError;if([400,404].includes(f==null?void 0:f.status))return{data:!1,error:c}}throw c}})}getPublicUrl(t,i){const c=this._getFinalPath(t),f=[],_=i!=null&&i.download?`download=${i.download===!0?"":i.download}`:"";_!==""&&f.push(_);const o=typeof(i==null?void 0:i.transform)<"u"?"render/image":"object",I=this.transformOptsToQueryString((i==null?void 0:i.transform)||{});I!==""&&f.push(I);let P=f.join("&");return P!==""&&(P=`?${P}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${c}${P}`)}}}remove(t){return _n(this,void 0,void 0,function*(){try{return{data:yield aj(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Gs(i))return{data:null,error:i};throw i}})}list(t,i,c){return _n(this,void 0,void 0,function*(){try{const f=Object.assign(Object.assign(Object.assign({},CQ),i),{prefix:t||""});return{data:yield Vc(this.fetch,`${this.url}/object/list/${this.bucketId}`,f,{headers:this.headers},c),error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(Gs(f))return{data:null,error:f};throw f}})}listV2(t,i){return _n(this,void 0,void 0,function*(){try{const c=Object.assign({},t);return{data:yield Vc(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,c,{headers:this.headers},i),error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Gs(c))return{data:null,error:c};throw c}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const i=[];return t.width&&i.push(`width=${t.width}`),t.height&&i.push(`height=${t.height}`),t.resize&&i.push(`resize=${t.resize}`),t.format&&i.push(`format=${t.format}`),t.quality&&i.push(`quality=${t.quality}`),i.join("&")}}const wV="2.80.0",SV={"X-Client-Info":`storage-js/${wV}`};class IQ{constructor(t,i={},c,f){this.shouldThrowOnError=!1;const _=new URL(t);f!=null&&f.useNewHostname&&/supabase\.(co|in|red)$/.test(_.hostname)&&!_.hostname.includes("storage.supabase.")&&(_.hostname=_.hostname.replace("supabase.","storage.supabase.")),this.url=_.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},SV),i),this.fetch=oj(c)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(t){return _n(this,void 0,void 0,function*(){try{const i=this.listBucketOptionsToQueryString(t);return{data:yield Q0(this.fetch,`${this.url}/bucket${i}`,{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Gs(i))return{data:null,error:i};throw i}})}getBucket(t){return _n(this,void 0,void 0,function*(){try{return{data:yield Q0(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Gs(i))return{data:null,error:i};throw i}})}createBucket(t){return _n(this,arguments,void 0,function*(i,c={public:!1}){try{return{data:yield Vc(this.fetch,`${this.url}/bucket`,{id:i,name:i,type:c.type,public:c.public,file_size_limit:c.fileSizeLimit,allowed_mime_types:c.allowedMimeTypes},{headers:this.headers}),error:null}}catch(f){if(this.shouldThrowOnError)throw f;if(Gs(f))return{data:null,error:f};throw f}})}updateBucket(t,i){return _n(this,void 0,void 0,function*(){try{return{data:yield cP(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Gs(c))return{data:null,error:c};throw c}})}emptyBucket(t){return _n(this,void 0,void 0,function*(){try{return{data:yield Vc(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Gs(i))return{data:null,error:i};throw i}})}deleteBucket(t){return _n(this,void 0,void 0,function*(){try{return{data:yield aj(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Gs(i))return{data:null,error:i};throw i}})}listBucketOptionsToQueryString(t){const i={};return t&&("limit"in t&&(i.limit=String(t.limit)),"offset"in t&&(i.offset=String(t.offset)),t.search&&(i.search=t.search),t.sortColumn&&(i.sortColumn=t.sortColumn),t.sortOrder&&(i.sortOrder=t.sortOrder)),Object.keys(i).length>0?"?"+new URLSearchParams(i).toString():""}}class PQ{constructor(t,i={},c){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},SV),i),this.fetch=oj(c)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return _n(this,void 0,void 0,function*(){try{return{data:yield Vc(this.fetch,`${this.url}/bucket`,{name:t},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Gs(i))return{data:null,error:i};throw i}})}listBuckets(t){return _n(this,void 0,void 0,function*(){try{const i=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&i.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&i.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&i.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&i.set("sortOrder",t.sortOrder),t!=null&&t.search&&i.set("search",t.search);const c=i.toString(),f=c?`${this.url}/bucket?${c}`:`${this.url}/bucket`;return{data:yield Q0(this.fetch,f,{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Gs(i))return{data:null,error:i};throw i}})}deleteBucket(t){return _n(this,void 0,void 0,function*(){try{return{data:yield aj(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Gs(i))return{data:null,error:i};throw i}})}}const lj={"X-Client-Info":`storage-js/${wV}`,"Content-Type":"application/json"};class TV extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function zl(e){return typeof e=="object"&&e!==null&&"__isStorageVectorsError"in e}class uA extends TV{constructor(t,i,c){super(t),this.name="StorageVectorsApiError",this.status=i,this.statusCode=c}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class kQ extends TV{constructor(t,i){super(t),this.name="StorageVectorsUnknownError",this.originalError=i}}var HL;(function(e){e.InternalError="InternalError",e.S3VectorConflictException="S3VectorConflictException",e.S3VectorNotFoundException="S3VectorNotFoundException",e.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",e.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",e.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(HL||(HL={}));const cj=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),jQ=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},ZL=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),RQ=(e,t,i)=>_n(void 0,void 0,void 0,function*(){if(e&&typeof e=="object"&&"status"in e&&"ok"in e&&typeof e.status=="number"&&!(i!=null&&i.noResolveJson)){const f=e.status||500,_=e;if(typeof _.json=="function")_.json().then(x=>{const o=(x==null?void 0:x.statusCode)||(x==null?void 0:x.code)||f+"";t(new uA(ZL(x),f,o))}).catch(()=>{const x=f+"",o=_.statusText||`HTTP ${f} error`;t(new uA(o,f,x))});else{const x=f+"",o=_.statusText||`HTTP ${f} error`;t(new uA(o,f,x))}}else t(new kQ(ZL(e),e))}),MQ=(e,t,i,c)=>{const f={method:e,headers:(t==null?void 0:t.headers)||{}};return c?(jQ(c)?(f.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),f.body=JSON.stringify(c)):f.body=c,Object.assign(Object.assign({},f),i)):f};function DQ(e,t,i,c,f,_){return _n(this,void 0,void 0,function*(){return new Promise((x,o)=>{e(i,MQ(t,c,f,_)).then(I=>{if(!I.ok)throw I;if(c!=null&&c.noResolveJson)return I;const P=I.headers.get("content-type");return!P||!P.includes("application/json")?{}:I.json()}).then(I=>x(I)).catch(I=>RQ(I,o,c))})})}function Fl(e,t,i,c,f){return _n(this,void 0,void 0,function*(){return DQ(e,"POST",t,c,f,i)})}class NQ{constructor(t,i={},c){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},lj),i),this.fetch=cj(c)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(t){return _n(this,void 0,void 0,function*(){try{return{data:(yield Fl(this.fetch,`${this.url}/CreateIndex`,t,{headers:this.headers}))||{},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(zl(i))return{data:null,error:i};throw i}})}getIndex(t,i){return _n(this,void 0,void 0,function*(){try{return{data:yield Fl(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:t,indexName:i},{headers:this.headers}),error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(zl(c))return{data:null,error:c};throw c}})}listIndexes(t){return _n(this,void 0,void 0,function*(){try{return{data:yield Fl(this.fetch,`${this.url}/ListIndexes`,t,{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(zl(i))return{data:null,error:i};throw i}})}deleteIndex(t,i){return _n(this,void 0,void 0,function*(){try{return{data:(yield Fl(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:t,indexName:i},{headers:this.headers}))||{},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(zl(c))return{data:null,error:c};throw c}})}}class OQ{constructor(t,i={},c){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},lj),i),this.fetch=cj(c)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(t){return _n(this,void 0,void 0,function*(){try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield Fl(this.fetch,`${this.url}/PutVectors`,t,{headers:this.headers}))||{},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(zl(i))return{data:null,error:i};throw i}})}getVectors(t){return _n(this,void 0,void 0,function*(){try{return{data:yield Fl(this.fetch,`${this.url}/GetVectors`,t,{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(zl(i))return{data:null,error:i};throw i}})}listVectors(t){return _n(this,void 0,void 0,function*(){try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:yield Fl(this.fetch,`${this.url}/ListVectors`,t,{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(zl(i))return{data:null,error:i};throw i}})}queryVectors(t){return _n(this,void 0,void 0,function*(){try{return{data:yield Fl(this.fetch,`${this.url}/QueryVectors`,t,{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(zl(i))return{data:null,error:i};throw i}})}deleteVectors(t){return _n(this,void 0,void 0,function*(){try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield Fl(this.fetch,`${this.url}/DeleteVectors`,t,{headers:this.headers}))||{},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(zl(i))return{data:null,error:i};throw i}})}}class LQ{constructor(t,i={},c){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},lj),i),this.fetch=cj(c)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return _n(this,void 0,void 0,function*(){try{return{data:(yield Fl(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(zl(i))return{data:null,error:i};throw i}})}getBucket(t){return _n(this,void 0,void 0,function*(){try{return{data:yield Fl(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:t},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(zl(i))return{data:null,error:i};throw i}})}listBuckets(){return _n(this,arguments,void 0,function*(t={}){try{return{data:yield Fl(this.fetch,`${this.url}/ListVectorBuckets`,t,{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(zl(i))return{data:null,error:i};throw i}})}deleteBucket(t){return _n(this,void 0,void 0,function*(){try{return{data:(yield Fl(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(zl(i))return{data:null,error:i};throw i}})}}class zQ extends LQ{constructor(t,i={}){super(t,i.headers||{},i.fetch)}from(t){return new FQ(this.url,this.headers,t,this.fetch)}}class FQ extends NQ{constructor(t,i,c,f){super(t,i,f),this.vectorBucketName=c}createIndex(t){const i=Object.create(null,{createIndex:{get:()=>super.createIndex}});return _n(this,void 0,void 0,function*(){return i.createIndex.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const t=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return _n(this,arguments,void 0,function*(i={}){return t.listIndexes.call(this,Object.assign(Object.assign({},i),{vectorBucketName:this.vectorBucketName}))})}getIndex(t){const i=Object.create(null,{getIndex:{get:()=>super.getIndex}});return _n(this,void 0,void 0,function*(){return i.getIndex.call(this,this.vectorBucketName,t)})}deleteIndex(t){const i=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return _n(this,void 0,void 0,function*(){return i.deleteIndex.call(this,this.vectorBucketName,t)})}index(t){return new BQ(this.url,this.headers,this.vectorBucketName,t,this.fetch)}}class BQ extends OQ{constructor(t,i,c,f,_){super(t,i,_),this.vectorBucketName=c,this.indexName=f}putVectors(t){const i=Object.create(null,{putVectors:{get:()=>super.putVectors}});return _n(this,void 0,void 0,function*(){return i.putVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(t){const i=Object.create(null,{getVectors:{get:()=>super.getVectors}});return _n(this,void 0,void 0,function*(){return i.getVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const t=Object.create(null,{listVectors:{get:()=>super.listVectors}});return _n(this,arguments,void 0,function*(i={}){return t.listVectors.call(this,Object.assign(Object.assign({},i),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(t){const i=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return _n(this,void 0,void 0,function*(){return i.queryVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(t){const i=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return _n(this,void 0,void 0,function*(){return i.deleteVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class VQ extends IQ{constructor(t,i={},c,f){super(t,i,c,f)}from(t){return new AQ(this.url,this.headers,t,this.fetch)}get vectors(){return new zQ(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new PQ(this.url+"/iceberg",this.headers,this.fetch)}}const UQ="2.80.0";let u0="";typeof Deno<"u"?u0="deno":typeof document<"u"?u0="web":typeof navigator<"u"&&navigator.product==="ReactNative"?u0="react-native":u0="node";const $Q={"X-Client-Info":`supabase-js-${u0}/${UQ}`},qQ={headers:$Q},GQ={schema:"public"},WQ={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},HQ={},ZQ=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),XQ=()=>Headers,KQ=(e,t,i)=>{const c=ZQ(i),f=XQ();return async(_,x)=>{var o;const I=(o=await t())!==null&&o!==void 0?o:e;let P=new f(x==null?void 0:x.headers);return P.has("apikey")||P.set("apikey",e),P.has("Authorization")||P.set("Authorization",`Bearer ${I}`),c(_,Object.assign(Object.assign({},x),{headers:P}))}};function YQ(e){return e.endsWith("/")?e:e+"/"}function JQ(e,t){var i,c;const{db:f,auth:_,realtime:x,global:o}=e,{db:I,auth:P,realtime:N,global:U}=t,$={db:Object.assign(Object.assign({},I),f),auth:Object.assign(Object.assign({},P),_),realtime:Object.assign(Object.assign({},N),x),storage:{},global:Object.assign(Object.assign(Object.assign({},U),o),{headers:Object.assign(Object.assign({},(i=U==null?void 0:U.headers)!==null&&i!==void 0?i:{}),(c=o==null?void 0:o.headers)!==null&&c!==void 0?c:{})}),accessToken:async()=>""};return e.accessToken?$.accessToken=e.accessToken:delete $.accessToken,$}function QQ(e){const t=e==null?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(YQ(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const EV="2.80.0",C_=30*1e3,uP=3,dA=uP*C_,eee="http://localhost:9999",tee="supabase.auth.token",ree={"X-Client-Info":`gotrue-js/${EV}`},dP="X-Supabase-Api-Version",CV={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},nee=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,iee=10*60*1e3;class eb extends Error{constructor(t,i,c){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=i,this.code=c}}function Tn(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class see extends eb{constructor(t,i,c){super(t,i,c),this.name="AuthApiError",this.status=i,this.code=c}}function oee(e){return Tn(e)&&e.name==="AuthApiError"}class rm extends eb{constructor(t,i){super(t),this.name="AuthUnknownError",this.originalError=i}}class Hf extends eb{constructor(t,i,c,f){super(t,c,f),this.name=i,this.status=c}}class Lc extends Hf{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function aee(e){return Tn(e)&&e.name==="AuthSessionMissingError"}class g_ extends Hf{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class iS extends Hf{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class sS extends Hf{constructor(t,i=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function lee(e){return Tn(e)&&e.name==="AuthImplicitGrantRedirectError"}class XL extends Hf{constructor(t,i=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class hP extends Hf{constructor(t,i){super(t,"AuthRetryableFetchError",i,void 0)}}function hA(e){return Tn(e)&&e.name==="AuthRetryableFetchError"}class KL extends Hf{constructor(t,i,c){super(t,"AuthWeakPasswordError",i,"weak_password"),this.reasons=c}}class fP extends Hf{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const mT="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),YL=` 	
\r=`.split(""),cee=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<YL.length;t+=1)e[YL[t].charCodeAt(0)]=-2;for(let t=0;t<mT.length;t+=1)e[mT[t].charCodeAt(0)]=t;return e})();function JL(e,t,i){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const c=t.queue>>t.queuedBits-6&63;i(mT[c]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const c=t.queue>>t.queuedBits-6&63;i(mT[c]),t.queuedBits-=6}}function AV(e,t,i){const c=cee[e];if(c>-1)for(t.queue=t.queue<<6|c,t.queuedBits+=6;t.queuedBits>=8;)i(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(c===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function QL(e){const t=[],i=x=>{t.push(String.fromCodePoint(x))},c={utf8seq:0,codepoint:0},f={queue:0,queuedBits:0},_=x=>{hee(x,c,i)};for(let x=0;x<e.length;x+=1)AV(e.charCodeAt(x),f,_);return t.join("")}function uee(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function dee(e,t){for(let i=0;i<e.length;i+=1){let c=e.charCodeAt(i);if(c>55295&&c<=56319){const f=(c-55296)*1024&65535;c=(e.charCodeAt(i+1)-56320&65535|f)+65536,i+=1}uee(c,t)}}function hee(e,t,i){if(t.utf8seq===0){if(e<=127){i(e);return}for(let c=1;c<6;c+=1)if(!(e>>7-c&1)){t.utf8seq=c;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&i(t.codepoint)}}function K_(e){const t=[],i={queue:0,queuedBits:0},c=f=>{t.push(f)};for(let f=0;f<e.length;f+=1)AV(e.charCodeAt(f),i,c);return new Uint8Array(t)}function fee(e){const t=[];return dee(e,i=>t.push(i)),new Uint8Array(t)}function om(e){const t=[],i={queue:0,queuedBits:0},c=f=>{t.push(f)};return e.forEach(f=>JL(f,i,c)),JL(null,i,c),t.join("")}function pee(e){return Math.round(Date.now()/1e3)+e}function mee(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e=="x"?t:t&3|8).toString(16)})}const xa=()=>typeof window<"u"&&typeof document<"u",Xp={tested:!1,writable:!1},IV=()=>{if(!xa())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Xp.tested)return Xp.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Xp.tested=!0,Xp.writable=!0}catch{Xp.tested=!0,Xp.writable=!1}return Xp.writable};function gee(e){const t={},i=new URL(e);if(i.hash&&i.hash[0]==="#")try{new URLSearchParams(i.hash.substring(1)).forEach((f,_)=>{t[_]=f})}catch{}return i.searchParams.forEach((c,f)=>{t[f]=c}),t}const PV=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),_ee=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",A_=async(e,t,i)=>{await e.setItem(t,JSON.stringify(i))},Kp=async(e,t)=>{const i=await e.getItem(t);if(!i)return null;try{return JSON.parse(i)}catch{return i}},Xh=async(e,t)=>{await e.removeItem(t)};class c2{constructor(){this.promise=new c2.promiseConstructor((t,i)=>{this.resolve=t,this.reject=i})}}c2.promiseConstructor=Promise;function fA(e){const t=e.split(".");if(t.length!==3)throw new fP("Invalid JWT structure");for(let c=0;c<t.length;c++)if(!nee.test(t[c]))throw new fP("JWT not in base64url format");return{header:JSON.parse(QL(t[0])),payload:JSON.parse(QL(t[1])),signature:K_(t[2]),raw:{header:t[0],payload:t[1]}}}async function yee(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function vee(e,t){return new Promise((c,f)=>{(async()=>{for(let _=0;_<1/0;_++)try{const x=await e(_);if(!t(_,null,x)){c(x);return}}catch(x){if(!t(_,x)){f(x);return}}})()})}function xee(e){return("0"+e.toString(16)).substr(-2)}function bee(){const t=new Uint32Array(56);if(typeof crypto>"u"){const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",c=i.length;let f="";for(let _=0;_<56;_++)f+=i.charAt(Math.floor(Math.random()*c));return f}return crypto.getRandomValues(t),Array.from(t,xee).join("")}async function wee(e){const i=new TextEncoder().encode(e),c=await crypto.subtle.digest("SHA-256",i),f=new Uint8Array(c);return Array.from(f).map(_=>String.fromCharCode(_)).join("")}async function See(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const i=await wee(e);return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function __(e,t,i=!1){const c=bee();let f=c;i&&(f+="/PASSWORD_RECOVERY"),await A_(e,`${t}-code-verifier`,f);const _=await See(c);return[_,c===_?"plain":"s256"]}const Tee=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Eee(e){const t=e.headers.get(dP);if(!t||!t.match(Tee))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function Cee(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function Aee(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Iee=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function y_(e){if(!Iee.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function pA(){const e={};return new Proxy(e,{get:(t,i)=>{if(i==="__isUserNotAvailableProxy")return!0;if(typeof i=="symbol"){const c=i.toString();if(c==="Symbol(Symbol.toPrimitive)"||c==="Symbol(Symbol.toStringTag)"||c==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${i}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,i)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${i}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,i)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${i}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Pee(e,t){return new Proxy(e,{get:(i,c,f)=>{if(c==="__isInsecureUserWarningProxy")return!0;if(typeof c=="symbol"){const _=c.toString();if(_==="Symbol(Symbol.toPrimitive)"||_==="Symbol(Symbol.toStringTag)"||_==="Symbol(util.inspect.custom)"||_==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(i,c,f)}return!t.value&&typeof c=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(i,c,f)}})}function ez(e){return JSON.parse(JSON.stringify(e))}const Qp=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),kee=[502,503,504];async function tz(e){var t;if(!_ee(e))throw new hP(Qp(e),0);if(kee.includes(e.status))throw new hP(Qp(e),e.status);let i;try{i=await e.json()}catch(_){throw new rm(Qp(_),_)}let c;const f=Eee(e);if(f&&f.getTime()>=CV["2024-01-01"].timestamp&&typeof i=="object"&&i&&typeof i.code=="string"?c=i.code:typeof i=="object"&&i&&typeof i.error_code=="string"&&(c=i.error_code),c){if(c==="weak_password")throw new KL(Qp(i),e.status,((t=i.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(c==="session_not_found")throw new Lc}else if(typeof i=="object"&&i&&typeof i.weak_password=="object"&&i.weak_password&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.reasons.reduce((_,x)=>_&&typeof x=="string",!0))throw new KL(Qp(i),e.status,i.weak_password.reasons);throw new see(Qp(i),e.status||500,c)}const jee=(e,t,i,c)=>{const f={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?f:(f.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),f.body=JSON.stringify(c),Object.assign(Object.assign({},f),i))};async function Qn(e,t,i,c){var f;const _=Object.assign({},c==null?void 0:c.headers);_[dP]||(_[dP]=CV["2024-01-01"].name),c!=null&&c.jwt&&(_.Authorization=`Bearer ${c.jwt}`);const x=(f=c==null?void 0:c.query)!==null&&f!==void 0?f:{};c!=null&&c.redirectTo&&(x.redirect_to=c.redirectTo);const o=Object.keys(x).length?"?"+new URLSearchParams(x).toString():"",I=await Ree(e,t,i+o,{headers:_,noResolveJson:c==null?void 0:c.noResolveJson},{},c==null?void 0:c.body);return c!=null&&c.xform?c==null?void 0:c.xform(I):{data:Object.assign({},I),error:null}}async function Ree(e,t,i,c,f,_){const x=jee(t,c,f,_);let o;try{o=await e(i,Object.assign({},x))}catch(I){throw console.error(I),new hP(Qp(I),0)}if(o.ok||await tz(o),c!=null&&c.noResolveJson)return o;try{return await o.json()}catch(I){await tz(I)}}function zc(e){var t;let i=null;Nee(e)&&(i=Object.assign({},e),e.expires_at||(i.expires_at=pee(e.expires_in)));const c=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:i,user:c},error:null}}function rz(e){const t=zc(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((i,c)=>i&&typeof c=="string",!0)&&(t.data.weak_password=e.weak_password),t}function sf(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function Mee(e){return{data:e,error:null}}function Dee(e){const{action_link:t,email_otp:i,hashed_token:c,redirect_to:f,verification_type:_}=e,x=Wf(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:t,email_otp:i,hashed_token:c,redirect_to:f,verification_type:_},I=Object.assign({},x);return{data:{properties:o,user:I},error:null}}function nz(e){return e}function Nee(e){return e.access_token&&e.refresh_token&&e.expires_in}const mA=["global","local","others"];class Oee{constructor({url:t="",headers:i={},fetch:c}){this.url=t,this.headers=i,this.fetch=PV(c),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,i=mA[0]){if(mA.indexOf(i)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${mA.join(", ")}`);try{return await Qn(this.fetch,"POST",`${this.url}/logout?scope=${i}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(c){if(Tn(c))return{data:null,error:c};throw c}}async inviteUserByEmail(t,i={}){try{return await Qn(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:i.data},headers:this.headers,redirectTo:i.redirectTo,xform:sf})}catch(c){if(Tn(c))return{data:{user:null},error:c};throw c}}async generateLink(t){try{const{options:i}=t,c=Wf(t,["options"]),f=Object.assign(Object.assign({},c),i);return"newEmail"in c&&(f.new_email=c==null?void 0:c.newEmail,delete f.newEmail),await Qn(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:f,headers:this.headers,xform:Dee,redirectTo:i==null?void 0:i.redirectTo})}catch(i){if(Tn(i))return{data:{properties:null,user:null},error:i};throw i}}async createUser(t){try{return await Qn(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:sf})}catch(i){if(Tn(i))return{data:{user:null},error:i};throw i}}async listUsers(t){var i,c,f,_,x,o,I;try{const P={nextPage:null,lastPage:0,total:0},N=await Qn(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(c=(i=t==null?void 0:t.page)===null||i===void 0?void 0:i.toString())!==null&&c!==void 0?c:"",per_page:(_=(f=t==null?void 0:t.perPage)===null||f===void 0?void 0:f.toString())!==null&&_!==void 0?_:""},xform:nz});if(N.error)throw N.error;const U=await N.json(),$=(x=N.headers.get("x-total-count"))!==null&&x!==void 0?x:0,B=(I=(o=N.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&I!==void 0?I:[];return B.length>0&&(B.forEach(Y=>{const H=parseInt(Y.split(";")[0].split("=")[1].substring(0,1)),K=JSON.parse(Y.split(";")[1].split("=")[1]);P[`${K}Page`]=H}),P.total=parseInt($)),{data:Object.assign(Object.assign({},U),P),error:null}}catch(P){if(Tn(P))return{data:{users:[]},error:P};throw P}}async getUserById(t){y_(t);try{return await Qn(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:sf})}catch(i){if(Tn(i))return{data:{user:null},error:i};throw i}}async updateUserById(t,i){y_(t);try{return await Qn(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:i,headers:this.headers,xform:sf})}catch(c){if(Tn(c))return{data:{user:null},error:c};throw c}}async deleteUser(t,i=!1){y_(t);try{return await Qn(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:i},xform:sf})}catch(c){if(Tn(c))return{data:{user:null},error:c};throw c}}async _listFactors(t){y_(t.userId);try{const{data:i,error:c}=await Qn(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:f=>({data:{factors:f},error:null})});return{data:i,error:c}}catch(i){if(Tn(i))return{data:null,error:i};throw i}}async _deleteFactor(t){y_(t.userId),y_(t.id);try{return{data:await Qn(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(i){if(Tn(i))return{data:null,error:i};throw i}}async _listOAuthClients(t){var i,c,f,_,x,o,I;try{const P={nextPage:null,lastPage:0,total:0},N=await Qn(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(c=(i=t==null?void 0:t.page)===null||i===void 0?void 0:i.toString())!==null&&c!==void 0?c:"",per_page:(_=(f=t==null?void 0:t.perPage)===null||f===void 0?void 0:f.toString())!==null&&_!==void 0?_:""},xform:nz});if(N.error)throw N.error;const U=await N.json(),$=(x=N.headers.get("x-total-count"))!==null&&x!==void 0?x:0,B=(I=(o=N.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&I!==void 0?I:[];return B.length>0&&(B.forEach(Y=>{const H=parseInt(Y.split(";")[0].split("=")[1].substring(0,1)),K=JSON.parse(Y.split(";")[1].split("=")[1]);P[`${K}Page`]=H}),P.total=parseInt($)),{data:Object.assign(Object.assign({},U),P),error:null}}catch(P){if(Tn(P))return{data:{clients:[]},error:P};throw P}}async _createOAuthClient(t){try{return await Qn(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(Tn(i))return{data:null,error:i};throw i}}async _getOAuthClient(t){try{return await Qn(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(Tn(i))return{data:null,error:i};throw i}}async _updateOAuthClient(t,i){try{return await Qn(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:i,headers:this.headers,xform:c=>({data:c,error:null})})}catch(c){if(Tn(c))return{data:null,error:c};throw c}}async _deleteOAuthClient(t){try{return await Qn(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(i){if(Tn(i))return{data:null,error:i};throw i}}async _regenerateOAuthClientSecret(t){try{return await Qn(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(Tn(i))return{data:null,error:i};throw i}}}function iz(e={}){return{getItem:t=>e[t]||null,setItem:(t,i)=>{e[t]=i},removeItem:t=>{delete e[t]}}}const v_={debug:!!(globalThis&&IV()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class kV extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class Lee extends kV{}async function zee(e,t,i){v_.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const c=new globalThis.AbortController;return t>0&&setTimeout(()=>{c.abort(),v_.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:c.signal},async f=>{if(f){v_.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,f.name);try{return await i()}finally{v_.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,f.name)}}else{if(t===0)throw v_.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Lee(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(v_.debug)try{const _=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(_,null,"  "))}catch(_){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",_)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await i()}}))}function Fee(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function jV(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function Bee(e){return parseInt(e,16)}function Vee(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,c=>c.toString(16).padStart(2,"0")).join("")}function Uee(e){var t;const{chainId:i,domain:c,expirationTime:f,issuedAt:_=new Date,nonce:x,notBefore:o,requestId:I,resources:P,scheme:N,uri:U,version:$}=e;{if(!Number.isInteger(i))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${i}`);if(!c)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(x&&x.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${x}`);if(!U)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if($!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${$}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const B=jV(e.address),Y=N?`${N}://${c}`:c,H=e.statement?`${e.statement}
`:"",K=`${Y} wants you to sign in with your Ethereum account:
${B}

${H}`;let re=`URI: ${U}
Version: ${$}
Chain ID: ${i}${x?`
Nonce: ${x}`:""}
Issued At: ${_.toISOString()}`;if(f&&(re+=`
Expiration Time: ${f.toISOString()}`),o&&(re+=`
Not Before: ${o.toISOString()}`),I&&(re+=`
Request ID: ${I}`),P){let G=`
Resources:`;for(const X of P){if(!X||typeof X!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${X}`);G+=`
- ${X}`}re+=G}return`${K}
${re}`}class Po extends Error{constructor({message:t,code:i,cause:c,name:f}){var _;super(t,{cause:c}),this.__isWebAuthnError=!0,this.name=(_=f??(c instanceof Error?c.name:void 0))!==null&&_!==void 0?_:"Unknown Error",this.code=i}}class gT extends Po{constructor(t,i){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i,message:t}),this.name="WebAuthnUnknownError",this.originalError=i}}function $ee({error:e,options:t}){var i,c,f;const{publicKey:_}=t;if(!_)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Po({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((i=_.authenticatorSelection)===null||i===void 0?void 0:i.requireResidentKey)===!0)return new Po({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((c=_.authenticatorSelection)===null||c===void 0?void 0:c.userVerification)==="required")return new Po({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((f=_.authenticatorSelection)===null||f===void 0?void 0:f.userVerification)==="required")return new Po({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new Po({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new Po({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return _.pubKeyCredParams.filter(o=>o.type==="public-key").length===0?new Po({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new Po({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const x=window.location.hostname;if(RV(x)){if(_.rp.id!==x)return new Po({message:`The RP ID "${_.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Po({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(_.user.id.byteLength<1||_.user.id.byteLength>64)return new Po({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new Po({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Po({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function qee({error:e,options:t}){const{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Po({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new Po({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const c=window.location.hostname;if(RV(c)){if(i.rpId!==c)return new Po({message:`The RP ID "${i.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Po({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new Po({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Po({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}class Gee{createNewAbortSignal(){if(this.controller){const i=new Error("Cancelling existing WebAuthn API call for new one");i.name="AbortError",this.controller.abort(i)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const Wee=new Gee;function Hee(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:i,excludeCredentials:c}=e,f=Wf(e,["challenge","user","excludeCredentials"]),_=K_(t).buffer,x=Object.assign(Object.assign({},i),{id:K_(i.id).buffer}),o=Object.assign(Object.assign({},f),{challenge:_,user:x});if(c&&c.length>0){o.excludeCredentials=new Array(c.length);for(let I=0;I<c.length;I++){const P=c[I];o.excludeCredentials[I]=Object.assign(Object.assign({},P),{id:K_(P.id).buffer,type:P.type||"public-key",transports:P.transports})}}return o}function Zee(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:i}=e,c=Wf(e,["challenge","allowCredentials"]),f=K_(t).buffer,_=Object.assign(Object.assign({},c),{challenge:f});if(i&&i.length>0){_.allowCredentials=new Array(i.length);for(let x=0;x<i.length;x++){const o=i[x];_.allowCredentials[x]=Object.assign(Object.assign({},o),{id:K_(o.id).buffer,type:o.type||"public-key",transports:o.transports})}}return _}function Xee(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const i=e;return{id:e.id,rawId:e.id,response:{attestationObject:om(new Uint8Array(e.response.attestationObject)),clientDataJSON:om(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=i.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function Kee(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const i=e,c=e.getClientExtensionResults(),f=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:om(new Uint8Array(f.authenticatorData)),clientDataJSON:om(new Uint8Array(f.clientDataJSON)),signature:om(new Uint8Array(f.signature)),userHandle:f.userHandle?om(new Uint8Array(f.userHandle)):void 0},type:"public-key",clientExtensionResults:c,authenticatorAttachment:(t=i.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function RV(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function sz(){var e,t;return!!(xa()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.get)=="function")}async function Yee(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new gT("Browser returned unexpected credential type",t)}:{data:null,error:new gT("Empty credential response",t)}}catch(t){return{data:null,error:$ee({error:t,options:e})}}}async function Jee(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new gT("Browser returned unexpected credential type",t)}:{data:null,error:new gT("Empty credential response",t)}}catch(t){return{data:null,error:qee({error:t,options:e})}}}const Qee={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},ete={userVerification:"preferred",hints:["security-key"]};function _T(...e){const t=f=>f!==null&&typeof f=="object"&&!Array.isArray(f),i=f=>f instanceof ArrayBuffer||ArrayBuffer.isView(f),c={};for(const f of e)if(f)for(const _ in f){const x=f[_];if(x!==void 0)if(Array.isArray(x))c[_]=x;else if(i(x))c[_]=x;else if(t(x)){const o=c[_];t(o)?c[_]=_T(o,x):c[_]=_T(x)}else c[_]=x}return c}function tte(e,t){return _T(Qee,e,t||{})}function rte(e,t){return _T(ete,e,t||{})}class nte{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:i,friendlyName:c,signal:f},_){try{const{data:x,error:o}=await this.client.mfa.challenge({factorId:t,webauthn:i});if(!x)return{data:null,error:o};const I=f??Wee.createNewAbortSignal();if(x.webauthn.type==="create"){const{user:P}=x.webauthn.credential_options.publicKey;P.name||(P.name=`${P.id}:${c}`),P.displayName||(P.displayName=P.name)}switch(x.webauthn.type){case"create":{const P=tte(x.webauthn.credential_options.publicKey,_==null?void 0:_.create),{data:N,error:U}=await Yee({publicKey:P,signal:I});return N?{data:{factorId:t,challengeId:x.id,webauthn:{type:x.webauthn.type,credential_response:N}},error:null}:{data:null,error:U}}case"request":{const P=rte(x.webauthn.credential_options.publicKey,_==null?void 0:_.request),{data:N,error:U}=await Jee(Object.assign(Object.assign({},x.webauthn.credential_options),{publicKey:P,signal:I}));return N?{data:{factorId:t,challengeId:x.id,webauthn:{type:x.webauthn.type,credential_response:N}},error:null}:{data:null,error:U}}}}catch(x){return Tn(x)?{data:null,error:x}:{data:null,error:new rm("Unexpected error in challenge",x)}}}async _verify({challengeId:t,factorId:i,webauthn:c}){return this.client.mfa.verify({factorId:i,challengeId:t,webauthn:c})}async _authenticate({factorId:t,webauthn:{rpId:i=typeof window<"u"?window.location.hostname:void 0,rpOrigins:c=typeof window<"u"?[window.location.origin]:void 0,signal:f}},_){if(!i)return{data:null,error:new eb("rpId is required for WebAuthn authentication")};try{if(!sz())return{data:null,error:new rm("Browser does not support WebAuthn",null)};const{data:x,error:o}=await this.challenge({factorId:t,webauthn:{rpId:i,rpOrigins:c},signal:f},{request:_});if(!x)return{data:null,error:o};const{webauthn:I}=x;return this._verify({factorId:t,challengeId:x.challengeId,webauthn:{type:I.type,rpId:i,rpOrigins:c,credential_response:I.credential_response}})}catch(x){return Tn(x)?{data:null,error:x}:{data:null,error:new rm("Unexpected error in authenticate",x)}}}async _register({friendlyName:t,rpId:i=typeof window<"u"?window.location.hostname:void 0,rpOrigins:c=typeof window<"u"?[window.location.origin]:void 0,signal:f},_){if(!i)return{data:null,error:new eb("rpId is required for WebAuthn registration")};try{if(!sz())return{data:null,error:new rm("Browser does not support WebAuthn",null)};const{data:x,error:o}=await this._enroll({friendlyName:t});if(!x)return await this.client.mfa.listFactors().then(N=>{var U;return(U=N.data)===null||U===void 0?void 0:U.all.find($=>$.factor_type==="webauthn"&&$.friendly_name===t&&$.status!=="unverified")}).then(N=>N?this.client.mfa.unenroll({factorId:N==null?void 0:N.id}):void 0),{data:null,error:o};const{data:I,error:P}=await this._challenge({factorId:x.id,friendlyName:x.friendly_name,webauthn:{rpId:i,rpOrigins:c},signal:f},{create:_});return I?this._verify({factorId:x.id,challengeId:I.challengeId,webauthn:{rpId:i,rpOrigins:c,type:I.webauthn.type,credential_response:I.webauthn.credential_response}}):{data:null,error:P}}catch(x){return Tn(x)?{data:null,error:x}:{data:null,error:new rm("Unexpected error in register",x)}}}}Fee();const ite={url:eee,storageKey:tee,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ree,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function oz(e,t,i){return await i()}const x_={};class tb{get jwks(){var t,i;return(i=(t=x_[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&i!==void 0?i:{keys:[]}}set jwks(t){x_[this.storageKey]=Object.assign(Object.assign({},x_[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,i;return(i=(t=x_[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&i!==void 0?i:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){x_[this.storageKey]=Object.assign(Object.assign({},x_[this.storageKey]),{cachedAt:t})}constructor(t){var i,c,f;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const _=Object.assign(Object.assign({},ite),t);if(this.storageKey=_.storageKey,this.instanceID=(i=tb.nextInstanceID[this.storageKey])!==null&&i!==void 0?i:0,tb.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!_.debug,typeof _.debug=="function"&&(this.logger=_.debug),this.instanceID>0&&xa()){const x=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(x),this.logDebugMessages&&console.trace(x)}if(this.persistSession=_.persistSession,this.autoRefreshToken=_.autoRefreshToken,this.admin=new Oee({url:_.url,headers:_.headers,fetch:_.fetch}),this.url=_.url,this.headers=_.headers,this.fetch=PV(_.fetch),this.lock=_.lock||oz,this.detectSessionInUrl=_.detectSessionInUrl,this.flowType=_.flowType,this.hasCustomAuthorizationHeader=_.hasCustomAuthorizationHeader,this.throwOnError=_.throwOnError,_.lock?this.lock=_.lock:xa()&&(!((c=globalThis==null?void 0:globalThis.navigator)===null||c===void 0)&&c.locks)?this.lock=zee:this.lock=oz,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new nte(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(_.storage?this.storage=_.storage:IV()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=iz(this.memoryStorage)),_.userStorage&&(this.userStorage=_.userStorage)):(this.memoryStorage={},this.storage=iz(this.memoryStorage)),xa()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(x){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",x)}(f=this.broadcastChannel)===null||f===void 0||f.addEventListener("message",async x=>{this._debug("received broadcast notification from other tab or client",x),await this._notifyAllSubscribers(x.data.event,x.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${EV}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let i={},c="none";if(xa()&&(i=gee(window.location.href),this._isImplicitGrantCallback(i)?c="implicit":await this._isPKCECallback(i)&&(c="pkce")),xa()&&this.detectSessionInUrl&&c!=="none"){const{data:f,error:_}=await this._getSessionFromURL(i,c);if(_){if(this._debug("#_initialize()","error detecting session from URL",_),lee(_)){const I=(t=_.details)===null||t===void 0?void 0:t.code;if(I==="identity_already_exists"||I==="identity_not_found"||I==="single_identity_not_deletable")return{error:_}}return await this._removeSession(),{error:_}}const{session:x,redirectType:o}=f;return this._debug("#_initialize()","detected session in URL",x,"redirect type",o),await this._saveSession(x),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",x):await this._notifyAllSubscribers("SIGNED_IN",x)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(i){return Tn(i)?this._returnResult({error:i}):this._returnResult({error:new rm("Unexpected error during initialization",i)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var i,c,f;try{const _=await Qn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(c=(i=t==null?void 0:t.options)===null||i===void 0?void 0:i.data)!==null&&c!==void 0?c:{},gotrue_meta_security:{captcha_token:(f=t==null?void 0:t.options)===null||f===void 0?void 0:f.captchaToken}},xform:zc}),{data:x,error:o}=_;if(o||!x)return this._returnResult({data:{user:null,session:null},error:o});const I=x.session,P=x.user;return x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("SIGNED_IN",I)),this._returnResult({data:{user:P,session:I},error:null})}catch(_){if(Tn(_))return this._returnResult({data:{user:null,session:null},error:_});throw _}}async signUp(t){var i,c,f;try{let _;if("email"in t){const{email:N,password:U,options:$}=t;let B=null,Y=null;this.flowType==="pkce"&&([B,Y]=await __(this.storage,this.storageKey)),_=await Qn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:$==null?void 0:$.emailRedirectTo,body:{email:N,password:U,data:(i=$==null?void 0:$.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:$==null?void 0:$.captchaToken},code_challenge:B,code_challenge_method:Y},xform:zc})}else if("phone"in t){const{phone:N,password:U,options:$}=t;_=await Qn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:N,password:U,data:(c=$==null?void 0:$.data)!==null&&c!==void 0?c:{},channel:(f=$==null?void 0:$.channel)!==null&&f!==void 0?f:"sms",gotrue_meta_security:{captcha_token:$==null?void 0:$.captchaToken}},xform:zc})}else throw new iS("You must provide either an email or phone number and a password");const{data:x,error:o}=_;if(o||!x)return this._returnResult({data:{user:null,session:null},error:o});const I=x.session,P=x.user;return x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("SIGNED_IN",I)),this._returnResult({data:{user:P,session:I},error:null})}catch(_){if(Tn(_))return this._returnResult({data:{user:null,session:null},error:_});throw _}}async signInWithPassword(t){try{let i;if("email"in t){const{email:_,password:x,options:o}=t;i=await Qn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:_,password:x,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:rz})}else if("phone"in t){const{phone:_,password:x,options:o}=t;i=await Qn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:_,password:x,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:rz})}else throw new iS("You must provide either an email or phone number and a password");const{data:c,error:f}=i;if(f)return this._returnResult({data:{user:null,session:null},error:f});if(!c||!c.session||!c.user){const _=new g_;return this._returnResult({data:{user:null,session:null},error:_})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:Object.assign({user:c.user,session:c.session},c.weak_password?{weakPassword:c.weak_password}:null),error:f})}catch(i){if(Tn(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithOAuth(t){var i,c,f,_;return await this._handleProviderSignIn(t.provider,{redirectTo:(i=t.options)===null||i===void 0?void 0:i.redirectTo,scopes:(c=t.options)===null||c===void 0?void 0:c.scopes,queryParams:(f=t.options)===null||f===void 0?void 0:f.queryParams,skipBrowserRedirect:(_=t.options)===null||_===void 0?void 0:_.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:i}=t;switch(i){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${i}"`)}}async signInWithEthereum(t){var i,c,f,_,x,o,I,P,N,U,$;let B,Y;if("message"in t)B=t.message,Y=t.signature;else{const{chain:H,wallet:K,statement:re,options:G}=t;let X;if(xa())if(typeof K=="object")X=K;else{const Pt=window;if("ethereum"in Pt&&typeof Pt.ethereum=="object"&&"request"in Pt.ethereum&&typeof Pt.ethereum.request=="function")X=Pt.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof K!="object"||!(G!=null&&G.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");X=K}const ue=new URL((i=G==null?void 0:G.url)!==null&&i!==void 0?i:window.location.href),Ee=await X.request({method:"eth_requestAccounts"}).then(Pt=>Pt).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!Ee||Ee.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const xe=jV(Ee[0]);let Ne=(c=G==null?void 0:G.signInWithEthereum)===null||c===void 0?void 0:c.chainId;if(!Ne){const Pt=await X.request({method:"eth_chainId"});Ne=Bee(Pt)}const lt={domain:ue.host,address:xe,statement:re,uri:ue.href,version:"1",chainId:Ne,nonce:(f=G==null?void 0:G.signInWithEthereum)===null||f===void 0?void 0:f.nonce,issuedAt:(x=(_=G==null?void 0:G.signInWithEthereum)===null||_===void 0?void 0:_.issuedAt)!==null&&x!==void 0?x:new Date,expirationTime:(o=G==null?void 0:G.signInWithEthereum)===null||o===void 0?void 0:o.expirationTime,notBefore:(I=G==null?void 0:G.signInWithEthereum)===null||I===void 0?void 0:I.notBefore,requestId:(P=G==null?void 0:G.signInWithEthereum)===null||P===void 0?void 0:P.requestId,resources:(N=G==null?void 0:G.signInWithEthereum)===null||N===void 0?void 0:N.resources};B=Uee(lt),Y=await X.request({method:"personal_sign",params:[Vee(B),xe]})}try{const{data:H,error:K}=await Qn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:B,signature:Y},!((U=t.options)===null||U===void 0)&&U.captchaToken?{gotrue_meta_security:{captcha_token:($=t.options)===null||$===void 0?void 0:$.captchaToken}}:null),xform:zc});if(K)throw K;if(!H||!H.session||!H.user){const re=new g_;return this._returnResult({data:{user:null,session:null},error:re})}return H.session&&(await this._saveSession(H.session),await this._notifyAllSubscribers("SIGNED_IN",H.session)),this._returnResult({data:Object.assign({},H),error:K})}catch(H){if(Tn(H))return this._returnResult({data:{user:null,session:null},error:H});throw H}}async signInWithSolana(t){var i,c,f,_,x,o,I,P,N,U,$,B;let Y,H;if("message"in t)Y=t.message,H=t.signature;else{const{chain:K,wallet:re,statement:G,options:X}=t;let ue;if(xa())if(typeof re=="object")ue=re;else{const xe=window;if("solana"in xe&&typeof xe.solana=="object"&&("signIn"in xe.solana&&typeof xe.solana.signIn=="function"||"signMessage"in xe.solana&&typeof xe.solana.signMessage=="function"))ue=xe.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof re!="object"||!(X!=null&&X.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");ue=re}const Ee=new URL((i=X==null?void 0:X.url)!==null&&i!==void 0?i:window.location.href);if("signIn"in ue&&ue.signIn){const xe=await ue.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},X==null?void 0:X.signInWithSolana),{version:"1",domain:Ee.host,uri:Ee.href}),G?{statement:G}:null));let Ne;if(Array.isArray(xe)&&xe[0]&&typeof xe[0]=="object")Ne=xe[0];else if(xe&&typeof xe=="object"&&"signedMessage"in xe&&"signature"in xe)Ne=xe;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in Ne&&"signature"in Ne&&(typeof Ne.signedMessage=="string"||Ne.signedMessage instanceof Uint8Array)&&Ne.signature instanceof Uint8Array)Y=typeof Ne.signedMessage=="string"?Ne.signedMessage:new TextDecoder().decode(Ne.signedMessage),H=Ne.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in ue)||typeof ue.signMessage!="function"||!("publicKey"in ue)||typeof ue!="object"||!ue.publicKey||!("toBase58"in ue.publicKey)||typeof ue.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");Y=[`${Ee.host} wants you to sign in with your Solana account:`,ue.publicKey.toBase58(),...G?["",G,""]:[""],"Version: 1",`URI: ${Ee.href}`,`Issued At: ${(f=(c=X==null?void 0:X.signInWithSolana)===null||c===void 0?void 0:c.issuedAt)!==null&&f!==void 0?f:new Date().toISOString()}`,...!((_=X==null?void 0:X.signInWithSolana)===null||_===void 0)&&_.notBefore?[`Not Before: ${X.signInWithSolana.notBefore}`]:[],...!((x=X==null?void 0:X.signInWithSolana)===null||x===void 0)&&x.expirationTime?[`Expiration Time: ${X.signInWithSolana.expirationTime}`]:[],...!((o=X==null?void 0:X.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${X.signInWithSolana.chainId}`]:[],...!((I=X==null?void 0:X.signInWithSolana)===null||I===void 0)&&I.nonce?[`Nonce: ${X.signInWithSolana.nonce}`]:[],...!((P=X==null?void 0:X.signInWithSolana)===null||P===void 0)&&P.requestId?[`Request ID: ${X.signInWithSolana.requestId}`]:[],...!((U=(N=X==null?void 0:X.signInWithSolana)===null||N===void 0?void 0:N.resources)===null||U===void 0)&&U.length?["Resources",...X.signInWithSolana.resources.map(Ne=>`- ${Ne}`)]:[]].join(`
`);const xe=await ue.signMessage(new TextEncoder().encode(Y),"utf8");if(!xe||!(xe instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");H=xe}}try{const{data:K,error:re}=await Qn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:Y,signature:om(H)},!(($=t.options)===null||$===void 0)&&$.captchaToken?{gotrue_meta_security:{captcha_token:(B=t.options)===null||B===void 0?void 0:B.captchaToken}}:null),xform:zc});if(re)throw re;if(!K||!K.session||!K.user){const G=new g_;return this._returnResult({data:{user:null,session:null},error:G})}return K.session&&(await this._saveSession(K.session),await this._notifyAllSubscribers("SIGNED_IN",K.session)),this._returnResult({data:Object.assign({},K),error:re})}catch(K){if(Tn(K))return this._returnResult({data:{user:null,session:null},error:K});throw K}}async _exchangeCodeForSession(t){const i=await Kp(this.storage,`${this.storageKey}-code-verifier`),[c,f]=(i??"").split("/");try{const{data:_,error:x}=await Qn(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:c},xform:zc});if(await Xh(this.storage,`${this.storageKey}-code-verifier`),x)throw x;if(!_||!_.session||!_.user){const o=new g_;return this._returnResult({data:{user:null,session:null,redirectType:null},error:o})}return _.session&&(await this._saveSession(_.session),await this._notifyAllSubscribers("SIGNED_IN",_.session)),this._returnResult({data:Object.assign(Object.assign({},_),{redirectType:f??null}),error:x})}catch(_){if(Tn(_))return this._returnResult({data:{user:null,session:null,redirectType:null},error:_});throw _}}async signInWithIdToken(t){try{const{options:i,provider:c,token:f,access_token:_,nonce:x}=t,o=await Qn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:c,id_token:f,access_token:_,nonce:x,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:zc}),{data:I,error:P}=o;if(P)return this._returnResult({data:{user:null,session:null},error:P});if(!I||!I.session||!I.user){const N=new g_;return this._returnResult({data:{user:null,session:null},error:N})}return I.session&&(await this._saveSession(I.session),await this._notifyAllSubscribers("SIGNED_IN",I.session)),this._returnResult({data:I,error:P})}catch(i){if(Tn(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithOtp(t){var i,c,f,_,x;try{if("email"in t){const{email:o,options:I}=t;let P=null,N=null;this.flowType==="pkce"&&([P,N]=await __(this.storage,this.storageKey));const{error:U}=await Qn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(i=I==null?void 0:I.data)!==null&&i!==void 0?i:{},create_user:(c=I==null?void 0:I.shouldCreateUser)!==null&&c!==void 0?c:!0,gotrue_meta_security:{captcha_token:I==null?void 0:I.captchaToken},code_challenge:P,code_challenge_method:N},redirectTo:I==null?void 0:I.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:U})}if("phone"in t){const{phone:o,options:I}=t,{data:P,error:N}=await Qn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(f=I==null?void 0:I.data)!==null&&f!==void 0?f:{},create_user:(_=I==null?void 0:I.shouldCreateUser)!==null&&_!==void 0?_:!0,gotrue_meta_security:{captcha_token:I==null?void 0:I.captchaToken},channel:(x=I==null?void 0:I.channel)!==null&&x!==void 0?x:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:P==null?void 0:P.message_id},error:N})}throw new iS("You must provide either an email or phone number.")}catch(o){if(Tn(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async verifyOtp(t){var i,c;try{let f,_;"options"in t&&(f=(i=t.options)===null||i===void 0?void 0:i.redirectTo,_=(c=t.options)===null||c===void 0?void 0:c.captchaToken);const{data:x,error:o}=await Qn(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:_}}),redirectTo:f,xform:zc});if(o)throw o;if(!x)throw new Error("An error occurred on token verification.");const I=x.session,P=x.user;return I!=null&&I.access_token&&(await this._saveSession(I),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",I)),this._returnResult({data:{user:P,session:I},error:null})}catch(f){if(Tn(f))return this._returnResult({data:{user:null,session:null},error:f});throw f}}async signInWithSSO(t){var i,c,f;try{let _=null,x=null;this.flowType==="pkce"&&([_,x]=await __(this.storage,this.storageKey));const o=await Qn(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(c=(i=t.options)===null||i===void 0?void 0:i.redirectTo)!==null&&c!==void 0?c:void 0}),!((f=t==null?void 0:t.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:_,code_challenge_method:x}),headers:this.headers,xform:Mee});return this._returnResult(o)}catch(_){if(Tn(_))return this._returnResult({data:null,error:_});throw _}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:i},error:c}=t;if(c)throw c;if(!i)throw new Lc;const{error:f}=await Qn(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:i.access_token});return this._returnResult({data:{user:null,session:null},error:f})})}catch(t){if(Tn(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const i=`${this.url}/resend`;if("email"in t){const{email:c,type:f,options:_}=t,{error:x}=await Qn(this.fetch,"POST",i,{headers:this.headers,body:{email:c,type:f,gotrue_meta_security:{captcha_token:_==null?void 0:_.captchaToken}},redirectTo:_==null?void 0:_.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:x})}else if("phone"in t){const{phone:c,type:f,options:_}=t,{data:x,error:o}=await Qn(this.fetch,"POST",i,{headers:this.headers,body:{phone:c,type:f,gotrue_meta_security:{captcha_token:_==null?void 0:_.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:x==null?void 0:x.message_id},error:o})}throw new iS("You must provide either an email or phone number and a type")}catch(i){if(Tn(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async i=>i))}async _acquireLock(t,i){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const c=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),f=(async()=>(await c,await i()))();return this.pendingInLock.push((async()=>{try{await f}catch{}})()),f}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const c=i();for(this.pendingInLock.push((async()=>{try{await c}catch{}})()),await c;this.pendingInLock.length;){const f=[...this.pendingInLock];await Promise.all(f),this.pendingInLock.splice(0,f.length)}return await c}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const i=await this.__loadSession();return await t(i)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const i=await Kp(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",i),i!==null&&(this._isValidSession(i)?t=i:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const c=t.expires_at?t.expires_at*1e3-Date.now()<dA:!1;if(this._debug("#__loadSession()",`session has${c?"":" not"} expired`,"expires_at",t.expires_at),!c){if(this.userStorage){const x=await Kp(this.userStorage,this.storageKey+"-user");x!=null&&x.user?t.user=x.user:t.user=pA()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const x={value:this.suppressGetSessionWarning};t.user=Pee(t.user,x),x.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:f,error:_}=await this._callRefreshToken(t.refresh_token);return _?this._returnResult({data:{session:null},error:_}):this._returnResult({data:{session:f},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await Qn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:sf}):await this._useSession(async i=>{var c,f,_;const{data:x,error:o}=i;if(o)throw o;return!(!((c=x.session)===null||c===void 0)&&c.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Lc}:await Qn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(_=(f=x.session)===null||f===void 0?void 0:f.access_token)!==null&&_!==void 0?_:void 0,xform:sf})})}catch(i){if(Tn(i))return aee(i)&&(await this._removeSession(),await Xh(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:i});throw i}}async updateUser(t,i={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,i))}async _updateUser(t,i={}){try{return await this._useSession(async c=>{const{data:f,error:_}=c;if(_)throw _;if(!f.session)throw new Lc;const x=f.session;let o=null,I=null;this.flowType==="pkce"&&t.email!=null&&([o,I]=await __(this.storage,this.storageKey));const{data:P,error:N}=await Qn(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:i==null?void 0:i.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:I}),jwt:x.access_token,xform:sf});if(N)throw N;return x.user=P.user,await this._saveSession(x),await this._notifyAllSubscribers("USER_UPDATED",x),this._returnResult({data:{user:x.user},error:null})})}catch(c){if(Tn(c))return this._returnResult({data:{user:null},error:c});throw c}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Lc;const i=Date.now()/1e3;let c=i,f=!0,_=null;const{payload:x}=fA(t.access_token);if(x.exp&&(c=x.exp,f=c<=i),f){const{data:o,error:I}=await this._callRefreshToken(t.refresh_token);if(I)return this._returnResult({data:{user:null,session:null},error:I});if(!o)return{data:{user:null,session:null},error:null};_=o}else{const{data:o,error:I}=await this._getUser(t.access_token);if(I)throw I;_={access_token:t.access_token,refresh_token:t.refresh_token,user:o.user,token_type:"bearer",expires_in:c-i,expires_at:c},await this._saveSession(_),await this._notifyAllSubscribers("SIGNED_IN",_)}return this._returnResult({data:{user:_.user,session:_},error:null})}catch(i){if(Tn(i))return this._returnResult({data:{session:null,user:null},error:i});throw i}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async i=>{var c;if(!t){const{data:x,error:o}=i;if(o)throw o;t=(c=x.session)!==null&&c!==void 0?c:void 0}if(!(t!=null&&t.refresh_token))throw new Lc;const{data:f,error:_}=await this._callRefreshToken(t.refresh_token);return _?this._returnResult({data:{user:null,session:null},error:_}):f?this._returnResult({data:{user:f.user,session:f},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(i){if(Tn(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async _getSessionFromURL(t,i){try{if(!xa())throw new sS("No browser detected.");if(t.error||t.error_description||t.error_code)throw new sS(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(i){case"implicit":if(this.flowType==="pkce")throw new XL("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new sS("Not a valid implicit grant flow url.");break;default:}if(i==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new XL("No code detected.");const{data:G,error:X}=await this._exchangeCodeForSession(t.code);if(X)throw X;const ue=new URL(window.location.href);return ue.searchParams.delete("code"),window.history.replaceState(window.history.state,"",ue.toString()),{data:{session:G.session,redirectType:null},error:null}}const{provider_token:c,provider_refresh_token:f,access_token:_,refresh_token:x,expires_in:o,expires_at:I,token_type:P}=t;if(!_||!o||!x||!P)throw new sS("No session defined in URL");const N=Math.round(Date.now()/1e3),U=parseInt(o);let $=N+U;I&&($=parseInt(I));const B=$-N;B*1e3<=C_&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${B}s, should have been closer to ${U}s`);const Y=$-U;N-Y>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",Y,$,N):N-Y<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",Y,$,N);const{data:H,error:K}=await this._getUser(_);if(K)throw K;const re={provider_token:c,provider_refresh_token:f,access_token:_,expires_in:U,expires_at:$,refresh_token:x,token_type:P,user:H.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:re,redirectType:t.type},error:null})}catch(c){if(Tn(c))return this._returnResult({data:{session:null,redirectType:null},error:c});throw c}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const i=await Kp(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&i)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async i=>{var c;const{data:f,error:_}=i;if(_)return this._returnResult({error:_});const x=(c=f.session)===null||c===void 0?void 0:c.access_token;if(x){const{error:o}=await this.admin.signOut(x,t);if(o&&!(oee(o)&&(o.status===404||o.status===401||o.status===403)))return this._returnResult({error:o})}return t!=="others"&&(await this._removeSession(),await Xh(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const i=mee(),c={id:i,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",i),this.stateChangeEmitters.delete(i)}};return this._debug("#onAuthStateChange()","registered callback with id",i),this.stateChangeEmitters.set(i,c),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(i)})))(),{data:{subscription:c}}}async _emitInitialSession(t){return await this._useSession(async i=>{var c,f;try{const{data:{session:_},error:x}=i;if(x)throw x;await((c=this.stateChangeEmitters.get(t))===null||c===void 0?void 0:c.callback("INITIAL_SESSION",_)),this._debug("INITIAL_SESSION","callback id",t,"session",_)}catch(_){await((f=this.stateChangeEmitters.get(t))===null||f===void 0?void 0:f.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",_),console.error(_)}})}async resetPasswordForEmail(t,i={}){let c=null,f=null;this.flowType==="pkce"&&([c,f]=await __(this.storage,this.storageKey,!0));try{return await Qn(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:c,code_challenge_method:f,gotrue_meta_security:{captcha_token:i.captchaToken}},headers:this.headers,redirectTo:i.redirectTo})}catch(_){if(Tn(_))return this._returnResult({data:null,error:_});throw _}}async getUserIdentities(){var t;try{const{data:i,error:c}=await this.getUser();if(c)throw c;return this._returnResult({data:{identities:(t=i.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(i){if(Tn(i))return this._returnResult({data:null,error:i});throw i}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var i;try{const{data:c,error:f}=await this._useSession(async _=>{var x,o,I,P,N;const{data:U,error:$}=_;if($)throw $;const B=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(x=t.options)===null||x===void 0?void 0:x.redirectTo,scopes:(o=t.options)===null||o===void 0?void 0:o.scopes,queryParams:(I=t.options)===null||I===void 0?void 0:I.queryParams,skipBrowserRedirect:!0});return await Qn(this.fetch,"GET",B,{headers:this.headers,jwt:(N=(P=U.session)===null||P===void 0?void 0:P.access_token)!==null&&N!==void 0?N:void 0})});if(f)throw f;return xa()&&!(!((i=t.options)===null||i===void 0)&&i.skipBrowserRedirect)&&window.location.assign(c==null?void 0:c.url),this._returnResult({data:{provider:t.provider,url:c==null?void 0:c.url},error:null})}catch(c){if(Tn(c))return this._returnResult({data:{provider:t.provider,url:null},error:c});throw c}}async linkIdentityIdToken(t){return await this._useSession(async i=>{var c;try{const{error:f,data:{session:_}}=i;if(f)throw f;const{options:x,provider:o,token:I,access_token:P,nonce:N}=t,U=await Qn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(c=_==null?void 0:_.access_token)!==null&&c!==void 0?c:void 0,body:{provider:o,id_token:I,access_token:P,nonce:N,link_identity:!0,gotrue_meta_security:{captcha_token:x==null?void 0:x.captchaToken}},xform:zc}),{data:$,error:B}=U;return B?this._returnResult({data:{user:null,session:null},error:B}):!$||!$.session||!$.user?this._returnResult({data:{user:null,session:null},error:new g_}):($.session&&(await this._saveSession($.session),await this._notifyAllSubscribers("USER_UPDATED",$.session)),this._returnResult({data:$,error:B}))}catch(f){if(Tn(f))return this._returnResult({data:{user:null,session:null},error:f});throw f}})}async unlinkIdentity(t){try{return await this._useSession(async i=>{var c,f;const{data:_,error:x}=i;if(x)throw x;return await Qn(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(f=(c=_.session)===null||c===void 0?void 0:c.access_token)!==null&&f!==void 0?f:void 0})})}catch(i){if(Tn(i))return this._returnResult({data:null,error:i});throw i}}async _refreshAccessToken(t){const i=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(i,"begin");try{const c=Date.now();return await vee(async f=>(f>0&&await yee(200*Math.pow(2,f-1)),this._debug(i,"refreshing attempt",f),await Qn(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:zc})),(f,_)=>{const x=200*Math.pow(2,f);return _&&hA(_)&&Date.now()+x-c<C_})}catch(c){if(this._debug(i,"error",c),Tn(c))return this._returnResult({data:{session:null,user:null},error:c});throw c}finally{this._debug(i,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,i){const c=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:i.redirectTo,scopes:i.scopes,queryParams:i.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",i,"url",c),xa()&&!i.skipBrowserRedirect&&window.location.assign(c),{data:{provider:t,url:c},error:null}}async _recoverAndRefresh(){var t,i;const c="#_recoverAndRefresh()";this._debug(c,"begin");try{const f=await Kp(this.storage,this.storageKey);if(f&&this.userStorage){let x=await Kp(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!x&&(x={user:f.user},await A_(this.userStorage,this.storageKey+"-user",x)),f.user=(t=x==null?void 0:x.user)!==null&&t!==void 0?t:pA()}else if(f&&!f.user&&!f.user){const x=await Kp(this.storage,this.storageKey+"-user");x&&(x!=null&&x.user)?(f.user=x.user,await Xh(this.storage,this.storageKey+"-user"),await A_(this.storage,this.storageKey,f)):f.user=pA()}if(this._debug(c,"session from storage",f),!this._isValidSession(f)){this._debug(c,"session is not valid"),f!==null&&await this._removeSession();return}const _=((i=f.expires_at)!==null&&i!==void 0?i:1/0)*1e3-Date.now()<dA;if(this._debug(c,`session has${_?"":" not"} expired with margin of ${dA}s`),_){if(this.autoRefreshToken&&f.refresh_token){const{error:x}=await this._callRefreshToken(f.refresh_token);x&&(console.error(x),hA(x)||(this._debug(c,"refresh failed with a non-retryable error, removing the session",x),await this._removeSession()))}}else if(f.user&&f.user.__isUserNotAvailableProxy===!0)try{const{data:x,error:o}=await this._getUser(f.access_token);!o&&(x!=null&&x.user)?(f.user=x.user,await this._saveSession(f),await this._notifyAllSubscribers("SIGNED_IN",f)):this._debug(c,"could not get user data, skipping SIGNED_IN notification")}catch(x){console.error("Error getting user data:",x),this._debug(c,"error getting user data, skipping SIGNED_IN notification",x)}else await this._notifyAllSubscribers("SIGNED_IN",f)}catch(f){this._debug(c,"error",f),console.error(f);return}finally{this._debug(c,"end")}}async _callRefreshToken(t){var i,c;if(!t)throw new Lc;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const f=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(f,"begin");try{this.refreshingDeferred=new c2;const{data:_,error:x}=await this._refreshAccessToken(t);if(x)throw x;if(!_.session)throw new Lc;await this._saveSession(_.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",_.session);const o={data:_.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(_){if(this._debug(f,"error",_),Tn(_)){const x={data:null,error:_};return hA(_)||await this._removeSession(),(i=this.refreshingDeferred)===null||i===void 0||i.resolve(x),x}throw(c=this.refreshingDeferred)===null||c===void 0||c.reject(_),_}finally{this.refreshingDeferred=null,this._debug(f,"end")}}async _notifyAllSubscribers(t,i,c=!0){const f=`#_notifyAllSubscribers(${t})`;this._debug(f,"begin",i,`broadcast = ${c}`);try{this.broadcastChannel&&c&&this.broadcastChannel.postMessage({event:t,session:i});const _=[],x=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(t,i)}catch(I){_.push(I)}});if(await Promise.all(x),_.length>0){for(let o=0;o<_.length;o+=1)console.error(_[o]);throw _[0]}}finally{this._debug(f,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const i=Object.assign({},t),c=i.user&&i.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!c&&i.user&&await A_(this.userStorage,this.storageKey+"-user",{user:i.user});const f=Object.assign({},i);delete f.user;const _=ez(f);await A_(this.storage,this.storageKey,_)}else{const f=ez(i);await A_(this.storage,this.storageKey,f)}}async _removeSession(){this._debug("#_removeSession()"),await Xh(this.storage,this.storageKey),await Xh(this.storage,this.storageKey+"-code-verifier"),await Xh(this.storage,this.storageKey+"-user"),this.userStorage&&await Xh(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&xa()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(i){console.error("removing visibilitychange callback failed",i)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),C_);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async i=>{const{data:{session:c}}=i;if(!c||!c.refresh_token||!c.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const f=Math.floor((c.expires_at*1e3-t)/C_);this._debug("#_autoRefreshTokenTick()",`access token expires in ${f} ticks, a tick lasts ${C_}ms, refresh threshold is ${uP} ticks`),f<=uP&&await this._callRefreshToken(c.refresh_token)})}catch(i){console.error("Auto refresh tick failed with error. This is likely a transient error.",i)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof kV)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!xa()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const i=`#_onVisibilityChanged(${t})`;this._debug(i,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(i,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,i,c){const f=[`provider=${encodeURIComponent(i)}`];if(c!=null&&c.redirectTo&&f.push(`redirect_to=${encodeURIComponent(c.redirectTo)}`),c!=null&&c.scopes&&f.push(`scopes=${encodeURIComponent(c.scopes)}`),this.flowType==="pkce"){const[_,x]=await __(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(_)}`,code_challenge_method:`${encodeURIComponent(x)}`});f.push(o.toString())}if(c!=null&&c.queryParams){const _=new URLSearchParams(c.queryParams);f.push(_.toString())}return c!=null&&c.skipBrowserRedirect&&f.push(`skip_http_redirect=${c.skipBrowserRedirect}`),`${t}?${f.join("&")}`}async _unenroll(t){try{return await this._useSession(async i=>{var c;const{data:f,error:_}=i;return _?this._returnResult({data:null,error:_}):await Qn(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(c=f==null?void 0:f.session)===null||c===void 0?void 0:c.access_token})})}catch(i){if(Tn(i))return this._returnResult({data:null,error:i});throw i}}async _enroll(t){try{return await this._useSession(async i=>{var c,f;const{data:_,error:x}=i;if(x)return this._returnResult({data:null,error:x});const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:I,error:P}=await Qn(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(c=_==null?void 0:_.session)===null||c===void 0?void 0:c.access_token});return P?this._returnResult({data:null,error:P}):(t.factorType==="totp"&&I.type==="totp"&&(!((f=I==null?void 0:I.totp)===null||f===void 0)&&f.qr_code)&&(I.totp.qr_code=`data:image/svg+xml;utf-8,${I.totp.qr_code}`),this._returnResult({data:I,error:null}))})}catch(i){if(Tn(i))return this._returnResult({data:null,error:i});throw i}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var c;const{data:f,error:_}=i;if(_)return this._returnResult({data:null,error:_});const x=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?Xee(t.webauthn.credential_response):Kee(t.webauthn.credential_response)})}:{code:t.code}),{data:o,error:I}=await Qn(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:x,headers:this.headers,jwt:(c=f==null?void 0:f.session)===null||c===void 0?void 0:c.access_token});return I?this._returnResult({data:null,error:I}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),this._returnResult({data:o,error:I}))})}catch(i){if(Tn(i))return this._returnResult({data:null,error:i});throw i}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var c;const{data:f,error:_}=i;if(_)return this._returnResult({data:null,error:_});const x=await Qn(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(c=f==null?void 0:f.session)===null||c===void 0?void 0:c.access_token});if(x.error)return x;const{data:o}=x;if(o.type!=="webauthn")return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:Hee(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:Zee(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(i){if(Tn(i))return this._returnResult({data:null,error:i});throw i}})}async _challengeAndVerify(t){const{data:i,error:c}=await this._challenge({factorId:t.factorId});return c?this._returnResult({data:null,error:c}):await this._verify({factorId:t.factorId,challengeId:i.id,code:t.code})}async _listFactors(){var t;const{data:{user:i},error:c}=await this.getUser();if(c)return{data:null,error:c};const f={all:[],phone:[],totp:[],webauthn:[]};for(const _ of(t=i==null?void 0:i.factors)!==null&&t!==void 0?t:[])f.all.push(_),_.status==="verified"&&f[_.factor_type].push(_);return{data:f,error:null}}async _getAuthenticatorAssuranceLevel(){var t,i;const{data:{session:c},error:f}=await this.getSession();if(f)return this._returnResult({data:null,error:f});if(!c)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:_}=fA(c.access_token);let x=null;_.aal&&(x=_.aal);let o=x;((i=(t=c.user.factors)===null||t===void 0?void 0:t.filter(N=>N.status==="verified"))!==null&&i!==void 0?i:[]).length>0&&(o="aal2");const P=_.amr||[];return{data:{currentLevel:x,nextLevel:o,currentAuthenticationMethods:P},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async i=>{const{data:{session:c},error:f}=i;return f?this._returnResult({data:null,error:f}):c?await Qn(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:c.access_token,xform:_=>({data:_,error:null})}):this._returnResult({data:null,error:new Lc})})}catch(i){if(Tn(i))return this._returnResult({data:null,error:i});throw i}}async _approveAuthorization(t,i){try{return await this._useSession(async c=>{const{data:{session:f},error:_}=c;if(_)return this._returnResult({data:null,error:_});if(!f)return this._returnResult({data:null,error:new Lc});const x=await Qn(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:f.access_token,body:{action:"approve"},xform:o=>({data:o,error:null})});return x.data&&x.data.redirect_url&&xa()&&!(i!=null&&i.skipBrowserRedirect)&&window.location.assign(x.data.redirect_url),x})}catch(c){if(Tn(c))return this._returnResult({data:null,error:c});throw c}}async _denyAuthorization(t,i){try{return await this._useSession(async c=>{const{data:{session:f},error:_}=c;if(_)return this._returnResult({data:null,error:_});if(!f)return this._returnResult({data:null,error:new Lc});const x=await Qn(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:f.access_token,body:{action:"deny"},xform:o=>({data:o,error:null})});return x.data&&x.data.redirect_url&&xa()&&!(i!=null&&i.skipBrowserRedirect)&&window.location.assign(x.data.redirect_url),x})}catch(c){if(Tn(c))return this._returnResult({data:null,error:c});throw c}}async fetchJwk(t,i={keys:[]}){let c=i.keys.find(o=>o.kid===t);if(c)return c;const f=Date.now();if(c=this.jwks.keys.find(o=>o.kid===t),c&&this.jwks_cached_at+iee>f)return c;const{data:_,error:x}=await Qn(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(x)throw x;return!_.keys||_.keys.length===0||(this.jwks=_,this.jwks_cached_at=f,c=_.keys.find(o=>o.kid===t),!c)?null:c}async getClaims(t,i={}){try{let c=t;if(!c){const{data:B,error:Y}=await this.getSession();if(Y||!B.session)return this._returnResult({data:null,error:Y});c=B.session.access_token}const{header:f,payload:_,signature:x,raw:{header:o,payload:I}}=fA(c);i!=null&&i.allowExpired||Cee(_.exp);const P=!f.alg||f.alg.startsWith("HS")||!f.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(f.kid,i!=null&&i.keys?{keys:i.keys}:i==null?void 0:i.jwks);if(!P){const{error:B}=await this.getUser(c);if(B)throw B;return{data:{claims:_,header:f,signature:x},error:null}}const N=Aee(f.alg),U=await crypto.subtle.importKey("jwk",P,N,!0,["verify"]);if(!await crypto.subtle.verify(N,U,x,fee(`${o}.${I}`)))throw new fP("Invalid JWT signature");return{data:{claims:_,header:f,signature:x},error:null}}catch(c){if(Tn(c))return this._returnResult({data:null,error:c});throw c}}}tb.nextInstanceID={};const ste=tb;class ote extends ste{constructor(t){super(t)}}class ate{constructor(t,i,c){var f,_,x;this.supabaseUrl=t,this.supabaseKey=i;const o=QQ(t);if(!i)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);const I=`sb-${o.hostname.split(".")[0]}-auth-token`,P={db:GQ,realtime:HQ,auth:Object.assign(Object.assign({},WQ),{storageKey:I}),global:qQ},N=JQ(c??{},P);this.storageKey=(f=N.auth.storageKey)!==null&&f!==void 0?f:"",this.headers=(_=N.global.headers)!==null&&_!==void 0?_:{},N.accessToken?(this.accessToken=N.accessToken,this.auth=new Proxy({},{get:(U,$)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String($)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((x=N.auth)!==null&&x!==void 0?x:{},this.headers,N.global.fetch),this.fetch=KQ(i,this._getAccessToken.bind(this),N.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},N.realtime)),this.rest=new eQ(new URL("rest/v1",o).href,{headers:this.headers,schema:N.db.schema,fetch:this.fetch}),this.storage=new VQ(this.storageUrl.href,this.headers,this.fetch,c==null?void 0:c.storage),N.accessToken||this._listenForAuthEvents()}get functions(){return new YJ(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,i={},c={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,i,c)}channel(t,i={config:{}}){return this.realtime.channel(t,i)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t,i;if(this.accessToken)return await this.accessToken();const{data:c}=await this.auth.getSession();return(i=(t=c.session)===null||t===void 0?void 0:t.access_token)!==null&&i!==void 0?i:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:i,detectSessionInUrl:c,storage:f,userStorage:_,storageKey:x,flowType:o,lock:I,debug:P,throwOnError:N},U,$){const B={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new ote({url:this.authUrl.href,headers:Object.assign(Object.assign({},B),U),storageKey:x,autoRefreshToken:t,persistSession:i,detectSessionInUrl:c,storage:f,userStorage:_,flowType:o,lock:I,debug:P,throwOnError:N,fetch:$,hasCustomAuthorizationHeader:Object.keys(this.headers).some(Y=>Y.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new _Q(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((i,c)=>{this._handleTokenChanged(i,"CLIENT",c==null?void 0:c.access_token)})}_handleTokenChanged(t,i,c){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==c?(this.changedAccessToken=c,this.realtime.setAuth(c)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),i=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const lte=(e,t,i)=>new ate(e,t,i);function cte(){if(typeof window<"u"||typeof process>"u")return!1;const e=process.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}cte()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const ute="https://jcsmwkkytigomvibwsnb.supabase.co",dte="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impjc213a2t5dGlnb212aWJ3c25iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI0MzU3NDUsImV4cCI6MjA3ODAxMTc0NX0.jkbRoq_Gd_WdqCQOx_KnbPuyDEuchdmbCgwj-ZRxdT0",Qe=lte(ute,dte,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}}),na=({children:e})=>{const[t,i]=V.useState(null),[c,f]=V.useState(!0);return V.useEffect(()=>{const{data:{subscription:_}}=Qe.auth.onAuthStateChange((x,o)=>{i(o),f(!1)});return Qe.auth.getSession().then(({data:{session:x}})=>{i(x),f(!1)}),()=>_.unsubscribe()},[]),c?h.jsx("div",{className:"flex items-center justify-center h-screen",children:h.jsx(Xu,{className:"h-8 w-8 animate-spin text-primary"})}):t?h.jsx(h.Fragment,{children:e}):h.jsx(IJ,{to:"/auth",replace:!0})},rb=Dy("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),tr=V.forwardRef(({className:e,variant:t,size:i,asChild:c=!1,...f},_)=>{const x=c?Fm:"button";return h.jsx(x,{className:yr(rb({variant:t,size:i,className:e})),ref:_,...f})});tr.displayName="Button";const hte=()=>{const e=cu(),[t,i]=V.useState(!0);if(V.useEffect(()=>{Qe.auth.getSession().then(({data:{session:_}})=>{_?e("/dashboard"):i(!1)});const{data:{subscription:f}}=Qe.auth.onAuthStateChange((_,x)=>{x&&e("/dashboard")});return()=>f.unsubscribe()},[e]),t)return null;const c=[{icon:ES,title:"Monitoramento 24/7",description:"Centro de controle operacional em tempo real"},{icon:Df,title:"Gesto de Contratos",description:"Hierarquia Cliente  Contrato  Unidade  Posto"},{icon:Ld,title:"Gesto de Colaboradores",description:"Controle de escalas, presena e performance"},{icon:Gd,title:"Ordens de Servio",description:"Preventivas, corretivas e emergenciais"},{icon:yb,title:"Checklists Inteligentes",description:"Inspees programadas e auditoria completa"},{icon:kI,title:"Dashboard Executivo",description:"KPIs, SLA e NPS em tempo real"}];return h.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 via-background to-accent/5",children:[h.jsxs("div",{className:"container mx-auto px-4 py-16",children:[h.jsxs("div",{className:"text-center max-w-4xl mx-auto mb-16",children:[h.jsx("div",{className:"inline-flex p-4 bg-gradient-to-br from-primary to-accent rounded-2xl mb-6 shadow-lg",children:h.jsx(Df,{className:"h-16 w-16 text-primary-foreground"})}),h.jsx("h1",{className:"text-5xl md:text-6xl font-bold mb-6 bg-gradient-to-r from-primary via-accent to-primary bg-clip-text text-transparent",children:"Facilities Center"}),h.jsx("p",{className:"text-xl text-muted-foreground mb-4",children:"Plataforma de gesto de operaes de servio que atua como ncleo de inteligncia operacional 24/7"}),h.jsx("p",{className:"text-lg text-muted-foreground mb-8",children:"Monitoramento contnuo e preditivo com preciso e inteligncia para garantir estabilidade operacional"}),h.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[h.jsx(tr,{size:"lg",onClick:()=>e("/auth"),className:"text-lg px-8 shadow-lg hover:shadow-xl transition-shadow",children:"Acessar Plataforma"}),h.jsx(tr,{size:"lg",variant:"outline",onClick:()=>e("/auth"),className:"text-lg px-8",children:"Criar Conta"})]})]}),h.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-16",children:c.map((f,_)=>h.jsxs("div",{className:"bg-card p-6 rounded-xl shadow-md hover:shadow-lg transition-all duration-300 hover:-translate-y-1 border",children:[h.jsx("div",{className:"inline-flex p-3 bg-primary/10 rounded-lg mb-4",children:h.jsx(f.icon,{className:"h-6 w-6 text-primary"})}),h.jsx("h3",{className:"text-lg font-semibold mb-2",children:f.title}),h.jsx("p",{className:"text-sm text-muted-foreground",children:f.description})]},_))}),h.jsxs("div",{className:"bg-card rounded-2xl p-8 shadow-lg border max-w-4xl mx-auto",children:[h.jsx("h2",{className:"text-3xl font-bold mb-6 text-center",children:"Controle de Acesso por Perfil (RBAC)"}),h.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[{role:"Administrador",description:"Acesso total ao sistema"},{role:"Gestor de Operaes",description:"Tudo exceto gesto de usurios"},{role:"Supervisor",description:"CRUD de OS, incidentes, checklists e presena"},{role:"Analista Centro Controle",description:"Leitura total + abertura de OS e incidentes"},{role:"Tcnico",description:"Visualizar OS atribudas e executar checklists"},{role:"Cliente View",description:"Somente leitura e comentrios"}].map((f,_)=>h.jsxs("div",{className:"flex items-start gap-3 p-4 bg-muted/50 rounded-lg",children:[h.jsx(Nk,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}),h.jsxs("div",{children:[h.jsx("p",{className:"font-semibold",children:f.role}),h.jsx("p",{className:"text-sm text-muted-foreground",children:f.description})]})]},_))})]})]}),h.jsx("footer",{className:"border-t bg-card/50 py-8",children:h.jsx("div",{className:"container mx-auto px-4 text-center text-muted-foreground",children:h.jsx("p",{children:" 2025 Facilities Center - Delta Facilities. Todos os direitos reservados."})})})]})};var ts;(function(e){e.assertEqual=f=>{};function t(f){}e.assertIs=t;function i(f){throw new Error}e.assertNever=i,e.arrayToEnum=f=>{const _={};for(const x of f)_[x]=x;return _},e.getValidEnumValues=f=>{const _=e.objectKeys(f).filter(o=>typeof f[f[o]]!="number"),x={};for(const o of _)x[o]=f[o];return e.objectValues(x)},e.objectValues=f=>e.objectKeys(f).map(function(_){return f[_]}),e.objectKeys=typeof Object.keys=="function"?f=>Object.keys(f):f=>{const _=[];for(const x in f)Object.prototype.hasOwnProperty.call(f,x)&&_.push(x);return _},e.find=(f,_)=>{for(const x of f)if(_(x))return x},e.isInteger=typeof Number.isInteger=="function"?f=>Number.isInteger(f):f=>typeof f=="number"&&Number.isFinite(f)&&Math.floor(f)===f;function c(f,_=" | "){return f.map(x=>typeof x=="string"?`'${x}'`:x).join(_)}e.joinValues=c,e.jsonStringifyReplacer=(f,_)=>typeof _=="bigint"?_.toString():_})(ts||(ts={}));var az;(function(e){e.mergeShapes=(t,i)=>({...t,...i})})(az||(az={}));const mn=ts.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),tf=e=>{switch(typeof e){case"undefined":return mn.undefined;case"string":return mn.string;case"number":return Number.isNaN(e)?mn.nan:mn.number;case"boolean":return mn.boolean;case"function":return mn.function;case"bigint":return mn.bigint;case"symbol":return mn.symbol;case"object":return Array.isArray(e)?mn.array:e===null?mn.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?mn.promise:typeof Map<"u"&&e instanceof Map?mn.map:typeof Set<"u"&&e instanceof Set?mn.set:typeof Date<"u"&&e instanceof Date?mn.date:mn.object;default:return mn.unknown}},Cr=ts.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class pc extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=c=>{this.issues=[...this.issues,c]},this.addIssues=(c=[])=>{this.issues=[...this.issues,...c]};const i=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,i):this.__proto__=i,this.name="ZodError",this.issues=t}format(t){const i=t||function(_){return _.message},c={_errors:[]},f=_=>{for(const x of _.issues)if(x.code==="invalid_union")x.unionErrors.map(f);else if(x.code==="invalid_return_type")f(x.returnTypeError);else if(x.code==="invalid_arguments")f(x.argumentsError);else if(x.path.length===0)c._errors.push(i(x));else{let o=c,I=0;for(;I<x.path.length;){const P=x.path[I];I===x.path.length-1?(o[P]=o[P]||{_errors:[]},o[P]._errors.push(i(x))):o[P]=o[P]||{_errors:[]},o=o[P],I++}}};return f(this),c}static assert(t){if(!(t instanceof pc))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ts.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=i=>i.message){const i={},c=[];for(const f of this.issues)if(f.path.length>0){const _=f.path[0];i[_]=i[_]||[],i[_].push(t(f))}else c.push(t(f));return{formErrors:c,fieldErrors:i}}get formErrors(){return this.flatten()}}pc.create=e=>new pc(e);const pP=(e,t)=>{let i;switch(e.code){case Cr.invalid_type:e.received===mn.undefined?i="Required":i=`Expected ${e.expected}, received ${e.received}`;break;case Cr.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(e.expected,ts.jsonStringifyReplacer)}`;break;case Cr.unrecognized_keys:i=`Unrecognized key(s) in object: ${ts.joinValues(e.keys,", ")}`;break;case Cr.invalid_union:i="Invalid input";break;case Cr.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${ts.joinValues(e.options)}`;break;case Cr.invalid_enum_value:i=`Invalid enum value. Expected ${ts.joinValues(e.options)}, received '${e.received}'`;break;case Cr.invalid_arguments:i="Invalid function arguments";break;case Cr.invalid_return_type:i="Invalid function return type";break;case Cr.invalid_date:i="Invalid date";break;case Cr.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(i=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(i=`${i} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?i=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?i=`Invalid input: must end with "${e.validation.endsWith}"`:ts.assertNever(e.validation):e.validation!=="regex"?i=`Invalid ${e.validation}`:i="Invalid";break;case Cr.too_small:e.type==="array"?i=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?i=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?i=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?i=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?i=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:i="Invalid input";break;case Cr.too_big:e.type==="array"?i=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?i=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?i=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?i=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?i=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:i="Invalid input";break;case Cr.custom:i="Invalid input";break;case Cr.invalid_intersection_types:i="Intersection results could not be merged";break;case Cr.not_multiple_of:i=`Number must be a multiple of ${e.multipleOf}`;break;case Cr.not_finite:i="Number must be finite";break;default:i=t.defaultError,ts.assertNever(e)}return{message:i}};let fte=pP;function pte(){return fte}const mte=e=>{const{data:t,path:i,errorMaps:c,issueData:f}=e,_=[...i,...f.path||[]],x={...f,path:_};if(f.message!==void 0)return{...f,path:_,message:f.message};let o="";const I=c.filter(P=>!!P).slice().reverse();for(const P of I)o=P(x,{data:t,defaultError:o}).message;return{...f,path:_,message:o}};function Jr(e,t){const i=pte(),c=mte({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,i,i===pP?void 0:pP].filter(f=>!!f)});e.common.issues.push(c)}class ql{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,i){const c=[];for(const f of i){if(f.status==="aborted")return di;f.status==="dirty"&&t.dirty(),c.push(f.value)}return{status:t.value,value:c}}static async mergeObjectAsync(t,i){const c=[];for(const f of i){const _=await f.key,x=await f.value;c.push({key:_,value:x})}return ql.mergeObjectSync(t,c)}static mergeObjectSync(t,i){const c={};for(const f of i){const{key:_,value:x}=f;if(_.status==="aborted"||x.status==="aborted")return di;_.status==="dirty"&&t.dirty(),x.status==="dirty"&&t.dirty(),_.value!=="__proto__"&&(typeof x.value<"u"||f.alwaysSet)&&(c[_.value]=x.value)}return{status:t.value,value:c}}}const di=Object.freeze({status:"aborted"}),d0=e=>({status:"dirty",value:e}),gc=e=>({status:"valid",value:e}),lz=e=>e.status==="aborted",cz=e=>e.status==="dirty",Ty=e=>e.status==="valid",yT=e=>typeof Promise<"u"&&e instanceof Promise;var gn;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(gn||(gn={}));class zf{constructor(t,i,c,f){this._cachedPath=[],this.parent=t,this.data=i,this._path=c,this._key=f}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const uz=(e,t)=>{if(Ty(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const i=new pc(e.common.issues);return this._error=i,this._error}}};function Ri(e){if(!e)return{};const{errorMap:t,invalid_type_error:i,required_error:c,description:f}=e;if(t&&(i||c))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:f}:{errorMap:(x,o)=>{const{message:I}=e;return x.code==="invalid_enum_value"?{message:I??o.defaultError}:typeof o.data>"u"?{message:I??c??o.defaultError}:x.code!=="invalid_type"?{message:o.defaultError}:{message:I??i??o.defaultError}},description:f}}class Qi{get description(){return this._def.description}_getType(t){return tf(t.data)}_getOrReturnCtx(t,i){return i||{common:t.parent.common,data:t.data,parsedType:tf(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new ql,ctx:{common:t.parent.common,data:t.data,parsedType:tf(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const i=this._parse(t);if(yT(i))throw new Error("Synchronous parse encountered promise.");return i}_parseAsync(t){const i=this._parse(t);return Promise.resolve(i)}parse(t,i){const c=this.safeParse(t,i);if(c.success)return c.data;throw c.error}safeParse(t,i){const c={common:{issues:[],async:(i==null?void 0:i.async)??!1,contextualErrorMap:i==null?void 0:i.errorMap},path:(i==null?void 0:i.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:tf(t)},f=this._parseSync({data:t,path:c.path,parent:c});return uz(c,f)}"~validate"(t){var c,f;const i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:tf(t)};if(!this["~standard"].async)try{const _=this._parseSync({data:t,path:[],parent:i});return Ty(_)?{value:_.value}:{issues:i.common.issues}}catch(_){(f=(c=_==null?void 0:_.message)==null?void 0:c.toLowerCase())!=null&&f.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:i}).then(_=>Ty(_)?{value:_.value}:{issues:i.common.issues})}async parseAsync(t,i){const c=await this.safeParseAsync(t,i);if(c.success)return c.data;throw c.error}async safeParseAsync(t,i){const c={common:{issues:[],contextualErrorMap:i==null?void 0:i.errorMap,async:!0},path:(i==null?void 0:i.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:tf(t)},f=this._parse({data:t,path:c.path,parent:c}),_=await(yT(f)?f:Promise.resolve(f));return uz(c,_)}refine(t,i){const c=f=>typeof i=="string"||typeof i>"u"?{message:i}:typeof i=="function"?i(f):i;return this._refinement((f,_)=>{const x=t(f),o=()=>_.addIssue({code:Cr.custom,...c(f)});return typeof Promise<"u"&&x instanceof Promise?x.then(I=>I?!0:(o(),!1)):x?!0:(o(),!1)})}refinement(t,i){return this._refinement((c,f)=>t(c)?!0:(f.addIssue(typeof i=="function"?i(c,f):i),!1))}_refinement(t){return new Ay({schema:this,typeName:hi.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:i=>this["~validate"](i)}}optional(){return jf.create(this,this._def)}nullable(){return Iy.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Gu.create(this)}promise(){return wT.create(this,this._def)}or(t){return xT.create([this,t],this._def)}and(t){return bT.create(this,t,this._def)}transform(t){return new Ay({...Ri(this._def),schema:this,typeName:hi.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const i=typeof t=="function"?t:()=>t;return new gP({...Ri(this._def),innerType:this,defaultValue:i,typeName:hi.ZodDefault})}brand(){return new zte({typeName:hi.ZodBranded,type:this,...Ri(this._def)})}catch(t){const i=typeof t=="function"?t:()=>t;return new _P({...Ri(this._def),innerType:this,catchValue:i,typeName:hi.ZodCatch})}describe(t){const i=this.constructor;return new i({...this._def,description:t})}pipe(t){return uj.create(this,t)}readonly(){return yP.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const gte=/^c[^\s-]{8,}$/i,_te=/^[0-9a-z]+$/,yte=/^[0-9A-HJKMNP-TV-Z]{26}$/i,vte=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,xte=/^[a-z0-9_-]{21}$/i,bte=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,wte=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Ste=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Tte="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let gA;const Ete=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Cte=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Ate=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Ite=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Pte=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,kte=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,MV="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",jte=new RegExp(`^${MV}$`);function DV(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const i=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${i}`}function Rte(e){return new RegExp(`^${DV(e)}$`)}function Mte(e){let t=`${MV}T${DV(e)}`;const i=[];return i.push(e.local?"Z?":"Z"),e.offset&&i.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${i.join("|")})`,new RegExp(`^${t}$`)}function Dte(e,t){return!!((t==="v4"||!t)&&Ete.test(e)||(t==="v6"||!t)&&Ate.test(e))}function Nte(e,t){if(!bte.test(e))return!1;try{const[i]=e.split(".");if(!i)return!1;const c=i.replace(/-/g,"+").replace(/_/g,"/").padEnd(i.length+(4-i.length%4)%4,"="),f=JSON.parse(atob(c));return!(typeof f!="object"||f===null||"typ"in f&&(f==null?void 0:f.typ)!=="JWT"||!f.alg||t&&f.alg!==t)}catch{return!1}}function Ote(e,t){return!!((t==="v4"||!t)&&Cte.test(e)||(t==="v6"||!t)&&Ite.test(e))}class Nd extends Qi{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==mn.string){const _=this._getOrReturnCtx(t);return Jr(_,{code:Cr.invalid_type,expected:mn.string,received:_.parsedType}),di}const c=new ql;let f;for(const _ of this._def.checks)if(_.kind==="min")t.data.length<_.value&&(f=this._getOrReturnCtx(t,f),Jr(f,{code:Cr.too_small,minimum:_.value,type:"string",inclusive:!0,exact:!1,message:_.message}),c.dirty());else if(_.kind==="max")t.data.length>_.value&&(f=this._getOrReturnCtx(t,f),Jr(f,{code:Cr.too_big,maximum:_.value,type:"string",inclusive:!0,exact:!1,message:_.message}),c.dirty());else if(_.kind==="length"){const x=t.data.length>_.value,o=t.data.length<_.value;(x||o)&&(f=this._getOrReturnCtx(t,f),x?Jr(f,{code:Cr.too_big,maximum:_.value,type:"string",inclusive:!0,exact:!0,message:_.message}):o&&Jr(f,{code:Cr.too_small,minimum:_.value,type:"string",inclusive:!0,exact:!0,message:_.message}),c.dirty())}else if(_.kind==="email")Ste.test(t.data)||(f=this._getOrReturnCtx(t,f),Jr(f,{validation:"email",code:Cr.invalid_string,message:_.message}),c.dirty());else if(_.kind==="emoji")gA||(gA=new RegExp(Tte,"u")),gA.test(t.data)||(f=this._getOrReturnCtx(t,f),Jr(f,{validation:"emoji",code:Cr.invalid_string,message:_.message}),c.dirty());else if(_.kind==="uuid")vte.test(t.data)||(f=this._getOrReturnCtx(t,f),Jr(f,{validation:"uuid",code:Cr.invalid_string,message:_.message}),c.dirty());else if(_.kind==="nanoid")xte.test(t.data)||(f=this._getOrReturnCtx(t,f),Jr(f,{validation:"nanoid",code:Cr.invalid_string,message:_.message}),c.dirty());else if(_.kind==="cuid")gte.test(t.data)||(f=this._getOrReturnCtx(t,f),Jr(f,{validation:"cuid",code:Cr.invalid_string,message:_.message}),c.dirty());else if(_.kind==="cuid2")_te.test(t.data)||(f=this._getOrReturnCtx(t,f),Jr(f,{validation:"cuid2",code:Cr.invalid_string,message:_.message}),c.dirty());else if(_.kind==="ulid")yte.test(t.data)||(f=this._getOrReturnCtx(t,f),Jr(f,{validation:"ulid",code:Cr.invalid_string,message:_.message}),c.dirty());else if(_.kind==="url")try{new URL(t.data)}catch{f=this._getOrReturnCtx(t,f),Jr(f,{validation:"url",code:Cr.invalid_string,message:_.message}),c.dirty()}else _.kind==="regex"?(_.regex.lastIndex=0,_.regex.test(t.data)||(f=this._getOrReturnCtx(t,f),Jr(f,{validation:"regex",code:Cr.invalid_string,message:_.message}),c.dirty())):_.kind==="trim"?t.data=t.data.trim():_.kind==="includes"?t.data.includes(_.value,_.position)||(f=this._getOrReturnCtx(t,f),Jr(f,{code:Cr.invalid_string,validation:{includes:_.value,position:_.position},message:_.message}),c.dirty()):_.kind==="toLowerCase"?t.data=t.data.toLowerCase():_.kind==="toUpperCase"?t.data=t.data.toUpperCase():_.kind==="startsWith"?t.data.startsWith(_.value)||(f=this._getOrReturnCtx(t,f),Jr(f,{code:Cr.invalid_string,validation:{startsWith:_.value},message:_.message}),c.dirty()):_.kind==="endsWith"?t.data.endsWith(_.value)||(f=this._getOrReturnCtx(t,f),Jr(f,{code:Cr.invalid_string,validation:{endsWith:_.value},message:_.message}),c.dirty()):_.kind==="datetime"?Mte(_).test(t.data)||(f=this._getOrReturnCtx(t,f),Jr(f,{code:Cr.invalid_string,validation:"datetime",message:_.message}),c.dirty()):_.kind==="date"?jte.test(t.data)||(f=this._getOrReturnCtx(t,f),Jr(f,{code:Cr.invalid_string,validation:"date",message:_.message}),c.dirty()):_.kind==="time"?Rte(_).test(t.data)||(f=this._getOrReturnCtx(t,f),Jr(f,{code:Cr.invalid_string,validation:"time",message:_.message}),c.dirty()):_.kind==="duration"?wte.test(t.data)||(f=this._getOrReturnCtx(t,f),Jr(f,{validation:"duration",code:Cr.invalid_string,message:_.message}),c.dirty()):_.kind==="ip"?Dte(t.data,_.version)||(f=this._getOrReturnCtx(t,f),Jr(f,{validation:"ip",code:Cr.invalid_string,message:_.message}),c.dirty()):_.kind==="jwt"?Nte(t.data,_.alg)||(f=this._getOrReturnCtx(t,f),Jr(f,{validation:"jwt",code:Cr.invalid_string,message:_.message}),c.dirty()):_.kind==="cidr"?Ote(t.data,_.version)||(f=this._getOrReturnCtx(t,f),Jr(f,{validation:"cidr",code:Cr.invalid_string,message:_.message}),c.dirty()):_.kind==="base64"?Pte.test(t.data)||(f=this._getOrReturnCtx(t,f),Jr(f,{validation:"base64",code:Cr.invalid_string,message:_.message}),c.dirty()):_.kind==="base64url"?kte.test(t.data)||(f=this._getOrReturnCtx(t,f),Jr(f,{validation:"base64url",code:Cr.invalid_string,message:_.message}),c.dirty()):ts.assertNever(_);return{status:c.value,value:t.data}}_regex(t,i,c){return this.refinement(f=>t.test(f),{validation:i,code:Cr.invalid_string,...gn.errToObj(c)})}_addCheck(t){return new Nd({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...gn.errToObj(t)})}url(t){return this._addCheck({kind:"url",...gn.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...gn.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...gn.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...gn.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...gn.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...gn.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...gn.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...gn.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...gn.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...gn.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...gn.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...gn.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...gn.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...gn.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...gn.errToObj(t)})}regex(t,i){return this._addCheck({kind:"regex",regex:t,...gn.errToObj(i)})}includes(t,i){return this._addCheck({kind:"includes",value:t,position:i==null?void 0:i.position,...gn.errToObj(i==null?void 0:i.message)})}startsWith(t,i){return this._addCheck({kind:"startsWith",value:t,...gn.errToObj(i)})}endsWith(t,i){return this._addCheck({kind:"endsWith",value:t,...gn.errToObj(i)})}min(t,i){return this._addCheck({kind:"min",value:t,...gn.errToObj(i)})}max(t,i){return this._addCheck({kind:"max",value:t,...gn.errToObj(i)})}length(t,i){return this._addCheck({kind:"length",value:t,...gn.errToObj(i)})}nonempty(t){return this.min(1,gn.errToObj(t))}trim(){return new Nd({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Nd({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Nd({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const i of this._def.checks)i.kind==="min"&&(t===null||i.value>t)&&(t=i.value);return t}get maxLength(){let t=null;for(const i of this._def.checks)i.kind==="max"&&(t===null||i.value<t)&&(t=i.value);return t}}Nd.create=e=>new Nd({checks:[],typeName:hi.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...Ri(e)});function Lte(e,t){const i=(e.toString().split(".")[1]||"").length,c=(t.toString().split(".")[1]||"").length,f=i>c?i:c,_=Number.parseInt(e.toFixed(f).replace(".","")),x=Number.parseInt(t.toFixed(f).replace(".",""));return _%x/10**f}class Pm extends Qi{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==mn.number){const _=this._getOrReturnCtx(t);return Jr(_,{code:Cr.invalid_type,expected:mn.number,received:_.parsedType}),di}let c;const f=new ql;for(const _ of this._def.checks)_.kind==="int"?ts.isInteger(t.data)||(c=this._getOrReturnCtx(t,c),Jr(c,{code:Cr.invalid_type,expected:"integer",received:"float",message:_.message}),f.dirty()):_.kind==="min"?(_.inclusive?t.data<_.value:t.data<=_.value)&&(c=this._getOrReturnCtx(t,c),Jr(c,{code:Cr.too_small,minimum:_.value,type:"number",inclusive:_.inclusive,exact:!1,message:_.message}),f.dirty()):_.kind==="max"?(_.inclusive?t.data>_.value:t.data>=_.value)&&(c=this._getOrReturnCtx(t,c),Jr(c,{code:Cr.too_big,maximum:_.value,type:"number",inclusive:_.inclusive,exact:!1,message:_.message}),f.dirty()):_.kind==="multipleOf"?Lte(t.data,_.value)!==0&&(c=this._getOrReturnCtx(t,c),Jr(c,{code:Cr.not_multiple_of,multipleOf:_.value,message:_.message}),f.dirty()):_.kind==="finite"?Number.isFinite(t.data)||(c=this._getOrReturnCtx(t,c),Jr(c,{code:Cr.not_finite,message:_.message}),f.dirty()):ts.assertNever(_);return{status:f.value,value:t.data}}gte(t,i){return this.setLimit("min",t,!0,gn.toString(i))}gt(t,i){return this.setLimit("min",t,!1,gn.toString(i))}lte(t,i){return this.setLimit("max",t,!0,gn.toString(i))}lt(t,i){return this.setLimit("max",t,!1,gn.toString(i))}setLimit(t,i,c,f){return new Pm({...this._def,checks:[...this._def.checks,{kind:t,value:i,inclusive:c,message:gn.toString(f)}]})}_addCheck(t){return new Pm({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:gn.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:gn.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:gn.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:gn.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:gn.toString(t)})}multipleOf(t,i){return this._addCheck({kind:"multipleOf",value:t,message:gn.toString(i)})}finite(t){return this._addCheck({kind:"finite",message:gn.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:gn.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:gn.toString(t)})}get minValue(){let t=null;for(const i of this._def.checks)i.kind==="min"&&(t===null||i.value>t)&&(t=i.value);return t}get maxValue(){let t=null;for(const i of this._def.checks)i.kind==="max"&&(t===null||i.value<t)&&(t=i.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&ts.isInteger(t.value))}get isFinite(){let t=null,i=null;for(const c of this._def.checks){if(c.kind==="finite"||c.kind==="int"||c.kind==="multipleOf")return!0;c.kind==="min"?(i===null||c.value>i)&&(i=c.value):c.kind==="max"&&(t===null||c.value<t)&&(t=c.value)}return Number.isFinite(i)&&Number.isFinite(t)}}Pm.create=e=>new Pm({checks:[],typeName:hi.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...Ri(e)});class km extends Qi{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==mn.bigint)return this._getInvalidInput(t);let c;const f=new ql;for(const _ of this._def.checks)_.kind==="min"?(_.inclusive?t.data<_.value:t.data<=_.value)&&(c=this._getOrReturnCtx(t,c),Jr(c,{code:Cr.too_small,type:"bigint",minimum:_.value,inclusive:_.inclusive,message:_.message}),f.dirty()):_.kind==="max"?(_.inclusive?t.data>_.value:t.data>=_.value)&&(c=this._getOrReturnCtx(t,c),Jr(c,{code:Cr.too_big,type:"bigint",maximum:_.value,inclusive:_.inclusive,message:_.message}),f.dirty()):_.kind==="multipleOf"?t.data%_.value!==BigInt(0)&&(c=this._getOrReturnCtx(t,c),Jr(c,{code:Cr.not_multiple_of,multipleOf:_.value,message:_.message}),f.dirty()):ts.assertNever(_);return{status:f.value,value:t.data}}_getInvalidInput(t){const i=this._getOrReturnCtx(t);return Jr(i,{code:Cr.invalid_type,expected:mn.bigint,received:i.parsedType}),di}gte(t,i){return this.setLimit("min",t,!0,gn.toString(i))}gt(t,i){return this.setLimit("min",t,!1,gn.toString(i))}lte(t,i){return this.setLimit("max",t,!0,gn.toString(i))}lt(t,i){return this.setLimit("max",t,!1,gn.toString(i))}setLimit(t,i,c,f){return new km({...this._def,checks:[...this._def.checks,{kind:t,value:i,inclusive:c,message:gn.toString(f)}]})}_addCheck(t){return new km({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:gn.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:gn.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:gn.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:gn.toString(t)})}multipleOf(t,i){return this._addCheck({kind:"multipleOf",value:t,message:gn.toString(i)})}get minValue(){let t=null;for(const i of this._def.checks)i.kind==="min"&&(t===null||i.value>t)&&(t=i.value);return t}get maxValue(){let t=null;for(const i of this._def.checks)i.kind==="max"&&(t===null||i.value<t)&&(t=i.value);return t}}km.create=e=>new km({checks:[],typeName:hi.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...Ri(e)});class vT extends Qi{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==mn.boolean){const c=this._getOrReturnCtx(t);return Jr(c,{code:Cr.invalid_type,expected:mn.boolean,received:c.parsedType}),di}return gc(t.data)}}vT.create=e=>new vT({typeName:hi.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...Ri(e)});class Ey extends Qi{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==mn.date){const _=this._getOrReturnCtx(t);return Jr(_,{code:Cr.invalid_type,expected:mn.date,received:_.parsedType}),di}if(Number.isNaN(t.data.getTime())){const _=this._getOrReturnCtx(t);return Jr(_,{code:Cr.invalid_date}),di}const c=new ql;let f;for(const _ of this._def.checks)_.kind==="min"?t.data.getTime()<_.value&&(f=this._getOrReturnCtx(t,f),Jr(f,{code:Cr.too_small,message:_.message,inclusive:!0,exact:!1,minimum:_.value,type:"date"}),c.dirty()):_.kind==="max"?t.data.getTime()>_.value&&(f=this._getOrReturnCtx(t,f),Jr(f,{code:Cr.too_big,message:_.message,inclusive:!0,exact:!1,maximum:_.value,type:"date"}),c.dirty()):ts.assertNever(_);return{status:c.value,value:new Date(t.data.getTime())}}_addCheck(t){return new Ey({...this._def,checks:[...this._def.checks,t]})}min(t,i){return this._addCheck({kind:"min",value:t.getTime(),message:gn.toString(i)})}max(t,i){return this._addCheck({kind:"max",value:t.getTime(),message:gn.toString(i)})}get minDate(){let t=null;for(const i of this._def.checks)i.kind==="min"&&(t===null||i.value>t)&&(t=i.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const i of this._def.checks)i.kind==="max"&&(t===null||i.value<t)&&(t=i.value);return t!=null?new Date(t):null}}Ey.create=e=>new Ey({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:hi.ZodDate,...Ri(e)});class dz extends Qi{_parse(t){if(this._getType(t)!==mn.symbol){const c=this._getOrReturnCtx(t);return Jr(c,{code:Cr.invalid_type,expected:mn.symbol,received:c.parsedType}),di}return gc(t.data)}}dz.create=e=>new dz({typeName:hi.ZodSymbol,...Ri(e)});class hz extends Qi{_parse(t){if(this._getType(t)!==mn.undefined){const c=this._getOrReturnCtx(t);return Jr(c,{code:Cr.invalid_type,expected:mn.undefined,received:c.parsedType}),di}return gc(t.data)}}hz.create=e=>new hz({typeName:hi.ZodUndefined,...Ri(e)});class fz extends Qi{_parse(t){if(this._getType(t)!==mn.null){const c=this._getOrReturnCtx(t);return Jr(c,{code:Cr.invalid_type,expected:mn.null,received:c.parsedType}),di}return gc(t.data)}}fz.create=e=>new fz({typeName:hi.ZodNull,...Ri(e)});class pz extends Qi{constructor(){super(...arguments),this._any=!0}_parse(t){return gc(t.data)}}pz.create=e=>new pz({typeName:hi.ZodAny,...Ri(e)});class mz extends Qi{constructor(){super(...arguments),this._unknown=!0}_parse(t){return gc(t.data)}}mz.create=e=>new mz({typeName:hi.ZodUnknown,...Ri(e)});class Ff extends Qi{_parse(t){const i=this._getOrReturnCtx(t);return Jr(i,{code:Cr.invalid_type,expected:mn.never,received:i.parsedType}),di}}Ff.create=e=>new Ff({typeName:hi.ZodNever,...Ri(e)});class gz extends Qi{_parse(t){if(this._getType(t)!==mn.undefined){const c=this._getOrReturnCtx(t);return Jr(c,{code:Cr.invalid_type,expected:mn.void,received:c.parsedType}),di}return gc(t.data)}}gz.create=e=>new gz({typeName:hi.ZodVoid,...Ri(e)});class Gu extends Qi{_parse(t){const{ctx:i,status:c}=this._processInputParams(t),f=this._def;if(i.parsedType!==mn.array)return Jr(i,{code:Cr.invalid_type,expected:mn.array,received:i.parsedType}),di;if(f.exactLength!==null){const x=i.data.length>f.exactLength.value,o=i.data.length<f.exactLength.value;(x||o)&&(Jr(i,{code:x?Cr.too_big:Cr.too_small,minimum:o?f.exactLength.value:void 0,maximum:x?f.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:f.exactLength.message}),c.dirty())}if(f.minLength!==null&&i.data.length<f.minLength.value&&(Jr(i,{code:Cr.too_small,minimum:f.minLength.value,type:"array",inclusive:!0,exact:!1,message:f.minLength.message}),c.dirty()),f.maxLength!==null&&i.data.length>f.maxLength.value&&(Jr(i,{code:Cr.too_big,maximum:f.maxLength.value,type:"array",inclusive:!0,exact:!1,message:f.maxLength.message}),c.dirty()),i.common.async)return Promise.all([...i.data].map((x,o)=>f.type._parseAsync(new zf(i,x,i.path,o)))).then(x=>ql.mergeArray(c,x));const _=[...i.data].map((x,o)=>f.type._parseSync(new zf(i,x,i.path,o)));return ql.mergeArray(c,_)}get element(){return this._def.type}min(t,i){return new Gu({...this._def,minLength:{value:t,message:gn.toString(i)}})}max(t,i){return new Gu({...this._def,maxLength:{value:t,message:gn.toString(i)}})}length(t,i){return new Gu({...this._def,exactLength:{value:t,message:gn.toString(i)}})}nonempty(t){return this.min(1,t)}}Gu.create=(e,t)=>new Gu({type:e,minLength:null,maxLength:null,exactLength:null,typeName:hi.ZodArray,...Ri(t)});function I_(e){if(e instanceof uo){const t={};for(const i in e.shape){const c=e.shape[i];t[i]=jf.create(I_(c))}return new uo({...e._def,shape:()=>t})}else return e instanceof Gu?new Gu({...e._def,type:I_(e.element)}):e instanceof jf?jf.create(I_(e.unwrap())):e instanceof Iy?Iy.create(I_(e.unwrap())):e instanceof jm?jm.create(e.items.map(t=>I_(t))):e}class uo extends Qi{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),i=ts.objectKeys(t);return this._cached={shape:t,keys:i},this._cached}_parse(t){if(this._getType(t)!==mn.object){const P=this._getOrReturnCtx(t);return Jr(P,{code:Cr.invalid_type,expected:mn.object,received:P.parsedType}),di}const{status:c,ctx:f}=this._processInputParams(t),{shape:_,keys:x}=this._getCached(),o=[];if(!(this._def.catchall instanceof Ff&&this._def.unknownKeys==="strip"))for(const P in f.data)x.includes(P)||o.push(P);const I=[];for(const P of x){const N=_[P],U=f.data[P];I.push({key:{status:"valid",value:P},value:N._parse(new zf(f,U,f.path,P)),alwaysSet:P in f.data})}if(this._def.catchall instanceof Ff){const P=this._def.unknownKeys;if(P==="passthrough")for(const N of o)I.push({key:{status:"valid",value:N},value:{status:"valid",value:f.data[N]}});else if(P==="strict")o.length>0&&(Jr(f,{code:Cr.unrecognized_keys,keys:o}),c.dirty());else if(P!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const P=this._def.catchall;for(const N of o){const U=f.data[N];I.push({key:{status:"valid",value:N},value:P._parse(new zf(f,U,f.path,N)),alwaysSet:N in f.data})}}return f.common.async?Promise.resolve().then(async()=>{const P=[];for(const N of I){const U=await N.key,$=await N.value;P.push({key:U,value:$,alwaysSet:N.alwaysSet})}return P}).then(P=>ql.mergeObjectSync(c,P)):ql.mergeObjectSync(c,I)}get shape(){return this._def.shape()}strict(t){return gn.errToObj,new uo({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(i,c)=>{var _,x;const f=((x=(_=this._def).errorMap)==null?void 0:x.call(_,i,c).message)??c.defaultError;return i.code==="unrecognized_keys"?{message:gn.errToObj(t).message??f}:{message:f}}}:{}})}strip(){return new uo({...this._def,unknownKeys:"strip"})}passthrough(){return new uo({...this._def,unknownKeys:"passthrough"})}extend(t){return new uo({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new uo({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:hi.ZodObject})}setKey(t,i){return this.augment({[t]:i})}catchall(t){return new uo({...this._def,catchall:t})}pick(t){const i={};for(const c of ts.objectKeys(t))t[c]&&this.shape[c]&&(i[c]=this.shape[c]);return new uo({...this._def,shape:()=>i})}omit(t){const i={};for(const c of ts.objectKeys(this.shape))t[c]||(i[c]=this.shape[c]);return new uo({...this._def,shape:()=>i})}deepPartial(){return I_(this)}partial(t){const i={};for(const c of ts.objectKeys(this.shape)){const f=this.shape[c];t&&!t[c]?i[c]=f:i[c]=f.optional()}return new uo({...this._def,shape:()=>i})}required(t){const i={};for(const c of ts.objectKeys(this.shape))if(t&&!t[c])i[c]=this.shape[c];else{let _=this.shape[c];for(;_ instanceof jf;)_=_._def.innerType;i[c]=_}return new uo({...this._def,shape:()=>i})}keyof(){return NV(ts.objectKeys(this.shape))}}uo.create=(e,t)=>new uo({shape:()=>e,unknownKeys:"strip",catchall:Ff.create(),typeName:hi.ZodObject,...Ri(t)});uo.strictCreate=(e,t)=>new uo({shape:()=>e,unknownKeys:"strict",catchall:Ff.create(),typeName:hi.ZodObject,...Ri(t)});uo.lazycreate=(e,t)=>new uo({shape:e,unknownKeys:"strip",catchall:Ff.create(),typeName:hi.ZodObject,...Ri(t)});class xT extends Qi{_parse(t){const{ctx:i}=this._processInputParams(t),c=this._def.options;function f(_){for(const o of _)if(o.result.status==="valid")return o.result;for(const o of _)if(o.result.status==="dirty")return i.common.issues.push(...o.ctx.common.issues),o.result;const x=_.map(o=>new pc(o.ctx.common.issues));return Jr(i,{code:Cr.invalid_union,unionErrors:x}),di}if(i.common.async)return Promise.all(c.map(async _=>{const x={...i,common:{...i.common,issues:[]},parent:null};return{result:await _._parseAsync({data:i.data,path:i.path,parent:x}),ctx:x}})).then(f);{let _;const x=[];for(const I of c){const P={...i,common:{...i.common,issues:[]},parent:null},N=I._parseSync({data:i.data,path:i.path,parent:P});if(N.status==="valid")return N;N.status==="dirty"&&!_&&(_={result:N,ctx:P}),P.common.issues.length&&x.push(P.common.issues)}if(_)return i.common.issues.push(..._.ctx.common.issues),_.result;const o=x.map(I=>new pc(I));return Jr(i,{code:Cr.invalid_union,unionErrors:o}),di}}get options(){return this._def.options}}xT.create=(e,t)=>new xT({options:e,typeName:hi.ZodUnion,...Ri(t)});function mP(e,t){const i=tf(e),c=tf(t);if(e===t)return{valid:!0,data:e};if(i===mn.object&&c===mn.object){const f=ts.objectKeys(t),_=ts.objectKeys(e).filter(o=>f.indexOf(o)!==-1),x={...e,...t};for(const o of _){const I=mP(e[o],t[o]);if(!I.valid)return{valid:!1};x[o]=I.data}return{valid:!0,data:x}}else if(i===mn.array&&c===mn.array){if(e.length!==t.length)return{valid:!1};const f=[];for(let _=0;_<e.length;_++){const x=e[_],o=t[_],I=mP(x,o);if(!I.valid)return{valid:!1};f.push(I.data)}return{valid:!0,data:f}}else return i===mn.date&&c===mn.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class bT extends Qi{_parse(t){const{status:i,ctx:c}=this._processInputParams(t),f=(_,x)=>{if(lz(_)||lz(x))return di;const o=mP(_.value,x.value);return o.valid?((cz(_)||cz(x))&&i.dirty(),{status:i.value,value:o.data}):(Jr(c,{code:Cr.invalid_intersection_types}),di)};return c.common.async?Promise.all([this._def.left._parseAsync({data:c.data,path:c.path,parent:c}),this._def.right._parseAsync({data:c.data,path:c.path,parent:c})]).then(([_,x])=>f(_,x)):f(this._def.left._parseSync({data:c.data,path:c.path,parent:c}),this._def.right._parseSync({data:c.data,path:c.path,parent:c}))}}bT.create=(e,t,i)=>new bT({left:e,right:t,typeName:hi.ZodIntersection,...Ri(i)});class jm extends Qi{_parse(t){const{status:i,ctx:c}=this._processInputParams(t);if(c.parsedType!==mn.array)return Jr(c,{code:Cr.invalid_type,expected:mn.array,received:c.parsedType}),di;if(c.data.length<this._def.items.length)return Jr(c,{code:Cr.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),di;!this._def.rest&&c.data.length>this._def.items.length&&(Jr(c,{code:Cr.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),i.dirty());const _=[...c.data].map((x,o)=>{const I=this._def.items[o]||this._def.rest;return I?I._parse(new zf(c,x,c.path,o)):null}).filter(x=>!!x);return c.common.async?Promise.all(_).then(x=>ql.mergeArray(i,x)):ql.mergeArray(i,_)}get items(){return this._def.items}rest(t){return new jm({...this._def,rest:t})}}jm.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new jm({items:e,typeName:hi.ZodTuple,rest:null,...Ri(t)})};class _z extends Qi{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:i,ctx:c}=this._processInputParams(t);if(c.parsedType!==mn.map)return Jr(c,{code:Cr.invalid_type,expected:mn.map,received:c.parsedType}),di;const f=this._def.keyType,_=this._def.valueType,x=[...c.data.entries()].map(([o,I],P)=>({key:f._parse(new zf(c,o,c.path,[P,"key"])),value:_._parse(new zf(c,I,c.path,[P,"value"]))}));if(c.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const I of x){const P=await I.key,N=await I.value;if(P.status==="aborted"||N.status==="aborted")return di;(P.status==="dirty"||N.status==="dirty")&&i.dirty(),o.set(P.value,N.value)}return{status:i.value,value:o}})}else{const o=new Map;for(const I of x){const P=I.key,N=I.value;if(P.status==="aborted"||N.status==="aborted")return di;(P.status==="dirty"||N.status==="dirty")&&i.dirty(),o.set(P.value,N.value)}return{status:i.value,value:o}}}}_z.create=(e,t,i)=>new _z({valueType:t,keyType:e,typeName:hi.ZodMap,...Ri(i)});class nb extends Qi{_parse(t){const{status:i,ctx:c}=this._processInputParams(t);if(c.parsedType!==mn.set)return Jr(c,{code:Cr.invalid_type,expected:mn.set,received:c.parsedType}),di;const f=this._def;f.minSize!==null&&c.data.size<f.minSize.value&&(Jr(c,{code:Cr.too_small,minimum:f.minSize.value,type:"set",inclusive:!0,exact:!1,message:f.minSize.message}),i.dirty()),f.maxSize!==null&&c.data.size>f.maxSize.value&&(Jr(c,{code:Cr.too_big,maximum:f.maxSize.value,type:"set",inclusive:!0,exact:!1,message:f.maxSize.message}),i.dirty());const _=this._def.valueType;function x(I){const P=new Set;for(const N of I){if(N.status==="aborted")return di;N.status==="dirty"&&i.dirty(),P.add(N.value)}return{status:i.value,value:P}}const o=[...c.data.values()].map((I,P)=>_._parse(new zf(c,I,c.path,P)));return c.common.async?Promise.all(o).then(I=>x(I)):x(o)}min(t,i){return new nb({...this._def,minSize:{value:t,message:gn.toString(i)}})}max(t,i){return new nb({...this._def,maxSize:{value:t,message:gn.toString(i)}})}size(t,i){return this.min(t,i).max(t,i)}nonempty(t){return this.min(1,t)}}nb.create=(e,t)=>new nb({valueType:e,minSize:null,maxSize:null,typeName:hi.ZodSet,...Ri(t)});class yz extends Qi{get schema(){return this._def.getter()}_parse(t){const{ctx:i}=this._processInputParams(t);return this._def.getter()._parse({data:i.data,path:i.path,parent:i})}}yz.create=(e,t)=>new yz({getter:e,typeName:hi.ZodLazy,...Ri(t)});class vz extends Qi{_parse(t){if(t.data!==this._def.value){const i=this._getOrReturnCtx(t);return Jr(i,{received:i.data,code:Cr.invalid_literal,expected:this._def.value}),di}return{status:"valid",value:t.data}}get value(){return this._def.value}}vz.create=(e,t)=>new vz({value:e,typeName:hi.ZodLiteral,...Ri(t)});function NV(e,t){return new Cy({values:e,typeName:hi.ZodEnum,...Ri(t)})}class Cy extends Qi{_parse(t){if(typeof t.data!="string"){const i=this._getOrReturnCtx(t),c=this._def.values;return Jr(i,{expected:ts.joinValues(c),received:i.parsedType,code:Cr.invalid_type}),di}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const i=this._getOrReturnCtx(t),c=this._def.values;return Jr(i,{received:i.data,code:Cr.invalid_enum_value,options:c}),di}return gc(t.data)}get options(){return this._def.values}get enum(){const t={};for(const i of this._def.values)t[i]=i;return t}get Values(){const t={};for(const i of this._def.values)t[i]=i;return t}get Enum(){const t={};for(const i of this._def.values)t[i]=i;return t}extract(t,i=this._def){return Cy.create(t,{...this._def,...i})}exclude(t,i=this._def){return Cy.create(this.options.filter(c=>!t.includes(c)),{...this._def,...i})}}Cy.create=NV;class xz extends Qi{_parse(t){const i=ts.getValidEnumValues(this._def.values),c=this._getOrReturnCtx(t);if(c.parsedType!==mn.string&&c.parsedType!==mn.number){const f=ts.objectValues(i);return Jr(c,{expected:ts.joinValues(f),received:c.parsedType,code:Cr.invalid_type}),di}if(this._cache||(this._cache=new Set(ts.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const f=ts.objectValues(i);return Jr(c,{received:c.data,code:Cr.invalid_enum_value,options:f}),di}return gc(t.data)}get enum(){return this._def.values}}xz.create=(e,t)=>new xz({values:e,typeName:hi.ZodNativeEnum,...Ri(t)});class wT extends Qi{unwrap(){return this._def.type}_parse(t){const{ctx:i}=this._processInputParams(t);if(i.parsedType!==mn.promise&&i.common.async===!1)return Jr(i,{code:Cr.invalid_type,expected:mn.promise,received:i.parsedType}),di;const c=i.parsedType===mn.promise?i.data:Promise.resolve(i.data);return gc(c.then(f=>this._def.type.parseAsync(f,{path:i.path,errorMap:i.common.contextualErrorMap})))}}wT.create=(e,t)=>new wT({type:e,typeName:hi.ZodPromise,...Ri(t)});class Ay extends Qi{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===hi.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:i,ctx:c}=this._processInputParams(t),f=this._def.effect||null,_={addIssue:x=>{Jr(c,x),x.fatal?i.abort():i.dirty()},get path(){return c.path}};if(_.addIssue=_.addIssue.bind(_),f.type==="preprocess"){const x=f.transform(c.data,_);if(c.common.async)return Promise.resolve(x).then(async o=>{if(i.value==="aborted")return di;const I=await this._def.schema._parseAsync({data:o,path:c.path,parent:c});return I.status==="aborted"?di:I.status==="dirty"||i.value==="dirty"?d0(I.value):I});{if(i.value==="aborted")return di;const o=this._def.schema._parseSync({data:x,path:c.path,parent:c});return o.status==="aborted"?di:o.status==="dirty"||i.value==="dirty"?d0(o.value):o}}if(f.type==="refinement"){const x=o=>{const I=f.refinement(o,_);if(c.common.async)return Promise.resolve(I);if(I instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(c.common.async===!1){const o=this._def.schema._parseSync({data:c.data,path:c.path,parent:c});return o.status==="aborted"?di:(o.status==="dirty"&&i.dirty(),x(o.value),{status:i.value,value:o.value})}else return this._def.schema._parseAsync({data:c.data,path:c.path,parent:c}).then(o=>o.status==="aborted"?di:(o.status==="dirty"&&i.dirty(),x(o.value).then(()=>({status:i.value,value:o.value}))))}if(f.type==="transform")if(c.common.async===!1){const x=this._def.schema._parseSync({data:c.data,path:c.path,parent:c});if(!Ty(x))return di;const o=f.transform(x.value,_);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:i.value,value:o}}else return this._def.schema._parseAsync({data:c.data,path:c.path,parent:c}).then(x=>Ty(x)?Promise.resolve(f.transform(x.value,_)).then(o=>({status:i.value,value:o})):di);ts.assertNever(f)}}Ay.create=(e,t,i)=>new Ay({schema:e,typeName:hi.ZodEffects,effect:t,...Ri(i)});Ay.createWithPreprocess=(e,t,i)=>new Ay({schema:t,effect:{type:"preprocess",transform:e},typeName:hi.ZodEffects,...Ri(i)});class jf extends Qi{_parse(t){return this._getType(t)===mn.undefined?gc(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}jf.create=(e,t)=>new jf({innerType:e,typeName:hi.ZodOptional,...Ri(t)});class Iy extends Qi{_parse(t){return this._getType(t)===mn.null?gc(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Iy.create=(e,t)=>new Iy({innerType:e,typeName:hi.ZodNullable,...Ri(t)});class gP extends Qi{_parse(t){const{ctx:i}=this._processInputParams(t);let c=i.data;return i.parsedType===mn.undefined&&(c=this._def.defaultValue()),this._def.innerType._parse({data:c,path:i.path,parent:i})}removeDefault(){return this._def.innerType}}gP.create=(e,t)=>new gP({innerType:e,typeName:hi.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...Ri(t)});class _P extends Qi{_parse(t){const{ctx:i}=this._processInputParams(t),c={...i,common:{...i.common,issues:[]}},f=this._def.innerType._parse({data:c.data,path:c.path,parent:{...c}});return yT(f)?f.then(_=>({status:"valid",value:_.status==="valid"?_.value:this._def.catchValue({get error(){return new pc(c.common.issues)},input:c.data})})):{status:"valid",value:f.status==="valid"?f.value:this._def.catchValue({get error(){return new pc(c.common.issues)},input:c.data})}}removeCatch(){return this._def.innerType}}_P.create=(e,t)=>new _P({innerType:e,typeName:hi.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...Ri(t)});class bz extends Qi{_parse(t){if(this._getType(t)!==mn.nan){const c=this._getOrReturnCtx(t);return Jr(c,{code:Cr.invalid_type,expected:mn.nan,received:c.parsedType}),di}return{status:"valid",value:t.data}}}bz.create=e=>new bz({typeName:hi.ZodNaN,...Ri(e)});class zte extends Qi{_parse(t){const{ctx:i}=this._processInputParams(t),c=i.data;return this._def.type._parse({data:c,path:i.path,parent:i})}unwrap(){return this._def.type}}class uj extends Qi{_parse(t){const{status:i,ctx:c}=this._processInputParams(t);if(c.common.async)return(async()=>{const _=await this._def.in._parseAsync({data:c.data,path:c.path,parent:c});return _.status==="aborted"?di:_.status==="dirty"?(i.dirty(),d0(_.value)):this._def.out._parseAsync({data:_.value,path:c.path,parent:c})})();{const f=this._def.in._parseSync({data:c.data,path:c.path,parent:c});return f.status==="aborted"?di:f.status==="dirty"?(i.dirty(),{status:"dirty",value:f.value}):this._def.out._parseSync({data:f.value,path:c.path,parent:c})}}static create(t,i){return new uj({in:t,out:i,typeName:hi.ZodPipeline})}}class yP extends Qi{_parse(t){const i=this._def.innerType._parse(t),c=f=>(Ty(f)&&(f.value=Object.freeze(f.value)),f);return yT(i)?i.then(f=>c(f)):c(i)}unwrap(){return this._def.innerType}}yP.create=(e,t)=>new yP({innerType:e,typeName:hi.ZodReadonly,...Ri(t)});uo.lazycreate;var hi;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(hi||(hi={}));const sa=Nd.create;Pm.create;km.create;vT.create;Ey.create;Ff.create;Gu.create;const Sb=uo.create;uo.strictCreate;xT.create;bT.create;jm.create;const oS=Cy.create;wT.create;jf.create;Iy.create;const Fte={string:e=>Nd.create({...e,coerce:!0}),number:e=>Pm.create({...e,coerce:!0}),boolean:e=>vT.create({...e,coerce:!0}),bigint:e=>km.create({...e,coerce:!0}),date:e=>Ey.create({...e,coerce:!0})},_r=V.forwardRef(({className:e,type:t,...i},c)=>h.jsx("input",{type:t,className:yr("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:c,...i}));_r.displayName="Input";var Bte="Label",OV=V.forwardRef((e,t)=>h.jsx(xi.label,{...e,ref:t,onMouseDown:i=>{var f;i.target.closest("button, input, select, textarea")||((f=e.onMouseDown)==null||f.call(e,i),!i.defaultPrevented&&i.detail>1&&i.preventDefault())}}));OV.displayName=Bte;var LV=OV;const Vte=Dy("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Kt=V.forwardRef(({className:e,...t},i)=>h.jsx(LV,{ref:i,className:yr(Vte(),e),...t}));Kt.displayName=LV.displayName;const kr=V.forwardRef(({className:e,...t},i)=>h.jsx("div",{ref:i,className:yr("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));kr.displayName="Card";const Mn=V.forwardRef(({className:e,...t},i)=>h.jsx("div",{ref:i,className:yr("flex flex-col space-y-1.5 p-6",e),...t}));Mn.displayName="CardHeader";const Zn=V.forwardRef(({className:e,...t},i)=>h.jsx("h3",{ref:i,className:yr("text-2xl font-semibold leading-none tracking-tight",e),...t}));Zn.displayName="CardTitle";const Xa=V.forwardRef(({className:e,...t},i)=>h.jsx("p",{ref:i,className:yr("text-sm text-muted-foreground",e),...t}));Xa.displayName="CardDescription";const tn=V.forwardRef(({className:e,...t},i)=>h.jsx("div",{ref:i,className:yr("p-6 pt-0",e),...t}));tn.displayName="CardContent";const Ute=V.forwardRef(({className:e,...t},i)=>h.jsx("div",{ref:i,className:yr("flex items-center p-6 pt-0",e),...t}));Ute.displayName="CardFooter";const $te=async({to:e,subject:t,html:i,from:c})=>{try{const{data:f,error:_}=await Qe.functions.invoke("send-email",{body:{to:e,subject:t,html:i,from:c}});if(_)throw _;return{success:!0,data:f}}catch(f){return console.error("Error sending email:",f),{success:!1,error:f}}},qte=async(e,t)=>{const i=`
    <!DOCTYPE html>
    <html>
      <head>
        <style>
          body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
          .container { max-width: 600px; margin: 0 auto; padding: 20px; }
          .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }
          .content { background: #f9fafb; padding: 30px; border-radius: 0 0 10px 10px; }
          .button { display: inline-block; background: #667eea; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; margin: 20px 0; }
          .footer { text-align: center; margin-top: 20px; color: #6b7280; font-size: 14px; }
        </style>
      </head>
      <body>
        <div class="container">
          <div class="header">
            <h1>Bem-vindo ao Facilities Hub! </h1>
          </div>
          <div class="content">
            <h2>Ol, ${t}!</h2>
            <p>Estamos muito felizes em ter voc conosco no <strong>Facilities Hub</strong>, sua plataforma completa de gesto de facilities.</p>
            
            <p>Com o Facilities Hub voc poder:</p>
            <ul>
              <li>Gerenciar ordens de servio e manutenes</li>
              <li>Controlar ativos e equipamentos</li>
              <li>Acompanhar indicadores e relatrios</li>
              <li>Otimizar processos de facilities</li>
            </ul>
            
            <p>Sua conta foi criada com sucesso e voc j pode comear a explorar a plataforma.</p>
            
            <a href="${window.location.origin}/dashboard" class="button">Acessar Dashboard</a>
            
            <p>Se voc tiver alguma dvida ou precisar de ajuda, nossa equipe est sempre disponvel.</p>
            
            <p>Atenciosamente,<br><strong>Equipe Facilities Hub</strong></p>
          </div>
          <div class="footer">
            <p>Este  um email automtico, por favor no responda.</p>
          </div>
        </div>
      </body>
    </html>
  `;return $te({to:e,subject:"Bem-vindo ao Facilities Hub!",html:i})};var _A="focusScope.autoFocusOnMount",yA="focusScope.autoFocusOnUnmount",wz={bubbles:!1,cancelable:!0},Gte="FocusScope",dj=V.forwardRef((e,t)=>{const{loop:i=!1,trapped:c=!1,onMountAutoFocus:f,onUnmountAutoFocus:_,...x}=e,[o,I]=V.useState(null),P=fc(f),N=fc(_),U=V.useRef(null),$=vs(t,H=>I(H)),B=V.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;V.useEffect(()=>{if(c){let H=function(X){if(B.paused||!o)return;const ue=X.target;o.contains(ue)?U.current=ue:Jh(U.current,{select:!0})},K=function(X){if(B.paused||!o)return;const ue=X.relatedTarget;ue!==null&&(o.contains(ue)||Jh(U.current,{select:!0}))},re=function(X){if(document.activeElement===document.body)for(const Ee of X)Ee.removedNodes.length>0&&Jh(o)};document.addEventListener("focusin",H),document.addEventListener("focusout",K);const G=new MutationObserver(re);return o&&G.observe(o,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",H),document.removeEventListener("focusout",K),G.disconnect()}}},[c,o,B.paused]),V.useEffect(()=>{if(o){Tz.add(B);const H=document.activeElement;if(!o.contains(H)){const re=new CustomEvent(_A,wz);o.addEventListener(_A,P),o.dispatchEvent(re),re.defaultPrevented||(Wte(Yte(zV(o)),{select:!0}),document.activeElement===H&&Jh(o))}return()=>{o.removeEventListener(_A,P),setTimeout(()=>{const re=new CustomEvent(yA,wz);o.addEventListener(yA,N),o.dispatchEvent(re),re.defaultPrevented||Jh(H??document.body,{select:!0}),o.removeEventListener(yA,N),Tz.remove(B)},0)}}},[o,P,N,B]);const Y=V.useCallback(H=>{if(!i&&!c||B.paused)return;const K=H.key==="Tab"&&!H.altKey&&!H.ctrlKey&&!H.metaKey,re=document.activeElement;if(K&&re){const G=H.currentTarget,[X,ue]=Hte(G);X&&ue?!H.shiftKey&&re===ue?(H.preventDefault(),i&&Jh(X,{select:!0})):H.shiftKey&&re===X&&(H.preventDefault(),i&&Jh(ue,{select:!0})):re===G&&H.preventDefault()}},[i,c,B.paused]);return h.jsx(xi.div,{tabIndex:-1,...x,ref:$,onKeyDown:Y})});dj.displayName=Gte;function Wte(e,{select:t=!1}={}){const i=document.activeElement;for(const c of e)if(Jh(c,{select:t}),document.activeElement!==i)return}function Hte(e){const t=zV(e),i=Sz(t,e),c=Sz(t.reverse(),e);return[i,c]}function zV(e){const t=[],i=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:c=>{const f=c.tagName==="INPUT"&&c.type==="hidden";return c.disabled||c.hidden||f?NodeFilter.FILTER_SKIP:c.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;i.nextNode();)t.push(i.currentNode);return t}function Sz(e,t){for(const i of e)if(!Zte(i,{upTo:t}))return i}function Zte(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function Xte(e){return e instanceof HTMLInputElement&&"select"in e}function Jh(e,{select:t=!1}={}){if(e&&e.focus){const i=document.activeElement;e.focus({preventScroll:!0}),e!==i&&Xte(e)&&t&&e.select()}}var Tz=Kte();function Kte(){let e=[];return{add(t){const i=e[0];t!==i&&(i==null||i.pause()),e=Ez(e,t),e.unshift(t)},remove(t){var i;e=Ez(e,t),(i=e[0])==null||i.resume()}}}function Ez(e,t){const i=[...e],c=i.indexOf(t);return c!==-1&&i.splice(c,1),i}function Yte(e){return e.filter(t=>t.tagName!=="A")}var vA=0;function FV(){V.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??Cz()),document.body.insertAdjacentElement("beforeend",e[1]??Cz()),vA++,()=>{vA===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),vA--}},[])}function Cz(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var IS="right-scroll-bar-position",PS="width-before-scroll-bar",Jte="with-scroll-bars-hidden",Qte="--removed-body-scroll-bar-size";function xA(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function ere(e,t){var i=V.useState(function(){return{value:e,callback:t,facade:{get current(){return i.value},set current(c){var f=i.value;f!==c&&(i.value=c,i.callback(c,f))}}}})[0];return i.callback=t,i.facade}var tre=typeof window<"u"?V.useLayoutEffect:V.useEffect,Az=new WeakMap;function rre(e,t){var i=ere(null,function(c){return e.forEach(function(f){return xA(f,c)})});return tre(function(){var c=Az.get(i);if(c){var f=new Set(c),_=new Set(e),x=i.current;f.forEach(function(o){_.has(o)||xA(o,null)}),_.forEach(function(o){f.has(o)||xA(o,x)})}Az.set(i,e)},[e]),i}function nre(e){return e}function ire(e,t){t===void 0&&(t=nre);var i=[],c=!1,f={read:function(){if(c)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:e},useMedium:function(_){var x=t(_,c);return i.push(x),function(){i=i.filter(function(o){return o!==x})}},assignSyncMedium:function(_){for(c=!0;i.length;){var x=i;i=[],x.forEach(_)}i={push:function(o){return _(o)},filter:function(){return i}}},assignMedium:function(_){c=!0;var x=[];if(i.length){var o=i;i=[],o.forEach(_),x=i}var I=function(){var N=x;x=[],N.forEach(_)},P=function(){return Promise.resolve().then(I)};P(),i={push:function(N){x.push(N),P()},filter:function(N){return x=x.filter(N),i}}}};return f}function sre(e){e===void 0&&(e={});var t=ire(null);return t.options=lc({async:!0,ssr:!1},e),t}var BV=function(e){var t=e.sideCar,i=Wf(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var c=t.read();if(!c)throw new Error("Sidecar medium not found");return V.createElement(c,lc({},i))};BV.isSideCarExport=!0;function ore(e,t){return e.useMedium(t),BV}var VV=sre(),bA=function(){},u2=V.forwardRef(function(e,t){var i=V.useRef(null),c=V.useState({onScrollCapture:bA,onWheelCapture:bA,onTouchMoveCapture:bA}),f=c[0],_=c[1],x=e.forwardProps,o=e.children,I=e.className,P=e.removeScrollBar,N=e.enabled,U=e.shards,$=e.sideCar,B=e.noRelative,Y=e.noIsolation,H=e.inert,K=e.allowPinchZoom,re=e.as,G=re===void 0?"div":re,X=e.gapMode,ue=Wf(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),Ee=$,xe=rre([i,t]),Ne=lc(lc({},ue),f);return V.createElement(V.Fragment,null,N&&V.createElement(Ee,{sideCar:VV,removeScrollBar:P,shards:U,noRelative:B,noIsolation:Y,inert:H,setCallbacks:_,allowPinchZoom:!!K,lockRef:i,gapMode:X}),x?V.cloneElement(V.Children.only(o),lc(lc({},Ne),{ref:xe})):V.createElement(G,lc({},Ne,{className:I,ref:xe}),o))});u2.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};u2.classNames={fullWidth:PS,zeroRight:IS};var are=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function lre(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=are();return t&&e.setAttribute("nonce",t),e}function cre(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function ure(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var dre=function(){var e=0,t=null;return{add:function(i){e==0&&(t=lre())&&(cre(t,i),ure(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},hre=function(){var e=dre();return function(t,i){V.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&i])}},UV=function(){var e=hre(),t=function(i){var c=i.styles,f=i.dynamic;return e(c,f),null};return t},fre={left:0,top:0,right:0,gap:0},wA=function(e){return parseInt(e||"",10)||0},pre=function(e){var t=window.getComputedStyle(document.body),i=t[e==="padding"?"paddingLeft":"marginLeft"],c=t[e==="padding"?"paddingTop":"marginTop"],f=t[e==="padding"?"paddingRight":"marginRight"];return[wA(i),wA(c),wA(f)]},mre=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return fre;var t=pre(e),i=document.documentElement.clientWidth,c=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,c-i+t[2]-t[0])}},gre=UV(),Y_="data-scroll-locked",_re=function(e,t,i,c){var f=e.left,_=e.top,x=e.right,o=e.gap;return i===void 0&&(i="margin"),`
  .`.concat(Jte,` {
   overflow: hidden `).concat(c,`;
   padding-right: `).concat(o,"px ").concat(c,`;
  }
  body[`).concat(Y_,`] {
    overflow: hidden `).concat(c,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(c,";"),i==="margin"&&`
    padding-left: `.concat(f,`px;
    padding-top: `).concat(_,`px;
    padding-right: `).concat(x,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(o,"px ").concat(c,`;
    `),i==="padding"&&"padding-right: ".concat(o,"px ").concat(c,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(IS,` {
    right: `).concat(o,"px ").concat(c,`;
  }
  
  .`).concat(PS,` {
    margin-right: `).concat(o,"px ").concat(c,`;
  }
  
  .`).concat(IS," .").concat(IS,` {
    right: 0 `).concat(c,`;
  }
  
  .`).concat(PS," .").concat(PS,` {
    margin-right: 0 `).concat(c,`;
  }
  
  body[`).concat(Y_,`] {
    `).concat(Qte,": ").concat(o,`px;
  }
`)},Iz=function(){var e=parseInt(document.body.getAttribute(Y_)||"0",10);return isFinite(e)?e:0},yre=function(){V.useEffect(function(){return document.body.setAttribute(Y_,(Iz()+1).toString()),function(){var e=Iz()-1;e<=0?document.body.removeAttribute(Y_):document.body.setAttribute(Y_,e.toString())}},[])},vre=function(e){var t=e.noRelative,i=e.noImportant,c=e.gapMode,f=c===void 0?"margin":c;yre();var _=V.useMemo(function(){return mre(f)},[f]);return V.createElement(gre,{styles:_re(_,!t,f,i?"":"!important")})},vP=!1;if(typeof window<"u")try{var aS=Object.defineProperty({},"passive",{get:function(){return vP=!0,!0}});window.addEventListener("test",aS,aS),window.removeEventListener("test",aS,aS)}catch{vP=!1}var b_=vP?{passive:!1}:!1,xre=function(e){return e.tagName==="TEXTAREA"},$V=function(e,t){if(!(e instanceof Element))return!1;var i=window.getComputedStyle(e);return i[t]!=="hidden"&&!(i.overflowY===i.overflowX&&!xre(e)&&i[t]==="visible")},bre=function(e){return $V(e,"overflowY")},wre=function(e){return $V(e,"overflowX")},Pz=function(e,t){var i=t.ownerDocument,c=t;do{typeof ShadowRoot<"u"&&c instanceof ShadowRoot&&(c=c.host);var f=qV(e,c);if(f){var _=GV(e,c),x=_[1],o=_[2];if(x>o)return!0}c=c.parentNode}while(c&&c!==i.body);return!1},Sre=function(e){var t=e.scrollTop,i=e.scrollHeight,c=e.clientHeight;return[t,i,c]},Tre=function(e){var t=e.scrollLeft,i=e.scrollWidth,c=e.clientWidth;return[t,i,c]},qV=function(e,t){return e==="v"?bre(t):wre(t)},GV=function(e,t){return e==="v"?Sre(t):Tre(t)},Ere=function(e,t){return e==="h"&&t==="rtl"?-1:1},Cre=function(e,t,i,c,f){var _=Ere(e,window.getComputedStyle(t).direction),x=_*c,o=i.target,I=t.contains(o),P=!1,N=x>0,U=0,$=0;do{if(!o)break;var B=GV(e,o),Y=B[0],H=B[1],K=B[2],re=H-K-_*Y;(Y||re)&&qV(e,o)&&(U+=re,$+=Y);var G=o.parentNode;o=G&&G.nodeType===Node.DOCUMENT_FRAGMENT_NODE?G.host:G}while(!I&&o!==document.body||I&&(t.contains(o)||t===o));return(N&&(Math.abs(U)<1||!f)||!N&&(Math.abs($)<1||!f))&&(P=!0),P},lS=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},kz=function(e){return[e.deltaX,e.deltaY]},jz=function(e){return e&&"current"in e?e.current:e},Are=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Ire=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},Pre=0,w_=[];function kre(e){var t=V.useRef([]),i=V.useRef([0,0]),c=V.useRef(),f=V.useState(Pre++)[0],_=V.useState(UV)[0],x=V.useRef(e);V.useEffect(function(){x.current=e},[e]),V.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(f));var H=tj([e.lockRef.current],(e.shards||[]).map(jz),!0).filter(Boolean);return H.forEach(function(K){return K.classList.add("allow-interactivity-".concat(f))}),function(){document.body.classList.remove("block-interactivity-".concat(f)),H.forEach(function(K){return K.classList.remove("allow-interactivity-".concat(f))})}}},[e.inert,e.lockRef.current,e.shards]);var o=V.useCallback(function(H,K){if("touches"in H&&H.touches.length===2||H.type==="wheel"&&H.ctrlKey)return!x.current.allowPinchZoom;var re=lS(H),G=i.current,X="deltaX"in H?H.deltaX:G[0]-re[0],ue="deltaY"in H?H.deltaY:G[1]-re[1],Ee,xe=H.target,Ne=Math.abs(X)>Math.abs(ue)?"h":"v";if("touches"in H&&Ne==="h"&&xe.type==="range")return!1;var lt=Pz(Ne,xe);if(!lt)return!0;if(lt?Ee=Ne:(Ee=Ne==="v"?"h":"v",lt=Pz(Ne,xe)),!lt)return!1;if(!c.current&&"changedTouches"in H&&(X||ue)&&(c.current=Ee),!Ee)return!0;var Pt=c.current||Ee;return Cre(Pt,K,H,Pt==="h"?X:ue,!0)},[]),I=V.useCallback(function(H){var K=H;if(!(!w_.length||w_[w_.length-1]!==_)){var re="deltaY"in K?kz(K):lS(K),G=t.current.filter(function(Ee){return Ee.name===K.type&&(Ee.target===K.target||K.target===Ee.shadowParent)&&Are(Ee.delta,re)})[0];if(G&&G.should){K.cancelable&&K.preventDefault();return}if(!G){var X=(x.current.shards||[]).map(jz).filter(Boolean).filter(function(Ee){return Ee.contains(K.target)}),ue=X.length>0?o(K,X[0]):!x.current.noIsolation;ue&&K.cancelable&&K.preventDefault()}}},[]),P=V.useCallback(function(H,K,re,G){var X={name:H,delta:K,target:re,should:G,shadowParent:jre(re)};t.current.push(X),setTimeout(function(){t.current=t.current.filter(function(ue){return ue!==X})},1)},[]),N=V.useCallback(function(H){i.current=lS(H),c.current=void 0},[]),U=V.useCallback(function(H){P(H.type,kz(H),H.target,o(H,e.lockRef.current))},[]),$=V.useCallback(function(H){P(H.type,lS(H),H.target,o(H,e.lockRef.current))},[]);V.useEffect(function(){return w_.push(_),e.setCallbacks({onScrollCapture:U,onWheelCapture:U,onTouchMoveCapture:$}),document.addEventListener("wheel",I,b_),document.addEventListener("touchmove",I,b_),document.addEventListener("touchstart",N,b_),function(){w_=w_.filter(function(H){return H!==_}),document.removeEventListener("wheel",I,b_),document.removeEventListener("touchmove",I,b_),document.removeEventListener("touchstart",N,b_)}},[]);var B=e.removeScrollBar,Y=e.inert;return V.createElement(V.Fragment,null,Y?V.createElement(_,{styles:Ire(f)}):null,B?V.createElement(vre,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function jre(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const Rre=ore(VV,kre);var hj=V.forwardRef(function(e,t){return V.createElement(u2,lc({},e,{ref:t,sideCar:Rre}))});hj.classNames=u2.classNames;var Mre=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},S_=new WeakMap,cS=new WeakMap,uS={},SA=0,WV=function(e){return e&&(e.host||WV(e.parentNode))},Dre=function(e,t){return t.map(function(i){if(e.contains(i))return i;var c=WV(i);return c&&e.contains(c)?c:(console.error("aria-hidden",i,"in not contained inside",e,". Doing nothing"),null)}).filter(function(i){return!!i})},Nre=function(e,t,i,c){var f=Dre(t,Array.isArray(e)?e:[e]);uS[i]||(uS[i]=new WeakMap);var _=uS[i],x=[],o=new Set,I=new Set(f),P=function(U){!U||o.has(U)||(o.add(U),P(U.parentNode))};f.forEach(P);var N=function(U){!U||I.has(U)||Array.prototype.forEach.call(U.children,function($){if(o.has($))N($);else try{var B=$.getAttribute(c),Y=B!==null&&B!=="false",H=(S_.get($)||0)+1,K=(_.get($)||0)+1;S_.set($,H),_.set($,K),x.push($),H===1&&Y&&cS.set($,!0),K===1&&$.setAttribute(i,"true"),Y||$.setAttribute(c,"true")}catch(re){console.error("aria-hidden: cannot operate on ",$,re)}})};return N(t),o.clear(),SA++,function(){x.forEach(function(U){var $=S_.get(U)-1,B=_.get(U)-1;S_.set(U,$),_.set(U,B),$||(cS.has(U)||U.removeAttribute(c),cS.delete(U)),B||U.removeAttribute(i)}),SA--,SA||(S_=new WeakMap,S_=new WeakMap,cS=new WeakMap,uS={})}},HV=function(e,t,i){i===void 0&&(i="data-aria-hidden");var c=Array.from(Array.isArray(e)?e:[e]),f=Mre(e);return f?(c.push.apply(c,Array.from(f.querySelectorAll("[aria-live]"))),Nre(c,f,i,"aria-hidden")):function(){return null}},d2="Dialog",[ZV,XV]=Xd(d2),[Ore,uu]=ZV(d2),KV=e=>{const{__scopeDialog:t,children:i,open:c,defaultOpen:f,onOpenChange:_,modal:x=!0}=e,o=V.useRef(null),I=V.useRef(null),[P,N]=Em({prop:c,defaultProp:f??!1,onChange:_,caller:d2});return h.jsx(Ore,{scope:t,triggerRef:o,contentRef:I,contentId:zd(),titleId:zd(),descriptionId:zd(),open:P,onOpenChange:N,onOpenToggle:V.useCallback(()=>N(U=>!U),[N]),modal:x,children:i})};KV.displayName=d2;var YV="DialogTrigger",JV=V.forwardRef((e,t)=>{const{__scopeDialog:i,...c}=e,f=uu(YV,i),_=vs(t,f.triggerRef);return h.jsx(xi.button,{type:"button","aria-haspopup":"dialog","aria-expanded":f.open,"aria-controls":f.contentId,"data-state":mj(f.open),...c,ref:_,onClick:Un(e.onClick,f.onOpenToggle)})});JV.displayName=YV;var fj="DialogPortal",[Lre,QV]=ZV(fj,{forceMount:void 0}),eU=e=>{const{__scopeDialog:t,forceMount:i,children:c,container:f}=e,_=uu(fj,t);return h.jsx(Lre,{scope:t,forceMount:i,children:V.Children.map(c,x=>h.jsx(Bm,{present:i||_.open,children:h.jsx(HT,{asChild:!0,container:f,children:x})}))})};eU.displayName=fj;var ST="DialogOverlay",tU=V.forwardRef((e,t)=>{const i=QV(ST,e.__scopeDialog),{forceMount:c=i.forceMount,...f}=e,_=uu(ST,e.__scopeDialog);return _.modal?h.jsx(Bm,{present:c||_.open,children:h.jsx(Fre,{...f,ref:t})}):null});tU.displayName=ST;var zre=vy("DialogOverlay.RemoveScroll"),Fre=V.forwardRef((e,t)=>{const{__scopeDialog:i,...c}=e,f=uu(ST,i);return h.jsx(hj,{as:zre,allowPinchZoom:!0,shards:[f.contentRef],children:h.jsx(xi.div,{"data-state":mj(f.open),...c,ref:t,style:{pointerEvents:"auto",...c.style}})})}),Rm="DialogContent",rU=V.forwardRef((e,t)=>{const i=QV(Rm,e.__scopeDialog),{forceMount:c=i.forceMount,...f}=e,_=uu(Rm,e.__scopeDialog);return h.jsx(Bm,{present:c||_.open,children:_.modal?h.jsx(Bre,{...f,ref:t}):h.jsx(Vre,{...f,ref:t})})});rU.displayName=Rm;var Bre=V.forwardRef((e,t)=>{const i=uu(Rm,e.__scopeDialog),c=V.useRef(null),f=vs(t,i.contentRef,c);return V.useEffect(()=>{const _=c.current;if(_)return HV(_)},[]),h.jsx(nU,{...e,ref:f,trapFocus:i.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Un(e.onCloseAutoFocus,_=>{var x;_.preventDefault(),(x=i.triggerRef.current)==null||x.focus()}),onPointerDownOutside:Un(e.onPointerDownOutside,_=>{const x=_.detail.originalEvent,o=x.button===0&&x.ctrlKey===!0;(x.button===2||o)&&_.preventDefault()}),onFocusOutside:Un(e.onFocusOutside,_=>_.preventDefault())})}),Vre=V.forwardRef((e,t)=>{const i=uu(Rm,e.__scopeDialog),c=V.useRef(!1),f=V.useRef(!1);return h.jsx(nU,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:_=>{var x,o;(x=e.onCloseAutoFocus)==null||x.call(e,_),_.defaultPrevented||(c.current||(o=i.triggerRef.current)==null||o.focus(),_.preventDefault()),c.current=!1,f.current=!1},onInteractOutside:_=>{var I,P;(I=e.onInteractOutside)==null||I.call(e,_),_.defaultPrevented||(c.current=!0,_.detail.originalEvent.type==="pointerdown"&&(f.current=!0));const x=_.target;((P=i.triggerRef.current)==null?void 0:P.contains(x))&&_.preventDefault(),_.detail.originalEvent.type==="focusin"&&f.current&&_.preventDefault()}})}),nU=V.forwardRef((e,t)=>{const{__scopeDialog:i,trapFocus:c,onOpenAutoFocus:f,onCloseAutoFocus:_,...x}=e,o=uu(Rm,i),I=V.useRef(null),P=vs(t,I);return FV(),h.jsxs(h.Fragment,{children:[h.jsx(dj,{asChild:!0,loop:!0,trapped:c,onMountAutoFocus:f,onUnmountAutoFocus:_,children:h.jsx(gb,{role:"dialog",id:o.contentId,"aria-describedby":o.descriptionId,"aria-labelledby":o.titleId,"data-state":mj(o.open),...x,ref:P,onDismiss:()=>o.onOpenChange(!1)})}),h.jsxs(h.Fragment,{children:[h.jsx($re,{titleId:o.titleId}),h.jsx(Gre,{contentRef:I,descriptionId:o.descriptionId})]})]})}),pj="DialogTitle",iU=V.forwardRef((e,t)=>{const{__scopeDialog:i,...c}=e,f=uu(pj,i);return h.jsx(xi.h2,{id:f.titleId,...c,ref:t})});iU.displayName=pj;var sU="DialogDescription",oU=V.forwardRef((e,t)=>{const{__scopeDialog:i,...c}=e,f=uu(sU,i);return h.jsx(xi.p,{id:f.descriptionId,...c,ref:t})});oU.displayName=sU;var aU="DialogClose",lU=V.forwardRef((e,t)=>{const{__scopeDialog:i,...c}=e,f=uu(aU,i);return h.jsx(xi.button,{type:"button",...c,ref:t,onClick:Un(e.onClick,()=>f.onOpenChange(!1))})});lU.displayName=aU;function mj(e){return e?"open":"closed"}var cU="DialogTitleWarning",[Ure,uU]=X9(cU,{contentName:Rm,titleName:pj,docsSlug:"dialog"}),$re=({titleId:e})=>{const t=uU(cU),i=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return V.useEffect(()=>{e&&(document.getElementById(e)||console.error(i))},[i,e]),null},qre="DialogDescriptionWarning",Gre=({contentRef:e,descriptionId:t})=>{const c=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${uU(qre).contentName}}.`;return V.useEffect(()=>{var _;const f=(_=e.current)==null?void 0:_.getAttribute("aria-describedby");t&&f&&(document.getElementById(t)||console.warn(c))},[c,e,t]),null},gj=KV,dU=JV,_j=eU,Tb=tU,Eb=rU,Cb=iU,Ab=oU,h2=lU;const fo=gj,hU=dU,Wre=_j,fU=V.forwardRef(({className:e,...t},i)=>h.jsx(Tb,{ref:i,className:yr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));fU.displayName=Tb.displayName;const Js=V.forwardRef(({className:e,children:t,...i},c)=>h.jsxs(Wre,{children:[h.jsx(fU,{}),h.jsxs(Eb,{ref:c,className:yr("fixed left-[50%] top-[50%] z-50 grid w-[70vw] max-h-[70vh] translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 overflow-auto data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...i,children:[t,h.jsxs(h2,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[h.jsx(Vm,{className:"h-4 w-4"}),h.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Js.displayName=Eb.displayName;const Qs=({className:e,...t})=>h.jsx("div",{className:yr("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});Qs.displayName="DialogHeader";const eo=V.forwardRef(({className:e,...t},i)=>h.jsx(Cb,{ref:i,className:yr("text-lg font-semibold leading-none tracking-tight",e),...t}));eo.displayName=Cb.displayName;const Yu=V.forwardRef(({className:e,...t},i)=>h.jsx(Ab,{ref:i,className:yr("text-sm text-muted-foreground",e),...t}));Yu.displayName=Ab.displayName;const Hre=Sb({email:sa().trim().email({message:"Email invlido"}).max(255,{message:"Email deve ter no mximo 255 caracteres"})}),Zre=()=>{const[e,t]=V.useState(!1),[i,c]=V.useState(""),[f,_]=V.useState(!1),{toast:x}=$f(),o=async I=>{I.preventDefault(),_(!0);try{const P=Hre.parse({email:i}),{error:N}=await Qe.auth.resetPasswordForEmail(P.email,{redirectTo:`${window.location.origin}/reset-password`});if(N)throw N;x({title:"Email enviado!",description:"Se o email estiver cadastrado, voc receber as instrues para redefinir sua senha."}),c(""),t(!1)}catch(P){P instanceof pc?x({title:"Erro de validao",description:P.errors[0].message,variant:"destructive"}):x({title:"Erro",description:P.message||"No foi possvel enviar o email",variant:"destructive"})}finally{_(!1)}};return h.jsxs(fo,{open:e,onOpenChange:t,children:[h.jsx(hU,{asChild:!0,children:h.jsx("button",{type:"button",className:"text-sm text-primary hover:underline",children:"Esqueci minha senha"})}),h.jsxs(Js,{className:"sm:max-w-md",children:[h.jsxs(Qs,{children:[h.jsx("div",{className:"flex justify-center mb-2",children:h.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:h.jsx(X7,{className:"h-6 w-6 text-primary"})})}),h.jsx(eo,{children:"Recuperar Senha"}),h.jsx(Yu,{children:"Digite seu email para receber as instrues de redefinio de senha."})]}),h.jsxs("form",{onSubmit:o,className:"space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"reset-email",children:"Email"}),h.jsx(_r,{id:"reset-email",type:"email",placeholder:"seu@email.com",value:i,onChange:I=>c(I.target.value),required:!0,disabled:f,maxLength:255})]}),h.jsxs("div",{className:"flex gap-2 justify-end",children:[h.jsx(tr,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:f,children:"Cancelar"}),h.jsx(tr,{type:"submit",disabled:f,children:f?h.jsxs(h.Fragment,{children:[h.jsx(Xu,{className:"mr-2 h-4 w-4 animate-spin"}),"Enviando..."]}):"Enviar Email"})]})]})]})]})},Xre=Sb({email:sa().trim().email({message:"Email invlido"}).max(255,{message:"Email deve ter no mximo 255 caracteres"}),password:sa().min(6,{message:"Senha deve ter no mnimo 6 caracteres"}).max(72,{message:"Senha deve ter no mximo 72 caracteres"}),fullName:sa().trim().min(1,{message:"Nome completo  obrigatrio"}).max(100,{message:"Nome deve ter no mximo 100 caracteres"}),phone:sa().trim().max(20,{message:"Telefone deve ter no mximo 20 caracteres"}).optional()}),Kre=Sb({email:sa().trim().email({message:"Email invlido"}).max(255,{message:"Email deve ter no mximo 255 caracteres"}),password:sa().min(1,{message:"Senha  obrigatria"}).max(72,{message:"Senha deve ter no mximo 72 caracteres"})}),Yre=()=>{const[e,t]=V.useState(!0),[i,c]=V.useState(""),[f,_]=V.useState(""),[x,o]=V.useState(""),[I,P]=V.useState(""),[N,U]=V.useState(!1),$=cu(),{toast:B}=$f();V.useEffect(()=>{Qe.auth.getSession().then(({data:{session:K}})=>{K&&$("/dashboard")});const{data:{subscription:H}}=Qe.auth.onAuthStateChange((K,re)=>{re&&$("/dashboard")});return()=>H.unsubscribe()},[$]);const Y=async H=>{H.preventDefault(),U(!0);try{if(e){const K=Kre.parse({email:i,password:f}),{error:re}=await Qe.auth.signInWithPassword({email:K.email,password:K.password});if(re)throw re;B({title:"Login realizado!",description:"Bem-vindo de volta ao Facilities Hub."}),$("/dashboard")}else{const K=Xre.parse({email:i,password:f,fullName:x,phone:I||void 0}),{error:re,data:G}=await Qe.auth.signUp({email:K.email,password:K.password,options:{emailRedirectTo:`${window.location.origin}/dashboard`,data:{full_name:K.fullName,phone:K.phone}}});if(re)throw re;G.user&&await qte(K.email,K.fullName),B({title:"Cadastro realizado!",description:"Sua conta foi criada com sucesso. Email de boas-vindas enviado!"}),$("/dashboard")}}catch(K){K instanceof pc?B({title:"Erro de validao",description:K.errors[0].message,variant:"destructive"}):B({title:"Erro",description:K.message,variant:"destructive"})}finally{U(!1)}};return h.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary/5 via-background to-accent/5 p-4",children:h.jsxs(kr,{className:"w-full max-w-md shadow-lg",children:[h.jsxs(Mn,{className:"space-y-3 text-center",children:[h.jsx("div",{className:"flex justify-center mb-2",children:h.jsx("div",{className:"p-3 bg-gradient-to-br from-primary to-accent rounded-xl",children:h.jsx(Df,{className:"h-8 w-8 text-primary-foreground"})})}),h.jsx(Zn,{className:"text-2xl font-bold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"Facilities Hub"}),h.jsx(Xa,{children:e?"Entre na sua conta":"Crie sua conta"})]}),h.jsxs(tn,{children:[h.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[!e&&h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"fullName",children:"Nome Completo"}),h.jsx(_r,{id:"fullName",type:"text",placeholder:"Joo Silva",value:x,onChange:H=>o(H.target.value),required:!e,disabled:N,maxLength:100})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"phone",children:"Telefone"}),h.jsx(_r,{id:"phone",type:"tel",placeholder:"(11) 99999-9999",value:I,onChange:H=>P(H.target.value),disabled:N,maxLength:20})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"email",children:"Email"}),h.jsx(_r,{id:"email",type:"email",placeholder:"seu@email.com",value:i,onChange:H=>c(H.target.value),required:!0,disabled:N,maxLength:255})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"password",children:"Senha"}),h.jsx(_r,{id:"password",type:"password",placeholder:"",value:f,onChange:H=>_(H.target.value),required:!0,disabled:N,minLength:6,maxLength:72})]}),h.jsx(tr,{type:"submit",className:"w-full",disabled:N,children:N?h.jsxs(h.Fragment,{children:[h.jsx(Xu,{className:"mr-2 h-4 w-4 animate-spin"}),"Processando..."]}):e?"Entrar":"Cadastrar"})]}),h.jsx("div",{className:"mt-4 text-center",children:e&&h.jsx(Zre,{})}),h.jsx("div",{className:"mt-4 text-center text-sm",children:h.jsx("button",{type:"button",onClick:()=>t(!e),className:"text-primary hover:underline",disabled:N,children:e?"No tem uma conta? Cadastre-se":"J tem uma conta? Faa login"})})]})]})})},TA=768;function Jre(){const[e,t]=V.useState(void 0);return V.useEffect(()=>{const i=window.matchMedia(`(max-width: ${TA-1}px)`),c=()=>{t(window.innerWidth<TA)};return i.addEventListener("change",c),t(window.innerWidth<TA),()=>i.removeEventListener("change",c)},[]),!!e}var Qre="Separator",Rz="horizontal",ene=["horizontal","vertical"],pU=V.forwardRef((e,t)=>{const{decorative:i,orientation:c=Rz,...f}=e,_=tne(c)?c:Rz,o=i?{role:"none"}:{"aria-orientation":_==="vertical"?_:void 0,role:"separator"};return h.jsx(xi.div,{"data-orientation":_,...o,...f,ref:t})});pU.displayName=Qre;function tne(e){return ene.includes(e)}var mU=pU;const ib=V.forwardRef(({className:e,orientation:t="horizontal",decorative:i=!0,...c},f)=>h.jsx(mU,{ref:f,decorative:i,orientation:t,className:yr("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...c}));ib.displayName=mU.displayName;const rne=gj,nne=_j,gU=V.forwardRef(({className:e,...t},i)=>h.jsx(Tb,{className:yr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:i}));gU.displayName=Tb.displayName;const ine=Dy("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),_U=V.forwardRef(({side:e="right",className:t,children:i,...c},f)=>h.jsxs(nne,{children:[h.jsx(gU,{}),h.jsxs(Eb,{ref:f,className:yr(ine({side:e}),t),...c,children:[i,h.jsxs(h2,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[h.jsx(Vm,{className:"h-4 w-4"}),h.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));_U.displayName=Eb.displayName;const sne=V.forwardRef(({className:e,...t},i)=>h.jsx(Cb,{ref:i,className:yr("text-lg font-semibold text-foreground",e),...t}));sne.displayName=Cb.displayName;const one=V.forwardRef(({className:e,...t},i)=>h.jsx(Ab,{ref:i,className:yr("text-sm text-muted-foreground",e),...t}));one.displayName=Ab.displayName;function xP({className:e,...t}){return h.jsx("div",{className:yr("animate-pulse rounded-md bg-muted",e),...t})}const ane="sidebar:state",lne=60*60*24*7,cne="16rem",une="18rem",dne="3rem",hne="b",yU=V.createContext(null);function Ib(){const e=V.useContext(yU);if(!e)throw new Error("useSidebar must be used within a SidebarProvider.");return e}const vU=V.forwardRef(({defaultOpen:e=!0,open:t,onOpenChange:i,className:c,style:f,children:_,...x},o)=>{const I=Jre(),[P,N]=V.useState(!1),[U,$]=V.useState(e),B=t??U,Y=V.useCallback(G=>{const X=typeof G=="function"?G(B):G;i?i(X):$(X),document.cookie=`${ane}=${X}; path=/; max-age=${lne}`},[i,B]),H=V.useCallback(()=>I?N(G=>!G):Y(G=>!G),[I,Y,N]);V.useEffect(()=>{const G=X=>{X.key===hne&&(X.metaKey||X.ctrlKey)&&(X.preventDefault(),H())};return window.addEventListener("keydown",G),()=>window.removeEventListener("keydown",G)},[H]);const K=B?"expanded":"collapsed",re=V.useMemo(()=>({state:K,open:B,setOpen:Y,isMobile:I,openMobile:P,setOpenMobile:N,toggleSidebar:H}),[K,B,Y,I,P,N,H]);return h.jsx(yU.Provider,{value:re,children:h.jsx(o5,{delayDuration:0,children:h.jsx("div",{style:{"--sidebar-width":cne,"--sidebar-width-icon":dne,...f},className:yr("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",c),ref:o,...x,children:_})})})});vU.displayName="SidebarProvider";const xU=V.forwardRef(({side:e="left",variant:t="sidebar",collapsible:i="offcanvas",className:c,children:f,..._},x)=>{const{isMobile:o,state:I,openMobile:P,setOpenMobile:N}=Ib();return i==="none"?h.jsx("div",{className:yr("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",c),ref:x,..._,children:f}):o?h.jsx(rne,{open:P,onOpenChange:N,..._,children:h.jsx(_U,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":une},side:e,children:h.jsx("div",{className:"flex h-full w-full flex-col",children:f})})}):h.jsxs("div",{ref:x,className:"group peer hidden text-sidebar-foreground md:block","data-state":I,"data-collapsible":I==="collapsed"?i:"","data-variant":t,"data-side":e,children:[h.jsx("div",{className:yr("relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",t==="floating"||t==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),h.jsx("div",{className:yr("fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex",e==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",t==="floating"||t==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",c),..._,children:h.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:f})})]})});xU.displayName="Sidebar";const bU=V.forwardRef(({className:e,onClick:t,...i},c)=>{const{toggleSidebar:f}=Ib();return h.jsxs(tr,{ref:c,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:yr("h-7 w-7",e),onClick:_=>{t==null||t(_),f()},...i,children:[h.jsx(Q7,{}),h.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})});bU.displayName="SidebarTrigger";const fne=V.forwardRef(({className:e,...t},i)=>{const{toggleSidebar:c}=Ib();return h.jsx("button",{ref:i,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:c,title:"Toggle Sidebar",className:yr("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] group-data-[side=left]:-right-4 group-data-[side=right]:left-0 hover:after:bg-sidebar-border sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",e),...t})});fne.displayName="SidebarRail";const pne=V.forwardRef(({className:e,...t},i)=>h.jsx("main",{ref:i,className:yr("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",e),...t}));pne.displayName="SidebarInset";const mne=V.forwardRef(({className:e,...t},i)=>h.jsx(_r,{ref:i,"data-sidebar":"input",className:yr("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",e),...t}));mne.displayName="SidebarInput";const gne=V.forwardRef(({className:e,...t},i)=>h.jsx("div",{ref:i,"data-sidebar":"header",className:yr("flex flex-col gap-2 p-2",e),...t}));gne.displayName="SidebarHeader";const _ne=V.forwardRef(({className:e,...t},i)=>h.jsx("div",{ref:i,"data-sidebar":"footer",className:yr("flex flex-col gap-2 p-2",e),...t}));_ne.displayName="SidebarFooter";const yne=V.forwardRef(({className:e,...t},i)=>h.jsx(ib,{ref:i,"data-sidebar":"separator",className:yr("mx-2 w-auto bg-sidebar-border",e),...t}));yne.displayName="SidebarSeparator";const wU=V.forwardRef(({className:e,...t},i)=>h.jsx("div",{ref:i,"data-sidebar":"content",className:yr("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",e),...t}));wU.displayName="SidebarContent";const SU=V.forwardRef(({className:e,...t},i)=>h.jsx("div",{ref:i,"data-sidebar":"group",className:yr("relative flex w-full min-w-0 flex-col p-2",e),...t}));SU.displayName="SidebarGroup";const TU=V.forwardRef(({className:e,asChild:t=!1,...i},c)=>{const f=t?Fm:"div";return h.jsx(f,{ref:c,"data-sidebar":"group-label",className:yr("flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",e),...i})});TU.displayName="SidebarGroupLabel";const vne=V.forwardRef(({className:e,asChild:t=!1,...i},c)=>{const f=t?Fm:"button";return h.jsx(f,{ref:c,"data-sidebar":"group-action",className:yr("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",e),...i})});vne.displayName="SidebarGroupAction";const EU=V.forwardRef(({className:e,...t},i)=>h.jsx("div",{ref:i,"data-sidebar":"group-content",className:yr("w-full text-sm",e),...t}));EU.displayName="SidebarGroupContent";const CU=V.forwardRef(({className:e,...t},i)=>h.jsx("ul",{ref:i,"data-sidebar":"menu",className:yr("flex w-full min-w-0 flex-col gap-1",e),...t}));CU.displayName="SidebarMenu";const bP=V.forwardRef(({className:e,...t},i)=>h.jsx("li",{ref:i,"data-sidebar":"menu-item",className:yr("group/menu-item relative",e),...t}));bP.displayName="SidebarMenuItem";const xne=Dy("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),wP=V.forwardRef(({asChild:e=!1,isActive:t=!1,variant:i="default",size:c="default",tooltip:f,className:_,...x},o)=>{const I=e?Fm:"button",{isMobile:P,state:N}=Ib(),U=h.jsx(I,{ref:o,"data-sidebar":"menu-button","data-size":c,"data-active":t,className:yr(xne({variant:i,size:c}),_),...x});return f?(typeof f=="string"&&(f={children:f}),h.jsxs(lY,{children:[h.jsx(cY,{asChild:!0,children:U}),h.jsx(a5,{side:"right",align:"center",hidden:N!=="collapsed"||P,...f})]})):U});wP.displayName="SidebarMenuButton";const bne=V.forwardRef(({className:e,asChild:t=!1,showOnHover:i=!1,...c},f)=>{const _=t?Fm:"button";return h.jsx(_,{ref:f,"data-sidebar":"menu-action",className:yr("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform peer-hover/menu-button:text-sidebar-accent-foreground hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",i&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",e),...c})});bne.displayName="SidebarMenuAction";const wne=V.forwardRef(({className:e,...t},i)=>h.jsx("div",{ref:i,"data-sidebar":"menu-badge",className:yr("pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",e),...t}));wne.displayName="SidebarMenuBadge";const Sne=V.forwardRef(({className:e,showIcon:t=!1,...i},c)=>{const f=V.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return h.jsxs("div",{ref:c,"data-sidebar":"menu-skeleton",className:yr("flex h-8 items-center gap-2 rounded-md px-2",e),...i,children:[t&&h.jsx(xP,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),h.jsx(xP,{className:"h-4 max-w-[--skeleton-width] flex-1","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":f}})]})});Sne.displayName="SidebarMenuSkeleton";const Tne=V.forwardRef(({className:e,...t},i)=>h.jsx("ul",{ref:i,"data-sidebar":"menu-sub",className:yr("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",e),...t}));Tne.displayName="SidebarMenuSub";const Ene=V.forwardRef(({...e},t)=>h.jsx("li",{ref:t,...e}));Ene.displayName="SidebarMenuSubItem";const Cne=V.forwardRef(({asChild:e=!1,size:t="md",isActive:i,className:c,...f},_)=>{const x=e?Fm:"a";return h.jsx(x,{ref:_,"data-sidebar":"menu-sub-button","data-size":t,"data-active":i,className:yr("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring aria-disabled:pointer-events-none aria-disabled:opacity-50 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",t==="sm"&&"text-xs",t==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",c),...f})});Cne.displayName="SidebarMenuSubButton";const AU=V.forwardRef(({className:e,activeClassName:t,pendingClassName:i,to:c,...f},_)=>h.jsx(UJ,{ref:_,to:c,className:({isActive:x,isPending:o})=>yr(e,x&&t,o&&i),...f}));AU.displayName="NavLink";const Ane=[{title:"Dashboard 24/7",url:"/dashboard-24h",icon:jI},{title:"Dashboard",url:"/dashboard",icon:jI},{title:"Contratos",url:"/contratos",icon:Gd},{title:"Mesa de Operaes",url:"/mesa-operacoes",icon:H7},{title:"Chamados",url:"/chamados",icon:G0},{title:"Ordens de Servio",url:"/ordens-servico",icon:rT},{title:"Colaboradores",url:"/colaboradores",icon:nT},{title:"Diaristas",url:"/diaristas",icon:p4},{title:"Ativos",url:"/ativos",icon:Dd},{title:"Estoque",url:"/estoque",icon:Dd},{title:"Checklists",url:"/checklists",icon:Mk},{title:"Execues de Checklist",url:"/checklist-execucoes",icon:rL},{title:"Responder Checklist",url:"/checklist-respostas",icon:rL}];function Ine(){const{open:e}=Ib(),t=Gf(),i=cu(),c=t.pathname,f=x=>c===x,_=async()=>{await Qe.auth.signOut(),mr.success("Logout realizado com sucesso"),i("/auth")};return h.jsx(xU,{className:e?"w-64":"w-16",collapsible:"icon",children:h.jsx(wU,{children:h.jsxs(SU,{children:[h.jsx(TU,{className:e?"":"hidden",children:"Facilities Center"}),h.jsx(EU,{children:h.jsxs(CU,{children:[Ane.map(x=>h.jsx(bP,{children:h.jsx(wP,{asChild:!0,isActive:f(x.url),children:h.jsxs(AU,{to:x.url,end:!0,className:"flex items-center gap-3 hover:bg-accent",activeClassName:"bg-accent text-accent-foreground font-medium",children:[h.jsx(x.icon,{className:"h-5 w-5"}),e&&h.jsx("span",{children:x.title})]})})},x.title)),h.jsx(bP,{children:h.jsxs(wP,{onClick:_,children:[h.jsx(Y7,{className:"h-5 w-5"}),e&&h.jsx("span",{children:"Sair"})]})})]})})]})})})}function $o({children:e}){return h.jsx(vU,{defaultOpen:!0,children:h.jsxs("div",{className:"min-h-screen flex w-full",children:[h.jsx(Ine,{}),h.jsxs("div",{className:"flex-1 flex flex-col",children:[h.jsx("header",{className:"h-14 border-b flex items-center px-4 bg-background sticky top-0 z-10",children:h.jsx(bU,{})}),h.jsx("main",{className:"flex-1 overflow-auto",children:e})]})]})})}const Pne=()=>{const[e,t]=V.useState(null),[i,c]=V.useState(null),[f,_]=V.useState(!0),x=cu(),{toast:o}=$f();V.useEffect(()=>{I();const{data:{subscription:U}}=Qe.auth.onAuthStateChange(async($,B)=>{if($==="SIGNED_IN"&&B){t(B.user);const{data:Y}=await Qe.from("user_roles").select("role").eq("user_id",B.user.id).single();Y&&c(Y.role),_(!1)}else $==="SIGNED_OUT"&&x("/auth")});return()=>U.unsubscribe()},[]);const I=async()=>{try{const{data:{user:U}}=await Qe.auth.getUser();if(!U){x("/auth");return}t(U);const{data:$}=await Qe.from("user_roles").select("role").eq("user_id",U.id).single();$&&c($.role)}catch(U){console.error("Error checking user:",U)}finally{_(!1)}};if(f)return h.jsx("div",{className:"min-h-screen flex items-center justify-center",children:h.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})});const P={admin:"Administrador",gestor_operacoes:"Gestor de Operaes",supervisor:"Supervisor",analista_centro_controle:"Analista do Centro de Controle",tecnico:"Tcnico",cliente_view:"Cliente (Visualizao)"},N=[{title:"Dashboard 24/7",description:"Resumo executivo e alertas em tempo real",icon:kI,color:"from-blue-500 to-cyan-500",action:()=>x("/dashboard-24h")},{title:"Gesto de Contratos",description:"Clientes, contratos, unidades e postos",icon:Df,color:"from-purple-500 to-pink-500",action:()=>x("/contratos")},{title:"Mesa de Operaes",description:"Mapa operacional e monitoramento 24/7",icon:Nf,color:"from-green-500 to-emerald-500",action:()=>x("/mesa-operacoes")},{title:"Chamados",description:"Sistema de abertura e acompanhamento",icon:G0,color:"from-orange-500 to-amber-500",action:()=>x("/chamados")},{title:"Ordens de Servio",description:"Preventivas, corretivas e emergenciais",icon:Gd,color:"from-indigo-500 to-purple-500",action:()=>x("/ordens-servico")},{title:"Incidentes",description:"Registro e investigao de incidentes",icon:vm,color:"from-red-500 to-rose-500",action:()=>o({title:"Em desenvolvimento",description:"Mdulo em breve!"})},{title:"Checklists",description:"Checklists e auditorias",icon:yb,color:"from-teal-500 to-cyan-500",action:()=>x("/checklists")},{title:"Recursos",description:"Materiais, equipamentos e veculos",icon:Dd,color:"from-violet-500 to-purple-500",action:()=>x("/estoque")},{title:"Colaboradores",description:"Gesto de pessoal e escalas",icon:Ld,color:"from-blue-500 to-indigo-500",action:()=>x("/colaboradores")},{title:"QSMMA",description:"Qualidade, Segurana, Meio Ambiente e Sade",icon:Nk,color:"from-emerald-500 to-green-500",action:()=>o({title:"Em desenvolvimento",description:"Mdulo em breve!"})},{title:"Portal do Cliente",description:"rea restrita para clientes",icon:Dk,color:"from-pink-500 to-rose-500",action:()=>o({title:"Em desenvolvimento",description:"Mdulo em breve!"})},{title:"Configuraes",description:"Configuraes do sistema",icon:nZ,color:"from-gray-500 to-slate-500",action:()=>o({title:"Em desenvolvimento",description:"Mdulo em breve!"})}];return h.jsx($o,{children:h.jsxs("div",{className:"min-h-screen bg-background",children:[h.jsx("header",{className:"border-b bg-card shadow-sm",children:h.jsx("div",{className:"container mx-auto px-4 py-4",children:h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("div",{className:"p-2 bg-gradient-to-br from-primary to-accent rounded-lg",children:h.jsx(Df,{className:"h-6 w-6 text-primary-foreground"})}),h.jsxs("div",{children:[h.jsx("h1",{className:"text-xl font-bold",children:"Facilities Center"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Sistema de Gesto de Facilities"})]})]})})}),h.jsxs("main",{className:"container mx-auto px-4 py-8",children:[h.jsxs("div",{className:"mb-8",children:[h.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[h.jsx(jI,{className:"h-6 w-6 text-primary"}),h.jsx("h2",{className:"text-2xl font-bold",children:"Dashboard"})]}),h.jsxs("p",{className:"text-muted-foreground",children:["Bem-vindo, ",e==null?void 0:e.email,"  Perfil: ",P[i||""]||i]})]}),h.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:N.map((U,$)=>h.jsx(kr,{className:"cursor-pointer hover:shadow-lg transition-all duration-300 hover:-translate-y-1",onClick:U.action,children:h.jsxs(Mn,{children:[h.jsx("div",{className:`w-12 h-12 rounded-lg bg-gradient-to-br ${U.color} flex items-center justify-center mb-4`,children:h.jsx(U.icon,{className:"h-6 w-6 text-white"})}),h.jsx(Zn,{className:"text-lg",children:U.title}),h.jsx(Xa,{children:U.description})]})},$))}),h.jsxs("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-4 gap-6",children:[h.jsx(kr,{children:h.jsxs(Mn,{children:[h.jsxs("div",{className:"flex items-center justify-between mb-2",children:[h.jsx(Zn,{className:"text-sm font-medium text-muted-foreground",children:"SLA do Dia"}),h.jsx(kI,{className:"h-5 w-5 text-green-600"})]}),h.jsx("p",{className:"text-3xl font-bold text-green-600",children:"0%"})]})}),h.jsx(kr,{children:h.jsxs(Mn,{children:[h.jsxs("div",{className:"flex items-center justify-between mb-2",children:[h.jsx(Zn,{className:"text-sm font-medium text-muted-foreground",children:"Chamados Abertos"}),h.jsx(G0,{className:"h-5 w-5 text-primary"})]}),h.jsx("p",{className:"text-3xl font-bold",children:"0"})]})}),h.jsx(kr,{children:h.jsxs(Mn,{children:[h.jsxs("div",{className:"flex items-center justify-between mb-2",children:[h.jsx(Zn,{className:"text-sm font-medium text-muted-foreground",children:"Incidentes Crticos"}),h.jsx(vm,{className:"h-5 w-5 text-red-600"})]}),h.jsx("p",{className:"text-3xl font-bold text-red-600",children:"0"})]})}),h.jsx(kr,{children:h.jsxs(Mn,{children:[h.jsxs("div",{className:"flex items-center justify-between mb-2",children:[h.jsx(Zn,{className:"text-sm font-medium text-muted-foreground",children:"Postos Cobertos"}),h.jsx(Ld,{className:"h-5 w-5 text-primary"})]}),h.jsx("p",{className:"text-3xl font-bold",children:"0/0"})]})})]})]})]})})},kne=Dy("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function ai({className:e,variant:t,...i}){return h.jsx("div",{className:yr(kne({variant:t}),e),...i})}const jne=4,Rne=e=>e?e.trim().toLowerCase()==="12x36":!1,Py=e=>{const t=e.efetivo_planejado&&e.efetivo_planejado>0?e.efetivo_planejado:1;return Rne(e.escala)?Math.max(t,jne):t},SP=(e,t)=>{const i=Py(t),c=Math.min(e,i);return{efetivoNecessario:i,efetivoConsiderado:c,estaCoberto:e>=i}};var IU={exports:{}};(function(e,t){(function(i,c){e.exports=c()})(yW,function(){var i,c,f;function _(o,I){if(!i)i=I;else if(!c)c=I;else{var P="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+i+")(sharedChunk); ("+c+")(sharedChunk); self.onerror = null;",N={};i(N),f=I(N),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(f.workerUrl=window.URL.createObjectURL(new Blob([P],{type:"text/javascript"})))}}_(["exports"],function(o){var I=1e-6,P=typeof Float32Array<"u"?Float32Array:Array;function N(a,r){var s=r[0],u=r[1],d=r[2],g=r[3],y=s*g-d*u;return y?(a[0]=g*(y=1/y),a[1]=-u*y,a[2]=-d*y,a[3]=s*y,a):null}function U(){var a=new P(9);return P!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function $(a,r){var s=r[0],u=r[1],d=r[2],g=r[3],y=r[4],b=r[5],T=r[6],E=r[7],k=r[8];return a[0]=y*k-b*E,a[1]=d*E-u*k,a[2]=u*b-d*y,a[3]=b*T-g*k,a[4]=s*k-d*T,a[5]=d*g-s*b,a[6]=g*E-y*T,a[7]=u*T-s*E,a[8]=s*y-u*g,a}function B(a,r,s){var u=r[0],d=r[1],g=r[2],y=r[3],b=r[4],T=r[5],E=r[6],k=r[7],j=r[8],R=s[0],L=s[1],z=s[2],W=s[3],J=s[4],ee=s[5],oe=s[6],le=s[7],de=s[8];return a[0]=R*u+L*y+z*E,a[1]=R*d+L*b+z*k,a[2]=R*g+L*T+z*j,a[3]=W*u+J*y+ee*E,a[4]=W*d+J*b+ee*k,a[5]=W*g+J*T+ee*j,a[6]=oe*u+le*y+de*E,a[7]=oe*d+le*b+de*k,a[8]=oe*g+le*T+de*j,a}function Y(){var a=new P(16);return P!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a}function H(a){var r=new P(16);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=a[3],r[4]=a[4],r[5]=a[5],r[6]=a[6],r[7]=a[7],r[8]=a[8],r[9]=a[9],r[10]=a[10],r[11]=a[11],r[12]=a[12],r[13]=a[13],r[14]=a[14],r[15]=a[15],r}function K(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function re(a,r){var s=r[0],u=r[1],d=r[2],g=r[3],y=r[4],b=r[5],T=r[6],E=r[7],k=r[8],j=r[9],R=r[10],L=r[11],z=r[12],W=r[13],J=r[14],ee=r[15],oe=s*b-u*y,le=s*T-d*y,de=s*E-g*y,Se=u*T-d*b,_e=u*E-g*b,Ae=d*E-g*T,ke=k*W-j*z,De=k*J-R*z,at=k*ee-L*z,Ue=j*J-R*W,ct=j*ee-L*W,pt=R*ee-L*J,bt=oe*pt-le*ct+de*Ue+Se*at-_e*De+Ae*ke;return bt?(a[0]=(b*pt-T*ct+E*Ue)*(bt=1/bt),a[1]=(d*ct-u*pt-g*Ue)*bt,a[2]=(W*Ae-J*_e+ee*Se)*bt,a[3]=(R*_e-j*Ae-L*Se)*bt,a[4]=(T*at-y*pt-E*De)*bt,a[5]=(s*pt-d*at+g*De)*bt,a[6]=(J*de-z*Ae-ee*le)*bt,a[7]=(k*Ae-R*de+L*le)*bt,a[8]=(y*ct-b*at+E*ke)*bt,a[9]=(u*at-s*ct-g*ke)*bt,a[10]=(z*_e-W*de+ee*oe)*bt,a[11]=(j*de-k*_e-L*oe)*bt,a[12]=(b*De-y*Ue-T*ke)*bt,a[13]=(s*Ue-u*De+d*ke)*bt,a[14]=(W*le-z*Se-J*oe)*bt,a[15]=(k*Se-j*le+R*oe)*bt,a):null}function G(a,r,s){var u=r[0],d=r[1],g=r[2],y=r[3],b=r[4],T=r[5],E=r[6],k=r[7],j=r[8],R=r[9],L=r[10],z=r[11],W=r[12],J=r[13],ee=r[14],oe=r[15],le=s[0],de=s[1],Se=s[2],_e=s[3];return a[0]=le*u+de*b+Se*j+_e*W,a[1]=le*d+de*T+Se*R+_e*J,a[2]=le*g+de*E+Se*L+_e*ee,a[3]=le*y+de*k+Se*z+_e*oe,a[4]=(le=s[4])*u+(de=s[5])*b+(Se=s[6])*j+(_e=s[7])*W,a[5]=le*d+de*T+Se*R+_e*J,a[6]=le*g+de*E+Se*L+_e*ee,a[7]=le*y+de*k+Se*z+_e*oe,a[8]=(le=s[8])*u+(de=s[9])*b+(Se=s[10])*j+(_e=s[11])*W,a[9]=le*d+de*T+Se*R+_e*J,a[10]=le*g+de*E+Se*L+_e*ee,a[11]=le*y+de*k+Se*z+_e*oe,a[12]=(le=s[12])*u+(de=s[13])*b+(Se=s[14])*j+(_e=s[15])*W,a[13]=le*d+de*T+Se*R+_e*J,a[14]=le*g+de*E+Se*L+_e*ee,a[15]=le*y+de*k+Se*z+_e*oe,a}function X(a,r,s){var u,d,g,y,b,T,E,k,j,R,L,z,W=s[0],J=s[1],ee=s[2];return r===a?(a[12]=r[0]*W+r[4]*J+r[8]*ee+r[12],a[13]=r[1]*W+r[5]*J+r[9]*ee+r[13],a[14]=r[2]*W+r[6]*J+r[10]*ee+r[14],a[15]=r[3]*W+r[7]*J+r[11]*ee+r[15]):(d=r[1],g=r[2],y=r[3],b=r[4],T=r[5],E=r[6],k=r[7],j=r[8],R=r[9],L=r[10],z=r[11],a[0]=u=r[0],a[1]=d,a[2]=g,a[3]=y,a[4]=b,a[5]=T,a[6]=E,a[7]=k,a[8]=j,a[9]=R,a[10]=L,a[11]=z,a[12]=u*W+b*J+j*ee+r[12],a[13]=d*W+T*J+R*ee+r[13],a[14]=g*W+E*J+L*ee+r[14],a[15]=y*W+k*J+z*ee+r[15]),a}function ue(a,r,s){var u=s[0],d=s[1],g=s[2];return a[0]=r[0]*u,a[1]=r[1]*u,a[2]=r[2]*u,a[3]=r[3]*u,a[4]=r[4]*d,a[5]=r[5]*d,a[6]=r[6]*d,a[7]=r[7]*d,a[8]=r[8]*g,a[9]=r[9]*g,a[10]=r[10]*g,a[11]=r[11]*g,a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15],a}function Ee(a,r,s){var u=Math.sin(s),d=Math.cos(s),g=r[4],y=r[5],b=r[6],T=r[7],E=r[8],k=r[9],j=r[10],R=r[11];return r!==a&&(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[4]=g*d+E*u,a[5]=y*d+k*u,a[6]=b*d+j*u,a[7]=T*d+R*u,a[8]=E*d-g*u,a[9]=k*d-y*u,a[10]=j*d-b*u,a[11]=R*d-T*u,a}function xe(a,r,s){var u=Math.sin(s),d=Math.cos(s),g=r[0],y=r[1],b=r[2],T=r[3],E=r[8],k=r[9],j=r[10],R=r[11];return r!==a&&(a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[0]=g*d-E*u,a[1]=y*d-k*u,a[2]=b*d-j*u,a[3]=T*d-R*u,a[8]=g*u+E*d,a[9]=y*u+k*d,a[10]=b*u+j*d,a[11]=T*u+R*d,a}function Ne(a,r,s){var u=Math.sin(s),d=Math.cos(s),g=r[0],y=r[1],b=r[2],T=r[3],E=r[4],k=r[5],j=r[6],R=r[7];return r!==a&&(a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[0]=g*d+E*u,a[1]=y*d+k*u,a[2]=b*d+j*u,a[3]=T*d+R*u,a[4]=E*d-g*u,a[5]=k*d-y*u,a[6]=j*d-b*u,a[7]=R*d-T*u,a}function lt(a,r){return a[0]=r[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=r[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=r[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Pt(a,r,s){var u,d,g,y=s[0],b=s[1],T=s[2],E=Math.sqrt(y*y+b*b+T*T);return E<I?null:(y*=E=1/E,b*=E,T*=E,u=Math.sin(r),d=Math.cos(r),a[0]=y*y*(g=1-d)+d,a[1]=b*y*g+T*u,a[2]=T*y*g-b*u,a[3]=0,a[4]=y*b*g-T*u,a[5]=b*b*g+d,a[6]=T*b*g+y*u,a[7]=0,a[8]=y*T*g+b*u,a[9]=b*T*g-y*u,a[10]=T*T*g+d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}function tt(a,r){var s=r[0],u=r[1],d=r[2],g=r[4],y=r[5],b=r[6],T=r[8],E=r[9],k=r[10];return a[0]=Math.sqrt(s*s+u*u+d*d),a[1]=Math.sqrt(g*g+y*y+b*b),a[2]=Math.sqrt(T*T+E*E+k*k),a}function yt(a,r){var s=r[0],u=r[1],d=r[2],g=r[3],y=s+s,b=u+u,T=d+d,E=s*y,k=u*y,j=u*b,R=d*y,L=d*b,z=d*T,W=g*y,J=g*b,ee=g*T;return a[0]=1-j-z,a[1]=k+ee,a[2]=R-J,a[3]=0,a[4]=k-ee,a[5]=1-E-z,a[6]=L+W,a[7]=0,a[8]=R+J,a[9]=L-W,a[10]=1-E-j,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}var Me=G;function be(){var a=new P(3);return P!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function je(a){var r=new P(3);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r}function Ye(a){var r=a[0],s=a[1],u=a[2];return Math.sqrt(r*r+s*s+u*u)}function qe(a,r,s){var u=new P(3);return u[0]=a,u[1]=r,u[2]=s,u}function We(a,r,s,u){return a[0]=r,a[1]=s,a[2]=u,a}function $e(a,r,s){return a[0]=r[0]+s[0],a[1]=r[1]+s[1],a[2]=r[2]+s[2],a}function _t(a,r,s){return a[0]=r[0]-s[0],a[1]=r[1]-s[1],a[2]=r[2]-s[2],a}function mt(a,r,s){return a[0]=r[0]*s[0],a[1]=r[1]*s[1],a[2]=r[2]*s[2],a}function rt(a,r,s){return a[0]=Math.min(r[0],s[0]),a[1]=Math.min(r[1],s[1]),a[2]=Math.min(r[2],s[2]),a}function Tt(a,r,s){return a[0]=Math.max(r[0],s[0]),a[1]=Math.max(r[1],s[1]),a[2]=Math.max(r[2],s[2]),a}function Vt(a,r,s){return a[0]=r[0]*s,a[1]=r[1]*s,a[2]=r[2]*s,a}function it(a,r,s,u){return a[0]=r[0]+s[0]*u,a[1]=r[1]+s[1]*u,a[2]=r[2]+s[2]*u,a}function ir(a,r){var s=r[0]-a[0],u=r[1]-a[1],d=r[2]-a[2];return Math.sqrt(s*s+u*u+d*d)}function wr(a,r){var s=r[0]-a[0],u=r[1]-a[1],d=r[2]-a[2];return s*s+u*u+d*d}function Bt(a){var r=a[0],s=a[1],u=a[2];return r*r+s*s+u*u}function Wr(a,r){return a[0]=-r[0],a[1]=-r[1],a[2]=-r[2],a}function Er(a,r){var s=r[0],u=r[1],d=r[2],g=s*s+u*u+d*d;return g>0&&(g=1/Math.sqrt(g)),a[0]=r[0]*g,a[1]=r[1]*g,a[2]=r[2]*g,a}function Vr(a,r){return a[0]*r[0]+a[1]*r[1]+a[2]*r[2]}function Ur(a,r,s){var u=r[0],d=r[1],g=r[2],y=s[0],b=s[1],T=s[2];return a[0]=d*T-g*b,a[1]=g*y-u*T,a[2]=u*b-d*y,a}function jn(a,r,s,u){var d=r[0],g=r[1],y=r[2];return a[0]=d+u*(s[0]-d),a[1]=g+u*(s[1]-g),a[2]=y+u*(s[2]-y),a}function yn(a,r,s){var u=r[0],d=r[1],g=r[2],y=s[3]*u+s[7]*d+s[11]*g+s[15];return a[0]=(s[0]*u+s[4]*d+s[8]*g+s[12])/(y=y||1),a[1]=(s[1]*u+s[5]*d+s[9]*g+s[13])/y,a[2]=(s[2]*u+s[6]*d+s[10]*g+s[14])/y,a}function os(a,r,s){var u=r[0],d=r[1],g=r[2];return a[0]=u*s[0]+d*s[3]+g*s[6],a[1]=u*s[1]+d*s[4]+g*s[7],a[2]=u*s[2]+d*s[5]+g*s[8],a}function qi(a,r,s){var u=s[0],d=s[1],g=s[2],y=s[3],b=r[0],T=r[1],E=r[2],k=d*E-g*T,j=g*b-u*E,R=u*T-d*b;return a[0]=b+y*(k+=k)+d*(R+=R)-g*(j+=j),a[1]=T+y*j+g*k-u*R,a[2]=E+y*R+u*j-d*k,a}function ps(a){return a[0]=0,a[1]=0,a[2]=0,a}function Os(a,r){return a[0]===r[0]&&a[1]===r[1]&&a[2]===r[2]}var Ei=_t,po=mt,et=Ye;function Et(){var a=new P(4);return P!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0),a}function Wt(a,r,s){return a[0]=r[0]*s,a[1]=r[1]*s,a[2]=r[2]*s,a[3]=r[3]*s,a}function Ar(a,r){var s=r[0],u=r[1],d=r[2],g=r[3],y=s*s+u*u+d*d+g*g;return y>0&&(y=1/Math.sqrt(y)),a[0]=s*y,a[1]=u*y,a[2]=d*y,a[3]=g*y,a}function pr(a,r,s){var u=r[0],d=r[1],g=r[2],y=r[3];return a[0]=s[0]*u+s[4]*d+s[8]*g+s[12]*y,a[1]=s[1]*u+s[5]*d+s[9]*g+s[13]*y,a[2]=s[2]*u+s[6]*d+s[10]*g+s[14]*y,a[3]=s[3]*u+s[7]*d+s[11]*g+s[15]*y,a}function gr(){var a=new P(4);return P!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function Or(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function Ln(a,r,s){s*=.5;var u=r[0],d=r[1],g=r[2],y=r[3],b=Math.sin(s),T=Math.cos(s);return a[0]=u*T+y*b,a[1]=d*T+g*b,a[2]=g*T-d*b,a[3]=y*T-u*b,a}function gi(a,r,s){s*=.5;var u=r[0],d=r[1],g=r[2],y=r[3],b=Math.sin(s),T=Math.cos(s);return a[0]=u*T-g*b,a[1]=d*T+y*b,a[2]=g*T+u*b,a[3]=y*T-d*b,a}be(),Et();var Fi,to,Ss,ua=Ar,jo=(Fi=be(),to=qe(1,0,0),Ss=qe(0,1,0),function(a,r,s){var u=Vr(r,s);return u<-.999999?(Ur(Fi,to,r),et(Fi)<1e-6&&Ur(Fi,Ss,r),Er(Fi,Fi),function(d,g,y){y*=.5;var b=Math.sin(y);d[0]=b*g[0],d[1]=b*g[1],d[2]=b*g[2],d[3]=Math.cos(y)}(a,Fi,Math.PI),a):u>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(Ur(Fi,r,s),a[0]=Fi[0],a[1]=Fi[1],a[2]=Fi[2],a[3]=1+u,ua(a,a))});function Yt(){var a=new P(2);return P!=Float32Array&&(a[0]=0,a[1]=0),a}function $n(a,r){var s=new P(2);return s[0]=a,s[1]=r,s}function as(a,r,s){return a[0]=r,a[1]=s,a}function Ts(a,r,s){return a[0]=r[0]+s[0],a[1]=r[1]+s[1],a}function bi(a,r,s){return a[0]=r[0]-s[0],a[1]=r[1]-s[1],a}function rs(a,r,s){return a[0]=r[0]*s,a[1]=r[1]*s,a}function fi(a){var r=a[0],s=a[1];return Math.sqrt(r*r+s*s)}function ro(a,r){var s=r[0],u=r[1],d=s*s+u*u;return d>0&&(d=1/Math.sqrt(d)),a[0]=r[0]*d,a[1]=r[1]*d,a}function Cl(a,r){return a[0]*r[0]+a[1]*r[1]}gr(),gr(),U();var Ro,Yo,qn=bi;function Ni(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}Yt();var ls=function(){if(Yo)return Ro;function a(r,s,u,d){this.cx=3*r,this.bx=3*(u-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(d-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=s,this.p2x=u,this.p2y=d}return Yo=1,Ro=a,a.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,s){if(s===void 0&&(s=1e-6),r<0)return 0;if(r>1)return 1;for(var u=r,d=0;d<8;d++){var g=this.sampleCurveX(u)-r;if(Math.abs(g)<s)return u;var y=this.sampleCurveDerivativeX(u);if(Math.abs(y)<1e-6)break;u-=g/y}var b=0,T=1;for(u=r,d=0;d<20&&(g=this.sampleCurveX(u),!(Math.abs(g-r)<s));d++)r>g?b=u:T=u,u=.5*(T-b)+b;return u},solve:function(r,s){return this.sampleCurveY(this.solveCurveX(r,s))}},Ro}(),bo=Ni(ls);function xt(a,r){this.x=a,this.y=r}function wo(a,r){if(Array.isArray(a)){if(!Array.isArray(r)||a.length!==r.length)return!1;for(let s=0;s<a.length;s++)if(!wo(a[s],r[s]))return!1;return!0}if(typeof a=="object"&&a!==null&&r!==null){if(typeof r!="object"||Object.keys(a).length!==Object.keys(r).length)return!1;for(const s in a)if(!wo(a[s],r[s]))return!1;return!0}return a===r}xt.prototype={clone(){return new xt(this.x,this.y)},add(a){return this.clone()._add(a)},sub(a){return this.clone()._sub(a)},multByPoint(a){return this.clone()._multByPoint(a)},divByPoint(a){return this.clone()._divByPoint(a)},mult(a){return this.clone()._mult(a)},div(a){return this.clone()._div(a)},rotate(a){return this.clone()._rotate(a)},rotateAround(a,r){return this.clone()._rotateAround(a,r)},matMult(a){return this.clone()._matMult(a)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(a){return this.x===a.x&&this.y===a.y},dist(a){return Math.sqrt(this.distSqr(a))},distSqr(a){const r=a.x-this.x,s=a.y-this.y;return r*r+s*s},angle(){return Math.atan2(this.y,this.x)},angleTo(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith(a){return this.angleWithSep(a.x,a.y)},angleWithSep(a,r){return Math.atan2(this.x*r-this.y*a,this.x*a+this.y*r)},_matMult(a){const r=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=r,this},_add(a){return this.x+=a.x,this.y+=a.y,this},_sub(a){return this.x-=a.x,this.y-=a.y,this},_mult(a){return this.x*=a,this.y*=a,this},_div(a){return this.x/=a,this.y/=a,this},_multByPoint(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint(a){return this.x/=a.x,this.y/=a.y,this},_unit(){return this._div(this.mag()),this},_perp(){const a=this.y;return this.y=this.x,this.x=-a,this},_rotate(a){const r=Math.cos(a),s=Math.sin(a),u=s*this.x+r*this.y;return this.x=r*this.x-s*this.y,this.y=u,this},_rotateAround(a,r){const s=Math.cos(a),u=Math.sin(a),d=r.y+u*(this.x-r.x)+s*(this.y-r.y);return this.x=r.x+s*(this.x-r.x)-u*(this.y-r.y),this.y=d,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:xt},xt.convert=function(a){if(a instanceof xt)return a;if(Array.isArray(a))return new xt(+a[0],+a[1]);if(a.x!==void 0&&a.y!==void 0)return new xt(+a.x,+a.y);throw new Error("Expected [x, y] or {x, y} point format")};const Ea=Math.PI/180,Mo=180/Math.PI;function ln(a){return a*Ea}function Do(a){return a*Mo}const qy=[[0,0],[1,0],[1,1],[0,1]];function Kf(a){if(a<=0)return 0;if(a>=1)return 1;const r=a*a,s=r*a;return 4*(a<.5?s:3*(a-r)+s-.75)}function Be(a,r,s,u){const d=new bo(a,r,s,u);return function(g){return d.solve(g)}}const te=Be(.25,.1,.25,1);function ie(a,r,s){return Math.min(s,Math.max(r,a))}function me(a,r,s){return(s=ie((s-a)/(r-a),0,1))*s*(3-2*s)}function Pe(a,r,s){const u=s-r,d=((a-r)%u+u)%u+r;return d===r?s:d}function Ie(a,r,s){if(!a.length)return s(null,[]);let u=a.length;const d=new Array(a.length);let g=null;a.forEach((y,b)=>{r(y,(T,E)=>{T&&(g=T),d[b]=E,--u==0&&s(g,d)})})}let Le=1;function Je(){return Le++}function ze(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log2(a)))}function Xe(a,r){a.forEach(s=>{r[s]&&(r[s]=r[s].bind(r))})}function Dt(a,r,s){const u={};for(const d in a)u[d]=r.call(this,a[d],d,a);return u}function Ct(a,r,s){const u={};for(const d in a)r.call(this,a[d],d,a)&&(u[d]=a[d]);return u}function dr(a){return Array.isArray(a)?a.map(dr):typeof a=="object"&&a?Dt(a,dr):a}function Lr(a,r){for(let s=0;s<a.length;s++)if(r.indexOf(a[s])>=0)return!0;return!1}const Mr={};function br(a){Mr[a]||(typeof console<"u"&&console.warn(a),Mr[a]=!0)}function rn(a,r,s){return(s.y-a.y)*(r.x-a.x)>(r.y-a.y)*(s.x-a.x)}function hn(a){let r=0;for(let s,u,d=0,g=a.length,y=g-1;d<g;y=d++)s=a[d],u=a[y],r+=(u.x-s.x)*(s.y+u.y);return r}function si([a,r,s]){const u=ln(r+90),d=ln(s);return{x:a*Math.cos(u)*Math.sin(d),y:a*Math.sin(u)*Math.sin(d),z:a*Math.cos(d),azimuthal:r,polar:s}}function Xi(a){return(typeof self<"u"||a!==void 0)&&typeof WorkerGlobalScope<"u"&&(a!==void 0?a:self)instanceof WorkerGlobalScope}function xs(a){const r={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,u,d,g)=>{const y=d||g;return r[u]=!y||y.toLowerCase(),""}),r["max-age"]){const s=parseInt(r["max-age"],10);isNaN(s)?delete r["max-age"]:r["max-age"]=s}return r}let cs=null;function ns(a,r){return[a[4*r],a[4*r+1],a[4*r+2],a[4*r+3]]}function ni(a,r,s,u){for(;r<s;){const d=r+s>>1;a[d]<u?r=d+1:s=d}return r}function wn(a,r,s,u){for(;r<s;){const d=r+s>>1;a[d]<=u?r=d+1:s=d}return r}function Ci(a){return a>0?1/(1.001-a):1+a}function Gi(a){return a>0?1-1/(1.001-a):-a}function li(a,r,s){return(a-r.min)*(s.max-s.min)/(r.max-r.min)+s.min}const Ai={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Ai.API_URL)return null;try{const a=new URL(Ai.API_URL);return a.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":a.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function ks(a){return Ai.API_URL_REGEX.test(a)}function No(a){return Ai.API_SPRITE_REGEX.test(a)}let Qa,Ju,Ls,el,qo,Al;function da(){return Qa==null&&(Qa=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Qa}const ha={now:()=>el!==void 0?el:performance.now(),setNow(a){el=a},restoreNow(){el=void 0},frame(a){const r=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(r)}},getImageData(a,r=0){const{width:s,height:u}=a;qo||(qo=document.createElement("canvas"));const d=qo.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return(s>qo.width||u>qo.height)&&(qo.width=s,qo.height=u),d.clearRect(-r,-r,s+2*r,u+2*r),d.drawImage(a,0,0,s,u),d.getImageData(-r,-r,s+2*r,u+2*r)},resolveURL:a=>(Ju||(Ju=document.createElement("a")),Ju.href=a,Ju.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ls==null&&(Ls=window.matchMedia("(prefers-reduced-motion: reduce)")),Ls.matches)},hasCanvasFingerprintNoise(){if(Al!==void 0)return Al;if(!da())return Al=!1,!1;const a=new OffscreenCanvas(85,1),r=a.getContext("2d",{willReadFrequently:!0});let s=0;for(let d=0;d<a.width;++d)r.fillStyle=`rgba(${s++},${s++},${s++}, 255)`,r.fillRect(d,0,1,1);const u=r.getImageData(0,0,a.width,a.height);s=0;for(let d=0;d<u.data.length;++d)if(d%4!=3&&s++!==u.data[d])return Al=!0,!0;return Al=!1,!1}};function Um(a,r){const s=a.indexOf("?");if(s<0)return`${a}?${new URLSearchParams(r).toString()}`;const u=new URLSearchParams(a.slice(s));for(const d in r)u.set(d,r[d]);return`${a.slice(0,s)}?${u.toString()}`}function Yf(a,r={persistentParams:[]}){const s=a.indexOf("?");if(s<0)return a;const u=new URLSearchParams,d=new URLSearchParams(a.slice(s));for(const y of r.persistentParams){const b=d.get(y);b&&u.set(y,b)}const g=u.toString();return`${a.slice(0,s)}${g.length>0?`?${g}`:""}`}const Jf="mapbox-tiles";let Qf=500,Jo=50;const Il=["language","worldview","jobid"];let Go,Ca;function _c(){try{return caches}catch{}}function Qu(){const a=_c();a&&Go==null&&(Go=a.open(Jf))}let $m=1/0;const qm={supported:!1,testSupport:function(a){!Gy&&du&&(Ob?Wy(a):Xl=a)}};let Xl,du,Gy=!1,Ob=!1;const tl=typeof self<"u"?self:{};function Wy(a){const r=a.createTexture();a.bindTexture(a.TEXTURE_2D,r);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,du),a.isContextLost())return;qm.supported=!0}catch{}a.deleteTexture(r),Gy=!0}tl.document&&(du=tl.document.createElement("img"),du.onload=function(){Xl&&Wy(Xl),Xl=null,Ob=!0},du.onerror=function(){Gy=!0,Xl=null},du.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ed={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(ed);class td extends Error{constructor(r,s,u){s===401&&ks(u)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=s,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Hy=Xi()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,ep=function(a,r){if(!(/^file:/.test(s=a.url)||/^file:/.test(Hy())&&!/^\w+:/.test(s))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,d){const g=new AbortController,y=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:Hy(),referrerPolicy:u.referrerPolicy,signal:g.signal});let b=!1,T=!1;const E=(k=y.url).indexOf("sku=")>0&&ks(k);var k;u.type==="json"&&y.headers.set("Accept","application/json");const j=(L,z,W)=>{if(T)return;if(L&&L.message!=="SecurityError"&&br(L.toString()),z&&W)return R(z);const J=Date.now();fetch(y).then(ee=>{if(ee.ok){const oe=E?ee.clone():null;return R(ee,oe,J)}return d(new td(ee.statusText,ee.status,u.url))}).catch(ee=>{ee.name!=="AbortError"&&d(new Error(`${ee.message} ${u.url}`))})},R=(L,z,W)=>{(u.type==="arrayBuffer"?L.arrayBuffer():u.type==="json"?L.json():L.text()).then(J=>{T||(z&&W&&function(ee,oe,le){if(Qu(),Go==null)return;const de=xs(oe.headers.get("Cache-Control")||"");if(de["no-store"])return;const Se={status:oe.status,statusText:oe.statusText,headers:new Headers};oe.headers.forEach((ke,De)=>Se.headers.set(De,ke)),de["max-age"]&&Se.headers.set("Expires",new Date(le+1e3*de["max-age"]).toUTCString());const _e=Se.headers.get("Expires");if(!_e||new Date(_e).getTime()-le<42e4)return;let Ae=Yf(ee.url,{persistentParams:Il});if(oe.status===206){const ke=ee.headers.get("Range");if(!ke)return;Se.status=200,Ae=Um(Ae,{range:ke})}(function(ke,De){if(Ca===void 0)try{new Response(new ReadableStream),Ca=!0}catch{Ca=!1}Ca?De(ke.body):ke.blob().then(De).catch(at=>br(at.message))})(oe,ke=>{const De=new Response((at=oe.status)!==200&&at!==404&&[101,103,204,205,304].includes(at)?null:ke,Se);var at;Qu(),Go!=null&&Go.then(Ue=>Ue.put(Ae,De)).catch(Ue=>br(Ue.message))})}(y,z,W),b=!0,d(null,J,L.headers))}).catch(J=>{T||d(new Error(J.message))})};return E?function(L,z){if(Qu(),Go==null)return z(null);Go.then(W=>{let J=Yf(L.url,{persistentParams:Il});const ee=L.headers.get("Range");ee&&(J=Um(J,{range:ee})),W.match(J).then(oe=>{const le=function(de){if(!de)return!1;const Se=new Date(de.headers.get("Expires")||0),_e=xs(de.headers.get("Cache-Control")||"");return Number(Se)>Date.now()&&!_e["no-cache"]}(oe);W.delete(J).catch(z),le&&W.put(J,oe.clone()).catch(z),z(null,oe,le)}).catch(z)}).catch(z)}(y,j):j(null,null),{cancel:()=>{T=!0,b||g.abort()}}}(a,r);if(Xi(self)&&self.worker.actor)return self.worker.actor.send("getResource",a,r,void 0,!0)}var s;return function(u,d){const g=new XMLHttpRequest;g.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(const y in u.headers)g.setRequestHeader(y,u.headers[y]);return u.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=u.credentials==="include",g.onerror=()=>{d(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let y=g.response;if(u.type==="json")try{y=JSON.parse(g.response)}catch(T){return d(T)}const b=new Headers;g.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(T=>{const E=T.split(": "),k=E.shift(),j=E.join(": ");b.append(k,j)}),d(null,y,b)}else d(new td(g.statusText,g.status,u.url))},g.send(u.body),{cancel:()=>g.abort()}}(a,r)},th=function(a,r){return ep(Object.assign(a,{type:"arrayBuffer"}),r)};function Gn(a){const r=document.createElement("a");return r.href=a,r.protocol===location.protocol&&r.host===location.host}const Zy="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let tp,rp;tp=[],rp=0;const Xy=function(a,r){if(qm.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),rp>=Ai.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:a,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return tp.push(g),g}rp++;let s=!1;const u=()=>{if(!s)for(s=!0,rp--;tp.length&&rp<Ai.MAX_PARALLEL_IMAGE_REQUESTS;){const g=tp.shift(),{requestParameters:y,callback:b,cancelled:T}=g;T||(g.cancel=Xy(y,b).cancel)}},d=th(a,(g,y,b)=>{u(),g?r(g):y&&(self.createImageBitmap?function(T,E){const k=new Blob([new Uint8Array(T)],{type:"image/png"});createImageBitmap(k).then(j=>{E(null,j)}).catch(j=>{E(new Error(`Could not load image because of ${j.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(T,E)=>r(T,E,b)):function(T,E){const k=new Image;k.onload=()=>{E(null,k),URL.revokeObjectURL(k.src),k.onload=null,requestAnimationFrame(()=>{k.src=Zy})},k.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const j=new Blob([new Uint8Array(T)],{type:"image/png"});k.src=T.byteLength?URL.createObjectURL(j):Zy}(y,(T,E)=>r(T,E,b)))});return{cancel:()=>{d.cancel(),u()}}};var np,ip,sp,rd={exports:{}},Lb={exports:{}},Gm={exports:{}},S2=function(){if(sp)return rd.exports;sp=1;var a=(np||(np=1,Lb.exports=function(s,u){var d,g,y,b,T,E,k,j;for(g=s.length-(d=3&s.length),y=u,T=3432918353,E=461845907,j=0;j<g;)k=255&s.charCodeAt(j)|(255&s.charCodeAt(++j))<<8|(255&s.charCodeAt(++j))<<16|(255&s.charCodeAt(++j))<<24,++j,y=27492+(65535&(b=5*(65535&(y=(y^=k=(65535&(k=(k=(65535&k)*T+(((k>>>16)*T&65535)<<16)&4294967295)<<15|k>>>17))*E+(((k>>>16)*E&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(k=0,d){case 3:k^=(255&s.charCodeAt(j+2))<<16;case 2:k^=(255&s.charCodeAt(j+1))<<8;case 1:y^=k=(65535&(k=(k=(65535&(k^=255&s.charCodeAt(j)))*T+(((k>>>16)*T&65535)<<16)&4294967295)<<15|k>>>17))*E+(((k>>>16)*E&65535)<<16)&4294967295}return y^=s.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),Lb.exports),r=(ip||(ip=1,Gm.exports=function(s,u){for(var d,g=s.length,y=u^g,b=0;g>=4;)d=1540483477*(65535&(d=255&s.charCodeAt(b)|(255&s.charCodeAt(++b))<<8|(255&s.charCodeAt(++b))<<16|(255&s.charCodeAt(++b))<<24))+((1540483477*(d>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),g-=4,++b;switch(g){case 3:y^=(255&s.charCodeAt(b+2))<<16;case 2:y^=(255&s.charCodeAt(b+1))<<8;case 1:y=1540483477*(65535&(y^=255&s.charCodeAt(b)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),Gm.exports);return rd.exports=a,rd.exports.murmur3=a,rd.exports.murmur2=r,rd.exports}(),op=Ni(S2);class Aa{constructor(r,...s){Object.assign(this,s[0]||{}),this.type=r}}class ap extends Aa{constructor(r,s={}){super("error",Object.assign({error:r},s))}}function rh(a,r,s){s[a]&&s[a].indexOf(r)!==-1||(s[a]=s[a]||[],s[a].push(r))}function lp(a,r,s){if(s&&s[a]){const u=s[a].indexOf(r);u!==-1&&s[a].splice(u,1)}}class yc{on(r,s){return this._listeners=this._listeners||{},rh(r,s,this._listeners),this}off(r,s){return lp(r,s,this._listeners),lp(r,s,this._oneTimeListeners),this}once(r,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},rh(r,s,this._oneTimeListeners),this):new Promise(u=>{this.once(r,u)})}fire(r,s){const u=typeof r=="string"?new Aa(r,s):r,d=u.type;if(this.listens(d)){u.target=this;const g=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const T of g)T.call(this,u);const y=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const T of y)lp(d,T,this._oneTimeListeners),T.call(this,u);const b=this._eventedParent;if(b){const T=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(u,T),b.fire(u)}}else u instanceof ap&&console.error(u.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,s){return this._eventedParent=r,this._eventedParentData=s,this}}class js{constructor(r){typeof r=="string"?this.name=r:(this.name=r.name,this.iconsetId=r.iconsetId)}static from(r){return new js(r)}static toString(r){return r.iconsetId?`${r.name}${r.iconsetId}`:r.name}static parse(r){const[s,u]=r.split("");return new js({name:s,iconsetId:u})}static isEqual(r,s){return r.name===s.name&&r.iconsetId===s.iconsetId}toString(){return js.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Ky,Yy={},Jy=function(){if(Ky)return Yy;Ky=1;var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(g){return(g=Math.round(g))<0?0:g>255?255:g}function s(g){return r(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function u(g){return(y=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:y>1?1:y;var y}function d(g,y,b){return b<0?b+=1:b>1&&(b-=1),6*b<1?g+(y-g)*b*6:2*b<1?y:3*b<2?g+(y-g)*(2/3-b)*6:g}try{Yy.parseCSSColor=function(g){var y,b=g.replace(/ /g,"").toLowerCase();if(b in a)return a[b].slice();if(b[0]==="#")return b.length===4?(y=parseInt(b.substr(1),16))>=0&&y<=4095?[(3840&y)>>4|(3840&y)>>8,240&y|(240&y)>>4,15&y|(15&y)<<4,1]:null:b.length===7&&(y=parseInt(b.substr(1),16))>=0&&y<=16777215?[(16711680&y)>>16,(65280&y)>>8,255&y,1]:null;var T=b.indexOf("("),E=b.indexOf(")");if(T!==-1&&E+1===b.length){var k=b.substr(0,T),j=b.substr(T+1,E-(T+1)).split(","),R=1;switch(k){case"rgba":if(j.length!==4)return null;R=u(j.pop());case"rgb":return j.length!==3?null:[s(j[0]),s(j[1]),s(j[2]),R];case"hsla":if(j.length!==4)return null;R=u(j.pop());case"hsl":if(j.length!==3)return null;var L=(parseFloat(j[0])%360+360)%360/360,z=u(j[1]),W=u(j[2]),J=W<=.5?W*(z+1):W+z-W*z,ee=2*W-J;return[r(255*d(ee,J,L+1/3)),r(255*d(ee,J,L)),r(255*d(ee,J,L-1/3)),R];default:return null}}return null}}catch{}return Yy}();class Yn{constructor(r,s,u,d=1){this.r=r,this.g=s,this.b=u,this.a=d}static parse(r){if(!r)return;if(r instanceof Yn)return r;if(typeof r!="string")return;const s=Jy.parseCSSColor(r);return s?new Yn(s[0]/255,s[1]/255,s[2]/255,s[3]):void 0}toString(){const[r,s,u,d]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*r)},${Math.round(255*s)},${Math.round(255*u)},${d})`}toNonPremultipliedRenderColor(r){const{r:s,g:u,b:d,a:g}=this;return new zb(r,s,u,d,g)}toPremultipliedRenderColor(r){const{r:s,g:u,b:d,a:g}=this;return new Fb(r,s*g,u*g,d*g,g)}clone(){return new Yn(this.r,this.g,this.b,this.a)}}class Qy{constructor(r,s,u,d,g,y=!1){if(this.premultiplied=!1,this.premultiplied=y,r){const b=r.image.height,T=b*b;this.premultiplied?(s=g===0?0:s/g*(b-1),u=g===0?0:u/g*(b-1),d=g===0?0:d/g*(b-1)):(s*=b-1,u*=b-1,d*=b-1);const E=Math.floor(s),k=Math.floor(u),j=Math.floor(d),R=Math.ceil(s),L=Math.ceil(u),z=Math.ceil(d),W=s-E,J=u-k,ee=d-j,oe=r.image.data,le=4*(E+k*T+j*b),de=4*(E+k*T+z*b),Se=4*(E+L*T+j*b),_e=4*(E+L*T+z*b),Ae=4*(R+k*T+j*b),ke=4*(R+k*T+z*b),De=4*(R+L*T+j*b),at=4*(R+L*T+z*b);if(le<0||at>=oe.length)throw new Error("out of range");this.r=Rr(Rr(Rr(oe[le],oe[de],ee),Rr(oe[Se],oe[_e],ee),J),Rr(Rr(oe[Ae],oe[ke],ee),Rr(oe[De],oe[at],ee),J),W)/255*(this.premultiplied?g:1),this.g=Rr(Rr(Rr(oe[le+1],oe[de+1],ee),Rr(oe[Se+1],oe[_e+1],ee),J),Rr(Rr(oe[Ae+1],oe[ke+1],ee),Rr(oe[De+1],oe[at+1],ee),J),W)/255*(this.premultiplied?g:1),this.b=Rr(Rr(Rr(oe[le+2],oe[de+2],ee),Rr(oe[Se+2],oe[_e+2],ee),J),Rr(Rr(oe[Ae+2],oe[ke+2],ee),Rr(oe[De+2],oe[at+2],ee),J),W)/255*(this.premultiplied?g:1),this.a=g}else this.r=s,this.g=u,this.b=d,this.a=g}toArray(){const{r,g:s,b:u,a:d}=this;return[255*r,255*s,255*u,d]}toHslaArray(){let{r,g:s,b:u,a:d}=this;if(this.premultiplied){if(d===0)return[0,0,0,0];const z=1/d;r*=z,s*=z,u*=z}const g=Math.min(Math.max(r,0),1),y=Math.min(Math.max(s,0),1),b=Math.min(Math.max(u,0),1),T=Math.min(g,y,b),E=Math.max(g,y,b),k=E-T,j=.5*(T+E);if(k===0)return[0,0,100*j,d];const R=j>.5?k/(2-E-T):k/(E+T);let L;switch(E){case g:L=60*((y-b)/k+(y<b?6:0));break;case y:L=60*((b-g)/k+2);break;default:L=60*((g-y)/k+4)}return[L,100*R,100*j,d]}toArray01(){const{r,g:s,b:u,a:d}=this;return[r,s,u,d]}toArray01Scaled(r){const{r:s,g:u,b:d}=this;return[s*r,u*r,d*r]}toArray01Linear(){const{r,g:s,b:u,a:d}=this;return[Math.pow(r,2.2),Math.pow(s,2.2),Math.pow(u,2.2),d]}}class zb extends Qy{constructor(r,s,u,d,g){super(r,s,u,d,g,!1)}}class Fb extends Qy{constructor(r,s,u,d,g){super(r,s,u,d,g,!0)}}function Rr(a,r,s){return a*(1-s)+r*s}function cp(a,r,s){return a.map((u,d)=>Rr(u,r[d],s))}Yn.black=new Yn(0,0,0,1),Yn.white=new Yn(1,1,1,1),Yn.transparent=new Yn(0,0,0,0),Yn.red=new Yn(1,0,0,1),Yn.blue=new Yn(0,0,1,1);var vc=Object.freeze({__proto__:null,array:cp,color:function(a,r,s){return new Yn(Rr(a.r,r.r,s),Rr(a.g,r.g,s),Rr(a.b,r.b,s),Rr(a.a,r.a,s))},number:Rr});class rl extends Error{constructor(r,s){super(s),this.message=s,this.key=r}}class nl{constructor(r,s=[]){this.parent=r,this.bindings={};for(const[u,d]of s)this.bindings[u]=d}concat(r){return new nl(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const nh={kind:"null"},fr={kind:"number"},Dn={kind:"string"},Xn={kind:"boolean"},fa={kind:"color"},ih={kind:"object"},ti={kind:"value"},up={kind:"collator"},nd={kind:"formatted"},dp={kind:"resolvedImage"};function no(a,r){return{kind:"array",itemType:a,N:r}}function Es(a){if(a.kind==="array"){const r=Es(a.itemType);return typeof a.N=="number"?`array<${r}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${r}>`}return a.kind}const T2=[nh,fr,Dn,Xn,fa,nd,ih,no(ti),dp];function hp(a,r){if(r.kind==="error")return null;if(a.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!hp(a.itemType,r.itemType))&&(typeof a.N!="number"||a.N===r.N))return null}else{if(a.kind===r.kind)return null;if(a.kind==="value"){for(const s of T2)if(!hp(s,r))return null}}return`Expected ${Es(a)} but found ${Es(r)} instead.`}function ev(a,r){return r.some(s=>s.kind===a.kind)}function fp(a,r){return r.some(s=>s==="null"?a===null:s==="array"?Array.isArray(a):s==="object"?a&&!Array.isArray(a)&&typeof a=="object":s===typeof a)}function Wm(a,r){return a.kind==="array"&&r.kind==="array"?a.N===r.N&&Wm(a.itemType,r.itemType):a.kind===r.kind}class tv{constructor(r,s,u){this.sensitivity=r?s?"variant":"case":s?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,s){return this.collator.compare(r,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class pp{constructor(r,s,u,d,g){this.text=r.normalize?r.normalize():r,this.image=s,this.scale=u,this.fontStack=d,this.textColor=g}}class Vs{constructor(r){this.sections=r}static fromString(r){return new Vs([new pp(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||!!r.image&&r.image.hasPrimary())}static factory(r){return r instanceof Vs?r:Vs.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const s of this.sections){if(s.image){const d=s.image.getPrimary().id.toString();r.push(["image",d]);continue}r.push(s.text);const u={};s.fontStack&&(u["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(u["font-scale"]=s.scale),s.textColor&&(u["text-color"]=["rgba"].concat(s.textColor.toNonPremultipliedRenderColor(null).toArray())),r.push(u)}return r}}class xc{constructor(r,s={}){if(this.id=js.from(r),this.options=Object.assign({},s),s.transform){const{a:u,b:d,c:g,d:y,e:b,f:T}=s.transform;this.options.transform=new DOMMatrix([u,d,g,y,b,T])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:r,b:s,c:u,d,e:g,f:y}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:r,b:s,c:u,d,e:g,f:y}})}static parse(r){let s,u,d,g;try{({name:s,iconsetId:u,params:d,transform:g}=JSON.parse(r)||{})}catch{return null}if(!s)return null;const{a:y,b,c:T,d:E,e:k,f:j}=g||{};return new xc({name:s,iconsetId:u},{params:d,transform:new DOMMatrix([y,b,T,E,k,j])})}scaleSelf(r,s){return this.options.transform.scaleSelf(r,s),this}}class Qo{constructor(r,s,u,d,g=!1){this.primaryId=js.from(r),this.primaryOptions=s,u&&(this.secondaryId=js.from(u)),this.secondaryOptions=d,this.available=g}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new xc(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new xc(this.secondaryId,this.secondaryOptions):null}static from(r){return typeof r=="string"?Qo.build({name:r}):r}static build(r,s,u,d){return!r||typeof r=="object"&&!("name"in r)?null:new Qo(r,u,s,d)}}function Hm(a,r,s,u){return typeof a=="number"&&a>=0&&a<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof s=="number"&&s>=0&&s<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[a,r,s,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[a,r,s,u]:[a,r,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function sh(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Yn||a instanceof tv||a instanceof Vs||a instanceof Qo)return!0;if(Array.isArray(a)){for(const r of a)if(!sh(r))return!1;return!0}if(typeof a=="object"){for(const r in a)if(!sh(a[r]))return!1;return!0}return!1}function zs(a){if(a===null)return nh;if(typeof a=="string")return Dn;if(typeof a=="boolean")return Xn;if(typeof a=="number")return fr;if(a instanceof Yn)return fa;if(a instanceof tv)return up;if(a instanceof Vs)return nd;if(a instanceof Qo)return dp;if(Array.isArray(a)){const r=a.length;let s;for(const u of a){const d=zs(u);if(s){if(s===d)continue;s=ti;break}s=d}return no(s||ti,r)}return ih}function Kl(a){const r=typeof a;return a===null?"":r==="string"||r==="number"||r==="boolean"?String(a):a instanceof Vs||a instanceof Qo||a instanceof Yn?a.toString():JSON.stringify(a)}class bc{constructor(r,s){this.type=r,this.value=s}static parse(r,s){if(r.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!sh(r[1]))return s.error("invalid value");const u=r[1];let d=zs(u);const g=s.expectedType;return d.kind!=="array"||d.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(d=g),new bc(d,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Yn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Vs?this.value.serialize():this.value}}class us{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const Qr={string:Dn,number:fr,boolean:Xn,object:ih};class cr{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");let u,d=1;const g=r[0];if(g==="array"){let b,T;if(r.length>2){const E=r[1];if(typeof E!="string"||!(E in Qr)||E==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);b=Qr[E],d++}else b=ti;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return s.error('The length argument to "array" must be a positive integer literal',2);T=r[2],d++}u=no(b,T)}else u=Qr[g];const y=[];for(;d<r.length;d++){const b=s.parse(r[d],d,ti);if(!b)return null;y.push(b)}return new cr(u,y)}evaluate(r){for(let s=0;s<this.args.length;s++){const u=this.args[s].evaluate(r);if(!hp(this.type,zs(u)))return u;if(s===this.args.length-1)throw new us(`The expression ${JSON.stringify(this.args[s].serialize())} evaluated to ${Es(zs(u))} but was expected to be of type ${Es(this.type)}.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,s=[r.kind];if(r.kind==="array"){const u=r.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){s.push(u.kind);const d=r.N;(typeof d=="number"||this.args.length>1)&&s.push(d)}}return s.concat(this.args.map(u=>u.serialize()))}}class id{constructor(r){this.type=nd,this.sections=r}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const u=r[1];if(!Array.isArray(u)&&typeof u=="object")return s.error("First argument must be an image or text section.");const d=[];let g=!1;for(let y=1;y<=r.length-1;++y){const b=r[y];if(g&&typeof b=="object"&&!Array.isArray(b)){g=!1;let T=null;if(b["font-scale"]&&(T=s.parseObjectValue(b["font-scale"],y,"font-scale",fr),!T))return null;let E=null;if(b["text-font"]&&(E=s.parseObjectValue(b["text-font"],y,"text-font",no(Dn)),!E))return null;let k=null;if(b["text-color"]&&(k=s.parseObjectValue(b["text-color"],y,"text-color",fa),!k))return null;const j=d[d.length-1];j.scale=T,j.font=E,j.textColor=k}else{const T=s.parse(r[y],y,ti);if(!T)return null;const E=T.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,d.push({content:T,scale:null,font:null,textColor:null})}}return new id(d)}evaluate(r){return new Vs(this.sections.map(s=>{const u=s.content.evaluate(r);return Wm(zs(u),dp)?new pp("",u,null,null,null):new pp(Kl(u),null,s.scale?s.scale.evaluate(r):null,s.font?s.font.evaluate(r).join(","):null,s.textColor?s.textColor.evaluate(r):null)}))}eachChild(r){for(const s of this.sections)r(s.content),s.scale&&r(s.scale),s.font&&r(s.font),s.textColor&&r(s.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const s of this.sections){r.push(s.content.serialize());const u={};s.scale&&(u["font-scale"]=s.scale.serialize()),s.font&&(u["text-font"]=s.font.serialize()),s.textColor&&(u["text-color"]=s.textColor.serialize()),r.push(u)}return r}}class Br{constructor(r,s,u,d){this._imageWarnHistory={},this.type=dp,this.namePrimary=r,this.nameSecondary=s,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),d&&(this.paramsSecondary=d.params,this.iconsetIdSecondary=d.iconset?d.iconset.id:void 0)}static parse(r,s){if(r.length<2)return s.error("Expected two or more arguments.");let u=1;const d=[];function g(){if(u<r.length){const b=s.parse(r[u],u++,Dn);return b?(d.push({image:b,options:{}}),!0):(s.error(d.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function y(){if(u<r.length){const T=r[u];if((b=T)===null||typeof b!="object"||Array.isArray(b))return!0;const E=T.params,k=T.iconset,j=s.concat(u);if(!E&&!k)return u++,!0;if(E){if(typeof E!="object"||E.constructor!==Object)return j.error('Image options "params" should be an object'),!1;const R={},L=j.concat(void 0,"params");for(const z in E){if(!z)return L.error("Image parameter name should be non-empty"),!1;const W=L.concat(void 0,z).parse(E[z],void 0,fa,void 0,{typeAnnotation:"coerce"});if(!W)return!1;R[z]=W}d[d.length-1].options.params=R}if(k){if(typeof k!="object"||k.constructor!==Object)return j.error('Image options "iconset" should be an object'),!1;if(!k.id)return j.error('Image options "iconset" should have an "id" property'),!1;d[d.length-1].options.iconset=k}return u++,!0}var b;return!0}for(let b=0;b<2;b++)if(!g()||!y())return;return new Br(d[0].image,d[1]?d[1].image:void 0,d[0].options,d[1]?d[1].options:void 0)}evaluateParams(r,s){const u={};if(s){for(const d in s)if(s[d])try{u[d]=s[d].evaluate(r)}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(r){const s={name:this.namePrimary.evaluate(r),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(r),iconsetId:this.iconsetIdSecondary}:void 0,d=Qo.build(s,u,this.paramsPrimary?this.evaluateParams(r,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(r,this.paramsSecondary):void 0);if(d&&r.availableImages){const g=d.getPrimary().id;if(d.available=r.availableImages.some(y=>js.isEqual(y,g)),d.available){const y=d.getSecondary()?d.getSecondary().id:null;y&&(d.available=r.availableImages.some(b=>js.isEqual(b,y)))}}return d}eachChild(r){if(r(this.namePrimary),this.paramsPrimary)for(const s in this.paramsPrimary)this.paramsPrimary[s]&&r(this.paramsPrimary[s]);if(this.nameSecondary&&(r(this.nameSecondary),this.paramsSecondary))for(const s in this.paramsSecondary)this.paramsSecondary[s]&&r(this.paramsSecondary[s])}outputDefined(){return!1}serializeOptions(r,s){const u={};if(s&&(u.iconset={id:s}),r){u.params={};for(const d in r)r[d]&&(u.params[d]=r[d].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){const r=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const s=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);s&&r.push(s)}if(this.nameSecondary&&(r.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const s=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);s&&r.push(s)}return r}}function oh(a){return Dr(a)?"string":mp(a)?"number":Xm(a)?"boolean":Array.isArray(a)?"array":a===null?"null":Zm(a)?"object":typeof a}function Zm(a){return a!=null&&!Array.isArray(a)&&typeof a!="function"&&!(a instanceof String||a instanceof Number||a instanceof Boolean)&&typeof a=="object"}function Dr(a){return typeof a=="string"||a instanceof String}function mp(a){return typeof a=="number"||a instanceof Number}function Xm(a){return typeof a=="boolean"||a instanceof Boolean}const Bb={"to-boolean":Xn,"to-color":fa,"to-number":fr,"to-string":Dn};class Yl{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const u=r[0],d=[];let g=nh;if(u==="to-array"){if(!Array.isArray(r[1]))return null;const y=r[1].length;if(s.expectedType){if(s.expectedType.kind!=="array")return s.error(`Expected ${s.expectedType.kind} but found array.`);g=no(s.expectedType.itemType,y)}else{if(!(y>0&&sh(r[1][0])))return null;g=no(zs(r[1][0]),y)}for(let b=0;b<y;b++){const T=r[1][b];let E;if(Array.isArray(T))E=s.parse(T,void 0,g.itemType);else{const k=oh(T);if(k!==g.itemType.kind)return s.error(`Expected ${g.itemType.kind} but found ${k}.`);E=s.registry.literal.parse(["literal",T===void 0?null:T],s)}if(!E)return null;d.push(E)}}else{if((u==="to-boolean"||u==="to-string")&&r.length!==2)return s.error("Expected one argument.");g=Bb[u];for(let y=1;y<r.length;y++){const b=s.parse(r[y],y,ti);if(!b)return null;d.push(b)}}return new Yl(g,d)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let s,u;for(const d of this.args){if(s=d.evaluate(r),u=null,s instanceof Yn)return s;if(typeof s=="string"){const g=r.parseColor(s);if(g)return g}else if(Array.isArray(s)&&(u=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Hm(s[0],s[1],s[2],s[3]),!u))return new Yn(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new us(u||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(const u of this.args){if(s=u.evaluate(r),s===null)return 0;const d=Number(s);if(!isNaN(d))return d}throw new us(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?Vs.fromString(Kl(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?Qo.build(Kl(this.args[0].evaluate(r))):this.type.kind==="array"?this.args.map(s=>s.evaluate(r)):Kl(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if(this.type.kind==="formatted")return new id([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Br(this.args[0]).serialize();const r=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(s=>{r.push(s.serialize())}),r}}const Km=["Unknown","Point","LineString","Polygon"];class io{constructor(r,s,u){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=r,this.options=s,this.iconImageUseTheme=u}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Km[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(r){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:u,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*s-r[0])+this.featureDistanceData.bearing[1]*(d*s-r[1])}return 0}parseColor(r){let s=this._parseColorCache[r];return s||(s=this._parseColorCache[r]=Yn.parse(r)),s}getConfig(r){return this.options?this.options.get(r):null}}class Oo{constructor(r,s,u,d,g){this.name=r,this.type=s,this._evaluate=u,this.args=d,this._overloadIndex=g}evaluate(r){if(!this._evaluate){const s=Oo.definitions[this.name];this._evaluate=Array.isArray(s)?s[2]:s.overloads[this._overloadIndex][1]}return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,s){const u=r[0],d=Oo.definitions[u];if(!d)return s.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(d)?d[0]:d.type,y=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,b=[];let T=null,E=-1;for(const[k,j]of y){if(Array.isArray(k)&&k.length!==r.length-1)continue;b.push(k),E++,T=new og(s.registry,s.path,null,s.scope,void 0,s._scope,s.options,s.iconImageUseTheme);const R=[];let L=!1;for(let z=1;z<r.length;z++){const W=r[z],J=Array.isArray(k)?k[z-1]:k.type,ee=T.parse(W,1+R.length,J);if(!ee){L=!0;break}R.push(ee)}if(!L)if(Array.isArray(k)&&k.length!==R.length)T.error(`Expected ${k.length} arguments, but found ${R.length} instead.`);else{for(let z=0;z<R.length;z++){const W=Array.isArray(k)?k[z]:k.type,J=R[z];T.concat(z+1).checkSubtype(W,J.type)}if(T.errors.length===0)return new Oo(u,g,j,R,E)}}if(b.length===1)s.errors.push(...T.errors);else{const k=(b.length?b:y.map(([R])=>R)).map(sd).join(" | "),j=[];for(let R=1;R<r.length;R++){const L=s.parse(r[R],1+j.length);if(!L)return null;j.push(Es(L.type))}s.error(`Expected arguments of type ${k}, but found (${j.join(", ")}) instead.`)}return null}static register(r,s){Oo.definitions=s;for(const u in s)r[u]=Oo}}function sd(a){return Array.isArray(a)?`(${a.map(Es).join(", ")})`:`(${Es(a.type)}...)`}class ah{constructor(r,s,u){this.type=up,this.locale=u,this.caseSensitive=r,this.diacriticSensitive=s}static parse(r,s){if(r.length!==2)return s.error("Expected one argument.");const u=r[1];if(typeof u!="object"||Array.isArray(u))return s.error("Collator options argument must be an object.");const d=u["case-sensitive"]===void 0?s.parse(!1,1,Xn):s.parseObjectValue(u["case-sensitive"],1,"case-sensitive",Xn);if(!d)return null;const g=u["diacritic-sensitive"]===void 0?s.parse(!1,1,Xn):s.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",Xn);if(!g)return null;let y=null;return u.locale&&(y=s.parseObjectValue(u.locale,1,"locale",Dn),!y)?null:new ah(d,g,y)}evaluate(r){return new tv(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}function wc(a,r,s=0,u=a.length-1,d=E2){for(;u>s;){if(u-s>600){const T=u-s+1,E=r-s+1,k=Math.log(T),j=.5*Math.exp(2*k/3),R=.5*Math.sqrt(k*j*(T-j)/T)*(E-T/2<0?-1:1);wc(a,r,Math.max(s,Math.floor(r-E*j/T+R)),Math.min(u,Math.floor(r+(T-E)*j/T+R)),d)}const g=a[r];let y=s,b=u;for(so(a,s,r),d(a[u],g)>0&&so(a,s,u);y<b;){for(so(a,y,b),y++,b--;d(a[y],g)<0;)y++;for(;d(a[b],g)>0;)b--}d(a[s],g)===0?so(a,s,b):(b++,so(a,b,u)),b<=r&&(s=b+1),r<=b&&(u=b-1)}}function so(a,r,s){const u=a[r];a[r]=a[s],a[s]=u}function E2(a,r){return a<r?-1:a>r?1:0}function C2(a){let r=0;for(let s,u,d=0,g=a.length,y=g-1;d<g;y=d++)s=a[d],u=a[y],r+=(u.x-s.x)*(s.y+u.y);return r}function gp(a,r){a[0]=Math.min(a[0],r[0]),a[1]=Math.min(a[1],r[1]),a[2]=Math.max(a[2],r[0]),a[3]=Math.max(a[3],r[1])}function hu(a,r){return!(a[0]<=r[0]||a[2]>=r[2]||a[1]<=r[1]||a[3]>=r[3])}function Vb(a,r,s){const u=a[0]-r[0],d=a[1]-r[1],g=a[0]-s[0],y=a[1]-s[1];return u*y-g*d==0&&u*g<=0&&d*y<=0}function il(a,r,s=!1){let u=!1;for(let b=0,T=r.length;b<T;b++){const E=r[b];for(let k=0,j=E.length,R=j-1;k<j;R=k++){const L=E[R],z=E[k];if(Vb(a,L,z))return s;(g=L)[1]>(d=a)[1]!=(y=z)[1]>d[1]&&d[0]<(y[0]-g[0])*(d[1]-g[1])/(y[1]-g[1])+g[0]&&(u=!u)}}var d,g,y;return u}function Ub(a,r,s,u){const d=u[0]-s[0],g=u[1]-s[1],y=(a[0]-s[0])*g-d*(a[1]-s[1]),b=(r[0]-s[0])*g-d*(r[1]-s[1]);return y>0&&b<0||y<0&&b>0}function Ym(a,r,s,u){return(d=[u[0]-s[0],u[1]-s[1]])[0]*(g=[r[0]-a[0],r[1]-a[1]])[1]-d[1]*g[0]!=0&&!(!Ub(a,r,s,u)||!Ub(s,u,a,r));var d,g}function _p(a){const r=new xt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=new xt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const u of a[0])r.x>u.x&&(r.x=u.x),r.y>u.y&&(r.y=u.y),s.x<u.x&&(s.x=u.x),s.y<u.y&&(s.y=u.y);return{min:r,max:s}}const fu=8192;function A2(a,r){const s=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,d=Math.pow(2,r.z);return[Math.round(s*d*fu),Math.round(u*d*fu)]}function $b(a,r){for(let s=0;s<r.length;s++)if(il(a,r[s]))return!0;return!1}function I2(a,r,s){for(const u of s)for(let d=0,g=u.length,y=g-1;d<g;y=d++)if(Ym(a,r,u[y],u[d]))return!0;return!1}function pu(a,r){for(let s=0;s<a.length;++s)if(!il(a[s],r))return!1;for(let s=0;s<a.length-1;++s)if(I2(a[s],a[s+1],r))return!1;return!0}function P2(a,r){for(let s=0;s<r.length;s++)if(pu(a,r[s]))return!0;return!1}function rv(a,r,s){const u=[];for(let d=0;d<a.length;d++){const g=[];for(let y=0;y<a[d].length;y++){const b=A2(a[d][y],s);gp(r,b),g.push(b)}u.push(g)}return u}function Jm(a,r,s){const u=[];for(let d=0;d<a.length;d++){const g=rv(a[d],r,s);u.push(g)}return u}function nv(a,r,s,u){if(a[0]<s[0]||a[0]>s[2]){const d=.5*u;let g=a[0]-s[0]>d?-u:s[0]-a[0]>d?u:0;g===0&&(g=a[0]-s[2]>d?-u:s[2]-a[0]>d?u:0),a[0]+=g}gp(r,a)}function iv(a,r,s,u){const d=Math.pow(2,u.z)*fu,g=[u.x*fu,u.y*fu],y=[];if(!a)return y;for(const b of a)for(const T of b){const E=[T.x+g[0],T.y+g[1]];nv(E,r,s,d),y.push(E)}return y}function sl(a,r,s,u){const d=Math.pow(2,u.z)*fu,g=[u.x*fu,u.y*fu],y=[];if(!a)return y;for(const T of a){const E=[];for(const k of T){const j=[k.x+g[0],k.y+g[1]];gp(r,j),E.push(j)}y.push(E)}if(r[2]-r[0]<=d/2){(b=r)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const T of y)for(const E of T)nv(E,r,s,d)}var b;return y}class od{constructor(r,s){this.type=Xn,this.geojson=r,this.geometries=s}static parse(r,s){if(r.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(sh(r[1])){const u=r[1];if(u.type==="FeatureCollection")for(let d=0;d<u.features.length;++d){const g=u.features[d].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new od(u,u.features[d].geometry)}else if(u.type==="Feature"){const d=u.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new od(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new od(u,u)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(s,u){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=s.canonicalID();if(!y)return!1;if(u.type==="Polygon"){const b=rv(u.coordinates,g,y),T=iv(s.geometry(),d,g,y);if(!hu(d,g))return!1;for(const E of T)if(!il(E,b))return!1}if(u.type==="MultiPolygon"){const b=Jm(u.coordinates,g,y),T=iv(s.geometry(),d,g,y);if(!hu(d,g))return!1;for(const E of T)if(!$b(E,b))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(s,u){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=s.canonicalID();if(!y)return!1;if(u.type==="Polygon"){const b=rv(u.coordinates,g,y),T=sl(s.geometry(),d,g,y);if(!hu(d,g))return!1;for(const E of T)if(!pu(E,b))return!1}if(u.type==="MultiPolygon"){const b=Jm(u.coordinates,g,y),T=sl(s.geometry(),d,g,y);if(!hu(d,g))return!1;for(const E of T)if(!P2(E,b))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const yp={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},sv=1/298.257223563,ov=sv*(2-sv),lh=Math.PI/180;class ch{static fromTile(r,s,u){const d=Math.PI*(1-2*(r+.5)/Math.pow(2,s)),g=Math.atan(.5*(Math.exp(d)-Math.exp(-d)))/lh;return new ch(g,u)}static get units(){return yp}constructor(r,s){if(r===void 0)throw new Error("No latitude given.");if(s&&!yp[s])throw new Error(`Unknown unit ${s}. Use one of: ${Object.keys(yp).join(", ")}`);const u=6378.137*lh*(s?yp[s]:1),d=Math.cos(r*lh),g=1/(1-ov*(1-d*d)),y=Math.sqrt(g);this.kx=u*y*d,this.ky=u*y*g*(1-ov)}distance(r,s){const u=Ia(r[0]-s[0])*this.kx,d=(r[1]-s[1])*this.ky;return Math.sqrt(u*u+d*d)}bearing(r,s){const u=Ia(s[0]-r[0])*this.kx;return Math.atan2(u,(s[1]-r[1])*this.ky)/lh}destination(r,s,u){const d=u*lh;return this.offset(r,Math.sin(d)*s,Math.cos(d)*s)}offset(r,s,u){return[r[0]+s/this.kx,r[1]+u/this.ky]}lineDistance(r){let s=0;for(let u=0;u<r.length-1;u++)s+=this.distance(r[u],r[u+1]);return s}area(r){let s=0;for(let u=0;u<r.length;u++){const d=r[u];for(let g=0,y=d.length,b=y-1;g<y;b=g++)s+=Ia(d[g][0]-d[b][0])*(d[g][1]+d[b][1])*(u?-1:1)}return Math.abs(s)/2*this.kx*this.ky}along(r,s){let u=0;if(s<=0)return r[0];for(let d=0;d<r.length-1;d++){const g=r[d],y=r[d+1],b=this.distance(g,y);if(u+=b,u>s)return Qm(g,y,(s-(u-b))/b)}return r[r.length-1]}pointToSegmentDistance(r,s,u){let[d,g]=s,y=Ia(u[0]-d)*this.kx,b=(u[1]-g)*this.ky;if(y!==0||b!==0){const T=(Ia(r[0]-d)*this.kx*y+(r[1]-g)*this.ky*b)/(y*y+b*b);T>1?(d=u[0],g=u[1]):T>0&&(d+=y/this.kx*T,g+=b/this.ky*T)}return y=Ia(r[0]-d)*this.kx,b=(r[1]-g)*this.ky,Math.sqrt(y*y+b*b)}pointOnLine(r,s){let u=1/0,d=r[0][0],g=r[0][1],y=0,b=0;for(let T=0;T<r.length-1;T++){let E=r[T][0],k=r[T][1],j=Ia(r[T+1][0]-E)*this.kx,R=(r[T+1][1]-k)*this.ky,L=0;j===0&&R===0||(L=(Ia(s[0]-E)*this.kx*j+(s[1]-k)*this.ky*R)/(j*j+R*R),L>1?(E=r[T+1][0],k=r[T+1][1]):L>0&&(E+=j/this.kx*L,k+=R/this.ky*L)),j=Ia(s[0]-E)*this.kx,R=(s[1]-k)*this.ky;const z=j*j+R*R;z<u&&(u=z,d=E,g=k,y=T,b=L)}return{point:[d,g],index:y,t:Math.max(0,Math.min(1,b))}}lineSlice(r,s,u){let d=this.pointOnLine(u,r),g=this.pointOnLine(u,s);if(d.index>g.index||d.index===g.index&&d.t>g.t){const E=d;d=g,g=E}const y=[d.point],b=d.index+1,T=g.index;!av(u[b],y[0])&&b<=T&&y.push(u[b]);for(let E=b+1;E<=T;E++)y.push(u[E]);return av(u[T],g.point)||y.push(g.point),y}lineSliceAlong(r,s,u){let d=0;const g=[];for(let y=0;y<u.length-1;y++){const b=u[y],T=u[y+1],E=this.distance(b,T);if(d+=E,d>r&&g.length===0&&g.push(Qm(b,T,(r-(d-E))/E)),d>=s)return g.push(Qm(b,T,(s-(d-E))/E)),g;d>r&&g.push(T)}return g}bufferPoint(r,s){const u=s/this.ky,d=s/this.kx;return[r[0]-d,r[1]-u,r[0]+d,r[1]+u]}bufferBBox(r,s){const u=s/this.ky,d=s/this.kx;return[r[0]-d,r[1]-u,r[2]+d,r[3]+u]}insideBBox(r,s){return Ia(r[0]-s[0])>=0&&Ia(r[0]-s[2])<=0&&r[1]>=s[1]&&r[1]<=s[3]}}function av(a,r){return a[0]===r[0]&&a[1]===r[1]}function Qm(a,r,s){const u=Ia(r[0]-a[0]);return[a[0]+u*s,a[1]+(r[1]-a[1])*s]}function Ia(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}class eg{constructor(r=[],s=(u,d)=>u<d?-1:u>d?1:0){if(this.data=r,this.length=this.data.length,this.compare=s,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:s,compare:u}=this,d=s[r];for(;r>0;){const g=r-1>>1,y=s[g];if(u(d,y)>=0)break;s[r]=y,r=g}s[r]=d}_down(r){const{data:s,compare:u}=this,d=this.length>>1,g=s[r];for(;r<d;){let y=1+(r<<1);const b=y+1;if(b<this.length&&u(s[b],s[y])<0&&(y=b),u(s[y],g)>=0)break;s[r]=s[y],r=y}s[r]=g}}var zt=8192;function lv(a,r){return r.dist-a.dist}const uh=100,dh=50;function vp(a){const r=[1/0,1/0,-1/0,-1/0];if(r.length!==a.length)return!1;for(let s=0;s<r.length;s++)if(r[s]!==a[s])return!1;return!0}function xp(a){return a[1]-a[0]+1}function Jl(a,r){const s=a[1]>=a[0]&&a[1]<r;return s||console.warn("Distance Expression: Index is out of range"),s}function tg(a,r){if(a[0]>a[1])return[null,null];const s=xp(a);if(r){if(s===2)return[a,null];const u=Math.floor(s/2);return[[a[0],a[0]+u],[a[0]+u,a[1]]]}{if(s===1)return[a,null];const u=Math.floor(s/2)-1;return[[a[0],a[0]+u],[a[0]+u+1,a[1]]]}}function ol(a,r){const s=[1/0,1/0,-1/0,-1/0];if(!Jl(r,a.length))return s;for(let u=r[0];u<=r[1];++u)gp(s,a[u]);return s}function vn(a){const r=[1/0,1/0,-1/0,-1/0];for(let s=0;s<a.length;++s)for(let u=0;u<a[s].length;++u)gp(r,a[s][u]);return r}function hh(a,r,s){if(vp(a)||vp(r))return NaN;let u=0,d=0;return a[2]<r[0]&&(u=r[0]-a[2]),a[0]>r[2]&&(u=a[0]-r[2]),a[1]>r[3]&&(d=a[1]-r[3]),a[3]<r[1]&&(d=r[1]-a[3]),s.distance([0,0],[u,d])}function k2(a){return 360*a-180}function j2(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function rg(a,r){const s=Math.pow(2,r.z),u=(a.y/zt+r.y)/s;return[k2((a.x/zt+r.x)/s),j2(u)]}function R2(a,r){const s=[];for(let u=0;u<a.length;++u)s.push(rg(a[u],r));return s}function Bi(a,r,s){const u=s.pointOnLine(r,a).point;return s.distance(a,u)}function qb(a,r,s,u,d){const g=s.slice(u[0],u[1]+1);let y=1/0;for(let b=r[0];b<=r[1];++b)if((y=Math.min(y,Bi(a[b],g,d)))===0)return 0;return y}function cv(a,r,s,u,d){const g=Math.min(d.pointToSegmentDistance(a,s,u),d.pointToSegmentDistance(r,s,u)),y=Math.min(d.pointToSegmentDistance(s,a,r),d.pointToSegmentDistance(u,a,r));return Math.min(g,y)}function M2(a,r,s,u,d){if(!Jl(r,a.length)||!Jl(u,s.length))return NaN;let g=1/0;for(let y=r[0];y<r[1];++y)for(let b=u[0];b<u[1];++b){if(Ym(a[y],a[y+1],s[b],s[b+1]))return 0;g=Math.min(g,cv(a[y],a[y+1],s[b],s[b+1],d))}return g}function D2(a,r,s,u,d){if(!Jl(r,a.length)||!Jl(u,s.length))return NaN;let g=1/0;for(let y=r[0];y<=r[1];++y)for(let b=u[0];b<=u[1];++b)if((g=Math.min(g,d.distance(a[y],s[b])))===0)return g;return g}function N2(a,r,s){if(il(a,r,!0))return 0;let u=1/0;for(const d of r){const g=d.length;if(g<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(d[0]!==d[g-1]&&(u=Math.min(u,s.pointToSegmentDistance(a,d[g-1],d[0])))===0||(u=Math.min(u,Bi(a,d,s)))===0)return u}return u}function O2(a,r,s,u){if(!Jl(r,a.length))return NaN;for(let g=r[0];g<=r[1];++g)if(il(a[g],s,!0))return 0;let d=1/0;for(let g=r[0];g<r[1];++g)for(const y of s)for(let b=0,T=y.length,E=T-1;b<T;E=b++){if(Ym(a[g],a[g+1],y[E],y[b]))return 0;d=Math.min(d,cv(a[g],a[g+1],y[E],y[b],u))}return d}function Gb(a,r){for(const s of a)for(let u=0;u<=s.length-1;++u)if(il(s[u],r,!0))return!0;return!1}function L2(a,r,s,u=1/0){const d=vn(a),g=vn(r);if(u!==1/0&&hh(d,g,s)>=u)return u;if(hu(d,g)){if(Gb(a,r))return 0}else if(Gb(r,a))return 0;let y=u;for(const b of a)for(let T=0,E=b.length,k=E-1;T<E;k=T++)for(const j of r)for(let R=0,L=j.length,z=L-1;R<L;z=R++){if(Ym(b[k],b[T],j[z],j[R]))return 0;y=Math.min(y,cv(b[k],b[T],j[z],j[R],s))}return y}function ng(a,r,s,u,d,g,y){if(g===null||y===null)return;const b=hh(ol(u,g),ol(d,y),s);b<r&&a.push({dist:b,range1:g,range2:y})}function z2(a,r,s,u,d=1/0){let g=Math.min(u.distance(a[0],s[0][0]),d);if(g===0)return g;const y=new eg([{dist:0,range1:[0,a.length-1],range2:[0,0]}],lv),b=r?dh:uh,T=vn(s);for(;y.length;){const E=y.pop();if(E.dist>=g)continue;const k=E.range1;if(xp(k)<=b){if(!Jl(k,a.length))return NaN;if(r){const j=O2(a,k,s,u);if((g=Math.min(g,j))===0)return g}else for(let j=k[0];j<=k[1];++j){const R=N2(a[j],s,u);if((g=Math.min(g,R))===0)return g}}else{const j=tg(k,r);if(j[0]!==null){const R=hh(ol(a,j[0]),T,u);R<g&&y.push({dist:R,range1:j[0],range2:[0,0]})}if(j[1]!==null){const R=hh(ol(a,j[1]),T,u);R<g&&y.push({dist:R,range1:j[1],range2:[0,0]})}}}return g}function Wb(a,r,s,u,d,g=1/0){let y=Math.min(g,d.distance(a[0],s[0]));if(y===0)return y;const b=new eg([{dist:0,range1:[0,a.length-1],range2:[0,s.length-1]}],lv),T=r?dh:uh,E=u?dh:uh;for(;b.length;){const k=b.pop();if(k.dist>=y)continue;const j=k.range1,R=k.range2;if(xp(j)<=T&&xp(R)<=E){if(!Jl(j,a.length)||!Jl(R,s.length))return NaN;if(r&&u?y=Math.min(y,M2(a,j,s,R,d)):r||u?r&&!u?y=Math.min(y,qb(s,R,a,j,d)):!r&&u&&(y=Math.min(y,qb(a,j,s,R,d))):y=Math.min(y,D2(a,j,s,R,d)),y===0)return y}else{const L=tg(j,r),z=tg(R,u);ng(b,y,d,a,s,L[0],z[0]),ng(b,y,d,a,s,L[0],z[1]),ng(b,y,d,a,s,L[1],z[0]),ng(b,y,d,a,s,L[1],z[1])}}return y}function uv(a,r,s,u,d=1/0){let g=d;const y=ol(a,[0,a.length-1]);for(const b of s)if(!(g!==1/0&&hh(y,ol(b,[0,b.length-1]),u)>=g)&&(g=Math.min(g,Wb(a,r,b,!0,u,g)),g===0))return g;return g}function ig(a,r,s,u,d=1/0){let g=d;const y=ol(a,[0,a.length-1]);for(const b of s){if(g!==1/0&&hh(y,vn(b),u)>=g)continue;const T=z2(a,r,b,u,g);if(isNaN(T))return T;if((g=Math.min(g,T))===0)return g}return g}function dv(a){return a==="Point"||a==="MultiPoint"||a==="LineString"||a==="MultiLineString"||a==="Polygon"||a==="MultiPolygon"}class ad{constructor(r,s){this.type=fr,this.geojson=r,this.geometries=s}static parse(r,s){if(r.length!==2)return s.error(`'distance' expression requires either one argument, but found ' ${r.length-1} instead.`);if(sh(r[1])){const u=r[1];if(u.type==="FeatureCollection"){for(let d=0;d<u.features.length;++d)if(dv(u.features[d].geometry.type))return new ad(u,u.features[d].geometry)}else if(u.type==="Feature"){if(dv(u.geometry.type))return new ad(u,u.geometry)}else if(dv(u.type))return new ad(u,u)}return s.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(r){const s=r.geometry(),u=r.canonicalID();if(s!=null&&u!=null){if(r.geometryType()==="Point")return function(d,g,y){const b=[];for(const E of d)for(const k of E)b.push(rg(k,g));const T=new ch(b[0][1],"meters");return y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString"?Wb(b,!1,y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",T):y.type==="MultiLineString"?uv(b,!1,y.coordinates,T):y.type==="Polygon"||y.type==="MultiPolygon"?ig(b,!1,y.type==="Polygon"?[y.coordinates]:y.coordinates,T):null}(s,u,this.geometries);if(r.geometryType()==="LineString")return function(d,g,y){const b=[];for(const E of d){const k=[];for(const j of E)k.push(rg(j,g));b.push(k)}const T=new ch(b[0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return uv(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",b,T);if(y.type==="MultiLineString"){let E=1/0;for(let k=0;k<y.coordinates.length;k++){const j=uv(y.coordinates[k],!0,b,T,E);if(isNaN(j))return j;if((E=Math.min(E,j))===0)return E}return E}if(y.type==="Polygon"||y.type==="MultiPolygon"){let E=1/0;for(let k=0;k<b.length;k++){const j=ig(b[k],!0,y.type==="Polygon"?[y.coordinates]:y.coordinates,T,E);if(isNaN(j))return j;if((E=Math.min(E,j))===0)return E}return E}return null}(s,u,this.geometries);if(r.geometryType()==="Polygon")return function(d,g,y){const b=[];for(const E of function(k,j){const R=k.length;if(R<=1)return[k];const L=[];let z,W;for(let J=0;J<R;J++){const ee=C2(k[J]);ee!==0&&(k[J].area=Math.abs(ee),W===void 0&&(W=ee<0),W===ee<0?(z&&L.push(z),z=[k[J]]):z.push(k[J]))}return z&&L.push(z),L}(d)){const k=[];for(let j=0;j<E.length;++j)k.push(R2(E[j],g));b.push(k)}const T=new ch(b[0][0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return ig(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",b,T);if(y.type==="MultiLineString"){let E=1/0;for(let k=0;k<y.coordinates.length;k++){const j=ig(y.coordinates[k],!0,b,T,E);if(isNaN(j))return j;if((E=Math.min(E,j))===0)return E}return E}return y.type==="Polygon"||y.type==="MultiPolygon"?function(E,k,j){let R=1/0;for(const L of E)for(const z of k){const W=L2(L,z,j,R);if(isNaN(W))return W;if((R=Math.min(R,W))===0)return R}return R}(y.type==="Polygon"?[y.coordinates]:y.coordinates,b,T):null}(s,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function fh(a){if(a instanceof Oo&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof od||a instanceof ad)return!1;if(a instanceof mh)return a.featureConstant;let r=!0;return a.eachChild(s=>{r&&!fh(s)&&(r=!1)}),r}function bp(a){if(a instanceof Oo&&a.name==="feature-state")return!1;let r=!0;return a.eachChild(s=>{r&&!bp(s)&&(r=!1)}),r}function ph(a,r){if(a instanceof Oo&&r.indexOf(a.name)>=0)return!1;let s=!0;return a.eachChild(u=>{s&&!ph(u,r)&&(s=!1)}),s}function Hb(a,r,s){return[a,r,s].filter(Boolean).join("")}function hv(a,r){switch(a){case"string":return Kl(r);case"number":return+r;case"boolean":return!!r;case"color":return Yn.parse(r);case"formatted":return Vs.fromString(Kl(r));case"resolvedImage":return Qo.build(Kl(r))}return r}function Zb(a,r,s,u){return u!==void 0&&(a=u*Math.round(a/u)),r!==void 0&&a<r&&(a=r),s!==void 0&&a>s&&(a=s),a}class mh{constructor(r,s,u,d=!1){this.type=r,this.key=s,this.scope=u,this.featureConstant=d}static parse(r,s){let u=s.expectedType;if(u==null&&(u=ti),r.length<2||r.length>3)return s.error("Invalid number of arguments for 'config' expression.");const d=s.parse(r[1],1);if(!(d instanceof bc))return s.error("Key name of 'config' expression must be a string literal.");let g,y=!0;const b=Kl(d.value);if(r.length>=3){const T=s.parse(r[2],2);if(!(T instanceof bc))return s.error("Scope of 'config' expression must be a string literal.");g=Kl(T.value)}if(s.options){const T=Hb(b,g,s._scope),E=s.options.get(T);E&&(y=fh(E.value||E.default))}return new mh(u,b,g,y)}evaluate(r){const s=Hb(this.key,this.scope,r.scope),u=r.getConfig(s);if(!u)return null;const{type:d,value:g,values:y,minValue:b,maxValue:T,stepValue:E}=u,k=u.default.evaluate(r);let j=k;if(g){const R=r.scope;r.scope=(R||"").split("").slice(1).join(""),j=g.evaluate(r),r.scope=R}return d&&(j=hv(d,j)),j===void 0||b===void 0&&T===void 0&&E===void 0||(typeof j=="number"?j=Zb(j,b,T,E):Array.isArray(j)&&(j=j.map(R=>typeof R=="number"?Zb(R,b,T,E):R))),g!==void 0&&j!==void 0&&y&&!y.includes(j)&&(j=k,d&&(j=hv(d,j))),(d&&d!==this.type||j!==void 0&&!Wm(zs(j),this.type))&&(j=hv(this.type.kind,j)),j}eachChild(){}outputDefined(){return!1}serialize(){const r=["config",this.key];return this.scope&&r.concat(this.scope),r}}class sg{constructor(r,s){this.type=s.type,this.name=r,this.boundExpression=s}static parse(r,s){if(r.length!==2||typeof r[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const u=r[1];return s.scope.has(u)?new sg(u,s.scope.get(u)):s.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class og{constructor(r,s=[],u,d=new nl,g=[],y,b,T){this.registry=r,this.path=s,this.key=s.map(E=>typeof E=="string"?`['${E}']`:`[${E}]`).join(""),this.scope=d,this.errors=g,this.expectedType=u,this._scope=y,this.options=b,this.iconImageUseTheme=T}parse(r,s,u,d,g={}){return s||u?this.concat(s,null,u,d)._parse(r,g):this._parse(r,g)}parseObjectValue(r,s,u,d,g,y={}){return this.concat(s,u,d,g)._parse(r,y)}_parse(r,s){function u(d,g,y){return y==="assert"?new cr(g,[d]):y==="coerce"?new Yl(g,[d]):d}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=typeof r[0]=="string"?this.registry[r[0]]:void 0;if(d){let g=d.parse(r,this);if(!g)return null;if(this.expectedType){const y=this.expectedType,b=g.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||b.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(y,b))return null}else g=u(g,y,s.typeAnnotation||"coerce");else g=u(g,y,s.typeAnnotation||"assert")}if(!(g instanceof bc)&&g.type.kind!=="resolvedImage"&&fv(g)){const y=new io(this._scope,this.options,this.iconImageUseTheme);try{g=new bc(g.type,g.evaluate(y))}catch(b){return this.error(b.message),null}}return g}return Yl.parse(["to-array",r],this)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,s,u,d){let g=typeof r=="number"?this.path.concat(r):this.path;g=typeof s=="string"?g.concat(s):g;const y=d?this.scope.concat(d):this.scope;return new og(this.registry,g,u||null,y,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(r,...s){const u=`${this.key}${s.map(d=>`[${d}]`).join("")}`;this.errors.push(new rl(u,r))}checkSubtype(r,s){const u=hp(r,s);return u&&this.error(u),u}}function fv(a){if(a instanceof sg)return fv(a.boundExpression);if(a instanceof Oo&&a.name==="error"||a instanceof ah||a instanceof od||a instanceof ad||a instanceof mh)return!1;const r=a instanceof Yl||a instanceof cr;let s=!0;return a.eachChild(u=>{s=r?s&&fv(u):s&&u instanceof bc}),!!s&&fh(a)&&ph(a,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function ag(a,r){const s=a.length-1;let u,d,g=0,y=s,b=0;for(;g<=y;)if(b=Math.floor((g+y)/2),u=a[b],d=a[b+1],u<=r){if(b===s||r<d)return b;g=b+1}else{if(!(u>r))throw new us("Input is not a number.");y=b-1}return 0}class wp{constructor(r,s,u){this.type=r,this.input=s,this.labels=[],this.outputs=[];for(const[d,g]of u)this.labels.push(d),this.outputs.push(g)}static parse(r,s){if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return s.error("Expected an even number of arguments.");const u=s.parse(r[1],1,fr);if(!u)return null;const d=[];let g=null;s.expectedType&&s.expectedType.kind!=="value"&&(g=s.expectedType);for(let y=1;y<r.length;y+=2){const b=y===1?-1/0:r[y],T=r[y+1],E=y,k=y+1;if(typeof b!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(d.length&&d[d.length-1][0]>=b)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const j=s.parse(T,k,g);if(!j)return null;g=g||j.type,d.push([b,j])}return new wp(g,u,d)}evaluate(r){const s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(r);const d=this.input.evaluate(r);if(d<=s[0])return u[0].evaluate(r);const g=s.length;return d>=s[g-1]?u[g-1].evaluate(r):u[ag(s,d)].evaluate(r)}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&r.push(this.labels[s]),r.push(this.outputs[s].serialize());return r}}const Xb=.95047,Kb=1.08883,Yb=4/29,gh=6/29,lg=3*gh*gh,F2=gh*gh*gh,Jb=Math.PI/180,B2=180/Math.PI;function pv(a){return a>F2?Math.pow(a,1/3):a/lg+Yb}function mv(a){return a>gh?a*a*a:lg*(a-Yb)}function cg(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function ug(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function ld(a){const r=ug(a.r),s=ug(a.g),u=ug(a.b),d=pv((.4124564*r+.3575761*s+.1804375*u)/Xb),g=pv((.2126729*r+.7151522*s+.072175*u)/1);return{l:116*g-16,a:500*(d-g),b:200*(g-pv((.0193339*r+.119192*s+.9503041*u)/Kb)),alpha:a.a}}function gv(a){let r=(a.l+16)/116,s=isNaN(a.a)?r:r+a.a/500,u=isNaN(a.b)?r:r-a.b/200;return r=1*mv(r),s=Xb*mv(s),u=Kb*mv(u),new Yn(cg(3.2404542*s-1.5371385*r-.4985314*u),cg(-.969266*s+1.8760108*r+.041556*u),cg(.0556434*s-.2040259*r+1.0572252*u),a.alpha)}function Qb(a,r,s){const u=r-a;return a+s*(u>180||u<-180?u-360*Math.round(u/360):u)}const Sp={forward:ld,reverse:gv,interpolate:function(a,r,s){return{l:Rr(a.l,r.l,s),a:Rr(a.a,r.a,s),b:Rr(a.b,r.b,s),alpha:Rr(a.alpha,r.alpha,s)}}},cd={forward:function(a){const{l:r,a:s,b:u}=ld(a),d=Math.atan2(u,s)*B2;return{h:d<0?d+360:d,c:Math.sqrt(s*s+u*u),l:r,alpha:a.a}},reverse:function(a){const r=a.h*Jb,s=a.c;return gv({l:a.l,a:Math.cos(r)*s,b:Math.sin(r)*s,alpha:a.alpha})},interpolate:function(a,r,s){return{h:Qb(a.h,r.h,s),c:Rr(a.c,r.c,s),l:Rr(a.l,r.l,s),alpha:Rr(a.alpha,r.alpha,s)}}};var dg=Object.freeze({__proto__:null,hcl:cd,lab:Sp});class Pa{constructor(r,s,u,d,g){this.type=r,this.operator=s,this.interpolation=u,this.input=d,this.labels=[],this.outputs=[];for(const[y,b]of g)this.labels.push(y),this.outputs.push(b)}static interpolationFactor(r,s,u,d){let g=0;if(r.name==="exponential")g=_v(s,r.base,u,d);else if(r.name==="linear")g=_v(s,1,u,d);else if(r.name==="cubic-bezier"){const y=r.controlPoints;g=new bo(y[0],y[1],y[2],y[3]).solve(_v(s,1,u,d))}return g}static parse(r,s){let[u,d,g,...y]=r;if(!Array.isArray(d)||d.length===0)return s.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const E=d[1];if(typeof E!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:E}}else{if(d[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const E=d.slice(1);if(E.length!==4||E.some(k=>typeof k!="number"||k<0||k>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:E}}}if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length-1>3&&(r.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(g=s.parse(g,2,fr),!g)return null;const b=[];let T=null;u==="interpolate-hcl"||u==="interpolate-lab"?T=fa:s.expectedType&&s.expectedType.kind!=="value"&&(T=s.expectedType);for(let E=0;E<y.length;E+=2){const k=y[E],j=y[E+1],R=E+3,L=E+4;if(typeof k!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(b.length&&b[b.length-1][0]>=k)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const z=s.parse(j,L,T);if(!z)return null;T=T||z.type,b.push([k,z])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new Pa(T,u,d,g,b):s.error(`Type ${Es(T)} is not interpolatable.`)}evaluate(r){const s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(r);const d=this.input.evaluate(r);if(d<=s[0])return u[0].evaluate(r);const g=s.length;if(d>=s[g-1])return u[g-1].evaluate(r);const y=ag(s,d),b=Pa.interpolationFactor(this.interpolation,d,s[y],s[y+1]),T=u[y].evaluate(r),E=u[y+1].evaluate(r);return this.operator==="interpolate"?vc[this.type.kind.toLowerCase()](T,E,b):this.operator==="interpolate-hcl"?cd.reverse(cd.interpolate(cd.forward(T),cd.forward(E),b)):Sp.reverse(Sp.interpolate(Sp.forward(T),Sp.forward(E),b))}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const s=[this.operator,r,this.input.serialize()];for(let u=0;u<this.labels.length;u++)s.push(this.labels[u],this.outputs[u].serialize());return s}}function _v(a,r,s,u){const d=u-s,g=a-s;return d===0?0:r===1?g/d:(Math.pow(r,g)-1)/(Math.pow(r,d)-1)}class Tp{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expectected at least one argument.");let u=null;const d=s.expectedType;d&&d.kind!=="value"&&(u=d);const g=[];for(const b of r.slice(1)){const T=s.parse(b,1+g.length,u,void 0,{typeAnnotation:"omit"});if(!T)return null;u=u||T.type,g.push(T)}const y=d&&g.some(b=>hp(d,b.type));return new Tp(y?ti:u,g)}evaluate(r){let s,u=null,d=0;for(const g of this.args){if(d++,u=g.evaluate(r),u&&u instanceof Qo&&!u.available&&(s||(s=u),u=null,d===this.args.length))return s;if(u!==null)break}return u}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(s=>{r.push(s.serialize())}),r}}class Ep{constructor(r,s){this.type=s.type,this.bindings=[].concat(r),this.result=s}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const s of this.bindings)r(s[1]);r(this.result)}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const u=[];for(let g=1;g<r.length-1;g+=2){const y=r[g];if(typeof y!="string")return s.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return s.error("Variable names must contain only alphanumeric characters or '_'.",g);const b=s.parse(r[g+1],g+1);if(!b)return null;u.push([y,b])}const d=s.parse(r[r.length-1],r.length-1,s.expectedType,u);return d?new Ep(u,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[s,u]of this.bindings)r.push(s,u.serialize());return r.push(this.result.serialize()),r}}class yv{constructor(r,s,u){this.type=r,this.index=s,this.input=u}static parse(r,s){if(r.length!==3)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=s.parse(r[1],1,fr),d=s.parse(r[2],2,no(s.expectedType||ti));return u&&d?new yv(d.type.itemType,u,d):null}evaluate(r){const s=this.index.evaluate(r),u=this.input.evaluate(r);if(s<0)throw new us("Array index out of bounds: negative index");if(s>=u.length)throw new us("Array index out of bounds: index exceeds array size");if(s!==Math.floor(s))throw new us("Array index must be an integer. Use at-interpolated for fractional indices");return u[s]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class vv{constructor(r,s,u){this.type=r,this.index=s,this.input=u}static parse(r,s){if(r.length!==3)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=s.parse(r[1],1,fr),d=s.parse(r[2],2,no(s.expectedType||ti));return u&&d?new vv(d.type.itemType,u,d):null}evaluate(r){const s=this.index.evaluate(r),u=this.input.evaluate(r);if(s<0)throw new us(`Array index out of bounds: ${s} < 0.`);if(s>u.length-1)throw new us(`Array index out of bounds: ${s} > ${u.length-1}.`);if(s===Math.floor(s))return u[s];const d=Math.floor(s),g=Math.ceil(s),y=u[d],b=u[g];if(typeof y!="number"||typeof b!="number")throw new us(`Cannot interpolate between non-number values at index ${s}.`);const T=s-d;return y*(1-T)+b*T}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class xv{constructor(r,s){this.type=Xn,this.needle=r,this.haystack=s}static parse(r,s){if(r.length!==3)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=s.parse(r[1],1,ti),d=s.parse(r[2],2,ti);return u&&d?ev(u.type,[Xn,Dn,fr,nh,ti])?new xv(u,d):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Es(u.type)} instead`):null}evaluate(r){const s=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(u==null)return!1;if(!fp(s,["boolean","string","number","null"]))throw new us(`Expected first argument to be of type boolean, string, number or null, but found ${Es(zs(s))} instead.`);if(!fp(u,["string","array"]))throw new us(`Expected second argument to be of type array or string, but found ${Es(zs(u))} instead.`);return u.indexOf(s)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Cp{constructor(r,s,u){this.type=fr,this.needle=r,this.haystack=s,this.fromIndex=u}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=s.parse(r[1],1,ti),d=s.parse(r[2],2,ti);if(!u||!d)return null;if(!ev(u.type,[Xn,Dn,fr,nh,ti]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Es(u.type)} instead`);if(r.length===4){const g=s.parse(r[3],3,fr);return g?new Cp(u,d,g):null}return new Cp(u,d)}evaluate(r){const s=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(!fp(s,["boolean","string","number","null"]))throw new us(`Expected first argument to be of type boolean, string, number or null, but found ${Es(zs(s))} instead.`);if(!fp(u,["string","array"]))throw new us(`Expected second argument to be of type array or string, but found ${Es(zs(u))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(r);return u.indexOf(s,d)}return u.indexOf(s)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class hg{constructor(r,s,u,d,g,y){this.inputType=r,this.type=s,this.input=u,this.cases=d,this.outputs=g,this.otherwise=y}static parse(r,s){if(r.length<5)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return s.error("Expected an even number of arguments.");let u,d;s.expectedType&&s.expectedType.kind!=="value"&&(d=s.expectedType);const g={},y=[];for(let E=2;E<r.length-1;E+=2){let k=r[E];const j=r[E+1];Array.isArray(k)||(k=[k]);const R=s.concat(E);if(k.length===0)return R.error("Expected at least one branch label.");for(const z of k){if(typeof z!="number"&&typeof z!="string")return R.error("Branch labels must be numbers or strings.");if(typeof z=="number"&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof z=="number"&&Math.floor(z)!==z)return R.error("Numeric branch labels must be integer values.");if(u){if(R.checkSubtype(u,zs(z)))return null}else u=zs(z);if(g[String(z)]!==void 0)return R.error("Branch labels must be unique.");g[String(z)]=y.length}const L=s.parse(j,E,d);if(!L)return null;d=d||L.type,y.push(L)}const b=s.parse(r[1],1,ti);if(!b)return null;const T=s.parse(r[r.length-1],r.length-1,d);return T?b.type.kind!=="value"&&s.concat(1).checkSubtype(u,b.type)?null:new hg(u,d,b,g,y,T):null}evaluate(r){const s=this.input.evaluate(r);return(Wm(zs(s),this.inputType)&&this.outputs[this.cases[s]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),u=[],d={};for(const y of s){const b=d[this.cases[y]];b===void 0?(d[this.cases[y]]=u.length,u.push([this.cases[y],[y]])):u[b][1].push(y)}const g=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,b]of u)r.push(b.length===1?g(b[0]):b.map(g)),r.push(this.outputs[y].serialize());return r.push(this.otherwise.serialize()),r}}class _h{constructor(r,s,u){this.type=r,this.branches=s,this.otherwise=u}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return s.error("Expected an odd number of arguments.");let u;s.expectedType&&s.expectedType.kind!=="value"&&(u=s.expectedType);const d=[];for(let y=1;y<r.length-1;y+=2){const b=s.parse(r[y],y,Xn);if(!b)return null;const T=s.parse(r[y+1],y+1,u);if(!T)return null;d.push([b,T]),u=u||T.type}const g=s.parse(r[r.length-1],r.length-1,u);return g?new _h(u,d,g):null}evaluate(r){for(const[s,u]of this.branches)if(s.evaluate(r))return u.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[s,u]of this.branches)r(s),r(u);r(this.otherwise)}outputDefined(){return this.branches.every(([r,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(s=>{r.push(s.serialize())}),r}}class fg{constructor(r,s,u,d){this.type=r,this.input=s,this.beginIndex=u,this.endIndex=d}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=s.parse(r[1],1,ti),d=s.parse(r[2],2,fr);if(!u||!d)return null;if(!ev(u.type,[no(ti),Dn,ti]))return s.error(`Expected first argument to be of type array or string, but found ${Es(u.type)} instead`);if(r.length===4){const g=s.parse(r[3],3,fr);return g?new fg(u.type,u,d,g):null}return new fg(u.type,u,d)}evaluate(r){const s=this.input.evaluate(r),u=this.beginIndex.evaluate(r);if(!fp(s,["string","array"]))throw new us(`Expected first argument to be of type array or string, but found ${Es(zs(s))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(r);return s.slice(u,d)}return s.slice(u)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class pg{constructor(r,s){this.type=no(Dn),this.str=r,this.delimiter=s}static parse(r,s){if(r.length!==3)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=s.parse(r[1],1,Dn),d=s.parse(r[2],2,Dn);return u&&d?new pg(u,d):void 0}evaluate(r){const s=this.str.evaluate(r),u=this.delimiter.evaluate(r);return s.split(u)}eachChild(r){r(this.str),r(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function e1(a,r){return a==="=="||a==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function t1(a,r,s,u){return u.compare(r,s)===0}function yh(a,r,s){const u=a!=="=="&&a!=="!=";return class PU{constructor(g,y,b){this.type=Xn,this.lhs=g,this.rhs=y,this.collator=b,this.hasUntypedArgument=g.type.kind==="value"||y.type.kind==="value"}static parse(g,y){if(g.length!==3&&g.length!==4)return y.error("Expected two or three arguments.");const b=g[0];let T=y.parse(g[1],1,ti);if(!T)return null;if(!e1(b,T.type))return y.concat(1).error(`"${b}" comparisons are not supported for type '${Es(T.type)}'.`);let E=y.parse(g[2],2,ti);if(!E)return null;if(!e1(b,E.type))return y.concat(2).error(`"${b}" comparisons are not supported for type '${Es(E.type)}'.`);if(T.type.kind!==E.type.kind&&T.type.kind!=="value"&&E.type.kind!=="value")return y.error(`Cannot compare types '${Es(T.type)}' and '${Es(E.type)}'.`);u&&(T.type.kind==="value"&&E.type.kind!=="value"?T=new cr(E.type,[T]):T.type.kind!=="value"&&E.type.kind==="value"&&(E=new cr(T.type,[E])));let k=null;if(g.length===4){if(T.type.kind!=="string"&&E.type.kind!=="string"&&T.type.kind!=="value"&&E.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(k=y.parse(g[3],3,up),!k)return null}return new PU(T,E,k)}evaluate(g){const y=this.lhs.evaluate(g),b=this.rhs.evaluate(g);if(u&&this.hasUntypedArgument){const T=zs(y),E=zs(b);if(T.kind!==E.kind||T.kind!=="string"&&T.kind!=="number")throw new us(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${T.kind}, ${E.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const T=zs(y),E=zs(b);if(T.kind!=="string"||E.kind!=="string")return r(g,y,b)}return this.collator?s(g,y,b,this.collator.evaluate(g)):r(g,y,b)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[a];return this.eachChild(y=>{g.push(y.serialize())}),g}}}const r1=yh("==",function(a,r,s){return r===s},t1),n1=yh("!=",function(a,r,s){return r!==s},function(a,r,s,u){return!t1(0,r,s,u)}),V2=yh("<",function(a,r,s){return r<s},function(a,r,s,u){return u.compare(r,s)<0}),U2=yh(">",function(a,r,s){return r>s},function(a,r,s,u){return u.compare(r,s)>0}),$2=yh("<=",function(a,r,s){return r<=s},function(a,r,s,u){return u.compare(r,s)<=0}),mg=yh(">=",function(a,r,s){return r>=s},function(a,r,s,u){return u.compare(r,s)>=0});class bv{constructor(r,s,u,d,g,y){this.type=Dn,this.number=r,this.locale=s,this.currency=u,this.unit=d,this.minFractionDigits=g,this.maxFractionDigits=y}static parse(r,s){if(r.length!==3)return s.error("Expected two arguments.");const u=s.parse(r[1],1,fr);if(!u)return null;const d=r[2];if(typeof d!="object"||Array.isArray(d))return s.error("NumberFormat options argument must be an object.");let g=null;if(d.locale&&(g=s.parseObjectValue(d.locale,2,"locale",Dn),!g))return null;let y=null;if(d.currency&&(y=s.parseObjectValue(d.currency,2,"currency",Dn),!y))return null;let b=null;if(d.unit&&(b=s.parseObjectValue(d.unit,2,"unit",Dn),!b))return null;let T=null;if(d["min-fraction-digits"]&&(T=s.parseObjectValue(d["min-fraction-digits"],2,"min-fraction-digits",fr),!T))return null;let E=null;return d["max-fraction-digits"]&&(E=s.parseObjectValue(d["max-fraction-digits"],2,"max-fraction-digits",fr),!E)?null:new bv(u,g,y,b,T,E)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class wv{constructor(r){this.type=fr,this.input=r}static parse(r,s){if(r.length!==2)return s.error(`Expected 1 argument, but found ${r.length-1} instead.`);const u=s.parse(r[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Es(u.type)} instead.`):new wv(u):null}evaluate(r){const s=this.input.evaluate(r);if(typeof s=="string"||Array.isArray(s))return s.length;throw new us(`Expected value to be of type string or array, but found ${Es(zs(s))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(s=>{r.push(s.serialize())}),r}}function i1(a){return function(){a=1831565813+(a|=0)|0;let r=Math.imul(a^a>>>15,1|a);return r=r+Math.imul(r^r>>>7,61|r)^r,((r^r>>>14)>>>0)/4294967296}}const vh={"==":r1,"!=":n1,">":U2,"<":V2,">=":mg,"<=":$2,array:cr,at:yv,"at-interpolated":vv,boolean:cr,case:_h,coalesce:Tp,collator:ah,format:id,image:Br,in:xv,"index-of":Cp,interpolate:Pa,"interpolate-hcl":Pa,"interpolate-lab":Pa,length:wv,let:Ep,literal:bc,match:hg,number:cr,"number-format":bv,object:cr,slice:fg,step:wp,string:cr,"to-boolean":Yl,"to-color":Yl,"to-number":Yl,"to-string":Yl,var:sg,within:od,distance:ad,config:mh,split:pg};function Sv(a,[r,s,u,d]){r=r.evaluate(a),s=s.evaluate(a),u=u.evaluate(a);const g=d?d.evaluate(a):1,y=Hm(r,s,u,g);if(y)throw new us(y);return new Yn(r/255,s/255,u/255,g)}function s1(a,[r,s,u,d]){r=r.evaluate(a),s=s.evaluate(a),u=u.evaluate(a);const g=d?d.evaluate(a):1,y=function(E,k,j,R){return typeof E=="number"&&E>=0&&E<=360?typeof k=="number"&&k>=0&&k<=100&&typeof j=="number"&&j>=0&&j<=100?R===void 0||typeof R=="number"&&R>=0&&R<=1?null:`Invalid hsla value [${[E,k,j,R].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof R=="number"?[E,k,j,R]:[E,k,j]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof R=="number"?[E,k,j,R]:[E,k,j]).join(", ")}]: 'h' must be between 0 and 360.`}(r,s,u,g);if(y)throw new us(y);const b=`hsla(${r}, ${s}%, ${u}%, ${g})`,T=Yn.parse(b);if(!T)throw new us(`Failed to parse HSLA color: ${b}`);return T}function o1(a,r){return a in r}function gg(a,r){const s=r[a];return s===void 0?null:s}function Sc(a){return{type:a}}function Ap(a){if(a instanceof mh)return new Set([a.key]);let r=new Set;return a.eachChild(s=>{r=new Set([...r,...Ap(s)])}),r}function _g(a){if(a instanceof Oo&&a.name==="is-active-floor")return!0;let r=!1;return a.eachChild(s=>{!r&&_g(s)&&(r=!0)}),r}function ud(a){return{result:"success",value:a}}function mu(a){return{result:"error",value:a}}function Tv(a,r){return!!a&&!!a.parameters&&a.parameters.indexOf(r)>-1}function yg(a){return a["property-type"]==="data-driven"}function Ev(a){return Tv(a.expression,"measure-light")}function Cv(a){return Tv(a.expression,"zoom")}function vg(a){return!!a.expression&&a.expression.interpolated}function xg(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function Av(a){return a}function bg(a,r){const s=r.type==="color",u=a.stops&&typeof a.stops[0][0]=="object",d=u||!(u||a.property!==void 0),g=a.type||(vg(r)?"exponential":"interval");if(s&&((a=Object.assign({},a)).stops&&(a.stops=a.stops.map(E=>[E[0],Yn.parse(E[1])])),a.default=Yn.parse(a.default?a.default:r.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!dg[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let y,b,T;if(g==="exponential")y=a1;else if(g==="interval")y=gu;else if(g==="categorical"){y=q2,b=Object.create(null);for(const E of a.stops)b[E[0]]=E[1];T=typeof a.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);y=G2}if(u){const E={},k=[];for(let L=0;L<a.stops.length;L++){const z=a.stops[L],W=z[0].zoom;E[W]===void 0&&(E[W]={zoom:W,type:a.type,property:a.property,default:a.default,stops:[]},k.push(W)),E[W].stops.push([z[0].value,z[1]])}const j=[];for(const L of k)j.push([E[L].zoom,bg(E[L],r)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:Pa.interpolationFactor.bind(void 0,R),zoomStops:j.map(L=>L[0]),evaluate:({zoom:L},z)=>a1({stops:j,base:a.base},r,L).evaluate(L,z)}}if(d){const E=g==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Pa.interpolationFactor.bind(void 0,E),zoomStops:a.stops.map(k=>k[0]),evaluate:({zoom:k})=>y(a,r,k,b,T)}}return{kind:"source",evaluate(E,k){const j=k&&k.properties?k.properties[a.property]:void 0;return j===void 0?xh(a.default,r.default):y(a,r,j,b,T)}}}function xh(a,r,s){return a!==void 0?a:r!==void 0?r:s!==void 0?s:void 0}function q2(a,r,s,u,d){return xh(typeof s===d?u[s]:void 0,a.default,r.default)}function gu(a,r,s){if(!mp(s))return xh(a.default,r.default);const u=a.stops.length;if(u===1||s<=a.stops[0][0])return a.stops[0][1];if(s>=a.stops[u-1][0])return a.stops[u-1][1];const d=ag(a.stops.map(g=>g[0]),s);return a.stops[d][1]}function a1(a,r,s){const u=a.base!==void 0?a.base:1;if(!mp(s))return xh(a.default,r.default);const d=a.stops.length;if(d===1||s<=a.stops[0][0])return a.stops[0][1];if(s>=a.stops[d-1][0])return a.stops[d-1][1];const g=ag(a.stops.map(k=>k[0]),s),y=function(k,j,R,L){const z=L-R,W=k-R;return z===0?0:j===1?W/z:(Math.pow(j,W)-1)/(Math.pow(j,z)-1)}(s,u,a.stops[g][0],a.stops[g+1][0]),b=a.stops[g][1],T=a.stops[g+1][1];let E=vc[r.type]||Av;if(a.colorSpace&&a.colorSpace!=="rgb"){const k=dg[a.colorSpace];E=(j,R)=>k.reverse(k.interpolate(k.forward(j),k.forward(R),y))}return typeof b.evaluate=="function"?{evaluate(...k){const j=b.evaluate.apply(void 0,k),R=T.evaluate.apply(void 0,k);if(j!==void 0&&R!==void 0)return E(j,R,y)}}:E(b,T,y)}function G2(a,r,s){return r.type==="color"?s=Yn.parse(s):r.type==="formatted"?s=Vs.fromString(s.toString()):r.type==="resolvedImage"?s=Qo.build(s.toString()):oh(s)===r.type||r.type==="enum"&&r.values[s]||(s=void 0),xh(s,a.default,r.default)}Oo.register(vh,{error:[{kind:"error"},[Dn],(a,[r])=>{throw new us(r.evaluate(a))}],typeof:[Dn,[ti],(a,[r])=>Es(zs(r.evaluate(a)))],"to-rgba":[no(fr,4),[fa],(a,[r])=>r.evaluate(a).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[no(fr,4),[fa],(a,[r])=>r.evaluate(a).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[fa,[fr,fr,fr],Sv],rgba:[fa,[fr,fr,fr,fr],Sv],hsl:[fa,[fr,fr,fr],s1],hsla:[fa,[fr,fr,fr,fr],s1],has:{type:Xn,overloads:[[[Dn],(a,[r])=>o1(r.evaluate(a),a.properties())],[[Dn,ih],(a,[r,s])=>o1(r.evaluate(a),s.evaluate(a))]]},get:{type:ti,overloads:[[[Dn],(a,[r])=>gg(r.evaluate(a),a.properties())],[[Dn,ih],(a,[r,s])=>gg(r.evaluate(a),s.evaluate(a))]]},"feature-state":[ti,[Dn],(a,[r])=>gg(r.evaluate(a),a.featureState||{})],properties:[ih,[],a=>a.properties()],"geometry-type":[Dn,[],a=>a.geometryType()],worldview:[Dn,[],a=>a.globals.worldview||""],"is-active-floor":[Xn,Sc(Dn),(a,r)=>{if(!(a.globals.activeFloors&&a.globals.activeFloors.size>0))return!1;const s=a.globals.activeFloors;return r.some(u=>{const d=u.evaluate(a);return s.has(d)})}],id:[ti,[],a=>a.id()],zoom:[fr,[],a=>a.globals.zoom],pitch:[fr,[],a=>a.globals.pitch||0],"distance-from-center":[fr,[],a=>a.distanceFromCenter()],"measure-light":[fr,[Dn],(a,[r])=>a.measureLight(r.evaluate(a))],"heatmap-density":[fr,[],a=>a.globals.heatmapDensity||0],"line-progress":[fr,[],a=>a.globals.lineProgress||0],"raster-value":[fr,[],a=>a.globals.rasterValue||0],"raster-particle-speed":[fr,[],a=>a.globals.rasterParticleSpeed||0],"sky-radial-progress":[fr,[],a=>a.globals.skyRadialProgress||0],accumulated:[ti,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[fr,Sc(fr),(a,r)=>{let s=0;for(const u of r)s+=u.evaluate(a);return s}],"*":[fr,Sc(fr),(a,r)=>{let s=1;for(const u of r)s*=u.evaluate(a);return s}],"-":{type:fr,overloads:[[[fr,fr],(a,[r,s])=>r.evaluate(a)-s.evaluate(a)],[[fr],(a,[r])=>-r.evaluate(a)]]},"/":[fr,[fr,fr],(a,[r,s])=>r.evaluate(a)/s.evaluate(a)],"%":[fr,[fr,fr],(a,[r,s])=>r.evaluate(a)%s.evaluate(a)],ln2:[fr,[],()=>Math.LN2],pi:[fr,[],()=>Math.PI],e:[fr,[],()=>Math.E],"^":[fr,[fr,fr],(a,[r,s])=>Math.pow(r.evaluate(a),s.evaluate(a))],sqrt:[fr,[fr],(a,[r])=>Math.sqrt(r.evaluate(a))],log10:[fr,[fr],(a,[r])=>Math.log(r.evaluate(a))/Math.LN10],ln:[fr,[fr],(a,[r])=>Math.log(r.evaluate(a))],log2:[fr,[fr],(a,[r])=>Math.log2(r.evaluate(a))],sin:[fr,[fr],(a,[r])=>Math.sin(r.evaluate(a))],cos:[fr,[fr],(a,[r])=>Math.cos(r.evaluate(a))],tan:[fr,[fr],(a,[r])=>Math.tan(r.evaluate(a))],asin:[fr,[fr],(a,[r])=>Math.asin(r.evaluate(a))],acos:[fr,[fr],(a,[r])=>Math.acos(r.evaluate(a))],atan:[fr,[fr],(a,[r])=>Math.atan(r.evaluate(a))],min:[fr,Sc(fr),(a,r)=>Math.min(...r.map(s=>s.evaluate(a)))],max:[fr,Sc(fr),(a,r)=>Math.max(...r.map(s=>s.evaluate(a)))],abs:[fr,[fr],(a,[r])=>Math.abs(r.evaluate(a))],round:[fr,[fr],(a,[r])=>{const s=r.evaluate(a);return s<0?-Math.round(-s):Math.round(s)}],floor:[fr,[fr],(a,[r])=>Math.floor(r.evaluate(a))],ceil:[fr,[fr],(a,[r])=>Math.ceil(r.evaluate(a))],"filter-==":[Xn,[Dn,ti],(a,[r,s])=>a.properties()[r.value]===s.value],"filter-id-==":[Xn,[ti],(a,[r])=>a.id()===r.value],"filter-type-==":[Xn,[Dn],(a,[r])=>a.geometryType()===r.value],"filter-<":[Xn,[Dn,ti],(a,[r,s])=>{const u=a.properties()[r.value],d=s.value;return typeof u==typeof d&&u<d}],"filter-id-<":[Xn,[ti],(a,[r])=>{const s=a.id(),u=r.value;return typeof s==typeof u&&s<u}],"filter->":[Xn,[Dn,ti],(a,[r,s])=>{const u=a.properties()[r.value],d=s.value;return typeof u==typeof d&&u>d}],"filter-id->":[Xn,[ti],(a,[r])=>{const s=a.id(),u=r.value;return typeof s==typeof u&&s>u}],"filter-<=":[Xn,[Dn,ti],(a,[r,s])=>{const u=a.properties()[r.value],d=s.value;return typeof u==typeof d&&u<=d}],"filter-id-<=":[Xn,[ti],(a,[r])=>{const s=a.id(),u=r.value;return typeof s==typeof u&&s<=u}],"filter->=":[Xn,[Dn,ti],(a,[r,s])=>{const u=a.properties()[r.value],d=s.value;return typeof u==typeof d&&u>=d}],"filter-id->=":[Xn,[ti],(a,[r])=>{const s=a.id(),u=r.value;return typeof s==typeof u&&s>=u}],"filter-has":[Xn,[ti],(a,[r])=>r.value in a.properties()],"filter-has-id":[Xn,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Xn,[no(Dn)],(a,[r])=>r.value.indexOf(a.geometryType())>=0],"filter-id-in":[Xn,[no(ti)],(a,[r])=>r.value.indexOf(a.id())>=0],"filter-in-small":[Xn,[Dn,no(ti)],(a,[r,s])=>s.value.indexOf(a.properties()[r.value])>=0],"filter-in-large":[Xn,[Dn,no(ti)],(a,[r,s])=>function(u,d,g,y){for(;g<=y;){const b=g+y>>1;if(d[b]===u)return!0;d[b]>u?y=b-1:g=b+1}return!1}(a.properties()[r.value],s.value,0,s.value.length-1)],all:{type:Xn,overloads:[[[Xn,Xn],(a,[r,s])=>r.evaluate(a)&&s.evaluate(a)],[Sc(Xn),(a,r)=>{for(const s of r)if(!s.evaluate(a))return!1;return!0}]]},any:{type:Xn,overloads:[[[Xn,Xn],(a,[r,s])=>r.evaluate(a)||s.evaluate(a)],[Sc(Xn),(a,r)=>{for(const s of r)if(s.evaluate(a))return!0;return!1}]]},"!":[Xn,[Xn],(a,[r])=>!r.evaluate(a)],"is-supported-script":[Xn,[Dn],(a,[r])=>{const s=a.globals&&a.globals.isSupportedScript;return!s||s(r.evaluate(a))}],upcase:[Dn,[Dn],(a,[r])=>r.evaluate(a).toUpperCase()],downcase:[Dn,[Dn],(a,[r])=>r.evaluate(a).toLowerCase()],concat:[Dn,Sc(ti),(a,r)=>r.map(s=>Kl(s.evaluate(a))).join("")],"resolved-locale":[Dn,[up],(a,[r])=>r.evaluate(a).resolvedLocale()],random:[fr,[fr,fr,ti],(a,r)=>{const[s,u,d]=r.map(y=>y.evaluate(a));if(s>u||s===u)return s;let g;if(typeof d=="string")g=function(y){let b=0;if(y.length===0)return b;for(let T=0;T<y.length;T++)b=(b<<5)-b+y.charCodeAt(T),b|=0;return b}(d);else{if(typeof d!="number")throw new us(`Invalid seed input: ${d}`);g=d}return s+i1(g)()*(u-s)}]});class wg{constructor(r,s,u,d,g){this.expression=r,this._warningHistory={},this._scope=u,this._options=d,this._iconImageUseTheme=g,this._evaluator=new io(u,d,g),this._defaultValue=s?function(y){return y.type==="color"&&(xg(y.default)||Array.isArray(y.default))?new Yn(0,0,0,0):y.type==="color"?Yn.parse(y.default)||null:y.default===void 0?null:y.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null,this.configDependencies=Ap(r),this.isIndoorDependent=_g(r)}evaluateWithoutErrorHandling(r,s,u,d,g,y,b,T){return this._evaluator.globals=r,this._evaluator.feature=s,this._evaluator.featureState=u,this._evaluator.canonical=d||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(r,s,u,d,g,y,b,T,E){this._evaluator||(this._evaluator=new io(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=r,this._evaluator.feature=s||null,this._evaluator.featureState=u||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=T||null,this._evaluator.iconImageUseTheme=E||null;try{const k=this.expression.evaluate(this._evaluator);if(k==null||typeof k=="number"&&k!=k)return this._defaultValue;if(this._enumValues&&!(k in this._enumValues))throw new us(`Expected value to be one of ${Object.keys(this._enumValues).map(j=>JSON.stringify(j)).join(", ")}, but found ${JSON.stringify(k)} instead.`);return k}catch(k){return this._warningHistory[k.message]||(this._warningHistory[k.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${k.message}`)),this._defaultValue}}}function Sg(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in vh}function Ql(a,r,s,u,d){const g=new og(vh,[],r?function(b){const T={color:fa,string:Dn,number:fr,enum:Dn,boolean:Xn,formatted:nd,resolvedImage:dp};return b.type==="array"?no(T[b.value]||ti,b.length):T[b.type]}(r):void 0,void 0,void 0,s,u,d),y=g.parse(a,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return y?ud(new wg(y,r,s,u,d)):mu(g.errors)}class Ip{constructor(r,s,u,d){this.kind=r,this._styleExpression=s,this.isLightConstant=u,this.isLineProgressConstant=d,this.isStateDependent=r!=="constant"&&!bp(s.expression),this.configDependencies=Ap(s.expression),this.isIndoorDependent=_g(s.expression)}evaluateWithoutErrorHandling(r,s,u,d,g,y){return this._styleExpression.evaluateWithoutErrorHandling(r,s,u,d,g,y)}evaluate(r,s,u,d,g,y,b){return this._styleExpression.evaluate(r,s,u,d,g,y,void 0,void 0,b)}}class _u{constructor(r,s,u,d,g,y){this.kind=r,this.zoomStops=u,this._styleExpression=s,this.isStateDependent=r!=="camera"&&!bp(s.expression),this.isIndoorDependent=_g(s.expression),this.isLightConstant=g,this.isLineProgressConstant=y,this.configDependencies=Ap(s.expression),this.interpolationType=d}evaluateWithoutErrorHandling(r,s,u,d,g,y){return this._styleExpression.evaluateWithoutErrorHandling(r,s,u,d,g,y)}evaluate(r,s,u,d,g,y){return this._styleExpression.evaluate(r,s,u,d,g,y)}interpolationFactor(r,s,u){return this.interpolationType?Pa.interpolationFactor(this.interpolationType,r,s,u):0}}function Iv(a,r,s,u,d){if((a=Ql(a,r,s,u,d)).result==="error")return a;const g=a.value.expression,y=fh(g);if(!y&&!yg(r))return mu([new rl("","data expressions not supported")]);const b=ph(g,["zoom","pitch","distance-from-center"]);if(!b&&!Cv(r))return mu([new rl("","zoom expressions not supported")]);const T=ph(g,["measure-light"]);if(!T&&!Ev(r))return mu([new rl("","measure-light expression not supported")]);const E=ph(g,["line-progress"]);if(!E&&!function(R){return Tv(R.expression,"line-progress")}(r))return mu([new rl("","line-progress expression not supported")]);const k=r.expression&&r.expression.relaxZoomRestriction,j=Eg(g);return j||b||k?j instanceof rl?mu([j]):j instanceof Pa&&!vg(r)?mu([new rl("",'"interpolate" expressions cannot be used with this property')]):ud(j?new _u(y&&E?"camera":"composite",a.value,j.labels,j instanceof Pa?j.interpolation:void 0,T,E):new Ip(y&&E?"constant":"source",a.value,T,E)):mu([new rl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Tg{constructor(r,s){this._parameters=r,this._specification=s,Object.assign(this,bg(this._parameters,this._specification))}static deserialize(r){return new Tg(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function Eg(a){let r=null;if(a instanceof Ep)r=Eg(a.result);else if(a instanceof Tp){for(const s of a.args)if(r=Eg(s),r)break}else(a instanceof wp||a instanceof Pa)&&a.input instanceof Oo&&a.input.name==="zoom"&&(r=a);return r instanceof rl||a.eachChild(s=>{const u=Eg(s);u instanceof rl?r=u:r&&u&&r!==u&&(r=new rl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}var Pp,Cg,l1=function(){if(Cg)return Pp;Cg=1,Pp=r;var a=3;function r(s,u,d){var g=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var y=new Int32Array(this.arrayBuffer);s=y[0],this.d=(u=y[1])+2*(d=y[2]);for(var b=0;b<this.d*this.d;b++){var T=y[a+b],E=y[a+b+1];g.push(T===E?null:y.subarray(T,E))}var k=y[a+g.length+1];this.keys=y.subarray(y[a+g.length],k),this.bboxes=y.subarray(k),this.insert=this._insertReadonly}else{this.d=u+2*d;for(var j=0;j<this.d*this.d;j++)g.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=s,this.padding=d,this.scale=u/s,this.uid=0;var R=d/u*s;this.min=-R,this.max=s+R}return r.prototype.insert=function(s,u,d,g,y){this._forEachCell(u,d,g,y,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(y)},r.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},r.prototype._insertCell=function(s,u,d,g,y,b){this.cells[y].push(b)},r.prototype.query=function(s,u,d,g,y){var b=this.min,T=this.max;if(s<=b&&u<=b&&T<=d&&T<=g&&!y)return Array.prototype.slice.call(this.keys);var E=[];return this._forEachCell(s,u,d,g,this._queryCell,E,{},y),E},r.prototype._queryCell=function(s,u,d,g,y,b,T,E){var k=this.cells[y];if(k!==null)for(var j=this.keys,R=this.bboxes,L=0;L<k.length;L++){var z=k[L];if(T[z]===void 0){var W=4*z;(E?E(R[W+0],R[W+1],R[W+2],R[W+3]):s<=R[W+2]&&u<=R[W+3]&&d>=R[W+0]&&g>=R[W+1])?(T[z]=!0,b.push(j[z])):T[z]=!1}}},r.prototype._forEachCell=function(s,u,d,g,y,b,T,E){for(var k=this._convertToCellCoord(s),j=this._convertToCellCoord(u),R=this._convertToCellCoord(d),L=this._convertToCellCoord(g),z=k;z<=R;z++)for(var W=j;W<=L;W++){var J=this.d*W+z;if((!E||E(this._convertFromCellCoord(z),this._convertFromCellCoord(W),this._convertFromCellCoord(z+1),this._convertFromCellCoord(W+1)))&&y.call(this,s,u,d,g,J,b,T,E))return}},r.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},r.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},r.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,u=a+this.cells.length+1+1,d=0,g=0;g<this.cells.length;g++)d+=this.cells[g].length;var y=new Int32Array(u+d+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var b=u,T=0;T<s.length;T++){var E=s[T];y[a+T]=b,y.set(E,b),b+=E.length}return y[a+s.length]=b,y.set(this.keys,b),y[a+s.length+1]=b+=this.keys.length,y.set(this.bboxes,b),b+=this.bboxes.length,y.buffer},Pp}(),dd=Ni(l1);const bh={};function rr(a,r,s={}){Object.defineProperty(a,"_classRegistryKey",{value:r,writable:!1}),bh[r]={klass:a,omit:s.omit||[]}}rr(Object,"Object"),dd.serialize=function(a,r){const s=a.toArrayBuffer();return r&&r.add(s),{buffer:s}},dd.deserialize=function(a){return new dd(a.buffer)},Object.defineProperty(dd,"name",{value:"Grid"}),rr(dd,"Grid"),delete xt.prototype.constructor,typeof DOMMatrix<"u"&&rr(DOMMatrix,"DOMMatrix"),rr(Yn,"Color"),rr(Error,"Error"),rr(Vs,"Formatted"),rr(pp,"FormattedSection"),rr(td,"AJAXError"),rr(Qo,"ResolvedImage"),rr(Tg,"StylePropertyFunction"),rr(wg,"StyleExpression",{omit:["_evaluator"]}),rr(js,"ImageId"),rr(xc,"ImageVariant"),rr(_u,"ZoomDependentExpression"),rr(Ip,"ZoomConstantExpression"),rr(Oo,"CompoundExpression",{omit:["_evaluate"]});for(const a in vh)bh[vh[a]._classRegistryKey]||rr(vh[a],`Expression${a}`);function Pv(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Tc(a){return self.ImageBitmap&&a instanceof ImageBitmap}function yu(a,r){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Pv(a)||Tc(a))return r&&r.add(a),a;if(ArrayBuffer.isView(a))return r&&r.add(a.buffer),a;if(a instanceof ImageData)return r&&r.add(a.data.buffer),a;if(Array.isArray(a)){const s=[];for(const u of a)s.push(yu(u,r));return s}if(a instanceof Map){const s={$name:"Map",entries:[]};for(const[u,d]of a.entries())s.entries.push(yu(u),yu(d,r));return s}if(a instanceof Set){const s={$name:"Set"};let u=0;for(const d of a.values())s[++u]=yu(d);return s}if(a instanceof DOMMatrix){const s={$name:"DOMMatrix"},u=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const d of u)s[d]=a[d];return s}if(typeof a=="bigint")return{$name:"BigInt",value:a.toString()};if(typeof a=="object"){const s=a.constructor,u=s._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${s.name}".`);const d=s.serialize?s.serialize(a,r):{};if(!s.serialize){for(const g in a)a.hasOwnProperty(g)&&(bh[u].omit.indexOf(g)>=0||(d[g]=yu(a[g],r)));a instanceof Error&&(d.message=a.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(d.$name=u),d}throw new Error("can't serialize object of type "+typeof a)}function vu(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Pv(a)||Tc(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(vu);if(typeof a=="object"){const r=a.$name||"Object";if(r==="Map"){const d=a.entries||[],g=new Map;for(let y=0;y<d.length;y+=2)g.set(vu(d[y]),vu(d[y+1]));return g}if(r==="Set"){const d=new Set;for(const g of Object.keys(a))g!=="$name"&&d.add(vu(a[g]));return d}if(r==="DOMMatrix"){let d;return d=a.is2D?[a.a,a.b,a.c,a.d,a.e,a.f]:[a.m11,a.m12,a.m13,a.m14,a.m21,a.m22,a.m23,a.m24,a.m31,a.m32,a.m33,a.m34,a.m41,a.m42,a.m43,a.m44],new DOMMatrix(d)}if(r==="BigInt")return BigInt(a.value);const{klass:s}=bh[r];if(!s)throw new Error(`Can't deserialize unregistered class "${r}".`);if(s.deserialize)return s.deserialize(a);const u=Object.create(s.prototype);for(const d of Object.keys(a))d!=="$name"&&(u[d]=vu(a[d]));return u}throw new Error("can't deserialize object of type "+typeof a)}const Sr={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519,Osage:a=>a>=66736&&a<=66815,"CJK Unified Ideographs Extension B":a=>a>=131072&&a<=173791};function kv(a){for(const r of a)if(Ig(r.charCodeAt(0)))return!0;return!1}function c1(a){for(const r of a)if(!Ag(r.charCodeAt(0)))return!1;return!0}function Ag(a){return!(Sr.Arabic(a)||Sr["Arabic Supplement"](a)||Sr["Arabic Extended-A"](a)||Sr["Arabic Presentation Forms-A"](a)||Sr["Arabic Presentation Forms-B"](a))}function Ig(a){return!(a!==746&&a!==747&&(a<4352||!(Sr["Bopomofo Extended"](a)||Sr.Bopomofo(a)||Sr["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Sr["CJK Compatibility Ideographs"](a)||Sr["CJK Compatibility"](a)||Sr["CJK Radicals Supplement"](a)||Sr["CJK Strokes"](a)||!(!Sr["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Sr["CJK Unified Ideographs Extension A"](a)||Sr["CJK Unified Ideographs"](a)||Sr["Enclosed CJK Letters and Months"](a)||Sr["Hangul Compatibility Jamo"](a)||Sr["Hangul Jamo Extended-A"](a)||Sr["Hangul Jamo Extended-B"](a)||Sr["Hangul Jamo"](a)||Sr["Hangul Syllables"](a)||Sr.Hiragana(a)||Sr["Ideographic Description Characters"](a)||Sr.Kanbun(a)||Sr["Kangxi Radicals"](a)||Sr["Katakana Phonetic Extensions"](a)||Sr.Katakana(a)&&a!==12540||!(!Sr["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Sr["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Sr["Unified Canadian Aboriginal Syllabics"](a)||Sr["Unified Canadian Aboriginal Syllabics Extended"](a)||Sr["Vertical Forms"](a)||Sr["Yijing Hexagram Symbols"](a)||Sr["Yi Syllables"](a)||Sr["Yi Radicals"](a))))}function jv(a){return!(Ig(a)||function(r){return!!(Sr["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||Sr["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||Sr["Letterlike Symbols"](r)||Sr["Number Forms"](r)||Sr["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||Sr["Control Pictures"](r)&&r!==9251||Sr["Optical Character Recognition"](r)||Sr["Enclosed Alphanumerics"](r)||Sr["Geometric Shapes"](r)||Sr["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||Sr["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||Sr["CJK Symbols and Punctuation"](r)||Sr.Katakana(r)||Sr["Private Use Area"](r)||Sr["CJK Compatibility Forms"](r)||Sr["Small Form Variants"](r)||Sr["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(a))}function Rv(a){return Sr.Arabic(a)||Sr["Arabic Supplement"](a)||Sr["Arabic Extended-A"](a)||Sr["Arabic Presentation Forms-A"](a)||Sr["Arabic Presentation Forms-B"](a)}function u1(a){return a>=1424&&a<=2303||Sr["Arabic Presentation Forms-A"](a)||Sr["Arabic Presentation Forms-B"](a)}function W2(a,r){return!(!r&&u1(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Sr.Khmer(a))}function H2(a){for(const r of a)if(u1(r.charCodeAt(0)))return!0;return!1}const pa={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Mv=null,Wo=pa.unavailable,xu=null;const d1=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Wo=pa.error),Mv&&Mv(a)};function Dv(){Nv.fire(new Aa("pluginStateChange",{pluginStatus:Wo,pluginURL:xu}))}const Nv=new yc,Ov=function(){return Wo},Lv=function(){if(Wo!==pa.deferred||!xu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Wo=pa.loading,Dv(),xu&&th({url:xu},a=>{a?d1(a):(Wo=pa.loaded,Dv())})},ma={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Wo===pa.loaded||ma.applyArabicShaping!=null,isLoading:()=>Wo===pa.loading,setState(a){Wo=a.pluginStatus,xu=a.pluginURL},isParsing:()=>Wo===pa.parsing,isParsed:()=>Wo===pa.parsed,getPluginURL:()=>xu};class wi{constructor(r,s){this.zoom=r,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch,this.brightness=s.brightness,this.worldview=s.worldview,this.activeFloors=s.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(r){return function(s,u){for(const d of s)if(!W2(d.charCodeAt(0),u))return!1;return!0}(r,ma.isLoaded())}}class kp{constructor(r,s,u,d,g){this.property=r,this.value=s,this.expression=function(y,b,T,E,k){if(xg(y))return new Tg(y,b);if(Sg(y)||Array.isArray(y)&&y.length>0){const j=Iv(y,b,T,E,k);if(j.result==="error")throw new Error(j.value.map(R=>`${R.key}: ${R.message}`).join(", "));return j.value}{let j=y;return typeof y=="string"&&b.type==="color"&&(j=Yn.parse(y)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>j}}}(s===void 0?r.specification.default:s,r.specification,u,d,g)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,s,u,d){return this.property.possiblyEvaluate(this,r,s,u,d)}}class wh{constructor(r,s,u,d){this.property=r,this.value=new kp(r,void 0,s,u,d)}transitioned(r,s){return new f1(this.property,this.value,s,Object.assign({},r.transition,this.transition),r.now)}untransitioned(){return new f1(this.property,this.value,null,{},0)}}class h1{constructor(r,s,u,d){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues),this._scope=s,this._options=u,this._iconImageUseTheme=d,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(r){return dr(this._values[r].value.value)}setValue(r,s){this._values.hasOwnProperty(r)||(this._values[r]=new wh(this._values[r].property,this._scope,this._options,this._iconImageUseTheme)),this._values[r].value=new kp(this._values[r].property,s===null?void 0:dr(s),this._scope,this._options,this._iconImageUseTheme),this._values[r].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[r].value.isIndoorDependent())}setTransitionOrValue(r,s){s&&(this._options=s);const u=this._properties.properties;if(r)for(const d in r){const g=r[d];if(d.endsWith("-transition")){const y=d.slice(0,-11);u[y]&&this.setTransition(y,g)}else u.hasOwnProperty(d)&&this.setValue(d,g)}}getTransition(r){return dr(this._values[r].transition)}setTransition(r,s){this._values.hasOwnProperty(r)||(this._values[r]=new wh(this._values[r].property)),this._values[r].transition=dr(s)||void 0}serialize(){const r={};for(const s of Object.keys(this._values)){const u=this.getValue(s);u!==void 0&&(r[s]=u);const d=this.getTransition(s);d!==void 0&&(r[`${s}-transition`]=d)}return r}transitioned(r,s){const u=new Ec(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].transitioned(r,s._values[d]);return u}untransitioned(){const r=new Ec(this._properties);for(const s of Object.keys(this._values))r._values[s]=this._values[s].untransitioned();return r}isIndoorDependent(){return this._isIndoorDependent}}class f1{constructor(r,s,u,d,g){const y=d.delay||0,b=d.duration||0;g=g||0,this.property=r,this.value=s,this.begin=g+y,this.end=this.begin+b,r.specification.transition&&(d.delay||d.duration)&&(this.prior=u)}possiblyEvaluate(r,s,u){const d=r.now||0,g=this.value.possiblyEvaluate(r,s,u),y=this.prior;if(y){if(d>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(d<this.begin)return y.possiblyEvaluate(r,s,u);{const b=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(r,s,u),g,Kf(b))}}return g}}class Ec{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,s,u){const d=new hd(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(r,s,u);return d}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class zv{constructor(r,s,u,d){this._properties=r,this._values=Object.create(r.defaultPropertyValues),this._scope=s,this._options=u,this._iconImageUseTheme=d,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(r){return dr(this._values[r].value)}setValue(r,s){this._values[r]=new kp(this._values[r].property,s===null?void 0:dr(s),this._scope,this._options,this._iconImageUseTheme),this._values[r].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[r].isIndoorDependent())}serialize(){const r={};for(const s of Object.keys(this._values)){const u=this.getValue(s);u!==void 0&&(r[s]=u)}return r}possiblyEvaluate(r,s,u,d){const g=new hd(this._properties);for(const y of Object.keys(this._values))g._values[y]=this._values[y].possiblyEvaluate(r,s,u,d);return g}isIndoorDependent(){return this._isIndoorDependent}}class al{constructor(r,s,u,d){this.property=r,this.value=s,this.parameters=u,this.iconImageUseTheme=d}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,s,u,d){return this.property.evaluate(this.value,this.parameters,r,s,u,d,this.iconImageUseTheme)}}class hd{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class jt{constructor(r){this.specification=r}possiblyEvaluate(r,s){return r.expression.evaluate(s)}interpolate(r,s,u){const d=vc[this.specification.type];return d?d(r,s,u):r}}class Ht{constructor(r,s){this.specification=r,this.overrides=s}possiblyEvaluate(r,s,u,d,g){return r.expression.kind==="constant"||r.expression.kind==="camera"?new al(this,{kind:"constant",value:r.expression.evaluate(s,null,{},u,d,void 0,g)},s):new al(this,r.expression,s,g)}interpolate(r,s,u){if(r.value.kind!=="constant"||s.value.kind!=="constant")return r;if(r.value.value===void 0||s.value.value===void 0)return new al(this,{kind:"constant",value:void 0},r.parameters);const d=vc[this.specification.type];return d?new al(this,{kind:"constant",value:d(r.value.value,s.value.value,u)},r.parameters):r}evaluate(r,s,u,d,g,y,b){return r.kind==="constant"?r.value:r.evaluate(s,u,d,g,y,void 0,b)}}class Sh{constructor(r){this.specification=r}possiblyEvaluate(r,s,u,d){return!!r.expression.evaluate(s,null,{},u,d)}interpolate(){return!1}}class Ki{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new wi(0,{});for(const u in r){const d=r[u];d.specification.overridable&&this.overridableProperties.push(u);const g=this.defaultPropertyValues[u]=new kp(d,void 0),y=this.defaultTransitionablePropertyValues[u]=new wh(d);this.defaultTransitioningPropertyValues[u]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=g.possiblyEvaluate(s)}}}rr(Ht,"DataDrivenProperty"),rr(jt,"DataConstantProperty"),rr(Sh,"ColorRampProperty");var Ve=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Fv(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Th(a){if(Array.isArray(a))return a.map(Th);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const r={};for(const s in a)r[s]=Th(a[s]);return r}return Fv(a)}function Eh(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const r of a.slice(1))if(!Eh(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function Pg(a,r="",s=null,u="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Eh(a)||(a=ka(a));const d=a;let g=!0;try{g=function(k){if(!Ah(k))return k;let j=Th(k);return Ch(j),j=kg(j),j}(d)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(d,null,2)}
        `)}let y=null,b=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){b=Ve[`filter_${u}`];const k=Ql(g,b,r,s);if(k.result==="error")throw new Error(k.value.map(j=>`${j.key}: ${j.message}`).join(", "));y=(j,R,L)=>k.value.evaluate(j,R,{},L)}let T=null,E=null;if(g!==d){const k=Ql(d,b,r,s);if(k.result==="error")throw new Error(k.value.map(j=>`${j.key}: ${j.message}`).join(", "));T=(j,R,L,z,W)=>k.value.evaluate(j,R,{},L,void 0,void 0,z,W),E=!fh(k.value.expression)}return{filter:y,dynamicFilter:T||void 0,needGeometry:m1(g),needFeature:!!E}}function kg(a){if(!Array.isArray(a))return a;const r=function(s){if(Z2.has(s[0])){for(let u=1;u<s.length;u++)if(Ah(s[u]))return!0}return s}(a);return r===!0?r:r.map(s=>kg(s))}function Ch(a){let r=!1;const s=[];if(a[0]==="case"){for(let u=1;u<a.length-1;u+=2)r=r||Ah(a[u]),s.push(a[u+1]);s.push(a[a.length-1])}else if(a[0]==="match"){r=r||Ah(a[1]);for(let u=2;u<a.length-1;u+=2)s.push(a[u+1]);s.push(a[a.length-1])}else if(a[0]==="step"){r=r||Ah(a[1]);for(let u=1;u<a.length-1;u+=2)s.push(a[u+1])}r&&(a.length=0,a.push("any",...s));for(let u=1;u<a.length;u++)Ch(a[u])}function Ah(a){if(!Array.isArray(a))return!1;if((r=a[0])==="pitch"||r==="distance-from-center")return!0;var r;for(let s=1;s<a.length;s++)if(Ah(a[s]))return!0;return!1}const Z2=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function p1(a,r){return a<r?-1:a>r?1:0}function m1(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let r=1;r<a.length;r++)if(m1(a[r]))return!0;return!1}function ka(a){if(!a)return!0;const r=a[0];return a.length<=1?r!=="any":r==="=="?Bv(a[1],a[2],"=="):r==="!="?jg(Bv(a[1],a[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Bv(a[1],a[2],r):r==="any"?(s=a.slice(1),["any"].concat(s.map(ka))):r==="all"?["all"].concat(a.slice(1).map(ka)):r==="none"?["all"].concat(a.slice(1).map(ka).map(jg)):r==="in"?Vv(a[1],a.slice(2)):r==="!in"?jg(Vv(a[1],a.slice(2))):r==="has"?g1(a[1]):r!=="!has"||jg(g1(a[1]));var s}function Bv(a,r,s){switch(a){case"$type":return[`filter-type-${s}`,r];case"$id":return[`filter-id-${s}`,r];default:return[`filter-${s}`,a,r]}}function Vv(a,r){if(r.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(s=>typeof s!=typeof r[0])?["filter-in-large",a,["literal",r.sort(p1)]]:["filter-in-small",a,["literal",r]]}}function g1(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function jg(a){return["!",a]}const jp="";function fd(a,r){return r?`${a}${jp}${r}`:a}let _1;const y1=()=>_1||(_1=new Ki({"icon-size":new Ht(Ve.layout_symbol["icon-size"]),"icon-image":new Ht(Ve.layout_symbol["icon-image"]),"icon-rotate":new Ht(Ve.layout_symbol["icon-rotate"]),"icon-offset":new Ht(Ve.layout_symbol["icon-offset"])}));class X2{constructor(r,s,u,d,g,y){this.cachedIconPrimary=null;const b=Ql(r,Ve.appearance.condition);if(b.result==="success"&&(this.condition=b.value),this.name=s,u){this.properties=new hd(y1()),this.unevaluatedLayout=new zv(y1(),d,g,y);for(const T in u)this.unevaluatedLayout.setValue(T,u[T])}}hasCachedIconPrimary(){return this.cachedIconPrimary!==null}setCachedIconPrimary(r){this.cachedIconPrimary=r}getCachedIconPrimary(){return this.cachedIconPrimary}isActive(r){return!(this.condition||!r.isHidden||this.name!=="hidden")||this.condition.evaluate(r.globals,r.feature,r.featureState,r.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(r){return this.properties.get(r)}getUnevaluatedProperties(){return this.unevaluatedLayout}recalculate(r,s,u){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(r,void 0,s,u))}serialize(){const r={};return r.condition=this.condition.expression.serialize(),this.name&&(r.name=this.name),this.unevaluatedLayout&&(r.properties=this.unevaluatedLayout.serialize()),r}}const v1="-transition",K2=new Set(["fill","line","background","hillshade","raster"]);class Lo extends yc{constructor(r,s,u,d,g,y){if(super(),this.id=r.id,this.fqid=fd(this.id,u),this.type=r.type,this.scope=u,this.lut=d,this.options=g,this.iconImageUseTheme=y,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},r.type!=="custom"){if(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type&&r.type!=="background"&&r.type!=="sky"&&r.type!=="slot"){this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter;const b=Ql(this.filter,Ve[`filter_${r.type}`]);b.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...b.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||b.value.isIndoorDependent)}if(r.slot&&(this.slot=r.slot),r.appearances&&this.setAppearances(r.appearances),s.layout&&(this._unevaluatedLayout=new zv(s.layout,this.scope,g,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),s.paint){this._transitionablePaint=new h1(s.paint,this.scope,g);for(const b in r.paint)this.setPaintProperty(b,r.paint[b]);for(const b in r.layout)this.setLayoutProperty(b,r.layout[b]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new hd(s.paint)}}}onAdd(r){}onRemove(r){}isDraped(r){return!this.is3D(!0)&&K2.has(this.type)}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,s){if(this.type==="custom"&&r==="visibility")return void(this.visibility=s);const u=this._unevaluatedLayout;u._properties.properties[r]&&(u.setValue(r,s),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...u.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||u.isIndoorDependent(),r==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(r){this.appearances=[],r.forEach(s=>{this.appearances.push(new X2(s.condition,s.name,s.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(r){return r.endsWith(v1)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}isPaintProperty(r){return!!this._transitionablePaint._properties.properties[r]}setPaintProperty(r,s){const u=this._transitionablePaint,d=u._properties.properties;if(r.endsWith(v1)){const j=r.slice(0,-11);return d[j]&&u.setTransition(j,s||void 0),!1}if(!d[r])return!1;const g=u._values[r],y=g.value.isDataDriven(),b=g.value;u.setValue(r,s),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...u.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||u.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(r);const T=u._values[r].value,E=T.isDataDriven(),k=r.endsWith("pattern")||r==="line-dasharray";return E||y||k||this._handleOverridablePaintPropertyUpdate(r,b,T)}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getDefaultProgramParams(r,s,u){return null}_handleOverridablePaintPropertyUpdate(r,s,u){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,s,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,s)}serialize(){const r={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(r.appearances=this.appearances.map(s=>s.serialize())),Ct(r,(s,u)=>!(s===void 0||u==="layout"&&!Object.keys(s).length||u==="paint"&&!Object.keys(s).length))}is3D(r){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const r in this.paint._values){const s=this.paint.get(r);if(s instanceof al&&yg(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}for(const r of this.appearances)if(!bp(r.condition.expression))return!0;return!1}compileFilter(r){this._filterCompiled||(this._featureFilter=Pg(this.filter,this.scope,r),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(r){this._stats&&(r.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(r,s,u){return{}}queryRadius(r){}queryIntersectsFeature(r,s,u,d,g,y,b,T,E){}}const Y2={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Rp{constructor(r,s){this._structArray=r,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ii{constructor(){this.capacity=-1,this.resize(0)}static serialize(r,s){return r._trim(),s&&s.add(r.arrayBuffer),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const s=Object.create(this.prototype);return s.arrayBuffer=r.arrayBuffer,s.length=r.length,s.capacity=r.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...r){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...r){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function fn(a,r=1){let s=0,u=0;return{members:a.map(d=>{const g=Y2[d.type].BYTES_PER_ELEMENT,y=s=Uv(s,Math.max(r,g)),b=d.components||1;return u=Math.max(u,g),s+=g*b,{name:d.name,type:d.type,components:b,offset:y}}),size:Uv(s,Math.max(u,r)),alignment:r}}function Uv(a,r){return Math.ceil(a/r)*r}class ea extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s){const u=this.length;return this.resize(u+1),this.emplace(u,r,s)}emplace(r,s,u){const d=2*r;return this.int16[d+0]=s,this.int16[d+1]=u,r}}ea.prototype.bytesPerElement=4,rr(ea,"StructArrayLayout2i4");class pd extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,r,s,u)}emplace(r,s,u,d){const g=3*r;return this.int16[g+0]=s,this.int16[g+1]=u,this.int16[g+2]=d,r}}pd.prototype.bytesPerElement=6,rr(pd,"StructArrayLayout3i6");class Ih extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,u,d)}emplace(r,s,u,d,g){const y=4*r;return this.int16[y+0]=s,this.int16[y+1]=u,this.int16[y+2]=d,this.int16[y+3]=g,r}}Ih.prototype.bytesPerElement=8,rr(Ih,"StructArrayLayout4i8");class Cc extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.float32[1*r+0]=s,r}}Cc.prototype.bytesPerElement=4,rr(Cc,"StructArrayLayout1f4");class $v extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,r,s,u)}emplace(r,s,u,d){const g=4*r,y=2*r;return this.int16[g+0]=s,this.int16[g+1]=u,this.float32[y+1]=d,r}}$v.prototype.bytesPerElement=8,rr($v,"StructArrayLayout2i1f8");class qv extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,r,s,u)}emplace(r,s,u,d){const g=4*r;return this.int16[g+0]=s,this.int16[g+1]=u,this.int16[g+2]=d,r}}qv.prototype.bytesPerElement=8,rr(qv,"StructArrayLayout3i8");class Rg extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,s,u,d,g)}emplace(r,s,u,d,g,y){const b=5*r;return this.int16[b+0]=s,this.int16[b+1]=u,this.int16[b+2]=d,this.int16[b+3]=g,this.int16[b+4]=y,r}}Rg.prototype.bytesPerElement=10,rr(Rg,"StructArrayLayout5i10");class Mg extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,d,g,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,s,u,d,g,y,b)}emplace(r,s,u,d,g,y,b,T){const E=6*r,k=12*r,j=3*r;return this.int16[E+0]=s,this.int16[E+1]=u,this.uint8[k+4]=d,this.uint8[k+5]=g,this.uint8[k+6]=y,this.uint8[k+7]=b,this.float32[j+2]=T,r}}Mg.prototype.bytesPerElement=12,rr(Mg,"StructArrayLayout2i4ub1f12");class ja extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,r,s,u)}emplace(r,s,u,d){const g=3*r;return this.float32[g+0]=s,this.float32[g+1]=u,this.float32[g+2]=d,r}}ja.prototype.bytesPerElement=12,rr(ja,"StructArrayLayout3f12");class bu extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,s,u,d,g)}emplace(r,s,u,d,g,y){const b=6*r,T=3*r;return this.uint16[b+0]=s,this.uint16[b+1]=u,this.uint16[b+2]=d,this.uint16[b+3]=g,this.float32[T+2]=y,r}}bu.prototype.bytesPerElement=12,rr(bu,"StructArrayLayout4ui1f12");class md extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,u,d)}emplace(r,s,u,d,g){const y=4*r;return this.uint16[y+0]=s,this.uint16[y+1]=u,this.uint16[y+2]=d,this.uint16[y+3]=g,r}}md.prototype.bytesPerElement=8,rr(md,"StructArrayLayout4ui8");class Dg extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u,d,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,r,s,u,d,g,y)}emplace(r,s,u,d,g,y,b){const T=6*r;return this.int16[T+0]=s,this.int16[T+1]=u,this.int16[T+2]=d,this.int16[T+3]=g,this.int16[T+4]=y,this.int16[T+5]=b,r}}Dg.prototype.bytesPerElement=12,rr(Dg,"StructArrayLayout6i12");class Ng extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,u,d,g,y,b,T,E,k,j,R){const L=this.length;return this.resize(L+1),this.emplace(L,r,s,u,d,g,y,b,T,E,k,j,R)}emplace(r,s,u,d,g,y,b,T,E,k,j,R,L){const z=12*r;return this.int16[z+0]=s,this.int16[z+1]=u,this.int16[z+2]=d,this.int16[z+3]=g,this.uint16[z+4]=y,this.uint16[z+5]=b,this.uint16[z+6]=T,this.uint16[z+7]=E,this.int16[z+8]=k,this.int16[z+9]=j,this.int16[z+10]=R,this.int16[z+11]=L,r}}Ng.prototype.bytesPerElement=24,rr(Ng,"StructArrayLayout4i4ui4i24");class Ph extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,d,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,r,s,u,d,g,y)}emplace(r,s,u,d,g,y,b){const T=10*r,E=5*r;return this.int16[T+0]=s,this.int16[T+1]=u,this.int16[T+2]=d,this.float32[E+2]=g,this.float32[E+3]=y,this.float32[E+4]=b,r}}Ph.prototype.bytesPerElement=20,rr(Ph,"StructArrayLayout3i3f20");class wu extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,u,d)}emplace(r,s,u,d,g){const y=4*r;return this.float32[y+0]=s,this.float32[y+1]=u,this.float32[y+2]=d,this.float32[y+3]=g,r}}wu.prototype.bytesPerElement=16,rr(wu,"StructArrayLayout4f16");class Gv extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.uint32[1*r+0]=s,r}}Gv.prototype.bytesPerElement=4,rr(Gv,"StructArrayLayout1ul4");class ll extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s){const u=this.length;return this.resize(u+1),this.emplace(u,r,s)}emplace(r,s,u){const d=2*r;return this.uint16[d+0]=s,this.uint16[d+1]=u,r}}ll.prototype.bytesPerElement=4,rr(ll,"StructArrayLayout2ui4");class Wv extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,u,d,g,y,b,T,E,k,j,R,L){const z=this.length;return this.resize(z+1),this.emplace(z,r,s,u,d,g,y,b,T,E,k,j,R,L)}emplace(r,s,u,d,g,y,b,T,E,k,j,R,L,z){const W=20*r,J=10*r;return this.int16[W+0]=s,this.int16[W+1]=u,this.int16[W+2]=d,this.int16[W+3]=g,this.int16[W+4]=y,this.float32[J+3]=b,this.float32[J+4]=T,this.float32[J+5]=E,this.float32[J+6]=k,this.int16[W+14]=j,this.uint32[J+8]=R,this.uint16[W+18]=L,this.uint16[W+19]=z,r}}Wv.prototype.bytesPerElement=40,rr(Wv,"StructArrayLayout5i4f1i1ul2ui40");class Og extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u,d,g,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,s,u,d,g,y,b)}emplace(r,s,u,d,g,y,b,T){const E=8*r;return this.int16[E+0]=s,this.int16[E+1]=u,this.int16[E+2]=d,this.int16[E+4]=g,this.int16[E+5]=y,this.int16[E+6]=b,this.int16[E+7]=T,r}}Og.prototype.bytesPerElement=16,rr(Og,"StructArrayLayout3i2i2i16");class kh extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,u,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,s,u,d,g)}emplace(r,s,u,d,g,y){const b=4*r,T=8*r;return this.float32[b+0]=s,this.float32[b+1]=u,this.float32[b+2]=d,this.int16[T+6]=g,this.int16[T+7]=y,r}}kh.prototype.bytesPerElement=16,rr(kh,"StructArrayLayout2f1f2i16");class jh extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,d,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,r,s,u,d,g,y)}emplace(r,s,u,d,g,y,b){const T=20*r,E=5*r;return this.uint8[T+0]=s,this.uint8[T+1]=u,this.float32[E+1]=d,this.float32[E+2]=g,this.float32[E+3]=y,this.float32[E+4]=b,r}}jh.prototype.bytesPerElement=20,rr(jh,"StructArrayLayout2ub4f20");class Mi extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,r,s,u)}emplace(r,s,u,d){const g=3*r;return this.uint16[g+0]=s,this.uint16[g+1]=u,this.uint16[g+2]=d,r}}Mi.prototype.bytesPerElement=6,rr(Mi,"StructArrayLayout3ui6");class Rh extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,s,u,d,g,y,b,T,E,k,j,R,L,z,W,J,ee,oe,le,de,Se){const _e=this.length;return this.resize(_e+1),this.emplace(_e,r,s,u,d,g,y,b,T,E,k,j,R,L,z,W,J,ee,oe,le,de,Se)}emplace(r,s,u,d,g,y,b,T,E,k,j,R,L,z,W,J,ee,oe,le,de,Se,_e){const Ae=30*r,ke=15*r,De=60*r;return this.int16[Ae+0]=s,this.int16[Ae+1]=u,this.int16[Ae+2]=d,this.float32[ke+2]=g,this.float32[ke+3]=y,this.uint16[Ae+8]=b,this.uint16[Ae+9]=T,this.uint32[ke+5]=E,this.uint32[ke+6]=k,this.uint32[ke+7]=j,this.uint16[Ae+16]=R,this.uint16[Ae+17]=L,this.uint16[Ae+18]=z,this.float32[ke+10]=W,this.float32[ke+11]=J,this.uint8[De+48]=ee,this.uint8[De+49]=oe,this.uint8[De+50]=le,this.uint32[ke+13]=de,this.int16[Ae+28]=Se,this.uint8[De+58]=_e,r}}Rh.prototype.bytesPerElement=60,rr(Rh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Hv extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,s,u,d,g,y,b,T,E,k,j,R,L,z,W,J,ee,oe,le,de,Se,_e,Ae,ke,De,at,Ue,ct,pt,bt,Ot,It,gt){const At=this.length;return this.resize(At+1),this.emplace(At,r,s,u,d,g,y,b,T,E,k,j,R,L,z,W,J,ee,oe,le,de,Se,_e,Ae,ke,De,at,Ue,ct,pt,bt,Ot,It,gt)}emplace(r,s,u,d,g,y,b,T,E,k,j,R,L,z,W,J,ee,oe,le,de,Se,_e,Ae,ke,De,at,Ue,ct,pt,bt,Ot,It,gt,At){const nt=20*r,Ke=40*r,St=80*r;return this.float32[nt+0]=s,this.float32[nt+1]=u,this.int16[Ke+4]=d,this.int16[Ke+5]=g,this.int16[Ke+6]=y,this.int16[Ke+7]=b,this.int16[Ke+8]=T,this.int16[Ke+9]=E,this.int16[Ke+10]=k,this.int16[Ke+11]=j,this.int16[Ke+12]=R,this.uint16[Ke+13]=L,this.uint16[Ke+14]=z,this.uint16[Ke+15]=W,this.uint16[Ke+16]=J,this.uint16[Ke+17]=ee,this.uint16[Ke+18]=oe,this.uint16[Ke+19]=le,this.uint16[Ke+20]=de,this.uint16[Ke+21]=Se,this.uint16[Ke+22]=_e,this.uint16[Ke+23]=Ae,this.uint16[Ke+24]=ke,this.uint16[Ke+25]=De,this.uint16[Ke+26]=at,this.uint16[Ke+27]=Ue,this.uint32[nt+14]=ct,this.float32[nt+15]=pt,this.float32[nt+16]=bt,this.float32[nt+17]=Ot,this.float32[nt+18]=It,this.uint8[St+76]=gt,this.uint16[Ke+39]=At,r}}Hv.prototype.bytesPerElement=80,rr(Hv,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Zv extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,d,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,r,s,u,d,g,y)}emplace(r,s,u,d,g,y,b){const T=6*r;return this.float32[T+0]=s,this.float32[T+1]=u,this.float32[T+2]=d,this.float32[T+3]=g,this.float32[T+4]=y,this.float32[T+5]=b,r}}Zv.prototype.bytesPerElement=24,rr(Zv,"StructArrayLayout6f24");class gd extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,s,u,d,g)}emplace(r,s,u,d,g,y){const b=5*r;return this.float32[b+0]=s,this.float32[b+1]=u,this.float32[b+2]=d,this.float32[b+3]=g,this.float32[b+4]=y,r}}gd.prototype.bytesPerElement=20,rr(gd,"StructArrayLayout5f20");class Xv extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,d,g,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,s,u,d,g,y,b)}emplace(r,s,u,d,g,y,b,T){const E=7*r;return this.float32[E+0]=s,this.float32[E+1]=u,this.float32[E+2]=d,this.float32[E+3]=g,this.float32[E+4]=y,this.float32[E+5]=b,this.float32[E+6]=T,r}}Xv.prototype.bytesPerElement=28,rr(Xv,"StructArrayLayout7f28");class Mp extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,d,g,y,b,T,E,k,j){const R=this.length;return this.resize(R+1),this.emplace(R,r,s,u,d,g,y,b,T,E,k,j)}emplace(r,s,u,d,g,y,b,T,E,k,j,R){const L=11*r;return this.float32[L+0]=s,this.float32[L+1]=u,this.float32[L+2]=d,this.float32[L+3]=g,this.float32[L+4]=y,this.float32[L+5]=b,this.float32[L+6]=T,this.float32[L+7]=E,this.float32[L+8]=k,this.float32[L+9]=j,this.float32[L+10]=R,r}}Mp.prototype.bytesPerElement=44,rr(Mp,"StructArrayLayout11f44");class Kv extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,d,g,y,b,T,E){const k=this.length;return this.resize(k+1),this.emplace(k,r,s,u,d,g,y,b,T,E)}emplace(r,s,u,d,g,y,b,T,E,k){const j=9*r;return this.float32[j+0]=s,this.float32[j+1]=u,this.float32[j+2]=d,this.float32[j+3]=g,this.float32[j+4]=y,this.float32[j+5]=b,this.float32[j+6]=T,this.float32[j+7]=E,this.float32[j+8]=k,r}}Kv.prototype.bytesPerElement=36,rr(Kv,"StructArrayLayout9f36");class Su extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s){const u=this.length;return this.resize(u+1),this.emplace(u,r,s)}emplace(r,s,u){const d=2*r;return this.float32[d+0]=s,this.float32[d+1]=u,r}}Su.prototype.bytesPerElement=8,rr(Su,"StructArrayLayout2f8");class Yv extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,u,d)}emplace(r,s,u,d,g){const y=6*r;return this.uint32[3*r+0]=s,this.uint16[y+2]=u,this.uint16[y+3]=d,this.uint16[y+4]=g,r}}Yv.prototype.bytesPerElement=12,rr(Yv,"StructArrayLayout1ul3ui12");class Lg extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.uint16[1*r+0]=s,r}}Lg.prototype.bytesPerElement=2,rr(Lg,"StructArrayLayout1ui2");class zg extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,d,g,y,b,T,E,k,j,R,L,z,W,J){const ee=this.length;return this.resize(ee+1),this.emplace(ee,r,s,u,d,g,y,b,T,E,k,j,R,L,z,W,J)}emplace(r,s,u,d,g,y,b,T,E,k,j,R,L,z,W,J,ee){const oe=16*r;return this.float32[oe+0]=s,this.float32[oe+1]=u,this.float32[oe+2]=d,this.float32[oe+3]=g,this.float32[oe+4]=y,this.float32[oe+5]=b,this.float32[oe+6]=T,this.float32[oe+7]=E,this.float32[oe+8]=k,this.float32[oe+9]=j,this.float32[oe+10]=R,this.float32[oe+11]=L,this.float32[oe+12]=z,this.float32[oe+13]=W,this.float32[oe+14]=J,this.float32[oe+15]=ee,r}}zg.prototype.bytesPerElement=64,rr(zg,"StructArrayLayout16f64");class Mh extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,u,d,g,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,s,u,d,g,y,b)}emplace(r,s,u,d,g,y,b,T){const E=10*r,k=5*r;return this.uint16[E+0]=s,this.uint16[E+1]=u,this.uint16[E+2]=d,this.uint16[E+3]=g,this.float32[k+2]=y,this.float32[k+3]=b,this.float32[k+4]=T,r}}Mh.prototype.bytesPerElement=20,rr(Mh,"StructArrayLayout4ui3f20");class Jv extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.int16[1*r+0]=s,r}}Jv.prototype.bytesPerElement=2,rr(Jv,"StructArrayLayout1i2");class Fg extends Ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.uint8[1*r+0]=s,r}}Fg.prototype.bytesPerElement=1,rr(Fg,"StructArrayLayout1ub1");class Qv extends Rp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Qv.prototype.size=40;class x1 extends Wv{get(r){return new Qv(this,r)}}rr(x1,"CollisionBoxArray");class Bg extends Rp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}Bg.prototype.size=60;class Dp extends Rh{get(r){return new Bg(this,r)}}rr(Dp,"PlacedSymbolArray");class ex extends Rp{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(r){this._structArray.uint32[this._pos4+14]=r}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(r){this._structArray.float32[this._pos4+18]=r}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}ex.prototype.size=80;class b1 extends Hv{get(r){return new ex(this,r)}}rr(b1,"SymbolInstanceArray");class tx extends Cc{getoffsetX(r){return this.float32[1*r+0]}}rr(tx,"GlyphOffsetArray");class w1 extends ea{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}rr(w1,"SymbolLineVertexArray");class Vg extends Rp{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Vg.prototype.size=12;class S1 extends Yv{get(r){return new Vg(this,r)}}rr(S1,"FeatureIndexArray");class T1 extends ll{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}rr(T1,"FillExtrusionCentroidArray");class E1 extends Rp{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}E1.prototype.size=6;class C1 extends pd{get(r){return new E1(this,r)}}rr(C1,"FillExtrusionWallArray");const A1=fn([{name:"a_pos",components:2,type:"Int16"}],4),J2=fn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Q2=fn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Vi{constructor(r=[]){this.segments=r}_prepareSegment(r,s,u,d){let g=this.segments[this.segments.length-1];return r>Vi.MAX_VERTEX_ARRAY_LENGTH&&br(`Max vertices per segment is ${Vi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!g||g.vertexLength+r>Vi.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==d)&&(g={vertexOffset:s,primitiveOffset:u,vertexLength:0,primitiveLength:0},d!==void 0&&(g.sortKey=d),this.segments.push(g)),g}prepareSegment(r,s,u,d){return this._prepareSegment(r,s.length,u.length,d)}get(){return this.segments}destroy(){for(const r of this.segments)for(const s in r.vaos)r.vaos[s].destroy()}static simpleSegment(r,s,u,d){return new Vi([{vertexOffset:r,primitiveOffset:s,vertexLength:u,primitiveLength:d,vaos:{},sortKey:0}])}}function I1(a,r){return 256*(a=ie(Math.floor(a),0,255))+ie(Math.floor(r),0,255)}Vi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,rr(Vi,"SegmentVector");const eE=fn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),tE=fn([{name:"a_pattern_b",components:4,type:"Uint16"}]),rE=fn([{name:"a_dash",components:4,type:"Uint16"}]);class Np{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(r,s,u,d){this.ids.push(Op(r)),this.positions.push(s,u,d)}eachPosition(r,s){const u=Op(r);let d=0,g=this.ids.length-1;for(;d<g;){const y=d+g>>1;this.ids[y]>=u?g=y:d=y+1}for(;this.ids[d]===u;)s(this.positions[3*d],this.positions[3*d+1],this.positions[3*d+2]),d++}static serialize(r,s){const u=new Float64Array(r.ids),d=new Uint32Array(r.positions);return rx(u,d,0,u.length-1),s&&(s.add(u.buffer),s.add(d.buffer)),{ids:u,positions:d}}static deserialize(r){const s=new Np;let u;s.ids=r.ids,s.positions=r.positions;for(const d of s.ids)d!==u&&s.uniqueIds.push(d),u=d;return s.indexed=!0,s}}function Op(a){const r=+a;return Number.isSafeInteger(r)?r:op(String(a))}function rx(a,r,s,u){for(;s<u;){const d=a[s+u>>1];let g=s-1,y=u+1;for(;;){do g++;while(a[g]<d);do y--;while(a[y]>d);if(g>=y)break;Ug(a,g,y),Ug(r,3*g,3*y),Ug(r,3*g+1,3*y+1),Ug(r,3*g+2,3*y+2)}y-s<u-y?(rx(a,r,s,y),s=y+1):(rx(a,r,y+1,u),u=y)}}function Ug(a,r,s){const u=a[r];a[r]=a[s],a[s]=u}rr(Np,"FeaturePositionMap");class cl{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,s),this.initialized=!0),!!this.location}set(r,s,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class $g extends cl{constructor(r){super(r),this.current=0}set(r,s,u){this.fetchUniformLocation(r,s)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class ms extends cl{constructor(r){super(r),this.current=0}set(r,s,u){this.fetchUniformLocation(r,s)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class ec extends cl{constructor(r){super(r),this.current=[0,0]}set(r,s,u){this.fetchUniformLocation(r,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class Dh extends cl{constructor(r){super(r),this.current=[0,0,0]}set(r,s,u){this.fetchUniformLocation(r,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class Lp extends cl{constructor(r){super(r),this.current=[0,0,0,0]}set(r,s,u){this.fetchUniformLocation(r,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class nx extends cl{constructor(r){super(r),this.current=Yn.transparent.toPremultipliedRenderColor(null)}set(r,s,u){this.fetchUniformLocation(r,s)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const P1=new Float32Array(16);class zp extends cl{constructor(r){super(r),this.current=P1}set(r,s,u){if(this.fetchUniformLocation(r,s)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let d=1;d<16;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const nE=new Float32Array(9),k1=new Float32Array(4);class ix extends cl{constructor(r){super(r),this.current=k1}set(r,s,u){if(this.fetchUniformLocation(r,s)){for(let d=0;d<4;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function sx(a){return[I1(255*a.r,255*a.g),I1(255*a.b,255*a.a)]}function qg(a,r,s,u,d,g,y,b){return!!a&&(a.kind==="composite"||a.kind==="source"?a.evaluate(new wi(0,{brightness:g,worldview:b}),r,s,d,u,y)==="none":a.value==="none")}class Gg{constructor(r,s,u,d){this.value=r,this.uniformNames=s.map(g=>`u_${g}`),this.type=u,this.context=d}setUniform(r,s,u,d,g){const y=d.constantOr(this.value);s.set(r,g,y instanceof Yn?y.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):y)}getBinding(r,s){return this.type==="color"?new nx(r):new ms(r)}}class Fp{constructor(r,s){this.uniformNames=s.map(u=>`u_${u}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(r,s){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br),this.patternTransition=s?s.tl.concat(s.br):this.pattern}setUniform(r,s,u,d,g){let y=null;g!=="u_pattern"&&g!=="u_dash"||(y=this.pattern),g==="u_pattern_b"&&(y=this.patternTransition),g==="u_pixel_ratio"&&(y=this.pixelRatio),y&&s.set(r,g,y)}getBinding(r,s){return s==="u_pattern"||s==="u_pattern_b"||s==="u_dash"?new Lp(r):new ms(r)}}class Ac{constructor(r,s,u,d){this.expression=r,this.type=u,this.maxValue=0,this.paintVertexAttributes=s.map(g=>({name:`a_${g}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(r,s,u,d,g,y,b,T){const E=this.paintVertexArray.length,k=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new wi(0,{brightness:y,worldview:T}),s,{},g,d,b):this.expression.kind==="constant"&&this.expression.value,j=qg(this.lutExpression,s,{},d,g,y,b,T);this.paintVertexArray.resize(r),this._setPaintValue(E,r,k,j?null:this.context.lut)}updatePaintArray(r,s,u,d,g,y,b,T){const E=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:b,worldview:T},u,d,void 0,g):this.expression.kind==="constant"&&this.expression.value,k=qg(this.lutExpression,u,d,g,void 0,b,void 0,T);this._setPaintValue(r,s,E,k?null:this.context.lut)}_setPaintValue(r,s,u,d){if(this.type==="color"){const g=sx(u.toPremultipliedRenderColor(d));for(let y=r;y<s;y++)this.paintVertexArray.emplace(y,g[0],g[1])}else{for(let g=r;g<s;g++)this.paintVertexArray.emplace(g,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Pl{constructor(r,s,u,d,g,y){this.expression=r,this.uniformNames=s.map(b=>`u_${b}_t`),this.type=u,this.useIntegerZoom=d,this.context=g,this.maxValue=0,this.paintVertexAttributes=s.map(b=>({name:`a_${b}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(r,s,u,d,g,y,b,T){const E=this.expression.evaluate(new wi(this.context.zoom,{brightness:y,worldview:T}),s,{},g,d,b),k=this.expression.evaluate(new wi(this.context.zoom+1,{brightness:y,worldview:T}),s,{},g,d,b),j=qg(this.lutExpression,s,{},d,g,y,b,T),R=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(R,r,E,k,j?null:this.context.lut)}updatePaintArray(r,s,u,d,g,y,b,T){const E=this.expression.evaluate({zoom:this.context.zoom,brightness:b,worldview:T},u,d,void 0,g),k=this.expression.evaluate({zoom:this.context.zoom+1,brightness:b,worldview:T},u,d,void 0,g),j=qg(this.lutExpression,u,d,g,void 0,b,void 0,T);this._setPaintValue(r,s,E,k,j?null:this.context.lut)}_setPaintValue(r,s,u,d,g){if(this.type==="color"){const y=sx(u.toPremultipliedRenderColor(g)),b=sx(u.toPremultipliedRenderColor(g));for(let T=r;T<s;T++)this.paintVertexArray.emplace(T,y[0],y[1],b[0],b[1])}else{for(let y=r;y<s;y++)this.paintVertexArray.emplace(y,u,d);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(d))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,s,u,d,g){const y=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,b=ie(this.expression.interpolationFactor(y,this.context.zoom,this.context.zoom+1),0,1);s.set(r,g,b)}getBinding(r,s){return new ms(r)}}class So{constructor(r,s,u,d,g){this.expression=r,this.layerId=g,this.paintVertexAttributes=(u==="array"?rE:eE).members;for(let y=0;y<s.length;++y);this.paintVertexArray=new d,this.paintTransitionVertexArray=new md}populatePaintArray(r,s,u,d){const g=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(g,r,s.patterns&&s.patterns[this.layerId],u)}updatePaintArray(r,s,u,d,g,y,b){this._setPaintValues(r,s,u.patterns&&u.patterns[this.layerId],y)}_setPaintValues(r,s,u,d){if(!d||!u)return;const g=d[u[0]],y=d[u[1]];if(g){if(g){const{tl:b,br:T,pixelRatio:E}=g;for(let k=r;k<s;k++)this.paintVertexArray.emplace(k,b[0],b[1],T[0],T[1],E)}if(y){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:b,br:T}=y;for(let E=r;E<s;E++)this.paintTransitionVertexArray.emplace(E,b[0],b[1],T[0],T[1])}}}upload(r){const s=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,s)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=r.createVertexBuffer(this.paintTransitionVertexArray,tE.members,s))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Ic{constructor(r,s,u=()=>!0){this.binders={},this._buffers=[],this.context=s;const d=[];for(const g in r.paint._values){const y=r.paint.get(g);if(g.endsWith("-use-theme")||!u(g)||!(y instanceof al&&yg(y.property.specification)))continue;const b=sE(g,r.type),T=y.value,E=y.property.specification.type,k=!!y.property.useIntegerZoom,j=g==="line-dasharray"||g.endsWith("pattern"),R=r.paint.get(`${g}-use-theme`),L=g==="line-dasharray"&&r.layout.get("line-cap").value.kind!=="constant"||R&&R.value.kind!=="constant";if(T.kind!=="constant"||L)if(T.kind==="source"||L||j){const z=ox(g,E,"source");this.binders[g]=j?new So(T,b,E,z,r.id):new Ac(T,b,E,z),d.push(`/a_${g}`)}else{const z=ox(g,E,"composite");this.binders[g]=new Pl(T,b,E,k,s,z),d.push(`/z_${g}`)}else this.binders[g]=j?new Fp(T.value,b):new Gg(T.value,b,E,s),d.push(`/u_${g}`);R&&(this.binders[g].lutExpression=R.value)}this.cacheKey=d.sort().join("")}getMaxValue(r){const s=this.binders[r];return s instanceof Ac||s instanceof Pl?s.maxValue:0}populatePaintArrays(r,s,u,d,g,y,b,T){for(const E in this.binders){const k=this.binders[E];k.context=this.context,(k instanceof Ac||k instanceof Pl||k instanceof So)&&k.populatePaintArray(r,s,u,d,g,y,b,T)}}setConstantPatternPositions(r,s){for(const u in this.binders){const d=this.binders[u];d instanceof Fp&&d.setConstantPatternPositions(r,s)}}getPatternTransitionVertexBuffer(r){const s=this.binders[r];return s instanceof So?s.paintTransitionVertexBuffer:null}updatePaintArrays(r,s,u,d,g,y,b,T,E,k){let j=!1;const R=Object.keys(r),L=R.length!==0&&!T,z=L?R:s.uniqueIds;this.context.lut=g.lut;for(const W in this.binders){const J=this.binders[W];if(J.context=this.context,(J instanceof Ac||J instanceof Pl||J instanceof So)&&J.expression&&J.expression.kind&&J.expression.kind!=="constant"&&(J.expression.isStateDependent===!0||J.expression.isLightConstant===!1)){const ee=g.paint.get(W);J.expression=ee.value;for(const oe of z){const le=r[oe.toString()];s.eachPosition(oe,(de,Se,_e)=>{const Ae=d.feature(de);J.updatePaintArray(Se,_e,Ae,le,y,b,E,k)})}if(!L)for(const oe of u.uniqueIds){const le=r[oe.toString()];u.eachPosition(oe,(de,Se,_e)=>{const Ae=d.feature(de);J.updatePaintArray(Se,_e,Ae,le,y,b,E,k)})}j=!0}}return j}defines(){const r=[];for(const s in this.binders){const u=this.binders[s];(u instanceof Gg||u instanceof Fp)&&r.push(...u.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const s=[];for(const u in this.binders){const d=this.binders[u];if(d instanceof Gg||d instanceof Fp||d instanceof Pl)for(const g of d.uniformNames)s.push({name:g,property:u,binding:d.getBinding(r,g)})}return s}setUniforms(r,s,u,d,g){for(const{name:y,property:b,binding:T}of u)this.binders[b].setUniform(r,T,g,d.get(b),y)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const s=this.binders[r];(s instanceof Ac||s instanceof Pl||s instanceof So)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer),s instanceof So&&s.paintTransitionVertexBuffer&&this._buffers.push(s.paintTransitionVertexBuffer)}}upload(r){for(const s in this.binders){const u=this.binders[s];(u instanceof Ac||u instanceof Pl||u instanceof So)&&u.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const s=this.binders[r];(s instanceof Ac||s instanceof Pl||s instanceof So)&&s.destroy()}}}class kl{constructor(r,s,u=()=>!0){this.programConfigurations={};for(const d of r)this.programConfigurations[d.id]=new Ic(d,s,u);this.needsUpload=!1,this._featureMap=new Np,this._featureMapWithoutIds=new Np,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(r,s,u,d,g,y,b,T,E){for(const k in this.programConfigurations)this.programConfigurations[k].populatePaintArrays(r,s,d,g,y,b,T,E);s.id!==void 0?this._featureMap.add(s.id,u,this._bufferOffset,r):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,r),this._idlessCounter+=1),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,s,u,d,g,y,b,T){for(const E of u)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(r,this._featureMap,this._featureMapWithoutIds,s,E,d,g,y,b||0,T)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const iE={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function sE(a,r){return iE[a]||[a.replace(`${r}-`,"").replace(/-/g,"_")]}const oE={"line-pattern":{source:bu,composite:bu},"fill-pattern":{source:bu,composite:bu},"fill-extrusion-pattern":{source:bu,composite:bu},"line-dasharray":{source:md,composite:md}},aE={color:{source:Su,composite:wu},number:{source:Cc,composite:Su}};function ox(a,r,s){const u=oE[a];return u&&u[s]||aE[r][s]}rr(Gg,"ConstantBinder"),rr(Fp,"PatternConstantBinder"),rr(Ac,"SourceExpressionBinder"),rr(So,"PatternCompositeBinder"),rr(Pl,"CompositeExpressionBinder"),rr(Ic,"ProgramConfiguration",{omit:["_buffers"]}),rr(kl,"ProgramConfigurationSet");const ta=zt/Math.PI/2,p=5,n=6,l=16383,m=64,v=[m,32,16],w=-ta,S=ta;function C(a,r,s,u=ta){return s=ln(s),[a*Math.sin(s)*u,-r*u,a*Math.cos(s)*u]}function A(a,r,s){return C(Math.cos(ln(a)),Math.sin(ln(a)),r,s)}const M=63710088e-1,D=2*Math.PI*M;class F{constructor(r,s){if(isNaN(r)||isNaN(s))throw new Error(`Invalid LngLat object: (${r}, ${s})`);if(this.lng=+r,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new F(Pe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const s=Math.PI/180,u=this.lat*s,d=r.lat*s,g=Math.sin(u)*Math.sin(d)+Math.cos(u)*Math.cos(d)*Math.cos((r.lng-this.lng)*s);return M*Math.acos(Math.min(g,1))}toBounds(r=0){const s=360*r/40075017,u=s/Math.cos(Math.PI/180*this.lat);return new O({lng:this.lng-u,lat:this.lat-s},{lng:this.lng+u,lat:this.lat+s})}toEcef(r){return A(this.lat,this.lng,ta+r*ta/M)}static convert(r){if(r instanceof F)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new F(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new F(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class O{constructor(r,s){r&&(s?this.setSouthWest(r).setNorthEast(s):Array.isArray(r)&&r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof F?new F(r.lng,r.lat):F.convert(r),this}setSouthWest(r){return this._sw=r instanceof F?new F(r.lng,r.lat):F.convert(r),this}extend(r){const s=this._sw,u=this._ne;let d,g;if(r instanceof F)d=r,g=r;else{if(!(r instanceof O))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(O.convert(r)):this.extend(F.convert(r)):typeof r=="object"&&r!==null&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(F.convert(r)):this;if(d=r._sw,g=r._ne,!d||!g)return this}return s||u?(s.lng=Math.min(d.lng,s.lng),s.lat=Math.min(d.lat,s.lat),u.lng=Math.max(g.lng,u.lng),u.lat=Math.max(g.lat,u.lat)):(this._sw=new F(d.lng,d.lat),this._ne=new F(g.lng,g.lat)),this}getCenter(){return new F((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new F(this.getWest(),this.getNorth())}getSouthEast(){return new F(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:s,lat:u}=F.convert(r);let d=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(r){if(r)return r instanceof O?r:new O(r)}}const q=0,Z=25.5;function Q(a){return D*Math.cos(a*Math.PI/180)}function se(a){return(180+a)/360}function ne(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function ae(a,r){return a/Q(r)}function he(a){return 360*a-180}function ce(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function we(a,r){return a*Q(ce(r))}const fe=85.051129;function Te(a){return Math.cos(ln(ie(a,-fe,fe)))}function ve(a,r){const s=ie(r,q,Z),u=Math.pow(2,s);return Te(a)*D/(512*u)}function ge(a){return 1/Math.cos(a*Math.PI/180)}function Ce(a,r=0){const s=Math.exp(Math.PI*(1-(a.y+r/zt)/(1<<a.z)*2));return 80150034*s/(s*s+1)/zt/(1<<a.z)}class Fe{constructor(r,s,u=0){this.x=+r,this.y=+s,this.z=+u}static fromLngLat(r,s=0){const u=F.convert(r);return new Fe(se(u.lng),ne(u.lat),ae(s,u.lat))}toLngLat(){return new F(he(this.x),ce(this.y))}toAltitude(){return we(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/D*ge(ce(this.y))}}function Oe(a,r,s,u,d,g,y,b,T){const E=(r+u)/2,k=(s+d)/2,j=new xt(E,k);b(j),function(R,L,z,W,J,ee){const oe=z-J,le=W-ee;return Math.abs((W-L)*oe-(z-R)*le)/Math.hypot(oe,le)}(j.x,j.y,g.x,g.y,y.x,y.y)>=T?(Oe(a,r,s,E,k,g,j,b,T),Oe(a,E,k,u,d,j,y,b,T)):a.push(y)}function st(a,r,s){let u=a[0],d=u.x,g=u.y;r(u);const y=[u];for(let b=1;b<a.length;b++){const T=a[b],{x:E,y:k}=T;r(T),Oe(y,d,g,E,k,u,T,r,s),d=E,g=k,u=T}return y}function He(a,r,s,u){if(u(r,s)){const d=r.add(s)._mult(.5);He(a,r,d,u),He(a,d,s,u)}else a.push(s)}function ht(a,r){let s=a[0];const u=[s];for(let d=1;d<a.length;d++){const g=a[d];He(u,s,g,r),s=g}return u}const Nt=Math.pow(2,14)-1,Ge=-Nt-1;function Re(a,r){const s=Math.round(a.x*r),u=Math.round(a.y*r);return a.x=ie(s,Ge,Nt),a.y=ie(u,Ge,Nt),(s<a.x||s>a.x+1||u<a.y||u>a.y+1)&&br("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function ft(a,r,s){const u=a.loadGeometry(),d=a.extent,g=zt/d;if(r&&s&&s.projection.isReprojectedInTileSpace){const y=1<<r.z,{scale:b,x:T,y:E,projection:k}=s,j=R=>{const L=he((r.x+R.x/d)/y),z=ce((r.y+R.y/d)/y),W=k.project(L,z);R.x=(W.x*b-T)*d,R.y=(W.y*b-E)*d};for(let R=0;R<u.length;R++)if(a.type!==1)u[R]=st(u[R],j,1);else{const L=[];for(const z of u[R])z.x<0||z.x>=d||z.y<0||z.y>=d||(j(z),L.push(z));u[R]=L}}for(const y of u)for(const b of y)Re(b,g);return u}function Ze(a,r){return{type:a.type,id:a.id,properties:a.properties,geometry:r?ft(a):[]}}class wt{constructor(r,s,u,d,g){this.properties={},this.extent=u,this.type=0,this.id=void 0,this._pbf=r,this._geometry=-1,this._keys=d,this._values=g,r.readFields(Ft,this,s)}loadGeometry(){const r=this._pbf;r.pos=this._geometry;const s=r.readVarint()+r.pos,u=[];let d,g=1,y=0,b=0,T=0;for(;r.pos<s;){if(y<=0){const E=r.readVarint();g=7&E,y=E>>3}if(y--,g===1||g===2)b+=r.readSVarint(),T+=r.readSVarint(),g===1&&(d&&u.push(d),d=[]),d&&d.push(new xt(b,T));else{if(g!==7)throw new Error(`unknown command ${g}`);d&&d.push(d[0].clone())}}return d&&u.push(d),u}bbox(){const r=this._pbf;r.pos=this._geometry;const s=r.readVarint()+r.pos;let u=1,d=0,g=0,y=0,b=1/0,T=-1/0,E=1/0,k=-1/0;for(;r.pos<s;){if(d<=0){const j=r.readVarint();u=7&j,d=j>>3}if(d--,u===1||u===2)g+=r.readSVarint(),y+=r.readSVarint(),g<b&&(b=g),g>T&&(T=g),y<E&&(E=y),y>k&&(k=y);else if(u!==7)throw new Error(`unknown command ${u}`)}return[b,E,T,k]}toGeoJSON(r,s,u){const d=this.extent*Math.pow(2,u),g=this.extent*r,y=this.extent*s,b=this.loadGeometry();function T(R){return[360*(R.x+g)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(R.y+y)/d)*Math.PI))-90]}function E(R){return R.map(T)}let k;if(this.type===1){const R=[];for(const z of b)R.push(z[0]);const L=E(R);k=R.length===1?{type:"Point",coordinates:L[0]}:{type:"MultiPoint",coordinates:L}}else if(this.type===2){const R=b.map(E);k=R.length===1?{type:"LineString",coordinates:R[0]}:{type:"MultiLineString",coordinates:R}}else{if(this.type!==3)throw new Error("unknown feature type");{const R=function(z){const W=z.length;if(W<=1)return[z];const J=[];let ee,oe;for(let le=0;le<W;le++){const de=sr(z[le]);de!==0&&(oe===void 0&&(oe=de<0),oe===de<0?(ee&&J.push(ee),ee=[z[le]]):ee&&ee.push(z[le]))}return ee&&J.push(ee),J}(b),L=[];for(const z of R)L.push(z.map(E));k=L.length===1?{type:"Polygon",coordinates:L[0]}:{type:"MultiPolygon",coordinates:L}}}const j={type:"Feature",geometry:k,properties:this.properties};return this.id!=null&&(j.id=this.id),j}}function Ft(a,r,s){a===1?r.id=s.readVarint():a===2?function(u,d){const g=u.readVarint()+u.pos;for(;u.pos<g;){const y=d._keys[u.readVarint()],b=d._values[u.readVarint()];d.properties[y]=b}}(s,r):a===3?r.type=s.readVarint():a===4&&(r._geometry=s.pos)}function sr(a){let r=0;for(let s,u,d=0,g=a.length,y=g-1;d<g;y=d++)s=a[d],u=a[y],r+=(u.x-s.x)*(s.y+u.y);return r}wt.types=["Unknown","Point","LineString","Polygon"];class Rt{constructor(r,s){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(Lt,this,s),this.length=this._features.length}feature(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];const s=this._pbf.readVarint()+this._pbf.pos;return new wt(this._pbf,s,this.extent,this._keys,this._values)}}function Lt(a,r,s){a===15?r.version=s.readVarint():a===1?r.name=s.readString():a===5?r.extent=s.readVarint():a===2?r._features.push(s.pos):a===3?r._keys.push(s.readString()):a===4&&r._values.push(function(u){let d=null;const g=u.readVarint()+u.pos;for(;u.pos<g;){const y=u.readVarint()>>3;d=y===1?u.readString():y===2?u.readFloat():y===3?u.readDouble():y===4?u.readVarint64():y===5?u.readVarint():y===6?u.readSVarint():y===7?u.readBoolean():null}if(d==null)throw new Error("unknown feature value");return d}(s))}class ar{constructor(r,s){this.layers=r.readFields(Jt,{},s)}}function Jt(a,r,s){if(a===3){const u=new Rt(s,s.readVarint()+s.pos);u.length&&(r[u.name]=u)}}const Zt="3d_elevation_id",Qt="level";class Tr{constructor(){this._valid=!1}reset(r){return this.feature=r,this._valid=!0,this._geometry=r.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(r,s){return this._valid&&r(s(this._geometry)),this}require(r,s,u){return this.get(r,!0,s,u)}optional(r,s,u){return this.get(r,!1,s,u)}success(){return this._valid}get(r,s,u,d){const g=this.feature.properties.hasOwnProperty(r)?+this.feature.properties[r]:void 0;return this._valid&&g!==void 0&&!Number.isNaN(g)?u(d?d(g):g):s&&(this._valid=!1),this}}class pn{constructor(r,s){this.featureFunc=r,this.vertexFunc=s}parseFeature(r,s,u){return this.featureFunc(r,s,u)}parseVertex(r,s,u){return this.vertexFunc(r,s,u)}}const En=new pn((a,r,s)=>a.reset(r).require(Zt,u=>{s.id=u}).optional("fixed_height_relative",u=>{s.constantHeight=u},Nr.decodeRelativeHeight).geometry(u=>{s.bounds=u},_p).success(),(a,r,s)=>a.reset(r).require(Zt,u=>{s.id=u}).require("elevation_idx",u=>{s.idx=u}).require("extent",u=>{s.extent=u}).require("height_relative",u=>{s.height=u},Nr.decodeRelativeHeight).geometry(u=>{s.position=u},Nr.getPoint).success()),oi=new pn((a,r,s)=>a.reset(r).require(Zt,u=>{s.id=u}).optional("fixed_height",u=>{s.constantHeight=u},Nr.decodeMetricHeight).geometry(u=>{s.bounds=u},_p).success(),(a,r,s)=>a.reset(r).require(Zt,u=>{s.id=u}).require("elevation_idx",u=>{s.idx=u}).require("extent",u=>{s.extent=u}).require("height",u=>{s.height=u},Nr.decodeMetricHeight).geometry(u=>{s.position=u},Nr.getPoint).success());class Nr{static getPoint(r){return $n(r[0][0].x,r[0][0].y)}static decodeRelativeHeight(r){return 1e-4*r*5}static decodeMetricHeight(r){return 1e-4*r}static getVersionSchema(r){return r?r==="1.0.1"?oi:void 0:En}static parse(r){const s=[],u=[],d=r.length,g=new Tr;for(let y=0;y<d;y++){const b=r.feature(y),T=b.properties.version,E=Nr.getVersionSchema(T);if(E===void 0){br(`Unknown elevation feature version number ${T||"(unknown)"}`);continue}const k=b.properties.type;if(!k)continue;const j=wt.types[b.type];if(j==="Point"&&k==="curve_point"){const R={};E.parseVertex(g,b,R)&&s.push(R)}else if(j==="Polygon"&&k==="curve_meta"){const R={};E.parseFeature(g,b,R)&&u.push(R)}}return{vertices:s,features:u}}}class Sn{constructor(r,s){this.pos=r,this.dir=s}intersectsPlane(r,s,u){const d=Cl(s,this.dir);if(Math.abs(d)<1e-6)return!1;const g=((r[0]-this.pos[0])*s[0]+(r[1]-this.pos[1])*s[1])/d;return u[0]=this.pos[0]+this.dir[0]*g,u[1]=this.pos[1]+this.dir[1]*g,!0}}class Xr{constructor(r,s){this.pos=r,this.dir=s}intersectsPlane(r,s,u){const d=Vr(s,this.dir);if(Math.abs(d)<1e-6)return!1;const g=((r[0]-this.pos[0])*s[0]+(r[1]-this.pos[1])*s[1]+(r[2]-this.pos[2])*s[2])/d;return u[0]=this.pos[0]+this.dir[0]*g,u[1]=this.pos[1]+this.dir[1]*g,u[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(r,s,u){if(function(L,z){var W=L[0],J=L[1],ee=L[2],oe=z[0],le=z[1],de=z[2];return Math.abs(W-oe)<=I*Math.max(1,Math.abs(W),Math.abs(oe))&&Math.abs(J-le)<=I*Math.max(1,Math.abs(J),Math.abs(le))&&Math.abs(ee-de)<=I*Math.max(1,Math.abs(ee),Math.abs(de))}(this.pos,r)||s===0)return u[0]=u[1]=u[2]=0,!1;const[d,g,y]=this.dir,b=this.pos[0]-r[0],T=this.pos[1]-r[1],E=this.pos[2]-r[2],k=d*d+g*g+y*y,j=2*(b*d+T*g+E*y),R=j*j-4*k*(b*b+T*T+E*E-s*s);if(R<0){const L=Math.max(-j/2,0),z=b+d*L,W=T+g*L,J=E+y*L,ee=Math.hypot(z,W,J);return u[0]=z*s/ee,u[1]=W*s/ee,u[2]=J*s/ee,!1}{const L=(-j-Math.sqrt(R))/(2*k);if(L<0){const z=Math.hypot(b,T,E);return u[0]=b*s/z,u[1]=T*s/z,u[2]=E*s/z,!1}return u[0]=b+d*L,u[1]=T+g*L,u[2]=E+y*L,!0}}}class ri{constructor(r,s,u,d,g){this.TL=r,this.TR=s,this.BR=u,this.BL=d,this.horizon=g}static fromInvProjectionMatrix(r,s,u){const d=[-1,1,1],g=[1,1,1],y=[1,-1,1],b=[-1,-1,1],T=yn(d,d,r),E=yn(g,g,r),k=yn(y,y,r),j=yn(b,b,r);return new ri(T,E,k,j,s/u)}}function Cn(a,r,s){let u=1/0,d=-1/0;const g=[];for(const y of a){Ei(g,y,r);const b=Vr(g,s);u=Math.min(u,b),d=Math.max(d,b)}return[u,d]}function mi(a,r){let s=!0;for(let u=0;u<a.planes.length;u++){const d=a.planes[u];let g=0;for(let y=0;y<r.length;y++)g+=+(Vr(d,r[y])+d[3]>=0);if(g===0)return 0;g!==r.length&&(s=!1)}return s?2:1}function Nn(a,r){for(const s of a.projections){const u=Cn(r,a.points[0],s.axis);if(s.projection[1]<u[0]||s.projection[0]>u[1])return 0}return 1}function Kr(a,r){let s=0;const u=[0,0,0,0];for(let y=0;y<a.length;y++)u[0]=a[y][0],u[1]=a[y][1],u[2]=a[y][2],u[3]=1,(d=u)[0]*(g=r)[0]+d[1]*g[1]+d[2]*g[2]+d[3]*g[3]>=0&&s++;var d,g;return s}class Wn{constructor(r,s){this.points=r||new Array(8).fill([0,0,0]),this.planes=s||new Array(6).fill([0,0,0,0]),this.bounds=en.fromPoints(this.points),this.projections=[],this.frustumEdges=[Ei([],this.points[2],this.points[3]),Ei([],this.points[0],this.points[3]),Ei([],this.points[4],this.points[0]),Ei([],this.points[5],this.points[1]),Ei([],this.points[6],this.points[2]),Ei([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const d=[0,-u[2],u[1]],g=[u[2],0,-u[0]];this.projections.push({axis:d,projection:Cn(this.points,this.points[0],d)}),this.projections.push({axis:g,projection:Cn(this.points,this.points[0],g)})}}static fromInvProjectionMatrix(r,s,u,d){const g=Math.pow(2,u),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const k=pr([],E,r),j=1/k[3]/s*g;return(R=k)[0]=(L=k)[0]*(z=[j,j,d?1/k[3]:j,j])[0],R[1]=L[1]*z[1],R[2]=L[2]*z[2],R[3]=L[3]*z[3],R;var R,L,z}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const k=Er([],Ur([],Ei([],y[E[0]],y[E[1]]),Ei([],y[E[2]],y[E[1]]))),j=-Vr(k,y[E[1]]);return k.concat(j)}),T=[];for(let E=0;E<y.length;E++)T.push([y[E][0],y[E][1],y[E][2]]);return new Wn(T,b)}intersectsPrecise(r,s,u){for(let d=0;d<s.length;d++)if(!Kr(r,s[d]))return 0;for(let d=0;d<this.planes.length;d++)if(!Kr(r,this.planes[d]))return 0;for(const d of u)for(const g of this.frustumEdges){const y=Ur([],d,g),b=Ye(y);if(b===0)continue;Vt(y,y,1/b);const T=Cn(this.points,this.points[0],y),E=Cn(r,this.points[0],y);if(T[0]>E[1]||E[0]>T[1])return 0}return 1}containsPoint(r){for(const s of this.planes){const u=s[3];if(Vr([s[0],s[1],s[2]],r)+u<0)return!1}return!0}}class en{static fromPoints(r){const s=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const d of r)rt(s,s,d),Tt(u,u,d);return new en(s,u)}static fromTileIdAndHeight(r,s,u){const d=1<<r.canonical.z,g=r.canonical.x,y=r.canonical.y;return new en([g/d,y/d,s],[(g+1)/d,(y+1)/d,u])}static applyTransform(r,s){const u=r.getCorners();for(let d=0;d<u.length;++d)yn(u[d],u[d],s);return en.fromPoints(u)}static applyTransformFast(r,s){const u=[s[12],s[13],s[14]],d=[...u];for(let g=0;g<3;g++)for(let y=0;y<3;y++){const b=s[4*y+g],T=b*r.min[y],E=b*r.max[y];u[g]+=Math.min(T,E),d[g]+=Math.max(T,E)}return new en(u,d)}static projectAabbCorners(r,s){const u=r.getCorners();for(let d=0;d<u.length;++d)yn(u[d],u[d],s);return u}constructor(r,s){this.min=r,this.max=s,this.center=Vt([],$e([],this.min,this.max),.5)}quadrant(r){const s=[r%2==0,r<2],u=je(this.min),d=je(this.max);for(let g=0;g<s.length;g++)u[g]=s[g]?this.min[g]:this.center[g],d[g]=s[g]?this.center[g]:this.max[g];return d[2]=this.max[2],new en(u,d)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,s=this.max;return[[r[0],r[1],r[2]],[s[0],r[1],r[2]],[s[0],s[1],r[2]],[r[0],s[1],r[2]],[r[0],r[1],s[2]],[s[0],r[1],s[2]],[s[0],s[1],s[2]],[r[0],s[1],s[2]]]}intersects(r){return this.intersectsAabb(r.bounds)?mi(r,this.getCorners()):0}intersectsFlat(r){return this.intersectsAabb(r.bounds)?mi(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(r,s){return s||this.intersects(r)?Nn(r,this.getCorners()):0}intersectsPreciseFlat(r,s){return s||this.intersectsFlat(r)?Nn(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(r){for(let s=0;s<3;++s)if(this.min[s]>r.max[s]||r.min[s]>this.max[s])return!1;return!0}intersectsAabbXY(r){return!(this.min[0]>r.max[0]||r.min[0]>this.max[0]||this.min[1]>r.max[1]||r.min[1]>this.max[1])}encapsulate(r){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],r.min[s]),this.max[s]=Math.max(this.max[s],r.max[s])}encapsulatePoint(r){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],r[s]),this.max[s]=Math.max(this.max[s],r[s])}closestPoint(r){return[Math.max(Math.min(this.max[0],r[0]),this.min[0]),Math.max(Math.min(this.max[1],r[1]),this.min[1]),Math.max(Math.min(this.max[2],r[2]),this.min[2])]}}rr(en,"Aabb");class Ti{constructor(r,s){this.feature=r,this.metersToTile=s,this.index=0}get(){const r=this.feature.vertices[this.index],s=this.feature.vertexProps[this.index].dir,u=s[1],d=-s[0],g=(r.extent+1)*this.metersToTile;return[new xt(Math.trunc(r.position[0]+u*g),Math.trunc(r.position[1]+d*g)),new xt(Math.trunc(r.position[0]-u*g),Math.trunc(r.position[1]-d*g))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Kn{constructor(r,s,u,d,g,y){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Yt(),Yt(),Yt(),Yt(),Yt(),Yt(),Yt()],this.id=r,this.heightRange={min:u,max:u},this.safeArea=s,this.constantHeight=u,this.constantHeight==null&&(this.constantHeight!=null||d.length!==0)){this.vertices=d,this.edges=g,this.edges=this.edges.filter(b=>{return b.a<this.vertices.length&&b.b<this.vertices.length&&!((T=this.vertices[b.a].position)[0]===(E=this.vertices[b.b].position)[0]&&T[1]===E[1]);var T,E}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const b of this.vertices)this.vertexProps.push({dir:$n(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,b.height),this.heightRange.max=Math.max(this.heightRange.max,b.height);for(const b of this.edges){const T=this.vertices[b.a].position,E=this.vertices[b.b].position,k=bi(Yt(),E,T),j=fi(k),R=rs(Yt(),k,1/j);this.edgeProps.push({vec:k,dir:R,len:j});const L=this.vertexProps[b.a].dir,z=this.vertexProps[b.b].dir;Ts(L,L,R),Ts(z,z,R)}for(const b of this.vertexProps)b.dir[0]===0&&b.dir[1]===0||ro(b.dir,b.dir);this.tessellate(y)}}pointElevation(r){if(this.constantHeight!=null)return this.constantHeight;const s=this.getClosestEdge(r);if(s==null)return 0;const[u,d]=s;return Rr(this.vertices[this.edges[u].a].height,this.vertices[this.edges[u].b].height,d)}computeSlopeNormal(r,s){const u=this.getClosestEdge(r);if(!u)return qe(0,0,1);const d=u[0],g=this.edges[d],y=this.edgeProps[d].vec,b=qe(y[0],y[1],(this.vertices[g.b].height-this.vertices[g.a].height)*s),T=qe(b[1],-b[0],0);Ur(T,T,b);const E=Ye(T);return E>0?Vt(T,T,1/E):We(T,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(r){if(this.edges.length===0)return;let s=0,u=Number.POSITIVE_INFINITY,d=0;const[g,y,b,T,E,k,j]=this._tmpVec2;as(j,r.x,r.y);const R=new Sn(j,null);for(let L=0;L<this.edges.length;L++){const z=this.edges[L],W=this.edgeProps[L].dir;R.dir=W;const J=this.vertices[z.a].position,ee=this.vertices[z.b].position,oe=R.intersectsPlane(J,this.vertexProps[z.a].dir,g),le=R.intersectsPlane(ee,this.vertexProps[z.b].dir,y);if(!oe||!le)continue;bi(b,y,g),bi(T,j,g);const de=Cl(b,b),Se=de>0?Cl(T,b)/de:0,_e=ie(Se,0,1),Ae=Math.abs((Se-_e)*this.edgeProps[L].len);bi(E,j,J),as(k,W[1],-W[0]);const ke=Ae+Math.abs(Cl(E,k));ke<u&&(s=L,u=ke,d=_e)}return[s,d]}tessellate(r){const s=be(),u=be(),d=be(),g=be();for(let y=this.edges.length-1;y>=0;--y){const b=this.edges[y].a,T=this.edges[y].b,{position:E,height:k,extent:j}=this.vertices[b],{position:R,height:L,extent:z}=this.vertices[T],W=this.vertexProps[b].dir,J=this.vertexProps[T].dir;if(We(s,E[0]/r,E[1]/r,k),We(u,R[0]/r,R[1]/r,L),We(d,W[1],-W[0],0),Vt(d,d,j),We(g,J[1],-J[0],0),Vt(g,g,z),this.distSqLines(qe(s[0]+.5*d[0],s[1]+.5*d[1],s[2]+.5*d[2]),qe(u[0]-.5*g[0],u[1]-.5*g[1],u[2]-.5*g[2]),qe(s[0]-.5*d[0],s[1]-.5*d[1],s[2]-.5*d[2]),qe(u[0]+.5*g[0],u[1]+.5*g[1],u[2]+.5*g[2]))<=.0025000000000000005)continue;const ee=this.vertices.length,oe=Ts(Yt(),E,R);this.vertices.push({position:rs(oe,oe,.5),height:.5*(k+L),extent:.5*(j+z)});const le=Ts(Yt(),W,J);this.vertexProps.push({dir:ro(le,le)}),this.edges.splice(y,1),this.edgeProps.splice(y,1),this.edges.push({a:b,b:ee}),this.edges.push({a:ee,b:T});const de=bi(Yt(),this.vertices[ee].position,E),Se=fi(de),_e={vec:de,dir:rs(Yt(),de,1/Se),len:Se};this.edgeProps.push(_e),this.edgeProps.push(_e)}}distSqLines(r,s,u,d){const g=_t(be(),s,r),y=_t(be(),d,u),b=_t(be(),r,u),T=Vr(g,g),E=Vr(g,y),k=Vr(g,b),j=Vr(y,y),R=Vr(y,b),L=T*j-E*E;if(L===0)return wr(jn(g,u,d,Vr(b,y)/Vr(y,y)),r);const z=(T*R-E*k)/L;return wr(jn(g,r,s,(E*R-k*j)/L),jn(y,u,d,z))}}class zr{static parseFrom(r,s){const u=Nr.parse(r);if(!u)return[];let{vertices:d,features:g}=u;const y=1/Ce(s);g.sort((k,j)=>k.id-j.id),d.sort((k,j)=>k.id-j.id||k.idx-j.idx),d=d.filter((k,j,R)=>j===R.findIndex(L=>L.id===k.id&&L.idx===k.idx));const b=new Array;let T=0;const E=d.length;for(const k of g){if(k.constantHeight){b.push(new Kn(k.id,k.bounds,k.constantHeight));continue}for(;T!==E&&d[T].id<k.id;)T++;if(T===E||d[T].id!==k.id)continue;const j=new Array,R=new Array,L=T;for(;T!==E&&d[T].id===k.id;){const z=d[T];if(j.push({position:z.position,height:z.height,extent:z.extent}),T!==L&&d[T-1].idx===z.idx-1){const W=T-L;R.push({a:W-1,b:W})}T++}b.push(new Kn(k.id,k.bounds,void 0,j,R,y))}return b}static getElevationFeature(r,s){if(!s)return;const u=+r.properties[Zt];return Number.isNaN(u)?void 0:s.find(d=>d.id===u)}}class In{constructor(r,s){this.zScale=1,this.xOffset=0,this.yOffset=0,r.equals(s)||(this.zScale=Math.pow(2,s.z-r.z),this.xOffset=(r.x*this.zScale-s.x)*zt,this.yOffset=(r.y*this.zScale-s.y)*zt)}constantElevation(r,s){if(r.constantHeight!=null)return this.computeBiasedHeight(r.constantHeight,s)}pointElevation(r,s,u){const d=this.constantElevation(s,u);return d??(r.x=r.x*this.zScale+this.xOffset,r.y=r.y*this.zScale+this.yOffset,this.computeBiasedHeight(s.pointElevation(r),u))}computeBiasedHeight(r,s){return s<=0?r:r+s*me(0,s,r>=0?r:Math.abs(.5*r))}}rr(Kn,"ElevationFeature");class Oi{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new ea,this.indexArray=new Mi,this.segments=new Vi,this.programConfigurations=new kl(r.layers,{zoom:r.zoom,lut:r.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Cc),this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,s){}updateAppearances(r,s,u,d){}populate(r,s,u,d){const g=this.layers[0],y=[];let b=null;g.type==="circle"&&(b=g.layout.get("circle-sort-key"));for(const{feature:E,id:k,index:j,sourceLayerIndex:R}of r){const L=this.layers[0]._featureFilter.needGeometry,z=Ze(E,L);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),z,u))continue;const W=b?b.evaluate(z,{},u):void 0,J={id:k,properties:E.properties,type:E.type,sourceLayerIndex:R,index:j,geometry:L?z.geometry:ft(E,u,d),patterns:{},sortKey:W};y.push(J)}b&&y.sort((E,k)=>E.sortKey-k.sortKey);let T=null;d.projection.name==="globe"&&(this.globeExtVertexArray=new Dg,T=d.projection);for(const E of y){const{geometry:k,index:j,sourceLayerIndex:R}=E,L=r[j].feature;this.addFeature(E,k,j,s.availableImages,u,T,s.brightness,s.elevationFeatures),s.featureIndex.insert(L,k,j,R,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(r,s,u,d,g,y,b){this.programConfigurations.updatePaintArrays(r,s,g,u,d,y,b,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,A1.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,Q2.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=r.createVertexBuffer(this.elevatedLayoutVertexArray,J2.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(r,s,u,d,g,y,b,T){let E;this.elevationMode!=="none"&&(E=zr.getElevationFeature(r,T));for(const k of s)for(const j of k){const R=j.x,L=j.y;if(R<0||R>=zt||L<0||L>=zt)continue;if(y){const J=y.projectTilePoint(R,L,g),ee=y.upVector(g,R,L);this.addGlobeExtVertex(J,ee),this.addGlobeExtVertex(J,ee),this.addGlobeExtVertex(J,ee),this.addGlobeExtVertex(J,ee)}const z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),W=z.vertexLength;if(this.addCircleVertex(R,L,-1,-1),this.addCircleVertex(R,L,1,-1),this.addCircleVertex(R,L,1,1),this.addCircleVertex(R,L,-1,1),this.elevationMode!=="none"){const J=E?E.pointElevation(new xt(R,L)):0;this.hasElevation=this.hasElevation||J!==0;for(let ee=0;ee<4;ee++)this.elevatedLayoutVertexArray.emplaceBack(J)}this.indexArray.emplaceBack(W,W+1,W+2),this.indexArray.emplaceBack(W,W+2,W+3),z.vertexLength+=4,z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,{},d,g,b,void 0,this.worldview)}addCircleVertex(r,s,u,d){this.layoutVertexArray.emplaceBack(2*r+(u+1)/2,2*s+(d+1)/2)}addGlobeExtVertex(r,s){this.globeExtVertexArray.emplaceBack(r.x,r.y,r.z,s[0]*16384,s[1]*16384,s[2]*16384)}}function is(a,r){for(let s=0;s<a.length;s++)if(Us(r,a[s]))return!0;for(let s=0;s<r.length;s++)if(Us(a,r[s]))return!0;return!!Ho(a,r)}function Ui(a,r,s){return!!Us(a,r)||!!go(r,a,s)}function Yi(a,r){if(a.length===1)return ul(r,a[0]);for(let s=0;s<r.length;s++){const u=r[s];for(let d=0;d<u.length;d++)if(Us(a,u[d]))return!0}for(let s=0;s<a.length;s++)if(ul(r,a[s]))return!0;for(let s=0;s<r.length;s++)if(Ho(a,r[s]))return!0;return!1}function ra(a,r,s){if(a.length>1){if(Ho(a,r))return!0;for(let u=0;u<r.length;u++)if(go(r[u],a,s))return!0}for(let u=0;u<a.length;u++)if(go(a[u],r,s))return!0;return!1}function Ho(a,r){if(a.length===0||r.length===0)return!1;for(let s=0;s<a.length-1;s++){const u=a[s],d=a[s+1];for(let g=0;g<r.length-1;g++)if(mo(u,d,r[g],r[g+1]))return!0}return!1}function mo(a,r,s,u){return rn(a,s,u)!==rn(r,s,u)&&rn(a,r,s)!==rn(a,r,u)}function To(a,r,s){return(a.x-s.x)*(r.y-s.y)-(a.y-s.y)*(r.x-s.x)}function Ra(a,r,s,u){const d=To(a,r,u),g=To(a,r,s);if(Math.sign(d)===Math.sign(g))return;const y=To(s,u,a),b=y+g-d;return Math.sign(y)!==Math.sign(b)?[y/(y-b),g/(g-d)]:void 0}function go(a,r,s){const u=s*s;if(r.length===1)return a.distSqr(r[0])<u;for(let d=1;d<r.length;d++)if(Ma(a,r[d-1],r[d])<u)return!0;return!1}function Ma(a,r,s){const u=r.distSqr(s);if(u===0)return a.distSqr(r);const d=((a.x-r.x)*(s.x-r.x)+(a.y-r.y)*(s.y-r.y))/u;return a.distSqr(d<0?r:d>1?s:s.sub(r)._mult(d)._add(r))}function ul(a,r){let s,u,d,g=!1;for(let y=0;y<a.length;y++){s=a[y];for(let b=0,T=s.length-1;b<s.length;T=b++)u=s[b],d=s[T],u.y>r.y!=d.y>r.y&&r.x<(d.x-u.x)*(r.y-u.y)/(d.y-u.y)+u.x&&(g=!g)}return g}function Us(a,r){let s=!1;for(let u=0,d=a.length-1;u<a.length;d=u++){const g=a[u],y=a[d];g.y>r.y!=y.y>r.y&&r.x<(y.x-g.x)*(r.y-g.y)/(y.y-g.y)+g.x&&(s=!s)}return s}function Wi(a,r,s,u,d){for(const y of a)if(r<=y.x&&s<=y.y&&u>=y.x&&d>=y.y)return!0;const g=[new xt(r,s),new xt(r,d),new xt(u,d),new xt(u,s)];if(a.length>2){for(const y of g)if(Us(a,y))return!0}for(let y=0;y<a.length-1;y++)if(ss(a[y],a[y+1],g))return!0;return!1}function ss(a,r,s){const u=s[0],d=s[2];if(a.x<u.x&&r.x<u.x||a.x>d.x&&r.x>d.x||a.y<u.y&&r.y<u.y||a.y>d.y&&r.y>d.y)return!1;const g=rn(a,r,s[0]);return g!==rn(a,r,s[1])||g!==rn(a,r,s[2])||g!==rn(a,r,s[3])}function pi(a,r,s,u,d,g){let y=r.y-a.y,b=a.x-r.x;if(g=g||0){const T=y*y+b*b;if(T===0)return!0;const E=Math.sqrt(T);y/=E,b/=E}return!((s.x-a.x)*y+(s.y-a.y)*b-g<0||(u.x-a.x)*y+(u.y-a.y)*b-g<0||(d.x-a.x)*y+(d.y-a.y)*b-g<0)}function ds(a,r,s,u,d,g,y){return!(pi(a,r,u,d,g,y)||pi(r,s,u,d,g,y)||pi(s,a,u,d,g,y)||pi(u,d,a,r,s,y)||pi(d,g,a,r,s,y)||pi(g,u,a,r,s,y))}function $s(a,r,s){const u=r.paint.get(a).value;return u.kind==="constant"?u.value:s.programConfigurations.get(r.id).getMaxValue(a)}function Hi(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Da(a,r,s,u,d){if(!r[0]&&!r[1])return a;const g=xt.convert(r)._mult(d);s==="viewport"&&g._rotate(-u);const y=[];for(let b=0;b<a.length;b++)y.push(a[b].sub(g));return y}function Nh(a,r,s,u){const d=xt.convert(a)._mult(u);return r==="viewport"&&d._rotate(-s),d}let Pc,Oh;function Lh(a,r,s){var u=2*Math.PI*6378137/256/Math.pow(2,s);return[a*u-2*Math.PI*6378137/2,r*u-2*Math.PI*6378137/2]}rr(Oi,"CircleBucket",{omit:["layers"]});class Na{constructor(r,s,u){this.z=r,this.x=s,this.y=u,this.key=Oa(0,r,r,s,u)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}isChildOf(r){const s=this.z-r.z;return r.z===0||r.z<this.z&&r.x===this.x>>s&&r.y===this.y>>s}url(r,s){const u=function(g,y,b){var T=Lh(256*g,256*(y=Math.pow(2,b)-y-1),b),E=Lh(256*(g+1),256*(y+1),b);return T[0]+","+T[1]+","+E[0]+","+E[1]}(this.x,this.y,this.z),d=function(g,y,b){let T,E="";for(let k=g;k>0;k--)T=1<<k-1,E+=(y&T?1:0)+(b&T?2:0);return E}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class tc{constructor(r,s){this.wrap=r,this.canonical=s,this.key=Oa(r,s.z,s.z,s.x,s.y)}}class Fs{constructor(r,s,u,d,g){this.overscaledZ=r,this.wrap=s,this.canonical=new Na(u,+d,+g),this.key=s===0&&r===u?this.canonical.key:Oa(s,r,u,d,g)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const s=this.canonical.z-r;return r>this.canonical.z?new Fs(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Fs(r,this.wrap,r,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(r,s=!0){if(this.overscaledZ===r&&s)return this.key;if(r>this.canonical.z)return Oa(this.wrap*+s,r,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-r;return Oa(this.wrap*+s,r,r,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const s=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.z<this.canonical.z&&r.canonical.x===this.canonical.x>>s&&r.canonical.y===this.canonical.y>>s}children(r){if(this.overscaledZ>=r)return[new Fs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,u=2*this.canonical.x,d=2*this.canonical.y;return[new Fs(s,this.wrap,s,u,d),new Fs(s,this.wrap,s,u+1,d),new Fs(s,this.wrap,s,u,d+1),new Fs(s,this.wrap,s,u+1,d+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Fs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Fs(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new tc(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Oa(a,r,s,u,d){const g=1<<Math.min(s,22);let y=g*(d%g)+u%g;return a&&s<22&&(y+=g*g*((a<0?-2*a-1:2*a)%(1<<2*(22-s)))),16*(32*y+s)+(r-s)}const _d=[a=>{let r=a.canonical.x-1,s=a.wrap;return r<0&&(r=(1<<a.canonical.z)-1,s--),new Fs(a.overscaledZ,s,a.canonical.z,r,a.canonical.y)},a=>{let r=a.canonical.x+1,s=a.wrap;return r===1<<a.canonical.z&&(r=0,s++),new Fs(a.overscaledZ,s,a.canonical.z,r,a.canonical.y)},a=>new Fs(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,(a.canonical.y===0?1<<a.canonical.z:a.canonical.y)-1),a=>new Fs(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y===(1<<a.canonical.z)-1?0:a.canonical.y+1)];rr(Na,"CanonicalTileID"),rr(Fs,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const j1=fn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Wg}=j1,D$=fn([{name:"a_pos_3",components:3,type:"Int16"}]);var Bj=fn([{name:"a_pos",type:"Int16",components:2}]);function R1(a){return a*ta/M}const N$=[new en([w,w,w],[S,S,S]),new en([w,w,w],[0,0,S]),new en([0,w,w],[S,0,S]),new en([w,0,w],[0,S,S]),new en([0,0,w],[S,S,S])];function Vj(a,r,s,u=!0){const d=Vt([],a._camera.position,a.worldSize),g=[r,s,1,1];pr(g,g,a.pixelMatrixInverse),Wt(g,g,1/g[3]);const y=Er([],Ei([],g,d)),b=a.globeMatrix,T=[b[12],b[13],b[14]],E=Ei([],T,d),k=Ye(E),j=Er([],E),R=a.worldSize/(2*Math.PI),L=Vr(j,y),z=Math.asin(R/k);if(z<Math.acos(L)){if(!u)return null;const at=[],Ue=[];Vt(at,y,k/L),Er(Ue,Ei(Ue,at,E)),Er(y,$e(y,E,Vt(y,Ue,Math.tan(z)*k)))}const W=[];new Xr(d,y).closestPointOnSphere(T,R,W);const J=Er([],ns(b,0)),ee=Er([],ns(b,1)),oe=Er([],ns(b,2)),le=Vr(J,W),de=Vr(ee,W),Se=Vr(oe,W),_e=Do(Math.asin(-de/R));let Ae=Do(Math.atan2(le,Se));Ae=a.center.lng+function(at,Ue){const ct=(Ue-at+180)%360-180;return ct<-180?ct+360:ct}(a.center.lng,Ae);const ke=se(Ae),De=ie(ne(_e),0,1);return new Fe(ke,De)}class O${constructor(r,s,u){this.a=Ei([],r,u),this.b=Ei([],s,u),this.center=u;const d=Er([],this.a),g=Er([],this.b);this.angle=Math.acos(Vr(d,g))}}function lE(a,r){if(a.angle===0)return null;let s;return s=a.a[r]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[r]/a.a[r]/Math.sin(a.angle)-1/Math.tan(a.angle)),s<0||s>1?null:function(u,d,g,y){const b=Math.sin(g);return u*(Math.sin((1-y)*g)/b)+d*(Math.sin(y*g)/b)}(a.a[r],a.b[r],a.angle,ie(s,0,1))+a.center[r]}function Tu(a){if(a.z<=1)return N$[a.z+2*a.y+a.x];const r=cE(M1(a));return en.fromPoints(r)}function yd(a,r,s){return Vt(a,a,1-s),it(a,a,r,s)}function Uj(a,r,s){for(const u of a)yn(u,u,r),Vt(u,u,s)}function $j(a,r,s,u){const d=r/a.worldSize,g=a.globeMatrix;if(s.z<=1){const De=Tu(s).getCorners();return Uj(De,g,d),en.fromPoints(De)}const y=M1(s,u),b=cE(y,ta+R1(a._tileCoverLift));Uj(b,g,d);const T=Number.MAX_VALUE,E=[-T,-T,-T],k=[T,T,T];if(y.contains(a.center)){for(const Ue of b)rt(k,k,Ue),Tt(E,E,Ue);E[2]=0;const De=a.point,at=[De.x*d,De.y*d,0];return rt(k,k,at),Tt(E,E,at),new en(k,E)}if(a._tileCoverLift>0){for(const De of b)rt(k,k,De),Tt(E,E,De);return new en(k,E)}const j=[g[12]*d,g[13]*d,g[14]*d],R=y.getCenter(),L=ie(a.center.lat,-fe,fe),z=ie(R.lat,-fe,fe),W=se(a.center.lng),J=ne(L);let ee=W-se(R.lng);const oe=J-ne(z);ee>.5?ee-=1:ee<-.5&&(ee+=1);let le=0;Math.abs(ee)>Math.abs(oe)?le=ee>=0?1:3:(le=oe>=0?0:2,it(j,j,[g[4]*d,g[5]*d,g[6]*d],-Math.sin(ln(oe>=0?y.getSouth():y.getNorth()))*ta));const de=b[le],Se=b[(le+1)%4],_e=new O$(de,Se,j),Ae=[lE(_e,0)||de[0],lE(_e,1)||de[1],lE(_e,2)||de[2]],ke=zh(a.zoom);if(ke>0){const De=function({x:Ue,y:ct,z:pt},bt,Ot,It,gt){const At=1/(1<<pt);let nt=Ue*At,Ke=nt+At,St=ct*At,Mt=St+At,vt=0;const er=(nt+Ke)/2-It;return er>.5?vt=-1:er<-.5&&(vt=1),nt=((nt+vt)*bt-(It*=bt))*Ot+It,Ke=((Ke+vt)*bt-It)*Ot+It,St=(St*bt-(gt*=bt))*Ot+gt,Mt=(Mt*bt-gt)*Ot+gt,[[nt,Mt,0],[Ke,Mt,0],[Ke,St,0],[nt,St,0]]}(s,r,a._pixelsPerMercatorPixel,W,J);for(let Ue=0;Ue<b.length;Ue++)yd(b[Ue],De[Ue],ke);const at=$e([],De[le],De[(le+1)%4]);Vt(at,at,.5),yd(Ae,at,ke)}for(const De of b)rt(k,k,De),Tt(E,E,De);return k[2]=Math.min(de[2],Se[2]),rt(k,k,Ae),Tt(E,E,Ae),new en(k,E)}function M1({x:a,y:r,z:s},u=!1){const d=1/(1<<s),g=new F(he(a*d),r===(1<<s)-1&&u?-90:ce((r+1)*d)),y=new F(he((a+1)*d),r===0&&u?90:ce(r*d));return new O(g,y)}function cE(a,r=ta){const s=ln(a.getNorth()),u=ln(a.getSouth()),d=Math.cos(s),g=Math.cos(u),y=Math.sin(s),b=Math.sin(u),T=a.getWest(),E=a.getEast();return[C(g,b,T,r),C(g,b,E,r),C(d,y,E,r),C(d,y,T,r)]}function ax(a,r,s,u){const d=1<<s.z,g=(a/zt+s.x)/d;return A(ce((r/zt+s.y)/d),he(g),u)}function D1({min:a,max:r}){return l/Math.max(r[0]-a[0],r[1]-a[1],r[2]-a[2])}const qj=new Float64Array(16);function N1(a){const r=D1(a),s=lt(qj,[r,r,r]);return X(s,s,Wr([],a.min))}function uE(a){const r=(u=a.min,(s=qj)[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=u[0],s[13]=u[1],s[14]=u[2],s[15]=1,s);var s,u;const d=1/D1(a);return ue(r,r,[d,d,d])}function dE(a){const r=zt/(2*Math.PI);return a/(2*Math.PI)/r}function Gj(a,r){return zt/(512*Math.pow(2,a))*D1(Tu(r))}function Wj(a,r,s,u,d){const g=dE(s),y=[a,r,-s/(2*Math.PI)],b=K(new Float64Array(16));return X(b,b,y),ue(b,b,[g,g,g]),Ee(b,b,ln(-d)),xe(b,b,ln(-u)),b}function zh(a){return me(p,n,a)}function Hj(a,r){const s=A(r.lat,r.lng),u=function(z){const W=A(z._center.lat,z._center.lng);let J=Ur([],qe(0,1,0),W);const ee=Pt([],-z.angle,W);J=yn(J,J,ee),Pt(ee,-z._pitch,J);const oe=Er([],W);return Vt(oe,oe,R1(z.cameraToCenterDistance/z.pixelsPerMeter)),yn(oe,oe,ee),$e([],W,oe)}(a);return y=(d=_t([],u,s))[0],b=d[1],T=d[2],E=(g=s)[0],k=g[1],j=g[2],L=(R=Math.sqrt((y*y+b*b+T*T)*(E*E+k*k+j*j)))&&Vr(d,g)/R,Math.acos(Math.min(Math.max(L,-1),1));var d,g,y,b,T,E,k,j,R,L}function hE(a,r){return Hj(a,r)>Math.PI/2*1.01}const Zj=ln(85),L$=Math.cos(Zj),z$=Math.sin(Zj),F$=Y(),Xj=a=>{const r=[];return a.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),a.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r};function Kj(a,r,s,u,d,g,y,b,T){if(g&&a.queryGeometry.isAboveHorizon)return!1;g&&(T*=a.pixelToTileUnitsFactor);const E=a.tileID.canonical,k=s.projection.upVectorScale(E,s.center.lat,s.worldSize).metersToTile;for(const j of r)for(const R of j){const L=R.add(b),z=d&&s.elevation?s.elevation.exaggeration()*d.getElevationAt(L.x,L.y,!0):0,W=s.projection.projectTilePoint(L.x,L.y,E);if(z>0){const le=s.projection.upVector(E,L.x,L.y);W.x+=le[0]*k*z,W.y+=le[1]*k*z,W.z+=le[2]*k*z}const J=g?L:B$(W.x,W.y,W.z,u),ee=g?a.tilespaceRays.map(le=>U$(le,z)):a.queryGeometry.screenGeometry,oe=pr([],[W.x,W.y,W.z,1],u);if(!y&&g?T*=oe[3]/s.cameraToCenterDistance:y&&!g&&(T*=s.cameraToCenterDistance/oe[3]),g){const le=ce((R.y/zt+E.y)/(1<<E.z));T/=s.projection.pixelsPerMeter(le,1)/ae(1,le)}if(Ui(ee,J,T))return!0}return!1}function B$(a,r,s,u){const d=pr([],[a,r,s,1],u);return new xt(d[0]/d[3],d[1]/d[3])}const Yj=qe(0,0,0),V$=qe(0,0,1);function U$(a,r){const s=be();return Yj[2]=r,a.intersectsPlane(Yj,V$,s),new xt(s[0],s[1])}class Jj extends Oi{}let Qj,eR,tR,rR;function nR(a,{width:r,height:s},u,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==r*s*u)throw new RangeError("mismatched image size")}else d=new Uint8Array(r*s*u);return a.width=r,a.height=s,a.data=d,a}function iR(a,r,s){const{width:u,height:d}=r;u===a.width&&d===a.height||(fE(a,r,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,u),height:Math.min(a.height,d)},s,null),a.width=u,a.height=d,a.data=r.data)}function fE(a,r,s,u,d,g,y,b){if(d.width===0||d.height===0)return r;if(d.width>a.width||d.height>a.height||s.x>a.width-d.width||s.y>a.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>r.width||d.height>r.height||u.x>r.width-d.width||u.y>r.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const T=a.data,E=r.data,k=g===4&&b;for(let j=0;j<d.height;j++){const R=((s.y+j)*a.width+s.x)*g,L=((u.y+j)*r.width+u.x)*g;if(k)for(let z=0;z<d.width;z++){const W=R+z*g+3,J=L+z*g;E[J+0]=255,E[J+1]=255,E[J+2]=255,E[J+3]=T[W]}else if(y)for(let z=0;z<d.width;z++){const W=R+z*g,J=L+z*g,ee=new Yn(T[W+0]/255,T[W+1]/255,T[W+2]/255,T[W+3]).toNonPremultipliedRenderColor(y).toArray();E[J+0]=ee[0],E[J+1]=ee[1],E[J+2]=ee[2],E[J+3]=ee[3]}else for(let z=0;z<d.width*g;z++)E[L+z]=T[R+z]}return r}rr(Jj,"HeatmapBucket",{omit:["layers"]});class Fh{constructor(r,s){nR(this,r,1,s)}resize(r){iR(this,new Fh(r),1)}clone(){return new Fh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,s,u,d,g){fE(r,s,u,d,g,1,null)}}class Eo{constructor(r,s){nR(this,r,4,s)}resize(r){iR(this,new Eo(r),4)}replace(r,s){s?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Eo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,s,u,d,g,y,b){fE(r,s,u,d,g,4,y,b)}}class sR{constructor(r,s){this.width=r.width,this.height=r.height,this.data=s instanceof Uint8Array?new Float32Array(s.buffer):s}}function lx(a){const r={},s=a.resolution||256,u=a.clips?a.clips.length:1,d=a.image||new Eo({width:s,height:u}),g=(y,b,T)=>{r[a.evaluationKey]=T;const E=a.expression.evaluate(r),k=E?E.toNonPremultipliedRenderColor(null):null;k&&(d.data[y+b+0]=Math.floor(255*k.r),d.data[y+b+1]=Math.floor(255*k.g),d.data[y+b+2]=Math.floor(255*k.b),d.data[y+b+3]=Math.floor(255*k.a))};if(a.clips)for(let y=0,b=0;y<u;++y,b+=4*s)for(let T=0,E=0;T<s;T++,E+=4){const k=T/(s-1),{start:j,end:R}=a.clips[y];g(b,E,j*(1-k)+R*k)}else for(let y=0,b=0;y<s;y++,b+=4)g(0,b,y/(s-1));return d}rr(Fh,"AlphaImage"),rr(Eo,"RGBAImage");const $$=fn([{name:"a_pos",components:2,type:"Int16"}],4),q$=fn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),G$=fn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),W$=fn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Hg(a,r,s=2){const u=r&&r.length,d=u?r[0]*s:a.length;let g=oR(a,0,d,s,!0);const y=[];if(!g||g.next===g.prev)return y;let b,T,E;if(u&&(g=function(k,j,R,L){const z=[];for(let W=0,J=j.length;W<J;W++){const ee=oR(k,j[W]*L,W<J-1?j[W+1]*L:k.length,L,!1);ee===ee.next&&(ee.steiner=!0),z.push(e8(ee))}z.sort(Y$);for(let W=0;W<z.length;W++)R=J$(z[W],R);return R}(a,r,g,s)),a.length>80*s){b=a[0],T=a[1];let k=b,j=T;for(let R=s;R<d;R+=s){const L=a[R],z=a[R+1];L<b&&(b=L),z<T&&(T=z),L>k&&(k=L),z>j&&(j=z)}E=Math.max(k-b,j-T),E=E!==0?32767/E:0}return cx(g,y,s,b,T,E,0),y}function oR(a,r,s,u,d){let g;if(d===function(y,b,T,E){let k=0;for(let j=b,R=T-E;j<T;j+=E)k+=(y[R]-y[j])*(y[j+1]+y[R+1]),R=j;return k}(a,r,s,u)>0)for(let y=r;y<s;y+=u)g=uR(y/u|0,a[y],a[y+1],g);else for(let y=s-u;y>=r;y-=u)g=uR(y/u|0,a[y],a[y+1],g);return g&&Zg(g,g.next)&&(hx(g),g=g.next),g}function Bp(a,r){if(!a)return a;r||(r=a);let s,u=a;do if(s=!1,u.steiner||!Zg(u,u.next)&&qs(u.prev,u,u.next)!==0)u=u.next;else{if(hx(u),u=r=u.prev,u===u.next)break;s=!0}while(s||u!==r);return r}function cx(a,r,s,u,d,g,y){if(!a)return;!y&&g&&function(T,E,k,j){let R=T;do R.z===0&&(R.z=pE(R.x,R.y,E,k,j)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==T);R.prevZ.nextZ=null,R.prevZ=null,function(L){let z,W=1;do{let J,ee=L;L=null;let oe=null;for(z=0;ee;){z++;let le=ee,de=0;for(let _e=0;_e<W&&(de++,le=le.nextZ,le);_e++);let Se=W;for(;de>0||Se>0&&le;)de!==0&&(Se===0||!le||ee.z<=le.z)?(J=ee,ee=ee.nextZ,de--):(J=le,le=le.nextZ,Se--),oe?oe.nextZ=J:L=J,J.prevZ=oe,oe=J;ee=le}oe.nextZ=null,W*=2}while(z>1)}(R)}(a,u,d,g);let b=a;for(;a.prev!==a.next;){const T=a.prev,E=a.next;if(g?Z$(a,u,d,g):H$(a))r.push(T.i,a.i,E.i),hx(a),a=E.next,b=E.next;else if((a=E)===b){y?y===1?cx(a=X$(Bp(a),r),r,s,u,d,g,2):y===2&&K$(a,r,s,u,d,g):cx(Bp(a),r,s,u,d,g,1);break}}}function H$(a){const r=a.prev,s=a,u=a.next;if(qs(r,s,u)>=0)return!1;const d=r.x,g=s.x,y=u.x,b=r.y,T=s.y,E=u.y,k=Math.min(d,g,y),j=Math.min(b,T,E),R=Math.max(d,g,y),L=Math.max(b,T,E);let z=u.next;for(;z!==r;){if(z.x>=k&&z.x<=R&&z.y>=j&&z.y<=L&&ux(d,b,g,T,y,E,z.x,z.y)&&qs(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function Z$(a,r,s,u){const d=a.prev,g=a,y=a.next;if(qs(d,g,y)>=0)return!1;const b=d.x,T=g.x,E=y.x,k=d.y,j=g.y,R=y.y,L=Math.min(b,T,E),z=Math.min(k,j,R),W=Math.max(b,T,E),J=Math.max(k,j,R),ee=pE(L,z,r,s,u),oe=pE(W,J,r,s,u);let le=a.prevZ,de=a.nextZ;for(;le&&le.z>=ee&&de&&de.z<=oe;){if(le.x>=L&&le.x<=W&&le.y>=z&&le.y<=J&&le!==d&&le!==y&&ux(b,k,T,j,E,R,le.x,le.y)&&qs(le.prev,le,le.next)>=0||(le=le.prevZ,de.x>=L&&de.x<=W&&de.y>=z&&de.y<=J&&de!==d&&de!==y&&ux(b,k,T,j,E,R,de.x,de.y)&&qs(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;le&&le.z>=ee;){if(le.x>=L&&le.x<=W&&le.y>=z&&le.y<=J&&le!==d&&le!==y&&ux(b,k,T,j,E,R,le.x,le.y)&&qs(le.prev,le,le.next)>=0)return!1;le=le.prevZ}for(;de&&de.z<=oe;){if(de.x>=L&&de.x<=W&&de.y>=z&&de.y<=J&&de!==d&&de!==y&&ux(b,k,T,j,E,R,de.x,de.y)&&qs(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function X$(a,r){let s=a;do{const u=s.prev,d=s.next.next;!Zg(u,d)&&lR(u,s,s.next,d)&&dx(u,d)&&dx(d,u)&&(r.push(u.i,s.i,d.i),hx(s),hx(s.next),s=a=d),s=s.next}while(s!==a);return Bp(s)}function K$(a,r,s,u,d,g){let y=a;do{let b=y.next.next;for(;b!==y.prev;){if(y.i!==b.i&&t8(y,b)){let T=cR(y,b);return y=Bp(y,y.next),T=Bp(T,T.next),cx(y,r,s,u,d,g,0),void cx(T,r,s,u,d,g,0)}b=b.next}y=y.next}while(y!==a)}function Y$(a,r){let s=a.x-r.x;return s===0&&(s=a.y-r.y,s===0)&&(s=(a.next.y-a.y)/(a.next.x-a.x)-(r.next.y-r.y)/(r.next.x-r.x)),s}function J$(a,r){const s=function(d,g){let y=g;const b=d.x,T=d.y;let E,k=-1/0;if(Zg(d,y))return y;do{if(Zg(d,y.next))return y.next;if(T<=y.y&&T>=y.next.y&&y.next.y!==y.y){const W=y.x+(T-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(W<=b&&W>k&&(k=W,E=y.x<y.next.x?y:y.next,W===b))return E}y=y.next}while(y!==g);if(!E)return null;const j=E,R=E.x,L=E.y;let z=1/0;y=E;do{if(b>=y.x&&y.x>=R&&b!==y.x&&aR(T<L?b:k,T,R,L,T<L?k:b,T,y.x,y.y)){const W=Math.abs(T-y.y)/(b-y.x);dx(y,d)&&(W<z||W===z&&(y.x>E.x||y.x===E.x&&Q$(E,y)))&&(E=y,z=W)}y=y.next}while(y!==j);return E}(a,r);if(!s)return r;const u=cR(s,a);return Bp(u,u.next),Bp(s,s.next)}function Q$(a,r){return qs(a.prev,a,r.prev)<0&&qs(r.next,a,a.next)<0}function pE(a,r,s,u,d){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-s)*d|0)|a<<8))|a<<4))|a<<2))|a<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-u)*d|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function e8(a){let r=a,s=a;do(r.x<s.x||r.x===s.x&&r.y<s.y)&&(s=r),r=r.next;while(r!==a);return s}function aR(a,r,s,u,d,g,y,b){return(d-y)*(r-b)>=(a-y)*(g-b)&&(a-y)*(u-b)>=(s-y)*(r-b)&&(s-y)*(g-b)>=(d-y)*(u-b)}function ux(a,r,s,u,d,g,y,b){return!(a===y&&r===b)&&aR(a,r,s,u,d,g,y,b)}function t8(a,r){return a.next.i!==r.i&&a.prev.i!==r.i&&!function(s,u){let d=s;do{if(d.i!==s.i&&d.next.i!==s.i&&d.i!==u.i&&d.next.i!==u.i&&lR(d,d.next,s,u))return!0;d=d.next}while(d!==s);return!1}(a,r)&&(dx(a,r)&&dx(r,a)&&function(s,u){let d=s,g=!1;const y=(s.x+u.x)/2,b=(s.y+u.y)/2;do d.y>b!=d.next.y>b&&d.next.y!==d.y&&y<(d.next.x-d.x)*(b-d.y)/(d.next.y-d.y)+d.x&&(g=!g),d=d.next;while(d!==s);return g}(a,r)&&(qs(a.prev,a,r.prev)||qs(a,r.prev,r))||Zg(a,r)&&qs(a.prev,a,a.next)>0&&qs(r.prev,r,r.next)>0)}function qs(a,r,s){return(r.y-a.y)*(s.x-r.x)-(r.x-a.x)*(s.y-r.y)}function Zg(a,r){return a.x===r.x&&a.y===r.y}function lR(a,r,s,u){const d=L1(qs(a,r,s)),g=L1(qs(a,r,u)),y=L1(qs(s,u,a)),b=L1(qs(s,u,r));return d!==g&&y!==b||!(d!==0||!O1(a,s,r))||!(g!==0||!O1(a,u,r))||!(y!==0||!O1(s,a,u))||!(b!==0||!O1(s,r,u))}function O1(a,r,s){return r.x<=Math.max(a.x,s.x)&&r.x>=Math.min(a.x,s.x)&&r.y<=Math.max(a.y,s.y)&&r.y>=Math.min(a.y,s.y)}function L1(a){return a>0?1:a<0?-1:0}function dx(a,r){return qs(a.prev,a,a.next)<0?qs(a,r,a.next)>=0&&qs(a,a.prev,r)>=0:qs(a,r,a.prev)<0||qs(a,a.next,r)<0}function cR(a,r){const s=mE(a.i,a.x,a.y),u=mE(r.i,r.x,r.y),d=a.next,g=r.prev;return a.next=r,r.prev=a,s.next=d,d.prev=s,u.next=s,s.prev=u,g.next=u,u.prev=g,u}function uR(a,r,s,u){const d=mE(a,r,s);return u?(d.next=u.next,d.prev=u,u.next.prev=d,u.next=d):(d.prev=d,d.next=d),d}function hx(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function mE(a,r,s){return{i:a,x:r,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function fx(a,r){const s=a.length;if(s<=1)return[a];const u=[];let d,g;for(let y=0;y<s;y++){const b=hn(a[y]);b!==0&&(a[y].area=Math.abs(b),g===void 0&&(g=b<0),g===b<0?(d&&u.push(d),d=[a[y]]):d.push(a[y]))}if(d&&u.push(d),r>1)for(let y=0;y<u.length;y++)u[y].length<=r||(wc(u[y],r,1,u[y].length-1,r8),u[y]=u[y].slice(0,r));return u}function r8(a,r){return r.area-a.area}function dR(a,r,s=1){if(!a)return null;const u=typeof a=="string"?Qo.from(a).getPrimary():a.getPrimary(),d=typeof a=="string"?null:a.getSecondary();for(const g of[u,d]){if(!g)continue;const y=g.id.toString();r.has(y)||r.set(y,[]),g.scaleSelf(s),r.get(y).push(g)}return{primary:u.toString(),secondary:d?d.toString():null}}function gE(a,r,s,u){const d=u.patternDependencies;let g=!1;for(const y of r){const b=y.paint.get(`${a}-pattern`);b.isConstant()||(g=!0),dR(b.constantOr(null),d,s)&&(g=!0)}return g}function _E(a,r,s,u,d,g){const y=g.patternDependencies;for(const b of r){const T=b.paint.get(`${a}-pattern`).value;if(T.kind!=="constant"){let E=T.evaluate({zoom:u},s,{},g.availableImages);E=E&&E.name?E.name:E;const k=dR(E,y,d);if(!k)continue;const{primary:j,secondary:R}=k;j&&(s.patterns[b.id]=[j,R].filter(Boolean))}}return s}class hR{constructor(){this.polygons=new Map}add(r,...s){const u=this.polygons.get(r);u?u.push(...s):this.polygons.set(r,s)}merge(r){for(const[s,u]of r.polygons)this.add(s,...u)}}class vd{constructor(){this.portals=[]}static isOnBorder(r,s){return r<=0&&s<=0||r>=zt&&s>=zt}static evaluate(r){if(r.length===0)return new vd;let s=[];for(const T of r)s.push(...T.portals);if(s.length===0)return new vd;for(const T of s){const E=T.va,k=T.vb;(vd.isOnBorder(E.x,k.x)||vd.isOnBorder(E.y,k.y))&&(T.type="border")}const u=s.filter(T=>T.type!=="unevaluated"),d=s.filter(T=>T.type==="unevaluated");if(d.length===0)return new vd;d.sort((T,E)=>T.hash===E.hash?T.isTunnel===E.isTunnel?0:T.isTunnel?-1:1:T.hash<E.hash?1:-1),s=u.concat(d);let g=u.length,y=g,b=g;do if(y++,y===s.length||s[g].hash!==s[y].hash){if(y-g==2){b<g&&(s[b]=s[g],s[g]=null);const T=s[b],E=s[y-1];T.type=T.isTunnel!==E.isTunnel?"tunnel":"polygon",T.connection={a:T.connection.a,b:E.connection.a},b++}g=y}while(g!==s.length);return s.splice(b),s.sort((T,E)=>T.hash<E.hash?1:-1),{portals:s}}}rr(vd,"ElevationPortalGraph"),rr(hR,"ElevationPolygons");class n8{constructor(r,s,u){this.outPositions=r,this.outNormals=s,this.outIndices=u,this.vertexLookup=new Map}addVertex(r,s,u){let d=r[2];u!=null&&(d*=u);const g=`${r[0]},${r[1]},${r[2]},${s[0]},${s[1]},${s[2]}`,y=this.vertexLookup.get(g);if(y!=null)return y;const b=this.outPositions.length;this.vertexLookup.set(g,b);const T=Math.trunc(16384*s[0]),E=Math.trunc(16384*s[1]),k=Math.trunc(16384*s[2]);return this.outPositions.emplaceBack(r[0],r[1],d),this.outNormals.emplaceBack(T,E,k),b}addTriangle(r,s,u){this.outIndices.emplaceBack(r,s,u)}addTriangles(r,s,u){if(r.length===0)return;const d=u.length===1,g=be(),y=be();for(let b=0;b<r.length;b+=3){const T=s[r[b+0]],E=s[r[b+1]],k=s[r[b+2]],j=d?u[0]:u[r[b+1]],R=d?u[0]:u[r[b+2]];We(g,T.x,T.y,d?u[0]:u[r[b+0]]);const L=this.addVertex(g,y);We(g,E.x,E.y,j);const z=this.addVertex(g,y);We(g,k.x,k.y,R);const W=this.addVertex(g,y);this.outIndices.emplaceBack(L,z,W)}}addQuad(r,s,u,d,g,y){const b=this.addVertex(r,g,y),T=this.addVertex(s,g,y),E=this.addVertex(u,g,y),k=this.addVertex(d,g,y);this.addTriangle(b,T,E),this.addTriangle(E,k,b)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class La{constructor(r,s,u,d){this.unevaluatedPortals=new vd,this.portalPolygons=new hR,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new $v,this.vertexNormals=new qv,this.indexArray=new Mi,this.tileToMeters=Ce(r),this.bridgeProgramConfigurations=new kl(s,{zoom:u,lut:d},g=>g!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new kl(s,{zoom:u,lut:d},g=>g!=="fill-bridge-guard-rail-color")}addVertices(r,s){const u=this.unevalVertices.length;for(let d=0;d<r.length;d++)this.unevalVertices.push(r[d]),this.unevalHeights.push(s[d]);return u}addTriangles(r,s,u){const d=u?this.unevalTunnelTriangles:this.unevalTriangles;for(const g of r)d.push(g+s)}addRenderableRing(r,s,u,d,g,y){const b=[new xt(g.min.x,g.min.y),new xt(g.max.x,g.min.y),new xt(g.max.x,g.max.y),new xt(g.min.x,g.max.y)];for(let T=0;T<u-1;T++){const E=s+T,k=E+1,j=this.unevalVertices[E],R=this.unevalVertices[k];if(!(j.x>=g.min.x&&j.x<=g.max.x&&j.y>=g.min.y&&j.y<=g.max.y||R.x>=g.min.x&&R.x<=g.max.x&&R.y>=g.min.y&&R.y<=g.max.y||ss(j,R,b))||this.isOnBorder(j.x,R.x)||this.isOnBorder(j.y,R.y))continue;const L=La.computeEdgeHash(this.unevalVertices[E],this.unevalVertices[k]);let z,W=this.vertexHashLookup.get(La.computePosHash(j));W!=null?z=W.next:(W=this.vertexHashLookup.get(La.computePosHash(R)),z=W!=null?W.prev:L),this.unevalEdges.push({polygonIdx:r,a:E,b:k,hash:L,portalHash:z,isTunnel:d,type:"unevaluated",featureInfo:y})}}addPortalCandidates(r,s,u,d,g){if(s.length===0)return;this.portalPolygons.add(r,{geometry:s,zLevel:g});const y=s[0];this.vertexHashLookup.clear();let b=La.computeEdgeHash(y[y.length-2],y[y.length-1]);for(let T=0;T<y.length-1;T++){const E=y[T+0],k=y[T+1],j=$n(k.x-E.x,k.y-E.y),R=fi(j);if(R===0)continue;let L="unevaluated";const z=d.pointElevation(E),W=d.pointElevation(k);Math.abs(z)<.01&&Math.abs(W)<.01?L="entrance":(this.isOnBorder(E.x,k.x)||this.isOnBorder(E.y,k.y))&&(L="border");const J=La.computeEdgeHash(E,k);this.unevaluatedPortals.portals.push({connection:{a:r,b:void 0},va:E,vb:k,vab:j,length:R,hash:J,isTunnel:u,type:L});const ee=La.computePosHash(E);this.vertexHashLookup.set(ee,{prev:b,next:J}),b=J}}construct(r){if(this.unevalVertices.length===0)return;const s=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=R=>{R.primitiveLength=this.indexArray.length-R.primitiveOffset},d=new n8(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(r.portals,this.unevalEdges);const g=s(),y=s(),b=s(),T=(R,L)=>{R.sort((W,J)=>W.type===L&&J.type!==L?-1:W.type!==L&&J.type===L?1:0);const z=R.findIndex(W=>W.type!==L);return z>=0?z:R.length};let E=0;this.unevalEdges.length>0&&(E=T(this.unevalEdges,"none"),this.constructBridgeStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:E},this.tileToMeters)),u(b);const k=s(),j=s();if(this.unevalEdges.length>0){const R=this.unevalEdges.splice(E),L=T(R,"tunnel")+E;this.unevalEdges.push(...R),this.constructTunnelStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:E},{min:E,max:L})}u(k),d.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(j),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(y),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(g),this.maskSegments=Vi.simpleSegment(0,j.primitiveOffset,0,j.primitiveLength),this.depthSegments=Vi.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.renderableBridgeSegments=Vi.simpleSegment(0,b.primitiveOffset,0,b.primitiveLength),this.renderableTunnelSegments=Vi.simpleSegment(0,k.primitiveOffset,0,k.primitiveLength),this.shadowCasterSegments=Vi.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength)}update(r,s,u,d,g,y,b,T){this.bridgeProgramConfigurations.updatePaintArrays(r,s,g,u,d,y,b,T),this.tunnelProgramConfigurations.updatePaintArrays(r,s,g,u,d,y,b,T)}upload(r){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=r.createVertexBuffer(this.vertexPositions,G$.members),this.vertexBufferNormal=r.createVertexBuffer(this.vertexNormals,W$.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(r),this.tunnelProgramConfigurations.upload(r))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(r,s,u,d,g){const y=(b,T)=>{for(let E=0;E<T.length-1;E++){const k=T[E].featureIndex,j=T[E+1].vertexStart,R=r.feature(k);b.populatePaintArrays(j,R,k,{},u,s,d,void 0,g)}};y(this.bridgeProgramConfigurations,this.bridgeFeatureSections),y(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(r,s,u,d,g){const y=new Map;for(let b=d;b<g;b++){const T=u[b],E=T.a,k=T.b,j=La.computePosHash(r[E]),R=La.computePosHash(r[k]);let L=y.get(j);L||(L={},y.set(j,L));let z=y.get(R);z||(z={},y.set(R,z)),s[E]<=0&&s[k]<=0||(L.to=k,z.from=E)}return y}isTerminalVertex(r,s){const u=La.computePosHash(this.unevalVertices[r]),d=s.get(u);return!d||!d.from||!d.to}constructBridgeStructures(r,s,u,d,g,y){r.clearVertexLookup();const b=this.computeVertexConnections(s,u,d,g.min,g.max),T=1/y,E=.5*T,k=(Ot,It)=>We(Ot,s[It].x,s[It].y,u[It]*T),j=be(),R=be(),L=be(),z=be(),W=be(),J=(Ot,It)=>{const gt=b.get(La.computePosHash(s[It])),At=gt.from,nt=gt.to;if(!At||!nt)return;k(j,At),k(R,It),k(L,nt),ps(z),Os(j,R)||(Ei(W,R,j),Er(z,W)),Os(L,R)||(Ei(W,L,R),$e(z,z,Er(W,W)));const Ke=et(z);return Ke>0?Vt(Ot,z,1/Ke):void 0};let ee=Number.POSITIVE_INFINITY;this.sortSubarray(d,g.min,g.max,(Ot,It)=>Ot.featureInfo.featureIndex-It.featureInfo.featureIndex);const oe=be(),le=be(),de=be(),Se=be(),_e=be(),Ae=be(),ke=be(),De=be(),at=be(),Ue=[be(),be(),be(),be()],ct=[be(),be(),be(),be()],pt=[{coord:new xt(0,0),height:0},{coord:new xt(0,0),height:0}],bt=(Ot,It)=>Ot>It;for(let Ot=g.min;Ot<g.max;Ot++){const It=d[Ot];if(!It.featureInfo.guardRailEnabled||!this.prepareEdgePoints(pt,s,u,It,bt))continue;const[gt,At]=pt;if(We(oe,gt.coord.x,gt.coord.y,T*gt.height),We(le,At.coord.x,At.coord.y,T*At.height),Os(oe,le))continue;Ei(de,le,oe),Er(de,de);const nt=J(De,It.a)||de,Ke=J(at,It.b)||de;We(Se,nt[1],-nt[0],0),Er(Se,Se),We(_e,Ke[1],-Ke[0],0),Er(_e,_e),Ur(De,Se,nt),Er(Ae,De),Ur(De,_e,Ke),Er(ke,De),$e(Ue[0],oe,Vt(De,Ei(De,Se,Ae),E)),$e(Ue[1],oe,Vt(De,$e(De,Se,Ae),E)),$e(Ue[2],oe,Vt(De,Ae,E)),Ue[3]=oe,$e(ct[0],le,Vt(De,Ei(De,_e,ke),E)),$e(ct[1],le,Vt(De,$e(De,_e,ke),E)),$e(ct[2],le,Vt(De,ke,E)),ct[3]=le,ee=this.addFeatureSection(It.featureInfo.featureIndex,ee,this.bridgeFeatureSections,r);const St=r.addVertex(Ue[0],Se,y),Mt=r.addVertex(Ue[1],Se,y),vt=r.addVertex(ct[0],_e,y),er=r.addVertex(ct[1],_e,y);r.addTriangle(St,Mt,vt),r.addTriangle(Mt,er,vt);const or=r.addVertex(Ue[1],Ae,y),Xt=r.addVertex(Ue[2],Ae,y),$t=r.addVertex(ct[1],ke,y),Fr=r.addVertex(ct[2],ke,y);r.addTriangle(or,Xt,$t),r.addTriangle(Xt,Fr,$t),Wr(Se,Se),Wr(_e,_e);const Gt=r.addVertex(Ue[2],Se,y),vr=r.addVertex(Ue[3],Se,y),$r=r.addVertex(ct[2],_e,y),nn=r.addVertex(ct[3],_e,y);r.addTriangle(Gt,vr,$r),r.addTriangle(vr,nn,$r);const Pn=this.isTerminalVertex(It.a,b),Gr=this.isTerminalVertex(It.b,b);gt.height<.01&&Pn&&r.addQuad(Ue[3],Ue[2],Ue[1],Ue[0],Wr(nt,nt),y),At.height<.01&&Gr&&r.addQuad(ct[0],ct[1],ct[2],ct[3],Ke,y)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:r.getVertexCount()})}constructTunnelStructures(r,s,u,d,g,y){r.clearVertexLookup();let b=Number.POSITIVE_INFINITY;const T=(ee,oe)=>ee.featureInfo.featureIndex-oe.featureInfo.featureIndex;this.sortSubarray(d,g.min,g.max,T),this.sortSubarray(d,y.min,y.max,T);const E=ee=>Er(ee,ee),k=[{coord:new xt(0,0),height:0},{coord:new xt(0,0),height:0}],j=(ee,oe)=>ee<oe,R=be(),L=be(),z=be(),W=be(),J=be();for(let ee=g.min;ee<g.max;ee++){if(!this.prepareEdgePoints(k,s,u,d[ee],j))continue;const[oe,le]=k,de=E(We(J,-(le.coord.y-oe.coord.y),le.coord.x-oe.coord.x,0));b=this.addFeatureSection(d[ee].featureInfo.featureIndex,b,this.tunnelFeatureSections,r),r.addQuad(We(R,oe.coord.x,oe.coord.y,oe.height),We(L,le.coord.x,le.coord.y,le.height),We(z,le.coord.x,le.coord.y,d[ee].isTunnel?-.1:0),We(W,oe.coord.x,oe.coord.y,d[ee].isTunnel?-.1:0),de)}for(let ee=y.min;ee<y.max;ee++){const oe=d[ee];oe.isTunnel&&([oe.a,oe.b]=[oe.b,oe.a]);const le=s[oe.a],de=s[oe.b],Se=E(We(J,-(de.y-le.y),de.x-le.x,0));b=this.addFeatureSection(oe.featureInfo.featureIndex,b,this.tunnelFeatureSections,r),r.addQuad(We(R,de.x,de.y,0),We(L,le.x,le.y,0),We(z,le.x,le.y,u[oe.a]+4),We(W,de.x,de.y,u[oe.b]+4),Se),r.addQuad(We(R,le.x,le.y,0),We(L,de.x,de.y,0),We(z,de.x,de.y,u[oe.b]+4),We(W,le.x,le.y,u[oe.a]+4),Se)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:r.getVertexCount()})}setElevatedPoint(r,s,u,d){r.coord.x=s,r.coord.y=u,r.height=d}prepareEdgePoints(r,s,u,d,g){let y=s[d.a].x,b=s[d.a].y,T=s[d.b].x,E=s[d.b].y,k=u[d.a],j=u[d.b];const R=g(k,0),L=g(j,0);if(R&&L)return this.setElevatedPoint(r[0],y,b,k),this.setElevatedPoint(r[1],T,E,j),!0;if(!R&&!L)return!1;if(R){if(!L){const z=j/(j-k);T=Rr(T,y,z),E=Rr(E,b,z),j=Rr(j,k,z)}}else{const z=k/(k-j);y=Rr(y,T,z),b=Rr(b,E,z),k=Rr(k,j,z)}return this.setElevatedPoint(r[0],y,b,k),this.setElevatedPoint(r[1],T,E,j),!0}prepareEdges(r,s){if(s.length===0)return;s.sort((b,T)=>b.hash===T.hash?T.polygonIdx-b.polygonIdx:T.hash>b.hash?1:-1);let u=0,d=0,g=0,y=s[u].polygonIdx;do d++,(d===s.length||s[u].hash!==s[d].hash)&&((d-u==1||s[d-1].polygonIdx!==y)&&(g<u&&(s[g]=s[u],s[u]=null),s[g].type="none",g++),u=d,u!==s.length&&(y=s[u].polygonIdx));while(u!==s.length);if(s.splice(g),s.length!==0&&r.length!==0){s.sort((E,k)=>E.portalHash<k.portalHash?1:-1);let b=0,T=0;for(;b!==s.length&&T!==r.length;){const E=s[b],k=r[T];E.portalHash>k.hash?b++:k.hash>E.portalHash?T++:(E.type=k.type,b++)}}}isOnBorder(r,s){return r<=0&&s<=0||r>=zt&&s>=zt}addFeatureSection(r,s,u,d){return r!==s&&(s=r,u.push({featureIndex:r,vertexStart:d.getVertexCount()}),d.clearVertexLookup()),s}sortSubarray(r,s,u,d){const g=r.slice(s,u);g.sort(d),r.splice(s,g.length,...g)}static computeEdgeHash(r,s){return(r.y===s.y&&r.x>s.x||r.y>s.y)&&([r,s]=[s,r]),BigInt(La.computePosHash(r))<<32n|BigInt(La.computePosHash(s))}static computePosHash(r){return((65535&r.x)<<16|65535&r.y)>>>0}}var fR,pR={exports:{}},mR=(fR||(fR=1,function(a,r){(function(s){function u(ye,pe){return ye>pe?1:ye<pe?-1:0}var d=function(ye,pe){ye===void 0&&(ye=u),pe===void 0&&(pe=!1),this._compare=ye,this._root=null,this._size=0,this._noDuplicates=!!pe},g={size:{configurable:!0}};function y(ye,pe,ut,Ut,dt){var qt=dt-Ut;if(qt>0){var hr=Ut+Math.floor(qt/2),ur={key:pe[hr],data:ut[hr],parent:ye};return ur.left=y(ur,pe,ut,Ut,hr),ur.right=y(ur,pe,ut,hr+1,dt),ur}return null}function b(ye,pe,ut,Ut,dt){if(!(ut>=Ut)){for(var qt=ye[ut+Ut>>1],hr=ut-1,ur=Ut+1;;){do hr++;while(dt(ye[hr],qt)<0);do ur--;while(dt(ye[ur],qt)>0);if(hr>=ur)break;var Hr=ye[hr];ye[hr]=ye[ur],ye[ur]=Hr,Hr=pe[hr],pe[hr]=pe[ur],pe[ur]=Hr}b(ye,pe,ut,ur,dt),b(ye,pe,ur+1,Ut,dt)}}d.prototype.rotateLeft=function(ye){var pe=ye.right;pe&&(ye.right=pe.left,pe.left&&(pe.left.parent=ye),pe.parent=ye.parent),ye.parent?ye===ye.parent.left?ye.parent.left=pe:ye.parent.right=pe:this._root=pe,pe&&(pe.left=ye),ye.parent=pe},d.prototype.rotateRight=function(ye){var pe=ye.left;pe&&(ye.left=pe.right,pe.right&&(pe.right.parent=ye),pe.parent=ye.parent),ye.parent?ye===ye.parent.left?ye.parent.left=pe:ye.parent.right=pe:this._root=pe,pe&&(pe.right=ye),ye.parent=pe},d.prototype._splay=function(ye){for(;ye.parent;){var pe=ye.parent;pe.parent?pe.left===ye&&pe.parent.left===pe?(this.rotateRight(pe.parent),this.rotateRight(pe)):pe.right===ye&&pe.parent.right===pe?(this.rotateLeft(pe.parent),this.rotateLeft(pe)):pe.left===ye&&pe.parent.right===pe?(this.rotateRight(pe),this.rotateLeft(pe)):(this.rotateLeft(pe),this.rotateRight(pe)):pe.left===ye?this.rotateRight(pe):this.rotateLeft(pe)}},d.prototype.splay=function(ye){for(var pe,ut,Ut,dt,qt;ye.parent;)(ut=(pe=ye.parent).parent)&&ut.parent?((Ut=ut.parent).left===ut?Ut.left=ye:Ut.right=ye,ye.parent=Ut):(ye.parent=null,this._root=ye),dt=ye.left,qt=ye.right,ye===pe.left?(ut&&(ut.left===pe?(pe.right?(ut.left=pe.right,ut.left.parent=ut):ut.left=null,pe.right=ut,ut.parent=pe):(dt?(ut.right=dt,dt.parent=ut):ut.right=null,ye.left=ut,ut.parent=ye)),qt?(pe.left=qt,qt.parent=pe):pe.left=null,ye.right=pe,pe.parent=ye):(ut&&(ut.right===pe?(pe.left?(ut.right=pe.left,ut.right.parent=ut):ut.right=null,pe.left=ut,ut.parent=pe):(qt?(ut.left=qt,qt.parent=ut):ut.left=null,ye.right=ut,ut.parent=ye)),dt?(pe.right=dt,dt.parent=pe):pe.right=null,ye.left=pe,pe.parent=ye)},d.prototype.replace=function(ye,pe){ye.parent?ye===ye.parent.left?ye.parent.left=pe:ye.parent.right=pe:this._root=pe,pe&&(pe.parent=ye.parent)},d.prototype.minNode=function(ye){if(ye===void 0&&(ye=this._root),ye)for(;ye.left;)ye=ye.left;return ye},d.prototype.maxNode=function(ye){if(ye===void 0&&(ye=this._root),ye)for(;ye.right;)ye=ye.right;return ye},d.prototype.insert=function(ye,pe){var ut=this._root,Ut=null,dt=this._compare;if(this._noDuplicates)for(;ut;){if(Ut=ut,dt(ut.key,ye)===0)return;ut=dt(ut.key,ye)<0?ut.right:ut.left}else for(;ut;)Ut=ut,ut=dt(ut.key,ye)<0?ut.right:ut.left;return ut={key:ye,data:pe,left:null,right:null,parent:Ut},Ut?dt(Ut.key,ut.key)<0?Ut.right=ut:Ut.left=ut:this._root=ut,this.splay(ut),this._size++,ut},d.prototype.find=function(ye){for(var pe=this._root,ut=this._compare;pe;){var Ut=ut(pe.key,ye);if(Ut<0)pe=pe.right;else{if(!(Ut>0))return pe;pe=pe.left}}return null},d.prototype.contains=function(ye){for(var pe=this._root,ut=this._compare;pe;){var Ut=ut(ye,pe.key);if(Ut===0)return!0;pe=Ut<0?pe.left:pe.right}return!1},d.prototype.remove=function(ye){var pe=this.find(ye);if(!pe)return!1;if(this.splay(pe),pe.left)if(pe.right){var ut=this.minNode(pe.right);ut.parent!==pe&&(this.replace(ut,ut.right),ut.right=pe.right,ut.right.parent=ut),this.replace(pe,ut),ut.left=pe.left,ut.left.parent=ut}else this.replace(pe,pe.left);else this.replace(pe,pe.right);return this._size--,!0},d.prototype.removeNode=function(ye){if(!ye)return!1;if(this.splay(ye),ye.left)if(ye.right){var pe=this.minNode(ye.right);pe.parent!==ye&&(this.replace(pe,pe.right),pe.right=ye.right,pe.right.parent=pe),this.replace(ye,pe),pe.left=ye.left,pe.left.parent=pe}else this.replace(ye,ye.left);else this.replace(ye,ye.right);return this._size--,!0},d.prototype.erase=function(ye){var pe=this.find(ye);if(pe){this.splay(pe);var ut=pe.left,Ut=pe.right,dt=null;ut&&(ut.parent=null,dt=this.maxNode(ut),this.splay(dt),this._root=dt),Ut&&(ut?dt.right=Ut:this._root=Ut,Ut.parent=dt),this._size--}},d.prototype.pop=function(){var ye=this._root,pe=null;if(ye){for(;ye.left;)ye=ye.left;pe={key:ye.key,data:ye.data},this.remove(ye.key)}return pe},d.prototype.next=function(ye){var pe=ye;if(pe)if(pe.right)for(pe=pe.right;pe&&pe.left;)pe=pe.left;else for(pe=ye.parent;pe&&pe.right===ye;)ye=pe,pe=pe.parent;return pe},d.prototype.prev=function(ye){var pe=ye;if(pe)if(pe.left)for(pe=pe.left;pe&&pe.right;)pe=pe.right;else for(pe=ye.parent;pe&&pe.left===ye;)ye=pe,pe=pe.parent;return pe},d.prototype.forEach=function(ye){for(var pe=this._root,ut=[],Ut=!1,dt=0;!Ut;)pe?(ut.push(pe),pe=pe.left):ut.length>0?(ye(pe=ut.pop(),dt++),pe=pe.right):Ut=!0;return this},d.prototype.range=function(ye,pe,ut,Ut){for(var dt=[],qt=this._compare,hr=this._root;dt.length!==0||hr;)if(hr)dt.push(hr),hr=hr.left;else{if(qt((hr=dt.pop()).key,pe)>0)break;if(qt(hr.key,ye)>=0&&ut.call(Ut,hr))return this;hr=hr.right}return this},d.prototype.keys=function(){for(var ye=this._root,pe=[],ut=[],Ut=!1;!Ut;)ye?(pe.push(ye),ye=ye.left):pe.length>0?(ye=pe.pop(),ut.push(ye.key),ye=ye.right):Ut=!0;return ut},d.prototype.values=function(){for(var ye=this._root,pe=[],ut=[],Ut=!1;!Ut;)ye?(pe.push(ye),ye=ye.left):pe.length>0?(ye=pe.pop(),ut.push(ye.data),ye=ye.right):Ut=!0;return ut},d.prototype.at=function(ye){for(var pe=this._root,ut=[],Ut=!1,dt=0;!Ut;)if(pe)ut.push(pe),pe=pe.left;else if(ut.length>0){if(pe=ut.pop(),dt===ye)return pe;dt++,pe=pe.right}else Ut=!0;return null},d.prototype.load=function(ye,pe,ut){if(ye===void 0&&(ye=[]),pe===void 0&&(pe=[]),ut===void 0&&(ut=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Ut=ye.length;return ut&&b(ye,pe,0,Ut-1,this._compare),this._root=y(null,ye,pe,0,Ut),this._size=Ut,this},d.prototype.min=function(){var ye=this.minNode(this._root);return ye?ye.key:null},d.prototype.max=function(){var ye=this.maxNode(this._root);return ye?ye.key:null},d.prototype.isEmpty=function(){return this._root===null},g.size.get=function(){return this._size},d.createTree=function(ye,pe,ut,Ut,dt){return new d(ut,dt).load(ye,pe,Ut)},Object.defineProperties(d.prototype,g);var T=0,E=1,k=2,j=3,R=0,L=1,z=2,W=3;function J(ye,pe,ut){pe===null?(ye.inOut=!1,ye.otherInOut=!0):(ye.isSubject===pe.isSubject?(ye.inOut=!pe.inOut,ye.otherInOut=pe.otherInOut):(ye.inOut=!pe.otherInOut,ye.otherInOut=pe.isVertical()?!pe.inOut:pe.inOut),pe&&(ye.prevInResult=!ee(pe,ut)||pe.isVertical()?pe.prevInResult:pe));var Ut=ee(ye,ut);ye.resultTransition=Ut?function(dt,qt){var hr,ur=!dt.inOut,Hr=!dt.otherInOut;switch(qt){case R:hr=ur&&Hr;break;case L:hr=ur||Hr;break;case W:hr=ur^Hr;break;case z:hr=dt.isSubject?ur&&!Hr:Hr&&!ur}return hr?1:-1}(ye,ut):0}function ee(ye,pe){switch(ye.type){case T:switch(pe){case R:return!ye.otherInOut;case L:return ye.otherInOut;case z:return ye.isSubject&&ye.otherInOut||!ye.isSubject&&!ye.otherInOut;case W:return!0}break;case k:return pe===R||pe===L;case j:return pe===z;case E:return!1}return!1}var oe=function(ye,pe,ut,Ut,dt){this.left=pe,this.point=ye,this.otherEvent=ut,this.isSubject=Ut,this.type=dt||T,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},le={inResult:{configurable:!0}};function de(ye,pe){return ye[0]===pe[0]&&ye[1]===pe[1]}oe.prototype.isBelow=function(ye){var pe=this.point,ut=this.otherEvent.point;return this.left?(pe[0]-ye[0])*(ut[1]-ye[1])-(ut[0]-ye[0])*(pe[1]-ye[1])>0:(ut[0]-ye[0])*(pe[1]-ye[1])-(pe[0]-ye[0])*(ut[1]-ye[1])>0},oe.prototype.isAbove=function(ye){return!this.isBelow(ye)},oe.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},le.inResult.get=function(){return this.resultTransition!==0},oe.prototype.clone=function(){var ye=new oe(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ye.contourId=this.contourId,ye.resultTransition=this.resultTransition,ye.prevInResult=this.prevInResult,ye.isExteriorRing=this.isExteriorRing,ye.inOut=this.inOut,ye.otherInOut=this.otherInOut,ye},Object.defineProperties(oe.prototype,le);var Se=11102230246251565e-32,_e=134217729,Ae=(3+8*Se)*Se;function ke(ye,pe,ut,Ut,dt){var qt,hr,ur,Hr,Ir=pe[0],lr=Ut[0],On=0,ci=0;lr>Ir==lr>-Ir?(qt=Ir,Ir=pe[++On]):(qt=lr,lr=Ut[++ci]);var jr=0;if(On<ye&&ci<ut)for(lr>Ir==lr>-Ir?(ur=qt-((hr=Ir+qt)-Ir),Ir=pe[++On]):(ur=qt-((hr=lr+qt)-lr),lr=Ut[++ci]),qt=hr,ur!==0&&(dt[jr++]=ur);On<ye&&ci<ut;)lr>Ir==lr>-Ir?(ur=qt-((hr=qt+Ir)-(Hr=hr-qt))+(Ir-Hr),Ir=pe[++On]):(ur=qt-((hr=qt+lr)-(Hr=hr-qt))+(lr-Hr),lr=Ut[++ci]),qt=hr,ur!==0&&(dt[jr++]=ur);for(;On<ye;)ur=qt-((hr=qt+Ir)-(Hr=hr-qt))+(Ir-Hr),Ir=pe[++On],qt=hr,ur!==0&&(dt[jr++]=ur);for(;ci<ut;)ur=qt-((hr=qt+lr)-(Hr=hr-qt))+(lr-Hr),lr=Ut[++ci],qt=hr,ur!==0&&(dt[jr++]=ur);return qt===0&&jr!==0||(dt[jr++]=qt),jr}function De(ye){return new Float64Array(ye)}var at=33306690738754716e-32,Ue=22204460492503146e-32,ct=11093356479670487e-47,pt=De(4),bt=De(8),Ot=De(12),It=De(16),gt=De(4);function At(ye,pe,ut){var Ut=function(dt,qt,hr,ur,Hr,Ir){var lr=(qt-Ir)*(hr-Hr),On=(dt-Hr)*(ur-Ir),ci=lr-On;if(lr===0||On===0||lr>0!=On>0)return ci;var jr=Math.abs(lr+On);return Math.abs(ci)>=at*jr?ci:-function(An,ui,Jn,Zi,Pi,_i,ii){var Bn,Zr,Vn,yi,Pr,kn,ki,es,hs,Cs,ji,bs,ga,ws,Fa,Co,Rl,_a,Ba=An-Pi,Ao=Jn-Pi,Va=ui-_i,Ml=Zi-_i;pt[0]=(Fa=(es=Ba-(ki=(kn=_e*Ba)-(kn-Ba)))*(Cs=Ml-(hs=(kn=_e*Ml)-(kn-Ml)))-((ws=Ba*Ml)-ki*hs-es*hs-ki*Cs))-((ji=Fa-(Rl=(es=Va-(ki=(kn=_e*Va)-(kn-Va)))*(Cs=Ao-(hs=(kn=_e*Ao)-(kn-Ao)))-((Co=Va*Ao)-ki*hs-es*hs-ki*Cs)))+(Pr=Fa-ji))+(Pr-Rl),pt[1]=(ga=ws-((bs=ws+ji)-(Pr=bs-ws))+(ji-Pr))-((ji=ga-Co)+(Pr=ga-ji))+(Pr-Co),pt[2]=bs-((_a=bs+ji)-(Pr=_a-bs))+(ji-Pr),pt[3]=_a;var ao=function(Gh,Iu){for(var Cw=Iu[0],f_=1;f_<4;f_++)Cw+=Iu[f_];return Cw}(0,pt),Zo=Ue*ii;if(ao>=Zo||-ao>=Zo||(Bn=An-(Ba+(Pr=An-Ba))+(Pr-Pi),Vn=Jn-(Ao+(Pr=Jn-Ao))+(Pr-Pi),Zr=ui-(Va+(Pr=ui-Va))+(Pr-_i),yi=Zi-(Ml+(Pr=Zi-Ml))+(Pr-_i),Bn===0&&Zr===0&&Vn===0&&yi===0)||(Zo=ct*ii+Ae*Math.abs(ao),(ao+=Ba*yi+Ml*Bn-(Va*Vn+Ao*Zr))>=Zo||-ao>=Zo))return ao;gt[0]=(Fa=(es=Bn-(ki=(kn=_e*Bn)-(kn-Bn)))*(Cs=Ml-(hs=(kn=_e*Ml)-(kn-Ml)))-((ws=Bn*Ml)-ki*hs-es*hs-ki*Cs))-((ji=Fa-(Rl=(es=Zr-(ki=(kn=_e*Zr)-(kn-Zr)))*(Cs=Ao-(hs=(kn=_e*Ao)-(kn-Ao)))-((Co=Zr*Ao)-ki*hs-es*hs-ki*Cs)))+(Pr=Fa-ji))+(Pr-Rl),gt[1]=(ga=ws-((bs=ws+ji)-(Pr=bs-ws))+(ji-Pr))-((ji=ga-Co)+(Pr=ga-ji))+(Pr-Co),gt[2]=bs-((_a=bs+ji)-(Pr=_a-bs))+(ji-Pr),gt[3]=_a;var Au=ke(4,pt,4,gt,bt);gt[0]=(Fa=(es=Ba-(ki=(kn=_e*Ba)-(kn-Ba)))*(Cs=yi-(hs=(kn=_e*yi)-(kn-yi)))-((ws=Ba*yi)-ki*hs-es*hs-ki*Cs))-((ji=Fa-(Rl=(es=Va-(ki=(kn=_e*Va)-(kn-Va)))*(Cs=Vn-(hs=(kn=_e*Vn)-(kn-Vn)))-((Co=Va*Vn)-ki*hs-es*hs-ki*Cs)))+(Pr=Fa-ji))+(Pr-Rl),gt[1]=(ga=ws-((bs=ws+ji)-(Pr=bs-ws))+(ji-Pr))-((ji=ga-Co)+(Pr=ga-ji))+(Pr-Co),gt[2]=bs-((_a=bs+ji)-(Pr=_a-bs))+(ji-Pr),gt[3]=_a;var qh=ke(Au,bt,4,gt,Ot);gt[0]=(Fa=(es=Bn-(ki=(kn=_e*Bn)-(kn-Bn)))*(Cs=yi-(hs=(kn=_e*yi)-(kn-yi)))-((ws=Bn*yi)-ki*hs-es*hs-ki*Cs))-((ji=Fa-(Rl=(es=Zr-(ki=(kn=_e*Zr)-(kn-Zr)))*(Cs=Vn-(hs=(kn=_e*Vn)-(kn-Vn)))-((Co=Zr*Vn)-ki*hs-es*hs-ki*Cs)))+(Pr=Fa-ji))+(Pr-Rl),gt[1]=(ga=ws-((bs=ws+ji)-(Pr=bs-ws))+(ji-Pr))-((ji=ga-Co)+(Pr=ga-ji))+(Pr-Co),gt[2]=bs-((_a=bs+ji)-(Pr=_a-bs))+(ji-Pr),gt[3]=_a;var h_=ke(qh,Ot,4,gt,It);return It[h_-1]}(dt,qt,hr,ur,Hr,Ir,jr)}(ye[0],ye[1],pe[0],pe[1],ut[0],ut[1]);return Ut>0?-1:Ut<0?1:0}function nt(ye,pe){var ut=ye.point,Ut=pe.point;return ut[0]>Ut[0]?1:ut[0]<Ut[0]?-1:ut[1]!==Ut[1]?ut[1]>Ut[1]?1:-1:function(dt,qt,hr,ur){return dt.left!==qt.left?dt.left?1:-1:At(hr,dt.otherEvent.point,qt.otherEvent.point)!==0?dt.isBelow(qt.otherEvent.point)?-1:1:!dt.isSubject&&qt.isSubject?1:-1}(ye,pe,ut)}function Ke(ye,pe,ut){var Ut=new oe(pe,!1,ye,ye.isSubject),dt=new oe(pe,!0,ye.otherEvent,ye.isSubject);return de(ye.point,ye.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ye),Ut.contourId=dt.contourId=ye.contourId,nt(dt,ye.otherEvent)>0&&(ye.otherEvent.left=!0,dt.left=!1),ye.otherEvent.otherEvent=dt,ye.otherEvent=Ut,ut.push(dt),ut.push(Ut),ut}function St(ye,pe){return ye[0]*pe[1]-ye[1]*pe[0]}function Mt(ye,pe){return ye[0]*pe[0]+ye[1]*pe[1]}function vt(ye,pe,ut){var Ut=function(Hr,Ir,lr,On,ci){var jr=[Ir[0]-Hr[0],Ir[1]-Hr[1]],An=[On[0]-lr[0],On[1]-lr[1]];function ui(kn,ki,es){return[kn[0]+ki*es[0],kn[1]+ki*es[1]]}var Jn=[lr[0]-Hr[0],lr[1]-Hr[1]],Zi=St(jr,An),Pi=Zi*Zi,_i=Mt(jr,jr);if(Pi>0){var ii=St(Jn,An)/Zi;if(ii<0||ii>1)return null;var Bn=St(Jn,jr)/Zi;return Bn<0||Bn>1?null:ii===0||ii===1?[ui(Hr,ii,jr)]:Bn===0||Bn===1?[ui(lr,Bn,An)]:[ui(Hr,ii,jr)]}if((Pi=(Zi=St(Jn,jr))*Zi)>0)return null;var Zr=Mt(jr,Jn)/_i,Vn=Zr+Mt(jr,An)/_i,yi=Math.min(Zr,Vn),Pr=Math.max(Zr,Vn);return yi<=1&&Pr>=0?yi===1?[ui(Hr,yi>0?yi:0,jr)]:Pr===0?[ui(Hr,Pr<1?Pr:1,jr)]:[ui(Hr,yi>0?yi:0,jr),ui(Hr,Pr<1?Pr:1,jr)]:null}(ye.point,ye.otherEvent.point,pe.point,pe.otherEvent.point),dt=Ut?Ut.length:0;if(dt===0||dt===1&&(de(ye.point,pe.point)||de(ye.otherEvent.point,pe.otherEvent.point))||dt===2&&ye.isSubject===pe.isSubject)return 0;if(dt===1)return de(ye.point,Ut[0])||de(ye.otherEvent.point,Ut[0])||Ke(ye,Ut[0],ut),de(pe.point,Ut[0])||de(pe.otherEvent.point,Ut[0])||Ke(pe,Ut[0],ut),1;var qt=[],hr=!1,ur=!1;return de(ye.point,pe.point)?hr=!0:nt(ye,pe)===1?qt.push(pe,ye):qt.push(ye,pe),de(ye.otherEvent.point,pe.otherEvent.point)?ur=!0:nt(ye.otherEvent,pe.otherEvent)===1?qt.push(pe.otherEvent,ye.otherEvent):qt.push(ye.otherEvent,pe.otherEvent),hr&&ur||hr?(pe.type=E,ye.type=pe.inOut===ye.inOut?k:j,hr&&!ur&&Ke(qt[1].otherEvent,qt[0].point,ut),2):ur?(Ke(qt[0],qt[1].point,ut),3):qt[0]!==qt[3].otherEvent?(Ke(qt[0],qt[1].point,ut),Ke(qt[1],qt[2].point,ut),3):(Ke(qt[0],qt[1].point,ut),Ke(qt[3].otherEvent,qt[2].point,ut),3)}function er(ye,pe){if(ye===pe)return 0;if(At(ye.point,ye.otherEvent.point,pe.point)!==0||At(ye.point,ye.otherEvent.point,pe.otherEvent.point)!==0)return de(ye.point,pe.point)?ye.isBelow(pe.otherEvent.point)?-1:1:ye.point[0]===pe.point[0]?ye.point[1]<pe.point[1]?-1:1:nt(ye,pe)===1?pe.isAbove(ye.point)?-1:1:ye.isBelow(pe.point)?-1:1;if(ye.isSubject!==pe.isSubject)return ye.isSubject?-1:1;var ut=ye.point,Ut=pe.point;return ut[0]===Ut[0]&&ut[1]===Ut[1]?(ut=ye.otherEvent.point)[0]===(Ut=pe.otherEvent.point)[0]&&ut[1]===Ut[1]?0:ye.contourId>pe.contourId?1:-1:nt(ye,pe)===1?1:-1}var or=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Xt(ye,pe,ut,Ut){var dt,qt=ye+1,hr=pe[ye].point,ur=pe.length;for(qt<ur&&(dt=pe[qt].point);qt<ur&&dt[0]===hr[0]&&dt[1]===hr[1];){if(!ut[qt])return qt;++qt<ur&&(dt=pe[qt].point)}for(qt=ye-1;ut[qt]&&qt>Ut;)qt--;return qt}or.prototype.isExterior=function(){return this.holeOf==null};var $t=Gt,Fr=Gt;function Gt(ye,pe){if(!(this instanceof Gt))return new Gt(ye,pe);if(this.data=ye||[],this.length=this.data.length,this.compare=pe||vr,this.length>0)for(var ut=(this.length>>1)-1;ut>=0;ut--)this._down(ut)}function vr(ye,pe){return ye<pe?-1:ye>pe?1:0}Gt.prototype={push:function(ye){this.data.push(ye),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ye=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ye}},peek:function(){return this.data[0]},_up:function(ye){for(var pe=this.data,ut=this.compare,Ut=pe[ye];ye>0;){var dt=ye-1>>1,qt=pe[dt];if(ut(Ut,qt)>=0)break;pe[ye]=qt,ye=dt}pe[ye]=Ut},_down:function(ye){for(var pe=this.data,ut=this.compare,Ut=this.length>>1,dt=pe[ye];ye<Ut;){var qt=1+(ye<<1),hr=qt+1,ur=pe[qt];if(hr<this.length&&ut(pe[hr],ur)<0&&(qt=hr,ur=pe[hr]),ut(ur,dt)>=0)break;pe[ye]=ur,ye=qt}pe[ye]=dt}},$t.default=Fr;var $r=Math.max,nn=Math.min,Pn=0;function Gr(ye,pe,ut,Ut,dt,qt){var hr,ur,Hr,Ir,lr,On;for(hr=0,ur=ye.length-1;hr<ur;hr++)if(Ir=ye[hr+1],lr=new oe(Hr=ye[hr],!1,void 0,pe),On=new oe(Ir,!1,lr,pe),lr.otherEvent=On,Hr[0]!==Ir[0]||Hr[1]!==Ir[1]){lr.contourId=On.contourId=ut,qt||(lr.isExteriorRing=!1,On.isExteriorRing=!1),nt(lr,On)>0?On.left=!0:lr.left=!0;var ci=Hr[0],jr=Hr[1];dt[0]=nn(dt[0],ci),dt[1]=nn(dt[1],jr),dt[2]=$r(dt[2],ci),dt[3]=$r(dt[3],jr),Ut.push(lr),Ut.push(On)}}var zn=[];function Fn(ye,pe,ut){typeof ye[0][0][0]=="number"&&(ye=[ye]),typeof pe[0][0][0]=="number"&&(pe=[pe]);var Ut=function(jr,An,ui){var Jn=null;return jr.length*An.length==0&&(ui===R?Jn=zn:ui===z?Jn=jr:ui!==L&&ui!==W||(Jn=jr.length===0?An:jr)),Jn}(ye,pe,ut);if(Ut)return Ut===zn?null:Ut;var dt=[1/0,1/0,-1/0,-1/0],qt=[1/0,1/0,-1/0,-1/0],hr=function(jr,An,ui,Jn,Zi){var Pi,_i,ii,Bn,Zr,Vn,yi=new $t(null,nt);for(ii=0,Bn=jr.length;ii<Bn;ii++)for(Zr=0,Vn=(Pi=jr[ii]).length;Zr<Vn;Zr++)(_i=Zr===0)&&Pn++,Gr(Pi[Zr],!0,Pn,yi,ui,_i);for(ii=0,Bn=An.length;ii<Bn;ii++)for(Zr=0,Vn=(Pi=An[ii]).length;Zr<Vn;Zr++)_i=Zr===0,Zi===z&&(_i=!1),_i&&Pn++,Gr(Pi[Zr],!1,Pn,yi,Jn,_i);return yi}(ye,pe,dt,qt,ut);if(Ut=function(jr,An,ui,Jn,Zi){var Pi=null;return(ui[0]>Jn[2]||Jn[0]>ui[2]||ui[1]>Jn[3]||Jn[1]>ui[3])&&(Zi===R?Pi=zn:Zi===z?Pi=jr:Zi!==L&&Zi!==W||(Pi=jr.concat(An))),Pi}(ye,pe,dt,qt,ut))return Ut===zn?null:Ut;for(var ur=function(jr){var An,ui,Jn=function(ii){var Bn,Zr,Vn,yi,Pr=[];for(Zr=0,Vn=ii.length;Zr<Vn;Zr++)((Bn=ii[Zr]).left&&Bn.inResult||!Bn.left&&Bn.otherEvent.inResult)&&Pr.push(Bn);for(var kn=!1;!kn;)for(kn=!0,Zr=0,Vn=Pr.length;Zr<Vn;Zr++)Zr+1<Vn&&nt(Pr[Zr],Pr[Zr+1])===1&&(yi=Pr[Zr],Pr[Zr]=Pr[Zr+1],Pr[Zr+1]=yi,kn=!1);for(Zr=0,Vn=Pr.length;Zr<Vn;Zr++)(Bn=Pr[Zr]).otherPos=Zr;for(Zr=0,Vn=Pr.length;Zr<Vn;Zr++)(Bn=Pr[Zr]).left||(yi=Bn.otherPos,Bn.otherPos=Bn.otherEvent.otherPos,Bn.otherEvent.otherPos=yi);return Pr}(jr),Zi={},Pi=[],_i=function(){if(!Zi[An]){var ii=Pi.length,Bn=function(Pr,kn,ki){var es=new or;if(Pr.prevInResult!=null){var hs=Pr.prevInResult,Cs=hs.outputContourId;if(hs.resultTransition>0){var ji=kn[Cs];if(ji.holeOf!=null){var bs=ji.holeOf;kn[bs].holeIds.push(ki),es.holeOf=bs,es.depth=kn[Cs].depth}else kn[Cs].holeIds.push(ki),es.holeOf=Cs,es.depth=kn[Cs].depth+1}else es.holeOf=null,es.depth=kn[Cs].depth}else es.holeOf=null,es.depth=0;return es}(Jn[An],Pi,ii),Zr=function(Pr){Zi[Pr]=!0,Pr<Jn.length&&Jn[Pr]&&(Jn[Pr].outputContourId=ii)},Vn=An,yi=An;for(Bn.points.push(Jn[An].point);Zr(Vn),Zr(Vn=Jn[Vn].otherPos),Bn.points.push(Jn[Vn].point),!((Vn=Xt(Vn,Jn,Zi,yi))==yi||Vn>=Jn.length)&&Jn[Vn];);Pi.push(Bn)}};for(An=0,ui=Jn.length;An<ui;An++)_i();return Pi}(function(jr,An,ui,Jn,Zi,Pi){for(var _i,ii,Bn,Zr=new d(er),Vn=[],yi=Math.min(Jn[2],Zi[2]);jr.length!==0;){var Pr=jr.pop();if(Vn.push(Pr),Pi===R&&Pr.point[0]>yi||Pi===z&&Pr.point[0]>Jn[2])break;if(Pr.left){ii=_i=Zr.insert(Pr),_i=_i!==(Bn=Zr.minNode())?Zr.prev(_i):null,ii=Zr.next(ii);var kn=_i?_i.key:null;if(J(Pr,kn,Pi),ii&&vt(Pr,ii.key,jr)===2&&(J(Pr,kn,Pi),J(ii.key,Pr,Pi)),_i&&vt(_i.key,Pr,jr)===2){var ki=_i;J(kn,(ki=ki!==Bn?Zr.prev(ki):null)?ki.key:null,Pi),J(Pr,kn,Pi)}}else ii=_i=Zr.find(Pr=Pr.otherEvent),_i&&ii&&(_i=_i!==Bn?Zr.prev(_i):null,ii=Zr.next(ii),Zr.remove(Pr),ii&&_i&&vt(_i.key,ii.key,jr))}return Vn}(hr,0,0,dt,qt,ut)),Hr=[],Ir=0;Ir<ur.length;Ir++){var lr=ur[Ir];if(lr.isExterior()){for(var On=[lr.points],ci=0;ci<lr.holeIds.length;ci++)On.push(ur[lr.holeIds[ci]].points);Hr.push(On)}}return Hr}var Li={UNION:L,DIFFERENCE:z,INTERSECTION:R,XOR:W};s.diff=function(ye,pe){return Fn(ye,pe,z)},s.intersection=function(ye,pe){return Fn(ye,pe,R)},s.operations=Li,s.union=function(ye,pe){return Fn(ye,pe,L)},s.xor=function(ye,pe){return Fn(ye,pe,W)},Object.defineProperty(s,"__esModule",{value:!0})})(r)}(0,pR.exports)),pR.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function z1(a,r,s,u){const d=[],g=u===0?(y,b,T,E,k,j)=>{y.push(new xt(j,T+(j-b)/(E-b)*(k-T)))}:(y,b,T,E,k,j)=>{y.push(new xt(b+(j-T)/(k-T)*(E-b),j))};for(const y of a){const b=[];for(const T of y){if(T.length<=2)continue;const E=[];for(let R=0;R<T.length-1;R++){const L=T[R].x,z=T[R].y,W=T[R+1].x,J=T[R+1].y,ee=u===0?L:z,oe=u===0?W:J;ee<r?oe>r&&g(E,L,z,W,J,r):ee>s?oe<s&&g(E,L,z,W,J,s):E.push(T[R]),oe<r&&ee>=r&&g(E,L,z,W,J,r),oe>s&&ee<=s&&g(E,L,z,W,J,s)}let k=T[T.length-1];const j=u===0?k.x:k.y;j>=r&&j<=s&&E.push(k),E.length&&(k=E[E.length-1],E[0].x===k.x&&E[0].y===k.y||E.push(E[0]),b.push(E))}b.length&&d.push(b)}return d}function i8(a,r){const s=yE(a),u=yE([r]),d=mR.intersection(s,u);return d==null?[]:gR(d)}function s8(a,r){let u=yE(a,65536);const d=[];for(;r.valid();r.next()){const[g,y]=r.get(),b=g.x*65536,T=g.y*65536,E=y.x*65536,k=y.y*65536,j=E-b,R=k-T,L=Math.hypot(j,R);if(L===0)continue;const z=Math.trunc(R/L*3),W=-Math.trunc(j/L*3);d.push([[[b,T],[E,k],[E+z,k+W],[b+z,T+W],[b,T]]])}return d.length>0&&(u=mR.diff(u,d)),gR(u,1/65536)}function yE(a,r=1){return[a.map(s=>s.map(u=>[u.x*r,u.y*r]))]}function gR(a,r=1){return a.map(s=>s.map((u,d)=>{const g=u.map(y=>new xt(y[0]*r,y[1]*r).round());return d>0&&g.reverse(),g}))}class vE{constructor(r,s){this.layoutVertexArray=new ea,this.indexArray=new Mi,this.lineIndexArray=new ll,this.triangleSegments=new Vi,this.lineSegments=new Vi,this.programConfigurations=new kl(r.layers,{zoom:r.zoom,lut:r.lut}),this.uploaded=!1,s&&(this.elevatedLayoutVertexArray=new Cc)}update(r,s,u,d,g,y,b,T){this.programConfigurations.updatePaintArrays(r,s,g,u,d,y,b,T)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,$$.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.lineIndexBuffer=r.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=r.createVertexBuffer(this.elevatedLayoutVertexArray,q$.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(r,s,u,d,g,y,b){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,s,u,d,g,y,void 0,b)}}class xE{constructor(r){this.zoom=r.zoom,this.pixelRatio=r.pixelRatio,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=r.lut,this.bufferData=new vE(r,!1),this.elevationBufferData=new vE(r,!0),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=r.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=r.sourceLayerIndex,this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,s){}updateAppearances(r,s,u,d){}populate(r,s,u,d){this.hasPattern=gE("fill",this.layers,this.pixelRatio,s);const g=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:b,id:T,index:E,sourceLayerIndex:k}of r){const j=this.layers[0]._featureFilter.needGeometry,R=Ze(b,j);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),R,u))continue;const L=g?g.evaluate(R,{},u,s.availableImages):void 0,z={id:T,properties:b.properties,type:b.type,sourceLayerIndex:k,index:E,geometry:j?R.geometry:ft(b,u,d),patterns:{},sortKey:L};y.push(z)}g&&y.sort((b,T)=>b.sortKey-T.sortKey);for(const b of y){const{geometry:T,index:E,sourceLayerIndex:k}=b;if(this.hasPattern){const j=_E("fill",this.layers,b,this.zoom,this.pixelRatio,s);this.patternFeatures.push(j)}else this.addFeature(b,T,E,u,{},s.availableImages,s.brightness,s.elevationFeatures);s.featureIndex.insert(r[E].feature,T,E,k,this.index)}}update(r,s,u,d,g,y,b){this.bufferData.update(r,s,u,d,g,y,b,this.worldview),this.elevationBufferData.update(r,s,u,d,g,y,b,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(r,s,u,d,g,y,b,this.worldview)}addFeatures(r,s,u,d,g,y){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,s,u,d,y,r.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(r){this.bufferData.upload(r),this.elevationBufferData.upload(r),this.elevatedStructures&&this.elevatedStructures.upload(r)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(r,s,u,d,g,y=[],b,T){const E=fx(s,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(r,E,d,u,T):this.addGeometry(E,this.bufferData),this.bufferData.populatePaintArrays(r,u,g,y,d,b,this.worldview),this.elevationBufferData.populatePaintArrays(r,u,g,y,d,b,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(r,s,u,d,g){this.elevatedStructures&&(this.elevatedStructures.construct(r),this.elevatedStructures.populatePaintArrays(s,u,d,g,this.worldview))}addElevatedRoadFeature(r,s,u,d,g){const y=new Array,b=zr.getElevationFeature(r,g);if(!b)return void this.addGeometry(s,this.bufferData);{const E=this.clipPolygonsToTile(s,1);E.length>0&&y.push({polygons:E,elevationFeature:b,elevationTileID:u})}const T={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(r,{},u),featureIndex:d};for(const E of y)if(E.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new La(E.elevationTileID,this.layers,this.zoom,this.lut));const j=E.elevationFeature.isTunnel();let R=0;r.properties.hasOwnProperty(Qt)&&(R=+r.properties[Qt]);for(const L of E.polygons)this.elevatedStructures.addPortalCandidates(E.elevationFeature.id,L,j,E.elevationFeature,R)}E.elevationFeature.constantHeight==null&&(E.polygons=this.prepareElevatedPolygons(E.polygons,E.elevationFeature,E.elevationTileID));const k=new In(u,E.elevationTileID);this.addElevatedGeometry(E.polygons,k,E.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,d,T)}}addElevatedGeometry(r,s,u,d,g,y){const b={elevation:u,elevationSampler:s,bias:d,index:g,featureInfo:y},[T,E]=this.addGeometry(r,this.elevationBufferData,b);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:T,max:E}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,T),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,E))}addGeometry(r,s,u){let d=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,y=null;u&&(y=u.elevationSampler.constantElevation(u.elevation,u.bias),y!=null&&(d=y,g=y));const b=(T,E,k)=>{if(u!=null)if(E.push(T),y!=null)s.elevatedLayoutVertexArray.emplaceBack(y),k.push(y);else{const j=u.elevationSampler.pointElevation(T,u.elevation,u.bias);s.elevatedLayoutVertexArray.emplaceBack(j),k.push(j),d=Math.min(d,j),g=Math.max(g,j)}};for(const T of r){let E=0;for(const le of T)E+=le.length;const k=s.triangleSegments.prepareSegment(E,s.layoutVertexArray,s.indexArray),j=k.vertexLength,R=[],L=[],z=[],W=[],J=[],ee=s.layoutVertexArray.length;for(const le of T){if(le.length===0)continue;le!==T[0]&&L.push(R.length/2);const de=s.lineSegments.prepareSegment(le.length,s.layoutVertexArray,s.lineIndexArray),Se=de.vertexLength;u&&J.push(s.layoutVertexArray.length-ee),b(le[0],z,W),s.layoutVertexArray.emplaceBack(le[0].x,le[0].y),s.lineIndexArray.emplaceBack(Se+le.length-1,Se),R.push(le[0].x),R.push(le[0].y);for(let _e=1;_e<le.length;_e++)b(le[_e],z,W),s.layoutVertexArray.emplaceBack(le[_e].x,le[_e].y),s.lineIndexArray.emplaceBack(Se+_e-1,Se+_e),R.push(le[_e].x),R.push(le[_e].y);de.vertexLength+=le.length,de.primitiveLength+=le.length}const oe=Hg(R,L);for(let le=0;le<oe.length;le+=3)s.indexArray.emplaceBack(j+oe[le],j+oe[le+1],j+oe[le+2]);if(oe.length>0&&u&&this.elevationMode==="hd-road-base"){const le=u.elevation.isTunnel(),de=u.elevation.safeArea,Se=this.elevatedStructures.addVertices(z,W);this.elevatedStructures.addTriangles(oe,Se,le);const _e=J.length;if(_e>0){for(let Ae=0;Ae<_e-1;Ae++)this.elevatedStructures.addRenderableRing(u.index,J[Ae]+Se,J[Ae+1]-J[Ae],le,de,u.featureInfo);this.elevatedStructures.addRenderableRing(u.index,J[_e-1]+Se,z.length-J[_e-1],le,de,u.featureInfo)}}k.vertexLength+=E,k.primitiveLength+=oe.length/3}return[d,g]}prepareElevatedPolygons(r,s,u){const d=1/Ce(u),g=[];for(const y of r){const b=s8(y,new Ti(s,d));g.push(...b)}return g}clipPolygonsToTile(r,s){const u=-s,d=-s,g=zt+s,y=zt+s;let b=0;const T=[],E=[];for(;b<r.length;b++){const R=r[b],L=_p(R);(L.min.x>=u&&L.max.x<=g&&L.min.y>=d&&L.max.y<=y?T:E).push(R)}if(T.length===r.length)return r;const k=[new xt(u,d),new xt(g,d),new xt(g,y),new xt(u,y),new xt(u,d)],j=T;for(const R of E)j.push(...i8(R,k));return j}}let _R,yR,vR,xR;rr(xE,"FillBucket",{omit:["layers","patternFeatures"]}),rr(vE,"FillBufferData"),rr(La,"ElevatedStructures");class F1{constructor(r,s,u,d){if(this.triangleCount=s.length/3,this.min=new xt(0,0),this.max=new xt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||r.length===0)return;const[g,y]=[r[0].clone(),r[0].clone()];for(let j=1;j<r.length;++j){const R=r[j];g.x=Math.min(g.x,R.x),g.y=Math.min(g.y,R.y),y.x=Math.max(y.x,R.x),y.y=Math.max(y.y,R.y)}if(d){const j=Math.ceil(Math.max(y.x-g.x,y.y-g.y)/d);u=Math.max(u,j)}if(u===0)return;this.min=g,this.max=y;const b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);const T=Math.max(b.x,b.y)/u;this.cellsX=Math.max(1,Math.ceil(b.x/T)),this.cellsY=Math.max(1,Math.ceil(b.y/T)),this.xScale=1/T,this.yScale=1/T;const E=[];for(let j=0;j<this.triangleCount;j++){const R=r[s[3*j+0]].sub(this.min),L=r[s[3*j+1]].sub(this.min),z=r[s[3*j+2]].sub(this.min),W=Eu(Math.floor(Math.min(R.x,L.x,z.x)),this.xScale,this.cellsX),J=Eu(Math.floor(Math.max(R.x,L.x,z.x)),this.xScale,this.cellsX),ee=Eu(Math.floor(Math.min(R.y,L.y,z.y)),this.yScale,this.cellsY),oe=Eu(Math.floor(Math.max(R.y,L.y,z.y)),this.yScale,this.cellsY),le=new xt(0,0),de=new xt(0,0),Se=new xt(0,0),_e=new xt(0,0);for(let Ae=ee;Ae<=oe;++Ae){le.y=de.y=Ae*T,Se.y=_e.y=(Ae+1)*T;for(let ke=W;ke<=J;++ke)le.x=Se.x=ke*T,de.x=_e.x=(ke+1)*T,(ds(R,L,z,le,de,_e)||ds(R,L,z,le,_e,Se))&&E.push({cellIdx:Ae*this.cellsX+ke,triIdx:j})}}if(E.length===0)return;E.sort((j,R)=>j.cellIdx-R.cellIdx||j.triIdx-R.triIdx);let k=0;for(;k<E.length;){const j=E[k].cellIdx,R={start:this.payload.length,len:0};for(;k<E.length&&E[k].cellIdx===j;)++R.len,this.payload.push(E[k++].triIdx);this.cells[j]=R}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(r,s){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>r.x||r.y>this.max.y||this.min.y>r.y)return;const u=Eu(r.x-this.min.x,this.xScale,this.cellsX),d=Eu(r.y-this.min.y,this.yScale,this.cellsY),g=this.cells[d*this.cellsX+u];if(g){this._lazyInitLookup();for(let y=0;y<g.len;y++){const b=this.payload[g.start+y],T=Math.floor(b/8),E=1<<b%8;if(!(this.lookup[T]&E)&&(this.lookup[T]|=E,s.push(b),s.length===this.triangleCount))return}}}query(r,s,u){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>s.x||r.y>this.max.y||this.min.y>s.y)return;this._lazyInitLookup();const d=Eu(r.x-this.min.x,this.xScale,this.cellsX),g=Eu(s.x-this.min.x,this.xScale,this.cellsX),y=Eu(r.y-this.min.y,this.yScale,this.cellsY),b=Eu(s.y-this.min.y,this.yScale,this.cellsY);for(let T=y;T<=b;T++)for(let E=d;E<=g;E++){const k=this.cells[T*this.cellsX+E];if(k)for(let j=0;j<k.len;j++){const R=this.payload[k.start+j],L=Math.floor(R/8),z=1<<R%8;if(!(this.lookup[L]&z)&&(this.lookup[L]|=z,u.push(R),u.length===this.triangleCount))return}}}}function Eu(a,r,s){return Math.max(0,Math.min(s-1,Math.floor(a*r)))}rr(F1,"TriangleGridIndex");class bR{constructor(r){this.zoom=r.zoom,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=r.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.footprints=[],this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,s){for(const u of this.footprints)s.push({footprint:u,id:r})}updateAppearances(r,s,u,d){}populate(r,s,u,d){const g=[];for(const{feature:y,id:b,index:T,sourceLayerIndex:E}of r){const k=this.layers[0]._featureFilter.needGeometry,j=Ze(y,k);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),j,u))continue;const R={id:b,properties:y.properties,type:y.type,sourceLayerIndex:E,index:T,geometry:k?j.geometry:ft(y,u,d),patterns:{}};g.push(R)}for(const y of g){const{geometry:b,index:T,sourceLayerIndex:E}=y;this.addFeature(y,b,T,u,{},s.availableImages,s.brightness),s.featureIndex.insert(r[T].feature,b,T,E,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(r){}update(r,s,u,d,g,y,b){}destroy(){}addFeature(r,s,u,d,g,y=[],b){for(const T of fx(s,2)){const E=[],k=[],j=[],R=new xt(1/0,1/0),L=new xt(-1/0,-1/0);for(const J of T)if(J.length!==0){J!==T[0]&&j.push(k.length/2);for(let ee=0;ee<J.length;ee++)k.push(J[ee].x),k.push(J[ee].y),E.push(J[ee]),R.x=Math.min(R.x,J[ee].x),R.y=Math.min(R.y,J[ee].y),L.x=Math.max(L.x,J[ee].x),L.y=Math.max(L.y,J[ee].y)}const z=Hg(k,j),W=new F1(E,z,8,256);this.footprints.push({vertices:E,indices:z,grid:W,min:R,max:L})}}}rr(bR,"ClipBucket",{omit:["layers"]});const o8=fn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),a8=fn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),l8=fn([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),c8=fn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),u8=fn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),d8=fn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),h8=fn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:f8}=o8,px=Number.MAX_SAFE_INTEGER,wR=px-1;function SR(a,r,s,u){return a.order<r||a.order===px||!(a.clipMask&s)||function(d,g){return g.length!==0&&g.find(y=>y===d)===void 0}(u,a.clipScope)}function B1(a,r){return a.x-r.x||a.y-r.y}function TR(a,r){return B1(a.min,r.min)===0&&B1(a.max,r.max)===0}function bE(a,r){return!(a.min.x>r.max.x||a.max.x<r.min.x||a.min.y>r.max.y||a.max.y<r.min.y)}function V1(a,r){if(a.length!==r.length)return!1;for(let s=0;s<a.length;s++)if(a[s].sourceId!==r[s].sourceId||!TR(a[s],r[s])||a[s].order!==r[s].order||a[s].clipMask!==r[s].clipMask||!wo(a[s].clipScope,r[s].clipScope))return!1;return!0}function ER(a,r,s){const u=1/zt,d=1/(1<<s.canonical.z),g=(r.x*u+s.canonical.x)*d+s.wrap,y=(r.y*u+s.canonical.y)*d;return{min:new xt((a.x*u+s.canonical.x)*d+s.wrap,(a.y*u+s.canonical.y)*d),max:new xt(g,y)}}function p8(a,r,s){const u=1<<s.canonical.z,d=((r.x-s.wrap)*u-s.canonical.x)*zt,g=(r.y*u-s.canonical.y)*zt;return{min:new xt(((a.x-s.wrap)*u-s.canonical.x)*zt,(a.y*u-s.canonical.y)*zt),max:new xt(d,g)}}function wE(a,r,s,u,d,g,y){const b=a.indices,T=a.vertices,E=[];for(let k=u;k<u+d;k+=3){const j=r[s[k+0]+g],R=r[s[k+1]+g],L=r[s[k+2]+g],z=Math.min(j.x,R.x,L.x),W=Math.max(j.x,R.x,L.x),J=Math.min(j.y,R.y,L.y),ee=Math.max(j.y,R.y,L.y);E.length=0,a.grid.query(new xt(z,J),new xt(W,ee),E);for(let oe=0;oe<E.length;oe++){const le=E[oe];if(ds(T[b[3*le+0]],T[b[3*le+1]],T[b[3*le+2]],j,R,L,y))return!0}}return!1}function CR(a,r,s,u){if(!a||!s)return!1;let d=a.vertices;if(!r.canonical.equals(u.canonical)||r.wrap!==u.wrap){if(s.vertices.length<a.vertices.length)return CR(s,u,a,r);const g=r.canonical,y=u.canonical,b=Math.pow(2,y.z-g.z);d=a.vertices.map(T=>new xt((T.x+g.x*zt)*b-y.x*zt,(T.y+g.y*zt)*b-y.y*zt))}return wE(s,d,a.indices,0,a.indices.length,0,0)}function AR(a,r,s,u){const d=Math.pow(2,u.z-s.z);return new xt((a+s.x*zt)*d-u.x*zt,(r+s.y*zt)*d-u.y*zt)}function SE(a,r){const s=[];r.grid.queryPoint(a,s);const u=r.indices,d=r.vertices;for(let g=0;g<s.length;g++){const y=s[g];if(Us([d[u[3*y+0]],d[u[3*y+1]],d[u[3*y+2]]],a))return!0}return!1}const TE=[new xt(0,0),new xt(zt,0),new xt(zt,zt),new xt(0,zt)];function IR(a,r){const s=[];let u=[];if(!r||a.length<2)return[a];if(a.length===2)return ss(a[0],a[1],TE)?[a]:[];for(let d=0;d<a.length+2;d++){const g=a[d%a.length],y=a[(d+1)%a.length],b=ss(d===0?a[a.length-1]:a[(d-1)%a.length],g,TE),T=ss(g,y,TE),E=b||T;E&&u.push(g),E&&T||u.length>0&&(u.length>1&&s.push(u),u=[])}return u.length>1&&s.push(u),s}const EE=wt.types,m8=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],g8=["fill-extrusion-flood-light-ground-radius"],_8=Math.pow(2,13),y8=Math.pow(2,15)-1,PR=new xt(0,1),Bh=2147483648,kR=7,jR=450;function mx(a,r,s,u,d,g,y,b){a.emplaceBack((r<<1)+y,(s<<1)+g,(Math.floor(u*_8)<<1)+d,Math.round(b))}function gx(a,r,s){a.emplaceBack(r.x*zt,r.y*zt,s?1:0)}function U1(a,r,s,u,d,g){a.emplaceBack(r.x,r.y,(s.x<<1)+u,(s.y<<1)+d,g)}function _x(a,r,s){a.emplaceBack(r.x,r.y,r.z,s[0]*16384,s[1]*16384,s[2]*16384)}class RR{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class MR{constructor(){this.centroidXY=new xt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new xt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new xt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new xt(this.max.x-this.min.x,this.max.y-this.min.y)}}class DR{constructor(){this.acc=new xt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(r,s){r.min.x===Number.MAX_VALUE&&(r.min.x=r.max.x=s.x,r.min.y=r.max.y=s.y)}appendEdge(r,s,u){this.accCount++,this.acc._add(s);let d=!!this.borders;s.x<r.min.x?(r.min.x=s.x,d=!0):s.x>r.max.x&&(r.max.x=s.x,d=!0),s.y<r.min.y?(r.min.y=s.y,d=!0):s.y>r.max.y&&(r.max.y=s.y,d=!0),((s.x===0||s.x===zt)&&s.x===u.x)!=((s.y===0||s.y===zt)&&s.y===u.y)&&this.processBorderOverlap(s,u),d&&this.checkBorderIntersection(s,u)}checkBorderIntersection(r,s){s.x<0!=r.x<0&&this.addBorderIntersection(0,Rr(s.y,r.y,(0-s.x)/(r.x-s.x))),s.x>zt!=r.x>zt&&this.addBorderIntersection(1,Rr(s.y,r.y,(zt-s.x)/(r.x-s.x))),s.y<0!=r.y<0&&this.addBorderIntersection(2,Rr(s.x,r.x,(0-s.y)/(r.y-s.y))),s.y>zt!=r.y>zt&&this.addBorderIntersection(3,Rr(s.x,r.x,(zt-s.y)/(r.y-s.y)))}addBorderIntersection(r,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[r];s<u[0]&&(u[0]=s),s>u[1]&&(u[1]=s)}processBorderOverlap(r,s){if(r.x===s.x){if(r.y===s.y)return;const u=r.x===0?0:1;this.addBorderIntersection(u,s.y),this.addBorderIntersection(u,r.y)}else{const u=r.y===0?2:3;this.addBorderIntersection(u,s.x),this.addBorderIntersection(u,r.x)}}centroid(){return this.accCount===0?new xt(0,0):new xt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((r,s)=>r+ +(s[0]!==Number.MAX_VALUE),0):0}}function NR(a,r){const s=a.add(r)._unit(),u=ie(a.x*s.x+a.y*s.y,-1,1);var d,g,y;return d=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(d)))/4*y8*((g=a).x*(y=r).y-g.y*y.x<0?-1:1)}const v8=[a=>a.x<0,a=>a.x>zt,a=>a.y<0,a=>a.y>zt];function x8(a,r,s,u){const d=[4];if(u===0)return d;s._mult(u);const g=a.sub(s),y=r.sub(s),b=[a,r,g,y];for(let T=0;T<4;T++)for(const E of b)if(v8[T](E)){d.push(T);break}return d}class CE{constructor(r){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new Rg,this.indexArray=new Mi,this.programConfigurations=new kl(r.layers,{zoom:r.zoom,lut:r.lut},s=>g8.includes(s)),this._segments=new Vi,this.hiddenByLandmarkVertexArray=new Fg,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Vi}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(r,s,u,d=!1){const g=r.length;if(g>2){let y=Math.max(0,this._segments.get().length-1);const b=this._segments._prepareSegment(4*g,this.vertexArray.length,2*this._segmentToGroundQuads[y].length);let T;y!==this._segments.get().length-1&&(y++,this._segmentToGroundQuads[y]=[],this._segmentToRegionTriCounts[y]=[0,0,0,0,0]);{const E=r[0],k=r[1];T=NR(E.sub(r[g-1])._perp()._unit(),k.sub(E)._perp()._unit())}for(let E=0;E<g;E++){const k=E===g-1?0:E+1,j=r[E],R=r[k],L=r[k===g-1?0:k+1],z=R.sub(j)._perp()._unit(),W=NR(z,L.sub(R)._perp()._unit()),J=T,ee=W;if(AE(j,R,s)||d&&zR(j,s)&&zR(R,s)){T=W;continue}const oe=b.vertexLength;U1(this.vertexArray,j,R,1,1,J),U1(this.vertexArray,j,R,1,0,J),U1(this.vertexArray,j,R,0,1,ee),U1(this.vertexArray,j,R,0,0,ee),b.vertexLength+=4;const le=x8(j,R,z,u);for(const de of le)this._segmentToGroundQuads[y].push({id:oe,region:de}),this._segmentToRegionTriCounts[y][de]+=2,b.primitiveLength+=2;T=W}}}prepareBorderSegments(){if(!this.hasData())return;const r=this._segments.get(),s=r.length;for(let u=0;u<s;u++)this._segmentToGroundQuads[u].sort((d,g)=>d.region-g.region);for(let u=0;u<s;u++){const d=this._segmentToGroundQuads[u],g=r[u],y=this._segmentToRegionTriCounts[u];y.reduce((T,E)=>T+E,0);let b=0;for(let T=0;T<=4;T++){const E=y[T];if(E!==0){let k=this.regionSegments[T];k||(k=this.regionSegments[T]=new Vi);const j={vertexOffset:g.vertexOffset,primitiveOffset:g.primitiveOffset+b,vertexLength:g.vertexLength,primitiveLength:E};k.get().push(j)}b+=E}for(let T=0;T<d.length;T++){const E=d[T].id;this.indexArray.emplaceBack(E,E+1,E+3),this.indexArray.emplaceBack(E,E+3,E+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(r,s,u,d,g,y,b){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,r,s,u,d,g,y,void 0,b)}upload(r){this.hasData()&&(this.vertexBuffer=r.createVertexBuffer(this.vertexArray,a8.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=r.createVertexBuffer(this.groundRadiusArray,l8.members)))}uploadPaintProperties(r){this.hasData()&&this.programConfigurations.upload(r)}update(r,s,u,d,g,y,b,T){this.hasData()&&this.programConfigurations.updatePaintArrays(r,s,u,d,g,y,b,T)}updateHiddenByLandmark(r){this.updateHiddenByLandmarkRange(r.groundVertexArrayOffset,r.groundVertexCount,!!(r.flags&Bh))}updateHiddenByLandmarkRange(r,s,u){if(!this.hasData())return;const d=s+r;if(s!==0){for(let g=r;g<d;++g)this.hiddenByLandmarkVertexArray.emplace(g,u?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(r){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=r.createVertexBuffer(this.hiddenByLandmarkVertexArray,d8.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let r=0;r<=4;r++){const s=this.regionSegments[r];s&&s.destroy()}}}}class $1{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.pixelRatio=r.pixelRatio,this.layerIds=this.layers.map(s=>s.fqid),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Mi,this.footprintVertices=new ea,this.footprintSegments=[],this.layoutVertexArray=new Ih,this.centroidVertexArray=new T1,this.wallVertexArray=new C1,this.indexArray=new Mi,this.programConfigurations=new kl(r.layers,{zoom:r.zoom,lut:r.lut},s=>m8.includes(s)),this.segments=new Vi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.groundEffect=new CE(r),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,s){}updateAppearances(r,s,u,d){}populate(r,s,u,d){this.features=[],this.hasPattern=gE("fill-extrusion",this.layers,this.pixelRatio,s),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Ce(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:g,id:y,index:b,sourceLayerIndex:T}of r){const E=this.layers[0]._featureFilter.needGeometry,k=Ze(g,E);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),k,u))continue;const j={id:y,sourceLayerIndex:T,index:b,geometry:E?k.geometry:ft(g,u,d),properties:g.properties,type:g.type,patterns:{}},R=this.layoutVertexArray.length,L=EE[j.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:g.id,feature:_E("fill-extrusion",this.layers,j,this.zoom,this.pixelRatio,s)});else if(this.wallMode)for(const z of j.geometry)for(const W of IR(z,L))this.addFeature(g.id,j,[W],b,u,{},s.availableImages,d,s.brightness);else this.addFeature(g.id,j,j.geometry,b,u,{},s.availableImages,d,s.brightness);s.featureIndex.insert(g,j.geometry,b,T,this.index,R)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(r,s,u,d,g,y){for(const{featureId:b,feature:T}of this.features){const E=EE[T.type]==="Polygon",{geometry:k}=T;if(this.wallMode)for(const j of k)for(const R of IR(j,E))this.addFeature(b,T,[R],T.index,s,u,d,g,y);else this.addFeature(b,T,k,T.index,s,u,d,g,y)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(r,s,u,d,g,y,b){this.programConfigurations.updatePaintArrays(r,s,g,u,d,y,b,this.worldview),this.groundEffect.update(r,s,g,u,d,y,b,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,f8),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.wallVertexBuffer=r.createVertexBuffer(this.wallVertexArray,u8.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,h8.members,!0)),this.groundEffect.upload(r)),this.groundEffect.uploadPaintProperties(r),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){this.groundEffect.uploadHiddenByLandmark(r),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,c8.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,s,u,d,g,y,b,T,E){const k=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(s,{})/this.tileToMeter,j=[new xt(0,0),new xt(zt,zt)],R=T.projection,L=R.name==="globe",z=this.wallMode||EE[s.type]==="Polygon",W=new DR;W.centroidDataIndex=this.centroidData.length;const J=new MR;J.buildingId=r,s.properties&&s.properties.hasOwnProperty("building_id")&&(J.buildingId=s.properties.building_id);const ee=this.layers[0].paint.get("fill-extrusion-base").evaluate(s,{},g)<=0,oe=this.layers[0].paint.get("fill-extrusion-height").evaluate(s,{},g);let le;if(J.height=oe,J.vertexArrayOffset=this.layoutVertexArray.length,J.groundVertexArrayOffset=this.groundEffect.vertexArray.length,L&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Dg),this.wallMode){if(L)return void br("Non zero fill-extrusion-line-width is not yet supported on globe.");if(u.length!==1)return;le=function(Ue){const ct=Ue[0].x===Ue[Ue.length-1].x&&Ue[0].y===Ue[Ue.length-1].y;(function(Xt){let $t=0;const Fr=Xt.length;for(let Gt=0;Gt<Fr;Gt++)$t+=(Xt[(Gt+1)%Fr].x-Xt[Gt].x)*(Xt[(Gt+1)%Fr].y+Xt[Gt].y);return $t>=0})(Ue)||(Ue=Ue.reverse());const bt={geometry:[],joinNormals:[],indices:[]},Ot=[],It=[],gt=[];let At=Ue.length;for(;At>=2&&Ue[At-1].equals(Ue[At-2]);)At--;if(At<(ct?3:2))return bt;let nt,Ke,St,Mt,vt,er=0;for(;er<At-1&&Ue[er].equals(Ue[er+1]);)er++;ct&&(nt=Ue[At-2],vt=Ue[er].sub(nt)._unit()._perp());for(let Xt=er;Xt<At;Xt++){if(St=Xt===At-1?ct?Ue[er+1]:void 0:Ue[Xt+1],St&&Ue[Xt].equals(St))continue;vt&&(Mt=vt),nt&&(Ke=nt),nt=Ue[Xt],vt=St?St.sub(nt)._unit()._perp():Mt,Mt=Mt||vt;let $t=Mt.add(vt);$t.x===0&&$t.y===0||$t._unit();const Fr=$t.x*vt.x+$t.y*vt.y,Gt=Fr!==0?1/Fr:1/0,vr=Mt.x*vt.y-Mt.y*vt.x>0;let $r="miter";const nn=2;$r==="miter"&&Gt>nn&&($r="bevel"),$r==="bevel"&&(Gt>100&&($r="flipbevel"),Gt<nn&&($r="miter"));const Pn=(Gr,zn,Fn,Li)=>{const ye=new xt(Gr.x,Gr.y),pe=new xt(Gr.x,Gr.y);ye.x+=zn.x*Li,ye.y+=zn.y*Li,pe.x-=zn.x*Math.max(Fn,1),pe.y-=zn.y*Math.max(Fn,1),gt.push(zn),Ot.push(ye),It.push(pe)};if($r==="miter")$t._mult(Gt),Pn(nt,$t,0,0);else if($r==="flipbevel")$t=vt.mult(-1),Pn(nt,$t,0,0),Pn(nt,$t.mult(-1),0,0);else{const Gr=-Math.sqrt(Gt*Gt-1),zn=vr?Gr:0,Fn=vr?0:Gr;Ke&&Pn(nt,Mt,zn,Fn),St&&Pn(nt,vt,zn,Fn)}}bt.geometry=[...Ot,...It.reverse(),Ot[0]],bt.joinNormals=[...gt,...gt.reverse(),gt[gt.length-1]];const or=bt.geometry.length-1;for(let Xt=0;Xt<or/2;Xt++)if(Xt+1<or/2){let $t=Xt,Fr=Xt+1,Gt=or-1-Xt,vr=or-2-Xt;$t=$t===0?or-1:$t-1,Fr=Fr===0?or-1:Fr-1,Gt=Gt===0?or-1:Gt-1,vr=vr===0?or-1:vr-1,bt.indices.push(Gt),bt.indices.push(Fr),bt.indices.push($t),bt.indices.push(Gt),bt.indices.push(vr),bt.indices.push(Fr)}return bt}(u[0]),u=[le.geometry]}const de=(Ue,ct)=>Ue<(ct.length-1)/2||Ue===ct.length-1,Se=this.wallMode?[u]:fx(u,500);for(let Ue=Se.length-1;Ue>=0;Ue--){const ct=Se[Ue];(ct.length===0||(_e=ct[0]).every(pt=>pt.x<=0)||_e.every(pt=>pt.x>=zt)||_e.every(pt=>pt.y<=0)||_e.every(pt=>pt.y>=zt))&&Se.splice(Ue,1)}var _e;let Ae;if(L)Ae=UR(Se,j,g);else{Ae=[];for(const Ue of Se)Ae.push({polygon:Ue,bounds:j})}const ke=z?this.edgeRadius:0,De=ke>0&&this.zoom<17,at=(Ue,ct)=>{if(Ue.length===0)return!1;const pt=Ue[Ue.length-1];return ct.x===pt.x&&ct.y===pt.y};for(const{polygon:Ue,bounds:ct}of Ae){let pt=0,bt=0;for(const At of Ue)z&&!At[0].equals(At[At.length-1])&&At.push(At[0]),bt+=z?At.length-1:At.length;const Ot=this.segments.prepareSegment((z?5:4)*bt,this.layoutVertexArray,this.indexArray);J.footprintSegIdx<0&&(J.footprintSegIdx=this.footprintSegments.length),J.polygonSegIdx<0&&(J.polygonSegIdx=this.polygonSegments.length);const It={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},gt=new RR;if(gt.vertexOffset=this.footprintVertices.length,gt.indexOffset=3*this.footprintIndices.length,gt.ringIndices=[],z){const At=[],nt=[];pt=Ot.vertexLength;for(let St=0;St<Ue.length;St++){const Mt=Ue[St];Mt.length&&St!==0&&nt.push(At.length/2);const vt=[];let er,or;er=Mt[1].sub(Mt[0])._perp()._unit(),gt.ringIndices.push(Mt.length-1);for(let Xt=1;Xt<Mt.length;Xt++){const $t=Mt[Xt],Fr=Mt[Xt===Mt.length-1?1:Xt+1],Gt=$t.clone();if(ke){or=Fr.sub($t)._perp()._unit();const vr=er.add(or)._unit(),$r=ke*Math.min(4,1/(er.x*vr.x+er.y*vr.y));Gt.x+=$r*vr.x,Gt.y+=$r*vr.y,Gt.x=Math.round(Gt.x),Gt.y=Math.round(Gt.y),er=or}if(!ee||ke!==0&&!De||at(vt,Gt)||vt.push(Gt),mx(this.layoutVertexArray,Gt.x,Gt.y,0,0,1,1,0),this.wallMode){const vr=de(Xt,Mt);gx(this.wallVertexArray,le.joinNormals[Xt],!vr)}Ot.vertexLength++,this.footprintVertices.emplaceBack($t.x,$t.y),At.push($t.x,$t.y),L&&_x(this.layoutVertexExtArray,R.projectTilePoint(Gt.x,Gt.y,g),R.upVector(g,Gt.x,Gt.y))}ee&&(ke===0||De)&&(vt.length!==0&&at(vt,vt[0])&&vt.pop(),this.groundEffect.addData(vt,ct,k))}const Ke=this.wallMode?le.indices:Hg(At,nt);for(let St=0;St<Ke.length;St+=3)this.footprintIndices.emplaceBack(gt.vertexOffset+Ke[St+0],gt.vertexOffset+Ke[St+1],gt.vertexOffset+Ke[St+2]),this.indexArray.emplaceBack(pt+Ke[St],pt+Ke[St+2],pt+Ke[St+1]),Ot.primitiveLength++;gt.indexCount+=Ke.length,gt.vertexCount+=this.footprintVertices.length-gt.vertexOffset}for(let At=0;At<Ue.length;At++){const nt=Ue[At];W.startRing(J,nt[0]);let Ke=nt.length>4&&FR(nt[nt.length-2],nt[0],nt[1]),St=ke?b8(nt[nt.length-2],nt[0],nt[1],ke):0;const Mt=[];let vt,er,or;er=nt[1].sub(nt[0])._perp()._unit();let Xt=!0;for(let $t=1,Fr=0;$t<nt.length;$t++){let Gt=nt[$t-1],vr=nt[$t];const $r=nt[$t===nt.length-1?1:$t+1];if(W.appendEdge(J,vr,Gt),AE(vr,Gt,ct)){ke&&(er=$r.sub(vr)._perp()._unit(),Xt=!Xt);continue}const nn=vr.sub(Gt)._perp(),Pn=nn.x/(Math.abs(nn.x)+Math.abs(nn.y)),Gr=nn.y>0?1:0,zn=Gt.dist(vr);if(Fr+zn>32768&&(Fr=0),ke){or=$r.sub(vr)._perp()._unit();let pe=LR(Gt,vr,$r,OR(er,or),ke);isNaN(pe)&&(pe=0);const ut=vr.sub(Gt)._unit();Gt=Gt.add(ut.mult(St))._round(),vr=vr.add(ut.mult(-pe))._round(),St=pe,er=or,ee&&this.zoom>=17&&(at(Mt,Gt)||Mt.push(Gt),at(Mt,vr)||Mt.push(vr))}const Fn=Ot.vertexLength,Li=nt.length>4&&FR(Gt,vr,$r);let ye=BR(Fr,Ke,Xt);if(mx(this.layoutVertexArray,Gt.x,Gt.y,Pn,Gr,0,0,ye),mx(this.layoutVertexArray,Gt.x,Gt.y,Pn,Gr,0,1,ye),this.wallMode){const pe=de($t-1,nt),ut=le.joinNormals[$t-1];gx(this.wallVertexArray,ut,pe),gx(this.wallVertexArray,ut,pe)}if(Fr+=zn,ye=BR(Fr,Li,!Xt),Ke=Li,mx(this.layoutVertexArray,vr.x,vr.y,Pn,Gr,0,0,ye),mx(this.layoutVertexArray,vr.x,vr.y,Pn,Gr,0,1,ye),this.wallMode){const pe=de($t,nt),ut=le.joinNormals[$t];gx(this.wallVertexArray,ut,pe),gx(this.wallVertexArray,ut,pe)}if(Ot.vertexLength+=4,this.indexArray.emplaceBack(Fn+0,Fn+1,Fn+2),this.indexArray.emplaceBack(Fn+1,Fn+3,Fn+2),Ot.primitiveLength+=2,ke){const pe=pt+($t===1?nt.length-2:$t-2),ut=$t===1?pt:pe+1;if(this.indexArray.emplaceBack(Fn+1,pe,Fn+3),this.indexArray.emplaceBack(pe,ut,Fn+3),Ot.primitiveLength+=2,vt===void 0&&(vt=Fn),!AE($r,nt[$t],ct)){const Ut=$t===nt.length-1?vt:Ot.vertexLength;this.indexArray.emplaceBack(Fn+2,Fn+3,Ut),this.indexArray.emplaceBack(Fn+3,Ut+1,Ut),this.indexArray.emplaceBack(Fn+3,ut,Ut+1),Ot.primitiveLength+=3}Xt=!Xt}if(L){const pe=this.layoutVertexExtArray,ut=R.projectTilePoint(Gt.x,Gt.y,g),Ut=R.projectTilePoint(vr.x,vr.y,g),dt=R.upVector(g,Gt.x,Gt.y),qt=R.upVector(g,vr.x,vr.y);_x(pe,ut,dt),_x(pe,ut,dt),_x(pe,Ut,qt),_x(pe,Ut,qt)}}z&&(pt+=nt.length-1),ee&&ke&&this.zoom>=17&&(Mt.length!==0&&at(Mt,Mt[0])&&Mt.pop(),this.groundEffect.addData(Mt,ct,k,ke>0))}this.footprintSegments.push(gt),It.triangleCount=this.indexArray.length-It.triangleArrayOffset,this.polygonSegments.push(It),++J.footprintSegLen,++J.polygonSegLen}if(J.vertexCount=this.layoutVertexArray.length-J.vertexArrayOffset,J.groundVertexCount=this.groundEffect.vertexArray.length-J.groundVertexArrayOffset,J.vertexCount!==0){if(J.centroidXY=W.borders?PR:this.encodeCentroid(W,J),this.centroidData.push(J),W.borders){this.featuresOnBorder.push(W);const Ue=this.featuresOnBorder.length-1;for(let ct=0;ct<W.borders.length;ct++)W.borders[ct][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ct].push(Ue)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,d,y,b,g,E,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(s,d,y,b,g,E,this.worldview),this.maxHeight=Math.max(this.maxHeight,oe)}}sortBorders(){for(let r=0;r<this.borderFeatureIndices.length;r++)this.borderFeatureIndices[r].sort((s,u)=>this.featuresOnBorder[s].borders[r][0]-this.featuresOnBorder[u].borders[r][0])}splitToSubtiles(){const r=[];for(let b=0;b<this.centroidData.length;b++){const T=this.centroidData[b],E=+(T.min.y+T.max.y>zt),k=2*E+(+(T.min.x+T.max.x>zt)^E);for(let j=0;j<T.polygonSegLen;j++){const R=T.polygonSegIdx+j;r.push({centroidIdx:b,subtile:k,polygonSegmentIdx:R,triangleSegmentIdx:this.polygonSegments[R].triangleSegIdx})}}const s=new Mi;r.sort((b,T)=>b.triangleSegmentIdx===T.triangleSegmentIdx?b.subtile-T.subtile:b.triangleSegmentIdx-T.triangleSegmentIdx);let u=0,d=0,g=0;for(const b of r){if(b.triangleSegmentIdx!==u)break;g++}const y=r.length;for(;d!==r.length;){u=r[d].triangleSegmentIdx;let b=0,T=d,E=d;for(let k=T;k<g&&r[k].subtile===b;k++)E++;for(;T!==g;){const k=r[T];b=k.subtile;const j=this.centroidData[k.centroidIdx].min.clone(),R=this.centroidData[k.centroidIdx].max.clone(),L={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:s.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let z=T;z<E;z++){const W=r[z],J=this.polygonSegments[W.polygonSegmentIdx],ee=this.centroidData[W.centroidIdx].min,oe=this.centroidData[W.centroidIdx].max,le=this.indexArray.uint16;for(let de=J.triangleArrayOffset;de<J.triangleArrayOffset+J.triangleCount;de++)s.emplaceBack(le[3*de],le[3*de+1],le[3*de+2]);L.primitiveLength+=J.triangleCount,j.x=Math.min(j.x,ee.x),j.y=Math.min(j.y,ee.y),R.x=Math.max(R.x,oe.x),R.y=Math.max(R.y,oe.y)}L.primitiveLength>0&&this.triangleSubSegments.push({segment:L,min:j,max:R}),T=E;for(let z=T;z<g&&r[z].subtile===r[T].subtile;z++)E++}d=g;for(let k=d;k<y&&r[k].triangleSegmentIdx===r[d].triangleSegmentIdx;k++)g++}s._trim(),this.indexArray=s}getVisibleSegments(r,s,u){const d=new Vi;if(this.wallMode){for(const W of this.triangleSubSegments)d.segments.push(W.segment);return d}let g=0,y=0;const b=1<<r.canonical.z;if(s){const W=s.getMinMaxForTile(r);W&&(g=W.min,y=W.max)}y+=this.maxHeight;const T=r.toUnwrapped();let E;const k=[T.canonical.x/b+T.wrap,T.canonical.y/b],j=[(T.canonical.x+1)/b+T.wrap,(T.canonical.y+1)/b],R=(W,J,ee)=>[W[0]*(1-ee[0])+J[0]*ee[0],W[1]*(1-ee[1])+J[1]*ee[1]],L=[],z=[];for(const W of this.triangleSubSegments){L[0]=W.min.x/zt,L[1]=W.min.y/zt,z[0]=W.max.x/zt,z[1]=W.max.y/zt;const J=R(k,j,L),ee=R(k,j,z);if(new en([J[0],J[1],g],[ee[0],ee[1],y]).intersectsPrecise(u)===0){E&&(d.segments.push(E),E=void 0);continue}const oe=W.segment;E&&E.vertexOffset!==oe.vertexOffset&&(d.segments.push(E),E=void 0),E?(E.vertexLength+=oe.vertexLength,E.primitiveLength+=oe.primitiveLength):E={vertexOffset:oe.vertexOffset,primitiveLength:oe.primitiveLength,vertexLength:oe.vertexLength,primitiveOffset:oe.primitiveOffset,sortKey:void 0,vaos:{}}}return E&&d.segments.push(E),d}encodeCentroid(r,s){const u=r.centroid(),d=s.span(),g=Math.min(7,Math.round(d.x*this.tileToMeter/10)),y=Math.min(7,Math.round(d.y*this.tileToMeter/10));return new xt(ie(u.x,1,zt-1)<<3|g,ie(u.y,1,zt-1)<<3|y)}encodeBorderCentroid(r){if(!r.borders)return new xt(0,0);const s=r.borders,u=Number.MAX_VALUE;if(s[0][0]!==u||s[1][0]!==u){const d=s[0][0]!==u?0:1;return new xt(6|(s[0][0]!==u?0:65528),(s[d][0]+s[d][1])/2<<3|6)}{const d=s[2][0]!==u?2:3;return new xt((s[d][0]+s[d][1])/2<<3|6,6|(s[2][0]!==u?0:65528))}}showCentroid(r){const s=this.centroidData[r.centroidDataIndex];s.flags&=2147483647,s.centroidXY.x=0,s.centroidXY.y=0,this.writeCentroidToBuffer(s)}writeCentroidToBuffer(r){this.groundEffect.updateHiddenByLandmark(r);const s=r.vertexArrayOffset,u=r.vertexCount+r.vertexArrayOffset,d=r.flags&Bh?PR:r.centroidXY,g=this.centroidVertexArray.geta_centroid_pos0(s);if(this.centroidVertexArray.geta_centroid_pos1(s)!==d.y||g!==d.x){for(let y=s;y<u;++y)this.centroidVertexArray.emplace(y,d.x,d.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const r of this.centroidData)this.writeCentroidToBuffer(r)}updateReplacement(r,s,u){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const d=s.getReplacementRegionsForTile(r.toUnwrapped());if(V1(this.activeReplacements,d))return;if(this.activeReplacements=d,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const y of this.centroidData)y.flags&=2147483647;const g=[];for(const y of this.activeReplacements){if(y.order<u)continue;const b=Math.max(1,Math.pow(2,y.footprintTileId.canonical.z-r.canonical.z));if(y.footprint.buildingId){const T=y.footprint.buildingId;for(const E of this.centroidData)E.buildingId===T&&(E.flags|=Bh)}else for(const T of this.centroidData)if(!(T.flags&Bh||y.min.x>T.max.x||T.min.x>y.max.x||y.min.y>T.max.y||T.min.y>y.max.y))for(let E=0;E<T.footprintSegLen;E++){const k=this.footprintSegments[T.footprintSegIdx+E];if(g.length=0,w8(this.footprintVertices,k.vertexOffset,k.vertexCount,y.footprintTileId.canonical,r.canonical,g),wE(y.footprint,g,this.footprintIndices.uint16,k.indexOffset,k.indexCount,-k.vertexOffset,-b)){T.flags|=Bh;break}}}for(const y of this.centroidData)this.writeCentroidToBuffer(y);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(r,s,u){let d=!1;for(let g=0;g<u.footprintSegLen;g++){const y=this.footprintSegments[u.footprintSegIdx+g];let b=0;for(const T of y.ringIndices){for(let E=b,k=T+b-1;E<T+b;k=E++){const j=this.footprintVertices.int16[2*(E+y.vertexOffset)+0],R=this.footprintVertices.int16[2*(E+y.vertexOffset)+1],L=this.footprintVertices.int16[2*(k+y.vertexOffset)+1];R>s!=L>s&&r<(this.footprintVertices.int16[2*(k+y.vertexOffset)+0]-j)*(s-R)/(L-R)+j&&(d=!d)}b=T}}return d}getHeightAtTileCoord(r,s){let u=Number.NEGATIVE_INFINITY,d=!0;const g=4*(r+zt)*zt+(s+zt);if(this.partLookup.hasOwnProperty(g)){const y=this.partLookup[g];return y?{height:y.height,hidden:!!(y.flags&Bh)}:void 0}for(const y of this.centroidData)r>y.max.x||y.min.x>r||s>y.max.y||y.min.y>s||y.height<=u||this.footprintContainsPoint(r,s,y)&&(u=y.height,this.partLookup[g]=y,d=!!(y.flags&Bh));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:d};this.partLookup[g]=void 0}}function OR(a,r){const s=a.add(r)._unit();return a.x*s.x+a.y*s.y}function b8(a,r,s,u){const d=r.sub(a)._perp()._unit(),g=s.sub(r)._perp()._unit();return LR(a,r,s,OR(d,g),u)}function LR(a,r,s,u,d){const g=Math.sqrt(1-u*u);return Math.min(a.dist(r)/3,r.dist(s)/3,d*g/u)}function AE(a,r,s){return a.x<s[0].x&&r.x<s[0].x||a.x>s[1].x&&r.x>s[1].x||a.y<s[0].y&&r.y<s[0].y||a.y>s[1].y&&r.y>s[1].y}function zR(a,r){return a.x<r[0].x||a.x>r[1].x||a.y<r[0].y||a.y>r[1].y}function FR(a,r,s){if(a.x<0||a.x>=zt||r.x<0||r.x>=zt||s.x<0||s.x>=zt)return!1;const u=s.sub(r),d=u.perp(),g=a.sub(r);return(u.x*g.x+u.y*g.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(g.x*g.x+g.y*g.y))>-.866&&d.x*g.x+d.y*g.y<0}function BR(a,r,s){const u=r?2|a:-3&a;return s?1|u:-2&u}function VR(){const a=Math.PI/32,r=Math.tan(a),s=M;return s*Math.sqrt(1+2*r*r)-s}function UR(a,r,s){const u=1<<s.z,d=he(s.x/u),g=he((s.x+1)/u),y=ce(s.y/u),b=ce((s.y+1)/u);return function(T,E,k,j,R=0,L){const z=[];if(!T.length||!k||!j)return z;const W=(_e,Ae)=>{for(const ke of _e)z.push({polygon:ke,bounds:Ae})},J=Math.ceil(Math.log2(k)),ee=Math.ceil(Math.log2(j)),oe=J-ee,le=[];for(let _e=0;_e<Math.abs(oe);_e++)le.push(oe>0?0:1);for(let _e=0;_e<Math.min(J,ee);_e++)le.push(0),le.push(1);let de=T;if(de=z1(de,E[0].y-R,E[1].y+R,1),de=z1(de,E[0].x-R,E[1].x+R,0),!de.length)return z;const Se=[];for(le.length?Se.push({polygons:de,bounds:E,depth:0}):W(de,E);Se.length;){const _e=Se.pop(),Ae=_e.depth,ke=le[Ae],De=_e.bounds[0],at=_e.bounds[1],Ue=ke===0?De.x:De.y,ct=ke===0?at.x:at.y,pt=L?L(ke,Ue,ct):.5*(Ue+ct),bt=z1(_e.polygons,Ue-R,pt+R,ke),Ot=z1(_e.polygons,pt-R,ct+R,ke);if(bt.length){const It=[De,new xt(ke===0?pt:at.x,ke===1?pt:at.y)];le.length>Ae+1?Se.push({polygons:bt,bounds:It,depth:Ae+1}):W(bt,It)}if(Ot.length){const It=[new xt(ke===0?pt:De.x,ke===1?pt:De.y),at];le.length>Ae+1?Se.push({polygons:Ot,bounds:It,depth:Ae+1}):W(Ot,It)}}return z}(a,r,Math.ceil((g-d)/11.25),Math.ceil((y-b)/11.25),1,(T,E,k)=>{if(T===0)return .5*(E+k);{const j=ce((s.y+E/zt)/u);return(ne(.5*(ce((s.y+k/zt)/u)+j))*u-s.y)*zt}})}function w8(a,r,s,u,d,g){const y=Math.pow(2,u.z-d.z);for(let b=0;b<s;b++){let T=a.int16[2*(b+r)+0],E=a.int16[2*(b+r)+1];T=(T+d.x*zt)*y-u.x*zt,E=(E+d.y*zt)*y-u.y*zt,g.push(new xt(T,E))}}let $R,qR;rr($1,"FillExtrusionBucket",{omit:["layers","features"]}),rr(MR,"PartData"),rr(RR,"FootprintSegment"),rr(DR,"BorderCentroidData"),rr(CE,"GroundEffect");class Vp extends xt{constructor(r,s,u){super(r,s),this.z=u}}class GR extends Vp{constructor(r,s,u,d){super(r,s,u),this.w=d}}function WR(a,r,s,u){const d=s==="x"?"y":"x",g=(u-a[s])/(r[s]-a[s]);a[d]=Math.round(a[d]+(r[d]-a[d])*g),a[s]=u,a.hasOwnProperty("z")&&(a.z=Rr(a.z,r.z,g)),a.hasOwnProperty("w")&&(a.w=Rr(a.w,r.w,g))}function HR(a,r,s,u){const d=s,g=u;for(const y of["x","y"]){let b=a,T=r;b[y]>=T[y]&&(b=r,T=a),b[y]<d&&T[y]>d&&WR(b,T,y,d),b[y]<g&&T[y]>g&&WR(T,b,y,g)}}function q1(a,r,s,u,d,g){const y=[];for(let b=0;b<a.length;b++){const T=a[b];let E;const k=y.length;let j=0;for(let R=0;R<T.length-1;R++){let L=T[R],z=T[R+1],W=0;const J=j;let ee,oe;g&&(W=Math.hypot(z.x-L.x,z.y-L.y),j+=W,ee=L,oe=z),L.x<r&&z.x<r||(L.x<r?L=new xt(r,L.y+(r-L.x)/(z.x-L.x)*(z.y-L.y))._round():z.x<r&&(z=new xt(r,L.y+(r-L.x)/(z.x-L.x)*(z.y-L.y))._round()),L.y<s&&z.y<s||(L.y<s?L=new xt(L.x+(s-L.y)/(z.y-L.y)*(z.x-L.x),s)._round():z.y<s&&(z=new xt(L.x+(s-L.y)/(z.y-L.y)*(z.x-L.x),s)._round()),L.x>=u&&z.x>=u||(L.x>=u?L=new xt(u,L.y+(u-L.x)/(z.x-L.x)*(z.y-L.y))._round():z.x>=u&&(z=new xt(u,L.y+(u-L.x)/(z.x-L.x)*(z.y-L.y))._round()),L.y>=d&&z.y>=d||(L.y>=d?L=new xt(L.x+(d-L.y)/(z.y-L.y)*(z.x-L.x),d)._round():z.y>=d&&(z=new xt(L.x+(d-L.y)/(z.y-L.y)*(z.x-L.x),d)._round()),E&&L.equals(E[E.length-1])||(E=[L],y.push(E),g&&g.push({progress:{min:J+ZR(ee,oe,L)*W,max:1},parentIndex:b,prevPoint:ee,nextPoint:oe})),E.push(z),g&&(g[g.length-1].progress.max=J+ZR(ee,oe,z)*W,g[g.length-1].nextPoint=oe)))))}if(g&&j>0)for(let R=k;R<y.length;R++)g[R].progress.min/=j,g[R].progress.max/=j}return y}function S8(a,r,s,u,d){if(a.length<2)return void u.push(a);const g=[];for(;r.valid();){const[E,k]=r.get();for(let j=0;j<a.length-1;j++){const R=a[j],L=a[j+1],z=Ra(R,L,E,k);if(z){const[W]=z,J=new xt(Rr(R.x,L.x,W),Rr(R.y,L.y,W));g.push({t:j+W,distance:0,point:J})}}r.next()}if(g.length===0)return void u.push(a);g.sort((E,k)=>E.t-k.t);let y=0,b=0,T=[];for(u.push(T);y!==a.length;){if(b===g.length){for(;y!==a.length;)T.length!==0&&T[T.length-1].equals(a[y])||T.push(a[y]),y++;break}g[b].t<=y?(T.length!==0&&T[T.length-1].equals(g[b].point)||T.push(g[b].point),Math.trunc(g[b].t),b++):(T.length!==0&&T[T.length-1].equals(a[y])||T.push(a[y]),y++)}}function ZR(a,r,s){return a.x!==r.x?(s.x-a.x)/(r.x-a.x):a.y!==r.y?(s.y-a.y)/(r.y-a.y):0}function yx(a,r){return a.x*r.x+a.y*r.y}function XR(a,r){if(a.length===1){let s=0;const u=r[s++];let d;for(;!d||u.equals(d);)if(d=r[s++],!d)return 1/0;for(;s<r.length;s++){const g=r[s],y=a[0],b=d.sub(u),T=g.sub(u),E=y.sub(u),k=yx(b,b),j=yx(b,T),R=yx(T,T),L=yx(E,b),z=yx(E,T),W=k*R-j*j,J=(R*L-j*z)/W,ee=(k*z-j*L)/W,oe=u.z*(1-J-ee)+d.z*J+g.z*ee;if(isFinite(oe))return oe}return 1/0}{let s=1/0;for(const u of r)s=Math.min(s,u.z);return s}}function KR(a,r,s){let u=1/0;Yi(s,r)&&(u=XR(s,r[0]));for(let d=0;d<r.length;d++){const g=r[d],y=a[d];for(let b=0;b<g.length-1;b++){const T=g[b],E=[T,g[b+1],y[b+1],y[b],T];is(s,E)&&(u=Math.min(u,XR(s,E)))}}return u!==1/0&&u}function YR(a,r,s,u,d,g,y,b,T,E,k){return a.projection.name==="globe"?function(j,R,L,z,W,J,ee,oe,le,de,Se){const _e=[],Ae=[],ke=j.projection.upVectorScale(Se,j.center.lat,j.worldSize).metersToTile,De=[0,0,0,1],at=[0,0,0,1],Ue=(pt,bt,Ot,It)=>{pt[0]=bt,pt[1]=Ot,pt[2]=It,pt[3]=1},ct=VR();L>0&&(L+=ct),z+=ct;for(const pt of R){const bt=[],Ot=[];for(const It of pt){const gt=It.x+W.x,At=It.y+W.y,nt=j.projection.projectTilePoint(gt,At,Se),Ke=j.projection.upVector(Se,It.x,It.y);let St=L,Mt=z;if(ee){const vt=JR(gt,At,L,z,ee,oe,le,de);St+=vt.base,Mt+=vt.top}L!==0?Ue(De,nt.x+Ke[0]*ke*St,nt.y+Ke[1]*ke*St,nt.z+Ke[2]*ke*St):Ue(De,nt.x,nt.y,nt.z),Ue(at,nt.x+Ke[0]*ke*Mt,nt.y+Ke[1]*ke*Mt,nt.z+Ke[2]*ke*Mt),yn(De,De,J),yn(at,at,J),bt.push(new Vp(De[0],De[1],De[2])),Ot.push(new Vp(at[0],at[1],at[2]))}_e.push(bt),Ae.push(Ot)}return[_e,Ae]}(a,r,s,u,d,g,y,b,T,E,k):y?function(j,R,L,z,W,J,ee,oe,le){const de=[],Se=[],_e=[0,0,0,1];for(const Ae of j){const ke=[],De=[];for(const at of Ae){const Ue=at.x+z.x,ct=at.y+z.y,pt=JR(Ue,ct,R,L,J,ee,oe,le);_e[0]=Ue,_e[1]=ct,_e[2]=pt.base,_e[3]=1,pr(_e,_e,W),_e[3]=Math.max(_e[3],1e-5);const bt=new Vp(_e[0]/_e[3],_e[1]/_e[3],_e[2]/_e[3]);_e[0]=Ue,_e[1]=ct,_e[2]=pt.top,_e[3]=1,pr(_e,_e,W),_e[3]=Math.max(_e[3],1e-5);const Ot=new Vp(_e[0]/_e[3],_e[1]/_e[3],_e[2]/_e[3]);ke.push(bt),De.push(Ot)}de.push(ke),Se.push(De)}return[de,Se]}(r,s,u,d,g,y,b,T,E):function(j,R,L,z,W){const J=[],ee=[],oe=W[8]*R,le=W[9]*R,de=W[10]*R,Se=W[11]*R,_e=W[8]*L,Ae=W[9]*L,ke=W[10]*L,De=W[11]*L;for(const at of j){const Ue=[],ct=[];for(const pt of at){const bt=pt.x+z.x,Ot=pt.y+z.y,It=W[0]*bt+W[4]*Ot+W[12],gt=W[1]*bt+W[5]*Ot+W[13],At=W[2]*bt+W[6]*Ot+W[14],nt=W[3]*bt+W[7]*Ot+W[15],Ke=It+oe,St=gt+le,Mt=At+de,vt=Math.max(nt+Se,1e-5),er=It+_e,or=gt+Ae,Xt=At+ke,$t=Math.max(nt+De,1e-5);Ue.push(new Vp(Ke/vt,St/vt,Mt/vt)),ct.push(new Vp(er/$t,or/$t,Xt/$t))}J.push(Ue),ee.push(ct)}return[J,ee]}(r,s,u,d,g)}function JR(a,r,s,u,d,g,y,b){const T=y*d.getElevationAt(a,r,!0,!0),E=g[0]!==0,k=E?g[1]===0?y*(g[0]/kR-jR):y*function(j,R,L){const z=Math.floor(R[0]/8),W=Math.floor(R[1]/8),J=10*(R[0]-8*z),ee=10*(R[1]-8*W),oe=j.getElevationAt(z,W,!0,!0),le=j.getMeterToDEM(L),de=Math.floor(.5*(J*le-1)),Se=Math.floor(.5*(ee*le-1)),_e=j.tileCoordToPixel(z,W),Ae=2*de+1,ke=2*Se+1,De=function(Ot,It,gt,At,nt){return[Ot.getElevationAtPixel(It,gt,!0),Ot.getElevationAtPixel(It+nt,gt,!0),Ot.getElevationAtPixel(It,gt+nt,!0),Ot.getElevationAtPixel(It+At,gt+nt,!0)]}(j,_e.x-de,_e.y-Se,Ae,ke),at=Math.abs(De[0]-De[1]),Ue=Math.abs(De[2]-De[3]),ct=Math.abs(De[0]-De[2])+Math.abs(De[1]-De[3]),pt=Math.min(.25,.5*le*(at+Ue)/Ae),bt=Math.min(.25,.5*le*ct/ke);return oe+Math.max(pt*J,bt*ee)}(d,g,b):T;return{base:T+(s===0?-1:s),top:E?Math.max(k+u,T+s+2):T+u}}class T8{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class E8{constructor(){this.tasks={},this.taskQueue=[],Xe(["process"],this),this.invoker=new T8(this.process),this.nextId=0}add(r,s){const u=this.nextId++,d=function({type:g,isSymbolTile:y,zoom:b}){return b=b||0,g==="message"?0:g!=="maybePrepare"||y?g!=="parseTile"||y?g==="parseTile"&&y?300-b:g==="maybePrepare"&&y?400-b:500:200-b:100-b}(s);if(d===0){try{r()}finally{}return null}return this.tasks[u]={fn:r,metadata:s,priority:d,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const r=this.pick();if(r===null)return;const s=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let r=null,s=1/0;for(let d=0;d<this.taskQueue.length;d++){const g=this.tasks[this.taskQueue[d]];g.priority<s&&(s=g.priority,r=d)}if(r===null)return null;const u=this.taskQueue[r];return this.taskQueue.splice(r,1),u}remove(){this.invoker.remove()}}class QR{constructor(r,s,u){this.target=r,this.parent=s,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Xe(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new E8}send(r,s,u,d,g=!1,y){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=y,this.callbacks[b]=u);const T=new Set;return this.target.postMessage({id:b,type:r,hasCallback:!!u,targetMapId:d,mustQueue:g,sourceMapId:this.mapId,data:yu(s,T)},T),{cancel:()=>{u&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(r){const s=r.data;if(!s)return;const u=s.id;if(u&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){const d=this.cancelCallbacks[u];delete this.cancelCallbacks[u],d&&d.cancel()}else if(s.mustQueue||Xi(self)){const d=this.callbacks[u],g=this.scheduler.add(()=>this.processTask(u,s),d&&d.metadata||{type:"message"});g&&(this.cancelCallbacks[u]=g)}else this.processTask(u,s)}processTask(r,s){if(delete this.cancelCallbacks[r],s.type==="<response>"){const u=this.callbacks[r];delete this.callbacks[r],u&&(s.error?u(vu(s.error)):u(null,vu(s.data)))}else{const u=new Set,d=s.hasCallback?(y,b)=>{this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:y?yu(y):null,data:yu(b,u)},u)}:()=>{},g=vu(s.data);if(this.parent[s.type])this.parent[s.type](s.sourceMapId,g,d);else if(this.parent.getWorkerSource){const y=s.type.split("."),{source:b,scope:T}=g;this.parent.getWorkerSource(s.sourceMapId,y[0],b,T)[y[1]](g,d)}else d(new Error(`Could not find function ${s.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var vx={workerUrl:"",workerClass:null,workerParams:void 0};const IE="mapboxgl_preloaded_worker_pool";class Up{constructor(){this.active={}}acquire(r,s=Up.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<s;)this.workers.push(vx.workerClass!=null?new vx.workerClass:new self.Worker(vx.workerUrl,vx.workerParams));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.workers&&this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[IE]}numActive(){return Object.keys(this.active).length}}Up.workerCount=2;class Xg{constructor(r,s,u="Worker",d=Up.workerCount){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=Je();const g=this.workerPool.acquire(this.id,d);for(let y=0;y<g.length;y++){const b=new Xg.Actor(g[y],s,this.id);b.name=`${u} ${y}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,s,u){Ie(this.actors,(d,g)=>{d.send(r,s,g)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}let xx,PE;function G1(){return xx||(xx=new Up),xx}Xg.Actor=QR;class C8{constructor(r){this.module=r}createIntArray(r){const s=new Int32Array(r),u=this.module.malloc(s.length*s.BYTES_PER_ELEMENT);return this.module.heap32.set(s,u/s.BYTES_PER_ELEMENT),u}createFloatArray(r){const s=new Float32Array(r),u=this.module.malloc(s.length*s.BYTES_PER_ELEMENT);return this.module.heapF32.set(s,u/s.BYTES_PER_ELEMENT),u}createStringBuffer(r){const s=this.module.malloc(r.length+1);for(let u=0;u<r.length;++u)this.module.heapU8[s+u]=r.charCodeAt(u);return this.module.heapU8[s+r.length]=0,s}readStringBuffer(r){let s="";for(;this.module.heapU8[r]!==0;)s+=String.fromCharCode(this.module.heapU8[r]),++r;return s}setStyle(r){const s=r.entranceColorRgb,u=r.facadeGlazingColorRgb,d=r.roofColorRgb,g=r.wallColorRgb,y=r.normalScale;this.module.setStyle(s[0],s[1],s[2],u[0],u[1],u[2],d[0],d[1],d[2],g[0],g[1],g[2],y[0],y[1],y[2],r.tileToMeters)}setAOOptions(r,s){this.module.setAOOptions(r?1:0,s)}setMetricOptions(r,s){this.module.setMetricOptions(r?1:0,s)}setStructuralOptions(r){this.module.setStructuralOptions(r?1:0)}setFacadeOptions(r,s){this.module.setFacadeOptions(r,s?1:0)}setFauxFacadeOptions(r,s,u){this.module.setFauxFacadeOptions(r?1:0,s?1:0,u)}setFacadeClassifierOptions(r){this.module.setFacadeClassifierOptions(r)}generateMesh(r,s){for(const b of r){const T=this.createStringBuffer(b.roofType),E=[0],k=[];for(const L of b.coordinates)if(Array.isArray(L)){for(const z of L)k.push(z.x),k.push(z.y);E.push(k.length)}const j=this.createIntArray(E),R=this.createFloatArray(k);this.module.addFeature(b.id,b.sourceId,b.minHeight,b.height,T,b.roofType.length,R,j,E.length-1),this.module.free(T),this.module.free(j),this.module.free(R)}for(const b of s){let T;T=b.entrances?JSON.parse(b.entrances):[];const E=this.createFloatArray(T),k=[];for(const R of b.coordinates)k.push(R.x),k.push(R.y);const j=this.createFloatArray(k);this.module.addFacade(b.sourceId,b.crossPerc,b.distanceToRoad,E,T.length,j,k.length),this.module.free(E),this.module.free(j)}if(!this.module.generateMesh()){const b=this.module.getLastError();return this.readStringBuffer(b)}const u=this.module.getMeshCount(),d=new Array(u);for(let b=0;b<u;b++){const T=this.module.getPositionsPtr(b),E=this.module.getPositionsLength(b),k=new Float32Array(this.module.heapF32.buffer,T,E),j=this.module.getNormalsPtr(b),R=this.module.getNormalsLength(b),L=new Float32Array(this.module.heapF32.buffer,j,R),z=this.module.getColorsPtr(b),W=this.module.getColorsLength(b),J=new Uint8Array(this.module.heapU8.buffer,z,W),ee=this.module.getAOPtr(b),oe=this.module.getAOLength(b),le=new Float32Array(this.module.heapF32.buffer,ee,oe),de=this.module.getUVPtr(b),Se=this.module.getUVLength(b),_e=new Float32Array(this.module.heapF32.buffer,de,Se),Ae=this.module.getFauxFacadePtr(b),ke=this.module.getFauxFacadeLength(b),De=new Uint8Array(this.module.heapU8.buffer,Ae,ke),at=this.module.getIndicesPtr(b),Ue=this.module.getIndicesLength(b),ct=new Int32Array(this.module.heap32.buffer,at,Ue),pt=this.module.getBuildingPart(b),bt=this.readStringBuffer(pt);d[b]={positions:k,normals:L,colors:J,ao:le,uv:_e,isFauxFacade:De,indices:ct,buildingPart:bt}}const g=this.module.getRingCount(),y=[];for(let b=0;b<g;b++){const T=this.module.getRingPtr(b),E=this.module.getRingLength(b),k=new Float32Array(this.module.heapF32.buffer,T,E);y.push(k)}return{meshes:d,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:y}}}let bx,kE,kc,Kg,jE,Yg=null,Jg=null,eM=null,W1=null;function tM(){return Xi(self)&&self.worker.dracoUrl?self.worker.dracoUrl:kE||Ai.DRACO_URL}function rM(){if(Xi(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Kg)return Kg;const a=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Kg=WebAssembly.validate(a)?Ai.MESHOPT_SIMD_URL:Ai.MESHOPT_URL,Kg}function A8(){return W1}const H1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},I8={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},wx={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function nM(a,r,s){const u=s.json.bufferViews.length,d=s.buffers.length;r.bufferView=u,s.json.bufferViews[u]={buffer:d,byteLength:a.byteLength},s.buffers[d]=a}const RE="KHR_draco_mesh_compression";function P8(a,r){const s=a.extensions&&a.extensions[RE];if(!s)return;const u=new kc.Decoder,d=aM(r,s.bufferView),g=new kc.Mesh;if(!u.DecodeArrayToMesh(d,d.byteLength,g))throw new Error("Failed to decode Draco mesh");const y=r.json.accessors[a.indices],b=H1[y.componentType],T=y.count*b.BYTES_PER_ELEMENT,E=kc._malloc(T);b===Uint16Array?u.GetTrianglesUInt16Array(g,T,E):u.GetTrianglesUInt32Array(g,T,E),nM(kc.memory.buffer.slice(E,E+T),y,r),kc._free(E);for(const k of Object.keys(s.attributes)){const j=u.GetAttributeByUniqueId(g,s.attributes[k]),R=r.json.accessors[a.attributes[k]],L=I8[R.componentType],z=R.count*wx[R.type]*H1[R.componentType].BYTES_PER_ELEMENT,W=kc._malloc(z);u.GetAttributeDataArrayForAllPoints(g,j,kc[L],z,W),nM(kc.memory.buffer.slice(W,W+z),R,r),kc._free(W)}u.destroy(),g.destroy(),delete a.extensions[RE]}const Z1="EXT_meshopt_compression";function k8(a,r){if(!a.extensions||!a.extensions[Z1])return;const s=a.extensions[Z1],u=new Uint8Array(r.buffers[s.buffer],s.byteOffset||0,s.byteLength||0),d=new Uint8Array(s.count*s.byteStride);jE.decodeGltfBuffer(d,s.count,s.byteStride,u,s.mode,s.filter),a.buffer=r.buffers.length,a.byteOffset=0,r.buffers[a.buffer]=d.buffer,delete a.extensions[Z1]}const iM=1179937895,sM=new TextDecoder("utf8");function oM(a,r){return new URL(a,r).href}function j8(a,r,s,u){return fetch(oM(a.uri,u)).then(d=>d.arrayBuffer()).then(d=>{r.buffers[s]=d})}function aM(a,r){const s=a.json.bufferViews[r];return new Uint8Array(a.buffers[s.buffer],s.byteOffset||0,s.byteLength)}function R8(a,r,s,u){if(a.uri){const d=oM(a.uri,u);return fetch(d).then(g=>g.blob()).then(g=>createImageBitmap(g)).then(g=>{r.images[s]=g})}if(a.bufferView!==void 0){const d=aM(r,a.bufferView),g=new Blob([d],{type:a.mimeType});return createImageBitmap(g).then(y=>{r.images[s]=y})}}function lM(a,r=0,s){const u={json:null,images:[],buffers:[]};if(new Uint32Array(a,r,1)[0]===iM){const k=new Uint32Array(a,r);let j=2;const R=(k[j++]>>2)-3,L=k[j++]>>2;if(j++,u.json=JSON.parse(sM.decode(k.subarray(j,j+L))),j+=L,j<R){const z=k[j++];j++;const W=r+(j<<2);u.buffers[0]=a.slice(W,W+z)}}else u.json=JSON.parse(sM.decode(new Uint8Array(a,r)));const{buffers:d,images:g,meshes:y,extensionsUsed:b,bufferViews:T}=u.json;let E=Promise.resolve();if(d){const k=[];for(let j=0;j<d.length;j++){const R=d[j];R.uri?k.push(j8(R,u,j,s)):u.buffers[j]||(u.buffers[j]=null)}E=Promise.all(k)}return E.then(()=>{const k=[],j=b&&b.includes(RE),R=b&&b.includes(Z1);if(j&&k.push(function(){if(!kc)return bx??(bx=function(L){let z,W=null;function J(){z=new Uint8Array(W.buffer)}function ee(){throw new Error("Unexpected Draco error.")}const oe={a:{a:ee,d:function(le,de,Se){return z.copyWithin(le,de,de+Se)},c:function(le){const de=z.length,Se=Math.max(le>>>0,Math.ceil(1.2*de)),_e=Math.ceil((Se-de)/65536);try{return W.grow(_e),J(),!0}catch{return!1}},b:ee}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(L,oe):L.then(le=>le.arrayBuffer()).then(le=>WebAssembly.instantiate(le,oe))).then(le=>{const{Rb:de,Qb:Se,P:_e,T:Ae,X:ke,Ja:De,La:at,Qa:Ue,Va:ct,Wa:pt,eb:bt,jb:Ot,f:It,e:gt,yb:At,zb:nt,Ab:Ke,Bb:St,Db:Mt,Gb:vt}=le.instance.exports;W=gt;const er=(()=>{let or=0,Xt=0,$t=0,Fr=0;return Gt=>{$t&&(de(Fr),de(or),Xt+=$t,$t=or=0),or||(Xt+=128,or=Se(Xt));const vr=Gt.length+7&-8;let $r=or;vr>=Xt&&($t=vr,$r=Fr=Se(vr));for(let nn=0;nn<Gt.length;nn++)z[$r+nn]=Gt[nn];return $r}})();return J(),It(),{memory:gt,_free:de,_malloc:Se,Mesh:class{constructor(){this.ptr=_e()}destroy(){Ae(this.ptr)}},Decoder:class{constructor(){this.ptr=De()}destroy(){Ot(this.ptr)}DecodeArrayToMesh(or,Xt,$t){const Fr=er(or),Gt=at(this.ptr,Fr,Xt,$t.ptr);return!!ke(Gt)}GetAttributeByUniqueId(or,Xt){return{ptr:Ue(this.ptr,or.ptr,Xt)}}GetTrianglesUInt16Array(or,Xt,$t){ct(this.ptr,or.ptr,Xt,$t)}GetTrianglesUInt32Array(or,Xt,$t){pt(this.ptr,or.ptr,Xt,$t)}GetAttributeDataArrayForAllPoints(or,Xt,$t,Fr,Gt){bt(this.ptr,or.ptr,Xt.ptr,$t,Fr,Gt)}},DT_INT8:At(),DT_UINT8:nt(),DT_INT16:Ke(),DT_UINT16:St(),DT_UINT32:Mt(),DT_FLOAT32:vt()}})}(fetch(tM())),bx.then(L=>{kc=L,bx=void 0}))}()),R&&k.push(function(){if(jE)return;const L=function(z){let W;const J=WebAssembly.instantiateStreaming(z,{}).then(le=>{W=le.instance,W.exports.__wasm_call_ctors()}),ee={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},oe={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:J,supported:!0,decodeGltfBuffer(le,de,Se,_e,Ae,ke){(function(De,at,Ue,ct,pt,bt,Ot){const It=De.exports.sbrk,gt=ct+3&-4,At=It(gt*pt),nt=It(bt.length),Ke=new Uint8Array(De.exports.memory.buffer);Ke.set(bt,nt);const St=at(At,ct,pt,nt,bt.length);if(St===0&&Ot&&Ot(At,gt,pt),Ue.set(Ke.subarray(At,At+ct*pt)),It(At-It(0)),St!==0)throw new Error(`Malformed buffer data: ${St}`)})(W,W.exports[oe[Ae]],le,de,Se,_e,W.exports[ee[ke]])}}}(fetch(rM()));return L.ready.then(()=>{jE=L})}()),g)for(let L=0;L<g.length;L++)k.push(R8(g[L],u,L,s));return(k.length?Promise.all(k):Promise.resolve()).then(()=>{if(j&&y)for(const{primitives:L}of y)for(const z of L)P8(z,u);if(R&&y&&T)for(const L of T)k8(L,u);return u})})}function cM(a){return fetch(a).then(r=>r.arrayBuffer()).then(r=>lM(r,0,a))}function ME(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function DE(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class NE{constructor(r,s,u,d){this.context=r,this.format=u,this.useMipmap=d&&d.useMipmap,this.texture=r.gl.createTexture(),this.update(s,{premultiply:d&&d.premultiply})}update(r,s){const u=r&&r instanceof HTMLVideoElement&&r.width===0?r.videoWidth:r.width,d=r&&r instanceof HTMLVideoElement&&r.height===0?r.videoHeight:r.height,{context:g}=this,{gl:y}=g,{x:b,y:T}=s&&s.position?s.position:{x:0,y:0},E=b+u,k=T+d;!this.size||this.size[0]===E&&this.size[1]===k||(y.bindTexture(y.TEXTURE_2D,null),y.deleteTexture(this.texture),this.texture=y.createTexture(),this.size=null),y.bindTexture(y.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA8&&(!s||s.premultiply!==!1));const j=r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||ImageBitmap&&r instanceof ImageBitmap;if(!this.size&&E>0&&k>0){const R=this.useMipmap?Math.floor(Math.log2(Math.max(E,k)))+1:1;y.texStorage2D(y.TEXTURE_2D,R,this.format,E,k),this.size=[E,k]}this.size&&(j?y.texSubImage2D(y.TEXTURE_2D,0,b,T,ME(this.format),DE(this.format),r):"data"in r&&r.data&&y.texSubImage2D(y.TEXTURE_2D,0,b,T,u,d,ME(this.format),DE(this.format),r.data)),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(r,s,u=!1){const{context:d}=this,{gl:g}=d;g.bindTexture(g.TEXTURE_2D,this.texture),r!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,r),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap&&!u?r===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),s!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,s),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,s),this.wrapS=s)}bindExtraParam(r,s,u,d,g){const{context:y}=this,{gl:b}=y;b.bindTexture(b.TEXTURE_2D,this.texture),s!==this.magFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,s),this.magFilter=s),r!==this.minFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,this.useMipmap?r===b.NEAREST?b.NEAREST_MIPMAP_NEAREST:b.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),u!==this.wrapS&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,u),this.wrapS=u),d!==this.wrapT&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,d),this.wrapT=d),g!==this.compareMode&&(g?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_MODE,b.COMPARE_REF_TO_TEXTURE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_FUNC,g)):b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_MODE,b.NONE),this.compareMode=g)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class Sx{constructor(r,s){this.context=r,this.texture=s}bind(r,s){const{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),r!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,r),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,r),this.minFilter=r),s!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,s),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,s),this.wrapS=s)}}const M8=fn([{name:"a_pos_3f",components:3,type:"Float32"}]),D8=fn([{name:"a_color_3f",components:3,type:"Float32"}]),N8=fn([{name:"a_color_4f",components:4,type:"Float32"}]),O8=fn([{name:"a_uv_2f",components:2,type:"Float32"}]),L8=fn([{name:"a_normal_3f",components:3,type:"Float32"}]),z8=fn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),F8=fn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function uM(a,r){const s=X1(a.projection,a.zoom,a.width,a.height),u=function(g,y,b,T,E){const k=new F(b.lng-180*Vh,b.lat),j=new F(b.lng+180*Vh,b.lat),R=g.project(k.lng,k.lat),L=g.project(j.lng,j.lat),z=-Math.atan2(L.y-R.y,L.x-R.x),W=Fe.fromLngLat(b);W.y=ie(W.y,-1+Vh,1-Vh);const J=W.toLngLat(),ee=g.project(J.lng,J.lat),oe=Fe.fromLngLat(J);oe.x+=Vh;const le=oe.toLngLat(),de=g.project(le.lng,le.lat),Se=hM(de.x-ee.x,de.y-ee.y,z),_e=Fe.fromLngLat(J);_e.y+=Vh;const Ae=_e.toLngLat(),ke=g.project(Ae.lng,Ae.lat),De=hM(ke.x-ee.x,ke.y-ee.y,z),at=Math.abs(Se.x)/Math.abs(De.y),Ue=K([]);Ne(Ue,Ue,-z*(1-(E?0:T)));const ct=K([]);return ue(ct,ct,[1,1-(1-at)*T,1]),ct[4]=-De.x/De.y*T,Ne(ct,ct,z),G(ct,Ue,ct),ct}(a.projection,0,a.center,s,r),d=dM(a);return ue(u,u,[d,d,1]),u}function dM(a){const r=a.projection,s=X1(a.projection,a.zoom,a.width,a.height),u=OE(r,a.center),d=OE(r,F.convert(r.center));return Math.pow(2,u*s+(1-s)*d)}function X1(a,r,s,u,d=1/0){const g=a.range;if(!g)return 0;const y=Math.min(d,Math.max(s,u)),b=Math.log2(y/1024);return me(g[0]+b,g[1]+b,r)}const Vh=1/4e4;function OE(a,r){const s=ie(r.lat,-fe,fe),u=new F(r.lng-180*Vh,s),d=new F(r.lng+180*Vh,s),g=a.project(u.lng,s),y=a.project(d.lng,s),b=Fe.fromLngLat(u),T=Fe.fromLngLat(d),E=y.x-g.x,k=y.y-g.y,j=T.x-b.x,R=T.y-b.y,L=Math.sqrt((j*j+R*R)/(E*E+k*k));return Math.log2(L)}function hM(a,r,s){const u=Math.cos(s),d=Math.sin(s);return{x:a*u-r*d,y:a*d+r*u}}function fM(a,r,s){K(a),Ne(a,a,ln(r[2])),Ee(a,a,ln(r[0])),xe(a,a,ln(r[1])),ue(a,a,s),G(a,a,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function K1(a,r,s,u,d,g,y,b){const T=[s[0]-r[0],s[1]-r[1],0],E=[u[0]-r[0],u[1]-r[1],0];if(Ye(T)<1e-12||Ye(E)<1e-12)return Or(a);const k=Ur([],T,E);Er(k,k),_t(E,u,r),T[2]=(g-d)*b,E[2]=(y-d)*b;const j=T;return Ur(j,T,E),Er(j,j),jo(a,k,j)}function Y1(a,r,s=!1){const u=zh(r.zoom),d=function(g,y,b){const T=y.worldSize,E=[g[12],g[13],g[14]],k=ce(E[1]/T),j=he(E[0]/T),R=K([]),L=ae(1,k)*T,z=ae(1,0)*T*ve(k,y.zoom),W=1/dE(T);let J=z*W;if(b){const de=X1(y.projection,y.zoom,y.width,y.height,1024);J=W*y.projection.pixelSpaceConversion(y.center.lat,T,de)}const ee=A(k,j);$e(ee,ee,Vt([],Er([],ee),L*J*E[2]));const oe=function(de){const Se=[de[0],de[1],de[2]];let _e=[0,1,0];const Ae=Ur([],_e,Se);return Ur(_e,Se,Ae),Bt(_e)===0&&(_e=[0,1,0],Ur(Ae,Se,_e)),Er(Ae,Ae),Er(_e,_e),Er(Se,Se),[Ae[0],Ae[1],Ae[2],0,_e[0],_e[1],_e[2],0,Se[0],Se[1],Se[2],0,de[0],de[1],de[2],1]}(ee);ue(R,R,[J,J,J*L]),X(R,R,[-E[0],-E[1],-E[2]]);const le=G([],y.globeMatrix,oe);return G(le,le,R),G(le,le,g),le}(a,r,s);if(u>0){const g=function(y,b){const T=b.worldSize,E=ae(1,0)*T*ve(b.center.lat,b.zoom)/dE(T),k=ae(1,b.center.lat)*T,j=K([]);xe(j,j,ln(b.center.lng)),Ee(j,j,ln(b.center.lat)),X(j,j,[0,0,ta]),ue(j,j,[E,E,E*k]);const R=b.point;return X(j,j,[-R.x,-R.y,0]),G(j,j,y),G(j,b.globeMatrix,j)}(a,r);return function(y,b,T){const E=(z,W,J)=>{const ee=Ye(z),oe=Ye(W),le=yd(z,W,J);return Vt(le,le,1/Ye(le)*Rr(ee,oe,J))},k=E([y[0],y[1],y[2]],[b[0],b[1],b[2]],T),j=E([y[4],y[5],y[6]],[b[4],b[5],b[6]],T),R=E([y[8],y[9],y[10]],[b[8],b[9],b[10]],T),L=yd([y[12],y[13],y[14]],[b[12],b[13],b[14]],T);return[k[0],k[1],k[2],0,j[0],j[1],j[2],0,R[0],R[1],R[2],0,L[0],L[1],L[2],1]}(d,g,u)}return d}function LE(a,r,s,u){const d=en.projectAabbCorners(u,s);let g=Number.MAX_VALUE;for(let b=0;b<d.length;++b){const T=d[b];T[0]=(.5*T[0]+.5)*r.width,T[1]=(.5-.5*T[1])*r.height,T[2]<g&&(g=T[2])}const y=function(b){const T=[];let E=0;for(let L=1;L<b.length;L++)(b[L][0]<b[E][0]||b[L][0]===b[E][0]&&b[L][1]<b[E][1])&&(E=L);let k,j=E;const R=new Uint8Array(b.length);do{if(R[j])break;T.push(new xt(b[j][0],b[j][1])),R[j]=1,k=(j+1)%b.length;for(let L=0;L<b.length;L++){if(b[L][0]===b[k][0]&&b[L][1]===b[k][1]||b[L][0]===b[j][0]&&b[L][1]===b[j][1])continue;const z=[b[L][0]-b[j][0],b[L][1]-b[j][1]],W=[b[k][0]-b[j][0],b[k][1]-b[j][1]],J=z[0]*W[1]-z[1]*W[0];(J>0||J===0&&z[0]*W[0]+z[1]*W[1]>=0&&z[0]*z[0]+z[1]*z[1]>W[0]*W[0]+W[1]*W[1])&&(k=L)}j=k}while(j!==E);return T.length>0&&T.push(T[0]),T}(d);if(is(a,y))return g}const $p=64,Qg={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function J1(a,r,s,u,d,g,y,b,T,E=!1){const k=s.zoom,j=s.project(u),R=ve(u.lat,k),L=1/R;K(a),X(a,a,[j.x+y[0]*L,j.y+y[1]*L,y[2]]);let z=1,W=1;const J=s.worldSize;if(E){if(s.projection.name==="mercator"){let de=0;s.elevation&&(de=s.elevation.getAtPointOrZero(new Fe(j.x/J,j.y/J),0));const Se=pr([],[j.x,j.y,de,1],s.projMatrix)[3]/s.cameraToCenterDistance;z=Se,W=Se*ve(s.center.lat,k)}else if(s.projection.name==="globe"){const de=Y1(a,s),Se=[0,0,0,1];pr(Se,Se,G([],s.projMatrix,de));const _e=Se[3]/s.cameraToCenterDistance,Ae=zh(k),ke=s.projection.pixelsPerMeter(u.lat,J)*ve(u.lat,k),De=s.projection.pixelsPerMeter(s.center.lat,J)*ve(s.center.lat,k);z=_e/Rr(ke,Te(s.center.lat),Ae),W=_e*R/ke,z*=De,W*=De}}else z=L;ue(a,a,[z,z,W]);const ee=[...a],oe=r.orientation,le=[];if(fM(le,[oe[0]+(d?d[0]:0),oe[1]+(d?d[1]:0),oe[2]+(d?d[2]:0)],g),G(a,ee,le),b&&s.elevation){let de=0;const Se=[];if(T&&s.elevation){de=function(Ae,ke,De,at,Ue){const ct=ke.elevation;if(!ct)return 0;const pt=en.projectAabbCorners(De,at),bt=ae(1,Ue.lat)*ke.worldSize,Ot=function(Xt,$t){const Fr=[0,0,1],Gt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const vr of Gt){const $r=Xt[vr.corners[0]],nn=Xt[vr.corners[1]],Pn=Xt[vr.corners[2]],Gr=[nn[0]-$r[0],nn[1]-$r[1],$t*(nn[2]-$r[2])],zn=Ur(Gr,Gr,[Pn[0]-$r[0],Pn[1]-$r[1],$t*(Pn[2]-$r[2])]);Er(zn,zn),vr.dotProductWithUp=Vr(zn,Fr)}return Gt.sort((vr,$r)=>vr.dotProductWithUp-$r.dotProductWithUp),Gt[0].corners}(pt,bt),It=pt[Ot[0]],gt=pt[Ot[1]],At=pt[Ot[2]],nt=pt[Ot[3]],Ke=ct.getAtPointOrZero(new Fe(It[0]/ke.worldSize,It[1]/ke.worldSize),0),St=ct.getAtPointOrZero(new Fe(gt[0]/ke.worldSize,gt[1]/ke.worldSize),0),Mt=ct.getAtPointOrZero(new Fe(At[0]/ke.worldSize,At[1]/ke.worldSize),0),vt=ct.getAtPointOrZero(new Fe(nt[0]/ke.worldSize,nt[1]/ke.worldSize),0),er=(Ke+vt)/2,or=(St+Mt)/2;return er>or?St<Mt?K1(Ae,gt,nt,It,St,vt,Ke,bt):K1(Ae,At,It,nt,Mt,Ke,vt,bt):Ke<vt?K1(Ae,It,gt,At,Ke,St,Mt,bt):K1(Ae,nt,At,gt,vt,Mt,St,bt),Math.max(er,or)}(Se,s,r.aabb,a,u);const _e=G([],yt([],Se),le);G(a,ee,_e)}else de=s.elevation.getAtPointOrZero(new Fe(j.x/J,j.y/J),0);de!==0&&(a[14]+=de)}}class pM{constructor(r,s,u,d,g){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=r,this.uri=s,this.position=u!=null?new F(u[0],u[1]):new F(0,0),this.orientation=d??[0,0,0],this.nodes=g,this.uploaded=!1,this.aabb=new en([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(r,s){G(r.globalMatrix,s,r.localMatrix);const u=this.nodeOverrides.get(r.name);if(u!==void 0){const y=[];g=u.orientation,K(d=y),xe(d,d,ln(g[1])),Ne(d,d,ln(g[2])),Ee(d,d,ln(g[0])),G(r.globalMatrix,r.globalMatrix,y)}var d,g;if(r.meshes)for(const y of r.meshes){const b=en.applyTransformFast(y.aabb,r.globalMatrix);this.aabb.encapsulate(b)}if(r.children)for(const y of r.children)this._applyTransformations(y,r.globalMatrix)}computeBoundsAndApplyParent(){const r=K([]);this.aabb=new en([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const s of this.nodes)this._applyTransformations(s,r)}computeModelMatrix(r,s,u,d,g,y,b=!1){J1(this.matrix,this,r.transform,this.position,s,u,d,g,y,b)}upload(r){if(!this.uploaded){for(const s of this.nodes)zE(s,r);for(const s of this.nodes)Q1(s);this.uploaded=!0}}destroy(){for(const r of this.nodes)FE(r)}}function Tx(a,r,s=!1){a.uploaded||(a.gfxTexture=new NE(r,a.image,s?r.gl.R8:r.gl.RGBA8,{useMipmap:a.sampler.minFilter>=r.gl.NEAREST_MIPMAP_NEAREST}),a.uploaded=!0,a.image=null)}function B8(a,r,s){a.indexBuffer=r.createIndexBuffer(a.indexArray,!1,!0),a.vertexBuffer=r.createVertexBuffer(a.vertexArray,M8.members,!1,!0),a.normalArray&&(a.normalBuffer=r.createVertexBuffer(a.normalArray,L8.members,!1,!0)),a.texcoordArray&&(a.texcoordBuffer=r.createVertexBuffer(a.texcoordArray,O8.members,!1,!0)),a.colorArray&&(a.colorBuffer=r.createVertexBuffer(a.colorArray,(a.colorArray.bytesPerElement===12?D8:N8).members,!1,!0)),a.featureArray&&(a.pbrBuffer=r.createVertexBuffer(a.featureArray,F8.members,!0)),a.segments=Vi.simpleSegment(0,0,a.vertexArray.length,a.indexArray.length);const u=a.material;u.pbrMetallicRoughness.baseColorTexture&&Tx(u.pbrMetallicRoughness.baseColorTexture,r),u.pbrMetallicRoughness.metallicRoughnessTexture&&Tx(u.pbrMetallicRoughness.metallicRoughnessTexture,r),u.normalTexture&&Tx(u.normalTexture,r),u.occlusionTexture&&Tx(u.occlusionTexture,r,s),u.emissionTexture&&Tx(u.emissionTexture,r)}function zE(a,r,s){if(a.meshes)for(const u of a.meshes)B8(u,r,s);if(a.children)for(const u of a.children)zE(u,r,s)}function Q1(a){if(a.meshes)for(const r of a.meshes)r.indexArray.destroy(),r.vertexArray.destroy(),r.colorArray&&r.colorArray.destroy(),r.normalArray&&r.normalArray.destroy(),r.texcoordArray&&r.texcoordArray.destroy(),r.featureArray&&r.featureArray.destroy();if(a.children)for(const r of a.children)Q1(r)}function FE(a){if(a.meshes)for(const s of a.meshes)s.vertexBuffer&&(s.vertexBuffer.destroy(),s.indexBuffer.destroy(),s.normalBuffer&&s.normalBuffer.destroy(),s.texcoordBuffer&&s.texcoordBuffer.destroy(),s.colorBuffer&&s.colorBuffer.destroy(),s.pbrBuffer&&s.pbrBuffer.destroy(),s.segments.destroy(),s.material&&((r=s.material).pbrMetallicRoughness.baseColorTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),r.pbrMetallicRoughness.metallicRoughnessTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),r.normalTexture&&r.normalTexture.gfxTexture&&r.normalTexture.gfxTexture.destroy(),r.emissionTexture&&r.emissionTexture.gfxTexture&&r.emissionTexture.gfxTexture.destroy(),r.occlusionTexture&&r.occlusionTexture.gfxTexture&&r.occlusionTexture.gfxTexture.destroy()));var r;if(a.children)for(const s of a.children)FE(s)}function qp(a,r){const s=a.json.bufferViews[r.bufferView],u=H1[r.componentType];return new u(a.buffers[s.buffer],(r.byteOffset||0)+(s.byteOffset||0),r.count*(s.byteStride&&s.byteStride!==wx[r.type]*u.BYTES_PER_ELEMENT?s.byteStride/u.BYTES_PER_ELEMENT:wx[r.type]))}function BE(a,r,s,u){const d=H1[r.componentType],g=function(k){switch(k){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(d),y=a.json.bufferViews[r.bufferView],b=y.byteStride?y.byteStride/d.BYTES_PER_ELEMENT:wx[r.type],T=s.float32,E=T.length/s.capacity;for(let k=0,j=0;k<r.count*b;k+=b,j+=E)for(let R=0;R<E;R++)T[j+R]=u[k+R]*g;s._trim()}function V8(a,r,s){const u=a.indices,d=a.attributes,g={};g.indexArray=new Mi;const y=r.json.accessors[u],b=y.count/3;g.indexArray.reserve(b);const T=qp(r,y);for(let R=0;R<b;R++)g.indexArray.emplaceBack(T[3*R],T[3*R+1],T[3*R+2]);g.indexArray._trim(),g.vertexArray=new ja;const E=r.json.accessors[d.POSITION];g.vertexArray.reserve(E.count);const k=qp(r,E);for(let R=0;R<E.count;R++)g.vertexArray.emplaceBack(k[3*R],k[3*R+1],k[3*R+2]);if(g.vertexArray._trim(),g.aabb=new en(E.min,E.max),g.centroid=function(R,L){const z=[0,0,0],W=R.length;if(W>0){for(let J=0;J<W;J++){const ee=3*R[J];z[0]+=L[ee],z[1]+=L[ee+1],z[2]+=L[ee+2]}z[0]/=W,z[1]/=W,z[2]/=W}return z}(T,k),d.COLOR_0!==void 0){const R=r.json.accessors[d.COLOR_0],L=wx[R.type],z=qp(r,R);g.colorArray=L===3?new ja:new wu,g.colorArray.resize(R.count),BE(r,R,g.colorArray,z)}if(d.NORMAL!==void 0){g.normalArray=new ja;const R=r.json.accessors[d.NORMAL];g.normalArray.resize(R.count);const L=qp(r,R);BE(r,R,g.normalArray,L)}if(d.TEXCOORD_0!==void 0&&s.length>0){g.texcoordArray=new Su;const R=r.json.accessors[d.TEXCOORD_0];g.texcoordArray.resize(R.count);const L=qp(r,R);BE(r,R,g.texcoordArray,L)}if(d._FEATURE_ID_RGBA4444!==void 0){const R=r.json.accessors[d._FEATURE_ID_RGBA4444];r.json.extensionsUsed&&r.json.extensionsUsed.includes("EXT_meshopt_compression")&&(g.featureData=qp(r,R))}d._FEATURE_RGBA4444!==void 0&&(g.featureData=new Uint32Array(qp(r,r.json.accessors[d._FEATURE_RGBA4444]).buffer));const j=a.material;return g.material=function(R,L){const{emissiveFactor:z=[0,0,0],alphaMode:W="OPAQUE",alphaCutoff:J=.5,normalTexture:ee,occlusionTexture:oe,emissiveTexture:le,doubleSided:de,name:Se}=R,{baseColorFactor:_e=[1,1,1,1],metallicFactor:Ae=1,roughnessFactor:ke=1,baseColorTexture:De,metallicRoughnessTexture:at}=R.pbrMetallicRoughness||{},Ue=oe?L[oe.index]:void 0;if(oe&&oe.extensions&&oe.extensions.KHR_texture_transform&&Ue){const ct=oe.extensions.KHR_texture_transform;Ue.offsetScale=[ct.offset[0],ct.offset[1],ct.scale[0],ct.scale[1]]}return{name:Se,pbrMetallicRoughness:{baseColorFactor:new Yn(..._e),metallicFactor:Ae,roughnessFactor:ke,baseColorTexture:De?L[De.index]:void 0,metallicRoughnessTexture:at?L[at.index]:void 0},doubleSided:de,emissiveFactor:new Yn(...z),alphaMode:W,alphaCutoff:J,normalTexture:ee?L[ee.index]:void 0,occlusionTexture:Ue,emissionTexture:le?L[le.index]:void 0,defined:R.defined===void 0}}(j!==void 0?r.json.materials[j]:{defined:!1},s),g}function mM(a,r,s){const{matrix:u,rotation:d,translation:g,scale:y,mesh:b,extras:T,children:E,name:k}=a,j={};if(j.name=k,j.localMatrix=u||function(R,L,z,W){var J=L[0],ee=L[1],oe=L[2],le=L[3],de=J+J,Se=ee+ee,_e=oe+oe,Ae=J*de,ke=J*Se,De=J*_e,at=ee*Se,Ue=ee*_e,ct=oe*_e,pt=le*de,bt=le*Se,Ot=le*_e,It=W[0],gt=W[1],At=W[2];return R[0]=(1-(at+ct))*It,R[1]=(ke+Ot)*It,R[2]=(De-bt)*It,R[3]=0,R[4]=(ke-Ot)*gt,R[5]=(1-(Ae+ct))*gt,R[6]=(Ue+pt)*gt,R[7]=0,R[8]=(De+bt)*At,R[9]=(Ue-pt)*At,R[10]=(1-(Ae+at))*At,R[11]=0,R[12]=z[0],R[13]=z[1],R[14]=z[2],R[15]=1,R}([],d||[0,0,0,1],g||[0,0,0],y||[1,1,1]),j.globalMatrix=H(j.localMatrix),b!==void 0){j.meshes=s[b];const R=j.anchor=[0,0];for(const L of j.meshes){const{min:z,max:W}=L.aabb;R[0]+=z[0]+W[0],R[1]+=z[1]+W[1]}R[0]=Math.floor(R[0]/j.meshes.length/2),R[1]=Math.floor(R[1]/j.meshes.length/2)}if(T&&(T.id&&(j.id=T.id),T.lights&&(j.lights=function(R){if(!R.length)return[];const L=function(oe){const le=atob(oe),de=new Uint8Array(le.length);for(let Se=0;Se<le.length;Se++)de[Se]=le.codePointAt(Se);return de}(R),z=[],W=L.length/24,J=new Uint16Array(L.buffer),ee=new Float32Array(L.buffer);for(let oe=0;oe<W;oe++){const le=J[2*oe*6]/30,de=J[2*oe*6+1]/30,Se=J[2*oe*6+10]/100,_e=ee[6*oe+1],Ae=ee[6*oe+2],ke=ee[6*oe+3],De=ee[6*oe+4],at=ke-_e,Ue=De-Ae,ct=Math.hypot(at,Ue);z.push({pos:[_e+.5*at,Ae+.5*Ue,de],normal:[Ue/ct,-at/ct,0],width:ct,height:le,depth:Se,points:[_e,Ae,ke,De]})}return z}(T.lights)),T.MAPBOX_geometry_bloom&&(j.isGeometryBloom=T.MAPBOX_geometry_bloom)),E){const R=[];for(const L of E)R.push(mM(r.json.nodes[L],r,s));j.children=R}return j}function U8(a){if(a.vertices.length===0||a.indices.length===0)return null;const r=new F1(a.vertices,a.indices,8,256),[s,u]=[r.min.clone(),r.max.clone()];return{vertices:a.vertices,indices:a.indices,grid:r,min:s,max:u}}function $8(a){if(!a.extras||!a.extras.ground)return null;const r=a.extras.ground;if(!r||!Array.isArray(r)||r.length===0)return null;const s=r[0];if(!s||!Array.isArray(s)||s.length===0)return null;const u=[];for(const y of s){if(!Array.isArray(y)||y.length!==2)continue;const b=y[0],T=y[1];typeof b=="number"&&typeof T=="number"&&u.push(new xt(b,T))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let d=0;for(let y=0;y<u.length;y++){const b=u[y],T=u[(y+1)%u.length],E=u[(y+2)%u.length];d+=(b.x-T.x)*(E.y-T.y)-(E.x-T.x)*(b.y-T.y)}d>0&&u.reverse();const g=Hg(u.flatMap(y=>[y.x,y.y]),[]);return g.length===0?null:{vertices:u,indices:g}}function q8(a,r){const s=[],u=[];let d=0;const g=[];for(const y of a){d=s.length;const b=y.vertexArray.float32,T=y.indexArray.uint16;for(let E=0;E<y.vertexArray.length;E++)g[0]=b[3*E+0],g[1]=b[3*E+1],g[2]=b[3*E+2],yn(g,g,r),s.push(new xt(g[0],g[1]));for(let E=0;E<3*y.indexArray.length;E++)u.push(T[E]+d)}if(u.length%3!=0)return null;for(let y=0;y<u.length;y+=3){const b=s[u[y+0]],T=s[u[y+1]],E=s[u[y+2]];(b.x-T.x)*(E.y-T.y)-(E.x-T.x)*(b.y-T.y)>0&&([u[y+1],u[y+2]]=[u[y+2],u[y+1]])}return{vertices:s,indices:u}}function VE(a){const r=function(T,E){const k=[],j=WebGL2RenderingContext;if(T.json.textures)for(const R of T.json.textures){const L={magFilter:j.LINEAR,minFilter:j.NEAREST,wrapS:j.REPEAT,wrapT:j.REPEAT};R.sampler!==void 0&&Object.assign(L,T.json.samplers[R.sampler]),k.push({image:E[R.source],sampler:L,uploaded:!1})}return k}(a,a.images),s=function(T,E){const k=[];for(const j of T.json.meshes){const R=[];for(const L of j.primitives)R.push(V8(L,T,E));k.push(R)}return k}(a,r),{scenes:u,scene:d,nodes:g}=a.json,y=u?u[d||0].nodes:[...g.keys()],b=[];for(const T of y)b.push(mM(g[T],a,s));return function(T,E,k){const j={},R=new Set;for(let L=0;L<T.length;L++){const z=k[E[L]];if(!z.extras)continue;const W=z.extras["mapbox:footprint:version"],J=z.extras["mapbox:footprint:id"];(W||J)&&R.add(L),W==="1.0.0"&&J&&(j[J]=L)}for(let L=0;L<T.length;L++){if(R.has(L))continue;const z=T[L],W=k[E[L]];if(!W.extras)continue;let J=null;z.id in j&&(J=q8(T[j[z.id]].meshes,z.localMatrix)),J||(J=$8(W)),J&&(z.footprint=U8(J))}if(R.size>0){const L=Array.from(R.values()).sort((z,W)=>z-W);for(let z=L.length-1;z>=0;z--)T.splice(L[z],1)}}(b,y,a.json.nodes),b}function G8(a){a.heightmap=new Float32Array(4096),a.heightmap.fill(-1);const r=a.vertexArray.float32,s=a.aabb.min[0]-1,u=a.aabb.min[1]-1,d=$p/(a.aabb.max[0]-s+2),g=$p/(a.aabb.max[1]-u+2);for(let y=0;y<r.length;y+=3){const b=r[y+2],T=(r[y+0]-s)*d|0,E=(r[y+1]-u)*g|0;b>a.heightmap[E*$p+T]&&(a.heightmap[E*$p+T]=b)}}function gM(a,r,s,u,d){s.reserve(s.length+4*a.length),u.reserve(u.length+10*a.length),d.reserve(d.length+10*a.length);let g=u.length;for(const y of a){const b=Math.min(10,Math.max(4,1.3*y.height))*r,T=[-y.normal[1],y.normal[0],0],E=Math.min(.29,.1*y.width/y.depth),k=y.width-2*y.depth*r*(E+.01),j=it([],y.pos,T,k/2),R=it([],y.pos,T,-k/2),L=[j[0],j[1],j[2]+y.height],z=[R[0],R[1],R[2]+y.height],W=it([],y.normal,T,E);Vt(W,W,b);const J=it([],y.normal,T,-E);Vt(J,J,b),$e(W,j,W),$e(J,R,J),j[2]+=.1,R[2]+=.1,u.emplaceBack(W[0],W[1],W[2]),u.emplaceBack(J[0],J[1],J[2]),u.emplaceBack(j[0],j[1],j[2]),u.emplaceBack(R[0],R[1],R[2]),u.emplaceBack(L[0],L[1],L[2]),u.emplaceBack(z[0],z[1],z[2]),u.emplaceBack(j[0],j[1],j[2]),u.emplaceBack(R[0],R[1],R[2]),u.emplaceBack(W[0],W[1],W[2]),u.emplaceBack(J[0],J[1],J[2]);const ee=k/b/2;d.emplaceBack(-ee-E,-1,ee,.8),d.emplaceBack(ee+E,-1,ee,.8),d.emplaceBack(-ee,0,ee,1.3),d.emplaceBack(ee,0,ee,1.3),d.emplaceBack(ee+E,-.8,ee,.7),d.emplaceBack(ee+E,-.8,ee,.7),d.emplaceBack(0,0,ee,1.3),d.emplaceBack(0,0,ee,1.3),d.emplaceBack(ee+E,-1.2,ee,.8),d.emplaceBack(ee+E,-1.2,ee,.8),s.emplaceBack(6+g,4+g,8+g),s.emplaceBack(7+g,9+g,5+g),s.emplaceBack(0+g,1+g,2+g),s.emplaceBack(1+g,3+g,2+g),g+=10}}function W8(a,r){const s={};s.indexArray=new Mi,s.vertexArray=new ja,s.colorArray=new wu,gM(a,r,s.indexArray,s.vertexArray,s.colorArray);const u={defined:!0};u.emissiveFactor=Yn.black;const d={};return d.baseColorFactor=Yn.white,u.pbrMetallicRoughness=d,s.material=u,s.aabb=new en([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),s}const _M=fn([{name:"a_pos_3f",components:3,type:"Float32"}]),H8=fn([{name:"a_normal_3",components:3,type:"Int16"}]),Z8=fn([{name:"a_centroid_3",components:3,type:"Int16"}]),yM=fn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),X8=fn([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),K8=fn([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),Y8=fn([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),J8=fn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),Q8=fn([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),vM=wt.types,ew=32767;function eq(a,r){const s=zt+r;for(const u of a)for(const d of u)if(d.x<-r||d.x>s||d.y<-r||d.y>s)return!1;return!0}class xM{constructor(){this.layoutVertexArray=new ja,this.layoutAttenuationArray=new wu,this.layoutColorArray=new ll,this.indexArray=new Mi,this.indexArrayForConflation=new Mi,this.segmentsBucket=new Vi}}class UE{constructor(){this.layoutVertexArray=new ja,this.layoutNormalArray=new pd,this.layoutCentroidArray=new pd,this.layoutColorArray=new ll,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutFloodLightDataArray=new Lg,this.layoutAOArray=new Cc,this.indexArray=new Mi,this.indexArrayForConflation=new Mi,this.segmentsBucket=new Vi,this.entranceBloom=new xM}}class bM{constructor(r){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new UE,this.buildingWithFacade=new UE,this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.footprintLookup={},this.zoom=r.zoom,this.canonical=r.canonical,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=r.index,this.hasPattern=!1,this.worldview=r.worldview,this.lut=r.lut,this.buildingWithFacade.layoutFacadePaintArray=new ll,this.buildingWithFacade.layoutFacadeDataArray=new md,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new ll,this.programConfigurations=new kl(r.layers,{zoom:r.zoom,lut:r.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=r.projection,this.groundEffect=new CE(r),this.groundEffect.groundRadiusArray=new Cc,this.hasAppearances=null}updateFootprints(r,s){for(const u of this.footprints)s.push({footprint:u,id:r})}updateAppearances(r,s,u,d){}prepare(){return function(){if(W1!=null||eM!=null)return null;if(Jg!=null)return Jg;const r=fetch(Ai.BUILDING_GEN_URL);return Jg=function(s){let u,d,g,y;function b(){u=new Uint8Array(y.buffer),d=new Int32Array(y.buffer),g=new Float32Array(y.buffer)}function T(){throw new Error("Unexpected BuildingGen error.")}const E=()=>{},k={a:{a:T,f:function(j){const R=u.length,L=Math.max(j>>>0,Math.ceil(1.2*R)),z=Math.ceil((L-R)/65536);try{return y.grow(z),b(),!0}catch{return!1}},g:T,b:E,c:E,d:E,e:E}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(s,k):s.then(j=>j.arrayBuffer()).then(j=>WebAssembly.instantiate(j,k))).then(j=>{const R=j.instance.exports;return(0,R.g)(),y=R.f,b(),new C8({setStyle:R.h,setAOOptions:R.i,setMetricOptions:R.j,setStructuralOptions:R.k,setFacadeOptions:R.l,setFauxFacadeOptions:R.m,setFacadeClassifierOptions:R.n,addFeature:R.o,addFacade:R.p,generateMesh:R.q,getLastError:R.r,getOuterRingLength:R.s,getMeshCount:R.t,getPositionsPtr:R.u,getPositionsLength:R.v,getNormalsPtr:R.w,getNormalsLength:R.x,getColorsPtr:R.y,getColorsLength:R.z,getAOPtr:R.A,getAOLength:R.B,getUVPtr:R.C,getUVLength:R.D,getFauxFacadePtr:R.E,getFauxFacadeLength:R.F,getIndicesPtr:R.G,getIndicesLength:R.H,getBuildingPart:R.I,getRingCount:R.J,getRingPtr:R.K,getRingLength:R.L,free:R.M,malloc:R.N,heapU8:u,heap32:d,heapF32:g})})}(r).then(s=>(Jg=null,W1=s,W1)).catch(s=>{br("Could not load building-gen"),Jg=null,eM=s}),Jg}()}populate(r,s,u,d){const g=A8();if(!g)return;const y=Ce(u);this.tileToMeter=y,this.brightness=s.brightness,g.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,y],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:y,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),g.setAOOptions(!1,.3),g.setMetricOptions(!1,16),g.setStructuralOptions(!0),g.setFacadeClassifierOptions(3);const b=new Map,T=new Map;for(const{feature:E}of r){if(vM[E.type]!=="LineString"){b.set(E.id,E.properties.source_id);continue}const k=this.layers[0]._featureFilter.needGeometry,j=Ze(E,k);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),j,u))continue;const R=k?j.geometry:ft(E,u,d),L=[];for(const ee of R)for(const oe of ee)L.push({x:oe.x,y:oe.y});const z={coordinates:L,crossPerc:E.properties.cross_perc,distanceToRoad:E.properties.distance_to_road,entrances:E.properties.entrances,sourceId:0},W=E.properties.source_id;let J=T.get(W);J||(J=[],T.set(W,J)),J.push(z)}this.maxHeight=0;for(const{feature:E,id:k,index:j,sourceLayerIndex:R}of r){if(vM[E.type]==="LineString")continue;const L=this.layers[0]._featureFilter.needGeometry,z=Ze(E,L);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),z,u))continue;const W=L?z.geometry:ft(E,u,d),J=fx(W,500);if(!eq(W,163))continue;const ee=this.layers[0],oe=ee.layout.get("building-roof-shape").evaluate(E,{},u);if(oe==="flat")continue;const le=ee.layout.get("building-base").evaluate(E,{},u),de=ee.layout.get("building-height").evaluate(E,{},u),Se=ee.layout.get("building-flood-light-ground-radius").evaluate(E,{},u),_e=ee.paint.get("building-ambient-occlusion-intensity"),Ae=Se/this.tileToMeter;let ke=ee.layout.get("building-flood-light-wall-radius").evaluate(E,{},u);ke=ie(ke,0,2048);const De=ke/2048*ew,at=b.get(k);let Ue;Ue=T.has(at)?T.get(at):[];const ct=Ue.length!==0&&ee.layout.get("building-facade").evaluate(E,{},u);g.setFacadeOptions(4,!0),g.setFauxFacadeOptions(ct,!1,1);let pt=0,bt=0,Ot=0,It=0,gt=0,At=0;if(ct){let dt=Math.round(ee.layout.get("building-facade-floors").evaluate(E,{},u));if(le===0){dt=Math.max(1,dt-(Ue.length>0?1:0));let hr=4;if(de>100){const ur=[10,13,15];hr=ur[E.id?E.id%ur.length:0],g.setFacadeOptions(hr,!0)}gt=1.6803*hr/y}else gt=le/y;At=de/y,gt=Math.min(gt,At),Ot=ee.layout.get("building-facade-unit-width").evaluate(E,{},u)/y,It=(At-gt)/dt,g.setFauxFacadeOptions(!0,!0,Ot);const qt=ee.layout.get("building-facade-window").evaluate(E,{},u);pt=qt[0],bt=qt[1]}const nt=[],Ke=new xt(1/0,1/0),St=new xt(-1/0,-1/0),Mt=new xt(0,0);let vt=0;for(const dt of J)if(dt.length>0){const qt=[];for(const hr of dt){const ur=[];for(let Hr=hr.length-1;Hr>=0;Hr--){const Ir=hr[Hr];ur.push({x:Ir.x,y:Ir.y}),Ke.x=Math.min(Ke.x,Ir.x),Ke.y=Math.min(Ke.y,Ir.y),St.x=Math.max(St.x,Ir.x),St.y=Math.max(St.y,Ir.y),Mt.x+=Ir.x,Mt.y+=Ir.y,vt++}qt.push(ur)}nt.push({id:E.id?E.id:0,height:de,minHeight:le,sourceId:0,roofType:oe,coordinates:qt})}Mt.x/=vt||1,Mt.y/=vt||1;const er=g.generateMesh(nt,Ue);if(typeof er=="string"){br(`Unable to generate building ${E.id}: ${er}`);continue}if(er.meshes.length===0||er.modifiedPolygonRings.length===0)continue;let or=0;for(const dt of er.meshes)or+=dt.positions.length/3;const Xt=ct?this.buildingWithFacade:this.buildingWithoutFacade,$t=Xt.segmentsBucket.prepareSegment(or,Xt.layoutVertexArray,Xt.indexArray),Fr=[];let Gt=null,vr=0,$r=-1;const nn=Xt.layoutVertexArray.length,Pn=Xt.indexArray.length;let Gr=0;for(const dt of er.meshes){const qt=Xt.layoutVertexArray.length;if(dt.buildingPart==="entrance"){const lr=new Array;for(let An=0;An<dt.positions.length;An+=12){const ui=dt.positions[An+0],Jn=dt.positions[An+1],Zi=dt.positions[An+3],Pi=dt.positions[An+4],_i=dt.positions[An+2],ii=dt.positions[An+8]-_i,Bn=1,Zr=Zi-ui,Vn=Pi-Jn,yi=Math.hypot(Zr,Vn);lr.push({pos:[ui+.5*Zr,Jn+.5*Vn,_i],normal:[Vn/yi,-Zr/yi,0],width:yi,height:ii,depth:Bn,points:[ui,Jn,Zi,Pi]})}const On=Xt.entranceBloom.segmentsBucket.prepareSegment(10*lr.length,Xt.entranceBloom.layoutVertexArray,Xt.entranceBloom.indexArray),ci=Xt.entranceBloom.layoutVertexArray.length;vr=Xt.entranceBloom.indexArray.length,gM(lr,.5/this.tileToMeter,Xt.entranceBloom.indexArray,Xt.entranceBloom.layoutVertexArray,Xt.entranceBloom.layoutAttenuationArray);const jr=Xt.entranceBloom.layoutVertexArray.length-ci;$r=Xt.entranceBloom.indexArray.length-vr;for(let An=0;An<jr;An++)Xt.entranceBloom.layoutColorArray.emplaceBack(65535,65535);On.vertexLength+=jr,On.primitiveLength+=$r,Gt={part:dt.buildingPart,vertexOffset:ci,vertexLength:jr}}for(let lr=0;lr<dt.positions.length;lr+=3)Gr=Math.max(Gr,dt.positions[lr+2]),Xt.layoutVertexArray.emplaceBack(dt.positions[lr],dt.positions[lr+1],dt.positions[lr+2]);const hr=Math.floor(Mt.x),ur=Math.floor(Mt.y),Hr=Math.floor(Gr);for(let lr=0;lr<dt.positions.length;lr+=3)Xt.layoutCentroidArray.emplaceBack(hr,ur,Hr),Xt.layoutFloodLightDataArray.emplaceBack(dt.buildingPart==="wall"?De:0);for(let lr=0;lr<dt.normals.length;lr+=3)Xt.layoutNormalArray.emplaceBack(dt.normals[lr+0]*ew,dt.normals[lr+1]*ew,dt.normals[lr+2]*ew);for(let lr=0;lr<dt.ao.length;lr++)Xt.layoutAOArray.emplaceBack(dt.ao[lr]);for(let lr=0;lr<dt.colors.length;lr+=3){const On=1+(dt.ao[lr/3]-1)*_e;Xt.layoutColorArray.emplaceBack(dt.colors[lr]*On<<8|dt.colors[lr+1]*On,dt.colors[lr+2]*On<<8)}if(ct){for(let lr=0;lr<dt.positions.length;lr+=3)Xt.layoutFacadePaintArray.emplaceBack(65535,255);for(let lr=0;lr<dt.isFauxFacade.length;lr++)if(dt.isFauxFacade[lr]){const On=1|Math.min(65535,Math.floor(dt.uv[2*lr]*er.outerRingLength)),ci=Math.floor(255*pt)<<8|Math.floor(255*bt),jr=Math.floor(65535*Math.min(1,Ot/zt)),An=Math.floor(65535*Math.min(1,It/zt));Xt.layoutFacadeDataArray.emplaceBack(On,ci,jr,An);const ui=Math.floor(65535*Math.min(1,gt/zt)),Jn=Math.floor(65535*Math.min(1,At/zt));Xt.layoutFacadeVerticalRangeArray.emplaceBack(ui,Jn)}else Xt.layoutFacadeDataArray.emplaceBack(0,0,0,0),Xt.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const Ir=$t.vertexLength;for(let lr=0;lr<dt.indices.length;lr+=3)Xt.indexArray.emplaceBack(Ir+dt.indices[lr],Ir+dt.indices[lr+1],Ir+dt.indices[lr+2]);$t.vertexLength+=dt.positions.length/3,$t.primitiveLength+=dt.indices.length/3,(dt.buildingPart==="roof"||dt.buildingPart==="wall"||dt.buildingPart==="facade_glazing"||dt.buildingPart==="entrance")&&Fr.push({part:dt.buildingPart,vertexOffset:qt,vertexLength:dt.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,Gr),this.buildingFeatures.push({promoteId:k,feature:z,hasFauxFacade:ct,segment:$t,parts:Fr,buildingBloom:Gt});const zn=Xt.indexArray.length-Pn,Fn=[],Li=[],ye=new xt(1/0,1/0),pe=new xt(-1/0,-1/0),ut=this.groundEffect.vertexArray.length;for(const dt of er.modifiedPolygonRings){const qt=[],hr=new xt(1/0,1/0),ur=new xt(-1/0,-1/0);for(let Hr=0;Hr<dt.length;Hr+=2){const Ir=dt.length-Hr-2;hr.x=Math.min(hr.x,dt[Ir]),hr.y=Math.min(hr.y,dt[Ir+1]),ur.x=Math.max(ur.x,dt[Ir]),ur.y=Math.max(ur.y,dt[Ir+1]);const lr=new xt(dt[Ir],dt[Ir+1]);qt.push(lr),Fn.push(lr.x,lr.y),Li.push(lr.clone())}ye.x=Math.min(ye.x,hr.x),ye.y=Math.min(ye.y,hr.y),pe.x=Math.max(pe.x,ur.x),pe.y=Math.max(pe.y,ur.y),this.groundEffect.addData(qt,[hr,ur],Ae)}const Ut=this.groundEffect.vertexArray.length-ut;for(let dt=0;dt<Ut;dt++)this.groundEffect.groundRadiusArray.emplaceBack(Se);(Ke.x<0||St.x>zt||Ke.y<0||St.y>zt)&&this.featuresOnBorder.push({featureId:E.id,footprintIndex:this.footprints.length});{const dt=Hg(Fn,null,2),qt=new F1(Li,dt,8,256);let hr=E.id;E.properties&&E.properties.hasOwnProperty("building_id")&&(hr=E.properties.building_id);const ur={vertices:Li,indices:dt,grid:qt,min:ye,max:pe,buildingId:hr,hiddenFlags:0,indicesOffset:Pn,indicesLength:zn,bloomIndicesOffset:vr,bloomIndicesLength:$r,groundEffectVertexOffset:ut,groundEffectVertexLength:Ut,hasFauxFacade:ct,segment:$t,height:Gr};E.id!==void 0&&this.featureFootprintLookup.set(E.id,this.footprints.length),this.footprints.push(ur)}this.programConfigurations.populatePaintArrays(Xt.layoutVertexArray.length,E,j,{},s.availableImages,u,s.brightness),this.groundEffect.addPaintPropertiesData(E,j,{},s.availableImages,u,s.brightness),s.featureIndex.insert(E,W,j,R,this.index,nn)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(r,s,u,d,g,y,b){this.programConfigurations.updatePaintArrays(r,s,g,u,d,y,b),this.groundEffect.update(r,s,g,u,d,y,b),this.evaluate(this.layers[0],r),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(r){const s=u=>{u.layoutVertexBuffer=r.createVertexBuffer(u.layoutVertexArray,_M.members),u.layoutNormalBuffer=r.createVertexBuffer(u.layoutNormalArray,H8.members),u.layoutCentroidBuffer=r.createVertexBuffer(u.layoutCentroidArray,Z8.members),u.layoutFloodLightDataBuffer=r.createVertexBuffer(u.layoutFloodLightDataArray,Q8.members),u.layoutFacadeDataArray&&u.layoutFacadeDataArray.length&&(u.layoutFacadeDataBuffer=r.createVertexBuffer(u.layoutFacadeDataArray,K8.members)),u.layoutFacadeVerticalRangeArray&&u.layoutFacadeVerticalRangeArray.length&&(u.layoutFacadeVerticalRangeBuffer=r.createVertexBuffer(u.layoutFacadeVerticalRangeArray,Y8.members)),u.entranceBloom.layoutVertexArray.length&&(u.entranceBloom.layoutVertexBuffer=r.createVertexBuffer(u.entranceBloom.layoutVertexArray,_M.members),u.entranceBloom.layoutAttenuationBuffer=r.createVertexBuffer(u.entranceBloom.layoutAttenuationArray,J8.members)),this.uploadUpdatedColorBuffer(r),this.uploadUpdatedIndexBuffer(r)};this.uploaded||(s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.groundEffect.upload(r)),this.groundEffect.uploadPaintProperties(r),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){const r=s=>{s.layoutVertexBuffer&&(s.layoutVertexBuffer.destroy(),s.layoutNormalBuffer.destroy(),s.layoutColorBuffer.destroy(),s.segmentsBucket.destroy(),s.indexBuffer&&s.indexBuffer.destroy(),s.entranceBloom.layoutVertexBuffer&&(s.entranceBloom.layoutVertexBuffer.destroy(),s.entranceBloom.layoutColorBuffer.destroy(),s.entranceBloom.layoutAttenuationBuffer.destroy(),s.entranceBloom.indexBuffer.destroy(),s.entranceBloom.segmentsBucket.destroy()))};r(this.buildingWithoutFacade),r(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(r,s,u=!0){let d=!1;const g=u?s:0,y=0|(u?-1:~s);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const b of r){const T=this.footprints[b],E=T.hiddenFlags&y|g;T.hiddenFlags!==E&&(T.hiddenFlags=E,d=!0,this.groundEffect.updateHiddenByLandmarkRange(T.groundEffectVertexOffset,T.groundEffectVertexLength,T.hiddenFlags!==0))}return d&&(this.indexArrayForConflationUploaded=!1),d}uploadUpdatedIndexBuffer(r){if(this.groundEffect.uploadHiddenByLandmark(r),this.indexArrayForConflationUploaded)return;const s=d=>{d.indexArray.length!==0&&(d.indexArrayForConflation.resize(d.indexArray.length),d.indexArrayForConflation.uint16.set(d.indexArray.uint16),d.entranceBloom.indexArrayForConflation.resize(d.entranceBloom.indexArray.length),d.entranceBloom.indexArrayForConflation.uint16.set(d.entranceBloom.indexArray.uint16))};s(this.buildingWithoutFacade),s(this.buildingWithFacade);for(const d of this.footprints){const g=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,y=d.indicesOffset+d.indicesLength;if(d.hiddenFlags!==0){for(let T=d.indicesOffset;T<y;T++)g.indexArrayForConflation.uint16[3*T+0]=0,g.indexArrayForConflation.uint16[3*T+1]=0,g.indexArrayForConflation.uint16[3*T+2]=0;const b=d.bloomIndicesOffset+d.bloomIndicesLength;for(let T=d.bloomIndicesOffset;T<b;T++)g.entranceBloom.indexArrayForConflation.uint16[3*T+0]=0,g.entranceBloom.indexArrayForConflation.uint16[3*T+1]=0,g.entranceBloom.indexArrayForConflation.uint16[3*T+2]=0}}const u=d=>{d.indexArray.length!==0&&(d.indexBuffer?d.indexBuffer.updateData(d.indexArrayForConflation):d.indexBuffer=r.createIndexBuffer(d.indexArrayForConflation,!0),d.entranceBloom.indexBuffer?d.entranceBloom.indexBuffer.updateData(d.entranceBloom.indexArrayForConflation):d.entranceBloom.indexBuffer=r.createIndexBuffer(d.entranceBloom.indexArrayForConflation,!0))};u(this.buildingWithoutFacade),u(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(r){const s=u=>{u.layoutColorBuffer?u.layoutColorBuffer.updateData(u.layoutColorArray):u.layoutColorBuffer=r.createVertexBuffer(u.layoutColorArray,yM.members,!0),u.layoutFacadePaintArray&&(u.layoutFacadePaintBuffer?u.layoutFacadePaintBuffer.updateData(u.layoutFacadePaintArray):u.layoutFacadePaintBuffer=r.createVertexBuffer(u.layoutFacadePaintArray,X8.members,!0)),u.entranceBloom.layoutColorBuffer?u.entranceBloom.layoutColorBuffer.updateData(u.entranceBloom.layoutColorArray):u.entranceBloom.layoutColorBuffer=r.createVertexBuffer(u.entranceBloom.layoutColorArray,yM.members,!0)};s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(r,s){const u=r.paint.get("building-ambient-occlusion-intensity");for(const d of this.buildingFeatures){const g=s[d.promoteId],y=d.feature;y.properties["building-part"]="roof";const b=r.paint.get("building-color").evaluate(y,g,this.canonical).toPremultipliedRenderColor(this.lut),T=r.paint.get("building-emissive-strength").evaluate(y,g,this.canonical);y.properties["building-part"]="wall";const E=r.paint.get("building-color").evaluate(y,g,this.canonical).toPremultipliedRenderColor(this.lut),k=r.paint.get("building-emissive-strength").evaluate(y,g,this.canonical);y.properties["building-part"]="window";const j=r.paint.get("building-color").evaluate(y,g,this.canonical).toPremultipliedRenderColor(this.lut),R=r.paint.get("building-emissive-strength").evaluate(y,g,this.canonical);y.properties["building-part"]="door";const L=r.paint.get("building-color").evaluate(y,g,this.canonical).toPremultipliedRenderColor(this.lut),z=r.paint.get("building-emissive-strength").evaluate(y,g,this.canonical),W=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const ee of d.parts){let oe,le=b;ee.part==="roof"?(le=b,oe=T):ee.part==="wall"?(le=E,oe=k):ee.part==="facade_glazing"?(le=j,oe=R):ee.part==="entrance"&&(le=L,oe=z),oe=ie(oe,0,1);for(let de=0;de<ee.vertexLength;de++){const Se=ee.vertexOffset+de,_e=1+(W.layoutAOArray.float32[Se]-1)*u;W.layoutColorArray.emplace(Se,le.r*_e*255<<8|le.g*_e*255,le.b*_e*255<<8|255*oe),d.hasFauxFacade&&W.layoutFacadePaintArray.emplace(Se,255*j.r<<8|255*j.g,255*j.b<<8|255*R)}}const J=d.buildingBloom;if(J)for(let ee=0;ee<J.vertexLength;ee++)W.entranceBloom.layoutColorArray.emplace(J.vertexOffset+ee,255*L.r<<8|255*L.g,255*L.b<<8|51*z)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(r,s,u){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const d=s.getReplacementRegionsForTile(r.toUnwrapped());if(V1(this.activeReplacements,d))return;this.activeReplacements=d;for(const y of this.footprints)y.hiddenFlags&=-2;const g=[];for(const y of this.activeReplacements){if(y.order<=wR)continue;const b=Math.max(1,Math.pow(2,y.footprintTileId.canonical.z-r.canonical.z));for(const T of this.footprints)T.min.x>y.max.x||T.max.x<y.min.x||T.min.y>y.max.y||T.max.y<y.min.y||(g.length=0,tq(T.vertices,0,T.vertices.length,y.footprintTileId.canonical,r.canonical,g),wE(y.footprint,g,T.indices,0,T.indices.length,0,-b)&&(T.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const y of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(y.groundEffectVertexOffset,y.groundEffectVertexLength,y.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(r){if(r.id!==void 0){const s=this.featureFootprintLookup.get(r.id);return this.footprints[s]}return null}getHeightAtTileCoord(r,s){let u=Number.NEGATIVE_INFINITY,d=!0;const g=4*(r+zt)*zt+(s+zt);if(this.footprintLookup.hasOwnProperty(g)){const b=this.footprintLookup[g];return b?{height:b.height,hidden:b.hiddenFlags!==0}:void 0}const y=new xt(r,s);for(const b of this.footprints)r>b.max.x||b.min.x>r||s>b.max.y||b.min.y>s||b.height<=u||SE(y,b)&&(u=b.height,this.footprintLookup[g]=b,d=b.hiddenFlags!==0);if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:d};this.footprintLookup[g]=void 0}}function tq(a,r,s,u,d,g){const y=Math.pow(2,u.z-d.z);for(let b=0;b<s;b++){let T=a[b+r].x,E=a[b+r].y;T=(T+d.x*zt)*y-u.x*zt,E=(E+d.y*zt)*y-u.y*zt,g.push(new xt(T,E))}}let wM,SM;rr(bM,"BuildingBucket",{omit:["layers"]}),rr(UE,"BuildingGeometry"),rr(xM,"BuildingBloomGeometry");const rq=fn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),nq=fn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:iq}=rq,sq=fn([{name:"a_packed",components:3,type:"Float32"}]),{members:oq}=sq,aq=fn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:lq}=aq;class TM{constructor(r,s){this.width=r,this.height=s,this.nextRow=0,this.image=new Fh({width:r,height:s}),this.positions={},this.uploaded=!1}getDash(r,s){const u=this.getKey(r,s);return this.positions[u]}trim(){const r=this.width,s=this.height=ze(this.nextRow);this.image.resize({width:r,height:s})}getKey(r,s){return r.join(",")+s}getDashRanges(r,s,u){const d=[];let g=r.length%2==1?-r[r.length-1]*u:0,y=r[0]*u,b=!0;d.push({left:g,right:y,isDash:b,zeroLength:r[0]===0});let T=r[0];for(let E=1;E<r.length;E++){b=!b;const k=r[E];g=T*u,T+=k,y=T*u,d.push({left:g,right:y,isDash:b,zeroLength:k===0})}return d}addRoundDash(r,s,u){const d=s/2;for(let g=-u;g<=u;g++){const y=this.width*(this.nextRow+u+g);let b=0,T=r[b];for(let E=0;E<this.width;E++){E/T.right>1&&(T=r[++b]);const k=Math.abs(E-T.left),j=Math.abs(E-T.right),R=Math.min(k,j);let L;const z=g/u*(d+1);if(T.isDash){const W=d-Math.abs(z);L=Math.sqrt(R*R+W*W)}else L=d-Math.sqrt(R*R+z*z);this.image.data[y+E]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(r,s){for(let T=r.length-1;T>=0;--T){const E=r[T],k=r[T+1];E.zeroLength?r.splice(T,1):k&&k.isDash===E.isDash&&(k.left=E.left,r.splice(T,1))}const u=r[0],d=r[r.length-1];u.isDash===d.isDash&&(u.left=d.left-this.width,d.right=u.right+this.width);const g=this.width*this.nextRow;let y=0,b=r[y];for(let T=0;T<this.width;T++){T/b.right>1&&(b=r[++y]);const E=Math.abs(T-b.left),k=Math.abs(T-b.right),j=Math.min(E,k);this.image.data[g+T]=Math.max(0,Math.min(255,(b.isDash?j:-j)+s+128))}}addDash(r,s){const u=this.getKey(r,s);if(this.positions[u])return this.positions[u];const d=s==="round",g=d?7:0,y=2*g+1;if(this.nextRow+y>this.height)return br("LineAtlas out of space"),null;r.length===0&&r.push(1);let b=0;for(let k=0;k<r.length;k++)r[k]<0&&(br("Negative value is found in line dasharray, replacing values with 0"),r[k]=0),b+=r[k];if(b!==0){const k=this.width/b,j=this.getDashRanges(r,this.width,k);d?this.addRoundDash(j,k,g):this.addRegularDash(j,s==="square"?.5*k:0)}const T=this.nextRow+g;this.nextRow+=y;const E={tl:[T,g],br:[b,0]};return this.positions[u]=E,E}}rr(TM,"LineAtlas");const cq=wt.types,uq=Math.cos(Math.PI/180*37.5),dq=Math.cos(Math.PI/180*5);class $E{constructor(r){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=r.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=r.overscaling,this.pixelRatio=r.pixelRatio,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Mg,this.layoutVertexArray2=new ja,this.patternVertexArray=new ja,this.indexArray=new Mi,this.programConfigurations=new kl(r.layers,{zoom:r.zoom,lut:r.lut}),this.segments=new Vi,this.maxLineLength=0,this.zOffsetVertexArray=new ja,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.tessellationStep=r.tessellationStep?r.tessellationStep:zt/64,this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,s){}updateAppearances(r,s,u,d){}populate(r,s,u,d){this.hasPattern=gE("line",this.layers,this.pixelRatio,s);const g=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Ce(u);const y=this.layers[0].layout.get("line-elevation-reference");if(y==="hd-road-markup")this.elevationType="road";else{const R=this.layers[0].layout.get("line-z-offset"),L=R.isConstant()&&!R.constantOr(0);this.elevationType=y!=="sea"&&y!=="ground"&&L?"none":"offset",this.elevationType==="offset"&&y==="none"&&br(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const b=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&b!==void 0;const T=[];for(const{feature:R,id:L,index:z,sourceLayerIndex:W}of r){const J=this.layers[0]._featureFilter.needGeometry,ee=Ze(R,J);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),ee,u))continue;const oe=g?g.evaluate(ee,{},u):void 0,le={id:L,properties:R.properties,type:R.type,sourceLayerIndex:W,index:z,geometry:J?ee.geometry:ft(R,u,d),patterns:{},sortKey:oe};T.push(le)}g&&T.sort((R,L)=>R.sortKey-L.sortKey);const{lineAtlas:E,featureIndex:k}=s,j=this.addConstantDashes(E);for(const R of T){const{geometry:L,index:z,sourceLayerIndex:W}=R;if(j&&this.addFeatureDashes(R,E),this.hasPattern){const J=_E("line",this.layers,R,this.zoom,this.pixelRatio,s);this.patternFeatures.push(J)}else this.addFeature(R,L,z,u,E.positions,s.availableImages,s.brightness,s.elevationFeatures);k.insert(r[z].feature,L,z,W,this.index)}}addConstantDashes(r){let s=!1;for(const u of this.layers){const d=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if(d.kind!=="constant"||g.kind!=="constant")s=!0;else{const y=g.value,b=d.value;if(!b)continue;r.addDash(b,y)}}return s}addFeatureDashes(r,s){const u=this.zoom;for(const d of this.layers){const g=d.paint.get("line-dasharray").value,y=d.layout.get("line-cap").value;if(g.kind==="constant"&&y.kind==="constant")continue;let b,T;if(g.kind==="constant"){if(b=g.value,!b)continue}else b=g.evaluate({zoom:u},r);T=y.kind==="constant"?y.value:y.evaluate({zoom:u},r),s.addDash(b,T),r.patterns[d.id]=[s.getKey(b,T)]}}update(r,s,u,d,g,y,b,T){this.programConfigurations.updatePaintArrays(r,s,g,u,d,y,b,T)}addFeatures(r,s,u,d,g,y){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,s,u,d,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,oq)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=r.createVertexBuffer(this.patternVertexArray,lq)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,nq.members,!0)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,iq),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r,s){let u,d;if(s&&s>0?(u=`mapbox_clip_start_${s}`,d=`mapbox_clip_end_${s}`):(u="mapbox_clip_start",d="mapbox_clip_end"),r.properties&&r.properties.hasOwnProperty(u)&&r.properties.hasOwnProperty(d))return{start:+r.properties[u],end:+r.properties[d]}}addFeature(r,s,u,d,g,y,b,T){const E=this.layers[0].layout,k=E.get("line-join").evaluate(r,{}),j=E.get("line-cap").evaluate(r,{}),R=E.get("line-miter-limit"),L=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(r),this.lineFeature=r;const z=!(!r.properties||!r.properties.hasOwnProperty("mapbox_line_metrics"))&&r.properties.mapbox_line_metrics;this.zOffsetValue=E.get("line-z-offset").value;const W=this.layers[0].paint.get("line-width").value;if(W.kind!=="constant"&&W.isLineProgressConstant===!1&&(this.variableWidthValue=W),this.elevationType==="road"){const J=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(r,s,d,T,k,j,R,L)){const[ee,oe]=this.clipRuntimeLinesToTile(s,1);for(let le=0;le<ee.length;le++){const de=ee[le],Se=oe[le],_e={progress:{min:Se.progress.min,max:Se.progress.max},nextDir:this.computeSegNextDir(Se,de),prevDir:this.computeSegPrevDir(Se,de)};this.addLine(de,r,d,k,j,R,L,_e,z&&Se.parentIndex>0?Se.parentIndex:null)}this.fillNonElevatedRoadSegment(J)}}else for(let J=0;J<s.length;J++)this.addLine(s[J],r,d,k,j,R,L,void 0,z&&J>0?J:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,g,y,d,b,void 0,this.worldview)}computeSegNextDir(r,s){return r.nextPoint.sub(s.at(-2)).unit()}computeSegPrevDir(r,s){return s[1].sub(r.prevPoint).unit()}clipLinesToTile(r,s){return q1(r,-s,-s,zt+s,zt+s)}clipRuntimeLinesToTile(r,s){const u=[];return[q1(r,-s,-s,zt+s,zt+s,u),u]}addElevatedRoadFeature(r,s,u,d,g,y,b,T){const E=[],k=zr.getElevationFeature(r,d);if(k){const j=this.clipLinesToTile(s,1),R=this.prepareElevatedLines(j,k,u);for(const L of R)E.push({geometry:L,elevation:k,elevationTileID:u,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(E.length===0)return!1;for(const j of E){const R=this.layoutVertexArray.length;this.addLine(j.geometry,r,u,g,y,b,T);const L=new In(u,j.elevationTileID);if(j.elevation)for(let z=R;z<this.layoutVertexArray.length;z++){const W=new xt(this.layoutVertexArray.int16[6*z]>>1,this.layoutVertexArray.int16[6*z+1]>>1),J=L.pointElevation(W,j.elevation,.05);this.updateHeightRange(J),this.zOffsetVertexArray.emplaceBack(J,0,0)}else this.fillNonElevatedRoadSegment(R)}return!0}prepareElevatedLines(r,s,u){if(s.constantHeight!=null)return r;const d=[],g=1/Ce(u);for(const y of r)S8(y,new Ti(s,g),0,d);return d}fillNonElevatedRoadSegment(r){for(let s=r;s<this.layoutVertexArray.length;s++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(r){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,r),this.heightRange.max=Math.max(this.heightRange.max,r)):this.heightRange={min:r,max:r}}addLine(r,s,u,d,g,y,b,T,E){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=E?this.lineFeatureClips(s,E):this.lineClips;const k=d==="none";this.patternJoinNone=this.hasPattern&&k,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const j=T&&T.progress.min>0,R=T&&T.progress.max<1;if(this.lineClips){let De={min:this.lineClips.start,max:this.lineClips.end},at=1;if(T){const pt=this.lineClips.end-this.lineClips.start;De=function(bt,Ot,It){return{min:li(bt.min,Ot,It),max:li(bt.max,Ot,It)}}(T.progress,{min:0,max:1},De),pt>0&&(at=(De.max-De.min)/pt)}const Ue=+s.properties.mapbox_clip_feature_len,ct=+s.properties.mapbox_clip_seg_len;if(Number.isNaN(Ue)||Number.isNaN(ct)){for(let bt=0;bt<r.length-1;bt++)this.totalDistance+=r[bt].dist(r[bt+1]);const pt=this.totalDistance/(De.max-De.min);this.totalFeatureLength=Number.isFinite(pt)?pt:0,this.lineClips.start=De.min,this.lineClips.end=De.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ue,this.distance=ct*at,this.lineClips.start=De.min,this.lineClips.end=De.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const L=cq[s.type]==="Polygon";let z=r.length;for(;z>=2&&r[z-1].equals(r[z-2]);)z--;let W=0;for(;W<z-1&&r[W].equals(r[W+1]);)W++;if(z<(L?3:2))return;d==="bevel"&&(y=1.05);const J=this.segments.prepareSegment(10*z,this.layoutVertexArray,this.indexArray);let ee,oe,le,de,Se,_e,Ae,ke;T&&T.prevDir&&(_e=T.prevDir.perp()),T&&T.nextDir&&(Ae=T.nextDir.perp()),this.e1=this.e2=-1,L&&(ee=r[z-2],Se=r[W].sub(ee)._unit()._perp());for(let De=W;De<z;De++){if(le=De===z-1?L?r[W+1]:void 0:r[De+1],le&&r[De].equals(le))continue;Se&&(de=Se),ee&&(oe=ee),ee=r[De],ke=this.evaluateLineProgressFeatures(oe?oe.dist(ee):0),Se=le?le.sub(ee)._unit()._perp():de,de=de||Se;const at=oe&&le;let Ue=at?d:L||k?"butt":g;const ct=de.x*Se.x+de.y*Se.y;if(k){const Ke=function(St){if(St.patternJoinNone){const Mt=St.segmentPoints.length/2,vt=St.lineSoFar-St.segmentStart;for(let er=0;er<Mt;++er){const or=St.segmentPoints[2*er+1],Xt=Math.round(St.segmentPoints[2*er])+.5+.25*or;St.patternVertexArray.emplaceBack(Xt,vt,St.segmentStart),St.patternVertexArray.emplaceBack(Xt,vt,St.segmentStart)}St.segmentPoints.length=0}St.e1=St.e2=-1};if(at&&ct<dq){this.updateDistance(oe,ee),this.addCurrentVertex(ee,de,1,1,J,ke),Ke(this),this.addCurrentVertex(ee,Se,-1,-1,J,ke);continue}if(oe){if(!le){this.updateDistance(oe,ee),this.addCurrentVertex(ee,de,1,1,J,ke),Ke(this);continue}Ue="miter"}}let pt=de.add(Se);pt.x===0&&pt.y===0||pt._unit();const bt=pt.x*Se.x+pt.y*Se.y,Ot=bt!==0?1/bt:1/0,It=2*Math.sqrt(2-2*bt),gt=bt<uq&&oe&&le,At=de.x*Se.y-de.y*Se.x>0,nt=this.overscaling<=16?15*zt/(512*this.overscaling):0;if(at&&Ue==="round"){if(Ot<b)Ue="miter";else if(Ot<=2){const Ke=qE(ee,-10,zt+10);Ue=this.elevationType==="offset"&&(Ke||this.hasCrossSlope)?"miter":"fakeround"}}if(Ue==="miter"&&Ot>y&&(Ue="bevel"),Ue==="bevel"&&(Ot>2&&(Ue="flipbevel"),Ot<y&&(Ue="miter")),oe&&!(Ue==="miter"&&gt)&&this.updateDistance(oe,ee),Ue==="miter")if(gt){const Ke=ee.dist(oe);if(Ke>2*nt){const Mt=ee.sub(ee.sub(oe)._mult(nt/Ke)._round());this.updateDistance(oe,Mt),this.addCurrentVertex(Mt,de,0,0,J,ke),oe=Mt}this.updateDistance(oe,ee),pt._mult(Ot),this.addCurrentVertex(ee,pt,0,0,J,ke);const St=ee.dist(le);if(St>2*nt){const Mt=ee.add(le.sub(ee)._mult(nt/St)._round());this.updateDistance(ee,Mt),this.addCurrentVertex(Mt,Se,0,0,J,ke),ee=Mt}}else pt._mult(Ot),this.addCurrentVertex(ee,pt,0,0,J,ke);else if(Ue==="flipbevel"){if(Ot>100)pt=Se.mult(-1);else{const Ke=Ot*de.add(Se).mag()/de.sub(Se).mag();pt._perp()._mult(Ke*(At?-1:1))}this.addCurrentVertex(ee,pt,0,0,J,ke),this.addCurrentVertex(ee,pt.mult(-1),0,0,J,ke)}else if(Ue==="bevel"||Ue==="fakeround"){ke!=null&&oe&&this.addCurrentVertex(ee,Ae||de,-1,-1,J,ke);const Ke=ee.dist(oe)<=2*nt&&Ue!=="bevel",St=pt.mult(At?1:-1);St._mult(Ot);const Mt=Se.mult(At?-1:1),vt=de.mult(At?-1:1),er=this.evaluateLineProgressFeatures(this.distance);if(ke==null&&(this.addHalfVertex(ee,St.x,St.y,!1,!At,0,J,er),Ke||this.addHalfVertex(ee,St.x+2*vt.x,St.y+2*vt.y,!1,At,0,J,er)),Ue==="fakeround"){const or=Math.round(180*It/Math.PI/20);this.addHalfVertex(ee,vt.x,vt.y,!1,At,0,J,er);for(let Xt=0;Xt<or;Xt++){let $t=Xt/or;if($t!==.5){const Gt=$t-.5;$t+=$t*Gt*($t-1)*((1.0904+ct*(ct*(3.55645-1.43519*ct)-3.2452))*Gt*Gt+(.848013+ct*(.215638*ct-1.06021)))}const Fr=Mt.sub(vt)._mult($t)._add(vt)._unit();this.addHalfVertex(ee,Fr.x,Fr.y,!1,At,0,J,er)}this.addHalfVertex(ee,Mt.x,Mt.y,!1,At,0,J,er)}Ke||ke!=null||this.addHalfVertex(ee,St.x+2*Mt.x,St.y+2*Mt.y,!1,At,0,J,er),ke!=null&&le&&this.addCurrentVertex(ee,_e||Se,1,1,J,ke)}else if(Ue==="butt")this.addCurrentVertex(ee,pt,0,0,J,ke);else if(Ue==="square"){if(!oe){const Ke=j?0:-1;this.addCurrentVertex(ee,pt,Ke,Ke,J,ke)}if(this.addCurrentVertex(ee,pt,0,0,J,ke),oe){const Ke=R?0:1;this.addCurrentVertex(ee,pt,Ke,Ke,J,ke)}}else if(Ue==="round"){if(oe){const Ke=!at&&Ae?Ae:de;this.addCurrentVertex(ee,Ke,0,0,J,ke),!at&&R||this.addCurrentVertex(ee,Ke,1,1,J,ke,!0)}if(le){const Ke=!at&&_e?_e:Se;!at&&j||this.addCurrentVertex(ee,Ke,-1,-1,J,ke,!0),this.addCurrentVertex(ee,Ke,0,0,J,ke)}}}}addVerticesTo(r,s,u,d,g,y,b,T,E,k){const j=(s.w-r.w)/this.tessellationStep|0;let R=0;const L=this.scaledDistance;if(j>1){this.lineSoFar=r.w;const W=(s.x-r.x)/j,J=(s.y-r.y)/j,ee=(s.z-r.z)/j,oe=(s.w-r.w)/j;for(let le=1;le<j;++le){r.x+=W,r.y+=J,r.z+=ee,this.lineSoFar+=oe,R+=oe;const de=this.evaluateLineProgressFeatures(this.prevDistance+R);this.scaledDistance=(this.prevDistance+R)/this.totalDistance,this.addHalfVertex(r,u,d,k,!1,b,E,de),this.addHalfVertex(r,g,y,k,!0,-T,E,de)}}this.lineSoFar=s.w,this.scaledDistance=L;const z=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(s,u,d,k,!1,b,E,z),this.addHalfVertex(s,g,y,k,!0,-T,E,z)}evaluateLineProgressFeatures(r){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+r)/this.totalFeatureLength):br(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let s=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(s=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:s}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:s}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:s}}addCurrentVertex(r,s,u,d,g,y,b=!1){const T=s.x+s.y*u,E=s.y-s.x*u,k=s.y*d-s.x,j=-s.y-s.x*d;if(y!=null){const R=this.elevationType==="offset",L=-10,z=zt+10,W=y.zOffset,J=new GR(r.x,r.y,W,this.lineSoFar),ee=!!R&&qE(r,L,z),oe=this.lineSoFar,le=this.distance;if(this.currentVertex)if(ee){const de=this.currentVertexIsOutside,Se=this.currentVertex,_e=new GR(r.x,r.y,W,this.lineSoFar);if(HR(Se,_e,L,z),!qE(_e,L,z)){if(de){this.e1=this.e2=-1,this.distance-=Se.dist(J),this.lineSoFar=Se.w;const Ae=this.evaluateLineProgressFeatures(Se.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Se,T,E,b,!1,u,g,Ae),this.addHalfVertex(Se,k,j,b,!0,-d,g,Ae),this.prevDistance=this.distance}this.distance=this.prevDistance+Se.dist(_e),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Se,_e,T,E,k,j,u,d,g,b),this.distance=le,this.scaledDistance=this.distance/this.totalDistance}}else{const de=this.currentVertex;if(this.currentVertexIsOutside){HR(de,J,L,z),this.e1=this.e2=-1,this.distance-=de.dist(J),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=de.w;const Se=this.evaluateLineProgressFeatures(de.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(de,T,E,b,!1,u,g,Se),this.addHalfVertex(de,k,j,b,!0,-d,g,Se),this.prevDistance=this.distance,this.distance=le,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(de,J,T,E,k,j,u,d,g,b)}else ee||(this.addHalfVertex(r,T,E,b,!1,u,g,y),this.addHalfVertex(r,k,j,b,!0,-d,g,y));this.currentVertex=J,this.currentVertexIsOutside=ee,this.lineSoFar=oe}else this.addHalfVertex(r,T,E,b,!1,u,g,y),this.addHalfVertex(r,k,j,b,!0,-d,g,y)}addHalfVertex({x:r,y:s},u,d,g,y,b,T,E){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),y||this.segmentPoints.push(this.lineSoFar-this.segmentStart,b)),this.layoutVertexArray.emplaceBack((r<<1)+(g?1:0),(s<<1)+(y?1:0),Math.round(63*u)+128,Math.round(63*d)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const j=Rr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,j)}const k=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),T.primitiveLength++),y?this.e2=k:this.e1=k,E!=null&&this.zOffsetVertexArray.emplaceBack(E.zOffset,E.variableWidth,E.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(r,s){this.prevDistance=this.distance,this.distance+=r.dist(s),this.updateScaledDistance()}}function qE(a,r,s){return a.x<r||a.x>s||a.y<r||a.y>s}let EM,CM;function AM(a,r,s){return r*(zt/(a.tileSize*Math.pow(2,s-a.tileID.overscaledZ)))}rr($E,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const IM=(a,r,s)=>(1-s)*a+s*r;function PM(a,r){return 1/AM(a,1,r.tileZoom)}function kM(a,r,s,u){return a.translatePosMatrix(u||r.tileID.projMatrix,r,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const jM=a=>{const r=[];RM(a)&&r.push("RENDER_LINE_DASH"),a.paint.get("line-gradient")&&r.push("RENDER_LINE_GRADIENT");const s=a.paint.get("line-trim-offset");s[0]===0&&s[1]===0||r.push("RENDER_LINE_TRIM_OFFSET"),a.paint.get("line-border-width").constantOr(1)!==0&&r.push("RENDER_LINE_BORDER");const u=a.layout.get("line-join").constantOr("miter")==="none",d=!!a.paint.get("line-pattern").constantOr(1);return u&&d&&r.push("LINE_JOIN_NONE"),r};function RM(a){const r=a.paint.get("line-dasharray").value;return r.kind!=="constant"||r.value}let GE;const MM=()=>GE||(GE={layout:EM||(EM=new Ki({"line-cap":new Ht(Ve.layout_line["line-cap"]),"line-join":new Ht(Ve.layout_line["line-join"]),"line-miter-limit":new jt(Ve.layout_line["line-miter-limit"]),"line-round-limit":new jt(Ve.layout_line["line-round-limit"]),"line-sort-key":new Ht(Ve.layout_line["line-sort-key"]),"line-z-offset":new Ht(Ve.layout_line["line-z-offset"]),"line-elevation-reference":new jt(Ve.layout_line["line-elevation-reference"]),"line-cross-slope":new jt(Ve.layout_line["line-cross-slope"]),visibility:new jt(Ve.layout_line.visibility),"line-width-unit":new jt(Ve.layout_line["line-width-unit"])})),paint:CM||(CM=new Ki({"line-opacity":new Ht(Ve.paint_line["line-opacity"]),"line-color":new Ht(Ve.paint_line["line-color"]),"line-translate":new jt(Ve.paint_line["line-translate"]),"line-translate-anchor":new jt(Ve.paint_line["line-translate-anchor"]),"line-width":new Ht(Ve.paint_line["line-width"]),"line-gap-width":new Ht(Ve.paint_line["line-gap-width"]),"line-offset":new Ht(Ve.paint_line["line-offset"]),"line-blur":new Ht(Ve.paint_line["line-blur"]),"line-dasharray":new Ht(Ve.paint_line["line-dasharray"]),"line-pattern":new Ht(Ve.paint_line["line-pattern"]),"line-pattern-cross-fade":new jt(Ve.paint_line["line-pattern-cross-fade"]),"line-gradient":new Sh(Ve.paint_line["line-gradient"]),"line-trim-offset":new jt(Ve.paint_line["line-trim-offset"]),"line-trim-fade-range":new jt(Ve.paint_line["line-trim-fade-range"]),"line-trim-color":new jt(Ve.paint_line["line-trim-color"]),"line-emissive-strength":new jt(Ve.paint_line["line-emissive-strength"]),"line-border-width":new Ht(Ve.paint_line["line-border-width"]),"line-border-color":new Ht(Ve.paint_line["line-border-color"]),"line-occlusion-opacity":new jt(Ve.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},GE);class hq extends Ht{possiblyEvaluate(r,s){return s=new wi(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,transition:s.transition,worldview:s.worldview}),super.possiblyEvaluate(r,s)}evaluate(r,s,u,d){return s=Object.assign({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(r,s,u,d)}}let Ex;function DM(a,r){return r>0?r+2*a:a}const fq=fn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),pq=fn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),mq=fn([{name:"a_projected_pos",components:4,type:"Float32"}],4);fn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const gq=fn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),_q=fn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),yq=fn([{name:"a_texb",components:2,type:"Uint16"}]),vq=fn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),xq=fn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);fn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const NM=fn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),bq=fn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);fn([{name:"triangle",components:3,type:"Uint16"}]),fn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),fn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),fn([{type:"Float32",name:"offsetX"}]),fn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var oo=24;function wq(a,r,s){return a.sections.forEach(u=>{u.text=function(d,g,y){const b=g.layout.get("text-transform").evaluate(y,{});return b==="uppercase"?d=d.toLocaleUpperCase():b==="lowercase"&&(d=d.toLocaleLowerCase()),ma.applyArabicShaping&&(d=ma.applyArabicShaping(d)),d}(u.text,r,s)}),a}const Cx={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Sq(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}function Tq(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}const WE=4294967296,OM=1/WE,LM=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let tw=class{constructor(a=new Uint8Array(16)){this.buf=ArrayBuffer.isView(a)?a:new Uint8Array(a),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(a,r,s=this.length){for(;this.pos<s;){const u=this.readVarint(),d=u>>3,g=this.pos;this.type=7&u,a(d,r,this),this.pos===g&&this.skip(u)}return r}readMessage(a,r){return this.readFields(a,r,this.readVarint()+this.pos)}readFixed32(){const a=this.dataView.getUint32(this.pos,!0);return this.pos+=4,a}readSFixed32(){const a=this.dataView.getInt32(this.pos,!0);return this.pos+=4,a}readFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*WE;return this.pos+=8,a}readSFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*WE;return this.pos+=8,a}readFloat(){const a=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,a}readDouble(){const a=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,a}readVarint(a){const r=this.buf;let s,u;return u=r[this.pos++],s=127&u,u<128?s:(u=r[this.pos++],s|=(127&u)<<7,u<128?s:(u=r[this.pos++],s|=(127&u)<<14,u<128?s:(u=r[this.pos++],s|=(127&u)<<21,u<128?s:(u=r[this.pos],s|=(15&u)<<28,function(d,g,y){const b=y.buf;let T,E;if(E=b[y.pos++],T=(112&E)>>4,E<128||(E=b[y.pos++],T|=(127&E)<<3,E<128)||(E=b[y.pos++],T|=(127&E)<<10,E<128)||(E=b[y.pos++],T|=(127&E)<<17,E<128)||(E=b[y.pos++],T|=(127&E)<<24,E<128)||(E=b[y.pos++],T|=(1&E)<<31,E<128))return e_(d,T,g);throw new Error("Expected varint not more than 10 bytes")}(s,a,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const a=this.readVarint();return a%2==1?(a+1)/-2:a/2}readBoolean(){return!!this.readVarint()}readString(){const a=this.readVarint()+this.pos,r=this.pos;return this.pos=a,a-r>=12&&LM?LM.decode(this.buf.subarray(r,a)):function(s,u,d){let g="",y=u;for(;y<d;){const b=s[y];let T,E,k,j=null,R=b>239?4:b>223?3:b>191?2:1;if(y+R>d)break;R===1?b<128&&(j=b):R===2?(T=s[y+1],(192&T)==128&&(j=(31&b)<<6|63&T,j<=127&&(j=null))):R===3?(T=s[y+1],E=s[y+2],(192&T)==128&&(192&E)==128&&(j=(15&b)<<12|(63&T)<<6|63&E,(j<=2047||j>=55296&&j<=57343)&&(j=null))):R===4&&(T=s[y+1],E=s[y+2],k=s[y+3],(192&T)==128&&(192&E)==128&&(192&k)==128&&(j=(15&b)<<18|(63&T)<<12|(63&E)<<6|63&k,(j<=65535||j>=1114112)&&(j=null))),j===null?(j=65533,R=1):j>65535&&(j-=65536,g+=String.fromCharCode(j>>>10&1023|55296),j=56320|1023&j),g+=String.fromCharCode(j),y+=R}return g}(this.buf,r,a)}readBytes(){const a=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,a);return this.pos=a,r}readPackedVarint(a=[],r){const s=this.readPackedEnd();for(;this.pos<s;)a.push(this.readVarint(r));return a}readPackedSVarint(a=[]){const r=this.readPackedEnd();for(;this.pos<r;)a.push(this.readSVarint());return a}readPackedBoolean(a=[]){const r=this.readPackedEnd();for(;this.pos<r;)a.push(this.readBoolean());return a}readPackedFloat(a=[]){const r=this.readPackedEnd();for(;this.pos<r;)a.push(this.readFloat());return a}readPackedDouble(a=[]){const r=this.readPackedEnd();for(;this.pos<r;)a.push(this.readDouble());return a}readPackedFixed32(a=[]){const r=this.readPackedEnd();for(;this.pos<r;)a.push(this.readFixed32());return a}readPackedSFixed32(a=[]){const r=this.readPackedEnd();for(;this.pos<r;)a.push(this.readSFixed32());return a}readPackedFixed64(a=[]){const r=this.readPackedEnd();for(;this.pos<r;)a.push(this.readFixed64());return a}readPackedSFixed64(a=[]){const r=this.readPackedEnd();for(;this.pos<r;)a.push(this.readSFixed64());return a}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(a){const r=7&a;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(a,r){this.writeVarint(a<<3|r)}realloc(a){let r=this.length||16;for(;r<this.pos+a;)r*=2;if(r!==this.length){const s=new Uint8Array(r);s.set(this.buf),this.buf=s,this.dataView=new DataView(s.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeSFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*OM),!0),this.pos+=8}writeSFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*OM),!0),this.pos+=8}writeVarint(a){(a=+a||0)>268435455||a<0?function(r,s){let u,d;if(r>=0?(u=r%4294967296|0,d=r/4294967296|0):(u=~(-r%4294967296),d=~(-r/4294967296),4294967295^u?u=u+1|0:(u=0,d=d+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(g,y,b){b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,b.buf[b.pos]=127&(g>>>=7)}(u,0,s),function(g,y){const b=(7&g)<<4;y.buf[y.pos++]|=b|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(d,s)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))}writeSVarint(a){this.writeVarint(a<0?2*-a-1:2*a)}writeBoolean(a){this.writeVarint(+a)}writeString(a){a=String(a),this.realloc(4*a.length),this.pos++;const r=this.pos;this.pos=function(u,d,g){for(let y,b,T=0;T<d.length;T++){if(y=d.charCodeAt(T),y>55295&&y<57344){if(!b){y>56319||T+1===d.length?(u[g++]=239,u[g++]=191,u[g++]=189):b=y;continue}if(y<56320){u[g++]=239,u[g++]=191,u[g++]=189,b=y;continue}y=b-55296<<10|y-56320|65536,b=null}else b&&(u[g++]=239,u[g++]=191,u[g++]=189,b=null);y<128?u[g++]=y:(y<2048?u[g++]=y>>6|192:(y<65536?u[g++]=y>>12|224:(u[g++]=y>>18|240,u[g++]=y>>12&63|128),u[g++]=y>>6&63|128),u[g++]=63&y|128)}return g}(this.buf,a,this.pos);const s=this.pos-r;s>=128&&zM(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s}writeFloat(a){this.realloc(4),this.dataView.setFloat32(this.pos,a,!0),this.pos+=4}writeDouble(a){this.realloc(8),this.dataView.setFloat64(this.pos,a,!0),this.pos+=8}writeBytes(a){const r=a.length;this.writeVarint(r),this.realloc(r);for(let s=0;s<r;s++)this.buf[this.pos++]=a[s]}writeRawMessage(a,r){this.pos++;const s=this.pos;a(r,this);const u=this.pos-s;u>=128&&zM(s,u,this),this.pos=s-1,this.writeVarint(u),this.pos+=u}writeMessage(a,r,s){this.writeTag(a,2),this.writeRawMessage(r,s)}writePackedVarint(a,r){r.length&&this.writeMessage(a,Eq,r)}writePackedSVarint(a,r){r.length&&this.writeMessage(a,Cq,r)}writePackedBoolean(a,r){r.length&&this.writeMessage(a,Pq,r)}writePackedFloat(a,r){r.length&&this.writeMessage(a,Aq,r)}writePackedDouble(a,r){r.length&&this.writeMessage(a,Iq,r)}writePackedFixed32(a,r){r.length&&this.writeMessage(a,kq,r)}writePackedSFixed32(a,r){r.length&&this.writeMessage(a,jq,r)}writePackedFixed64(a,r){r.length&&this.writeMessage(a,Rq,r)}writePackedSFixed64(a,r){r.length&&this.writeMessage(a,Mq,r)}writeBytesField(a,r){this.writeTag(a,2),this.writeBytes(r)}writeFixed32Field(a,r){this.writeTag(a,5),this.writeFixed32(r)}writeSFixed32Field(a,r){this.writeTag(a,5),this.writeSFixed32(r)}writeFixed64Field(a,r){this.writeTag(a,1),this.writeFixed64(r)}writeSFixed64Field(a,r){this.writeTag(a,1),this.writeSFixed64(r)}writeVarintField(a,r){this.writeTag(a,0),this.writeVarint(r)}writeSVarintField(a,r){this.writeTag(a,0),this.writeSVarint(r)}writeStringField(a,r){this.writeTag(a,2),this.writeString(r)}writeFloatField(a,r){this.writeTag(a,5),this.writeFloat(r)}writeDoubleField(a,r){this.writeTag(a,1),this.writeDouble(r)}writeBooleanField(a,r){this.writeVarintField(a,+r)}};function e_(a,r,s){return s?4294967296*r+(a>>>0):4294967296*(r>>>0)+(a>>>0)}function zM(a,r,s){const u=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));s.realloc(u);for(let d=s.pos-1;d>=a;d--)s.buf[d+u]=s.buf[d]}function Eq(a,r){for(let s=0;s<a.length;s++)r.writeVarint(a[s])}function Cq(a,r){for(let s=0;s<a.length;s++)r.writeSVarint(a[s])}function Aq(a,r){for(let s=0;s<a.length;s++)r.writeFloat(a[s])}function Iq(a,r){for(let s=0;s<a.length;s++)r.writeDouble(a[s])}function Pq(a,r){for(let s=0;s<a.length;s++)r.writeBoolean(a[s])}function kq(a,r){for(let s=0;s<a.length;s++)r.writeFixed32(a[s])}function jq(a,r){for(let s=0;s<a.length;s++)r.writeSFixed32(a[s])}function Rq(a,r){for(let s=0;s<a.length;s++)r.writeFixed64(a[s])}function Mq(a,r){for(let s=0;s<a.length;s++)r.writeSFixed64(a[s])}const HE=3;function Dq(a,r,s){r.glyphs=[],a===1&&s.readMessage(Nq,r)}function Nq(a,r,s){if(a===3){const{id:u,bitmap:d,width:g,height:y,left:b,top:T,advance:E}=s.readMessage(Oq,{});r.glyphs.push({id:u,bitmap:new Fh({width:g+2*HE,height:y+2*HE},d),metrics:{width:g,height:y,left:b,top:T,advance:E}})}else a===4?r.ascender=s.readSVarint():a===5&&(r.descender=s.readSVarint())}function Oq(a,r,s){a===1?r.id=s.readVarint():a===2?r.bitmap=s.readBytes():a===3?r.width=s.readVarint():a===4?r.height=s.readVarint():a===5?r.left=s.readSVarint():a===6?r.top=s.readSVarint():a===7&&(r.advance=s.readVarint())}const FM=HE,za={horizontal:1,vertical:2,horizontalOnly:3};class Ax{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(r,s){const u=new Ax;return u.scale=r||1,u.fontStack=s,u}static forImage(r){const s=new Ax;return s.image=r,s}}class t_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,s,u){const d=new t_;for(let g=0;g<r.sections.length;g++){const y=r.sections[g];y.image?d.addImageSection(y,u):d.addTextSection(y,s)}return d}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCodePoint(r){return this.text.codePointAt(r)}verticalizePunctuation(r){this.text=function(s,u){let d="";for(let g=0;g<s.length;g++){const y=s.charCodeAt(g+1)||null,b=s.charCodeAt(g-1)||null;d+=!u&&(y&&jv(y)&&!Cx[s[g+1]]||b&&jv(b)&&!Cx[s[g-1]])||!Cx[s[g]]?s[g]:Cx[s[g]]}return d}(this.text,r)}trim(){let r=0;for(let u=0;u<this.text.length&&rw[this.text.charCodeAt(u)];u++)r++;let s=this.text.length;for(let u=this.text.length-1;u>=0&&u>=r&&rw[this.text.charCodeAt(u)];u--)s--;this.text=this.text.substring(r,s),this.sectionIndex=this.sectionIndex.slice(r,s)}substring(r,s){const u=new t_;return u.text=this.text.substring(r,s),u.sectionIndex=this.sectionIndex.slice(r,s),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,s)=>Math.max(r,this.sections[s].scale),0)}addTextSection(r,s){this.text+=r.text,this.sections.push(Ax.forText(r.scale,r.fontStack||s));const u=this.sections.length-1;for(let d=0;d<r.text.length;++d)this.sectionIndex.push(u)}addImageSection(r,s){const u=r.image?r.image.getPrimary():null;if(!u)return void br("Can't add FormattedSection with an empty image.");u.scaleSelf(s);const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCodePoint(d),this.sections.push(Ax.forImage(u)),this.sectionIndex.push(this.sections.length-1)):br("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ZE(a,r,s,u,d,g,y,b,T,E,k,j,R,L,z,W=1){const J=t_.fromFeature(a,d,W);j===za.vertical&&J.verticalizePunctuation(R);let ee=[];const oe=function(Ae,ke,De,at,Ue,ct){if(!Ae)return[];const pt=[],bt=function(At,nt,Ke,St,Mt,vt){let er=0;for(let or=0;or<At.length();or++){const Xt=At.getSection(or);er+=BM(At.getCodePoint(or),Xt,St,Mt,nt,vt)}return er/Math.max(1,Math.ceil(er/Ke))}(Ae,ke,De,at,Ue,ct),Ot=Ae.text.indexOf("")>=0;let It=0;for(let At=0;At<Ae.length();At++){const nt=Ae.getSection(At),Ke=Ae.getCodePoint(At);if(rw[Ke]||(It+=BM(Ke,nt,at,Ue,ke,ct)),At<Ae.length()-1){const St=!((gt=Ke)<11904||!(Sr["Bopomofo Extended"](gt)||Sr.Bopomofo(gt)||Sr["CJK Compatibility Forms"](gt)||Sr["CJK Compatibility Ideographs"](gt)||Sr["CJK Compatibility"](gt)||Sr["CJK Radicals Supplement"](gt)||Sr["CJK Strokes"](gt)||Sr["CJK Symbols and Punctuation"](gt)||Sr["CJK Unified Ideographs Extension A"](gt)||Sr["CJK Unified Ideographs"](gt)||Sr["Enclosed CJK Letters and Months"](gt)||Sr["Halfwidth and Fullwidth Forms"](gt)||Sr.Hiragana(gt)||Sr["Ideographic Description Characters"](gt)||Sr["Kangxi Radicals"](gt)||Sr["Katakana Phonetic Extensions"](gt)||Sr.Katakana(gt)||Sr["Vertical Forms"](gt)||Sr["Yi Radicals"](gt)||Sr["Yi Syllables"](gt)));(Lq[Ke]||St||nt.image)&&pt.push(UM(At+1,It,bt,pt,zq(Ke,Ae.getCodePoint(At+1),St&&Ot),!1))}}var gt;return $M(UM(Ae.length(),It,bt,pt,0,!0))}(J,E,g,r,u,L),{processBidirectionalText:le,processStyledBidirectionalText:de}=ma;if(le&&J.sections.length===1){const Ae=le(J.toString(),oe);for(const ke of Ae){const De=new t_;De.text=ke,De.sections=J.sections;for(let at=0;at<ke.length;at++)De.sectionIndex.push(0);ee.push(De)}}else if(de){const Ae=de(J.text,J.sectionIndex,oe);for(const ke of Ae){const De=new t_;De.text=ke[0],De.sectionIndex=ke[1],De.sections=J.sections,ee.push(De)}}else ee=function(Ae,ke){const De=[],at=Ae.text;let Ue=0;for(const ct of ke)De.push(Ae.substring(Ue,ct)),Ue=ct;return Ue<at.length&&De.push(Ae.substring(Ue,at.length)),De}(J,oe);const Se=[],_e={positionedLines:Se,text:J.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:j,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Ae,ke,De,at,Ue,ct,pt,bt,Ot,It,gt,At){let nt=0,Ke=0,St=0;const Mt=bt==="right"?1:bt==="left"?0:.5;let vt=!1;for(const Gt of Ue){const vr=Gt.getSections();for(const $r of vr){if($r.image)continue;const nn=ke[$r.fontStack];if(nn&&(vt=nn.ascender!==void 0&&nn.descender!==void 0,!vt))break}if(!vt)break}let er=0;for(const Gt of Ue){Gt.trim();const vr=Gt.getMaxScale(),$r=(vr-1)*oo,nn={positionedGlyphs:[],lineOffset:0};Ae.positionedLines[er]=nn;const Pn=nn.positionedGlyphs;let Gr=0;if(!Gt.length()){Ke+=ct,++er;continue}let zn=0,Fn=0;for(let ye=0;ye<Gt.length();ye++){const pe=Gt.getSection(ye),ut=Gt.getSectionIndex(ye),Ut=Gt.getCodePoint(ye);let dt=pe.scale,qt=null,hr=null,ur=null,Hr=oo,Ir=0,lr=Ot;lr===za.vertical&&((or=Ut)===12312||or===12313||or===12316||or===12540||or===12448)&&(lr=za.horizontal);const On=!(lr===za.horizontal||!gt&&!Ig(Ut)||gt&&(rw[Ut]||Rv(Ut)));if(pe.image){const ci=at.get(pe.image.toString());if(!ci)continue;ur=pe.image,Ae.iconsInText=Ae.iconsInText||!0,hr=ci.paddedRect;const jr=ci.displaySize;dt=dt*oo/At,qt={width:jr[0],height:jr[1],left:0,top:-FM,advance:On?jr[1]:jr[0],localGlyph:!1},Ir=vt?-qt.height*dt:vr*oo-17-jr[1]*dt,Hr=qt.advance;const An=(On?jr[0]:jr[1])*dt-oo*vr;An>0&&An>Gr&&(Gr=An)}else{const ci=De[pe.fontStack];if(!ci)continue;ci[Ut]&&(hr=ci[Ut]);const jr=ke[pe.fontStack];if(!jr)continue;const An=jr.glyphs[Ut];if(!An)continue;if(qt=An.metrics,Hr=Ut!==8203?oo:0,vt){const ui=jr.ascender!==void 0?Math.abs(jr.ascender):0,Jn=jr.descender!==void 0?Math.abs(jr.descender):0,Zi=(ui+Jn)*dt;zn<Zi&&(zn=Zi,Fn=(ui-Jn)/2*dt),Ir=-ui*dt}else Ir=(vr-dt)*oo-17}On?(Ae.verticalizable=!0,Pn.push({glyph:Ut,image:ur,x:nt,y:Ke+Ir,vertical:On,scale:dt,localGlyph:qt.localGlyph,fontStack:pe.fontStack,sectionIndex:ut,metrics:qt,rect:hr}),nt+=Hr*dt+It):(Pn.push({glyph:Ut,image:ur,x:nt,y:Ke+Ir,vertical:On,scale:dt,localGlyph:qt.localGlyph,fontStack:pe.fontStack,sectionIndex:ut,metrics:qt,rect:hr}),nt+=qt.advance*dt+It)}Pn.length!==0&&(St=Math.max(nt-It,St),vt?qM(Pn,Mt,Gr,Fn,ct*vr/2):qM(Pn,Mt,Gr,0,ct/2)),nt=0;const Li=ct*vr+Gr;nn.lineOffset=Math.max(Gr,$r),Ke+=Li,++er}var or;const Xt=Ke,{horizontalAlign:$t,verticalAlign:Fr}=XE(pt);(function(Gt,vr,$r,nn,Pn,Gr){const zn=(vr-$r)*Pn,Fn=-Gr*nn;for(const Li of Gt)for(const ye of Li.positionedGlyphs)ye.x+=zn,ye.y+=Fn})(Ae.positionedLines,Mt,$t,Fr,St,Xt),Ae.top+=-Fr*Xt,Ae.bottom=Ae.top+Xt,Ae.left+=-$t*St,Ae.right=Ae.left+St,Ae.hasBaseline=vt}(_e,r,s,u,ee,y,b,T,j,E,R,z),!function(Ae){for(const ke of Ae)if(ke.positionedGlyphs.length!==0)return!1;return!0}(Se))return _e}const rw={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Lq={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function BM(a,r,s,u,d,g){if(r.image){const y=u.get(r.image.toString());return y?y.displaySize[0]*r.scale*oo/g+d:0}{const y=s[r.fontStack],b=y&&y.glyphs[a];return b?b.metrics.advance*r.scale+d:0}}function VM(a,r,s,u){const d=Math.pow(a-r,2);return u?a<r?d/2:2*d:d+Math.abs(s)*s}function zq(a,r,s){let u=0;return a===10&&(u-=1e4),s&&(u+=150),a!==40&&a!==65288||(u+=50),r!==41&&r!==65289||(u+=50),u}function UM(a,r,s,u,d,g){let y=null,b=VM(r,s,d,g);for(const T of u){const E=VM(r-T.x,s,d,g)+T.badness;E<=b&&(y=T,b=E)}return{index:a,x:r,priorBreak:y,badness:b}}function $M(a){return a?$M(a.priorBreak).concat(a.index):[]}function XE(a){let r=.5,s=.5;switch(a){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:r,verticalAlign:s}}function qM(a,r,s,u,d){if(!(r||s||u||d))return;const g=a.length-1,y=a[g],b=(y.x+y.metrics.advance*y.scale)*r;for(let T=0;T<=g;T++)a[T].x-=b,a[T].y+=s+u+d}function GM(a){return a.imagePrimary!==void 0&&a.top!==void 0&&a.bottom!==void 0&&a.left!==void 0&&a.right!==void 0}function nw(a,r,s,u){const{horizontalAlign:d,verticalAlign:g}=XE(u),y=s[0]-a.displaySize[0]*d,b=s[1]-a.displaySize[1]*g;return{imagePrimary:a,imageSecondary:r,top:b,bottom:b+a.displaySize[1],left:y,right:y+a.displaySize[0]}}function KE(a,r,s,u,d,g){const y=a.imagePrimary;let b;if(y.content){const J=y.content,ee=y.pixelRatio||1;b=[J[0]/ee,J[1]/ee,y.displaySize[0]-J[2]/ee,y.displaySize[1]-J[3]/ee]}const T=r.left*g,E=r.right*g;let k,j,R,L;s==="width"||s==="both"?(L=d[0]+T-u[3],j=d[0]+E+u[1]):(L=d[0]+(T+E-y.displaySize[0])/2,j=L+y.displaySize[0]);const z=r.top*g,W=r.bottom*g;return s==="height"||s==="both"?(k=d[1]+z-u[0],R=d[1]+W+u[2]):(k=d[1]+(z+W-y.displaySize[1])/2,R=k+y.displaySize[1]),{imagePrimary:y,imageSecondary:void 0,top:k,right:j,bottom:R,left:L,collisionPadding:b}}function WM(a){return!a.imagePrimary.stretchX}function HM(a){return!a.imagePrimary.stretchY}function ZM(a){return{width:a.right-a.left,height:a.bottom-a.top}}const jc=128;function r_(a,r,s){const{expression:u}=r;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new wi(a+1,{worldview:s}))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:g}=u;let y=0;for(;y<d.length&&d[y]<=a;)y++;y=Math.max(0,y-1);let b=y;for(;b<d.length&&d[b]<a+1;)b++;b=Math.min(d.length-1,b);const T=d[y],E=d[b];return u.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:E,interpolationType:g}:{kind:"camera",minZoom:T,maxZoom:E,minSize:u.evaluate(new wi(T,{worldview:s})),maxSize:u.evaluate(new wi(E,{worldview:s})),interpolationType:g}}}function YE(a,{uSize:r,uSizeT:s},{lowerSize:u,upperSize:d}){return a.kind==="source"?u/jc:a.kind==="composite"?Rr(u/jc,d/jc,s):r}function n_(a,r,s=1){let u=0,d=0;if(a.kind==="constant")d=a.layoutSize*s;else if(a.kind!=="source"){const{interpolationType:g,minZoom:y,maxZoom:b}=a,T=g?ie(Pa.interpolationFactor(g,r,y,b),0,1):0;a.kind==="camera"?d=Rr(a.minSize,a.maxSize,T)*s:u=T*s}return{uSizeT:u,uSize:d}}class xd extends xt{constructor(r,s,u,d,g){super(r,s),this.angle=d,this.z=u,g!==void 0&&(this.segment=g)}clone(){return new xd(this.x,this.y,this.z,this.angle,this.segment)}}function XM(a,r,s,u,d){if(r.segment===void 0)return!0;let g=r,y=r.segment+1,b=0;for(;b>-s/2;){if(y--,y<0)return!1;b-=a[y].dist(g),g=a[y]}b+=a[y].dist(a[y+1]),y++;const T=[];let E=0;for(;b<s/2;){const k=a[y],j=a[y+1];if(!j)return!1;let R=a[y-1].angleTo(k)-k.angleTo(j);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:b,angleDelta:R}),E+=R;b-T[0].distance>u;)E-=T.shift().angleDelta;if(E>d)return!1;y++,b+=k.dist(j)}return!0}function KM(a){let r=0;for(let s=0;s<a.length-1;s++)r+=a[s].dist(a[s+1]);return r}function YM(a,r,s){return a?.6*r*s:0}function JM(a,r){return Math.max(a?a.right-a.left:0,r?r.right-r.left:0)}function Fq(a,r,s,u,d,g){const y=YM(s,d,g),b=JM(s,u)*g;let T=0;const E=KM(a)/2;for(let k=0;k<a.length-1;k++){const j=a[k],R=a[k+1],L=j.dist(R);if(T+L>E){const z=(E-T)/L,W=Rr(j.x,R.x,z),J=Rr(j.y,R.y,z),ee=new xd(W,J,0,R.angleTo(j),k);return!y||XM(a,ee,b,y,r)?ee:void 0}T+=L}}function Bq(a,r,s,u,d,g,y,b,T){const E=YM(u,g,y),k=JM(u,d),j=k*y,R=a[0].x===0||a[0].x===T||a[0].y===0||a[0].y===T;return r-j<r/4&&(r=j+r/4),QM(a,R?r/2*b%r:(k/2+2*g)*y*b%r,r,E,s,j,R,!1,T)}function QM(a,r,s,u,d,g,y,b,T){const E=g/2,k=KM(a);let j=0,R=r-s,L=[];for(let z=0;z<a.length-1;z++){const W=a[z],J=a[z+1],ee=W.dist(J),oe=J.angleTo(W);for(;R+s<j+ee;){R+=s;const le=(R-j)/ee,de=Rr(W.x,J.x,le),Se=Rr(W.y,J.y,le);if(de>=0&&de<T&&Se>=0&&Se<T&&R-E>=0&&R+E<=k){const _e=new xd(de,Se,0,oe,z);u&&!XM(a,_e,g,u,d)||L.push(_e)}}j+=ee}return b||L.length||y||(L=QM(a,j/2,s,u,d,g,y,!0,T)),L}function eD(a){let r=0,s=0;for(const y of a)r+=y.w*y.h,s=Math.max(s,y.w);a.sort((y,b)=>b.h-y.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),s),h:1/0}];let d=0,g=0;for(const y of a)for(let b=u.length-1;b>=0;b--){const T=u[b];if(!(y.w>T.w||y.h>T.h)){if(y.x=T.x,y.y=T.y,g=Math.max(g,y.y+y.h),d=Math.max(d,y.x+y.w),y.w===T.w&&y.h===T.h){const E=u.pop();E&&b<u.length&&(u[b]=E)}else y.h===T.h?(T.x+=y.w,T.w-=y.w):y.w===T.w?(T.y+=y.h,T.h-=y.h):(u.push({x:T.x+y.w,y:T.y,w:T.w-y.w,h:y.h}),T.y+=y.h,T.h-=y.h);break}}return{w:d,h:g,fill:r/(d*g)||0}}rr(xd,"Anchor");const Gp=1;class Ix{static getImagePositionScale(r,s,u){if(s&&r&&r.options&&r.options.transform){const d=r.options.transform;return{x:d.a,y:d.d}}return{x:u,y:u}}constructor(r,s,u,d){this.paddedRect=r;const{pixelRatio:g,version:y,stretchX:b,stretchY:T,content:E,sdf:k,usvg:j}=s;this.pixelRatio=g,this.stretchX=b,this.stretchY=T,this.content=E,this.version=y,this.padding=u,this.sdf=k,this.usvg=j,this.scale=Ix.getImagePositionScale(d,j,g)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function JE(a,r,s){const u=xc.parse(a),d=function(g,y,b=[1,1]){return{x:0,y:0,w:(g.data?g.data.width:g.width*b[0])+2*y,h:(g.data?g.data.height:g.height*b[1])+2*y}}(r,s,[u.options.transform.a,u.options.transform.d]);return{bin:d,imagePosition:new Ix(d,r,s,u),imageVariant:u}}class tD{constructor(r,s,u){const d=new Map,g=new Map;this.haveRenderCallbacks=[];const y=[];this.addImages(r,d,Gp,y),this.addImages(s,g,2,y);const{w:b,h:T}=eD(y),E=new Eo({width:b||1,height:T||1});for(const[k,j]of r.entries()){const R=d.get(k).paddedRect;Eo.copy(j.data,E,{x:0,y:0},{x:R.x+Gp,y:R.y+Gp},j.data,null,j.sdf)}for(const[k,j]of s.entries()){const R=g.get(k),L=R.paddedRect;let z=R.padding;const W=L.x+z,J=L.y+z,ee=j.data.width,oe=j.data.height;z=z>1?z-1:z,Eo.copy(j.data,E,{x:0,y:0},{x:W,y:J},j.data,u),Eo.copy(j.data,E,{x:0,y:oe-z},{x:W,y:J-z},{width:ee,height:z},u),Eo.copy(j.data,E,{x:0,y:0},{x:W,y:J+oe},{width:ee,height:z},u),Eo.copy(j.data,E,{x:ee-z,y:0},{x:W-z,y:J},{width:z,height:oe},u),Eo.copy(j.data,E,{x:0,y:0},{x:W+ee,y:J},{width:z,height:oe},u),Eo.copy(j.data,E,{x:ee-z,y:oe-z},{x:W-z,y:J-z},{width:z,height:z},u),Eo.copy(j.data,E,{x:0,y:oe-z},{x:W+ee,y:J-z},{width:z,height:z},u),Eo.copy(j.data,E,{x:0,y:0},{x:W+ee,y:J+oe},{width:z,height:z},u),Eo.copy(j.data,E,{x:ee-z,y:0},{x:W-z,y:J+oe},{width:z,height:z},u)}this.lut=u,this.image=E,this.iconPositions=d,this.patternPositions=g}addImages(r,s,u,d){for(const[g,y]of r.entries()){const{bin:b,imagePosition:T,imageVariant:E}=JE(g,y,u);s.set(g,T),d.push(b),y.hasRenderCallback&&this.haveRenderCallbacks.push(E.id)}}patchUpdatedImages(r,s,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(d=>r.hasImage(d,u)),r.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const d of r.getUpdatedImages(u)){for(const g of this.iconPositions.keys()){const y=xc.parse(g);if(js.isEqual(y.id,d)){const b=r.getImage(d,u);this.patchUpdatedImage(this.iconPositions.get(g),b,s,null)}}for(const g of this.patternPositions.keys()){const y=xc.parse(g);if(js.isEqual(y.id,d)){const b=r.getImage(d,u);this.patchUpdatedImage(this.patternPositions.get(g),b,s,this.lut)}}}}patchUpdatedImage(r,s,u,d=null){if(!r||!s||r.version===s.version)return;r.version=s.version;const[g,y]=r.tl,b=r.sdf;if(this.lut||b){const T={width:s.data.width,height:s.data.height},E=new Eo(T);Eo.copy(s.data,E,{x:0,y:0},{x:0,y:0},T,d,b),u.update(E,{position:{x:g,y}})}else u.update(s.data,{position:{x:g,y}})}}rr(Ix,"ImagePosition"),rr(tD,"ImageAtlas");const Px=1e20;function rD(a,r,s,u,d,g,y,b,T){for(let E=r;E<r+u;E++)nD(a,s*g+E,g,d,y,b,T);for(let E=s;E<s+d;E++)nD(a,E*g+r,1,u,y,b,T)}function nD(a,r,s,u,d,g,y){g[0]=0,y[0]=-Px,y[1]=Px,d[0]=a[r];for(let b=1,T=0,E=0;b<u;b++){d[b]=a[r+b*s];const k=b*b;do{const j=g[T];E=(d[b]-d[j]+k-j*j)/(b-j)/2}while(E<=y[T]&&--T>-1);T++,g[T]=b,y[T]=E,y[T+1]=Px}for(let b=0,T=0;b<u;b++){for(;y[T+1]<b;)T++;const E=g[T],k=b-E;a[r+b*s]=d[E]+k*k}}const Rc=2,QE={none:0,ideographs:1,all:2};class i_{constructor(r,s,u){this.requestManager=r,this.localGlyphMode=s,this.localFontFamily=u,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,s){const u=[],d=this.url||Ai.GLYPHS_URL;for(const g in r)for(const y of r[g])u.push({stack:g,id:y});Ie(u,({stack:g,id:y},b)=>{let T=this.entries[g];T||(T=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=T.glyphs[y];if(E!==void 0)return void b(null,{stack:g,id:y,glyph:E});if(E=this._tinySDF(T,g,y),E)return T.glyphs[y]=E,void b(null,{stack:g,id:y,glyph:E});const k=Math.floor(y/256);if(256*k>65535)return br("glyphs > 65535 not supported"),void b(null,{stack:g,id:y,glyph:E});if(T.ranges[k])return void b(null,{stack:g,id:y,glyph:E});let j=T.requests[k];j||(j=T.requests[k]=[],i_.loadGlyphRange(g,k,d,this.requestManager,(R,L)=>{if(L){T.ascender=L.ascender,T.descender=L.descender;for(const z in L.glyphs)this._doesCharSupportLocalGlyph(+z)||(T.glyphs[+z]=L.glyphs[+z]);T.ranges[k]=!0}for(const z of j)z(R,L);delete T.requests[k]})),j.push((R,L)=>{R?b(R):L&&b(null,{stack:g,id:y,glyph:L.glyphs[y]||null})})},(g,y)=>{if(g)s(g);else if(y){const b={};for(const{stack:T,id:E,glyph:k}of y)b[T]===void 0&&(b[T]={}),b[T].glyphs===void 0&&(b[T].glyphs={}),b[T].glyphs[E]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics},b[T].ascender=this.entries[T].ascender,b[T].descender=this.entries[T].descender;s(null,b)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==QE.none&&(this.localGlyphMode===QE.all?!!this.localFontFamily:!!this.localFontFamily&&(Sr["CJK Unified Ideographs"](r)||Sr["Hangul Syllables"](r)||Sr.Hiragana(r)||Sr.Katakana(r)||Sr["CJK Symbols and Punctuation"](r)||Sr["CJK Unified Ideographs Extension A"](r)||Sr["CJK Unified Ideographs Extension B"](r)||Sr.Osage(r)))}_tinySDF(r,s,u){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let g=r.tinySDF;if(!g){let W="400";/bold/i.test(s)?W="900":/medium/i.test(s)?W="500":/light/i.test(s)&&(W="200"),g=r.tinySDF=new i_.TinySDF({fontFamily:d,fontWeight:W,fontSize:24*Rc,buffer:3*Rc,radius:8*Rc}),g.fontWeight=W}if(this.localGlyphs[g.fontWeight][u])return this.localGlyphs[g.fontWeight][u];const y=String.fromCodePoint(u),{data:b,width:T,height:E,glyphWidth:k,glyphHeight:j,glyphLeft:R,glyphTop:L,glyphAdvance:z}=g.draw(y);return this.localGlyphs[g.fontWeight][u]={id:u,bitmap:new Fh({width:T,height:E},b),metrics:{width:k/Rc,height:j/Rc,left:R/Rc,top:L/Rc-27,advance:z/Rc,localGlyph:!0}}}}i_.loadGlyphRange=function(a,r,s,u,d){const g=256*r,y=g+255,b=u.transformRequest(u.normalizeGlyphsURL(s).replace("{fontstack}",a).replace("{range}",`${g}-${y}`),ed.Glyphs);th(b,(T,E)=>{if(T)d(T);else if(E){const k={},j=function(R){return new tw(R).readFields(Dq,{})}(E);for(const R of j.glyphs)k[R.id]=R;d(null,{glyphs:k,ascender:j.ascender,descender:j.descender})}})},i_.TinySDF=class{constructor({fontSize:a=24,buffer:r=3,radius:s=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:g="normal",fontStyle:y="normal",lang:b=null}={}){this.buffer=r,this.cutoff=u,this.radius=s,this.lang=b;const T=this.size=a+4*r,E=this._createCanvas(T),k=this.ctx=E.getContext("2d",{willReadFrequently:!0});k.font=`${y} ${g} ${a}px ${d}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(a){const r=document.createElement("canvas");return r.width=r.height=a,r}draw(a){const{width:r,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:g}=this.ctx.measureText(a),y=Math.ceil(s),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-d))),T=Math.min(this.size-this.buffer,y+Math.ceil(u)),E=b+2*this.buffer,k=T+2*this.buffer,j=Math.max(E*k,0),R=new Uint8ClampedArray(j),L={data:R,width:E,height:k,glyphWidth:b,glyphHeight:T,glyphTop:y,glyphLeft:0,glyphAdvance:r};if(b===0||T===0)return L;const{ctx:z,buffer:W,gridInner:J,gridOuter:ee}=this;this.lang&&(z.lang=this.lang),z.clearRect(W,W,b,T),z.fillText(a,W,W+y);const oe=z.getImageData(W,W,b,T);ee.fill(Px,0,j),J.fill(0,0,j);for(let le=0;le<T;le++)for(let de=0;de<b;de++){const Se=oe.data[4*(le*b+de)+3]/255;if(Se===0)continue;const _e=(le+W)*E+de+W;if(Se===1)ee[_e]=0,J[_e]=Px;else{const Ae=.5-Se;ee[_e]=Ae>0?Ae*Ae:0,J[_e]=Ae<0?Ae*Ae:0}}rD(ee,0,0,E,k,E,this.f,this.v,this.z),rD(J,W,W,b,T,E,this.f,this.v,this.z);for(let le=0;le<j;le++){const de=Math.sqrt(ee[le])-Math.sqrt(J[le]);R[le]=Math.round(255-255*(de/this.radius+this.cutoff))}return L}};const Cu=Gp;function iD(a,r){return a+r[1]-r[0]}function eC(a,r,s,u,d=1){const g=[],y=a.imagePrimary,b=y.pixelRatio,T=y.paddedRect.w-2*Cu,E=y.paddedRect.h-2*Cu,k=(a.right-a.left)*d,j=(a.bottom-a.top)*d,R=y.stretchX||[[0,T]],L=y.stretchY||[[0,E]],z=R.reduce(iD,0),W=L.reduce(iD,0),J=T-z,ee=E-W;let oe=0,le=z,de=0,Se=W,_e=0,Ae=J,ke=0,De=ee;if(y.content&&u){const Ue=y.content;oe=iw(R,0,Ue[0]),de=iw(L,0,Ue[1]),le=iw(R,Ue[0],Ue[2]),Se=iw(L,Ue[1],Ue[3]),_e=Ue[0]-oe,ke=Ue[1]-de,Ae=Ue[2]-Ue[0]-le,De=Ue[3]-Ue[1]-Se}const at=(Ue,ct,pt,bt)=>{const Ot=sw(Ue.stretch-oe,le,k,a.left*d),It=ow(Ue.fixed-_e,Ae,Ue.stretch,z),gt=sw(ct.stretch-de,Se,j,a.top*d),At=ow(ct.fixed-ke,De,ct.stretch,W),nt=sw(pt.stretch-oe,le,k,a.left*d),Ke=ow(pt.fixed-_e,Ae,pt.stretch,z),St=sw(bt.stretch-de,Se,j,a.top*d),Mt=ow(bt.fixed-ke,De,bt.stretch,W),vt=new xt(Ot,gt),er=new xt(nt,gt),or=new xt(nt,St),Xt=new xt(Ot,St),$t=new xt(It/b,At/b),Fr=new xt(Ke/b,Mt/b),Gt=r*Math.PI/180;if(Gt){const zn=Math.sin(Gt),Fn=Math.cos(Gt),Li=[Fn,-zn,zn,Fn];vt._matMult(Li),er._matMult(Li),Xt._matMult(Li),or._matMult(Li)}const vr=Ue.stretch+Ue.fixed,$r=pt.stretch+pt.fixed,nn=ct.stretch+ct.fixed,Pn=bt.stretch+bt.fixed,Gr=a.imageSecondary;return{tl:vt,tr:er,bl:Xt,br:or,texPrimary:{x:y.paddedRect.x+Cu+vr,y:y.paddedRect.y+Cu+nn,w:$r-vr,h:Pn-nn},texSecondary:Gr?{x:Gr.paddedRect.x+Cu+vr,y:Gr.paddedRect.y+Cu+nn,w:$r-vr,h:Pn-nn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:$t,pixelOffsetBR:Fr,minFontScaleX:Ae/b/k,minFontScaleY:De/b/j,isSDF:s}};if(u&&(y.stretchX||y.stretchY)){const Ue=sD(R,J,z),ct=sD(L,ee,W);for(let pt=0;pt<Ue.length-1;pt++){const bt=Ue[pt],Ot=Ue[pt+1];for(let It=0;It<ct.length-1;It++)g.push(at(bt,ct[It],Ot,ct[It+1]))}}else g.push(at({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:E+1}));return g}function Vq(a,r){const s=a.stretchY||[[0,a.paddedRect.h-2*Cu]];return r&&(a.stretchX||a.stretchY)?oD(a.stretchX||[[0,a.paddedRect.w-2*Cu]])*oD(s):1}function iw(a,r,s){let u=0;for(const d of a)u+=Math.max(r,Math.min(s,d[1]))-Math.max(r,Math.min(s,d[0]));return u}function sD(a,r,s){const u=[{fixed:-Cu,stretch:0}];for(const[d,g]of a){const y=u[u.length-1];u.push({fixed:d-y.stretch,stretch:y.stretch}),u.push({fixed:d-y.stretch,stretch:y.stretch+(g-d)})}return u.push({fixed:r+Cu,stretch:s}),u}function oD(a){return 2*a.length+1}function sw(a,r,s,u){return a/r*s+u}function ow(a,r,s,u){return a-r*s/u}function Uq(a,r,s,u){const d=r+a.positionedLines[u].lineOffset;return u===0?s+d/2:s+(d+(r+a.positionedLines[u-1].lineOffset))/2}function $q(a,r=1,s=!1){let u=1/0,d=1/0,g=-1/0,y=-1/0;const b=a[0];for(let L=0;L<b.length;L++){const z=b[L];(!L||z.x<u)&&(u=z.x),(!L||z.y<d)&&(d=z.y),(!L||z.x>g)&&(g=z.x),(!L||z.y>y)&&(y=z.y)}const T=Math.min(g-u,y-d);let E=T/2;const k=new eg([],qq);if(T===0)return new xt(u,d);for(let L=u;L<g;L+=T)for(let z=d;z<y;z+=T)k.push(new s_(L+E,z+E,E,a));let j=function(L){let z=0,W=0,J=0;const ee=L[0];for(let oe=0,le=ee.length,de=le-1;oe<le;de=oe++){const Se=ee[oe],_e=ee[de],Ae=Se.x*_e.y-_e.x*Se.y;W+=(Se.x+_e.x)*Ae,J+=(Se.y+_e.y)*Ae,z+=3*Ae}return new s_(W/z,J/z,0,L)}(a),R=k.length;for(;k.length;){const L=k.pop();(L.d>j.d||!j.d)&&(j=L,s&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,R)),L.max-j.d<=r||(E=L.h/2,k.push(new s_(L.p.x-E,L.p.y-E,E,a)),k.push(new s_(L.p.x+E,L.p.y-E,E,a)),k.push(new s_(L.p.x-E,L.p.y+E,E,a)),k.push(new s_(L.p.x+E,L.p.y+E,E,a)),R+=4)}return s&&(console.log(`num probes: ${R}`),console.log(`best distance: ${j.d}`)),j.p}function qq(a,r){return r.max-a.max}class s_{constructor(r,s,u,d){this.p=new xt(r,s),this.h=u,this.d=function(g,y){let b=!1,T=1/0;for(let E=0;E<y.length;E++){const k=y[E];for(let j=0,R=k.length,L=R-1;j<R;L=j++){const z=k[j],W=k[L];z.y>g.y!=W.y>g.y&&g.x<(W.x-z.x)*(g.y-z.y)/(W.y-z.y)+z.x&&(b=!b),T=Math.min(T,Ma(g,z,W))}}return(b?1:-1)*Math.sqrt(T)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}}const Gq=Object.keys,tC=Number.POSITIVE_INFINITY,Wq=Math.sqrt(2);function aw(a,r,s,u){const d=a.collisionPadding||[0,0,0,0],g={top:a.top-d[1],bottom:a.bottom+d[3],left:a.left-d[0],right:a.right+d[2],scaled:!1};return u!==void 0&&function(y,b){y.top*=b,y.bottom*=b,y.left*=b,y.right*=b,y.scaled=!0}(g,u),s&&function(y,b){if(!b)return;const T=ln(b),E=new xt(y.left,y.top),k=new xt(y.right,y.top),j=new xt(y.left,y.bottom),R=new xt(y.right,y.bottom);E._rotateAround(T,new xt(0,0)),k._rotateAround(T,new xt(0,0)),j._rotateAround(T,new xt(0,0)),R._rotateAround(T,new xt(0,0)),y.left=Math.min(E.x,k.x,j.x,R.x),y.right=Math.max(E.x,k.x,j.x,R.x),y.top=Math.min(E.y,k.y,j.y,R.y),y.bottom=Math.max(E.y,k.y,j.y,R.y)}(g,s),r?{top:Math.min(r.top,g.top),bottom:Math.max(r.bottom,g.bottom),left:Math.min(r.left,g.left),right:Math.max(r.right,g.right),scaled:r.scaled||g.scaled}:g}function aD(a,[r,s]){let u=0,d=0;if(s===tC){r<0&&(r=0);const g=r/Wq;switch(a){case"top-right":case"top-left":d=g-7;break;case"bottom-right":case"bottom-left":d=7-g;break;case"bottom":d=7-r;break;case"top":d=r-7}switch(a){case"top-right":case"bottom-right":u=-g;break;case"top-left":case"bottom-left":u=g;break;case"left":u=r;break;case"right":u=-r}}else{switch(r=Math.abs(r),s=Math.abs(s),a){case"top-right":case"top-left":case"top":d=s-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-s}switch(a){case"top-right":case"bottom-right":case"right":u=-r;break;case"top-left":case"bottom-left":case"left":u=r}}return[u,d]}function Hq(a,r,s,u,d,g,y,b,T,E,k){const j=a.layers[0],R=j.appearances;if(R.length===0)return{iconBBox:null,iconVerticalBBox:null};let L=null,z=null;const W=u.get("icon-rotate").evaluate(d,{},g);r&&(L=aw(r,L,W,y),s)&&(z=aw(s,z,W+90,y));const[J,ee]=u.get("icon-size-scale-range"),oe=ie(1,J,ee);for(const le of R){const de=le.getUnevaluatedProperties(),Se=de._values["icon-image"].value!==void 0,_e=de._values["icon-size"].value!==void 0,Ae=de._values["icon-offset"].value!==void 0,ke=de._values["icon-rotate"].value!==void 0;if(Se||_e||Ae||ke){const De=Ae?j.getAppearanceValueAndResolveTokens(le,"icon-offset",d,g,[]):null,at=De&&Array.isArray(De)?De:b,Ue=ke?j.getAppearanceValueAndResolveTokens(le,"icon-rotate",d,g,[]):null,ct=typeof Ue=="number"?Ue:W,pt=_e?j.getAppearanceValueAndResolveTokens(le,"icon-size",d,g,[]):null,bt=typeof pt=="number"?pt*T.iconScaleFactor:y;let Ot=null,It=null,gt=null;if(Se){const At=j.getAppearanceValueAndResolveTokens(le,"icon-image",d,g,[]);if(At){const nt=a.getResolvedImageFromTokens(At),Ke=de._values["icon-size"],St=kx(nt,r_(a.zoom,Ke,a.worldview),Ke,g,a.zoom,d,a.pixelRatio,oe,a.worldview);gt=E.get(St.iconPrimary.toString())}}else r&&(gt=r.imagePrimary);gt&&(Ot=nw(gt,null,at,k),a.allowVerticalPlacement&&(It=nw(gt,null,at,k))),Ot&&(L=aw(Ot,L,ct,bt)),It&&(z=aw(It,z,ct+90,bt))}}return{iconBBox:L,iconVerticalBBox:z}}function lw(a,r,s,u,d,g,y,b,T){if(!r||!r.usvg)return;const E=ZM(u),k=ZM(d),j=g!=="both"&&g!=="width"||!WM(u)?1:k.width/E.width,R=g!=="both"&&g!=="height"||!HM(u)?1:k.height/E.height;s.scaleSelf(j,R);const L=s.toString();y.set(L,s),b.set(L,r);const{imagePosition:z}=JE(L,r,Gp);T.set(L,z)}function lD(a,r,s,u,d,g,y,b,T){if(!a)return;const E=function(k,j,R,L,z,W){if(k.kind==="camera")return k.maxSize;if(k.kind==="composite"){const J=j.possiblyEvaluate(new wi(k.maxZoom,{worldview:W}),R).evaluate(z,{},R),ee=j.possiblyEvaluate(new wi(k.minZoom,{worldview:W}),R).evaluate(z,{},R);return Math.max(J,ee)}return j.possiblyEvaluate(new wi(L,{worldview:W})).evaluate(z,{},R)}(r,s,u,d,g,T);return a.scaleSelf(E*b*y)}function kx(a,r,s,u,d,g,y,b,T){return{iconPrimary:lD(a.getPrimary(),r,s,u,d,g,y,b,T),iconSecondary:lD(a.getSecondary(),r,s,u,d,g,y,b,T)}}function Zq(a,r,s){if(!r)return;const u=s.get(a.toString()),d=s.get(r.toString());u&&d&&(u.paddedRect.w===d.paddedRect.w&&u.paddedRect.h===d.paddedRect.h||br(`Mismatch in icon variant sizes: ${a.toString()} and ${r.toString()}`),u.usvg!==d.usvg&&br(`Mismatch in icon variant image types: ${a.id} and ${r.id}`))}function cD(a,r,s,u){if(!a)return;const d=r.get(s.toString());if(a.imagePrimary=d,u){const g=r.get(u.toString());a.imageSecondary=g}}function Xq(a,r){for(const s in a.horizontal)uD(a.horizontal[s],r);uD(a.vertical,r)}function uD(a,r){if(a){for(const s of a.positionedLines)for(const u of s.positionedGlyphs)if(u.image!==null){const d=u.image.toString();u.rect=r.get(d).paddedRect}}}function rC(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Kq(a,r,s,u,d,g,y,b,T){const E=nC(g.horizontal)||g.vertical,k=s.get("icon-text-fit-padding").evaluate(u,{},d);let j,R=r;return r&&T!=="none"&&(a.allowVerticalPlacement&&g.vertical&&(j=KE(r,g.vertical,T,k,b,y)),E&&(R=KE(r,E,T,k,b,y))),{defaultShapedIcon:R,verticallyShapedIcon:j}}function Yq(a,r,s,u,d,g,y,b,T,E,k,j,R,L,z,W,J,ee,oe,le,de,Se){let _e=y.textMaxSize.evaluate(r,{},R);_e===void 0?_e=b*y.textScaleFactor:_e*=y.textScaleFactor;const Ae=a.layers[0].layout,ke=oo,De=b*y.textScaleFactor/ke,at=nC(s.horizontal)||s.vertical;if(J!=="none"&&a.appearanceFeatureData&&r.index<a.appearanceFeatureData.length){const vt=a.appearanceFeatureData[r.index];vt&&(vt.textShaping=at,vt.iconTextFitPadding=Ae.get("icon-text-fit-padding").evaluate(r,{},R),vt.fontScale=De)}const Ue=L.name==="globe",ct=a.tilePixelRatio*_e/ke,pt=(nt=a.overscaling,a.zoom>18&&nt>2&&(nt>>=1),Math.max(zt/(512*nt),1)*Ae.get("symbol-spacing")),bt=Ae.get("text-padding")*a.tilePixelRatio,Ot=Ae.get("icon-padding")*a.tilePixelRatio,It=ln(Ae.get("text-max-angle")),gt=Ae.get("icon-rotation-alignment")==="map"&&le!=="point",At=pt/2;var nt;a.hasAnyIconTextFit===!1&&J!=="none"&&(a.hasAnyIconTextFit=!0);const Ke=r.properties?+r.properties[Zt]:null,St=Ke&&a.elevationFeatureIdToIndex?a.elevationFeatureIdToIndex.get(Ke):65535,Mt=(vt,er,or)=>{if(er.x<0||er.x>=zt||er.y<0||er.y>=zt)return;let Xt=null;if(Ue){const{x:$t,y:Fr,z:Gt}=L.projectTilePoint(er.x,er.y,or);Xt={anchor:new xd($t,Fr,Gt,0,void 0),up:L.upVector(or,er.x,er.y)}}(function($t,Fr,Gt,vr,$r,nn,Pn,Gr,zn,Fn,Li,ye,pe,ut,Ut,dt,qt,hr,ur,Hr,Ir,lr,On,ci,jr,An,ui,Jn,Zi,Pi,_i){const ii=$t.addToLineVertexArray(Fr,vr);let Bn,Zr,Vn,yi,Pr,kn,ki,es=0,hs=0,Cs=0,ji=0,bs=-1,ga=-1;const ws={};let Fa=op("");const Co=Gt?Gt.anchor:Fr,Rl=Jn!=="none";let _a=0,Ba=0;if(zn._unevaluatedLayout.getValue("text-radial-offset")===void 0){const ao=zn.layout.get("text-offset").evaluate(Ir,{},jr);_a=ao[0]*oo,Ba=ao[1]*oo}else _a=zn.layout.get("text-radial-offset").evaluate(Ir,{},jr)*oo,Ba=tC;if($t.allowVerticalPlacement&&$r.vertical){const ao=$r.vertical;if(Ut)kn=iC(ao),Gr&&(ki=iC(Gr));else{const Zo=zn.layout.get("text-rotate").evaluate(Ir,{},jr)+90;Vn=cw(Fn,Co,Fr,Li,ye,pe,ao,ut,Zo,dt),Gr&&(yi=cw(Fn,Co,Fr,Li,ye,pe,Gr,hr,Zo,null,_i))}}if(nn){const ao=$t.iconSizeData,Zo=zn.layout.get("icon-rotate").evaluate(Ir,{},jr),Au=eC(nn,Zo,On,Rl,lr.iconScaleFactor),qh=Gr?eC(Gr,Zo,On,Rl,lr.iconScaleFactor):void 0;Zr=cw(Fn,Co,Fr,Li,ye,pe,nn,hr,Zo,null,Pi);const h_=function(Iu,Cw,f_,uW,PN,kN,dW,hW){const jN=Iu.layers[0],RN=jN.appearances;let p_=Cw.length;if(f_&&(p_=Math.max(p_,f_.length)),RN.length===0)return p_;const[fW,pW]=uW.get("icon-size-scale-range"),mW=ie(1,fW,pW);for(const MN of RN){const DN=MN.getUnevaluatedProperties();if(DN._values["icon-image"].value!==void 0){const NN=jN.getAppearanceValueAndResolveTokens(MN,"icon-image",PN,kN,[]);if(NN){const ON=Iu.getResolvedImageFromTokens(NN);if(ON){const LN=DN._values["icon-size"],gW=kx(ON,r_(Iu.zoom,LN,Iu.worldview),LN,kN,Iu.zoom,PN,Iu.pixelRatio,mW,Iu.worldview),_W=dW.get(gW.iconPrimary.toString());p_=Math.max(p_,Vq(_W,hW))}}}}return p_}($t,Au,qh,zn.layout,Ir,jr,$t.iconAtlasPositions,Rl);es=4*h_;let Gh=null;ao.kind==="source"?(Gh=[jc*zn.layout.get("icon-size").evaluate(Ir,{},jr)*lr.iconScaleFactor],Gh[0]>bd&&br(`${$t.layerIds[0]}: Value for "icon-size" is >= ${jx}. Reduce your "icon-size".`)):ao.kind==="composite"&&(Gh=[jc*lr.compositeIconSizes[0].evaluate(Ir,{},jr)*lr.iconScaleFactor,jc*lr.compositeIconSizes[1].evaluate(Ir,{},jr)*lr.iconScaleFactor],(Gh[0]>bd||Gh[1]>bd)&&br(`${$t.layerIds[0]}: Value for "icon-size" is >= ${jx}. Reduce your "icon-size".`)),$t.addSymbols($t.icon,Au,Gh,Hr,ur,Ir,void 0,Gt,Fr,ii.lineStartIndex,ii.lineLength,-1,ci,jr,An,ui,$t.symbolInstances.length,h_),bs=$t.icon.placedSymbolArray.length-1,qh&&(hs=4*h_,$t.addSymbols($t.icon,qh,Gh,Hr,ur,Ir,za.vertical,Gt,Fr,ii.lineStartIndex,ii.lineLength,-1,ci,jr,An,ui,$t.symbolInstances.length,h_),ga=$t.icon.placedSymbolArray.length-1)}for(const ao in $r.horizontal){const Zo=ao,Au=$r.horizontal[Zo];Bn||(Fa=op(Au.text),Ut?Pr=iC(Au):Bn=cw(Fn,Co,Fr,Li,ye,pe,Au,ut,zn.layout.get("text-rotate").evaluate(Ir,{},jr),dt));const qh=Au.positionedLines.length===1;if(Cs+=dD($t,Gt,Fr,Au,Pn,zn,Ut,Ir,dt,ii,$r.vertical?za.horizontal:za.horizontalOnly,qh?Gq($r.horizontal):[Zo],ws,bs,lr,ci,jr,$t.symbolInstances.length,An),qh)break}$r.vertical&&(ji+=dD($t,Gt,Fr,$r.vertical,Pn,zn,Ut,Ir,dt,ii,za.vertical,["vertical"],ws,ga,lr,ci,jr,$t.symbolInstances.length,An));let Ao=-1;const Va=(ao,Zo)=>ao?Math.max(ao,Zo):Zo;Ao=Va(Pr,Ao),Ao=Va(kn,Ao),Ao=Va(ki,Ao);const Ml=Ao>-1?1:0;$t.glyphOffsetArray.length>=65535&&br("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ir.sortKey!==void 0&&$t.addToSortKeyRanges($t.symbolInstances.length,Ir.sortKey),$t.symbolInstances.emplaceBack(Fr.x,Fr.y,Co.x,Co.y,Co.z,ws.right>=0?ws.right:-1,ws.center>=0?ws.center:-1,ws.left>=0?ws.left:-1,ws.vertical>=0?ws.vertical:-1,bs,ga,Fa,Bn!==void 0?Bn:$t.collisionBoxArray.length,Bn!==void 0?Bn+1:$t.collisionBoxArray.length,Vn!==void 0?Vn:$t.collisionBoxArray.length,Vn!==void 0?Vn+1:$t.collisionBoxArray.length,Zr!==void 0?Zr:$t.collisionBoxArray.length,Zr!==void 0?Zr+1:$t.collisionBoxArray.length,yi||$t.collisionBoxArray.length,yi?yi+1:$t.collisionBoxArray.length,Li,Cs,ji,es,hs,Ml,0,_a,Ba,Ao,0,Rl?1:0,Zi)})(a,er,Xt,vt,s,u,g,d,a.layers[0],a.collisionBoxArray,r.index,r.sourceLayerIndex,a.index,bt,oe,E,0,Ot,gt,ee,r,y,k,j,R,z,W,J,St,de,Se)};if(le==="line")for(const vt of q1(r.geometry,0,0,zt,zt)){const er=Bq(vt,pt,It,s.vertical||at,u,ke,ct,a.overscaling,zt);for(const or of er)at&&Jq(a,at.text,At,or)||Mt(vt,or,R)}else if(le==="line-center"){for(const vt of r.geometry)if(vt.length>1){const er=Fq(vt,It,s.vertical||at,u,ke,ct);er&&Mt(vt,er,R)}}else if(r.type==="Polygon")for(const vt of fx(r.geometry,0)){const er=$q(vt,16);Mt(vt[0],new xd(er.x,er.y,0,0,void 0),R)}else if(r.type==="LineString")for(const vt of r.geometry)Mt(vt,new xd(vt[0].x,vt[0].y,0,0,void 0),R);else if(r.type==="Point")for(const vt of r.geometry)for(const er of vt)Mt([er],new xd(er.x,er.y,0,0,void 0),R)}const jx=255,bd=jx*jc;function dD(a,r,s,u,d,g,y,b,T,E,k,j,R,L,z,W,J,ee,oe){const le=function(_e,Ae,ke,De,at,Ue,ct,pt){const bt=[];if(Ae.positionedLines.length===0)return bt;const Ot=De.layout.get("text-rotate").evaluate(Ue,{})*Math.PI/180,It=function(St){const Mt=St[0],vt=St[1],er=Mt*vt;return er>0?[Mt,-vt]:er<0?[-Mt,vt]:Mt===0?[vt,Mt]:[vt,-Mt]}(ke);let gt=Math.abs(Ae.top-Ae.bottom);for(const St of Ae.positionedLines)gt-=St.lineOffset;const At=Ae.positionedLines.length,nt=gt/At;let Ke=Ae.top-ke[1];for(let St=0;St<At;++St){const Mt=Ae.positionedLines[St];Ke=Uq(Ae,nt,Ke,St);for(const vt of Mt.positionedGlyphs){if(!vt.rect)continue;const er=vt.rect||{};let or=FM+1,Xt=!0,$t=1,Fr=0;if(vt.image){const ur=ct.get(vt.image.toString());if(!ur)continue;if(ur.sdf){br("SDF images are not supported in formatted text and will be ignored.");continue}Xt=!1,$t=ur.pixelRatio,or=Gp/$t}const Gt=(at||pt)&&vt.vertical,vr=vt.metrics.advance*vt.scale/2,$r=vt.metrics,nn=vt.rect;if(nn===null)continue;pt&&Ae.verticalizable&&(Fr=vt.image?vr-vt.metrics.width*vt.scale/2:0);const Pn=at?[vt.x+vr,vt.y]:[0,0];let Gr=[0,0],zn=[0,0],Fn=!1;at||(Gt?(zn=[vt.x+vr+It[0],vt.y+It[1]-Fr],Fn=!0):Gr=[vt.x+vr+ke[0],vt.y+ke[1]-Fr]);const Li=nn.w*vt.scale/($t*(vt.localGlyph?Rc:1)),ye=nn.h*vt.scale/($t*(vt.localGlyph?Rc:1));let pe,ut,Ut,dt;if(Gt){const ur=vt.y-Ke,Hr=new xt(-vr,vr-ur),Ir=-Math.PI/2,lr=new xt(...zn);pe=new xt(-vr+Gr[0],Gr[1]),pe._rotateAround(Ir,Hr)._add(lr),pe.x+=-ur+vr,pe.y-=($r.left-or)*vt.scale;const On=vt.image?$r.advance*vt.scale:oo*vt.scale,ci=String.fromCodePoint(vt.glyph);Sq(ci)?pe.x+=(1-or)*vt.scale:Tq(ci)?pe.x+=On-$r.height*vt.scale+(-or-1)*vt.scale:pe.x+=vt.image||$r.width+2*or===nn.w&&$r.height+2*or===nn.h?(On-ye)/2:(On-($r.height+2*or)*vt.scale)/2,ut=new xt(pe.x,pe.y-Li),Ut=new xt(pe.x+ye,pe.y),dt=new xt(pe.x+ye,pe.y-Li)}else{const ur=($r.left-or)*vt.scale-vr+Gr[0],Hr=(-$r.top-or)*vt.scale+Gr[1],Ir=ur+Li,lr=Hr+ye;pe=new xt(ur,Hr),ut=new xt(Ir,Hr),Ut=new xt(ur,lr),dt=new xt(Ir,lr)}if(Ot){let ur;ur=at?new xt(0,0):Fn?new xt(It[0],It[1]):new xt(ke[0],ke[1]),pe._rotateAround(Ot,ur),ut._rotateAround(Ot,ur),Ut._rotateAround(Ot,ur),dt._rotateAround(Ot,ur)}const qt=new xt(0,0),hr=new xt(0,0);bt.push({tl:pe,tr:ut,bl:Ut,br:dt,texPrimary:er,texSecondary:void 0,writingMode:Ae.writingMode,glyphOffset:Pn,sectionIndex:vt.sectionIndex,isSDF:Xt,pixelOffsetTL:qt,pixelOffsetBR:hr,minFontScaleX:0,minFontScaleY:0})}}return bt}(0,u,T,g,y,b,d,a.allowVerticalPlacement),de=a.textSizeData;let Se=null;de.kind==="source"?(Se=[jc*g.layout.get("text-size").evaluate(b,{},J)*z.textScaleFactor],Se[0]>bd&&br(`${a.layerIds[0]}: Value for "text-size" is >= ${jx}. Reduce your "text-size".`)):de.kind==="composite"&&(Se=[jc*z.compositeTextSizes[0].evaluate(b,{},J)*z.textScaleFactor,jc*z.compositeTextSizes[1].evaluate(b,{},J)*z.textScaleFactor],(Se[0]>bd||Se[1]>bd)&&br(`${a.layerIds[0]}: Value for "text-size" is >= ${jx}. Reduce your "text-size".`)),a.addSymbols(a.text,le,Se,T,y,b,k,r,s,E.lineStartIndex,E.lineLength,L,W,J,oe,!1,ee,le.length);for(const _e of j)R[_e]=a.text.placedSymbolArray.length-1;return 4*le.length}function nC(a){for(const r in a)return a[r];return null}function cw(a,r,s,u,d,g,y,b,T,E,k){let j,R,L,z;if(j=k?k.top:y.top,R=k?k.bottom:y.bottom,L=k?k.left:y.left,z=k?k.right:y.right,GM(y)&&y.collisionPadding){const W=y.collisionPadding;L-=W[0],j-=W[1],z+=W[2],R+=W[3]}if(T){const W=new xt(L,j),J=new xt(z,j),ee=new xt(L,R),oe=new xt(z,R),le=ln(T);let de=new xt(0,0);E&&(de=new xt(E[0],E[1])),W._rotateAround(le,de),J._rotateAround(le,de),ee._rotateAround(le,de),oe._rotateAround(le,de),L=Math.min(W.x,J.x,ee.x,oe.x),z=Math.max(W.x,J.x,ee.x,oe.x),j=Math.min(W.y,J.y,ee.y,oe.y),R=Math.max(W.y,J.y,ee.y,oe.y)}return a.emplaceBack(r.x,r.y,r.z,s.x,s.y,L,j,z,R,b,u,d,g),a.length-1}function iC(a){GM(a)&&a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const r=a.bottom-a.top;return r>0?Math.max(10,r):null}function Jq(a,r,s,u){const d=a.compareText;if(r in d){const g=d[r];for(let y=g.length-1;y>=0;y--)if(u.dist(g[y])<s)return!0}else d[r]=[];return d[r].push(u),!1}function hD(a,r){const s=a.fovAboveCenter,u=a.elevation?a.elevation.getMinElevationBelowMSL()*r:0,d=(a._camera.position[2]*a.worldSize-u)/Math.cos(a._pitch),g=Math.sin(s)*d/Math.sin(Math.max(Math.PI/2-a._pitch-s,.01));let y=Math.sin(a._pitch)*g+d;const b=d*(1/a._horizonShift);if(!a.elevation||a.elevation.exaggeration()===0){let T=Math.max(a.zoom-17,0);a.isOrthographic&&(T/=10),y*=1+T}return Math.min(1.01*y,b)}function Rx(a,r){if(!r.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:r};const s=Math.pow(2,-a.z),u=a.x*s,d=(a.x+1)*s,g=a.y*s,y=(a.y+1)*s,b=he(u),T=he(d),E=ce(g),k=ce(y),j=r.project(b,E),R=r.project(T,E),L=r.project(T,k),z=r.project(b,k);let W=Math.min(j.x,R.x,L.x,z.x),J=Math.min(j.y,R.y,L.y,z.y),ee=Math.max(j.x,R.x,L.x,z.x),oe=Math.max(j.y,R.y,L.y,z.y);const le=s/16;function de(_e,Ae,ke,De,at,Ue){const ct=(ke+at)/2,pt=(De+Ue)/2,bt=r.project(he(ct),ce(pt)),Ot=Math.max(0,W-bt.x,J-bt.y,bt.x-ee,bt.y-oe);W=Math.min(W,bt.x),ee=Math.max(ee,bt.x),J=Math.min(J,bt.y),oe=Math.max(oe,bt.y),Ot>le&&(de(_e,bt,ke,De,ct,pt),de(bt,Ae,ct,pt,at,Ue))}de(j,R,u,g,d,g),de(R,L,d,g,d,y),de(L,z,d,y,u,y),de(z,j,u,y,u,g),W-=le,J-=le,ee+=le,oe+=le;const Se=1/Math.max(ee-W,oe-J);return{scale:Se,x:W*Se,y:J*Se,x2:ee*Se,y2:oe*Se,projection:r}}function fD(a,{x:r,y:s},u=0){return new xt(((r-u)*a.scale-a.x)*zt,(s*a.scale-a.y)*zt)}const Qq=K(new Float32Array(16));class Uh{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,s){return{x:0,y:0,z:0}}unproject(r,s){return new F(0,0)}projectTilePoint(r,s,u){return{x:r,y:s,z:0}}locationPoint(r,s,u,d=!0){return r._coordinatePoint(r.locationCoordinate(s,u),d)}pixelsPerMeter(r,s){return ae(1,r)*s}pixelSpaceConversion(r,s,u){return 1}farthestPixelDistance(r){return hD(r,r.pixelsPerMeter)}pointCoordinate(r,s,u,d){const g=r.horizonLineFromTop(!1),y=new xt(s,Math.max(g,u));return r.rayIntersectionCoordinate(r.pointRayIntersection(y,d))}pointCoordinate3D(r,s,u){const d=new xt(s,u);if(r.elevation)return r.elevation.pointCoordinate(d);{const g=this.pointCoordinate(r,d.x,d.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(r,s){if(r.elevation&&r.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(r,s.x,s.y);const u=r.horizonLineFromTop();return s.y<u}createInversionMatrix(r,s){return Qq}createTileMatrix(r,s,u){let d,g,y;const b=u.canonical,T=K(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=Rx(b,this);d=1,g=E.x+u.wrap*E.scale,y=E.y,ue(T,T,[d/E.scale,d/E.scale,r.pixelsPerMeter/s])}else d=s/r.zoomScale(b.z),g=(b.x+Math.pow(2,b.z)*u.wrap)*d,y=b.y*d;return X(T,T,[g,y,0]),ue(T,T,[d/zt,d/zt,1]),T}upVector(r,s,u){return[0,0,1]}upVectorScale(r,s,u){return{metersToTile:1}}}class eG extends Uh{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[s,u]=this.parallels=r.parallels||[29.5,45.5],d=Math.sin(ln(s));this.n=(d+Math.sin(ln(u)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(r,s){const{n:u,c:d,r0:g}=this,y=ln(r-this.center[0]),b=ln(s),T=Math.sqrt(d-2*u*Math.sin(b))/u;return{x:T*Math.sin(y*u),y:T*Math.cos(y*u)-g,z:0}}unproject(r,s){const{n:u,c:d,r0:g}=this,y=g+s;let b=Math.atan2(r,Math.abs(y))*Math.sign(y);y*u<0&&(b-=Math.PI*Math.sign(r)*Math.sign(y));const T=ln(this.center[0])*u;b=Pe(b,-Math.PI-T,Math.PI-T);const E=ie(Do(b/u)+this.center[0],-180,180),k=Math.asin(ie((d-(r*r+y*y)*u*u)/(2*u),-1,1)),j=ie(Do(k),-fe,fe);return new F(E,j)}}const Mx=1.340264,Dx=-.081106,Nx=893e-6,Ox=.003796,uw=Math.sqrt(3)/2;class tG extends Uh{project(r,s){s=s/180*Math.PI,r=r/180*Math.PI;const u=Math.asin(uw*Math.sin(s)),d=u*u,g=d*d*d;return{x:.5*(r*Math.cos(u)/(uw*(Mx+3*Dx*d+g*(7*Nx+9*Ox*d)))/Math.PI+.5),y:1-.5*(u*(Mx+Dx*d+g*(Nx+Ox*d))/Math.PI+1),z:0}}unproject(r,s){r=(2*r-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,d=u*u,g=d*d*d;for(let k,j,R,L=0;L<12&&(j=u*(Mx+Dx*d+g*(Nx+Ox*d))-s,R=Mx+3*Dx*d+g*(7*Nx+9*Ox*d),k=j/R,u=ie(u-k,-Math.PI/3,Math.PI/3),d=u*u,g=d*d*d,!(Math.abs(k)<1e-12));++L);const y=uw*r*(Mx+3*Dx*d+g*(7*Nx+9*Ox*d))/Math.cos(u),b=Math.asin(Math.sin(u)/uw),T=ie(180*y/Math.PI,-180,180),E=ie(180*b/Math.PI,-fe,fe);return new F(T,E)}}class rG extends Uh{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,s){return{x:.5+r/360,y:.5-s/360,z:0}}unproject(r,s){const u=360*(r-.5),d=ie(360*(.5-s),-fe,fe);return new F(u,d)}}const o_=Math.PI/2;function dw(a){return Math.tan((o_+a)/2)}class nG extends Uh{constructor(r){super(r),this.center=r.center||[0,30];const[s,u]=this.parallels=r.parallels||[30,30];let d=ln(s),g=ln(u);this.southernCenter=d+g<0,this.southernCenter&&(d=-d,g=-g);const y=Math.cos(d),b=dw(d);this.n=d===g?Math.sin(d):Math.log(y/Math.cos(g))/Math.log(dw(g)/b),this.f=y*Math.pow(dw(d),this.n)/this.n}project(r,s){s=ln(s),this.southernCenter&&(s=-s),r=ln(r-this.center[0]);const u=1e-6,{n:d,f:g}=this;g>0?s<-o_+u&&(s=-o_+u):s>o_-u&&(s=o_-u);const y=g/Math.pow(dw(s),d);let b=y*Math.sin(d*r),T=g-y*Math.cos(d*r);return b=.5*(b/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:b,y:this.southernCenter?T:1-T,z:0}}unproject(r,s){r=(2*r-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;const{n:u,f:d}=this,g=d-s,y=Math.sign(g),b=Math.sign(u)*Math.sqrt(r*r+g*g);let T=Math.atan2(r,Math.abs(g))*y;g*u<0&&(T-=Math.PI*Math.sign(r)*y);const E=ie(Do(T/u)+this.center[0],-180,180),k=ie(Do(2*Math.atan(Math.pow(d/b,1/u))-o_),-fe,fe);return new F(E,this.southernCenter?-k:k)}}class pD extends Uh{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,s){return{x:se(r),y:ne(s),z:0}}unproject(r,s){const u=he(r),d=ce(s);return new F(u,d)}}const mD=ln(fe);class iG extends Uh{project(r,s){const u=(s=ln(s))*s,d=u*u;return{x:.5*((r=ln(r))*(.8707-.131979*u+d*(d*(.003971*u-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+u*(.015085+d*(.028874*u-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(r,s){r=(2*r-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,d=25,g=0,y=u*u;do{y=u*u;const E=y*y;g=(u*(1.007226+y*(.015085+E*(.028874*y-.044475-.005916*E)))-s)/(1.007226+y*(.045255+E*(.259866*y-.311325-.005916*11*E))),u=ie(u-g,-mD,mD)}while(Math.abs(g)>1e-6&&--d>0);y=u*u;const b=ie(Do(r/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),T=Do(u);return new F(b,T)}}const gD=ln(fe);class sG extends Uh{project(r,s){s=ln(s),r=ln(r);const u=Math.cos(s),d=2/Math.PI,g=Math.acos(u*Math.cos(r/2)),y=Math.sin(g)/g,b=.5*(r*d+2*u*Math.sin(r/2)/y)||0,T=.5*(s+Math.sin(s)/y)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(r,s){let u=r=(2*r-.5)*Math.PI,d=s=(2*(1-s)-1)*Math.PI,g=25;const y=1e-6;let b=0,T=0;do{const E=Math.cos(d),k=Math.sin(d),j=2*k*E,R=k*k,L=E*E,z=Math.cos(u/2),W=Math.sin(u/2),J=2*z*W,ee=W*W,oe=1-L*z*z,le=oe?1/oe:0,de=oe?Math.acos(E*z)*Math.sqrt(1/oe):0,Se=.5*(2*de*E*W+2*u/Math.PI)-r,_e=.5*(de*k+d)-s,Ae=.5*le*(L*ee+de*E*z*R)+1/Math.PI,ke=le*(J*j/4-de*k*W),De=.125*le*(j*W-de*k*L*J),at=.5*le*(R*z+de*ee*E)+.5,Ue=ke*De-at*Ae;b=(_e*ke-Se*at)/Ue,T=(Se*De-_e*Ae)/Ue,u=ie(u-b,-Math.PI,Math.PI),d=ie(d-T,-gD,gD)}while((Math.abs(b)>y||Math.abs(T)>y)&&--g>0);return new F(Do(u),Do(d))}}class _D extends Uh{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ln(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,s){const{scale:u,cosPhi:d}=this;return{x:ln(r)*d*u+.5,y:-Math.sin(ln(s))/d*u+.5,z:0}}unproject(r,s){const{scale:u,cosPhi:d}=this,g=-(s-.5)/u,y=ie(Do((r-.5)/u)/d,-180,180),b=Math.asin(ie(g*d,-1,1)),T=ie(Do(b),-fe,fe);return new F(y,T)}}class oG extends pD{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,s,u){const d=ax(r,s,u);return yn(d,d,N1(Tu(u))),{x:d[0],y:d[1],z:d[2]}}locationPoint(r,s,u){const d=A(s.lat,s.lng),g=Er([],d),y=u?r._centerAltitude+u:r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(s),r._centerAltitude):r._centerAltitude;it(d,d,g,ae(1,0)*zt*y);const b=K(new Float64Array(16));return G(b,r.pixelMatrix,r.globeMatrix),yn(d,d,b),new xt(d[0],d[1])}pixelsPerMeter(r,s){return ae(1,0)*s}pixelSpaceConversion(r,s,u){const d=ae(1,r)*s,g=Rr(ae(1,45)*s,d,u);return this.pixelsPerMeter(r,s)/g}createTileMatrix(r,s,u){const d=uE(Tu(u.canonical));return G(new Float64Array(16),r.globeMatrix,d)}createInversionMatrix(r,s){const{center:u}=r,d=N1(Tu(s));return xe(d,d,ln(u.lng)),Ee(d,d,ln(u.lat)),ue(d,d,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(r,s,u,d){return Vj(r,s,u,!0)||new Fe(0,0)}pointCoordinate3D(r,s,u){const d=this.pointCoordinate(r,s,u,0);return[d.x,d.y,d.z]}isPointAboveHorizon(r,s){return!Vj(r,s.x,s.y,!1)}farthestPixelDistance(r){const s=function(d,g){const y=d.cameraToCenterDistance,b=d._centerAltitude*g,T=d._camera,E=d._camera.forward(),k=$e([],Vt([],E,-y),[0,0,b]),j=d.worldSize/(2*Math.PI),R=[0,0,-j],L=d.width/d.height,z=Math.tan(d.fovAboveCenter),W=Vt([],T.up(),z),J=Vt([],T.right(),z*L),ee=Er([],$e([],$e([],E,W),J)),oe=[];let le;if(new Xr(k,ee).closestPointOnSphere(R,j,oe)){const de=$e([],oe,R),Se=Ei([],de,k);le=Math.cos(d.fovAboveCenter)*Ye(Se)}else{const de=Ei([],k,R),Se=Ei([],R,k);Er(Se,Se);const _e=Ye(de)-j;le=Math.sqrt(_e*(_e+2*j));const Ae=Math.acos(le/(j+_e))-Math.acos(Vr(E,Se));le*=Math.cos(Ae)}return 1.01*le}(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),u=zh(r.zoom);if(u>0){const d=hD(r,ae(1,r.center.lat)*r.worldSize),g=r.worldSize/(2*Math.PI),y=Math.max(r.width,r.height)/r.worldSize*Math.PI;return Rr(s,d+g*(1-Math.cos(y)),Math.pow(u,10))}return s}upVector(r,s,u){return ax(s,u,r,1)}upVectorScale(r){return{metersToTile:R1(D1(Tu(r)))}}}function yD(a){const r=a.parallels,s=!!r&&Math.abs(r[0]+r[1])<.01;switch(a.name){case"mercator":return new pD(a);case"equirectangular":return new rG(a);case"naturalEarth":return new iG(a);case"equalEarth":return new tG(a);case"winkelTripel":return new sG(a);case"albers":return s?new _D(a):new eG(a);case"lambertConformalConic":return s?new _D(a):new nG(a);case"globe":return new oG(a)}throw new Error(`Invalid projection name: ${a.name}`)}const aG=wt.types,lG=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Lx(a,r,s,u,d,g,y,b,T,E,k,j,R){const L=b?Math.min(bd,Math.round(b[0])):0,z=b?Math.min(bd,Math.round(b[1])):0;a.emplaceBack(r,s,Math.round(32*u),Math.round(32*d),g,y,(L<<1)+(T?1:0),0+(z<<1),16*E,16*k,256*j,256*R)}function zx(a,r,s){a.emplaceBack(r,s)}function Fx(a,r,s,u,d,g,y){a.emplaceBack(r,s,u,d,g,y)}const hw=(a,r,s,u)=>{for(let d=0;d<r;d++)a.emplaceBack(s[0],s[1],s[2],u[0],u[1],u[2])};function a_(a,r,s,u,d){a.emplaceBack(r,s,u,d),a.emplaceBack(r,s,u,d),a.emplaceBack(r,s,u,d),a.emplaceBack(r,s,u,d)}function cG(a){for(const r of a.sections)if(H2(r.text))return!0;return!1}class sC{constructor(r){this.layoutVertexArray=new Ng,this.indexArray=new Mi,this.programConfigurations=r,this.segments=new Vi,this.dynamicLayoutVertexArray=new wu,this.opacityVertexArray=new Gv,this.placedSymbolArray=new Dp,this.iconTransitioningVertexArray=new ll,this.globeExtVertexArray=new Ph,this.zOffsetVertexArray=new Cc,this.orientationVertexArray=new Zv,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(r,s){const u=[],d=this.layoutVertexArray.uint16;for(let g=0;g<s;++g){const y=12*(r+g);u.push(...d.slice(y,y+12))}return u}updateIconVertexData(r,s,u,d,g,y,b,T,E,k,j,R,L){const z=this.layoutVertexArray.uint16,W=12*r;z[W]=s,z[W+1]=u,z[W+2]=d,z[W+3]=g,z[W+4]=y,z[W+5]=b,z[W+6]=T,z[W+7]=E,z[W+8]=k,z[W+9]=j,z[W+10]=R,z[W+11]=L}upload(r,s,u,d,g,y){this.isEmpty()||(u&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,fq.members,!!y),this.indexBuffer=r.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,mq.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,lG,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=r.createVertexBuffer(this.iconTransitioningVertexArray,yq.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,pq.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||g)&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,gq.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=r.createVertexBuffer(this.orientationVertexArray,_q.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||d)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}rr(sC,"SymbolBuffers");class oC{constructor(r,s,u){this.layoutVertexArray=new r,this.layoutAttributes=s,this.indexArray=new u,this.segments=new Vi,this.collisionVertexArray=new jh,this.collisionVertexArrayExt=new wu}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,vq.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,xq.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}rr(oC,"CollisionBuffers");class fw{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(y=>y.fqid),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=K([]),this.placementViewportMatrix=K([]);const s=this.layers[0]._unevaluatedLayout._values;this.worldview=r.worldview,this.textSizeData=r_(this.zoom,s["text-size"],this.worldview),this.iconSizeData=r_(this.zoom,s["icon-size"],this.worldview);const u=this.layers[0].layout,d=u.get("symbol-sort-key"),g=u.get("symbol-z-order");this.lut=r.lut,this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(y=>za[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=r.sourceID,this.projection=r.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null}hasAnyAppearanceProperty(r){const s=this.layers[0].getAppearances();return!(!s||s.length===0)&&s.some(u=>u.getProperty(r)!=null)}createArrays(){this.text=new sC(new kl(this.layers,{zoom:this.zoom,lut:this.lut},r=>r.startsWith("text")||r.startsWith("symbol"))),this.icon=new sC(new kl(this.layers,{zoom:this.zoom,lut:this.lut},r=>r.startsWith("icon")||r.startsWith("symbol"))),this.glyphOffsetArray=new tx,this.lineVertexArray=new w1,this.symbolInstances=new b1}calculateGlyphDependencies(r,s,u,d,g){for(const y of r){const b=y.codePointAt(0);if(b===void 0)break;if(s[b]=!0,d&&g&&b<=65535){const T=Cx[y];T&&(s[T.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(r,s,u,d,g,y){let b=1;const T=r.getUnevaluatedProperties()._values["icon-size"],E=r_(this.zoom,T,this.worldview),k=n_(E,s);if(E.kind!=="constant"&&E.kind!=="camera"||(b=k.uSize),E.kind==="composite"){const{minZoom:j,maxZoom:R}=E,L=T.possiblyEvaluate(new wi(j,{worldview:this.worldview}),d),z=T.possiblyEvaluate(new wi(R,{worldview:this.worldview}),d),W=L.evaluate(u,{},d,g);b=W+(z.evaluate(u,{},d,g)-W)*k.uSizeT}return E.kind==="source"&&(b=T.possiblyEvaluate(new wi(this.zoom,{worldview:this.worldview}),d).evaluate(u,{},d,g)),b*y}updateFootprints(r,s){}updateReplacement(r,s){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const u=s.getReplacementRegionsForTile(r.toUnwrapped(),!0);return!V1(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}getResolvedImageFromTokens(r){return typeof r=="string"?Qo.build(r):r}populate(r,s,u,d){const g=this.layers[0],y=g.layout,b=this.projection.name==="globe",T=y.get("text-font"),E=y.get("text-field"),k=y.get("icon-image"),[j,R]=y.get("icon-size-scale-range"),L=ie(s.scaleFactor||1,j,R),z=(E.value.kind!=="constant"||E.value.value instanceof Vs&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),W=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,J=this.hasAnyAppearanceProperty("icon-image"),ee=y.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!z&&!W&&!J)return;const oe=s.iconDependencies,le=s.glyphDependencies,de=s.availableImages,Se=new wi(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),_e=Ae=>{const ke=Ae.id.toString();oe.has(ke)?oe.get(ke).push(Ae):oe.set(ke,[Ae])};for(const Ae of r){const{feature:ke,id:De,index:at,sourceLayerIndex:Ue}=Ae,ct=g._featureFilter.needGeometry,pt=Ze(ke,ct);if(!g._featureFilter.filter(Se,pt,u))continue;if(ct||(pt.geometry=ft(ke,u,d)),b&&ke.type!==1&&u.z<=5){const St=pt.geometry,Mt=.98078528056,vt=(er,or)=>Vr(ax(er.x,er.y,u,1),ax(or.x,or.y,u,1))<Mt;for(let er=0;er<St.length;er++)St[er]=ht(St[er],vt)}let bt,Ot;if(z){const St=g.getValueAndResolveTokens("text-field",pt,u,de),Mt=Vs.factory(St);cG(Mt)&&(this.hasRTLText=!0),(!this.hasRTLText||Ov()==="unavailable"||this.hasRTLText&&ma.isParsed())&&(bt=wq(Mt,g,pt))}if(W){const St=g.getValueAndResolveTokens("icon-image",pt,u,de);Ot=this.getResolvedImageFromTokens(St)}const It=this.layers[0];let gt=!1;if(!Ot&&J){const St=It.getAppearances();for(const Mt of St)if(Mt.getProperty("icon-image")){const vt=It.getAppearanceValueAndResolveTokens(Mt,"icon-image",pt,u,de);if(vt){Ot=this.getResolvedImageFromTokens(vt),gt=!0;break}}}if(!bt&&!Ot)continue;const At=this.sortFeaturesByKey?ee.evaluate(pt,{},u):void 0,nt={id:De,text:bt,icon:Ot,index:at,sourceLayerIndex:Ue,geometry:pt.geometry,properties:ke.properties,type:aG[ke.type],sortKey:At};if(this.features.push(nt),this.appearanceFeatureData.push({id:De,properties:ke.properties,usesAppearanceIconAsPlaceholder:gt,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),Ot){const St=It._unevaluatedLayout._values,{iconPrimary:Mt,iconSecondary:vt}=kx(Ot,this.iconSizeData,St["icon-size"],u,this.zoom,nt,this.pixelRatio,L,this.worldview);_e(Mt),vt&&(this.hasAnySecondaryIcon=!0,_e(vt))}const Ke=It.getAppearances();if(Ke.length!==0&&Ke.forEach(St=>{if(!St.getProperty("icon-image"))return;const Mt=this.getCombinedIconPrimary(St,It,pt,u,de,nt,L);Mt&&_e(Mt)}),bt){const St=T.evaluate(pt,{},u).join(","),Mt=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(za.vertical)>=0;for(const vt of bt.sections)if(vt.image){const er=vt.image.getPrimary().scaleSelf(this.pixelRatio),or=er.id.toString(),Xt=oe.get(or)||[];Xt.push(er),oe.set(or,Xt)}else{const er=kv(bt.toString()),or=vt.fontStack||St,Xt=le[or]=le[or]||{};this.calculateGlyphDependencies(vt.text,Xt,Mt,this.allowVerticalPlacement,er)}}}if(y.get("symbol-placement")==="line"&&(this.features=function(Ae){const ke={},De={},at=[];let Ue=0;function ct(It){at.push(Ae[It]),Ue++}function pt(It,gt,At){const nt=De[It];return delete De[It],De[gt]=nt,at[nt].geometry[0].pop(),at[nt].geometry[0]=at[nt].geometry[0].concat(At[0]),nt}function bt(It,gt,At){const nt=ke[gt];return delete ke[gt],ke[It]=nt,at[nt].geometry[0].shift(),at[nt].geometry[0]=At[0].concat(at[nt].geometry[0]),nt}function Ot(It,gt,At){const nt=At?gt[0][gt[0].length-1]:gt[0][0];return`${It}:${nt.x}:${nt.y}`}for(let It=0;It<Ae.length;It++){const gt=Ae[It],At=gt.geometry,nt=gt.text?gt.text.toString():null;if(!nt){ct(It);continue}const Ke=Ot(nt,At),St=Ot(nt,At,!0);if(Ke in De&&St in ke&&De[Ke]!==ke[St]){const Mt=bt(Ke,St,At),vt=pt(Ke,St,at[Mt].geometry);delete ke[Ke],delete De[St],De[Ot(nt,at[vt].geometry,!0)]=vt,at[Mt].geometry=null}else Ke in De?pt(Ke,St,At):St in ke?bt(Ke,St,At):(ct(It),ke[Ke]=Ue-1,De[St]=Ue-1)}return at.filter(It=>It.geometry)}(this.features)),y.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",s.elevationFeatures){!this.elevationFeatures&&s.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ae of s.elevationFeatures)this.elevationFeatureIdToIndex.set(Ae.id,this.elevationFeatures.length),this.elevationFeatures.push(Ae)}}else y.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Ae,ke)=>Ae.sortKey-ke.sortKey)}getCombinedIconPrimary(r,s,u,d,g,y,b){let T,E;const k=r.getUnevaluatedProperties();if(k._values["icon-image"].value!==void 0){const j=s.getAppearanceValueAndResolveTokens(r,"icon-image",u,d,g);T=this.getResolvedImageFromTokens(j)}else{const j=s.getValueAndResolveTokens("icon-image",u,d,g);T=this.getResolvedImageFromTokens(j)}if(T){const j=k._values["icon-size"]||s._unevaluatedLayout._values["icon-size"];E=kx(T,r_(this.zoom,j,this.worldview),j,d,this.zoom,y,this.pixelRatio,b,this.worldview).iconPrimary}return E}updateAppearanceBasedIconTextures(r,s,u,d){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const g=this.layers[0];let y=!1,b=0;const T=g.layout,[E,k]=T.get("icon-size-scale-range"),j=ie(1,E,k);for(let R=0;R<this.symbolInstances.length;R++){const L=this.symbolInstances.get(R),z=this.appearanceFeatureData[L.featureIndex];if(z&&L.placedIconSymbolIndex>=0){const W=z.id,J=s&&W!==void 0?s[String(W)]:void 0,ee={type:"Point",id:z.id,properties:z.properties,geometry:[]},oe=this.layers[0].appearances&&this.layers[0].appearances.find(le=>le.isActive({globals:d,feature:ee,canonical:r,featureState:J}));if(z.activeAppearance===oe)continue;if(oe){z.activeAppearance=oe;const le={sortKey:void 0,text:void 0,icon:null,index:L.featureIndex,sourceLayerIndex:L.featureIndex,geometry:[],properties:z.properties,type:"Point",id:z.id};if(!oe.hasCachedIconPrimary()){const Ae=this.getCombinedIconPrimary(oe,g,ee,r,u,le,j);oe.setCachedIconPrimary(Ae)}const de=oe.getCachedIconPrimary();if(!de)continue;const Se=de.toString(),_e=this.iconAtlasPositions&&this.iconAtlasPositions.get(Se);if(_e){const Ae=g.getAppearanceValueAndResolveTokens(oe,"icon-offset",ee,r,u),ke=Ae&&Array.isArray(Ae)?Ae:[0,0];let De=nw(_e,void 0,ke,g.layout.get("icon-anchor").evaluate(ee,{},r));const at=g.getAppearanceValueAndResolveTokens(oe,"icon-rotate",ee,r,u),Ue=typeof at=="number"?at:0,ct=_e.sdf,pt=g.layout.get("icon-text-fit").constantOr("none");pt!=="none"&&z.textShaping&&z.iconTextFitPadding&&z.fontScale&&(De=KE(De,z.textShaping,pt,z.iconTextFitPadding,ke,z.fontScale));const bt=this.calculateEffectiveAppearanceIconSize(oe,d.zoom,ee,r,u,j),Ot=0,It=1+(Math.min(bd,Math.round(bt*jc))<<1),gt=eC(De,Ue,ct,pt!=="none",j);z.isUsingAppearanceVertexData||(z.isUsingAppearanceVertexData=!0,z.layoutBasedVertexData=this.icon.getIconVertexData(b,L.numIconVertices));for(let nt=0;nt<gt.length;++nt){const Ke=gt[nt],St=z.layoutBasedVertexData[0]||L.tileAnchorX,Mt=z.layoutBasedVertexData[1]||L.tileAnchorY,vt=16*Ke.pixelOffsetTL.x,er=16*Ke.pixelOffsetTL.y,or=16*Ke.pixelOffsetBR.x,Xt=16*Ke.pixelOffsetBR.y,$t=16*Ke.minFontScaleX,Fr=16*Ke.minFontScaleY;this.icon.updateIconVertexData(b,St,Mt,Math.round(32*Ke.tl.x),Math.round(32*Ke.tl.y),Ke.texPrimary.x,Ke.texPrimary.y,Ot,It,vt,er,$t,Fr),this.icon.updateIconVertexData(b+1,St,Mt,Math.round(32*Ke.tr.x),Math.round(32*Ke.tr.y),Ke.texPrimary.x+Ke.texPrimary.w,Ke.texPrimary.y,Ot,It,or,er,$t,Fr),this.icon.updateIconVertexData(b+2,St,Mt,Math.round(32*Ke.bl.x),Math.round(32*Ke.bl.y),Ke.texPrimary.x,Ke.texPrimary.y+Ke.texPrimary.h,Ot,It,vt,Xt,$t,Fr),this.icon.updateIconVertexData(b+3,St,Mt,Math.round(32*Ke.br.x),Math.round(32*Ke.br.y),Ke.texPrimary.x+Ke.texPrimary.w,Ke.texPrimary.y+Ke.texPrimary.h,Ot,It,or,Xt,$t,Fr),b+=4}const At=L.numIconVertices-4*gt.length;for(let nt=0;nt<At;++nt)this.icon.updateIconVertexData(b+nt,0,0,0,0,0,0,0,0,0,0,0,0);y=!0}else b+=L.numIconVertices}else if(z.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(b,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(b+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(b+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(b+3,0,0,0,0,0,0,0,0,0,0,0,0),y=!0),b+=L.numIconVertices,z.activeAppearance=null;else if(z.isUsingAppearanceVertexData){const de=z.layoutBasedVertexData.length/12;for(let Se=0;Se<de;++Se){const _e=Se*12;this.icon.updateIconVertexData(b+Se,z.layoutBasedVertexData[_e+0],z.layoutBasedVertexData[_e+1],z.layoutBasedVertexData[_e+2],z.layoutBasedVertexData[_e+3],z.layoutBasedVertexData[_e+4],z.layoutBasedVertexData[_e+5],z.layoutBasedVertexData[_e+6],z.layoutBasedVertexData[_e+7],z.layoutBasedVertexData[_e+8],z.layoutBasedVertexData[_e+9],z.layoutBasedVertexData[_e+10],z.layoutBasedVertexData[_e+11])}b+=de,z.isUsingAppearanceVertexData=!1,z.activeAppearance=null,y=!0}else b+=L.numIconVertices,z.activeAppearance=null}}return y}update(r,s,u,d,g,y,b){this.text.programConfigurations.updatePaintArrays(r,s,g,u,d,y,b,this.worldview),this.icon.programConfigurations.updatePaintArrays(r,s,g,u,d,y,b,this.worldview)}updateRoadElevation(r){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let s=!1;const u=Ce(r),d=1/u;let g=!1,y=!1;for(let b=0;b<this.symbolInstances.length;b++){const T=this.symbolInstances.get(b),E=qe(1,0,0),k=qe(0,1,0),{numHorizontalGlyphVertices:j,numVerticalGlyphVertices:R,numIconVertices:L,numVerticalIconVertices:z}=T,W=j>0||R>0,J=L>0,ee=this.elevationFeatures[T.elevationFeatureIndex];if(ee){const oe=new xt(T.tileAnchorX,T.tileAnchorY),le=.075+ee.pointElevation(oe);T.zOffset!==le&&(s=!0,T.zOffset=le),le!==0&&(this.hasAnyZOffset=!0);const de=ee.computeSlopeNormal(oe,d),Se=jo(gr(),qe(0,0,1),de);qi(E,E,Se),qi(k,k,Se),E[2]*=u,k[2]*=u,E[0]===1&&E[1]===0&&E[2]===0&&k[0]===0&&k[1]===1&&k[2]===0||(g=g||W,y=y||J)}if(W&&(hw(this.text.orientationVertexArray,j,E,k),hw(this.text.orientationVertexArray,R,E,k)),J){const{placedIconSymbolIndex:oe,verticalPlacedIconSymbolIndex:le}=T;oe>=0&&hw(this.icon.orientationVertexArray,L,E,k),le>=0&&hw(this.icon.orientationVertexArray,z,E,k)}}g||(this.text.orientationVertexArray=void 0),y||(this.icon.orientationVertexArray=void 0),s&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const r=(g,y,b)=>{u+=y,u>g.length&&g.resize(u);for(let T=-y;T<0;T++)g.emplace(T+u,b)},s=(g,y,b)=>{d+=y,d>g.length&&g.resize(d);for(let T=-y;T<0;T++)g.emplace(T+d,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,d=0;for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:T,numIconVertices:E}=y,k=y.zOffset,j=E>0;if((b>0||T>0)&&(r(this.text.zOffsetVertexArray,b,k),r(this.text.zOffsetVertexArray,T,k)),j){const{placedIconSymbolIndex:R,verticalPlacedIconSymbolIndex:L}=y;R>=0&&s(this.icon.zOffsetVertexArray,E,k),L>=0&&s(this.icon.zOffsetVertexArray,y.numVerticalIconVertices,k)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r,s,u,d,g){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(y=>y.appearances&&y.appearances.length>0)),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(r,s,u,d){return!!(r&&s&&u)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(r,s,u,d)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=yD(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,s){const u=this.lineVertexArray.length;if(r.segment!==void 0)for(const{x:d,y:g}of s)this.lineVertexArray.emplaceBack(d,g);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(r,s,u,d,g,y,b,T,E,k,j,R,L,z,W,J,ee,oe){const le=r.indexArray,de=r.layoutVertexArray,Se=r.globeExtVertexArray,_e=r.segments.prepareSegment(4*oe,de,le,this.canOverlap?y.sortKey:void 0),Ae=this.glyphOffsetArray.length,ke=_e.vertexLength,De=this.allowVerticalPlacement&&b===za.vertical?Math.PI/2:0,at=y.text&&y.text.sections;for(let pt=0;pt<s.length;pt++){const{tl:bt,tr:Ot,bl:It,br:gt,texPrimary:At,texSecondary:nt,pixelOffsetTL:Ke,pixelOffsetBR:St,minFontScaleX:Mt,minFontScaleY:vt,glyphOffset:er,isSDF:or,sectionIndex:Xt}=s[pt],$t=_e.vertexLength,Fr=er[1];if(Lx(de,E.x,E.y,bt.x,Fr+bt.y,At.x,At.y,u,or,Ke.x,Ke.y,Mt,vt),Lx(de,E.x,E.y,Ot.x,Fr+Ot.y,At.x+At.w,At.y,u,or,St.x,Ke.y,Mt,vt),Lx(de,E.x,E.y,It.x,Fr+It.y,At.x,At.y+At.h,u,or,Ke.x,St.y,Mt,vt),Lx(de,E.x,E.y,gt.x,Fr+gt.y,At.x+At.w,At.y+At.h,u,or,St.x,St.y,Mt,vt),T){const{x:Gt,y:vr,z:$r}=T.anchor,[nn,Pn,Gr]=T.up;Fx(Se,Gt,vr,$r,nn,Pn,Gr),Fx(Se,Gt,vr,$r,nn,Pn,Gr),Fx(Se,Gt,vr,$r,nn,Pn,Gr),Fx(Se,Gt,vr,$r,nn,Pn,Gr),a_(r.dynamicLayoutVertexArray,Gt,vr,$r,De)}else a_(r.dynamicLayoutVertexArray,E.x,E.y,E.z,De);if(J){const Gt=nt||At;zx(r.iconTransitioningVertexArray,Gt.x,Gt.y),zx(r.iconTransitioningVertexArray,Gt.x+Gt.w,Gt.y),zx(r.iconTransitioningVertexArray,Gt.x,Gt.y+Gt.h),zx(r.iconTransitioningVertexArray,Gt.x+Gt.w,Gt.y+Gt.h)}le.emplaceBack($t,$t+1,$t+2),le.emplaceBack($t+1,$t+2,$t+3),_e.vertexLength+=4,_e.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(er[0]),pt!==s.length-1&&Xt===s[pt+1].sectionIndex||r.programConfigurations.populatePaintArrays(de.length,y,y.index,{},L,z,W,at&&at[Xt],this.worldview)}const Ue=oe-s.length;Ue!==0&&this._addNullVertices(Ue,de,u,T,Se,r,J,_e,le);const ct=T?T.anchor:E;r.placedSymbolArray.emplaceBack(ct.x,ct.y,ct.z,E.x,E.y,Ae,this.glyphOffsetArray.length-Ae,ke,k,j,E.segment,u?u[0]:0,u?u[1]:0,d[0],d[1],b,0,0,0,R,0),r.symbolInstanceIndices.push(ee)}_addNullVertices(r,s,u,d,g,y,b,T,E){for(let k=0;k<r;k++){for(let R=0;R<4;R++)Lx(s,0,0,0,0,0,0,u,!1,0,0,0,0),d&&Fx(g,0,0,0,0,0,0),a_(y.dynamicLayoutVertexArray,0,0,0,0),b&&zx(y.iconTransitioningVertexArray,0,0);const j=T.vertexLength;E.emplaceBack(j,j+1,j+2),E.emplaceBack(j+1,j+2,j+3),T.vertexLength+=4,T.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(r,s,u,d,g,y,b){r.emplaceBack(s,u,d,g,y,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(r,s,u,d,g,y,b){const T=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),E=T.vertexLength,k=b.tileAnchorX,j=b.tileAnchorY;for(let L=0;L<4;L++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,s,r.padding,b.zOffset),this._commitLayoutVertex(u.layoutVertexArray,d,g,y,k,j,new xt(r.x1,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,g,y,k,j,new xt(r.x2,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,g,y,k,j,new xt(r.x2,r.y2)),this._commitLayoutVertex(u.layoutVertexArray,d,g,y,k,j,new xt(r.x1,r.y2)),T.vertexLength+=4;const R=u.indexArray;R.emplaceBack(E,E+1),R.emplaceBack(E+1,E+2),R.emplaceBack(E+2,E+3),R.emplaceBack(E+3,E),T.primitiveLength+=4}_addTextDebugCollisionBoxes(r,s,u,d,g,y){for(let b=d;b<g;b++){const T=u.get(b),E=this.getSymbolInstanceTextSize(r,y,s,b);this._addCollisionDebugVertices(T,E,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(r,s,u,d,g,y){for(let b=d;b<g;b++){const T=u.get(b),E=this.getSymbolInstanceIconSize(r,s,y.placedIconSymbolIndex);this._addCollisionDebugVertices(T,E,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,y)}}generateCollisionDebugBuffers(r,s,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new oC(Og,NM.members,ll),this.iconCollisionBox=new oC(Og,NM.members,ll);const d=n_(this.iconSizeData,r),g=n_(this.textSizeData,r,u);for(let y=0;y<this.symbolInstances.length;y++){const b=this.symbolInstances.get(y);this._addTextDebugCollisionBoxes(g,r,s,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(g,r,s,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(d,r,s,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(d,r,s,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(r,s,u,d){const g=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:d),y=YE(this.textSizeData,r,g)/oo;return this.tilePixelRatio*y}getSymbolInstanceIconSize(r,s,u){const d=this.icon.placedSymbolArray.get(u),g=YE(this.iconSizeData,r,d);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(r,s,u,d){r.emplaceBack(s,-u,-u,d),r.emplaceBack(s,u,-u,d),r.emplaceBack(s,u,u,d),r.emplaceBack(s,-u,u,d)}_updateTextDebugCollisionBoxes(r,s,u,d,g,y,b){for(let T=d;T<g;T++){const E=u.get(T),k=this.getSymbolInstanceTextSize(r,y,s,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,k,E.padding,y.zOffset)}}_updateIconDebugCollisionBoxes(r,s,u,d,g,y,b){for(let T=d;T<g;T++){const E=u.get(T),k=this.getSymbolInstanceIconSize(r,s,y.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,k,E.padding,y.zOffset)}}updateCollisionDebugBuffers(r,s,u,d){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const g=n_(this.iconSizeData,r,d),y=n_(this.textSizeData,r,u);for(let b=0;b<this.symbolInstances.length;b++){const T=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(y,r,s,T.textBoxStartIndex,T.textBoxEndIndex,T,u),this._updateTextDebugCollisionBoxes(y,r,s,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T,u),this._updateIconDebugCollisionBoxes(g,r,s,T.iconBoxStartIndex,T.iconBoxEndIndex,T,d),this._updateIconDebugCollisionBoxes(g,r,s,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T,d)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,s,u,d,g,y,b,T,E){const k={};if(s<u){const{x1:j,y1:R,x2:L,y2:z,padding:W,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:de,featureIndex:Se}=r.get(s);k.textBox={x1:j,y1:R,x2:L,y2:z,padding:W,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:de},k.textFeatureIndex=Se}if(d<g){const{x1:j,y1:R,x2:L,y2:z,padding:W,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:de,featureIndex:Se}=r.get(d);k.verticalTextBox={x1:j,y1:R,x2:L,y2:z,padding:W,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:de},k.verticalTextFeatureIndex=Se}if(y<b){const{x1:j,y1:R,x2:L,y2:z,padding:W,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:de,featureIndex:Se}=r.get(y);k.iconBox={x1:j,y1:R,x2:L,y2:z,padding:W,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:de},k.iconFeatureIndex=Se}if(T<E){const{x1:j,y1:R,x2:L,y2:z,padding:W,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:de,featureIndex:Se}=r.get(T);k.verticalIconBox={x1:j,y1:R,x2:L,y2:z,padding:W,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:de},k.verticalIconFeatureIndex=Se}return k}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const u=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(r,s){const u=r.placedSymbolArray.get(s),d=u.vertexStartIndex+4*u.numGlyphs;for(let g=u.vertexStartIndex;g<d;g+=4)r.indexArray.emplaceBack(g,g+1,g+2),r.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(r),u=Math.cos(r),d=[],g=[],y=[];for(let b=0;b<this.symbolInstances.length;++b){y.push(b);const T=this.symbolInstances.get(b);d.push(0|Math.round(s*T.tileAnchorX+u*T.tileAnchorY)),g.push(T.featureIndex)}return y.sort((b,T)=>d[b]-d[T]||g[T]-g[b]),y}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let r=0;r<this.symbolInstances.length;++r)this.symbolInstanceIndexesSortedZOffset.push(r)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((r,s)=>this.symbolInstances.get(s).zOffset-this.symbolInstances.get(r).zOffset)}addToSortKeyRanges(r,s){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===s?u.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const u=this.symbolInstances.get(s);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:E}=u;d>=0&&this.addIndicesForPlacedSymbol(this.text,d),g>=0&&g!==d&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&y!==g&&y!==d&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(r){const s=this.symbolInstances.get(this.text.symbolInstanceIndices[r]).elevationFeatureIndex;let u;return this.elevationFeatures&&s<this.elevationFeatures.length&&(u=this.elevationFeatures[s]),u}}function vD(a,r){return r.replace(/{([^{}]+)}/g,(s,u)=>u in a?String(a[u]):"")}let xD,bD,aC;rr(fw,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),fw.addDynamicAttributes=a_;class wD{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:nh,this.defaultValue=r}evaluate(r){if(r.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(r.formattedSection))return s.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}rr(wD,"FormatSectionOverride",{omit:["defaultValue"]});const lC=()=>aC||(aC={layout:xD||(xD=new Ki({"symbol-placement":new jt(Ve.layout_symbol["symbol-placement"]),"symbol-spacing":new jt(Ve.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new jt(Ve.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ht(Ve.layout_symbol["symbol-sort-key"]),"symbol-z-order":new jt(Ve.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new jt(Ve.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new jt(Ve.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new jt(Ve.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new jt(Ve.layout_symbol["icon-ignore-placement"]),"icon-optional":new jt(Ve.layout_symbol["icon-optional"]),"icon-rotation-alignment":new jt(Ve.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ht(Ve.layout_symbol["icon-size"]),"icon-size-scale-range":new jt(Ve.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Ht(Ve.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ht(Ve.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ht(Ve.layout_symbol["icon-image"]),"icon-image-use-theme":new jt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Ht(Ve.layout_symbol["icon-rotate"]),"icon-padding":new jt(Ve.layout_symbol["icon-padding"]),"icon-keep-upright":new jt(Ve.layout_symbol["icon-keep-upright"]),"icon-offset":new Ht(Ve.layout_symbol["icon-offset"]),"icon-anchor":new Ht(Ve.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new jt(Ve.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new jt(Ve.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new jt(Ve.layout_symbol["text-rotation-alignment"]),"text-field":new Ht(Ve.layout_symbol["text-field"]),"text-font":new Ht(Ve.layout_symbol["text-font"]),"text-size":new Ht(Ve.layout_symbol["text-size"]),"text-size-scale-range":new jt(Ve.layout_symbol["text-size-scale-range"]),"text-max-width":new Ht(Ve.layout_symbol["text-max-width"]),"text-line-height":new Ht(Ve.layout_symbol["text-line-height"]),"text-letter-spacing":new Ht(Ve.layout_symbol["text-letter-spacing"]),"text-justify":new Ht(Ve.layout_symbol["text-justify"]),"text-radial-offset":new Ht(Ve.layout_symbol["text-radial-offset"]),"text-variable-anchor":new jt(Ve.layout_symbol["text-variable-anchor"]),"text-anchor":new Ht(Ve.layout_symbol["text-anchor"]),"text-max-angle":new jt(Ve.layout_symbol["text-max-angle"]),"text-writing-mode":new jt(Ve.layout_symbol["text-writing-mode"]),"text-rotate":new Ht(Ve.layout_symbol["text-rotate"]),"text-padding":new jt(Ve.layout_symbol["text-padding"]),"text-keep-upright":new jt(Ve.layout_symbol["text-keep-upright"]),"text-transform":new Ht(Ve.layout_symbol["text-transform"]),"text-offset":new Ht(Ve.layout_symbol["text-offset"]),"text-allow-overlap":new jt(Ve.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new jt(Ve.layout_symbol["text-ignore-placement"]),"text-optional":new jt(Ve.layout_symbol["text-optional"]),visibility:new jt(Ve.layout_symbol.visibility)})),paint:bD||(bD=new Ki({"icon-opacity":new Ht(Ve.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Ht(Ve.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Ht(Ve.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Ht(Ve.paint_symbol["text-emissive-strength"]),"icon-color":new Ht(Ve.paint_symbol["icon-color"]),"icon-halo-color":new Ht(Ve.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ht(Ve.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ht(Ve.paint_symbol["icon-halo-blur"]),"icon-translate":new jt(Ve.paint_symbol["icon-translate"]),"icon-translate-anchor":new jt(Ve.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new jt(Ve.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Ht(Ve.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Ht(Ve.paint_symbol["text-occlusion-opacity"]),"text-color":new Ht(Ve.paint_symbol["text-color"],{runtimeType:fa,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new Ht(Ve.paint_symbol["text-halo-color"]),"text-halo-width":new Ht(Ve.paint_symbol["text-halo-width"]),"text-halo-blur":new Ht(Ve.paint_symbol["text-halo-blur"]),"text-translate":new jt(Ve.paint_symbol["text-translate"]),"text-translate-anchor":new jt(Ve.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new jt(Ve.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new jt(Ve.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new jt(Ve.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new jt(Ve.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Ht(Ve.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},aC);class pw extends Lo{constructor(r,s,u,d){super(r,lC(),s,u,d,r.layout?r.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=K([]),this.hasOcclusionOpacityProperties=r.paint!==void 0&&("icon-occlusion-opacity"in r.paint||"text-occlusion-opacity"in r.paint)}_handleSpecialPaintPropertyUpdate(r){r!=="icon-occlusion-opacity"&&r!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(r,s){super.recalculate(r,s),this.appearances&&this.appearances.forEach(d=>{d.recalculate(r,s,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const d=[];for(const g of u)d.indexOf(g)<0&&d.push(g);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(r,s,u,d){return this._saturation===r&&this._contrast===s&&this._brightnessMin===u&&this._brightnessMax===d||(this._colorAdjustmentMatrix=function(g,y,b,T){g=Gi(g),y=Ci(y);const E=Y(),k=g/3,j=1-2*k,R=[j,k,k,0,k,j,k,0,k,k,j,0,0,0,0,1],L=.5-.5*y,z=T-b;return G(E,[z,0,0,0,0,z,0,0,0,0,z,0,b,b,b,1],[y,0,0,0,0,y,0,0,0,0,y,0,L,L,L,1]),G(E,E,R),E}(r,s,u,d),this._saturation=r,this._contrast=s,this._brightnessMin=u,this._brightnessMax=d),this._colorAdjustmentMatrix}getValueAndResolveTokens(r,s,u,d){const g=this.layout.get(r).evaluate(s,{},u,d),y=this._unevaluatedLayout._values[r];return y.isDataDriven()||Sg(y.value)||!g?g:vD(s.properties,g)}getAppearanceValueAndResolveTokens(r,s,u,d,g){const y=r.getProperty(s);if(!y)return;const b=y.evaluate(u,{},d,g),T=r.getUnevaluatedProperties()._values[s];return T.isDataDriven()||Sg(T.value)||!b||typeof b!="string"?b:vD(u.properties,b)}createBucket(r){return new fw(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of lC().paint.overridableProperties){if(!pw.hasPaintOverride(this.layout,r))continue;const s=this.paint.get(r),u=new wD(s),d=new wg(u,s.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let g=null;g=s.value.kind==="constant"||s.value.kind==="source"?new Ip("source",d):new _u("composite",d,s.value.zoomStops,s.value.interpolationType),this.paint._values[r]=new al(s.property,g,s.parameters)}}_handleOverridablePaintPropertyUpdate(r,s,u){return!(!this.layout||s.isDataDriven()||u.isDataDriven())&&pw.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,s){const u=r.get("text-field"),d=lC().paint.properties[s];let g=!1;const y=b=>{for(const T of b)if(d.overrides&&d.overrides.hasOverride(T))return void(g=!0)};if(u.value.kind==="constant"&&u.value.value instanceof Vs)y(u.value.value.sections);else if(u.value.kind==="source"){const b=E=>{g||(E instanceof bc&&zs(E.value)===nd?y(E.value.sections):E instanceof id?y(E.sections):E.eachChild(b))},T=u.value;T._styleExpression&&b(T._styleExpression.expression)}return g}getProgramIds(){return["symbol"]}getDefaultProgramParams(r,s,u){return{config:new Ic(this,{zoom:s,lut:u}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let SD,TD,ED,CD;var cC=fn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function mw(a,r,s,u,d,g,y,b){const T=[a,r,1,s,u,1,d,g,1],E=[y,b,1],k=$([],T),[j,R,L]=os(E,E,k);return B(T,T,[j,0,0,0,R,0,0,0,L])}function AD(a,r,s,u,d,g,y,b){const T=function(E,k,j,R,L,z,W,J){const ee=mw(0,0,1,0,1,1,0,1),oe=mw(E,k,j,R,L,z,W,J);return B(oe,oe,$([],ee))}(a,r,s,u,d,g,y,b);return[T[2]/T[8]/zt,T[5]/T[8]/zt]}function gw(a){return[a[0],Math.min(Math.max(a[1],-fe),fe)]}class ID extends yc{constructor(r,s,u,d){super(),this.id=r,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(d),this.options=s,this._dirty=!1}load(r,s){if(this._loaded=s||!1,this.fire(new Aa("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return r&&(this.coordinates=r),this._loaded=!0,void this._finishLoading();this._imageRequest=Xy(this.map._requestManager.transformRequest(this.url,ed.Image),(u,d)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new ap(u)):d&&(this.image=d instanceof HTMLImageElement?ha.getImageData(d):d,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading())})}loaded(){return this._loaded}updateImage(r){return r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}setTexture(r){if(!(r.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Sx(this.map.painter.context,r.handle),this.width=r.dimensions[0],this.height=r.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Aa("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(r){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Sx||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(r){if(this.coordinates=r,this._boundsArray=void 0,this._unsupportedCoords=!1,!r.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let s=r[0][1],u=r[0][1];for(const g of r)g[1]>u&&(u=g[1]),g[1]<s&&(s=g[1]);const d=(u+s)/2;if(d>fe?this.onNorthPole=!0:d<-fe&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const g=r.map(Fe.fromLngLat);this.tileID=function(y){let b=1/0,T=1/0,E=-1/0,k=-1/0;for(const W of y)b=Math.min(b,W.x),T=Math.min(T,W.y),E=Math.max(E,W.x),k=Math.max(k,W.y);const j=Math.max(E-b,k-T),R=Math.max(0,Math.floor(-Math.log2(j))),L=Math.pow(2,R);let z=Math.floor((b+E)/2*L);return z>1&&(z-=1),new Na(R,z,Math.floor((T+k)/2*L))}(g),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Aa("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Sx||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(r){for(const ee in this.tiles){const oe=this.tiles[ee];oe.state!=="loaded"&&(oe.state="loaded",oe.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const s=Rx(new Na(0,0,0),this.map.transform.projection),u=[s.projection.project(this.coordinates[0][0],this.coordinates[0][1]),s.projection.project(this.coordinates[1][0],this.coordinates[1][1]),s.projection.project(this.coordinates[2][0],this.coordinates[2][1]),s.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(ee){const oe=ee[1].x-ee[0].x,le=ee[1].y-ee[0].y,de=ee[2].x-ee[1].x,Se=ee[2].y-ee[1].y,_e=ee[3].x-ee[2].x,Ae=ee[3].y-ee[2].y,ke=ee[0].x-ee[3].x,De=ee[0].y-ee[3].y,at=oe*Se-de*le,Ue=de*Ae-_e*Se,ct=_e*De-ke*Ae,pt=ke*le-oe*De;return at>0&&Ue>0&&ct>0&&pt>0||at<0&&Ue<0&&ct<0&&pt<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const d=Rx(this.tileID,this.map.transform.projection),[g,y,b,T]=this.coordinates.map(ee=>{const oe=d.projection.project(ee[0],ee[1]);return fD(d,oe)._round()});this.perspectiveTransform=AD(g.x,g.y,y.x,y.y,b.x,b.y,T.x,T.y);const E=this._boundsArray=new Ih;E.emplaceBack(g.x,g.y,0,0),E.emplaceBack(y.x,y.y,zt,0),E.emplaceBack(T.x,T.y,0,zt),E.emplaceBack(b.x,b.y,zt,zt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=r.createVertexBuffer(E,cC.members),this.boundsSegments=Vi.simpleSegment(0,0,4,2);const k=[],j=[gw((R=this.coordinates)[0]),gw(R[1]),gw(R[2]),gw(R[3])];var R;const[L,z,W,J]=function(ee){let oe=ee[0][0],le=oe,de=ee[0][1],Se=de;for(let _e=1;_e<ee.length;_e++)ee[_e][0]<oe?oe=ee[_e][0]:ee[_e][0]>le&&(le=ee[_e][0]),ee[_e][1]<de?de=ee[_e][1]:ee[_e][1]>Se&&(Se=ee[_e][1]);return[oe,de,le-oe,Se-de]}(j);{const ee=new Ih,[oe,le,de,Se]=function(gt){let At=gt[0].x,nt=At,Ke=gt[0].y,St=Ke;for(let Mt=1;Mt<gt.length;Mt++)gt[Mt].x<At?At=gt[Mt].x:gt[Mt].x>nt&&(nt=gt[Mt].x),gt[Mt].y<Ke?Ke=gt[Mt].y:gt[Mt].y>St&&(St=gt[Mt].y);return[At,Ke,nt-At,St-Ke]}(u),_e=gt=>[(gt.x-oe)/de,(gt.y-le)/Se],[Ae,ke,De,at]=u.map(_e),Ue=function(gt,At,nt,Ke,St,Mt,vt,er){const or=mw(0,0,1,0,1,1,0,1);return B(or,or,$([],mw(gt,At,nt,Ke,St,Mt,vt,er)))}(Ae[0],Ae[1],ke[0],ke[1],De[0],De[1],at[0],at[1]);this.elevatedGlobePerspectiveTransform=AD(Ae[0],Ae[1],ke[0],ke[1],De[0],De[1],at[0],at[1]);const ct=(gt,At)=>{k.push(gt.lng);const nt=Math.round((gt.lng-L)/W*zt),Ke=Math.round((gt.lat-z)/J*zt),St=_e(At),Mt=os([],[St[0],St[1],1],Ue),vt=Math.round(Mt[0]/Mt[2]*zt),er=Math.round(Mt[1]/Mt[2]*zt);ee.emplaceBack(nt,Ke,vt,er)},pt=u[3].x-u[0].x,bt=u[3].y-u[0].y,Ot=u[2].x-u[1].x,It=u[2].y-u[1].y;for(let gt=0;gt<65;gt++){const At=gt/64,nt=[u[0].x+At*pt,u[0].y+At*bt],Ke=[u[1].x+At*Ot,u[1].y+At*It],St=Ke[0]-nt[0],Mt=Ke[1]-nt[1];for(let vt=0;vt<65;vt++){const er=vt/64,or={x:nt[0]+St*er,y:nt[1]+Mt*er};ct(s.projection.unproject(or.x,or.y),or)}}this.elevatedGlobeVertexBuffer=r.createVertexBuffer(ee,cC.members)}{this.maxLongitudeTriangleSize=0;let ee=[],oe=new Mi;const le=(de,Se,_e)=>{oe.emplaceBack(de,Se,_e);const Ae=k[de],ke=k[Se],De=k[_e],at=Math.min(Math.min(Ae,ke),De),Ue=Math.max(Math.max(Ae,ke),De)-at;Ue>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ue),ee.push(at+Ue/2)};for(let de=0;de<64;de++)for(let Se=0;Se<64;Se++){const _e=65*de+Se,Ae=_e+1,ke=_e+65,De=ke+1;le(_e,ke,Ae),le(Ae,ke,De)}[ee,oe]=function(de,Se){const _e=Array.from({length:de.length},(De,at)=>at);_e.sort((De,at)=>de[De]-de[at]);const Ae=[],ke=new Mi;for(let De=0;De<_e.length;De++){const at=_e[De];Ae.push(de[at]);const Ue=3*at,ct=Ue+1;ke.emplaceBack(Se.uint16[Ue],Se.uint16[ct],Se.uint16[ct+1])}return[Ae,ke]}(ee,oe),this.elevatedGlobeTrianglesCenterLongitudes=ee,this.elevatedGlobeIndexBuffer=r.createIndexBuffer(oe)}this.elevatedGlobeSegments=Vi.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,W/zt,0,J/zt,0,0,z,L,0])}prepare(){const r=Object.keys(this.tiles).length!==0;if(this.tileID&&!r)return;const s=this.map.painter.context,u=s.gl;!this._dirty||this.texture instanceof Sx||(this.texture?this.texture.update(this.image):(this.texture=new NE(s,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),r&&this._prepareData(s)}loadTile(r,s){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},s(null)):(r.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(r){const s=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!s)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let d=(g=r+180)+360*Math.round((u[0]-g)/360);var g;const y=new Vi,b=(j,R)=>{y.segments.push({vertexOffset:0,primitiveOffset:j,vertexLength:s.segments[0].vertexLength,primitiveLength:R,sortKey:void 0,vaos:{}})},T=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-d)<=T){const j=wn(u,0,u.length,d+T);return j===u.length||b(j,ni(u,j+1,u.length,d+360-T)-j),y}d<u[0]&&(d+=360);const E=ni(u,0,u.length,d-T);if(E===u.length)return b(0,u.length),y;b(0,E-0);const k=wn(u,E+1,u.length,d+T);return k!==u.length&&b(k,u.length-k),y}}const uG=(Math.pow(256,2)-1)/16907520;class PD extends Lo{constructor(r,s,u,d){super(r,{layout:ED||(ED=new Ki({visibility:new jt(Ve.layout_raster.visibility)})),paint:CD||(CD=new Ki({"raster-opacity":new jt(Ve.paint_raster["raster-opacity"]),"raster-color":new Sh(Ve.paint_raster["raster-color"]),"raster-color-mix":new jt(Ve.paint_raster["raster-color-mix"]),"raster-color-range":new jt(Ve.paint_raster["raster-color-range"]),"raster-hue-rotate":new jt(Ve.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new jt(Ve.paint_raster["raster-brightness-min"]),"raster-brightness-max":new jt(Ve.paint_raster["raster-brightness-max"]),"raster-saturation":new jt(Ve.paint_raster["raster-saturation"]),"raster-contrast":new jt(Ve.paint_raster["raster-contrast"]),"raster-resampling":new jt(Ve.paint_raster["raster-resampling"]),"raster-fade-duration":new jt(Ve.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new jt(Ve.paint_raster["raster-emissive-strength"]),"raster-array-band":new jt(Ve.paint_raster["raster-array-band"]),"raster-elevation":new jt(Ve.paint_raster["raster-elevation"]),"raster-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},s,u,d),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(r){return!(r&&r._source instanceof ID&&(r._source.onNorthPole||r._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(r){r!=="raster-color"&&r!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(r){if(!this.hasColorMap()||!this._curRampRange)return;const s=this._transitionablePaint._values["raster-color"].value.expression,[u,d]=r||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(d)||u===this._curRampRange[0]&&d===this._curRampRange[1]||(this.colorRamp=lx({expression:s,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:d}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,d])}}let kD,jD,RD,MD,DD;class ND extends Lo{constructor(r,s,u,d){super(r,{layout:kD||(kD=new Ki({visibility:new jt(Ve["layout_raster-particle"].visibility)})),paint:jD||(jD=new Ki({"raster-particle-array-band":new jt(Ve["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new jt(Ve["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Sh(Ve["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new jt(Ve["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new jt(Ve["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new jt(Ve["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new jt(Ve["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new jt(Ve["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},s,u,d),this._updateColorRamp(),this.lastInvalidatedAt=ha.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(r){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(r){return!1}_handleSpecialPaintPropertyUpdate(r){r!=="raster-particle-color"&&r!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),r==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const r=this._transitionablePaint._values["raster-particle-color"].value.expression,s=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=lx({expression:r,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:s}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ha.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class dG extends Lo{constructor(r,s){super(r,{},s,null),this.implementation=r,r.slot&&(this.slot=r.slot)}is3D(r){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(r){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}function uC(a,r,s){const u=[0,0,1],d=Or([]);return gi(d,d,s?-ln(a)+Math.PI:ln(a)),Ln(d,d,-ln(r)),qi(u,u,d),Er(u,u)}const OD={None:0,Model:1,Symbol:2,FillExtrusion:4};class _w{constructor(r,s,u,d){this.message=(r?`${r}: `:"")+u,d&&(this.identifier=d),s!=null&&s.__line__&&(this.line=s.__line__)}}function dC(a,r){const s=a.indexOf("://")===-1;try{return new URL(a,s&&r?"http://example.com":void 0),!0}catch{return!1}}class LD{constructor(r,s){this.feature=r,this.instancedDataOffset=s,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class zD{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new zg,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(r){const s=16*r,u=this.instancedDataArray.float32;let d=Math.floor(u[s+2]);const g=1.05*(u[s+2]-d);return d/=100,[u[s]%1*1.05,u[s+1]%1*1.05,g,d]}tileCoordinatesForInstance(r){const s=16*r,u=this.instancedDataArray.float32;let d=u[s+0];return d=d>zt?d-zt:d,new xt(Math.trunc(d),Math.trunc(u[s+1]))}translationForInstance(r){const s=16*r,u=this.instancedDataArray.float32;return[u[s+4],u[s+5],u[s+6]]}rotationScaleForInstance(r){const s=16*r,u=this.instancedDataArray.float32;return[u[s+7],u[s+8],u[s+9],u[s+10],u[s+11],u[s+12],u[s+13],u[s+14],u[s+15]]}transformForInstance(r){const s=16*r,u=this.instancedDataArray.float32;return[u[s+7],u[s+8],u[s+9],u[s+4],u[s+10],u[s+11],u[s+12],u[s+5],u[s+13],u[s+14],u[s+15],u[s+6],0,0,0,1]}}class hC{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaledZ=this.canonical.z+Math.log2(r.overscaling),this.layers=r.layers,this.layerIds=this.layers.map(s=>s.fqid),this.projection=r.projection,this.index=r.index,this.worldview=r.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=r.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(r,s){}updateAppearances(r,s,u,d){}populate(r,s,u,d){this.tileToMeter=Ce(u);const g=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:y,id:b,index:T,sourceLayerIndex:E}of r){const k=b??(y.properties&&y.properties.hasOwnProperty("id")?y.properties.id:void 0),j=Ze(y,g);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom,{worldview:this.worldview,activeFloors:s.activeFloors}),j,u))continue;const R={id:k,sourceLayerIndex:E,index:T,geometry:g?j.geometry:ft(y,u,d),properties:y.properties,type:y.type,patterns:{}},L=this.addFeature(R,R.geometry,j);L&&s.featureIndex.insert(y,R.geometry,T,E,this.index,this.instancesPerModel[L].instancedDataArray.length,zt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const r=this.layers[0].modelManager,s=this.layers[0].scope;let u=0;for(const d of this.modelUris){const g=r.getModel(d,s);if(!g)continue;const y=this.instancesPerModel[d];if(y){const b=.5*ir(g.aabb.max,g.aabb.min)*y.maxScale+y.maxXYTranslationDistance,T=Math.min(zt,Math.max(b/this.tileToMeter,zt/32));u=Math.max(T,u)}}return u}update(r,s,u,d){for(const g in this.instancesPerModel){const y=this.instancesPerModel[g];for(const b in r)y.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(y.features[y.idToFeaturesIndex[b]],r[b],y,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let r=!1;for(const s in this.instancesPerModel){const u=this.instancesPerModel[s];for(const d of u.features){const g=this.layers[0],y=d.feature,b=this.canonical,T=g.paint.get("model-rotation").evaluate(y,{},b),E=g.paint.get("model-scale").evaluate(y,{},b),k=g.paint.get("model-translation").evaluate(y,{},b);Os(d.rotation,T)&&Os(d.scale,E)&&Os(d.translation,k)||(this.evaluate(d,d.featureStates,u,!0),r=!0)}}return r}updateReplacement(r,s,u,d){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const g=s.getReplacementRegionsForTile(r.toUnwrapped(),!0);if(V1(this.activeReplacements,g))return!1;this.activeReplacements=g;let y=!1;for(const b in this.instancesPerModel){const T=this.instancesPerModel[b],E=T.instancedDataArray;for(const k of T.features){const j=k.instancedDataOffset,R=k.instancedDataCount;for(let L=0;L<R;L++){const z=16*(L+j);let W=E.float32[z+0];const J=W>zt;W=J?W-zt:W;const ee=Math.floor(W),oe=Math.floor(E.float32[z+1]);let le=!1;for(const de of this.activeReplacements)if(!SR(de,u,OD.Model,d)&&!(de.min.x>ee||ee>de.max.x||de.min.y>oe||oe>de.max.y)&&(le=SE(AR(ee,oe,r.canonical,de.footprintTileId.canonical),de.footprint),le))break;E.float32[z]=le?W+zt:W,y=y||le!==J}}}return y}isEmpty(){for(const r in this.instancesPerModel)if(this.instancesPerModel[r].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(r){if(!this.uploaded)for(const s in this.instancesPerModel){const u=this.instancesPerModel[s];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=r.createVertexBuffer(u.instancedDataArray,z8.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const s in this.instancesPerModel){const u=this.instancesPerModel[s];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const r=this.layers[0].modelManager;if(r&&this.modelUris&&this.modelsRequested)for(const s of this.modelUris)r.removeModel(s,"",!0)}addFeature(r,s,u){const d=this.layers[0],g=d.layout.get("model-id").evaluate(u,{},this.canonical);if(!g)return br(`modelId is not evaluated for layer ${d.id} and it is not going to get rendered.`),g;(dC(g,!1)||this.styleDefinedModelURLs[g]!==void 0)&&(this.modelUris.includes(g)||this.modelUris.push(g)),this.instancesPerModel[g]||(this.instancesPerModel[g]=new zD);const y=this.instancesPerModel[g],b=y.instancedDataArray,T=new LD(u,b.length);for(const E of s)for(const k of E){if(k.x<0||k.x>=zt||k.y<0||k.y>=zt)continue;if(this.lookupDim!==0){const R=(this.lookupDim-1)/zt,L=this.lookupDim*(k.y*R|0)+k.x*R|0;if(this.lookup){if(this.lookup[L]!==0)continue;this.lookup[L]=1}}this.instanceCount++;const j=b.length;b.resize(j+1),y.instancesEvaluatedElevation.push(0),b.float32[16*j]=k.x,b.float32[16*j+1]=k.y}return T.instancedDataCount=y.instancedDataArray.length-T.instancedDataOffset,T.instancedDataCount>0&&(r.id&&(y.idToFeaturesIndex[r.id]=y.features.length),y.features.push(T),this.evaluate(T,{},y,!1)),g}getModelUris(){return this.modelUris}evaluate(r,s,u,d){const g=this.layers[0],y=r.feature,b=this.canonical,T=r.rotation=g.paint.get("model-rotation").evaluate(y,s,b),E=r.scale=g.paint.get("model-scale").evaluate(y,s,b),k=r.translation=g.paint.get("model-translation").evaluate(y,s,b),j=Object.assign({},g.paint.get("model-color").evaluate(y,s,b));j.a=g.paint.get("model-color-mix-intensity").evaluate(y,s,b);const R=[];this.maxVerticalOffset<k[2]&&(this.maxVerticalOffset=k[2]);const L=k[0]*k[0]+k[1]*k[1],z=L>0?Math.sqrt(L):0;u.maxScale=Math.max(Math.max(u.maxScale,E[0]),Math.max(E[1],E[2])),u.maxXYTranslationDistance=Math.max(u.maxXYTranslationDistance,z),this.maxScale=Math.max(Math.max(this.maxScale,E[0]),Math.max(E[1],E[2])),fM(R,T,E);const W=Math.round(100*j.a)+j.b/1.05;for(let J=0;J<r.instancedDataCount;++J){const ee=r.instancedDataOffset+J,oe=16*ee,le=u.instancedDataArray.float32;let de=0;d&&(de=le[oe+6]-u.instancesEvaluatedElevation[ee]);const Se=0|le[oe+1];le[oe]=(0|le[oe])+j.r/1.05,le[oe+1]=Se+j.g/1.05,le[oe+2]=W,le[oe+3]=1/(b.z>10?this.tileToMeter:Ce(b,Se)),le[oe+4]=k[0],le[oe+5]=k[1],le[oe+6]=k[2]+de,le[oe+7]=R[0],le[oe+8]=R[1],le[oe+9]=R[2],le[oe+10]=R[4],le[oe+11]=R[5],le[oe+12]=R[6],le[oe+13]=R[8],le[oe+14]=R[9],le[oe+15]=R[10],u.instancesEvaluatedElevation[ee]=k[2]}}}let FD,BD;rr(hC,"ModelBucket",{omit:["layers"]}),rr(zD,"PerModelAttributes"),rr(LD,"ModelFeature");class l_{constructor(r,s,u){this._demTile=r,this._dem=this._demTile.dem,this._scale=s,this._offset=u}static create(r,s,u){const d=u||r.findDEMTileFor(s);if(!d||!d.dem)return;const g=d.dem,y=d.tileID,b=1<<s.canonical.z-y.canonical.z;return new l_(d,g.dim/zt/b,[(s.canonical.x/b-y.canonical.x)*g.dim,(s.canonical.y/b-y.canonical.y)*g.dim])}tileCoordToPixel(r,s){const u=s*this._scale+this._offset[1];return new xt(Math.floor(r*this._scale+this._offset[0]),Math.floor(u))}getElevationAt(r,s,u,d){const g=r*this._scale+this._offset[0],y=s*this._scale+this._offset[1],b=Math.floor(g),T=Math.floor(y),E=this._dem;return d=!!d,u?Rr(Rr(E.get(b,T,d),E.get(b,T+1,d),y-T),Rr(E.get(b+1,T,d),E.get(b+1,T+1,d),y-T),g-b):E.get(b,T,d)}getElevationAtPixel(r,s,u){return this._dem.get(r,s,!!u)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*ae(1,r)*this._dem.stride}}const fC=new Float32Array(262144),Wp=new Uint8Array(262144);function VD(a){let r=0;if(a.meshes)for(const s of a.meshes)r=Math.max(r,s.aabb.max[2]);if(a.children)for(const s of a.children)r=Math.max(r,VD(s));return r}function UD(a,r,s){if(a.meshes)for(const u of a.meshes){if(u.aabb.min[0]===1/0)continue;const d=en.applyTransform(u.aabb,a.globalMatrix);s.insert(r,d.min[0],d.min[1],d.max[0],d.max[1])}if(a.children)for(const u of a.children)UD(u,r,s)}const $D=["","wall","door","roof","window","lamp","logo"];class qD{constructor(r){this.node=r,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:r.id,geometry:[],properties:{height:VD(r)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new en([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let r=0;const s=new en([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==r&&(u.transformedAabb=en.applyTransformFast(u.aabb,this.node.globalMatrix),s.encapsulate(u.transformedAabb)),r++;this.aabb=s}return this.aabb}}class yw{constructor(r,s,u,d,g,y,b,T){this.id=u,this.layers=r,this.layerIds=this.layers.map(E=>E.fqid),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.modelTraits|=Qg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,d&&(this.modelTraits|=Qg.HasMapboxMeshFeatures),g&&(this.modelTraits|=Qg.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=y,this.worldview=T,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const E of s)this.nodesInfo.push(new qD(E)),UD(E,b.featureIndexArray.length,b.grid),b.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,b.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(r,s){for(const u of this.getNodesInfo()){const d=u.node;d.footprint&&s.push({footprint:d.footprint,id:r})}}updateAppearances(r,s,u,d){}update(r){const s=Object.keys(r).length!==0;if(s&&!this.stateDependentLayers.length)return;const u=s?this.stateDependentLayers:this.layers;if(!wo(r,this.states))for(const d of u)this.evaluate(d,r);this.states=structuredClone(r)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(r){if(!this.needsUpload)return;const s=this.getNodesInfo();for(const u of s){const d=u.node;this.uploaded?this.updatePbrBuffer(d):zE(d,r,!0)}for(const u of s)Q1(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(r){let s=!1;if(!r.meshes)return s;for(const u of r.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),s=!0);return s}needsReEvaluation(r,s,u){const d=r.transform.projectionOptions,g=r.style.getBrightness(),y=this.brightness!==g;if(!this.uploaded||this.dirty||d.name!==this.projection.name||Bx(u.paint.get("model-color").value,y)||Bx(u.paint.get("model-color-mix-intensity").value,y)||Bx(u.paint.get("model-roughness").value,y)||Bx(u.paint.get("model-emissive-strength").value,y)||Bx(u.paint.get("model-height-based-emissive-strength-multiplier").value,y)){this.projection=d,this.brightness=g;const b=this.getNodesInfo();for(const T of b)T.state=null;return!0}return!1}evaluateTransform(r,s){if(r.transform.zoom===this.zoom)return;this.zoom=r.transform.zoom;const u=this.getNodesInfo(),d=this.id.canonical;for(const g of u){const y=g.feature;g.evaluatedTranslation=s.paint.get("model-translation").evaluate(y,{},d),g.evaluatedScale=s.paint.get("model-scale").evaluate(y,{},d)}}evaluate(r,s){const u=this.getNodesInfo();for(const d of u){if(!d.node.meshes)continue;const g=d.feature,y=s&&s[g.id];if(wo(y,d.state))continue;d.state=structuredClone(y);const b=d.node.meshes&&d.node.meshes[0].featureData,T=d.evaluatedColor[2],E=d.evaluatedRMEA[2],k=this.id.canonical;if(d.hasTranslucentParts=!1,b){for(let j=0;j<$D.length;j++){const R=$D[j];R.length&&(g.properties.part=R);const L=r.paint.get("model-color").evaluate(g,y,k).toPremultipliedRenderColor(null),z=r.paint.get("model-color-mix-intensity").evaluate(g,y,k);d.evaluatedColor[j]=[L.r,L.g,L.b,z],d.evaluatedRMEA[j][0]=r.paint.get("model-roughness").evaluate(g,y,k),d.evaluatedRMEA[j][2]=r.paint.get("model-emissive-strength").evaluate(g,y,k),d.evaluatedRMEA[j][3]=L.a,d.emissionHeightBasedParams[j]=r.paint.get("model-height-based-emissive-strength-multiplier").evaluate(g,y,k),!d.hasTranslucentParts&&L.a<1&&(d.hasTranslucentParts=!0)}delete g.properties.part,fG(d,T!==d.evaluatedColor[2]||E!==d.evaluatedRMEA[2],this.modelTraits)}else d.evaluatedRMEA[0][2]=r.paint.get("model-emissive-strength").evaluate(g,y,k);d.evaluatedTranslation=r.paint.get("model-translation").evaluate(g,y,k),d.evaluatedScale=r.paint.get("model-scale").evaluate(g,y,k),this.updatePbrBuffer(d.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(r,s,u,d){const g=r.findDEMTileFor(u);if(g&&(g.tileID.canonical!==this.terrainTile||s!==this.terrainExaggeration)){if(g.dem&&g.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=g.tileID.overscaledZ;const y=l_.create(r,u,g);if(!y)return;this.modelTraits&Qg.HasMapboxMeshFeatures&&this.updateDEM(r,y,u,d);for(const b of this.getNodesInfo()){const T=b.node;if(!T.footprint||!T.footprint.vertices||!T.footprint.vertices.length)continue;const E=T.footprint.vertices;let k=y.getElevationAt(E[0].x,E[0].y,!0,!0);for(let j=1;j<E.length;j++)k=Math.min(k,y.getElevationAt(E[j].x,E[j].y,!0,!0));T.elevation=k}}this.terrainTile=g.tileID.canonical,this.terrainExaggeration=s}}updateDEM(r,s,u,d){let g=s._dem._modifiedForSources[d];if(g===void 0&&(s._dem._modifiedForSources[d]=[],g=s._dem._modifiedForSources[d]),g.includes(u.canonical))return;const y=s._dem.dim;g.push(u.canonical);let b=!1;for(const T of this.getNodesInfo()){const E=T.node;if(!E.footprint||!E.footprint.grid)continue;const k=E.footprint.grid,j=s.tileCoordToPixel(k.min.x,k.min.y),R=s.tileCoordToPixel(k.max.x,k.max.y),L=Math.min(Math.min(y-R.y,j.x),Math.min(j.y,y-R.x));if(L<0)continue;const z=ie(L,2,5);let W=Math.max(0,j.x-z),J=Math.max(0,j.y-z),ee=Math.min(R.x+z,y-1),oe=Math.min(R.y+z,y-1);for(let _e=J;_e<=oe;++_e)for(let Ae=W;Ae<=ee;++Ae)Wp[_e*y+Ae]=255;let le=0,de=0;for(let _e=0;_e<k.cellsY;++_e)for(let Ae=0;Ae<k.cellsX;++Ae){if(!k.cells[_e*k.cellsX+Ae])continue;const ke=s.tileCoordToPixel(k.min.x+Ae/k.xScale,k.min.y+_e/k.yScale),De=s.tileCoordToPixel(k.min.x+(Ae+1)/k.xScale,k.min.y+(_e+1)/k.yScale);for(let at=ke.y;at<=Math.min(De.y+1,y-1);++at)for(let Ue=ke.x;Ue<=Math.min(De.x+1,y-1);++Ue)Wp[at*y+Ue]===255&&(Wp[at*y+Ue]=0,le+=s.getElevationAtPixel(Ue,at),de++)}const Se=le/de;W=Math.max(1,j.x-z),J=Math.max(1,j.y-z),ee=Math.min(R.x+z,y-2),oe=Math.min(R.y+z,y-2),b=!0;for(let _e=J;_e<=oe;++_e)for(let Ae=W;Ae<=ee;++Ae)Wp[_e*y+Ae]===0&&(fC[_e*y+Ae]=s._dem.set(Ae,_e,Se));for(let _e=1;_e<z;++_e){W=Math.max(1,j.x-_e),J=Math.max(1,j.y-_e),ee=Math.min(R.x+_e,y-2),oe=Math.min(R.y+_e,y-2);for(let Ae=J;Ae<=oe;++Ae)for(let ke=W;ke<=ee;++ke){const De=Ae*y+ke;if(Wp[De]===255){let at=0,Ue=0,ct=-1,pt=-1;for(let bt=-1;bt<=1;++bt)for(let Ot=-1;Ot<=1;++Ot){const It=(Ae+bt)*y+ke+Ot;if(Wp[It]>=_e)continue;const gt=fC[It],At=Math.abs(gt);At>Ue&&(at=gt,Ue=At,ct=Ot,pt=bt)}if(Ue>.1){const bt=1-(_e+.5*Math.abs(ct*pt))/z;let Ot=s._dem.get(ke,Ae)+at*bt;const It=s._dem.get(ke+ct,Ae+pt),gt=s._dem.get(ke-ct,Ae-pt,!0);(Ot-It)*(Ot-gt)>0&&(Ot=(It+gt)/2),fC[De]=s._dem.set(ke,Ae,Ot),Wp[De]=_e}}}}}b&&(s._demTile.needsDEMTextureUpload=!0,s._dem._timestamp=ha.now())}setFilter(r){this.filter=r?Pg(r):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(r=>this.filter.filter(new wi(this.id.overscaledZ,{worldview:this.worldview}),r.feature,this.id.canonical)):this.nodesInfo}destroy(){const r=this.getNodesInfo();for(const s of r)Q1(s.node),FE(s.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(r,s){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const u=s.getReplacementRegionsForTile(r.toUnwrapped());for(const d of this.getNodesInfo()){const g=d.node.footprint;d.hiddenByReplacement=!!g&&!u.find(y=>y.footprint===g)}}getHeightAtTileCoord(r,s){const u=[],d=[0,0,0],g=K([]);for(const y of this.getNodesInfo()){const b=y.node.meshes[0],T=b.transformedAabb;if(r<T.min[0]||s<T.min[1]||r>T.max[0]||s>T.max[1])continue;if(y.node.hidden===!0)return{height:1/0,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};re(g,y.node.globalMatrix),d[0]=r,d[1]=s,yn(d,d,g);const E=(d[0]-b.aabb.min[0])/(b.aabb.max[0]-b.aabb.min[0])*$p|0,k=Math.min(63,(d[1]-b.aabb.min[1])/(b.aabb.max[1]-b.aabb.min[1])*$p|0)*$p+Math.min(63,E),j=b.heightmap[k];if(!(j<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:j,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new xt(r,s),new xt(r,s),u),u.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function Bx(a,r){return a instanceof Ip&&!a.isLightConstant&&r}function hG(a,r,s,u,d,g,y,b){let T=(61440&r|(61440&r)>>4)>>8,E=(3840&r|(3840&r)>>4)>>4,k=240&r|(240&r)>>4;s[3]>0&&(T=Rr(T,255*s[0],s[3]),E=Rr(E,255*s[1],s[3]),k=Rr(k,255*s[2],s[3]));const j=T<<8|E,R=k<<8|Math.floor(255*u[3]),L=function(_e){const Ae=ie(_e,0,2);return Math.min(Math.round(.5*Ae*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],z=ie(d[0],0,1),W=ie(d[1],0,1),J=ie(d[2],0,1),ee=ie(d[3],0,1);let oe,le,de,Se;if(z!==W&&y!==g&&W!==z){const _e=y-g;le=1/(_e*(W-z)),de=-(g+_e*z)/(_e*(W-z));const Ae=ie(d[4],-1,1);Se=Math.pow(10,Ae),oe=255*J<<8|255*ee}else oe=65535,le=0,de=1,Se=1;if(a.emplaceBack(j,R,L,oe,le,de,Se),b){const _e=b.length;b.clear();for(let Ae=0;Ae<_e;Ae++)b.emplaceBack(j,R,L,oe,le,de,Se)}}function fG(a,r,s){const u=a.node;let d=0;const g=s&Qg.HasMeshoptCompression;for(const y of u.meshes){if(u.lights&&u.lightMeshIndex===d||!y.featureData)continue;y.featureArray=new Mh,y.featureArray.reserve(y.featureData.length);let b=r;for(const T of y.featureData){const E=g?65535&T:T>>16&65535,k=g?T>>16&65535:65535&T,j=(15&k)<8?15&k:0,R=a.evaluatedRMEA[j],L=a.evaluatedColor[j],z=a.emissionHeightBasedParams[j];let W;if(b&&j===2&&u.lights&&(W=new Mh,W.resize(10*u.lights.length)),hG(y.featureArray,E,L,R,z,y.aabb.min[2],y.aabb.max[2],W),W&&b){b=!1;const J=u.meshes[u.lightMeshIndex];J.featureArray=W,J.featureArray._trim()}}y.featureArray._trim(),d++}}rr(yw,"Tiled3dModelBucket",{omit:["layers"]}),rr(qD,"Tiled3dModelFeature");const pG=["id","tile","layer","source","sourceLayer","state"];class Hp{constructor(r,s,u,d,g){this.type="Feature",this._vectorTileFeature=r,this._z=s,this._x=u,this._y=d,this.properties=r?r.properties:{},this.id=g}clone(){const r=new Hp(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(r.state=Object.assign({},this.state)),this.layer&&(r.layer=Object.assign({},this.layer)),this.source&&(r.source=this.source),this.sourceLayer&&(r.sourceLayer=this.sourceLayer),r}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const s of pG)this[s]!==void 0&&(r[s]=this[s]);return r}}class Zp extends yc{constructor(r,s,u,d){super(),this.id=r,this.type="model",this.models=[],this._loaded=!1,this._options=s,this._modelsInfo=new Map}load(){const r=[];for(const s in this._options.models){const u=this._options.models[s],d=this._modelsInfo.get(s);if(d){const g=d.model;g.position=u.position!=null?new F(u.position[0],u.position[1]):new F(0,0),g.orientation=u.orientation!=null?u.orientation:[0,0,0],d.modelSpec=u,Zp.applyModelSpecification(g,u),g.computeBoundsAndApplyParent(),this.models.push(g)}else{const g=cM(this.map._requestManager.transformRequest(u.uri,ed.Model).url).then(y=>{if(!y)return;const b=VE(y),T=new pM(s,u.uri,u.position,u.orientation,b);Zp.applyModelSpecification(T,u),T.computeBoundsAndApplyParent(),this.models.push(T),this._modelsInfo.set(s,{modelSpec:u,model:T})}).catch(y=>{this.fire(new ap(new Error(`Could not load model ${s} from ${u.uri}: ${y.message}`)))});r.push(g)}}Promise.allSettled(r).then(()=>{this._loaded=!0,this.fire(new Aa("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(s=>{this._loaded=!0,this.fire(new ap(new Error(`Could not load models: ${s.message}`)))})}static applyModelSpecification(r,s){s.nodeOverrides&&Zp.convertNodeOverrides(r,s.nodeOverrides),s.materialOverrides&&Zp.convertMaterialOverrides(r,s.materialOverrides),s.nodeOverrideNames&&(r.nodeOverrideNames=[...s.nodeOverrideNames]),s.materialOverrideNames&&(r.materialOverrideNames=[...s.materialOverrideNames]),s.featureProperties&&(r.featureProperties=s.featureProperties)}static convertNodeOverrides(r,s){if(Array.isArray(s)&&s.every(u=>typeof u=="string")){r.nodeOverrideNames=[];for(const u of s)r.nodeOverrideNames.push(u)}else Object.entries(s).forEach(([u,d])=>{const g={orientation:[0,0,0]};if(d.hasOwnProperty("orientation")){const y=d.orientation;y&&(g.orientation=y)}r.nodeOverrides.set(u,g)})}static convertMaterialOverrides(r,s){if(Array.isArray(s)&&s.every(u=>typeof u=="string")){r.materialOverrideNames=[];for(const u of s)r.materialOverrideNames.push(u)}else Object.entries(s).forEach(([u,d])=>{const g={color:new Yn(1,1,1),colorMix:0,emissionStrength:0,opacity:1},y=d["model-color"];y!==void 0&&(g.color.r=y[0],g.color.g=y[1],g.color.b=y[2]);const b=d["model-color-mix-intensity"];b!==void 0&&(g.colorMix=b);const T=d["model-emissive-strength"];T!==void 0&&(g.emissionStrength=T);const E=d["model-opacity"];E!==void 0&&(g.opacity=E),r.materialOverrides.set(u,g)})}onAdd(r){this.map=r,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(r,s){}serialize(){return this._options}setProperty(r,s){return!1}reload(){const r=fd(this.id,this.scope);this.map.style.clearSource(r),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(r){this.models=[];const s=new Map;for(const u in r){const d=r[u];if(this._modelsInfo.has(u)){const g=this._modelsInfo.get(u);g&&g.modelSpec.uri===d.uri&&s.set(u,g)}}this._modelsInfo=s,this._options.models=r,this._loaded=!1,this.load()}}function pC(a,r,s,u){const d=1<<a.z;r.lat=ce((u/zt+a.y)/d),r.lng=he((s/zt+a.x)/d)}function mG(a,r,s,u){const d=a.getNodesInfo()[r];if(!d||d.hiddenByReplacement||!d.node.meshes)return;let g=Number.MAX_VALUE;const y=d.node,b=s.tile,T=u.calculatePosMatrix(b.tileID.toUnwrapped(),u.worldSize),E=d.evaluatedScale;let k=0;u.elevation&&y.elevation&&(k=y.elevation*u.elevation.exaggeration()),X(T,T,[(y.anchor?y.anchor[0]:0)*(E[0]-1),(y.anchor?y.anchor[1]:0)*(E[1]-1),k]),ue(T,T,E);const j=s.queryGeometry,R=j.isPointQuery()?j.screenBounds:j.screenGeometry,L=function(W){const J=G([],T,W.globalMatrix);G(J,u.expandedFarZProjMatrix,J);for(let ee=0;ee<W.meshes.length;++ee){const oe=W.meshes[ee];if(ee===W.lightMeshIndex)continue;const le=LE(R,u,J,oe.aabb);le!=null&&(g=Math.min(le,g))}if(W.children)for(const ee of W.children)L(ee)};if(L(y),g===Number.MAX_VALUE)return;const z=new F(0,0);return pC(b.tileID.canonical,z,d.node.anchor[0],d.node.anchor[1]),{intersectionZ:g,position:z,feature:d.feature}}const gG={circle:class extends Lo{constructor(a,r,s,u){super(a,{layout:Pc||(Pc=new Ki({"circle-sort-key":new Ht(Ve.layout_circle["circle-sort-key"]),"circle-elevation-reference":new jt(Ve.layout_circle["circle-elevation-reference"]),visibility:new jt(Ve.layout_circle.visibility)})),paint:Oh||(Oh=new Ki({"circle-radius":new Ht(Ve.paint_circle["circle-radius"]),"circle-color":new Ht(Ve.paint_circle["circle-color"]),"circle-blur":new Ht(Ve.paint_circle["circle-blur"]),"circle-opacity":new Ht(Ve.paint_circle["circle-opacity"]),"circle-translate":new jt(Ve.paint_circle["circle-translate"]),"circle-translate-anchor":new jt(Ve.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new jt(Ve.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new jt(Ve.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ht(Ve.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ht(Ve.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ht(Ve.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new jt(Ve.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u)}createBucket(a){return new Oi(a)}queryRadius(a){const r=a;return $s("circle-radius",this,r)+$s("circle-stroke-width",this,r)+Hi(this.paint.get("circle-translate"))}queryIntersectsFeature(a,r,s,u,d,g,y,b){const T=Nh(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s);return Kj(a,u,g,y,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,E)}getProgramIds(){return["circle"]}getDefaultProgramParams(a,r,s){const u=Xj(this);return{config:new Ic(this,{zoom:r,lut:s}),defines:u,overrideFog:!1}}is3D(a){return!a&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Lo{createBucket(a){return new Jj(a)}constructor(a,r,s,u){super(a,{layout:Qj||(Qj=new Ki({visibility:new jt(Ve.layout_heatmap.visibility)})),paint:eR||(eR=new Ki({"heatmap-radius":new Ht(Ve.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ht(Ve.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new jt(Ve.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Sh(Ve.paint_heatmap["heatmap-color"]),"heatmap-opacity":new jt(Ve.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=lx({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(a){return $s("heatmap-radius",this,a)}queryIntersectsFeature(a,r,s,u,d,g,y,b){const T=this.paint.get("heatmap-radius").evaluate(r,s);return Kj(a,u,g,y,b,!0,!0,new xt(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(a,r,s){return a==="heatmap"?{config:new Ic(this,{zoom:r,lut:s}),overrideFog:!1}:{}}},hillshade:class extends Lo{constructor(a,r,s,u){super(a,{layout:tR||(tR=new Ki({visibility:new jt(Ve.layout_hillshade.visibility)})),paint:rR||(rR=new Ki({"hillshade-illumination-direction":new jt(Ve.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new jt(Ve.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new jt(Ve.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new jt(Ve.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new jt(Ve.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new jt(Ve.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new jt(Ve.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(a,r,s){return{overrideFog:!1}}},fill:class extends Lo{constructor(a,r,s,u){super(a,{layout:_R||(_R=new Ki({"fill-sort-key":new Ht(Ve.layout_fill["fill-sort-key"]),visibility:new jt(Ve.layout_fill.visibility),"fill-elevation-reference":new jt(Ve.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Ht(Ve.layout_fill["fill-construct-bridge-guard-rail"])})),paint:yR||(yR=new Ki({"fill-antialias":new jt(Ve.paint_fill["fill-antialias"]),"fill-opacity":new Ht(Ve.paint_fill["fill-opacity"]),"fill-color":new Ht(Ve.paint_fill["fill-color"]),"fill-outline-color":new Ht(Ve.paint_fill["fill-outline-color"]),"fill-translate":new jt(Ve.paint_fill["fill-translate"]),"fill-translate-anchor":new jt(Ve.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ht(Ve.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new jt(Ve.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new jt(Ve.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Ht(Ve.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Ht(Ve.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Ht(Ve.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u)}getProgramIds(){const a=this.paint.get("fill-pattern"),r=a&&a.constantOr(1),s=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getDefaultProgramParams(a,r,s){return{config:new Ic(this,{zoom:r,lut:s}),overrideFog:!1}}recalculate(a,r){super.recalculate(a,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new xE(a)}queryRadius(){return Hi(this.paint.get("fill-translate"))}queryIntersectsFeature(a,r,s,u,d,g){return!a.queryGeometry.isAboveHorizon&&Yi(Da(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),u)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(a){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const r=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return a!=null?r&&!a:r}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Lo{constructor(a,r,s,u){super(a,{layout:$R||($R=new Ki({visibility:new jt(Ve["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new jt(Ve["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:qR||(qR=new Ki({"fill-extrusion-opacity":new jt(Ve["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ht(Ve["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new jt(Ve["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new jt(Ve["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ht(Ve["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new jt(Ve["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Ht(Ve["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ht(Ve["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new jt(Ve["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new jt(Ve["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new jt(Ve["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new jt(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new jt(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new jt(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new jt(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new jt(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new jt(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new jt(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Ht(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Ht(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new jt(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new jt(Ve["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new jt(Ve["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new jt(Ve["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ht(Ve["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Ht(Ve["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new jt(Ve["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new $1(a)}queryRadius(){return Hi(this.paint.get("fill-extrusion-translate"))}is3D(a){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(a,r,s,u,d,g,y,b,T){const E=Nh(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),k=this.paint.get("fill-extrusion-height").evaluate(r,s),j=this.paint.get("fill-extrusion-base").evaluate(r,s),R=[0,0],L=b&&g.elevation,z=g.elevation?g.elevation.exaggeration():1,W=a.tile.getBucket(this);if(L&&W instanceof $1){const de=W.centroidVertexArray,Se=T+1;Se<de.length&&(R[0]=de.geta_centroid_pos0(Se),R[1]=de.geta_centroid_pos1(Se))}if(R[0]===0&&R[1]===1)return!1;g.projection.name==="globe"&&(u=UR([u],[new xt(0,0),new xt(zt,zt)],a.tileID.canonical).map(de=>de.polygon).flat());const J=L?b:null,[ee,oe]=YR(g,u,j,k,E,y,J,R,z,g.center.lat,a.tileID.canonical),le=a.queryGeometry;return KR(ee,oe,le.isPointQuery()?le.screenBounds:le.screenGeometry)}},building:class extends Lo{constructor(a,r,s,u){super(a,{layout:wM||(wM=new Ki({visibility:new jt(Ve.layout_building.visibility),"building-facade":new Ht(Ve.layout_building["building-facade"]),"building-facade-floors":new Ht(Ve.layout_building["building-facade-floors"]),"building-facade-unit-width":new Ht(Ve.layout_building["building-facade-unit-width"]),"building-facade-window":new Ht(Ve.layout_building["building-facade-window"]),"building-roof-shape":new Ht(Ve.layout_building["building-roof-shape"]),"building-height":new Ht(Ve.layout_building["building-height"]),"building-base":new Ht(Ve.layout_building["building-base"]),"building-flood-light-wall-radius":new Ht(Ve.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Ht(Ve.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Ht(Ve.layout_building["building-flip-roof-orientation"])})),paint:SM||(SM=new Ki({"building-opacity":new jt(Ve.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new jt(Ve.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new jt(Ve.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new jt(Ve.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new jt(Ve.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new jt(Ve.paint_building["building-vertical-scale"]),"building-cast-shadows":new jt(Ve.paint_building["building-cast-shadows"]),"building-color":new Ht(Ve.paint_building["building-color"]),"building-emissive-strength":new Ht(Ve.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new jt(Ve.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new jt(Ve.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new jt(Ve.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new jt(Ve.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new jt(Ve.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new bM(a)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(a){return!0}queryRadius(a){return 0}queryIntersectsFeature(a,r,s,u,d,g,y,b,T){let E=this.layout.get("building-height").evaluate(r,s);const k=this.layout.get("building-base").evaluate(r,s),j=a.tile.getBucket(this).getFootprint(r);if(j){if(j.hiddenFlags!==0)return!1;E=j.height}const[R,L]=YR(g,u,k,E,new xt(0,0),y,null,[0,0],1,g.center.lat,a.tileID.canonical),z=a.queryGeometry;return KR(R,L,z.isPointQuery()?z.screenBounds:z.screenGeometry)}},line:class extends Lo{constructor(a,r,s,u){const d=MM();super(a,d,r,s,u),d.layout&&(this.layout=new hd(d.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof wp,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,r){super.recalculate(a,r),this.paint._values["line-floorwidth"]=(()=>{if(Ex)return Ex;const s=MM();return Ex=new hq(s.paint.properties["line-width"].specification),Ex.useIntegerZoom=!0,Ex})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new $E(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(a,r,s){const u=jM(this);return{config:new Ic(this,{zoom:r,lut:s}),defines:u,overrideFog:!1}}queryRadius(a){const r=a,s=DM($s("line-width",this,r),$s("line-gap-width",this,r)),u=$s("line-offset",this,r);return s/2+Math.abs(u)+Hi(this.paint.get("line-translate"))}queryIntersectsFeature(a,r,s,u,d,g){if(a.queryGeometry.isAboveHorizon)return!1;const y=Da(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),b=a.pixelToTileUnitsFactor/2*DM(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),T=this.paint.get("line-offset").evaluate(r,s);return T&&(u=function(E,k){const j=[],R=new xt(0,0);for(let L=0;L<E.length;L++){const z=E[L],W=[];for(let J=0;J<z.length;J++){const ee=z[J],oe=z[J+1],le=J===0?R:ee.sub(z[J-1])._unit()._perp(),de=J===z.length-1?R:oe.sub(ee)._unit()._perp(),Se=le._add(de)._unit();Se._mult(1/(Se.x*de.x+Se.y*de.y)),W.push(Se._mult(k)._add(ee))}j.push(W)}return j}(u,T*a.pixelToTileUnitsFactor)),function(E,k,j){for(let R=0;R<k.length;R++){const L=k[R];if(E.length>=3){for(let z=0;z<L.length;z++)if(Us(E,L[z]))return!0}if(ra(E,L,j))return!0}return!1}(y,u,b)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(a){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:pw,background:class extends Lo{constructor(a,r,s,u){super(a,{layout:SD||(SD=new Ki({visibility:new jt(Ve.layout_background.visibility)})),paint:TD||(TD=new Ki({"background-pitch-alignment":new jt(Ve.paint_background["background-pitch-alignment"]),"background-color":new jt(Ve.paint_background["background-color"]),"background-pattern":new jt(Ve.paint_background["background-pattern"]),"background-opacity":new jt(Ve.paint_background["background-opacity"]),"background-emissive-strength":new jt(Ve.paint_background["background-emissive-strength"]),"background-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(a,r,s){return{overrideFog:!1}}is3D(a){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:PD,"raster-particle":ND,sky:class extends Lo{constructor(a,r,s,u){super(a,{layout:RD||(RD=new Ki({visibility:new jt(Ve.layout_sky.visibility)})),paint:MD||(MD=new Ki({"sky-type":new jt(Ve.paint_sky["sky-type"]),"sky-atmosphere-sun":new jt(Ve.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new jt(Ve.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new jt(Ve.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new jt(Ve.paint_sky["sky-gradient-radius"]),"sky-gradient":new Sh(Ve.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new jt(Ve.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new jt(Ve.paint_sky["sky-atmosphere-color"]),"sky-opacity":new jt(Ve.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=lx({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(a,r){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),d=!u,g=a.style.light,y=g.properties.get("position");return d&&g.properties.get("anchor")==="viewport"&&br("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?uC(y.azimuthal,90-y.polar,r):uC(u[0],90-u[1],r)}const s=this.paint.get("sky-gradient-center");return uC(s[0],90-s[1],r)}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}},slot:class extends Lo{constructor(a,r,s,u){super(a,{paint:DD||(DD=new Ki({}))},r,null)}},model:class extends Lo{constructor(a,r,s,u){super(a,{layout:FD||(FD=new Ki({visibility:new jt(Ve.layout_model.visibility),"model-id":new Ht(Ve.layout_model["model-id"])})),paint:BD||(BD=new Ki({"model-opacity":new Ht(Ve.paint_model["model-opacity"]),"model-rotation":new Ht(Ve.paint_model["model-rotation"]),"model-scale":new Ht(Ve.paint_model["model-scale"]),"model-translation":new Ht(Ve.paint_model["model-translation"]),"model-color":new Ht(Ve.paint_model["model-color"]),"model-color-mix-intensity":new Ht(Ve.paint_model["model-color-mix-intensity"]),"model-type":new jt(Ve.paint_model["model-type"]),"model-cast-shadows":new jt(Ve.paint_model["model-cast-shadows"]),"model-receive-shadows":new jt(Ve.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new jt(Ve.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Ht(Ve.paint_model["model-emissive-strength"]),"model-roughness":new Ht(Ve.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Ht(Ve.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new jt(Ve.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new jt(Ve.paint_model["model-front-cutoff"]),"model-elevation-reference":new jt(Ve.paint_model["model-elevation-reference"]),"model-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},r,s,u),this.layer=a,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new hC(a)}getProgramIds(){return["model"]}is3D(a){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(a){return a instanceof yw?zt-1:0}queryRenderedFeatures(a,r,s){const u=r.getSource();if(!(u&&u instanceof Zp))return{};const d=u,g={};g[this.id]=[];const y=g[this.id];let b=0;for(const T of d.models){const E=r.getFeatureState(this.sourceLayer,T.id),k={type:"Unknown",id:T.id,properties:T.featureProperties},j=this.paint.get("model-rotation").evaluate(k,E),R=this.paint.get("model-scale").evaluate(k,E),L=this.paint.get("model-translation").evaluate(k,E),z=this.paint.get("model-elevation-reference");let W=[];J1(W,T,s,T.position,j,R,L,z==="ground",z==="ground",!1),s.projection.name==="globe"&&(W=Y1(W,s));const J=G([],s.projMatrix,W),ee=LE(a.isPointQuery()?a.screenBounds:a.screenGeometry,s,J,T.aabb);if(ee!=null){const oe=new Hp(void 0,0,0,0,T.id);oe.layer=this.layer,oe.properties=structuredClone(T.featureProperties),oe.properties.layer=this.id,oe.properties.uri=T.uri,oe.properties.orientation=T.orientation,oe.sourceLayer=this.sourceLayer,oe.geometry={type:"Point",coordinates:[T.position.lng,T.position.lat]},oe.state=E,oe.source=this.source,y.push({featureIndex:b,feature:oe,intersectionZ:ee})}++b}return g}queryIntersectsFeature(a,r,s,u,d,g){if(!this.modelManager)return!1;const y=this.modelManager,b=a.tile.getBucket(this);if(!(b&&b instanceof hC))return!1;for(const T in b.instancesPerModel){const E=b.instancesPerModel[T],k=r.id!==void 0?r.id:r.properties&&r.properties.hasOwnProperty("id")?r.properties.id:void 0;if(E.idToFeaturesIndex.hasOwnProperty(k)){const j=E.features[E.idToFeaturesIndex[k]],R=y.getModel(T,this.scope);if(!R)return!1;let L=[];const z=new F(0,0),W=b.canonical;let J=Number.MAX_VALUE;for(let ee=0;ee<j.instancedDataCount;++ee){const oe=16*(j.instancedDataOffset+ee),le=E.instancedDataArray.float32,de=[le[oe+4],le[oe+5],le[oe+6]];pC(W,z,Math.floor(le[oe]),Math.floor(le[oe+1])),J1(L,R,g,z,j.rotation,j.scale,de,!1,!1,!1),g.projection.name==="globe"&&(L=Y1(L,g));const Se=G([],g.projMatrix,L),_e=a.queryGeometry,Ae=LE(_e.isPointQuery()?_e.screenBounds:_e.screenGeometry,g,Se,R.aabb);Ae!=null&&(J=Math.min(Ae,J))}return J!==Number.MAX_VALUE&&J}}return!1}_handleOverridablePaintPropertyUpdate(a,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven()||a!=="model-color"&&a!=="model-color-mix-intensity"&&a!=="model-rotation"&&a!=="model-scale"&&a!=="model-translation"&&a!=="model-emissive-strength")}_isPropertyZoomDependent(a){const r=this._transitionablePaint._values[a];return r!=null&&r.value!=null&&r.value.expression!=null&&r.value.expression instanceof _u}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Lo{constructor(a,r,s,u){super(a,{layout:vR||(vR=new Ki({"clip-layer-types":new jt(Ve.layout_clip["clip-layer-types"]),"clip-layer-scope":new jt(Ve.layout_clip["clip-layer-scope"])})),paint:xR||(xR=new Ki({}))},r,s,u)}recalculate(a,r){super.recalculate(a,r)}createBucket(a){return new bR(a)}is3D(a){return!0}}},mC=new Yn(0,0,0),gC={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},_C={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},vw={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},_G={PAINT_ORDER_FILL_AND_STROKE:1},Vx={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},GD={MASK_TYPE_LUMINANCE:1};function yG(a,r,s){a===1&&r.icons.push(function(u,d){return function(g){if(g.usvg_tree.height||(g.usvg_tree.height=g.usvg_tree.width),!g.metadata)return g;const{metadata:y}=g;if(y.content_area){const{content_area:b}=y;b.left==null&&(b.left=0),b.top==null&&(b.top=b.left),b.width==null&&(b.width=g.usvg_tree.width),b.height==null&&(b.height=b.width)}if(y.text_placeholder){const{text_placeholder:b}=y;b.top==null&&(b.top=b.left),b.height==null&&(b.height=b.width)}return y.stretch_x&&y.stretch_x.length&&WD(y,"x"),y.stretch_y&&y.stretch_y.length&&WD(y,"y"),g}(u.readFields(vG,{name:void 0},d))}(s,s.readVarint()+s.pos))}function WD(a,r){const s=[],u=a[`stretch_${r}`];let d=null;for(let g=0;g<u.length;g++)d===null?d=s.length===0?u[0]:s[s.length-1][1]+u[g]:(s.push([d,d+u[g]]),d=null);a[`stretch_${r}_areas`]=s}function vG(a,r,s){a===1?r.name=s.readString():a===2?r.metadata=function(u,d){return u.readFields(xG,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},d)}(s,s.readVarint()+s.pos):a===3&&(r.usvg_tree=function(u,d){return u.readFields(SG,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},d)}(s,s.readVarint()+s.pos),r.data="usvg_tree")}function xG(a,r,s){a===1?r.stretch_x=s.readPackedVarint():a===2?r.stretch_y=s.readPackedVarint():a===3?r.content_area=HD(s,s.readVarint()+s.pos):a===4?r.variables.push(function(u,d){return u.readFields(wG,{name:void 0},d)}(s,s.readVarint()+s.pos)):a===5&&(r.text_placeholder=HD(s,s.readVarint()+s.pos))}function HD(a,r){return a.readFields(bG,{},r)}function bG(a,r,s){a===1?r.left=s.readVarint():a===2?r.width=s.readVarint():a===3?r.top=s.readVarint():a===4&&(r.height=s.readVarint())}function wG(a,r,s){a===1?r.name=s.readString():a===2&&(r.rgb_color=ww(s.readVarint()),r.value="rgb_color")}function SG(a,r,s){a===1?r.width=r.height=s.readVarint():a===2?r.height=s.readVarint():a===3?r.children.push(xw(s,s.readVarint()+s.pos)):a===4?r.linear_gradients.push(function(u,d){return u.readFields(kG,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},d)}(s,s.readVarint()+s.pos)):a===5?r.radial_gradients.push(function(u,d){return u.readFields(RG,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},d)}(s,s.readVarint()+s.pos)):a===7?r.clip_paths.push(function(u,d){return u.readFields(MG,{children:[]},d)}(s,s.readVarint()+s.pos)):a===8&&r.masks.push(function(u,d){const g=u.readFields(DG,{left:0,width:20,mask_type:GD.MASK_TYPE_LUMINANCE,children:[]},d);return g.height==null&&(g.height=g.width),g.top==null&&(g.top=g.left),g}(s,s.readVarint()+s.pos))}function xw(a,r){return a.readFields(TG,{},r)}function TG(a,r,s){a===1?(r.group=function(u,d){return u.readFields(EG,{opacity:255,children:[]},d)}(s,s.readVarint()+s.pos),r.node="group"):a===2&&(r.path=function(u,d){return u.readFields(AG,{paint_order:1,commands:[],step:1,diffs:[],rule:gC.PATH_RULE_NON_ZERO},d)}(s,s.readVarint()+s.pos),r.node="path")}function EG(a,r,s){a===1?r.transform=bw(s,s.readVarint()+s.pos):a===2?r.opacity=s.readVarint():a===5?r.clip_path_idx=s.readVarint():a===6?r.mask_idx=s.readVarint():a===7&&r.children.push(xw(s,s.readVarint()+s.pos))}function bw(a,r){return a.readFields(CG,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},r)}function CG(a,r,s){a===1?r.sx=s.readFloat():a===2?r.ky=s.readFloat():a===3?r.kx=s.readFloat():a===4?r.sy=s.readFloat():a===5?r.tx=s.readFloat():a===6&&(r.ty=s.readFloat())}function AG(a,r,s){a===1?r.fill=function(u,d){return u.readFields(IG,{rgb_color:mC,paint:"rgb_color",opacity:255},d)}(s,s.readVarint()+s.pos):a===2?r.stroke=function(u,d){return u.readFields(PG,{rgb_color:mC,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},d)}(s,s.readVarint()+s.pos):a===3?r.paint_order=s.readVarint():a===5?s.readPackedVarint(r.commands):a===6?r.step=s.readFloat():a===7?s.readPackedSVarint(r.diffs):a===8&&(r.rule=s.readVarint())}function IG(a,r,s){a===1?(r.rgb_color=ww(s.readVarint()),r.paint="rgb_color"):a===2?(r.linear_gradient_idx=s.readVarint(),r.paint="linear_gradient_idx"):a===3?(r.radial_gradient_idx=s.readVarint(),r.paint="radial_gradient_idx"):a===5&&(r.opacity=s.readVarint())}function ww(a){return new Yn((a>>16&255)/255,(a>>8&255)/255,(255&a)/255,1)}function PG(a,r,s){a===1?(r.rgb_color=ww(s.readVarint()),r.paint="rgb_color"):a===2?(r.linear_gradient_idx=s.readVarint(),r.paint="linear_gradient_idx"):a===3?(r.radial_gradient_idx=s.readVarint(),r.paint="radial_gradient_idx"):a===5?s.readPackedFloat(r.dasharray):a===6?r.dashoffset=s.readFloat():a===7?r.miterlimit=s.readFloat():a===8?r.opacity=s.readVarint():a===9?r.width=s.readFloat():a===10?r.linecap=s.readVarint():a===11&&(r.linejoin=s.readVarint())}function kG(a,r,s){a===1?r.transform=bw(s,s.readVarint()+s.pos):a===2?r.spread_method=s.readVarint():a===3?r.stops.push(ZD(s,s.readVarint()+s.pos)):a===4?r.x1=s.readFloat():a===5?r.y1=s.readFloat():a===6?r.x2=s.readFloat():a===7&&(r.y2=s.readFloat())}function ZD(a,r){return a.readFields(jG,{offset:0,opacity:255,rgb_color:mC},r)}function jG(a,r,s){a===1?r.offset=s.readFloat():a===2?r.opacity=s.readVarint():a===3&&(r.rgb_color=ww(s.readVarint()))}function RG(a,r,s){a===1?r.transform=bw(s,s.readVarint()+s.pos):a===2?r.spread_method=s.readVarint():a===3?r.stops.push(ZD(s,s.readVarint()+s.pos)):a===4?r.cx=s.readFloat():a===5?r.cy=s.readFloat():a===6?r.r=s.readFloat():a===7?r.fx=s.readFloat():a===8?r.fy=s.readFloat():a===9&&(r.fr=s.readFloat())}function MG(a,r,s){a===1?r.transform=bw(s,s.readVarint()+s.pos):a===2?r.clip_path_idx=s.readVarint():a===3&&r.children.push(xw(s,s.readVarint()+s.pos))}function DG(a,r,s){a===1?r.left=r.top=s.readFloat():a===2?r.width=r.height=s.readFloat():a===3?r.top=s.readFloat():a===4?r.height=s.readFloat():a===5?r.mask_type=s.readVarint():a===6?r.mask_idx=s.readVarint():a===7&&r.children.push(xw(s,s.readVarint()+s.pos))}class NG{static calculate(r={},s=[]){const u=new Map,d=new Map;if(Object.keys(r).length===0)return u;s.forEach(g=>{d.set(g.name,g.rgb_color||new Yn(0,0,0))});for(const[g,y]of Object.entries(r))d.has(g)?u.set(d.get(g).toString(),y):console.warn(`Ignoring unknown image variable "${g}"`);return u}}function c_(a,r=255,s){const u=r/255,d=a.toString(),g=s.has(d)?s.get(d).clone():a.clone();return g.a*=u,g.toString()}function Ux(a,r){if(!da()){const s=document.createElement("canvas");return s.width=a,s.height=r,s}return new OffscreenCanvas(a,r)}function OG(a,r){const s=NG.calculate(r.params,a.metadata?a.metadata.variables:[]),u=a.usvg_tree,d=u.width,g=u.height,y=r.transform?r.transform:new DOMMatrix,b=Math.max(1,Math.round(d*y.a)),T=Math.max(1,Math.round(g*y.d)),E=new DOMMatrix([b/d,0,0,T/g,0,0]),k=Ux(b,T).getContext("2d");return yC(k,E,u,u,s),k.getImageData(0,0,b,T)}function yC(a,r,s,u,d){for(const g of u.children)XD(a,r,s,g,d)}function XD(a,r,s,u,d){u.group?(a.save(),function(g,y,b,T,E){const k=T.mask_idx!=null?b.masks[T.mask_idx]:null,j=T.clip_path_idx!=null?b.clip_paths[T.clip_path_idx]:null;if(T.transform&&(y=u_(T.transform).preMultiplySelf(y)),!function(z,W,J){return z.opacity!==255||W||J}(T,j!=null,k!=null))return void yC(g,y,b,T,E);const R=Ux(g.canvas.width,g.canvas.height),L=R.getContext("2d");yC(L,y,b,T,E),j&&rN(L,y,b,j),k&&nN(L,y,b,k,E),g.globalAlpha=T.opacity/255,g.drawImage(R,0,0)}(a,r,s,u.group,d),a.restore()):u.path&&(a.save(),function(g,y,b,T,E){g.setTransform(y),T.paint_order===_G.PAINT_ORDER_FILL_AND_STROKE?(KD(g,b,T,E),JD(g,b,T,E)):(JD(g,b,T,E),KD(g,b,T,E))}(a,r,s,u.path,d),a.restore())}function KD(a,r,s,u){const d=s.fill;if(!d)return;const g=d.opacity/255;switch(a.save(),a.beginPath(),iN(s,a),d.paint){case"rgb_color":a.fillStyle=c_(d.rgb_color,d.opacity,u);break;case"linear_gradient_idx":{const y=r.linear_gradients[d.linear_gradient_idx];y.transform&&a.setTransform(u_(y.transform).preMultiplySelf(a.getTransform())),a.fillStyle=QD(a,y,g,u);break}case"radial_gradient_idx":{const y=r.radial_gradients[d.radial_gradient_idx];y.transform&&a.setTransform(u_(y.transform).preMultiplySelf(a.getTransform())),a.fillStyle=eN(a,y,g,u)}}a.fill(YD(s)),a.restore()}function YD(a){return a.rule===gC.PATH_RULE_NON_ZERO?"nonzero":a.rule===gC.PATH_RULE_EVEN_ODD?"evenodd":void 0}function JD(a,r,s,u){const d=s.stroke;if(!d)return;const g=sN(s);a.lineWidth=d.width,a.miterLimit=d.miterlimit,a.setLineDash(d.dasharray),a.lineDashOffset=d.dashoffset;const y=d.opacity/255;switch(d.paint){case"rgb_color":a.strokeStyle=c_(d.rgb_color,d.opacity,u);break;case"linear_gradient_idx":a.strokeStyle=QD(a,r.linear_gradients[d.linear_gradient_idx],y,u,!0);break;case"radial_gradient_idx":a.strokeStyle=eN(a,r.radial_gradients[d.radial_gradient_idx],y,u,!0)}switch(d.linejoin){case vw.LINE_JOIN_MITER_CLIP:case vw.LINE_JOIN_MITER:a.lineJoin="miter";break;case vw.LINE_JOIN_ROUND:a.lineJoin="round";break;case vw.LINE_JOIN_BEVEL:a.lineJoin="bevel"}switch(d.linecap){case _C.LINE_CAP_BUTT:a.lineCap="butt";break;case _C.LINE_CAP_ROUND:a.lineCap="round";break;case _C.LINE_CAP_SQUARE:a.lineCap="square"}a.stroke(g)}function QD(a,r,s,u,d=!1){if(r.stops.length===1){const R=r.stops[0];return c_(R.rgb_color,R.opacity*s,u)}const{x1:g,y1:y,x2:b,y2:T}=r;let E=new DOMPoint(g,y),k=new DOMPoint(b,T);if(d){const R=u_(r.transform);E=R.transformPoint(E),k=R.transformPoint(k)}const j=a.createLinearGradient(E.x,E.y,k.x,k.y);for(const R of r.stops)j.addColorStop(R.offset,c_(R.rgb_color,R.opacity*s,u));return j}function eN(a,r,s,u,d=!1){if(r.stops.length===1){const ee=r.stops[0];return c_(ee.rgb_color,ee.opacity*s,u)}const g=u_(r.transform),{fx:y,fy:b,fr:T,cx:E,cy:k,r:j}=r;let R=new DOMPoint(y,b),L=new DOMPoint(E,k),z=T,W=j;if(d){R=g.transformPoint(R),L=g.transformPoint(L);const ee=(g.a+g.d)/2;z=T*ee,W=r.r*ee}const J=a.createRadialGradient(R.x,R.y,z,L.x,L.y,W);for(const ee of r.stops)J.addColorStop(ee.offset,c_(ee.rgb_color,ee.opacity*s,u));return J}function tN(a,r,s,u){const d=u.transform?u_(u.transform).preMultiplySelf(r):r,g=Ux(a.canvas.width,a.canvas.height),y=g.getContext("2d");for(const T of u.children)if(T.group)tN(y,d,s,T.group);else if(T.path){const E=T.path,k=new Path2D;k.addPath(sN(E),d),y.fill(k,YD(E))}const b=u.clip_path_idx!=null?s.clip_paths[u.clip_path_idx]:null;b&&rN(y,d,s,b),a.globalCompositeOperation="source-over",a.drawImage(g,0,0)}function rN(a,r,s,u){const d=Ux(a.canvas.width,a.canvas.height);tN(d.getContext("2d"),r,s,u),a.globalCompositeOperation="destination-in",a.drawImage(d,0,0)}function nN(a,r,s,u,d){if(u.children.length===0)return;const g=u.mask_idx!=null?s.masks[u.mask_idx]:null;g&&nN(a,r,s,g,d);const y=a.canvas.width,b=a.canvas.height,T=Ux(y,b),E=T.getContext("2d"),k=u.width,j=u.height,R=u.left,L=u.top,z=new Path2D,W=new Path2D;W.rect(R,L,k,j),z.addPath(W,r),E.clip(z);for(const oe of u.children)XD(E,r,s,oe,d);const J=E.getImageData(0,0,y,b),ee=J.data;if(u.mask_type===GD.MASK_TYPE_LUMINANCE)for(let oe=0;oe<ee.length;oe+=4)ee[oe+3]=ee[oe+3]/255*(.2126*ee[oe]+.7152*ee[oe+1]+.0722*ee[oe+2]);E.putImageData(J,0,0),a.globalCompositeOperation="destination-in",a.drawImage(T,0,0)}function u_(a){return a?new DOMMatrix([a.sx,a.ky,a.kx,a.sy,a.tx,a.ty]):new DOMMatrix}function iN(a,r){const s=a.step;let u=a.diffs[0]*s,d=a.diffs[1]*s;r.moveTo(u,d);for(let g=0,y=2;g<a.commands.length;g++)switch(a.commands[g]){case Vx.PATH_COMMAND_MOVE:u+=a.diffs[y++]*s,d+=a.diffs[y++]*s,r.moveTo(u,d);break;case Vx.PATH_COMMAND_LINE:u+=a.diffs[y++]*s,d+=a.diffs[y++]*s,r.lineTo(u,d);break;case Vx.PATH_COMMAND_QUAD:{const b=u+a.diffs[y++]*s,T=d+a.diffs[y++]*s;u=b+a.diffs[y++]*s,d=T+a.diffs[y++]*s,r.quadraticCurveTo(b,T,u,d);break}case Vx.PATH_COMMAND_CUBIC:{const b=u+a.diffs[y++]*s,T=d+a.diffs[y++]*s,E=b+a.diffs[y++]*s,k=T+a.diffs[y++]*s;u=E+a.diffs[y++]*s,d=k+a.diffs[y++]*s,r.bezierCurveTo(b,T,E,k,u,d);break}case Vx.PATH_COMMAND_CLOSE:r.closePath()}return r}function sN(a){return iN(a,new Path2D)}class Sw{constructor(r){this.capacity=r,this.cache=new Map}get(r){if(!this.cache.has(r))return;const s=this.cache.get(r);return this.cache.delete(r),this.cache.set(r,s),s}put(r,s){this.cache.has(r)?this.cache.delete(r):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(r,s)}delete(r){this.cache.delete(r)}}rr(Sw,"LRUCache");class vC{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(r){return new Eo(r,r.data)}getFromCache(r,s,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new Sw(150)),this.cacheMap.get(u).get(fd(r.toString(),s))}setInCache(r,s,u,d){this.cacheDependenciesMap.has(d)||this.cacheDependenciesMap.set(d,new Map),this.cacheMap.has(d)||this.cacheMap.set(d,new Sw(150));const g=this.cacheDependenciesMap.get(d),y=fd(r.id.toString(),u);g.get(y)||g.set(y,new Set);const b=this.cacheMap.get(d),T=r.toString();g.get(y).add(T),b.put(fd(r.toString(),u),s)}removeImagesFromCacheByIds(r,s,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const d=this.cacheMap.get(u),g=this.cacheDependenciesMap.get(u);for(const y of r){const b=fd(y.toString(),s);if(g.has(b)){for(const T of g.get(b))d.delete(T);g.delete(b)}}}rasterize(r,s,u,d,g=OG){const y=this.getFromCache(r,u,d);if(y)return y.clone();const b=g(s.icon,r.options),T=vC._getImage(b);return this.setInCache(r,T,u,d),T.clone()}}class oN{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,s){const u=this.toIdx(r,s);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(r,s){return this.leaves[this.toIdx(r,s)]}toIdx(r,s){return s*this.size+r}}function aN(a,r,s,u){let d=0,g=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(u[y])<1e-15){if(s[y]<a[y]||s[y]>r[y])return null}else{const b=1/u[y];let T=(a[y]-s[y])*b,E=(r[y]-s[y])*b;if(T>E){const k=T;T=E,E=k}if(T>d&&(d=T),E<g&&(g=E),d>g)return null}return d}function lN(a,r,s,u,d,g,y,b,T,E,k){const j=u-a,R=d-r,L=g-s,z=y-a,W=b-r,J=T-s,ee=k[1]*J-k[2]*W,oe=k[2]*z-k[0]*J,le=k[0]*W-k[1]*z,de=j*ee+R*oe+L*le;if(Math.abs(de)<1e-15)return null;const Se=1/de,_e=E[0]-a,Ae=E[1]-r,ke=E[2]-s,De=(_e*ee+Ae*oe+ke*le)*Se;if(De<0||De>1)return null;const at=Ae*L-ke*R,Ue=ke*j-_e*L,ct=_e*R-Ae*j,pt=(k[0]*at+k[1]*Ue+k[2]*ct)*Se;return pt<0||De+pt>1?null:(z*at+W*Ue+J*ct)*Se}function cN(a,r,s){return(a-r)/(s-r)}function uN(a,r,s,u,d,g,y,b,T){const E=1<<s,k=g-u,j=y-d,R=(a+1)/E*k+u,L=(r+0)/E*j+d,z=(r+1)/E*j+d;b[0]=(a+0)/E*k+u,b[1]=L,T[0]=R,T[1]=z}class dN{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(g){const y=Math.ceil(Math.log2(g.dim/8)),b=[];let T=Math.ceil(Math.pow(2,y));const E=1/T,k=(L,z,W,J,ee)=>{const oe=J?1:0,le=(L+1)*W-oe,de=z*W,Se=(z+1)*W-oe;ee[0]=L*W,ee[1]=de,ee[2]=le,ee[3]=Se};let j=new oN(T);const R=[];for(let L=0;L<T*T;L++){k(L%T,Math.floor(L/T),E,!1,R);const z=$h(R[0],R[1],g),W=$h(R[2],R[1],g),J=$h(R[2],R[3],g),ee=$h(R[0],R[3],g);j.minimums.push(Math.min(z,W,J,ee)),j.maximums.push(Math.max(z,W,J,ee)),j.leaves.push(1)}for(b.push(j),T/=2;T>=1;T/=2){const L=b[b.length-1];j=new oN(T);for(let z=0;z<T*T;z++){k(z%T,Math.floor(z/T),2,!0,R);const W=L.getElevation(R[0],R[1]),J=L.getElevation(R[2],R[1]),ee=L.getElevation(R[2],R[3]),oe=L.getElevation(R[0],R[3]),le=L.isLeaf(R[0],R[1]),de=L.isLeaf(R[2],R[1]),Se=L.isLeaf(R[2],R[3]),_e=L.isLeaf(R[0],R[3]),Ae=Math.min(W.min,J.min,ee.min,oe.min),ke=Math.max(W.max,J.max,ee.max,oe.max),De=le&&de&&Se&&_e;j.maximums.push(ke),j.minimums.push(Ae),j.leaves.push(ke-Ae<=5&&De?1:0)}b.push(j)}return b}(this.dem),u=s.length-1,d=s[u];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(s,0,0,u,0)}raycastRoot(r,s,u,d,g,y,b=1){return aN([r,s,-100],[u,d,this.maximums[0]*b],g,y)}raycast(r,s,u,d,g,y,b=1){if(!this.nodeCount)return null;const T=this.raycastRoot(r,s,u,d,g,y,b);if(T==null)return null;const E=[],k=[],j=[],R=[],L=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:z,t:W,nodex:J,nodey:ee,depth:oe}=L.pop();if(this.leaves[z]){uN(J,ee,oe,r,s,u,d,j,R);const de=1<<oe,Se=(J+0)/de,_e=(J+1)/de,Ae=(ee+0)/de,ke=(ee+1)/de,De=$h(Se,Ae,this.dem)*b,at=$h(_e,Ae,this.dem)*b,Ue=$h(_e,ke,this.dem)*b,ct=$h(Se,ke,this.dem)*b,pt=lN(j[0],j[1],De,R[0],j[1],at,R[0],R[1],Ue,g,y),bt=lN(R[0],R[1],Ue,j[0],R[1],ct,j[0],j[1],De,g,y),Ot=Math.min(pt!==null?pt:Number.MAX_VALUE,bt!==null?bt:Number.MAX_VALUE);if(Ot!==Number.MAX_VALUE)return Ot;{const It=it([],g,y,W);if(hN(De,at,ct,Ue,cN(It[0],j[0],R[0]),cN(It[1],j[1],R[1]))>=It[2])return W}continue}let le=0;for(let de=0;de<this._siblingOffset.length;de++){uN((J<<1)+this._siblingOffset[de][0],(ee<<1)+this._siblingOffset[de][1],oe+1,r,s,u,d,j,R),j[2]=-100,R[2]=this.maximums[this.childOffsets[z]+de]*b;const Se=aN(j,R,g,y);if(Se!=null){const _e=Se;E[de]=_e;let Ae=!1;for(let ke=0;ke<le&&!Ae;ke++)_e>=E[k[ke]]&&(k.splice(ke,0,de),Ae=!0);Ae||(k[le]=de),le++}}for(let de=0;de<le;de++){const Se=k[de];L.push({idx:this.childOffsets[z]+Se,t:E[Se],nodex:(J<<1)+this._siblingOffset[Se][0],nodey:(ee<<1)+this._siblingOffset[Se][1],depth:oe+1})}}return null}_addNode(r,s,u){return this.minimums.push(r),this.maximums.push(s),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(r,s,u,d,g){if(r[d].isLeaf(s,u)===1)return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const y=d-1,b=r[y];let T=0,E=0;for(let k=0;k<this._siblingOffset.length;k++){const j=2*s+this._siblingOffset[k][0],R=2*u+this._siblingOffset[k][1],L=b.getElevation(j,R),z=b.isLeaf(j,R),W=this._addNode(L.min,L.max,z);z&&(T|=1<<k),E||(E=W)}for(let k=0;k<this._siblingOffset.length;k++)T&1<<k||this._construct(r,2*s+this._siblingOffset[k][0],2*u+this._siblingOffset[k][1],y,E+k)}}function hN(a,r,s,u,d,g){return Rr(Rr(a,s,g),Rr(r,u,g),d)}function $h(a,r,s){const u=s.dim,d=ie(a*u-.5,0,u-1),g=ie(r*u-.5,0,u-1),y=Math.floor(d),b=Math.floor(g),T=Math.min(y+1,u-1),E=Math.min(b+1,u-1);return hN(s.get(y,b),s.get(T,b),s.get(y,E),s.get(T,E),d-y,g-b)}const LG={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function zG(a,r,s){return(256*a*256+256*r+s)/10-1e4}function FG(a,r,s){return 256*a+r+s/256-32768}class Tw{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,s,u,d=!1){if(this.uid=r,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void br(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const g=this.dim=s.height-2,y=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.floatView=new Float32Array(s.data.buffer),this.borderReady=d,this._modifiedForSources={},!d){for(let T=0;T<g;T++)y[this._idx(-1,T)]=y[this._idx(0,T)],y[this._idx(g,T)]=y[this._idx(g-1,T)],y[this._idx(T,-1)]=y[this._idx(T,0)],y[this._idx(T,g)]=y[this._idx(T,g-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(g,-1)]=y[this._idx(g-1,0)],y[this._idx(-1,g)]=y[this._idx(0,g-1)],y[this._idx(g,g)]=y[this._idx(g-1,g-1)]}const b=u==="terrarium"?FG:zG;for(let T=0;T<y.length;++T){const E=4*T;this.floatView[T]=b(this.pixels[E],this.pixels[E+1],this.pixels[E+2])}this._timestamp=ha.now()}_buildQuadTree(){this._tree=new dN(this)}get(r,s,u=!1){u&&(r=ie(r,-1,this.dim),s=ie(s,-1,this.dim));const d=this._idx(r,s);return this.floatView[d]}set(r,s,u){const d=this._idx(r,s),g=this.floatView[d];return this.floatView[d]=u,u-g}static getUnpackVector(r){return LG[r]}_idx(r,s){if(r<-1||r>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(r+1)}static pack(r,s){const u=[0,0,0,0],d=Tw.getUnpackVector(s);let g=Math.floor((r+d[3])/d[2]);return u[2]=g%256,g=Math.floor(g/256),u[1]=g%256,g=Math.floor(g/256),u[0]=g,u}getPixels(){return new sR({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,s,u){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let d=s*this.dim,g=s*this.dim+this.dim,y=u*this.dim,b=u*this.dim+this.dim;switch(s){case-1:d=g-1;break;case 1:g=d+1}switch(u){case-1:y=b-1;break;case 1:b=y+1}const T=-s*this.dim,E=-u*this.dim;for(let k=y;k<b;k++)for(let j=d;j<g;j++){const R=4*this._idx(j,k),L=4*this._idx(j+T,k+E);this.pixels[R+0]=r.pixels[L+0],this.pixels[R+1]=r.pixels[L+1],this.pixels[R+2]=r.pixels[L+2],this.pixels[R+3]=r.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function BG(a,r,s){a===1?r.headerLength=s.readFixed32():a===2?r.x=s.readVarint():a===3?r.y=s.readVarint():a===4?r.z=s.readVarint():a===5&&r.layers.push(function(u,d){return u.readFields(GG,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},d)}(s,s.readVarint()+s.pos))}function VG(a,r,s){a===1?(r.delta_filter=function(u,d){return u.readFields(UG,{blockSize:0},d)}(s,s.readVarint()+s.pos),r.filter="delta_filter"):a===2?(s.readVarint(),r.filter="zigzag_filter"):a===3?(s.readVarint(),r.filter="bitshuffle_filter"):a===4&&(s.readVarint(),r.filter="byteshuffle_filter")}function UG(a,r,s){a===1&&(r.blockSize=s.readVarint())}function $G(a,r,s){a===1?(s.readVarint(),r.codec="gzip_data"):a===2?(s.readVarint(),r.codec="jpeg_image"):a===3?(s.readVarint(),r.codec="webp_image"):a===4&&(s.readVarint(),r.codec="png_image")}function qG(a,r,s){let u=0,d=0;a===1?r.firstByte=s.readFixed64():a===2?r.lastByte=s.readFixed64():a===3?r.filters.push(function(g,y){return g.readFields(VG,{},y)}(s,s.readVarint()+s.pos)):a===4?r.codec=function(g,y){return g.readFields($G,{},y)}(s,s.readVarint()+s.pos):a===5?d=s.readFloat():a===6?u=s.readFloat():a===7?r.bands.push(s.readString()):a===8?r.offset=s.readDouble():a===9&&(r.scale=s.readDouble()),r.offset===0&&(r.offset=d),r.scale===0&&(r.scale=u)}function GG(a,r,s){a===1?r.version=s.readVarint():a===2?r.name=s.readString():a===3?r.units=s.readString():a===4?r.tileSize=s.readVarint():a===5?r.buffer=s.readVarint():a===6?r.pixelFormat=s.readVarint():a===7&&r.dataIndex.push(function(u,d){return u.readFields(qG,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},d)}(s,s.readVarint()+s.pos))}function WG(a,r,s){if(a===2)(function(u,d,g){u.readFields(HG,g,d)})(s,s.readVarint()+s.pos,r);else if(a===3)throw new Error("Not implemented")}function HG(a,r,s){if(a===1){let u=0;const d=s.readVarint()+s.pos;for(;s.pos<d;)r[u++]=s.readVarint()}}function ZG(a,r){if(r.length!==4)throw new Error(`Expected data of dimension 4 but got ${r.length}.`);let s=r[3];for(let u=2;u>=1;u--){const d=u===1?1:0,g=u===2?1:0;for(let y=0;y<r[0];y++){const b=r[1]*y;for(let T=d;T<r[1];T++){const E=r[2]*(T+b);for(let k=g;k<r[2];k++){const j=r[3]*(k+E);for(let R=0;R<r[3];R++){const L=j+R;a[L]+=a[L-s]}}}}s*=r[u]}return a}function XG(a){for(let r=0,s=a.length;r<s;r++)a[r]=a[r]>>>1^-(1&a[r]);return a}function KG(a,r){switch(r){case"uint32":return a;case"uint16":for(let s=0;s<a.length;s+=2){const u=a[s],d=a[s+1];a[s]=(240&u)>>4|(61440&u)>>8|(240&d)<<4|61440&d,a[s+1]=15&u|(3840&u)>>4|(15&d)<<8|(3840&d)<<4}return a;case"uint8":for(let s=0;s<a.length;s+=4){const u=a[s],d=a[s+1],g=a[s+2],y=a[s+3];a[s+0]=(192&u)>>6|(192&d)>>4|(192&g)>>2|192&y,a[s+1]=(48&u)>>4|(48&d)>>2|48&g|(48&y)<<2,a[s+2]=(12&u)>>2|12&d|(12&g)<<2|(12&y)<<4,a[s+3]=3&u|(3&d)<<2|(3&g)<<4|(3&y)<<6}return a;default:throw new Error(`Invalid pixel format, "${r}"`)}}rr(Tw,"DEMData"),rr(dN,"DemMinMaxQuadTree",{omit:["dem"]});var jl=Uint8Array,$x=Uint16Array,YG=Int32Array,fN=new jl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),pN=new jl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),JG=new jl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),mN=function(a,r){for(var s=new $x(31),u=0;u<31;++u)s[u]=r+=1<<a[u-1];var d=new YG(s[30]);for(u=1;u<30;++u)for(var g=s[u];g<s[u+1];++g)d[g]=g-s[u]<<5|u;return{b:s,r:d}},gN=mN(fN,2),_N=gN.b,QG=gN.r;_N[28]=258,QG[258]=28;for(var eW=mN(pN,0).b,yN=new $x(32768),Rs=0;Rs<32768;++Rs){var d_=(43690&Rs)>>1|(21845&Rs)<<1;yN[Rs]=((65280&(d_=(61680&(d_=(52428&d_)>>2|(13107&d_)<<2))>>4|(3855&d_)<<4))>>8|(255&d_)<<8)>>1}var qx=function(a,r,s){for(var u=a.length,d=0,g=new $x(r);d<u;++d)a[d]&&++g[a[d]-1];var y,b=new $x(r);for(d=1;d<r;++d)b[d]=b[d-1]+g[d-1]<<1;y=new $x(1<<r);var T=15-r;for(d=0;d<u;++d)if(a[d])for(var E=d<<4|a[d],k=r-a[d],j=b[a[d]-1]++<<k,R=j|(1<<k)-1;j<=R;++j)y[yN[j]>>T]=E;return y},Gx=new jl(288);for(Rs=0;Rs<144;++Rs)Gx[Rs]=8;for(Rs=144;Rs<256;++Rs)Gx[Rs]=9;for(Rs=256;Rs<280;++Rs)Gx[Rs]=7;for(Rs=280;Rs<288;++Rs)Gx[Rs]=8;var vN=new jl(32);for(Rs=0;Rs<32;++Rs)vN[Rs]=5;var tW=qx(Gx,9),rW=qx(vN,5),xC=function(a){for(var r=a[0],s=1;s<a.length;++s)a[s]>r&&(r=a[s]);return r},Mc=function(a,r,s){var u=r/8|0;return(a[u]|a[u+1]<<8)>>(7&r)&s},bC=function(a,r){var s=r/8|0;return(a[s]|a[s+1]<<8|a[s+2]<<16)>>(7&r)},nW=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Dc=function(a,r,s){var u=new Error(r||nW[a]);if(u.code=a,Error.captureStackTrace&&Error.captureStackTrace(u,Dc),!s)throw u;return u},iW=new jl(0),sW=typeof TextDecoder<"u"&&new TextDecoder;try{sW.decode(iW,{stream:!0})}catch{}const oW={gzip_data:"gzip"};class rc extends Error{constructor(r){super(r),this.name="MRTError"}}const aW={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},xN={uint32:1,uint16:2,uint8:4},lW={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let wC;class Ew{constructor(r=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=r}getLayer(r){const s=this.layers[r];if(!s)throw new rc(`Layer '${r}' not found`);return s}getHeaderLength(r){const s=new Uint8Array(r),u=new DataView(r);if(s[0]!==13)throw new rc("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(r){const s=new Uint8Array(r),u=this.getHeaderLength(r);if(s.length<u)throw new rc(`Expected header with length >= ${u} but got buffer of length ${s.length}`);const d=new wC(s.subarray(0,u)).readFields(BG,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new rc(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(const g of d.layers)this.layers[g.name]=new bN(g,{cacheSize:this._cacheSize});return this}createDecodingTask(r){const s=[],u=this.getLayer(r.layerName);for(let d of r.blockIndices){const g=u.dataIndex[d],y=g.firstByte-r.firstByte,b=g.lastByte-r.firstByte;if(u._blocksInProgress.has(d))continue;const T={layerName:u.name,firstByte:y,lastByte:b,pixelFormat:u.pixelFormat,blockIndex:d,blockShape:[g.bands.length].concat(u.bandShape),buffer:u.buffer,codec:g.codec.codec,filters:g.filters.map(E=>E.filter)};u._blocksInProgress.add(d),s.push(T)}return new wN(s,()=>{s.forEach(d=>u._blocksInProgress.delete(d.blockIndex))},(d,g)=>{if(s.forEach(y=>u._blocksInProgress.delete(y.blockIndex)),d)throw d;g.forEach(y=>{this.getLayer(y.layerName).processDecodedData(y)})})}}class bN{constructor({version:r,name:s,units:u,tileSize:d,pixelFormat:g,buffer:y,dataIndex:b},T){if(this.version=r,this.version!==1)throw new rc(`Cannot parse raster layer encoded with MRT version ${r}`);this.name=s,this.units=u,this.tileSize=d,this.buffer=y,this.pixelFormat=aW[g],this.dataIndex=b,this.bandShape=[d+2*y,d+2*y,xN[this.pixelFormat]],this._decodedBlocks=new Sw(T?T.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return xN[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:r})=>r).flat()}processDecodedData(r){const s=r.blockIndex.toString();this._decodedBlocks.get(s)||this._decodedBlocks.put(s,r.data)}getBlockForBand(r){let s=0;switch(typeof r){case"string":for(const[u,d]of this.dataIndex.entries()){for(const[g,y]of d.bands.entries())if(y===r)return{bandIndex:s+g,blockIndex:u,blockBandIndex:g};s+=d.bands.length}break;case"number":for(const[u,d]of this.dataIndex.entries()){if(r>=s&&r<s+d.bands.length)return{bandIndex:r,blockIndex:u,blockBandIndex:r-s};s+=d.bands.length}break;default:throw new rc(`Invalid band \`${JSON.stringify(r)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(r){let s=1/0,u=-1/0;const d=[],g=new Set;for(const y of r){const{blockIndex:b}=this.getBlockForBand(y);if(b<0)throw new rc(`Invalid band: ${JSON.stringify(y)}`);const T=this.dataIndex[b];d.includes(b)||d.push(b),g.add(b),s=Math.min(s,T.firstByte),u=Math.max(u,T.lastByte)}if(g.size>this.cacheSize)throw new rc(`Number of blocks to decode (${g.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:s,lastByte:u,blockIndices:d}}hasBand(r){const{blockIndex:s}=this.getBlockForBand(r);return s>=0}hasDataForBand(r){const{blockIndex:s}=this.getBlockForBand(r);return s>=0&&!!this._decodedBlocks.get(s.toString())}getBandView(r){const{blockIndex:s,blockBandIndex:u}=this.getBlockForBand(r);if(s<0)throw new rc(`Band not found: ${JSON.stringify(r)}`);const d=this._decodedBlocks.get(s.toString());if(!d)throw new rc(`Data for band ${JSON.stringify(r)} of layer "${this.name}" not decoded.`);const g=this.dataIndex[s],y=this.bandShape.reduce((E,k)=>E*k,1),b=u*y,T=d.subarray(b,b+y);return{data:T,bytes:new Uint8Array(T.buffer).subarray(T.byteOffset,T.byteOffset+T.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:g.offset,scale:g.scale}}}Ew.setPbf=function(a){wC=a};class wN{constructor(r,s,u){this.tasks=r,this._onCancel=s,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(r,s){this._finalized||(this._onComplete(r,s),this._finalized=!0)}}Ew.performDecoding=function(a,r){const s=new Uint8Array(a);return Promise.all(r.tasks.map(u=>{const{layerName:d,firstByte:g,lastByte:y,pixelFormat:b,blockShape:T,blockIndex:E,filters:k,codec:j}=u,R=s.subarray(g,y+1),L=new Uint32Array(T[0]*T[1]*T[2]);let z;if(j!=="gzip_data")throw new rc(`Unhandled codec: ${j}`);return z=function(W,J){if(!globalThis.DecompressionStream&&J==="gzip_data")return Promise.resolve(((de=function(Ae){Ae[0]==31&&Ae[1]==139&&Ae[2]==8||Dc(6,"invalid gzip data");var ke=Ae[3],De=10;4&ke&&(De+=2+(Ae[10]|Ae[11]<<8));for(var at=(ke>>3&1)+(ke>>4&1);at>0;at-=!Ae[De++]);return De+(2&ke)}(le=W))+8>le.length&&Dc(6,"invalid gzip data"),function(Ae,ke,De,at){var Ue=Ae.length;if(!Ue||ke.f&&!ke.l)return De||new jl(0);var ct=!De,pt=ct||ke.i!=2,bt=ke.i;ct&&(De=new jl(3*Ue));var Ot,It,gt=function(Zi){var Pi=De.length;if(Zi>Pi){var _i=new jl(Math.max(2*Pi,Zi));_i.set(De),De=_i}},At=ke.f||0,nt=ke.p||0,Ke=ke.b||0,St=ke.l,Mt=ke.d,vt=ke.m,er=ke.n,or=8*Ue;do{if(!St){At=Mc(Ae,nt,1);var Xt=Mc(Ae,nt+1,3);if(nt+=3,!Xt){var $t=Ae[(ye=4+((nt+7)/8|0))-4]|Ae[ye-3]<<8,Fr=ye+$t;if(Fr>Ue){bt&&Dc(0);break}pt&&gt(Ke+$t),De.set(Ae.subarray(ye,Fr),Ke),ke.b=Ke+=$t,ke.p=nt=8*Fr,ke.f=At;continue}if(Xt==1)St=tW,Mt=rW,vt=9,er=5;else if(Xt==2){var Gt=Mc(Ae,nt,31)+257,vr=Mc(Ae,nt+10,15)+4,$r=Gt+Mc(Ae,nt+5,31)+1;nt+=14;for(var nn=new jl($r),Pn=new jl(19),Gr=0;Gr<vr;++Gr)Pn[JG[Gr]]=Mc(Ae,nt+3*Gr,7);nt+=3*vr;var zn=xC(Pn),Fn=(1<<zn)-1,Li=qx(Pn,zn);for(Gr=0;Gr<$r;){var ye,pe=Li[Mc(Ae,nt,Fn)];if(nt+=15&pe,(ye=pe>>4)<16)nn[Gr++]=ye;else{var ut=0,Ut=0;for(ye==16?(Ut=3+Mc(Ae,nt,3),nt+=2,ut=nn[Gr-1]):ye==17?(Ut=3+Mc(Ae,nt,7),nt+=3):ye==18&&(Ut=11+Mc(Ae,nt,127),nt+=7);Ut--;)nn[Gr++]=ut}}var dt=nn.subarray(0,Gt),qt=nn.subarray(Gt);vt=xC(dt),er=xC(qt),St=qx(dt,vt),Mt=qx(qt,er)}else Dc(1);if(nt>or){bt&&Dc(0);break}}pt&&gt(Ke+131072);for(var hr=(1<<vt)-1,ur=(1<<er)-1,Hr=nt;;Hr=nt){var Ir=(ut=St[bC(Ae,nt)&hr])>>4;if((nt+=15&ut)>or){bt&&Dc(0);break}if(ut||Dc(2),Ir<256)De[Ke++]=Ir;else{if(Ir==256){Hr=nt,St=null;break}var lr=Ir-254;Ir>264&&(lr=Mc(Ae,nt,(1<<(jr=fN[Gr=Ir-257]))-1)+_N[Gr],nt+=jr);var On=Mt[bC(Ae,nt)&ur],ci=On>>4;if(On||Dc(3),nt+=15&On,qt=eW[ci],ci>3){var jr=pN[ci];qt+=bC(Ae,nt)&(1<<jr)-1,nt+=jr}if(nt>or){bt&&Dc(0);break}pt&&gt(Ke+131072);var An=Ke+lr;if(Ke<qt){var ui=0-qt,Jn=Math.min(qt,An);for(ui+Ke<0&&Dc(3);Ke<Jn;++Ke)De[Ke]=(void 0)[ui+Ke]}for(;Ke<An;++Ke)De[Ke]=De[Ke-qt]}}ke.l=St,ke.p=Hr,ke.b=Ke,ke.f=At,St&&(At=1,ke.m=vt,ke.d=Mt,ke.n=er)}while(!At);return Ke!=De.length&&ct?(Ot=De,((It=Ke)==null||It>Ot.length)&&(It=Ot.length),new jl(Ot.subarray(0,It))):De.subarray(0,Ke)}(le.subarray(de,-8),{i:2},new jl(((ee=le)[(oe=ee.length)-4]|ee[oe-3]<<8|ee[oe-2]<<16|ee[oe-1]<<24)>>>0))));var ee,oe,le,de;const Se=oW[J];if(!Se)throw new Error(`Unhandled codec: ${J}`);const _e=new globalThis.DecompressionStream(Se);return new Response(new Blob([W]).stream().pipeThrough(_e)).arrayBuffer().then(Ae=>new Uint8Array(Ae))}(R,j).then(W=>(function(J,ee){J.readFields(WG,ee)}(new wC(W),L),new lW[b](L.buffer))),z.then(W=>{for(let J=k.length-1;J>=0;J--)switch(k[J]){case"delta_filter":ZG(W,T);break;case"zigzag_filter":XG(W);break;case"bitshuffle_filter":KG(W,b);break;default:throw new rc(`Unhandled filter "${k[J]}"`)}return{layerName:d,blockIndex:E,data:W}}).catch(W=>{throw W})}))},rr(wN,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),rr(Ew,"MapboxRasterTile"),rr(bN,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class SN{constructor(r){this._stringToNumber={},this._numberToString=[];for(let s=0;s<r.length;s++){const u=r[s];this._stringToNumber[u]=s,this._numberToString[s]=u}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}class TN{constructor(r,s){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new dd(zt,16,0),this.featureIndexArray=new S1,this.promoteId=s,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(r,s,u,d,g,y=0,b=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,d,g,y);const E=this.grid;for(let k=0;k<s.length;k++){const j=s[k],R=[1/0,1/0,-1/0,-1/0];for(let L=0;L<j.length;L++){const z=j[L];R[0]=Math.min(R[0],z.x),R[1]=Math.min(R[1],z.y),R[2]=Math.max(R[2],z.x),R[3]=Math.max(R[3],z.y)}b!==0&&(R[0]-=b,R[1]-=b,R[2]+=b,R[3]+=b),R[0]<zt&&R[1]<zt&&R[2]>=0&&R[3]>=0&&E.insert(T,R[0],R[1],R[2],R[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ar(new tw(this.rawTileData)).layers,this.sourceLayerCoder=new SN(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,s){const{tilespaceGeometry:u,transform:d,tileTransform:g,pixelPosMatrix:y,availableImages:b,worldview:T}=s;this.loadVTLayers(),this.serializedLayersCache.clear();const E=s.queryRadius?s.queryRadius:0,k=u.bufferedTilespaceBounds,j=this.grid.query(k.min.x,k.min.y,k.max.x,k.max.y,(W,J,ee,oe)=>Wi(u.bufferedTilespaceGeometry,W-E,J-E,ee+E,oe+E));j.sort(cW);let R=null;d.elevation&&j.length>0&&(R=l_.create(d.elevation,this.tileID));const L={};let z;for(let W=0;W<j.length;W++){const J=j[W];if(J===z)continue;z=J;const ee=this.featureIndexArray.get(J);let oe=null;this.is3DTile?this.loadMatchingModelFeature(L,ee,r,u,d,T):this.loadMatchingFeature(L,ee,r,b,T,(le,de,Se,_e=0)=>(oe||(oe=ft(le,this.tileID.canonical,g)),de.queryIntersectsFeature(u,le,Se,oe,this.z,d,y,R,_e)))}return L}loadMatchingFeature(r,s,u,d,g,y){const{featureIndex:b,bucketIndex:T,sourceLayerIndex:E,layoutVertexArrayOffset:k}=s,j=this.bucketLayerIDs[T],R=u.layers,L=Object.keys(R);if(L.length&&!Lr(L,j))return;const z=u.sourceCache,W=this.sourceLayerCoder.decode(E),J=this.vtLayers[W].feature(b),ee=this.getId(J,W);for(let oe=0;oe<j.length;oe++){const le=j[oe];if(!R[le])continue;const{styleLayer:de,targets:Se}=R[le];let _e={};ee!==void 0&&(_e=z.getFeatureState(de.sourceLayer,ee));const Ae=!y||y(J,de,_e,k);if(!Ae)continue;const ke=new Hp(J,this.z,this.x,this.y,ee);ke.tile=this.tileID.canonical,ke.state=_e;let De=this.serializedLayersCache.get(le);De||(De=de.serialize(),De.id=le,this.serializedLayersCache.set(le,De)),ke.source=De.source,ke.sourceLayer=De["source-layer"],ke.layer=Object.assign({},De),ke.layer.paint=EN(De.paint,de.paint,J,_e,d),ke.layer.layout=EN(De.layout,de.layout,J,_e,d);let at=!1;for(const Ue of Se){this.updateFeatureProperties(ke,Ue);const{filter:ct}=Ue;if(ct){if(J.properties=ke.properties,ct.needGeometry){const pt=Ze(J,!0);if(!ct.filter(new wi(this.tileID.overscaledZ,{worldview:g}),pt,this.tileID.canonical))continue}else if(!ct.filter(new wi(this.tileID.overscaledZ,{worldview:g}),J))continue}at=!0,Ue.targetId&&this.addFeatureVariant(ke,Ue)}at&&this.appendToResult(r,le,b,ke,Ae)}}loadMatchingModelFeature(r,s,u,d,g,y){const{featureIndex:b,bucketIndex:T}=s,E=this.bucketLayerIDs[T],k=u.layers,j=Object.keys(k);if(!j.length||Lr(j,E))for(let R=0;R<E.length;R++){const L=E[R],{styleLayer:z,targets:W}=k[L];if(z.type!=="model")continue;const J=d.tile,ee=J.getBucket(z);if(!(ee&&ee instanceof yw))continue;const oe=mG(ee,b,d,g);if(!oe)continue;const{z:le,x:de,y:Se}=J.tileID.canonical,{feature:_e,intersectionZ:Ae,position:ke}=oe;let De={};_e.id!==void 0&&(De=u.sourceCache.getFeatureState(z.sourceLayer,_e.id));const at=new Hp({},le,de,Se,_e.id);at.tile=this.tileID.canonical,at.state=De,at.properties=_e.properties,at.geometry={type:"Point",coordinates:[ke.lng,ke.lat]};let Ue=this.serializedLayersCache.get(L);Ue||(Ue=z.serialize(),Ue.id=L,this.serializedLayersCache.set(L,Ue)),at.source=Ue.source,at.sourceLayer=Ue["source-layer"],at.layer=Object.assign({},Ue);let ct=!1;for(const pt of W){this.updateFeatureProperties(at,pt);const{filter:bt}=pt;if(bt){if(_e.properties=at.properties,bt.needGeometry){if(!bt.filter(new wi(this.tileID.overscaledZ,{worldview:y}),_e,this.tileID.canonical))continue}else if(!bt.filter(new wi(this.tileID.overscaledZ,{worldview:y}),_e))continue}ct=!0,pt.targetId&&this.addFeatureVariant(at,pt)}ct&&this.appendToResult(r,L,b,at,Ae)}}updateFeatureProperties(r,s,u){if(s.properties){const d={};for(const g in s.properties){const y=s.properties[g].evaluate({zoom:this.z},r._vectorTileFeature,r.state,r.tile,u);y!=null&&(d[g]=y)}r.properties=d}}addFeatureVariant(r,s,u){const d={target:s.target,namespace:s.namespace,uniqueFeatureID:s.uniqueFeatureID};s.properties&&(d.properties=r.properties),r.variants=r.variants||{},r.variants[s.targetId]=r.variants[s.targetId]||[],r.variants[s.targetId].push(d)}appendToResult(r,s,u,d,g){let y=r[s];y===void 0&&(y=r[s]=[]),y.push({featureIndex:u,feature:d,intersectionZ:g})}lookupSymbolFeatures(r,s,u,d,g,y){const b={};this.loadVTLayers();for(const T of r)this.loadMatchingFeature(b,{bucketIndex:s,sourceLayerIndex:u,featureIndex:T,layoutVertexArrayOffset:0},d,g,y);return b}loadFeature(r){const{featureIndex:s,sourceLayerIndex:u}=r;this.loadVTLayers();const d=this.sourceLayerCoder.decode(u),g=this.vtFeatures[d];if(g[s])return g[s];const y=this.vtLayers[d].feature(s);return g[s]=y,y}hasLayer(r){for(const s of this.bucketLayerIDs)for(const u of s)if(r===u)return!0;return!1}getId(r,s){let u=r.id;if(this.promoteId){const d=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[s];if(d!=null)if(Array.isArray(d)){if(!this.promoteIdExpression){const g=Ql(d);if(g.result!=="success"){const y=g.value.map(b=>`${b.key}: ${b.message}`).join(", ");return void br(`Failed to create expression for promoteId: ${y}`)}this.promoteIdExpression=g.value}u=this.promoteIdExpression.evaluate({zoom:0},r)}else u=r.properties[d];typeof u=="boolean"&&(u=Number(u))}return u}}function EN(a,r,s,u,d){return Dt(a,(g,y)=>{const b=r instanceof hd?r.get(y):null;return b&&b.evaluate?b.evaluate(s,u,void 0,d):b})}function cW(a,r){return r-a}rr(TN,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const CN=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class SC{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,u]=new Uint8Array(r,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=u>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const g=CN[15&u];if(!g)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(r,2,1),[b]=new Uint32Array(r,4,1);return new SC(b,y,g,r)}constructor(r,s=64,u=Float64Array,d){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=u,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const g=CN.indexOf(this.ArrayType),y=2*r*this.ArrayType.BYTES_PER_ELEMENT,b=r*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-b%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${u}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+b+T,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+y+b+T),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+b+T,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=r)}add(r,s){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=r,this.coords[this._pos++]=s,u}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return TC(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,s,u,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:y,nodeSize:b}=this,T=[0,g.length-1,0],E=[];for(;T.length;){const k=T.pop()||0,j=T.pop()||0,R=T.pop()||0;if(j-R<=b){for(let J=R;J<=j;J++){const ee=y[2*J],oe=y[2*J+1];ee>=r&&ee<=u&&oe>=s&&oe<=d&&E.push(g[J])}continue}const L=R+j>>1,z=y[2*L],W=y[2*L+1];z>=r&&z<=u&&W>=s&&W<=d&&E.push(g[L]),(k===0?r<=z:s<=W)&&(T.push(R),T.push(L-1),T.push(1-k)),(k===0?u>=z:d>=W)&&(T.push(L+1),T.push(j),T.push(1-k))}return E}within(r,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:g,nodeSize:y}=this,b=[0,d.length-1,0],T=[],E=u*u;for(;b.length;){const k=b.pop()||0,j=b.pop()||0,R=b.pop()||0;if(j-R<=y){for(let J=R;J<=j;J++)IN(g[2*J],g[2*J+1],r,s)<=E&&T.push(d[J]);continue}const L=R+j>>1,z=g[2*L],W=g[2*L+1];IN(z,W,r,s)<=E&&T.push(d[L]),(k===0?r-u<=z:s-u<=W)&&(b.push(R),b.push(L-1),b.push(1-k)),(k===0?r+u>=z:s+u>=W)&&(b.push(L+1),b.push(j),b.push(1-k))}return T}}function TC(a,r,s,u,d,g){if(d-u<=s)return;const y=u+d>>1;AN(a,r,y,u,d,g),TC(a,r,s,u,y-1,1-g),TC(a,r,s,y+1,d,1-g)}function AN(a,r,s,u,d,g){for(;d>u;){if(d-u>600){const E=d-u+1,k=s-u+1,j=Math.log(E),R=.5*Math.exp(2*j/3),L=.5*Math.sqrt(j*R*(E-R)/E)*(k-E/2<0?-1:1);AN(a,r,s,Math.max(u,Math.floor(s-k*R/E+L)),Math.min(d,Math.floor(s+(E-k)*R/E+L)),g)}const y=r[2*s+g];let b=u,T=d;for(Wx(a,r,u,s),r[2*d+g]>y&&Wx(a,r,u,d);b<T;){for(Wx(a,r,b,T),b++,T--;r[2*b+g]<y;)b++;for(;r[2*T+g]>y;)T--}r[2*u+g]===y?Wx(a,r,u,T):(T++,Wx(a,r,T,d)),T<=s&&(u=T+1),s<=T&&(d=T-1)}}function Wx(a,r,s,u){EC(a,s,u),EC(r,2*s,2*u),EC(r,2*s+1,2*u+1)}function EC(a,r,s){const u=a[r];a[r]=a[s],a[s]=u}function IN(a,r,s,u){const d=a-s,g=r-u;return d*d+g*g}o.$=Xm,o.A=xc,o.B=fd,o.C=2,o.D=Xg,o.E=yc,o.F=Ix,o.G=eD,o.H=Zm,o.I=js,o.J=Fv,o.K=oh,o.L=mp,o.M=vg,o.N=yg,o.O=Cv,o.P=xt,o.Q=Sg,o.R=ed,o.S=Th,o.T=NE,o.U=Ql,o.V=_w,o.W=Iv,o.X=ph,o.Y=fh,o.Z=bp,o._=Oo,o.a=function(a){return Ai.API_CDN_URL_REGEX.test(a)},o.a$=Ih,o.a0=Dr,o.a1=Jy,o.a2=Eh,o.a3=class extends _w{},o.a4=xg,o.a5=Ev,o.a6=Ve,o.a7=function(a){const r=a.value;return r?Dr(r)?dC(r,!0)?[]:[new _w(a.key,r,`invalid url "${r}"`)]:[new _w(a.key,r,`string expected, "${oh(r)}" found`)]:[]},o.a8=h1,o.a9=Ki,o.aA=ie,o.aB=G,o.aC=pr,o.aD=ta,o.aE=Us,o.aF=se,o.aG=st,o.aH=function(a,r){const s={};for(let u=0;u<r.length;u++){const d=r[u];d in a&&(s[d]=a[d])}return s},o.aI=O,o.aJ=ne,o.aK=class{constructor(a){this.entries={},this.scheduler=a}request(a,r,s,u){const d=this.entries[a]=this.entries[a]||{callbacks:[]};if(d.result){const[g,y]=d.result;return this.scheduler?this.scheduler.add(()=>{u(g,y)},r):u(g,y),()=>{}}return d.callbacks.push(u),d.cancel||(d.cancel=s((g,y)=>{d.result=[g,y];for(const b of d.callbacks)this.scheduler?this.scheduler.add(()=>{b(g,y)},r):b(g,y);setTimeout(()=>delete this.entries[a],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(g=>g!==u),d.callbacks.length||(d.cancel(),delete this.entries[a]))}}},o.aL=function(a,r,s){const u=JSON.stringify(a.request);return a.data&&(this.deduped.entries[u]={result:[null,a.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},d=>{const g=th(a.request,(y,b,T)=>{y?d(y):b&&d(null,{vectorTile:s?void 0:new ar(new tw(b)),rawData:b,responseHeaders:new Map(T.entries())})});return()=>{g.cancel(),d()}},r)},o.aM=function(a){return a?{cacheControl:a.get("Cache-Control"),expires:a.get("Expires")}:{cacheControl:void 0,expires:void 0}},o.aN=function(a){$m++,$m>Jo&&(a.getActor().send("enforceCacheSizeLimit",Qf),$m=0)},o.aO=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log2(a)))},o.aP=Fs,o.aQ=PD,o.aR=ND,o.aS=F,o.aT=ID,o.aU=function(a,r){const s=document.createElement("video");s.muted=!0,s.onloadstart=function(){r(null,s)};for(let u=0;u<a.length;u++){const d=document.createElement("source");Gn(a[u])||(s.crossOrigin="Anonymous"),d.src=a[u],s.appendChild(d)}return{cancel:()=>{}}},o.aV=Sx,o.aW=Zp,o.aX=Xe,o.aY=Rx,o.aZ=he,o.a_=ce,o.aa=jt,o.ab=class{constructor(a){this.specification=a}possiblyEvaluate(a,r){return si(a.expression.evaluate(r))}interpolate(a,r,s){return{x:Rr(a.x,r.x,s),y:Rr(a.y,r.y,s),z:Rr(a.z,r.z,s),azimuthal:Rr(a.azimuthal,r.azimuthal,s),polar:Rr(a.polar,r.polar,s)}}},o.ac=wi,o.ad=_u,o.ae=Fe,o.af=yn,o.ag=Ye,o.ah=me,o.ai=hd,o.aj=zh,o.ak=Rr,o.al=zt,o.am=cp,o.an=ln,o.ao=Yn,o.ap=class{constructor(a){this.specification=a}possiblyEvaluate(a,r){return function([s,u]){const d=si([1,s,u]);return{x:d.x,y:d.y,z:d.z}}(a.expression.evaluate(r))}interpolate(a,r,s){return{x:Rr(a.x,r.x,s),y:Rr(a.y,r.y,s),z:Rr(a.z,r.z,s)}}},o.aq=function(a,r,s=0,u=!0){const d=new xt(s,s),g=a.sub(d),y=r.add(d),b=[g,new xt(y.x,g.y),y,new xt(g.x,y.y)];return u&&b.push(g.clone()),b},o.ar=function(a,r){const s=[];for(let u=0;u<a.length;u++){const d=Pe(u-1,-1,a.length-1),g=Pe(u+1,-1,a.length-1),y=a[u],b=a[g],T=a[d].sub(y).unit(),E=b.sub(y).unit(),k=E.angleWithSep(T.x,T.y),j=T.add(E).unit().mult(-1*r/Math.sin(k/2));s.push(y.add(j))}return s},o.as=fD,o.at=Wi,o.au=function(a,r,s=0){return qe(((r.x-s)*a.scale-a.x)*zt,(r.y*a.scale-a.y)*zt,we(r.z,r.y))},o.av=Ei,o.aw=Er,o.ax=Xr,o.ay=AM,o.az=function(a){let r=1/0,s=1/0,u=-1/0,d=-1/0;for(const g of a)r=Math.min(r,g.x),s=Math.min(s,g.y),u=Math.max(u,g.x),d=Math.max(d,g.y);return{min:new xt(r,s),max:new xt(u,d)}},o.b=function(a){return Ai.API_FONTS_REGEX.test(a)},o.b$=SE,o.b0=Mi,o.b1=Je,o.b2=x1,o.b3=fw,o.b4=function(){ma.isLoading()||ma.isLoaded()||Ov()!=="deferred"||Lv()},o.b5=Pg,o.b6=Ze,o.b7=Hp,o.b8=xs,o.b9=$E,o.bA=Ne,o.bB=Y,o.bC=function(a,r){const{x:s,y:u}=a.point,d=Wj(s,u,a.worldSize/a._pixelsPerMercatorPixel,0,0);return G(d,d,uE(Tu(r)))},o.bD=N,o.bE=ps,o.bF=ir,o.bG=it,o.bH=Ur,o.bI=Vr,o.bJ=n_,o.bK=za,o.bL=YE,o.bM=function(a,r,s,u,d){const g=5*r+2;a.float32[g+0]=s,a.float32[g+1]=u,a.float32[g+2]=d},o.bN=a_,o.bO=$n,o.bP=rs,o.bQ=Ts,o.bR=qn,o.bS=Pe,o.bT=function(a,r,s,u){var d=new P(4);return d[0]=a,d[1]=r,d[2]=s,d[3]=u,d},o.bU=class{isDataAvailableAtPoint(a){const r=this._source();if(this.isUsingMockSource()||!r||a.y<0||a.y>1)return!1;const s=r.getSource().maxzoom,u=1<<s,d=Math.floor(a.x),g=Math.floor((a.x-d)*u),y=Math.floor(a.y*u),b=this.findDEMTileFor(new Fs(s,d,s,g,y));return!(!b||!b.dem)}getAtPointOrZero(a,r=0){return this.getAtPoint(a,r)||0}getAtPoint(a,r,s=!0){if(this.isUsingMockSource())return null;r==null&&(r=null);const u=this._source();if(!u||a.y<0||a.y>1)return r;const d=u.getSource().maxzoom,g=1<<d,y=Math.floor(a.x),b=a.x-y,T=new Fs(d,y,d,Math.floor(b*g),Math.floor(a.y*g)),E=this.findDEMTileFor(T);if(!E||!E.dem)return r;const k=E.dem,j=1<<E.tileID.canonical.z,R=(b*j-E.tileID.canonical.x)*k.dim,L=(a.y*j-E.tileID.canonical.y)*k.dim,z=Math.floor(R),W=Math.floor(L);return(s?this.exaggeration():1)*Rr(Rr(k.get(z,W),k.get(z,W+1),L-W),Rr(k.get(z+1,W),k.get(z+1,W+1),L-W),R-z)}static getAtTileOffset(a,r,s,u){const d=1<<a.canonical.z;return u?u.pointElevation(r):s?s.getAtPointOrZero(new Fe(a.wrap+(a.canonical.x+r.x/zt)/d,(a.canonical.y+r.y/zt)/d)):0}static getAtTileOffsetFunc(a,r,s,u){return(d,g,y)=>{const b=this.getAtTileOffset(a,d,g,y),T=u.upVector(a.canonical,d.x,d.y);return Vt(T,T,b*u.upVectorScale(a.canonical,r,s).metersToTile),T}}getForTilePoints(a,r,s,u){if(this.isUsingMockSource())return!1;const d=l_.create(this,a,u);return!!d&&(r.forEach(g=>{g[2]=this.exaggeration()*d.getElevationAt(g[0],g[1],s)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(a);if(!r||!r.dem)return null;const s=r.dem.tree,u=r.tileID,d=1<<a.canonical.z-u.canonical.z;let g=a.canonical.x/d-u.canonical.x,y=a.canonical.y/d-u.canonical.y,b=0;for(let T=0;T<a.canonical.z-u.canonical.z&&!s.leaves[b];T++){g*=2,y*=2;const E=2*Math.floor(y)+Math.floor(g);b=s.childOffsets[b]+E,g%=1,y%=1}return{min:this.exaggeration()*s.minimums[b],max:this.exaggeration()*s.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,r,s){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const a=this.visibleDemTiles;if(a.length===0)return null;let r=!1,s=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const d of a){const g=this.getMinMaxForTile(d.tileID);g&&(s=Math.min(s,g.min),u=Math.max(u,g.max),r=!0)}return r?{min:s,max:u}:null}},o.bV=q1,o.bW=is,o.bX=oo,o.bY=SR,o.bZ=OD,o.b_=AR,o.ba=xE,o.bb=ft,o.bc=ea,o.bd=Lg,o.be=Bj,o.bf=Vi,o.bg=Hg,o.bh=cC,o.bi=function(a,r){const s=zh(r.zoom);if(s===0)return Tu(a);const u=M1(a),d=cE(u),g=se(u.getWest())*r.worldSize,y=se(u.getEast())*r.worldSize,b=ne(u.getNorth())*r.worldSize,T=ne(u.getSouth())*r.worldSize,E=[g,b,0],k=[y,b,0],j=[g,T,0],R=[y,T,0],L=re([],r.globeMatrix);return yn(E,E,L),yn(k,k,L),yn(j,j,L),yn(R,R,L),d[0]=yd(d[0],j,s),d[1]=yd(d[1],R,s),d[2]=yd(d[2],k,s),d[3]=yd(d[3],E,s),en.fromPoints(d)},o.bj=N1,o.bk=re,o.bl=ax,o.bm=yd,o.bn=pd,o.bo=D$,o.bp=lt,o.bq=X,o.br=Ew,o.bs=tw,o.bt=th,o.bu=function(a,r){const s=[];for(const u in a)u in r||s.push(u);return s},o.bv=Ie,o.bw=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.bx=wo,o.by=H,o.bz=K,o.c=No,o.c$=function(a){return a*a*a*a*a},o.c0=XE,o.c1=aD,o.c2=rC,o.c3=SC,o.c4=Vt,o.c5=et,o.c6=Or,o.c7=function(a,r,s){s*=.5;var u=r[0],d=r[1],g=r[2],y=r[3],b=Math.sin(s),T=Math.cos(s);return a[0]=u*T+d*b,a[1]=d*T-u*b,a[2]=g*T+y*b,a[3]=y*T-g*b,a},o.c8=Ln,o.c9=ns,o.cA=Wn,o.cB=dM,o.cC=Na,o.cD=$j,o.cE=function(a,r,s,u,d,g,y,b,T){if(T.name==="globe")return $j(a,r,new Na(s,u,d),!1);const E=Rx({z:s,x:u,y:d},T);return new en([(g+E.x/E.scale)*r,r*(E.y/E.scale),y],[(g+E.x2/E.scale)*r,r*(E.y2/E.scale),b])},o.cF=function(a,r,s){return a[0]=Math.min(r[0],s[0]),a[1]=Math.min(r[1],s[1]),a[2]=Math.min(r[2],s[2]),a[3]=Math.min(r[3],s[3]),a},o.cG=function(a,r,s){return a[0]=Math.max(r[0],s[0]),a[1]=Math.max(r[1],s[1]),a[2]=Math.max(r[2],s[2]),a[3]=Math.max(r[3],s[3]),a},o.cH=function(a){const r=Math.round((a+45+360)%360/90)%4;return qy[r]},o.cI=fe,o.cJ=Wt,o.cK=n,o.cL=function(a){const r=K(new Float64Array(16));G(r,a.pixelMatrix,a.globeMatrix);const s=[0,w,0],u=[0,S,0];return yn(s,s,r),yn(u,u,r),[s[0]>0&&s[0]<=a.width&&s[1]>0&&s[1]<=a.height&&!hE(a,new F(a.center.lat,90)),u[0]>0&&u[0]<=a.width&&u[1]>0&&u[1]<=a.height&&!hE(a,new F(a.center.lat,-90))]},o.cM=function(a,r){const{scale:s}=a.tileTransform,u=s*zt/(a.tileSize*Math.pow(2,r.zoom-a.tileID.overscaledZ+a.tileID.canonical.z));return function(d,g,y){var b=g[1],T=g[2],E=g[3],k=y[0],j=y[1];return d[0]=g[0]*k,d[1]=b*k,d[2]=T*j,d[3]=E*j,d}(new Float32Array(4),r.inverseAdjustmentMatrix,[u,u])},o.cN=X1,o.cO=Me,o.cP=uM,o.cQ=function(a){const r=uM(a,!0);return N([],[r[0],r[1],r[4],r[5]])},o.cR=ue,o.cS=ri,o.cT=Ee,o.cU=function(a){const{x:r,y:s}=a.point,{lng:u,lat:d}=a._center;return Wj(r,s,a.worldSize,u,d)},o.cV=mt,o.cW=Do,o.cX=Oa,o.cY=ss,o.cZ=p,o.c_=function(a,r,s){let u=0;for(let d=0;d<2;++d)a[d]>0&&(u+=(a[d]-0)*(a[d]-0)),r[d]<0&&(u+=(0-r[d])*(0-r[d]));return u},o.ca=function(a,r){return a[0]=-r[0],a[1]=-r[1],a[2]=-r[2],a[3]=r[3],a},o.cb=yt,o.cc=function(a,r,s,u,d){var g=1/Math.tan(r/2);if(a[0]=g/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=g,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,d!=null&&d!==1/0){var y=1/(u-d);a[10]=(d+u)*y,a[14]=2*d*u*y}else a[10]=-1,a[14]=-2*u;return a},o.cd=function(a,r,s,u,d,g,y){var b=1/(r-s),T=1/(u-d),E=1/(g-y);return a[0]=-2*b,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*T,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*E,a[11]=0,a[12]=(r+s)*b,a[13]=(d+u)*T,a[14]=(y+g)*E,a[15]=1,a},o.ce=ae,o.cf=function(a,r,s){a[4*r+0]=s[0],a[4*r+1]=s[1],a[4*r+2]=s[2],a[4*r+3]=s[3]},o.cg=$g,o.ch=Dh,o.ci=ms,o.cj=ec,o.ck=zp,o.cl=yD,o.cm=function(){var a=new P(4);return P!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},o.cn=function(a,r,s){var u=r[0],d=r[1],g=r[2],y=r[3],b=Math.sin(s),T=Math.cos(s);return a[0]=u*T+g*b,a[1]=d*T+y*b,a[2]=u*-b+g*T,a[3]=d*-b+y*T,a},o.co=function(a,r){return a[0]===r[0]&&a[1]===r[1]&&a[2]===r[2]&&a[3]===r[3]},o.cp=Os,o.cq=function(a){var r=a[0],s=a[1],u=a[2],d=a[3];return Math.sqrt(r*r+s*s+u*u+d*d)},o.cr=ua,o.cs=qi,o.ct=tc,o.cu=3,o.cv=2,o.cw=7,o.cx=6,o.cy=jn,o.cz=be,o.d=function(a){return Ai.API_TILEJSON_REGEX.test(a)},o.d$=Xj,o.d0=Q,o.d1=45,o.d2=Lp,o.d3=function(a,r,s){const u=Math.sqrt(a*a+r*r+s*s),d=u>0?Math.acos(s/u)*Mo:0;let g=a!==0||r!==0?Math.atan2(-r,-a)*Mo+90:0;return g<0&&(g+=360),[u,g,d]},o.d4=qe,o.d5=si,o.d6=Ce,o.d7=$e,o.d8=en,o.d9=_t,o.dA=nx,o.dB=class extends cl{constructor(a){super(a),this.current=nE}set(a,r,s){if(this.fetchUniformLocation(a,r)){for(let u=0;u<9;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}},o.dC=Kf,o.dD=function(a,r,s){const u=zh(s.zoom),d=a.style.map._antialias,g=a.terrain&&a.terrain.exaggeration()>0;return u===0&&!d&&!g},o.dE=function(a){const r=a.pixelsPerMeter,s=r/ae(1,a.center.lat),u=K(new Float64Array(16));return X(u,u,[a.point.x,a.point.y,0]),ue(u,u,[s,s,r]),Float32Array.from(u)},o.dF=M1,o.dG=function(a){const r=fe-5;a=ie(a,-r,r)/r*90;const s=Math.pow(Math.abs(Math.sin(ln(a))),3);return Math.round(s*(v.length-1))},o.dH=function(a,r,s,u){const d=r.getNorth(),g=r.getSouth(),y=r.getWest(),b=r.getEast(),T=1<<a.z,E=b-y,k=d-g,j=E/m,R=-k/v[s],L=[0,j,0,R,0,0,d,y,0];if(a.z>0){const z=180/u;B(L,L,[z/E+1,0,0,0,z/k+1,0,-.5*z/j,.5*z/R,1])}return L[2]=T,L[5]=a.x,L[8]=a.y,L},o.dI=Tu,o.dJ=function(a,r,s){const u=K(new Float64Array(16)),d=(r/(1<<a)-.5)*Math.PI*2;return xe(u,s.globeMatrix,d),Float32Array.from(u)},o.dK=sR,o.dL=R1,o.dM=function(a,r){return[Math.pow(a[0],2.2)*r,Math.pow(a[1],2.2)*r,Math.pow(a[2],2.2)*r]},o.dN=U,o.dO=function(a,r){var s=Math.sin(r),u=Math.cos(r);return a[0]=u,a[1]=s,a[2]=0,a[3]=-s,a[4]=u,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},o.dP=os,o.dQ=Gj,o.dR=Ci,o.dS=Gi,o.dT=256,o.dU=function(a,r){const s=[0,0,0];return yn(s,s,N1(Tu(r.canonical))),yn(s,s,a),s},o.dV=a=>({u_matrix:new zp(a),u_texsize:new ec(a),u_pixels_to_tile_units:new ix(a),u_device_pixel_ratio:new ms(a),u_width_scale:new ms(a),u_floor_width_scale:new ms(a),u_image:new $g(a),u_units_to_pixels:new ec(a),u_tile_units_to_pixels:new ms(a),u_alpha_discard_threshold:new ms(a),u_trim_offset:new ec(a),u_trim_fade_range:new ec(a),u_trim_color:new Lp(a),u_emissive_strength:new ms(a),u_zbias_factor:new ms(a),u_tile_to_meter:new ms(a),u_ground_shadow_factor:new Dh(a),u_pattern_transition:new ms(a)}),o.dW=a=>({u_matrix:new zp(a),u_pixels_to_tile_units:new ix(a),u_device_pixel_ratio:new ms(a),u_width_scale:new ms(a),u_floor_width_scale:new ms(a),u_units_to_pixels:new ec(a),u_dash_image:new $g(a),u_gradient_image:new $g(a),u_image_height:new ms(a),u_texsize:new ec(a),u_tile_units_to_pixels:new ms(a),u_alpha_discard_threshold:new ms(a),u_trim_offset:new ec(a),u_trim_fade_range:new ec(a),u_trim_color:new Lp(a),u_emissive_strength:new ms(a),u_zbias_factor:new ms(a),u_tile_to_meter:new ms(a),u_ground_shadow_factor:new Dh(a)}),o.dX=a=>({u_camera_to_center_distance:new ms(a),u_extrude_scale:new ix(a),u_device_pixel_ratio:new ms(a),u_matrix:new zp(a),u_inv_rot_matrix:new zp(a),u_merc_center:new ec(a),u_tile_id:new Dh(a),u_zoom_transition:new ms(a),u_up_dir:new Dh(a),u_emissive_strength:new ms(a)}),o.dY=kh,o.dZ=bq,o.d_=class{constructor(a,r,s,u){this.context=a,this.format=u,this.size=s,this.texture=a.gl.createTexture();const[d,g,y]=this.size,{gl:b}=a;b.bindTexture(b.TEXTURE_3D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in r&&r.data&&b.texImage3D(b.TEXTURE_3D,0,this.format,d,g,y,0,ME(this.format),DE(this.format),r.data)}bind(a,r){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_3D,this.texture),a!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,a),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,a),this.minFilter=a),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}},o.da=function(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]},o.db=cM,o.dc=VE,o.dd=pM,o.de=dC,o.df=function(a,r){return a.readFields(yG,{icons:[]},r)},o.dg=G1,o.dh=i_,o.di=QE,o.dj=Hy,o.dk=d1,o.dl=Yf,o.dm=op,o.dn=dr,o.dp=function(a){const r=a.indexOf(jp);return r>=0?a.slice(0,r):a},o.dq=function(a){return a.indexOf(jp)>=0},o.dr=function(a){const r=a.lastIndexOf(jp);return r>=0?a.slice(r+1):""},o.ds=function(a){const r=[],s=a.id;return s===void 0&&r.push({message:`layers.${s}: missing required property "id"`}),a.render===void 0&&r.push({message:`layers.${s}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&r.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),r},o.dt=function(a,r,s,u){return a.type==="custom"?new dG(a,r):new gG[a.type](a,r,s,u)},o.du=Ct,o.dv=function(a){const r=a.indexOf(jp);return r>=0?a.slice(r+1):""},o.dw=class extends Hp{constructor(a,r){super(a._vectorTileFeature,a._z,a._x,a._y,a.id),a.state&&(this.state=Object.assign({},a.state)),this.target=r.target,this.namespace=r.namespace,r.properties&&(this.properties=r.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=a.source,this.sourceLayer=a.sourceLayer,this.layer=a.layer)}toJSON(){const a=super.toJSON();return a.target=this.target,a.namespace=this.namespace,a}},o.dx=Nv,o.dy=ep,o.dz=function(a){return a({pluginStatus:Wo,pluginURL:xu}),Nv.on("pluginStateChange",a),a},o.e=Ai,o.e$=function([a,r,s]){const u=Math.hypot(a,r,s),d=Math.atan2(a,s),g=.5*Math.PI-Math.acos(-r/u);return new F(Do(d),Do(g))},o.e0=(a,r,s,u,d,g)=>{const y=a.transform,b=y.projection.name==="globe";let T;if(g.paint.get("circle-pitch-alignment")==="map")if(b){const k=Gj(y.zoom,r.canonical)*y._pixelsPerMercatorPixel;T=Float32Array.from([k,0,0,k])}else T=y.calculatePixelsToTileUnitsMatrix(s);else T=new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]);const E={u_camera_to_center_distance:a.transform.getCameraToCenterDistance(y.projection),u_matrix:a.translatePosMatrix(r.projMatrix,s,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ha.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:F$,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:g.paint.get("circle-emissive-strength")};if(b){E.u_inv_rot_matrix=u,E.u_merc_center=d,E.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],E.u_zoom_transition=zh(y.zoom);const k=d[0]*zt,j=d[1]*zt;E.u_up_dir=y.projection.upVector(new Na(0,0,0),k,j)}return E},o.e1=jM,o.e2=Qo,o.e3=(a,r,s,u,d,g,y,b,T,E)=>{const k=a.transform,j=k.pitch<15?IM(.07,.7,ie((14-k.zoom)/5,0,1)):.07,R=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:kM(a,r,s,u),u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:k.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:d,u_width_scale:g,u_floor_width_scale:y,u_image:0,u_tile_units_to_pixels:PM(r,k),u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toPremultipliedRenderColor(R?null:s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength"),u_zbias_factor:j,u_tile_to_meter:Ce(r.tileID.canonical,0),u_ground_shadow_factor:T,u_pattern_transition:E}},o.e4=(a,r,s,u,d,g,y,b,T,E)=>{const k=a.transform,j=k.calculatePixelsToTileUnitsMatrix(r),R=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none",L=k.pitch<15?IM(.07,.7,ie((14-k.zoom)/5,0,1)):.07;return{u_matrix:kM(a,r,s,u),u_pixels_to_tile_units:j,u_device_pixel_ratio:g,u_width_scale:y,u_floor_width_scale:b,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:d,u_texsize:RM(s)&&r.lineAtlasTexture?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:PM(r,a.transform),u_alpha_discard_threshold:0,u_trim_offset:T,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toPremultipliedRenderColor(R?null:s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength"),u_zbias_factor:L,u_tile_to_meter:Ce(r.tileID.canonical,0),u_ground_shadow_factor:E}},o.e5=ze,o.e6=lx,o.e7=we,o.e8=_d,o.e9=$1,o.eA=pC,o.eB=J1,o.eC=Y1,o.eD=[1,1,1],o.eE=l_,o.eF=Et,o.eG=function(a,r,s,u){var d=r[0],g=r[1],y=r[2],b=r[3];return a[0]=d+u*(s[0]-d),a[1]=g+u*(s[1]-g),a[2]=y+u*(s[2]-y),a[3]=b+u*(s[3]-b),a},o.eH=Qg,o.eI=ll,o.eJ=Su,o.eK=function(a,r,s,u,d,g,y,b,T,E,k,j,R,L,z,W){var J=new P(16);return J[0]=a,J[1]=r,J[2]=s,J[3]=u,J[4]=d,J[5]=g,J[6]=y,J[7]=b,J[8]=T,J[9]=E,J[10]=k,J[11]=j,J[12]=R,J[13]=L,J[14]=z,J[15]=W,J},o.eL=M,o.eM=Kv,o.eN=Mp,o.eO=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new xt(1/0,1/0),max:new xt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(a,r=!1){const s=ER(new xt(0,0),new xt(zt,zt),a),u=[];if(r&&!bE(s,this._globalClipBounds))return u;for(const d of this._activeRegions){if(d.hiddenByOverlap||!bE(s,d))continue;const g=p8(d.min,d.max,a);u.push({min:g.min,max:g.max,sourceId:this._sourceIds[d.priority],footprint:d.footprint,footprintTileId:d.tileId,order:d.order,clipMask:d.clipMask,clipScope:d.clipScope})}return u}setSources(a){this._setSources(a.map(r=>({getSourceId:()=>r.cache.id,getFootprints:()=>{const s=[];for(const u of r.cache.getVisibleCoordinates()){const d=r.cache.getTile(u).buckets[r.layer];d&&d.updateFootprints(u.toUnwrapped(),s)}return s},getOrder:()=>r.order,getClipMask:()=>r.clipMask,getClipScope:()=>r.clipScope})))}_addSource(a){const r=a.getFootprints();if(r.length===0)return;const s=a.getOrder(),u=a.getClipMask(),d=a.getClipScope();for(const g of r){if(!g.footprint)continue;const y=ER(g.footprint.min,g.footprint.max,g.id);this._activeRegions.push({min:y.min,max:y.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:g.id,footprint:g.footprint,order:s,clipMask:u,clipScope:d})}this._sourceIds.push(a.getSourceId())}_computeReplacement(){this._activeRegions.sort((r,s)=>r.priority-s.priority||B1(r.min,s.min)||B1(r.max,s.max)||r.order-s.order||r.clipMask-s.clipMask||function(u,d){const g=(y,b)=>y+b;return u.length-d.length||u.reduce(g,"").localeCompare(d.reduce(g,""))}(r.clipScope,s.clipScope));let a=this._activeRegions.length!==this._prevRegions.length;if(!a){let r=0;for(;!a&&r!==this._activeRegions.length;){const s=this._activeRegions[r],u=this._prevRegions[r];a=s.priority!==u.priority||!TR(s,u)||s.order!==u.order||s.clipMask!==u.clipMask||!wo(s.clipScope,u.clipScope),this._activeRegions[r].hiddenByOverlap=u.hiddenByOverlap,++r}}if(a){++this._updateTime;for(const s of this._activeRegions)s.order!==px&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,s.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,s.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,s.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,s.max.y));const r=s=>{const u=this._activeRegions;if(s>=u.length)return s;const d=u[s].priority;for(;s<u.length&&u[s].priority===d;)++s;return s};if(this._sourceIds.length>1){let s=0,u=r(s);for(;s!==u;){let d=s;const g=s;for(;d!==u;){const y=this._activeRegions[d];y.hiddenByOverlap=!1;for(let b=0;b<g;b++){const T=this._activeRegions[b];if(!T.hiddenByOverlap&&y.order===px&&bE(y,T)&&(y.hiddenByOverlap=CR(y.footprint,y.tileId,T.footprint,T.tileId),y.hiddenByOverlap))break}++d}s=u,u=r(s)}}}}_setSources(a){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let r=a.length-1;r>=0;r--)this._addSource(a[r]);this._computeReplacement()}},o.eP=px,o.eQ=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy()}_fillGridMeshWithLods(a,r){const s=new ea,u=new Mi,d=[],g=a+1+2,y=r[0]+1,b=r[0]+1+(1+r.length),T=(E,k,j)=>{let R=E===g-1?E-2:E===0?E:E-1;return R+=j?24575:0,[R,k]};for(let E=0;E<g;++E)s.emplaceBack(...T(E,0,!0));for(let E=0;E<y;++E)for(let k=0;k<g;++k)s.emplaceBack(...T(k,E,(k===0||k===g-1)&&!0));for(let E=0;E<r.length;++E){const k=r[E];for(let j=0;j<g;++j)s.emplaceBack(...T(j,k,!0))}for(let E=0;E<r.length;++E){const k=u.length,j=r[E]+1+2,R=new Mi;for(let W=0;W<j-1;W++){const J=W===j-2,ee=J?g*(b-r.length+E-W):g;for(let oe=0;oe<g-1;oe++){const le=W*g+oe;W===0||J||oe===0||oe===g-2?(R.emplaceBack(le+1,le,le+ee),R.emplaceBack(le+ee,le+ee+1,le+1)):(u.emplaceBack(le+1,le,le+ee),u.emplaceBack(le+ee,le+ee+1,le+1))}}const L=Vi.simpleSegment(0,k,s.length,u.length-k);for(let W=0;W<R.uint16.length;W+=3)u.emplaceBack(R.uint16[W],R.uint16[W+1],R.uint16[W+2]);const z=Vi.simpleSegment(0,k,s.length,u.length-k);d.push({withoutSkirts:L,withSkirts:z})}return{vertices:s,indices:u,segments:d}}_createGrid(a){const r=this._fillGridMeshWithLods(m,v);this._gridSegments=r.segments,this._gridBuffer=a.createVertexBuffer(r.vertices,Bj.members),this._gridIndexBuffer=a.createIndexBuffer(r.indices,!0)}_createPoles(a){const r=new Mi;for(let y=0;y<=m;y++)r.emplaceBack(0,y+1,y+2);this._poleIndexBuffer=a.createIndexBuffer(r,!0);const s=new gd,u=new gd,d=new gd,g=new gd;this._poleSegments=[];for(let y=0,b=0;y<p;y++){const T=360/(1<<y);s.emplaceBack(0,-ta,0,.5,0),u.emplaceBack(0,-ta,0,.5,1),d.emplaceBack(0,-ta,0,.5,.5),g.emplaceBack(0,-ta,0,.5,.5);for(let E=0;E<=m;E++){let k=E/m,j=0;const R=Rr(0,T,k),[L,z,W]=C(L$,z$,R,ta);s.emplaceBack(L,z,W,k,j),u.emplaceBack(L,z,W,k,1-j);const J=ln(R);k=.5+.5*Math.sin(J),j=.5+.5*Math.cos(J),d.emplaceBack(L,z,W,k,j),g.emplaceBack(L,z,W,k,1-j)}this._poleSegments.push(Vi.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(s,Wg,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(u,Wg,!1),this._texturedPoleNorthVertexBuffer=a.createVertexBuffer(d,Wg,!1),this._texturedPoleSouthVertexBuffer=a.createVertexBuffer(g,Wg,!1)}getGridBuffers(a,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a,r){return[r?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,r?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}},o.eR=wR,o.eS=Be,o.eT=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.eU=te,o.eV=ge,o.eW=function(a,r,s){return a[0]=r[0]/s[0],a[1]=r[1]/s[1],a[2]=r[2]/s[2],a},o.eX=po,o.eY=A,o.eZ=Bt,o.e_=We,o.ea=VR,o.eb=Bh,o.ec=jR,o.ed=kR,o.ee=ve,o.ef=function(a,r){if(a===r){var s=r[1],u=r[2],d=r[3],g=r[6],y=r[7],b=r[11];a[1]=r[4],a[2]=r[8],a[3]=r[12],a[4]=s,a[6]=r[9],a[7]=r[13],a[8]=u,a[9]=g,a[11]=r[14],a[12]=d,a[13]=y,a[14]=b}else a[0]=r[0],a[1]=r[4],a[2]=r[8],a[3]=r[12],a[4]=r[1],a[5]=r[5],a[6]=r[9],a[7]=r[13],a[8]=r[2],a[9]=r[6],a[10]=r[10],a[11]=r[14],a[12]=r[3],a[13]=r[7],a[14]=r[11],a[15]=r[15];return a},o.eg=uG,o.eh=fn,o.ei=Jv,o.ej=256,o.ek=uE,o.el=ja,o.em=xe,o.en=function(a,r){return a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[4],a[4]=r[5],a[5]=r[6],a[6]=r[8],a[7]=r[9],a[8]=r[10],a},o.eo=gd,o.ep=Xv,o.eq=i1,o.er=function(a,r,s,u,d){return ie((a-r)/(s-r)*(d-u)+u,u,d)},o.es=gi,o.et=function(a,r){var s=r[0],u=r[1],d=r[2],g=r[3],y=r[4],b=r[5],T=r[6],E=r[7],k=r[8],j=k*y-b*E,R=-k*g+b*T,L=E*g-y*T,z=s*j+u*R+d*L;return z?(a[0]=j*(z=1/z),a[1]=(-k*u+d*E)*z,a[2]=(b*u-d*y)*z,a[3]=R*z,a[4]=(k*s-d*T)*z,a[5]=(-b*s+d*g)*z,a[6]=L*z,a[7]=(-E*s+u*T)*z,a[8]=(y*s-u*g)*z,a):null},o.eu=2,o.ev=Wr,o.ew=gr,o.ex=tt,o.ey=function(a,r){var s=new P(3);tt(s,r);var u=1/s[0],d=1/s[1],g=1/s[2],y=r[0]*u,b=r[1]*d,T=r[2]*g,E=r[4]*u,k=r[5]*d,j=r[6]*g,R=r[8]*u,L=r[9]*d,z=r[10]*g,W=y+k+z,J=0;return W>0?(J=2*Math.sqrt(W+1),a[3]=.25*J,a[0]=(j-L)/J,a[1]=(R-T)/J,a[2]=(b-E)/J):y>k&&y>z?(J=2*Math.sqrt(1+y-k-z),a[3]=(j-L)/J,a[0]=.25*J,a[1]=(b+E)/J,a[2]=(R+T)/J):k>z?(J=2*Math.sqrt(1+k-y-z),a[3]=(R-T)/J,a[0]=(b+E)/J,a[1]=.25*J,a[2]=(j+L)/J):(J=2*Math.sqrt(1+z-y-k),a[3]=(b-E)/J,a[0]=(R+T)/J,a[1]=(j+L)/J,a[2]=.25*J),a},o.ez=function(a,r){var s=2*Math.acos(r[3]),u=Math.sin(s/2);return u>I?(a[0]=r[0]/u,a[1]=r[1]/u,a[2]=r[2]/u):(a[0]=1,a[1]=0,a[2]=0),s},o.f=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,(r,s)=>String.fromCharCode(+("0x"+s))))},o.f0=Ar,o.f1=OE,o.f2=function(a){const r=a.navigator?a.navigator.userAgent:null;return!!function(s){if(cs==null){const u=s.navigator?s.navigator.userAgent:null;cs=!!s.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return cs}(a)&&!(!r||!(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},o.f3=function(a,r){Qf=a,Jo=r},o.f4=hE,o.f5=Hj,o.f6=function(a){const r=[0,0,0],s=K(new Float64Array(16));return G(s,a.pixelMatrix,a.globeMatrix),yn(r,r,s),new xt(r[0],r[1])},o.f7=function(){const a=xx;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(IE),xx=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.f8=function(){G1().acquire(IE)},o.f9=Ov,o.fA=wt,o.fB=function(a){let r=0;if(new Uint32Array(a,0,1)[0]!==iM){const s=new Uint32Array(a,0,7),[,,u,d,g,y]=s;r=s.byteLength+d+g+y+g,(u!==a.byteLength||r>=a.byteLength)&&br("Invalid b3dm header information.")}return lM(a,r)},o.fC=function(a,r){const s=VE(a);for(const u of s){for(const d of u.meshes)G8(d);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(W8(u.lights,r)))}return s},o.fD=yw,o.fE=Xi,o.fF=QR,o.fG=ma,o.fH=pa,o.fI=function(a){Qu(),Go!=null&&Go.then(r=>{r.keys().then(s=>{for(let u=0;u<s.length-a;u++)r.delete(s[u]).catch(d=>br(d.message))}).catch(s=>br(s.message))}).catch(r=>br(r.message))},o.fa=function(a,r,s=!1){if(Wo===pa.deferred||Wo===pa.loading||Wo===pa.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");xu=ha.resolveURL(a),Wo=pa.deferred,Mv=r,Dv(),s||Lv()},o.fb=function(a){Kg=ha.resolveURL(a),Yg||(Yg=new Xg(G1(),new yc)),Yg.broadcast("setMeshoptUrl",Kg)},o.fc=rM,o.fd=function(a){kE=ha.resolveURL(a),Yg||(Yg=new Xg(G1(),new yc)),Yg.broadcast("setDracoUrl",kE)},o.fe=tM,o.ff=vx,o.fg=function(a){const r=_c();if(!r)return;const s=r.delete(Jf);a&&s.then(()=>a()).catch(a)},o.fh=Up,o.fi=rr,o.fj=Fh,o.fk=Rc,o.fl=SN,o.fm=TN,o.fn=TM,o.fo=Zt,o.fp="hd_road_elevation",o.fq=zr,o.fr=Dt,o.fs=vd,o.ft=JE,o.fu=Gp,o.fv=function(a,r,s,u,d,g,y,b=1,T,E,k){a.createArrays(),a.tilePixelRatio=zt/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const j=a.layers[0].layout,R=a.layers[0]._unevaluatedLayout._values,L={};L.scaleFactor=b,L.textSizeScaleRange=j.get("text-size-scale-range"),L.iconSizeScaleRange=j.get("icon-size-scale-range");const[z,W]=L.textSizeScaleRange,[J,ee]=L.iconSizeScaleRange;L.textScaleFactor=ie(L.scaleFactor,z,W),L.iconScaleFactor=ie(L.scaleFactor,J,ee);const oe=R["text-size"],le=R["icon-size"];if(a.textSizeData.kind==="composite"){const{minZoom:De,maxZoom:at}=a.textSizeData;L.compositeTextSizes=[oe.possiblyEvaluate(new wi(De,{worldview:k}),g),oe.possiblyEvaluate(new wi(at,{worldview:k}),g)]}if(a.iconSizeData.kind==="composite"){const{minZoom:De,maxZoom:at}=a.iconSizeData;L.compositeIconSizes=[le.possiblyEvaluate(new wi(De,{worldview:k}),g),le.possiblyEvaluate(new wi(at,{worldview:k}),g)]}L.layoutTextSize=oe.possiblyEvaluate(new wi(y+1,{worldview:k}),g),L.layoutIconSize=le.possiblyEvaluate(new wi(y+1,{worldview:k}),g),L.textMaxSize=oe.possiblyEvaluate(new wi(18,{worldview:k}),g);const de=j.get("symbol-placement"),Se=j.get("text-rotation-alignment")==="map"&&de!=="point",_e=j.get("text-size");let Ae=!1;const ke=[];for(const De of a.features){const at=j.get("text-font").evaluate(De,{},g).join(","),Ue=_e.evaluate(De,{},g)*L.textScaleFactor,ct=L.layoutTextSize.evaluate(De,{},g)*L.textScaleFactor,pt=L.layoutIconSize.evaluate(De,{},g)*L.iconScaleFactor,bt={horizontal:{},vertical:void 0},Ot=De.text;let It,gt=[0,0];if(Ot){const nn=Ot.toString(),Pn=j.get("text-letter-spacing").evaluate(De,{},g)*oo,Gr=j.get("text-line-height").evaluate(De,{},g)*oo,zn=c1(nn)?Pn:0,Fn=j.get("text-anchor").evaluate(De,{},g),Li=j.get("text-variable-anchor");if(!Li){const dt=j.get("text-radial-offset").evaluate(De,{},g);if(dt)gt=aD(Fn,[dt*oo,tC]);else{const qt=j.get("text-offset").evaluate(De,{},g);gt=[qt[0]*oo,qt[1]*oo]}}let ye=Se?"center":j.get("text-justify").evaluate(De,{},g);const pe=de==="point",ut=pe?j.get("text-max-width").evaluate(De,{},g)*oo:1/0,Ut=dt=>{a.allowVerticalPlacement&&kv(nn)&&(bt.vertical=ZE(Ot,r,s,d,at,ut,Gr,Fn,dt,zn,gt,za.vertical,!0,ct,Ue,T))};if(!Se&&Li){const dt=ye==="auto"?Li.map(hr=>rC(hr)):[ye];let qt=!1;for(let hr=0;hr<dt.length;hr++){const ur=dt[hr];if(!bt.horizontal[ur])if(qt)bt.horizontal[ur]=bt.horizontal[0];else{const Hr=ZE(Ot,r,s,d,at,ut,Gr,"center",ur,zn,gt,za.horizontal,!1,ct,Ue,T);Hr&&(bt.horizontal[ur]=Hr,qt=Hr.positionedLines.length===1)}}Ut("left")}else{if(ye==="auto"&&(ye=rC(Fn)),pe||j.get("text-writing-mode").indexOf("horizontal")>=0||!kv(nn)){const dt=ZE(Ot,r,s,d,at,ut,Gr,Fn,ye,zn,gt,za.horizontal,!1,ct,Ue,T);dt&&(bt.horizontal[ye]=dt)}Ut(pe?"left":ye)}}let At,nt,Ke,St,Mt,vt,er=!1;const or=j.get("icon-text-fit").evaluate(De,{},g);if(De.icon&&De.icon.hasPrimary()){const nn=kx(De.icon,a.iconSizeData,R["icon-size"],g,a.zoom,De,T,L.iconScaleFactor,k);At=nn.iconPrimary,Ke=nn.iconSecondary;const Pn=At.toString();if(nt=u.get(Pn),nt&&(Mt=j.get("icon-offset").evaluate(De,{},g),vt=j.get("icon-anchor").evaluate(De,{},g),It=nw(d.get(Pn),Ke?d.get(Ke.toString()):void 0,Mt,vt),er=nt.sdf,a.sdfIcons===void 0?a.sdfIcons=nt.sdf:a.sdfIcons!==nt.sdf&&br("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(nt.pixelRatio!==a.pixelRatio||j.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0)),Ke){const Gr=Ke.toString();St=u.get(Gr)}}Ae=Ae||!(!De.icon||!De.icon.hasSecondary());const Xt=nC(bt.horizontal)||bt.vertical;a.iconsInText||(a.iconsInText=!!Xt&&Xt.iconsInText);const $t=ct*L.textScaleFactor/oo,{defaultShapedIcon:Fr,verticallyShapedIcon:Gt}=Kq(a,It,j,De,g,bt,$t,Mt,or);or!=="none"&&It&&(WM(It)||HM(It))&&(lw(0,nt,At,It,Fr,or,E,u,d),lw(0,St,Ke,It,Fr,or,E,u,d),Gt&&(lw(0,nt,At,It,Gt,or,E,u,d),lw(0,St,Ke,It,Gt,or,E,u,d))),It=Fr;const{iconBBox:vr,iconVerticalBBox:$r}=Hq(a,It,Gt,j,De,g,pt,Mt,L,d,vt);ke.push({feature:De,shapedTextOrientations:bt,shapedText:Xt,shapedIcon:It,iconPrimary:At,iconSecondary:Ke,iconOffset:Mt,iconAnchor:vt,verticallyShapedIcon:Gt,layoutTextSize:ct,layoutIconSize:pt,textOffset:gt,isSDFIcon:er,iconTextFit:or,iconCollisionBounds:vr,iconVerticalCollisionBounds:$r})}return{featureData:ke,sizes:L,hasAnySecondaryIcon:Ae,textAlongLine:Se,symbolPlacement:de}},o.fw=tD,o.fx=function(a,r,s,u,d,g,y,b,T,E){a.iconAtlasPositions=E.iconPositions;const{featureData:k,hasAnySecondaryIcon:j,sizes:R,textAlongLine:L,symbolPlacement:z}=r;for(const W of k){const{shapedIcon:J,verticallyShapedIcon:ee,feature:oe,shapedTextOrientations:le,shapedText:de,layoutTextSize:Se,textOffset:_e,isSDFIcon:Ae,iconPrimary:ke,iconSecondary:De,iconTextFit:at,iconOffset:Ue,iconCollisionBounds:ct,iconVerticalCollisionBounds:pt}=W;cD(J,E.iconPositions,ke,De),cD(ee,E.iconPositions,ke,De),Xq(le,E.iconPositions),Zq(ke,De,E.iconPositions),(de||J)&&Yq(a,oe,le,J,ee,T,R,Se,0,_e,Ae,u,d,y,b,j,at,Ue,L,z,ct,pt)}s&&a.generateCollisionDebugBuffers(g,a.collisionBoxArray,R.textScaleFactor)},o.fy=ar,o.fz=Tw,o.g=function(a,r){return ep(Object.assign(a,{method:"GET"}),r)},o.h=function(a){return a.indexOf("mapbox:")===0},o.i=function(a){return Ai.API_STYLE_REGEX.test(a)&&!No(a)},o.j=ks,o.k=qm,o.l=function(a){return decodeURIComponent(atob(a).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.m=function(a,r){return ep(Object.assign(a,{type:"json"}),r)},o.n=Xy,o.o=ha,o.p=function(a,r){return ep(Object.assign(a,{method:"POST"}),r)},o.q=Eo,o.r=da,o.s=function(a){try{const r=self[a];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=function(){return PE||(PE=new Up),PE},o.u=function(){return function a(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()},o.v=function(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)},o.w=br,o.x=vC,o.y=ap,o.z=Aa}),_(["./shared"],function(o){function I(Be){const te=Be?Be.url.toString():void 0;return te?performance.getEntriesByName(te):[]}function P(Be){if(typeof Be=="number"||typeof Be=="boolean"||typeof Be=="string"||Be==null)return JSON.stringify(Be);if(Array.isArray(Be)){let ie="[";for(const me of Be)ie+=`${P(me)},`;return`${ie}]`}let te="{";for(const ie of Object.keys(Be).sort())te+=`${ie}:${P(Be[ie])},`;return`${te}}`}function N(Be){let te="";for(const ie of o.bw)te+=`/${P(Be[ie])}`;return te}class U{constructor(te){this.keyCache={},this._layers={},this._layerConfigs={},te&&this.replace(te)}replace(te,ie){this._layerConfigs={},this._layers={},this.update(te,[],ie)}update(te,ie,me){this._options=me;for(const Ie of te)this._layerConfigs[Ie.id]=Ie,(this._layers[Ie.id]=o.dt(Ie,this.scope,null,this._options)).compileFilter(me),this.keyCache[Ie.id]&&delete this.keyCache[Ie.id];for(const Ie of ie)delete this.keyCache[Ie],delete this._layerConfigs[Ie],delete this._layers[Ie];this.familiesBySource={};const Pe=function(Ie,Le){const Je={};for(let Xe=0;Xe<Ie.length;Xe++){const Dt=Ie[Xe];let Ct=Le&&Le[Dt.id];Ct||(Dt.type==="symbol"?Ct=Dt.id:(Ct=N(Dt),Dt.type==="line"&&Dt.paint&&function Lr(Mr){return typeof Mr=="string"&&Mr==="line-progress"||(Array.isArray(Mr)?Mr.some(Lr):!(!Mr||typeof Mr!="object")&&Object.values(Mr).some(Lr))}(Dt.paint["line-width"])&&(Ct+=`/${P(Dt.paint["line-width"])}`))),Le&&(Le[Dt.id]=Ct);let dr=Je[Ct];dr||(dr=Je[Ct]=[]),dr.push(Dt)}const ze=[];for(const Xe in Je)ze.push(Je[Xe]);return ze}(Object.values(this._layerConfigs),this.keyCache);for(const Ie of Pe){const Le=Ie.map(dr=>this._layers[dr.id]),Je=Le[0];if(Je.visibility==="none")continue;const ze=Je.source||"";let Xe=this.familiesBySource[ze];Xe||(Xe=this.familiesBySource[ze]={});const Dt=Je.sourceLayer||"_geojsonTileLayer";let Ct=Xe[Dt];Ct||(Ct=Xe[Dt]=[]),Ct.push(Le)}}}const $=1*o.fk;class B{constructor(te){const ie={},me=[];for(const Je in te){const ze=te[Je],Xe=ie[Je]={};for(const Dt in ze.glyphs){const Ct=ze.glyphs[+Dt];if(!Ct||Ct.bitmap.width===0||Ct.bitmap.height===0)continue;const dr=Ct.metrics.localGlyph?$:1,Lr={x:0,y:0,w:Ct.bitmap.width+2*dr,h:Ct.bitmap.height+2*dr};me.push(Lr),Xe[Dt]=Lr}}const{w:Pe,h:Ie}=o.G(me),Le=new o.fj({width:Pe||1,height:Ie||1});for(const Je in te){const ze=te[Je];for(const Xe in ze.glyphs){const Dt=ze.glyphs[+Xe];if(!Dt||Dt.bitmap.width===0||Dt.bitmap.height===0)continue;const Ct=ie[Je][Xe],dr=Dt.metrics.localGlyph?$:1;o.fj.copy(Dt.bitmap,Le,{x:0,y:0},{x:Ct.x+dr,y:Ct.y+dr},Dt.bitmap)}}this.image=Le,this.positions=ie}}function Y(Be,te,ie){Be[te]?ie&&(Be[te].center=ie):Be[te]={floorIds:new Set,center:ie||[0,0],floors:{}}}function H(Be,te,ie,me){for(const Pe of te)Y(Be,Pe),Be[Pe].floors[ie]=me,Be[Pe].floorIds.add(ie)}function K(Be){return{id:Be.properties.id.toString(),center:Be.properties.center.toString().split(";").map(Number)}}function re(Be){return{id:Be.properties.id.toString(),isDefault:!!Be.properties.is_default&&Be.properties.is_default,connections:Be.properties.connected_floor_ids?new Set(Be.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Be.properties.conflicted_floor_ids?new Set(Be.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Be.properties.building_ids?new Set(Be.properties.building_ids.toString().split(";")):new Set,name:Be.properties.name.toString(),zIndex:Be.properties.z_index}}function G(Be,te){return te.every(ie=>Be.properties&&Be.properties[ie]!=null)}function X(Be){return G(Be,["type","id","name"])&&Be.properties.type==="building"}function ue(Be){return G(Be,["type","id","name","z_index"])&&Be.properties.type==="floor"}o.fi(B,"GlyphAtlas");class Ee{constructor(te){this.tileID=new o.aP(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.lut=te.lut,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.scope=te.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=te.showCollisionBoxes,this.collectResourceTiming=!!te.request&&te.request.collectResourceTiming,this.promoteId=te.promoteId,this.isSymbolTile=te.isSymbolTile,this.tileTransform=o.aY(te.tileID.canonical,te.projection),this.projection=te.projection,this.worldview=te.worldview,this.localizableLayerIds=te.localizableLayerIds,this.brightness=te.brightness,this.extraShadowCaster=!!te.extraShadowCaster,this.tessellationStep=te.tessellationStep,this.scaleFactor=te.scaleFactor,this.worldview=te.worldview,this.indoor=te.indoor}parse(te,ie,me,Pe,Ie,Le){this.status="parsing",this.data=te,this.collisionBoxArray=new o.b2;const Je=new o.fl(Object.keys(te.layers).sort()),ze=new o.fm(this.tileID,this.promoteId);ze.bucketLayerIDs=[];const Xe={},Dt=new o.fn(256,256),Ct={featureIndex:ze,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Dt,availableImages:me,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const br=this.indoor.indoorState.activeFloorsVisible,rn=function(hn,si,Xi){const xs=function(ni,wn){if(!ni)return o.w("No source layers defined in indoor specification"),wn;if(ni.size===0)return wn;const Ci=ni.difference(wn);for(const Gi of Ci)o.w(`Missing source layer required in indoor specification: ${Gi}`);return wn.intersection(wn)}(si.sourceLayers,new Set(Object.keys(hn.layers))),cs=si.indoorState,ns=function(ni,wn,Ci,Gi){const li=new Set,Ai=new Set,ks=new Set,No=new Map,Qa={},Ju=Ls=>{const el=No.get(Ls)||new Set;for(const qo of li)if((No.get(qo)||new Set).has(Ls)||el.has(qo))return!0;return!1};for(const Ls of wn){const el=ni.layers[Ls];if(el)for(let qo=0;qo<el.length;qo++){const Al=el.feature(qo);if(X(Al)){const{id:da,center:ha}=K(Al);Y(Qa,da,ha),li.add(da)}else if(ue(Al)){const{id:da,isDefault:ha,connections:Um,conflicts:Yf,buildings:Jf,name:Qf,zIndex:Jo}=re(Al);H(Qa,Jf,da,{name:Qf,zIndex:Jo}),No.set(da,Yf),(da===Gi||Um.has(Gi))&&li.add(da),Ai.add(da),ha&&ks.add(da)}}else o.w(`indoor source layer not found: ${Ls}`)}if(Ci)for(const Ls of Ci)Ai.has(Ls)&&(Ju(Ls)||li.add(Ls));for(const Ls of ks)li.has(Ls)||Ju(Ls)||li.add(Ls);return{buildings:Qa,activeFloors:li}}(hn,xs,cs.lastActiveFloors,cs.selectedFloorId);return Xi.send("setIndoorData",ns),ns}(te,this.indoor,Ie);Ct.activeFloors=br?rn.activeFloors:void 0}const dr=[],Lr=ie.familiesBySource[this.source];for(const br in Lr){const rn=te.layers[br];if(!rn)continue;let hn=!1,si=!1,Xi=!1;for(const ni of Lr[br])ni[0].type==="symbol"?hn=!0:si=!0,ni[0].is3D()&&ni[0].type!=="model"&&(Xi=!0);if(this.extraShadowCaster&&!Xi||this.isSymbolTile===!0&&!hn||this.isSymbolTile===!1&&!si)continue;rn.version===1&&o.w(`Vector tile source "${this.source}" layer "${br}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const xs=Je.encode(br),cs=[];let ns=!1;for(let ni=0,wn=0;ni<rn.length;ni++){const Ci=rn.feature(ni),Gi=ze.getId(Ci,br);if(this.localizableLayerIds&&this.localizableLayerIds.has(br)){const li=Ci.properties?Ci.properties.worldview:null;if(this.worldview&&typeof li=="string")if(li==="all")Ci.properties.$localized=!0;else{if(!li.split(",").includes(this.worldview))continue;Ci.properties.$localized=!0,Ci.properties.worldview=this.worldview}}!ns&&Ci.properties&&Ci.properties.hasOwnProperty(o.fo)&&(ns=!0),cs.push({feature:Ci,id:Gi,index:wn,sourceLayerIndex:xs}),wn++}ns&&!Ct.elevationFeatures&&te.layers.hasOwnProperty(o.fp)&&(Ct.elevationFeatures=o.fq.parseFrom(te.layers[o.fp],this.canonical));for(const ni of Lr[br]){const wn=ni[0];if(this.extraShadowCaster&&(!wn.is3D()||wn.type==="model")||this.isSymbolTile!==void 0&&wn.type==="symbol"!==this.isSymbolTile||wn.minzoom&&this.zoom<Math.floor(wn.minzoom)||wn.maxzoom&&this.zoom>=wn.maxzoom||wn.visibility==="none")continue;xe(ni,this.zoom,Ct.brightness,me,this.worldview);const Ci=Xe[wn.id]=wn.createBucket({index:ze.bucketLayerIDs.length,layers:ni,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:xs,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Pe,worldview:this.worldview});ze.bucketLayerIDs.push(ni.map(li=>o.B(li.id,li.scope)));let Gi=Ci.prepare?Ci.prepare():null;Gi!=null?(Gi=Gi.then(()=>Ci.populate(cs,Ct,this.tileID.canonical,this.tileTransform)),dr.push(Gi)):Ci.populate(cs,Ct,this.tileID.canonical,this.tileTransform)}}const Mr=()=>{let br,rn,hn,si,Xi,xs;Dt.trim();const cs={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ns=()=>{if(br)return this.status="done",Le(br);if(this.extraShadowCaster)this.status="done",Le(null,{buckets:Object.values(Xe).filter(wn=>!wn.isEmpty()),featureIndex:ze,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ct.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(rn&&hn&&si){const wn=new B(rn),Ci=new Map;for(const[Ai,ks]of hn.entries()){const{imagePosition:No}=o.ft(Ai,ks,o.fu);Ci.set(Ai,No)}const Gi={};for(const Ai in Xe){const ks=Xe[Ai];ks instanceof o.b3&&(xe(ks.layers,this.zoom,Ct.brightness,me,this.worldview),Gi[Ai]=o.fv(ks,rn,wn.positions,hn,Ci,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Xi,this.worldview))}const li={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ie,hn,Xi,()=>{li.iconsPending=!1,ni(Gi,wn,li)}),this.rasterizeIfNeeded(Ie,si,xs,()=>{li.patternsPending=!1,ni(Gi,wn,li)})}},ni=(wn,Ci,Gi,li)=>{if(Gi.iconsPending||Gi.patternsPending)return;const Ai=new o.fw(hn,si,this.lut);for(const ks in Xe){const No=Xe[ks];if(ks in wn)o.fx(No,wn[ks],this.showCollisionBoxes,me,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,hn,Ai);else if(No.hasPattern&&(No instanceof o.b9||No instanceof o.ba||No instanceof o.e9)){xe(No.layers,this.zoom,Ct.brightness,me,this.worldview);const Qa=Object.fromEntries(Ai.patternPositions);No.addFeatures(Ct,this.tileID.canonical,Qa,me,this.tileTransform,this.brightness)}}this.status="done",Le(null,{buckets:Object.values(Xe).filter(ks=>!ks.isEmpty()),featureIndex:ze,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ci.image,lineAtlas:Dt,imageAtlas:Ai,brightness:Ct.brightness})};if(!this.extraShadowCaster){const wn=o.fr(Ct.glyphDependencies,li=>Object.keys(li).map(Number));Object.keys(wn).length?Ie.send("getGlyphs",{uid:this.uid,stacks:wn},(li,Ai)=>{br||(br=li,rn=Ai,ns())},void 0,!1,cs):rn={};const Ci=Array.from(Ct.iconDependencies.keys()).map(li=>o.I.parse(li));Ci.length?Ie.send("getImages",{images:Ci,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(li,Ai)=>{br||(br=li,hn=new Map,Xi=this.updateImageMapAndGetImageTaskQueue(hn,Ai,Ct.iconDependencies),ns())},void 0,!1,cs):(hn=new Map,Xi=new Map);const Gi=Array.from(Ct.patternDependencies.keys()).map(li=>o.I.parse(li));Gi.length?Ie.send("getImages",{images:Gi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(li,Ai)=>{br||(br=li,si=new Map,xs=this.updateImageMapAndGetImageTaskQueue(si,Ai,Ct.patternDependencies),ns())},void 0,!1,cs):(si=new Map,xs=new Map)}if(Ct.elevationFeatures&&Ct.elevationFeatures.length>0){const wn=[];for(const Gi of Object.values(Xe))if(Gi instanceof o.ba){const li=Gi.getUnevaluatedPortalGraph();li&&wn.push(li)}const Ci=o.fs.evaluate(wn);for(const Gi of Object.values(Xe))if(Gi instanceof o.ba){const li=te.layers[Je.decode(Gi.sourceLayerIndex)];Gi.setEvaluatedPortalGraph(Ci,li,this.tileID.canonical,Ct.availableImages,Ct.brightness)}}ns()};dr.length>0?Promise.allSettled(dr).then(Mr).catch(Le):Mr()}updateParameters(te){this.scaleFactor=te.scaleFactor,this.showCollisionBoxes=te.showCollisionBoxes,this.projection=te.projection,this.brightness=te.brightness,this.tileTransform=o.aY(te.tileID.canonical,te.projection),this.extraShadowCaster=te.extraShadowCaster,this.lut=te.lut,this.worldview=te.worldview,this.indoor=te.indoor}rasterizeIfNeeded(te,ie,me,Pe){Array.from(ie.values()).some(Ie=>Ie.usvg)?this.rasterize(te,ie,me,Pe):Pe()}updateImageMapAndGetImageTaskQueue(te,ie,me){const Pe=new Map;for(const Ie of ie.keys()){const Le=me.get(Ie)||[];for(const Je of Le){const ze=Je.toString(),Xe=ie.get(Je.id.toString());Xe.usvg?Pe.has(ze)||(Pe.set(ze,Je),te.set(ze,Object.assign({},Xe))):te.set(ze,Xe)}}return Pe}rasterize(te,ie,me,Pe){this.rasterizeTask=te.send("rasterizeImages",{scope:this.scope,tasks:me},(Ie,Le)=>{if(!Ie)for(const[Je,ze]of Le.entries()){const Xe=Object.assign(ie.get(Je),{data:ze});ie.set(Je,Xe)}Pe()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function xe(Be,te,ie,me,Pe){const Ie=new o.ac(te,{brightness:ie,worldview:Pe});for(const Le of Be)Le.recalculate(Ie,me)}class Ne extends o.E{constructor(te,ie,me,Pe,Ie,Le,Je){super(),this.actor=te,this.layerIndex=ie,this.availableImages=me,this.availableModels=Pe,this.loadVectorData=Le||o.aL,this.loading={},this.loaded={},this.deduped=new o.aK(te.scheduler),this.isSpriteLoaded=Ie,this.scheduler=te.scheduler,this.brightness=Je}loadTile(te,ie){const me=te.uid,Pe=te&&te.request,Ie=Pe&&Pe.collectResourceTiming,Le=this.loading[me]=new Ee(te);Le.abort=this.loadVectorData(te,(Je,ze)=>{const Xe=!this.loading[me];if(delete this.loading[me],Le.cancelRasterize(),Xe||Je||!ze)return Le.status="done",Xe||(this.loaded[me]=Le),ie(Je);const Dt=ze.rawData,Ct={},dr=o.aM(ze.responseHeaders);dr&&dr.expires&&(Ct.expires=dr.expires),dr&&dr.cacheControl&&(Ct.cacheControl=dr.cacheControl),Le.vectorTile=ze.vectorTile||new o.fy(new o.bs(Dt));const Lr=()=>{Le.parse(Le.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Mr,br)=>{if(Mr||!br)return ie(Mr);const rn={};if(Ie){const hn=I(Pe);hn.length>0&&(rn.resourceTiming=JSON.parse(JSON.stringify(hn)))}ie(null,Object.assign({rawTileData:Dt.slice(0),responseHeaders:ze.responseHeaders},br,Ct,rn))})};this.isSpriteLoaded?Lr():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Lr,{type:"parseTile",isSymbolTile:te.isSymbolTile,zoom:te.tileZoom}):Lr()}),this.loaded=this.loaded||{},this.loaded[me]=Le})}reloadTile(te,ie){const me=this.loaded,Pe=te.uid;if(me&&me[Pe]){const Ie=me[Pe];Ie.updateParameters(te);const Le=(Je,ze)=>{const Xe=Ie.reloadCallback;Xe&&(delete Ie.reloadCallback,Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Xe)),ie(Je,ze)};Ie.status==="parsing"?Ie.reloadCallback=Le:Ie.status==="done"&&(Ie.vectorTile?Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Le):Le())}else ie(null,void 0)}abortTile(te,ie){const me=te.uid,Pe=this.loading[me];Pe&&(Pe.abort&&Pe.abort(),delete this.loading[me]),ie()}removeTile(te,ie){const me=this.loaded,Pe=te.uid;me&&me[Pe]&&delete me[Pe],ie()}}class lt{loadTile(te,ie){const{uid:me,encoding:Pe,rawImageData:Ie,padding:Le}=te,Je=ImageBitmap&&Ie instanceof ImageBitmap?this.getImageData(Ie,Le):Ie;ie(null,new o.fz(me,Je,Pe,Le<1))}reloadTile(te,ie){ie(null,null)}abortTile(te,ie){ie()}removeTile(te,ie){ie()}getImageData(te,ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(te.width,te.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=te.width,this.offscreenCanvas.height=te.height,this.offscreenCanvasContext.drawImage(te,0,0,te.width,te.height);const me=this.offscreenCanvasContext.getImageData(-ie,-ie,te.width+2*ie,te.height+2*ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),me}}o.br.setPbf(o.bs);class Pt{constructor(te){this._mrt=new o.br(te.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=te.uid,this.tileID=te.tileID,this.source=te.source}parse(te,ie){const me=this._mrt;this.status="parsing",this._entireBuffer=te;try{me.parseHeader(te),this._isHeaderLoaded=!0;const Pe=[];for(const Ie in me.layers){const Le=me.getLayer(Ie),Je=Le.getDataRange(Le.getBandList()),ze=me.createDecodingTask(Je),Xe=te.slice(Je.firstByte,Je.lastByte+1),Dt=o.br.performDecoding(Xe,ze).then(Ct=>ze.complete(null,Ct)).catch(Ct=>ze.complete(Ct,null));Pe.push(Dt)}Promise.allSettled(Pe).then(()=>ie(null,me)).catch(Ie=>ie(Ie))}catch(Pe){ie(Pe)}}}class tt{constructor(te){this.actor=te,this.loading={},this.loaded={}}loadTile(te,ie){const me=te.uid,Pe=te.request,Ie=this.loading[me]=new Pt(te),{cancel:Le}=o.bt(Pe,(Je,ze,Xe)=>{const Dt=!this.loading[me];if(delete this.loading[me],Dt||Je||!ze)return Ie.status="done",Dt||(this.loaded[me]=Ie),ie(Je);Ie.parse(ze,(Ct,dr)=>{if(Ct||!dr)return ie(Ct);ie(null,dr,Xe)}),this.loaded[me]=Ie});Ie.abort=Le}reloadTile(te,ie){ie(null,void 0)}abortTile(te,ie){const me=te.uid,Pe=this.loading[me];Pe&&(Pe.abort&&Pe.abort(),delete this.loading[me]),ie()}removeTile(te,ie){const me=te.uid;this.loaded[me]&&delete this.loaded[me],ie()}decodeRasterArray(te,ie){o.br.performDecoding(te.buffer,te.task).then(me=>ie(null,me)).catch(me=>ie(me))}}const yt=o.fA.prototype.toGeoJSON;class Me{constructor(te){this._feature=te,this.extent=o.al,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(this._feature.type===1){const te=[];for(const ie of this._feature.geometry)te.push([new o.P(ie[0],ie[1])]);return te}{const te=[];for(const ie of this._feature.geometry){const me=[];for(const Pe of ie)me.push(new o.P(Pe[0],Pe[1]));te.push(me)}return te}}toGeoJSON(te,ie,me){return yt.call(this,te,ie,me)}}class be{constructor(te,ie){this.name=te,this.extent=o.al,this.length=ie.length,this._jsonFeatures=ie}feature(te){return new Me(this._jsonFeatures[te])}}class je{constructor(te){this.layers={},this.extent=o.al;for(const ie of Object.keys(te))this.layers[ie]=new be(ie,te[ie])}}const Ye=64/4096,qe=128;class We{constructor(){this.features=new Map}clear(){this.features.clear()}load(te=[],ie){for(const me of te){const Pe=me.id;if(Pe==null)continue;let Ie=this.features.get(Pe);Ie&&this.updateCache(Ie,ie),me.geometry?(Ie=_t(me),this.updateCache(Ie,ie),this.features.set(Pe,Ie)):this.features.delete(Pe),this.updateCache(Ie,ie)}}updateCache(te,ie){for(const{canonical:me,uid:Pe}of Object.values(ie)){const{z:Ie,x:Le,y:Je}=me;$e(te,Math.pow(2,Ie),Le,Je)&&delete ie[Pe]}}getTile(te,ie,me){const Pe=Math.pow(2,te),Ie=[];for(const Le of this.features.values())$e(Le,Pe,ie,me)&&Ie.push(Vt(Le,Pe,ie,me));return{features:Ie}}getFeatures(){return[...this.features.values()]}}function $e({minX:Be,minY:te,maxX:ie,maxY:me},Pe,Ie,Le){return Be<(Ie+1+Ye)/Pe&&te<(Le+1+Ye)/Pe&&ie>(Ie-Ye)/Pe&&me>(Le-Ye)/Pe}function _t(Be){const{id:te,geometry:ie,properties:me}=Be;if(!ie)return;if(ie.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Pe,coordinates:Ie}=ie,Le={id:te,type:1,geometry:[],tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Je=Le.geometry;if(Pe==="Point")mt(Ie,Je,Le);else if(Pe==="MultiPoint")for(const ze of Ie)mt(ze,Je,Le);else if(Pe==="LineString")Le.type=2,rt(Ie,Je,Le);else if(Pe==="MultiLineString")Le.type=2,Tt(Ie,Je,Le);else if(Pe==="Polygon")Le.type=3,Tt(Ie,Je,Le,!0);else{if(Pe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Le.type=3;for(const ze of Ie)Tt(ze,Je,Le,!0)}return Le}function mt([Be,te],ie,me){const Pe=o.aF(Be);let Ie=o.aJ(te);Ie=Ie<0?0:Ie>1?1:Ie,ie.push(Pe,Ie),me.minX=Math.min(me.minX,Pe),me.minY=Math.min(me.minY,Ie),me.maxX=Math.max(me.maxX,Pe),me.maxY=Math.max(me.maxY,Ie)}function rt(Be,te,ie,me=!1,Pe=!1){const Ie=[];for(const Le of Be)mt(Le,Ie,ie);te.push(Ie),me&&function(Le,Je){let ze=0;for(let Xe=0,Dt=Le.length,Ct=Dt-2;Xe<Dt;Ct=Xe,Xe+=2)ze+=(Le[Xe]-Le[Ct])*(Le[Xe+1]+Le[Ct+1]);if(ze>0===Je)for(let Xe=0,Dt=Le.length;Xe<Dt/2;Xe+=2){const Ct=Le[Xe],dr=Le[Xe+1];Le[Xe]=Le[Dt-2-Xe],Le[Xe+1]=Le[Dt-1-Xe],Le[Dt-2-Xe]=Ct,Le[Dt-1-Xe]=dr}}(Ie,Pe)}function Tt(Be,te,ie,me=!1){for(let Pe=0;Pe<Be.length;Pe++)rt(Be[Pe],te,ie,me,Pe===0)}function Vt(Be,te,ie,me){const{id:Pe,type:Ie,geometry:Le,tags:Je}=Be,ze=[];if(Ie===1)(function(Xe,Dt,Ct,dr,Lr){for(let Mr=0;Mr<Xe.length;Mr+=2){const br=Math.round(o.al*(Xe[Mr+0]*Dt-Ct)),rn=Math.round(o.al*(Xe[Mr+1]*Dt-dr));Lr.push([br,rn])}})(Le,te,ie,me,ze);else for(const Xe of Le)it(Xe,te,ie,me,ze);return{id:Pe,type:Ie,geometry:ze,tags:Je}}function it(Be,te,ie,me,Pe){const Ie=-qe,Le=o.al+qe;let Je;for(let ze=0;ze<Be.length-2;ze+=2){let Xe=Math.round(o.al*(Be[ze+0]*te-ie)),Dt=Math.round(o.al*(Be[ze+1]*te-me)),Ct=Math.round(o.al*(Be[ze+2]*te-ie)),dr=Math.round(o.al*(Be[ze+3]*te-me));const Lr=Ct-Xe,Mr=dr-Dt;Xe<Ie&&Ct<Ie||(Xe<Ie?(Dt+=Math.round(Mr*((Ie-Xe)/Lr)),Xe=Ie):Ct<Ie&&(dr=Dt+Math.round(Mr*((Ie-Xe)/Lr)),Ct=Ie),Dt<Ie&&dr<Ie||(Dt<Ie?(Xe+=Math.round(Lr*((Ie-Dt)/Mr)),Dt=Ie):dr<Ie&&(Ct=Xe+Math.round(Lr*((Ie-Dt)/Mr)),dr=Ie),Xe>=Le&&Ct>=Le||(Xe>=Le?(Dt+=Math.round(Mr*((Le-Xe)/Lr)),Xe=Le):Ct>=Le&&(dr=Dt+Math.round(Mr*((Le-Xe)/Lr)),Ct=Le),Dt>=Le&&dr>=Le||(Dt>=Le?(Xe+=Math.round(Lr*((Le-Dt)/Mr)),Dt=Le):dr>=Le&&(Ct=Xe+Math.round(Lr*((Le-Dt)/Mr)),dr=Le),Je&&Xe===Je[Je.length-1][0]&&Dt===Je[Je.length-1][1]||(Je=[[Xe,Dt]],Pe.push(Je)),Je.push([Ct,dr])))))}}function ir({name:Be,features:te},ie){ie.writeStringField(1,Be),ie.writeVarintField(5,o.al);const me=new Map,Pe=new Map,Ie={keys:me,values:Pe,feature:null};for(const Le of te)Ie.feature=Le,ie.writeMessage(2,wr,Ie);for(const Le of me.keys())ie.writeStringField(3,Le);for(const Le of Pe.keys())ie.writeMessage(4,Ur,Le)}function wr(Be,te){const ie=Be.feature;ie.id!==void 0&&Number.isSafeInteger(+ie.id)&&te.writeVarintField(1,+ie.id),ie.tags&&te.writeMessage(2,Bt,Be),te.writeVarintField(3,ie.type),te.writeMessage(4,Vr,ie)}function Bt({keys:Be,values:te,feature:ie},me){for(const Pe of Object.keys(ie.tags)){let Ie=ie.tags[Pe];if(Ie===null)continue;let Le=Be.get(Pe);Le===void 0&&(Le=Be.size,Be.set(Pe,Le)),me.writeVarint(Le);const Je=typeof Ie;Je!=="string"&&Je!=="boolean"&&Je!=="number"&&(Ie=JSON.stringify(Ie));let ze=te.get(Ie);ze===void 0&&(ze=te.size,te.set(Ie,ze)),me.writeVarint(ze)}}function Wr(Be,te){return(te<<3)+(7&Be)}function Er(Be){return Be<<1^Be>>31}function Vr(Be,te){const{geometry:ie,type:me}=Be;let Pe=0,Ie=0;if(me===1){te.writeVarint(Wr(1,ie.length));for(const Le of ie){const Je=Le[0]-Pe,ze=Le[1]-Ie;te.writeVarint(Er(Je)),te.writeVarint(Er(ze)),Pe+=Je,Ie+=ze}}else for(const Le of ie){te.writeVarint(Wr(1,1));const Je=Le.length-(me===3?1:0);for(let ze=0;ze<Je;ze++){ze===1&&te.writeVarint(Wr(2,Je-1));const Xe=Le[ze][0]-Pe,Dt=Le[ze][1]-Ie;te.writeVarint(Er(Xe)),te.writeVarint(Er(Dt)),Pe+=Xe,Ie+=Dt}me===3&&te.writeVarint(Wr(7,1))}}function Ur(Be,te){const ie=typeof Be;ie==="string"?te.writeStringField(1,Be):ie==="boolean"?te.writeBooleanField(7,Be):ie==="number"&&(Be%1!=0?te.writeDoubleField(3,Be):Be<0?te.writeSVarintField(6,Be):te.writeVarintField(5,Be))}const jn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Be=>Be},yn=Math.fround||(os=new Float32Array(1),Be=>(os[0]=+Be,os[0]));var os;const qi=3,ps=5,Os=6;class Ei{constructor(te){this.options=Object.assign(Object.create(jn),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){const{log:ie,minZoom:me,maxZoom:Pe}=this.options;ie&&console.time("total time");const Ie=`prepare ${te.length} points`;ie&&console.time(Ie),this.points=te;const Le=[];for(let ze=0;ze<te.length;ze++){const Xe=te[ze];if(!Xe.geometry)continue;const[Dt,Ct]=Xe.geometry.coordinates,dr=yn(Et(Dt)),Lr=yn(Wt(Ct));Le.push(dr,Lr,1/0,ze,-1,1),this.options.reduce&&Le.push(0)}let Je=this.trees[Pe+1]=this._createTree(Le);ie&&console.timeEnd(Ie);for(let ze=Pe;ze>=me;ze--){const Xe=+Date.now();Je=this.trees[ze]=this._createTree(this._cluster(Je,ze)),ie&&console.log("z%d: %d clusters in %dms",ze,Je.numItems,+Date.now()-Xe)}return ie&&console.timeEnd("total time"),this}getClusters(te,ie){let me=((te[0]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,te[1]));let Ie=te[2]===180?180:((te[2]+180)%360+360)%360-180;const Le=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)me=-180,Ie=180;else if(me>Ie){const Ct=this.getClusters([me,Pe,180,Le],ie),dr=this.getClusters([-180,Pe,Ie,Le],ie);return Ct.concat(dr)}const Je=this.trees[this._limitZoom(ie)],ze=Je.range(Et(me),Wt(Le),Et(Ie),Wt(Pe)),Xe=Je.data,Dt=[];for(const Ct of ze){const dr=this.stride*Ct;Dt.push(Xe[dr+ps]>1?po(Xe,dr,this.clusterProps):this.points[Xe[dr+qi]])}return Dt}getChildren(te){const ie=this._getOriginId(te),me=this._getOriginZoom(te),Pe="No cluster with the specified id.",Ie=this.trees[me];if(!Ie)throw new Error(Pe);const Le=Ie.data;if(ie*this.stride>=Le.length)throw new Error(Pe);const Je=this.options.radius/(this.options.extent*Math.pow(2,me-1)),ze=Ie.within(Le[ie*this.stride],Le[ie*this.stride+1],Je),Xe=[];for(const Dt of ze){const Ct=Dt*this.stride;Le[Ct+4]===te&&Xe.push(Le[Ct+ps]>1?po(Le,Ct,this.clusterProps):this.points[Le[Ct+qi]])}if(Xe.length===0)throw new Error(Pe);return Xe}getLeaves(te,ie,me){const Pe=[];return this._appendLeaves(Pe,te,ie=ie||10,me=me||0,0),Pe}getTile(te,ie,me){const Pe=this.trees[this._limitZoom(te)],Ie=Math.pow(2,te),{extent:Le,radius:Je}=this.options,ze=Je/Le,Xe=(me-ze)/Ie,Dt=(me+1+ze)/Ie,Ct={features:[]};return this._addTileFeatures(Pe.range((ie-ze)/Ie,Xe,(ie+1+ze)/Ie,Dt),Pe.data,ie,me,Ie,Ct),ie===0&&this._addTileFeatures(Pe.range(1-ze/Ie,Xe,1,Dt),Pe.data,Ie,me,Ie,Ct),ie===Ie-1&&this._addTileFeatures(Pe.range(0,Xe,ze/Ie,Dt),Pe.data,-1,me,Ie,Ct),Ct.features.length?Ct:null}getClusterExpansionZoom(te){let ie=this._getOriginZoom(te)-1;for(;ie<=this.options.maxZoom;){const me=this.getChildren(te);if(ie++,me.length!==1)break;te=me[0].properties.cluster_id}return ie}_appendLeaves(te,ie,me,Pe,Ie){const Le=this.getChildren(ie);for(const Je of Le){const ze=Je.properties;if(ze&&ze.cluster?Ie+ze.point_count<=Pe?Ie+=ze.point_count:Ie=this._appendLeaves(te,ze.cluster_id,me,Pe,Ie):Ie<Pe?Ie++:te.push(Je),te.length===me)break}return Ie}_createTree(te){const ie=new o.c3(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let me=0;me<te.length;me+=this.stride)ie.add(te[me],te[me+1]);return ie.finish(),ie.data=te,ie}_addTileFeatures(te,ie,me,Pe,Ie,Le){for(const Je of te){const ze=Je*this.stride,Xe=ie[ze+ps]>1;let Dt,Ct,dr;if(Xe)Dt=et(ie,ze,this.clusterProps),Ct=ie[ze],dr=ie[ze+1];else{const br=this.points[ie[ze+qi]];Dt=br.properties;const[rn,hn]=br.geometry.coordinates;Ct=Et(rn),dr=Wt(hn)}const Lr={type:1,geometry:[[Math.round(this.options.extent*(Ct*Ie-me)),Math.round(this.options.extent*(dr*Ie-Pe))]],tags:Dt};let Mr;Mr=Xe||this.options.generateId?ie[ze+qi]:this.points[ie[ze+qi]].id,Mr!==void 0&&(Lr.id=Mr),Le.features.push(Lr)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,ie){const{radius:me,extent:Pe,reduce:Ie,minPoints:Le}=this.options,Je=me/(Pe*Math.pow(2,ie)),ze=te.data,Xe=[],Dt=this.stride;for(let Ct=0;Ct<ze.length;Ct+=Dt){if(ze[Ct+2]<=ie)continue;ze[Ct+2]=ie;const dr=ze[Ct],Lr=ze[Ct+1],Mr=te.within(ze[Ct],ze[Ct+1],Je),br=ze[Ct+ps];let rn=br;for(const hn of Mr){const si=hn*Dt;ze[si+2]>ie&&(rn+=ze[si+ps])}if(rn>br&&rn>=Le){let hn,si=dr*br,Xi=Lr*br,xs=-1;const cs=(Ct/Dt<<5)+(ie+1)+this.points.length;for(const ns of Mr){const ni=ns*Dt;if(ze[ni+2]<=ie)continue;ze[ni+2]=ie;const wn=ze[ni+ps];si+=ze[ni]*wn,Xi+=ze[ni+1]*wn,ze[ni+4]=cs,Ie&&(hn||(hn=this._map(ze,Ct,!0),xs=this.clusterProps.length,this.clusterProps.push(hn)),Ie(hn,this._map(ze,ni)))}ze[Ct+4]=cs,Xe.push(si/rn,Xi/rn,1/0,cs,-1,rn),Ie&&Xe.push(xs)}else{for(let hn=0;hn<Dt;hn++)Xe.push(ze[Ct+hn]);if(rn>1)for(const hn of Mr){const si=hn*Dt;if(!(ze[si+2]<=ie)){ze[si+2]=ie;for(let Xi=0;Xi<Dt;Xi++)Xe.push(ze[si+Xi])}}}}return Xe}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,ie,me){if(te[ie+ps]>1){const Le=this.clusterProps[te[ie+Os]];return me?Object.assign({},Le):Le}const Pe=this.points[te[ie+qi]].properties,Ie=this.options.map(Pe);return me&&Ie===Pe?Object.assign({},Ie):Ie}}function po(Be,te,ie){return{type:"Feature",id:Be[te+qi],properties:et(Be,te,ie),geometry:{type:"Point",coordinates:[(me=Be[te],360*(me-.5)),Ar(Be[te+1])]}};var me}function et(Be,te,ie){const me=Be[te+ps],Pe=me>=1e4?`${Math.round(me/1e3)}k`:me>=1e3?Math.round(me/100)/10+"k":me,Ie=Be[te+Os],Le=Ie===-1?{}:Object.assign({},ie[Ie]);return Object.assign(Le,{cluster:!0,cluster_id:Be[te+qi],point_count:me,point_count_abbreviated:Pe})}function Et(Be){return Be/360+.5}function Wt(Be){const te=Math.sin(Be*Math.PI/180),ie=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return ie<0?0:ie>1?1:ie}function Ar(Be){const te=(180-360*Be)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}function pr(Be,te,ie,me){let Pe=me;const Ie=te+(ie-te>>1);let Le,Je=ie-te;const ze=Be[te],Xe=Be[te+1],Dt=Be[ie],Ct=Be[ie+1];for(let dr=te+3;dr<ie;dr+=3){const Lr=gr(Be[dr],Be[dr+1],ze,Xe,Dt,Ct);if(Lr>Pe)Le=dr,Pe=Lr;else if(Lr===Pe){const Mr=Math.abs(dr-Ie);Mr<Je&&(Le=dr,Je=Mr)}}Pe>me&&(Le-te>3&&pr(Be,te,Le,me),Be[Le+2]=Pe,ie-Le>3&&pr(Be,Le,ie,me))}function gr(Be,te,ie,me,Pe,Ie){let Le=Pe-ie,Je=Ie-me;if(Le!==0||Je!==0){const ze=((Be-ie)*Le+(te-me)*Je)/(Le*Le+Je*Je);ze>1?(ie=Pe,me=Ie):ze>0&&(ie+=Le*ze,me+=Je*ze)}return Le=Be-ie,Je=te-me,Le*Le+Je*Je}function Or(Be,te,ie,me){const Pe={id:Be??null,type:te,geometry:ie,tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(te==="Point"||te==="MultiPoint"||te==="LineString")Ln(Pe,ie);else if(te==="Polygon")Ln(Pe,ie[0]);else if(te==="MultiLineString")for(const Ie of ie)Ln(Pe,Ie);else if(te==="MultiPolygon")for(const Ie of ie)Ln(Pe,Ie[0]);return Pe}function Ln(Be,te){for(let ie=0;ie<te.length;ie+=3)Be.minX=Math.min(Be.minX,te[ie]),Be.minY=Math.min(Be.minY,te[ie+1]),Be.maxX=Math.max(Be.maxX,te[ie]),Be.maxY=Math.max(Be.maxY,te[ie+1])}function gi(Be,te,ie,me){if(!te.geometry)return;const Pe=te.geometry.coordinates;if(Pe&&Pe.length===0)return;const Ie=te.geometry.type,Le=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2);let Je=[],ze=te.id;if(ie.promoteId?ze=te.properties[ie.promoteId]:ie.generateId&&(ze=me||0),Ie==="Point")Fi(Pe,Je);else if(Ie==="MultiPoint")for(const Xe of Pe)Fi(Xe,Je);else if(Ie==="LineString")to(Pe,Je,Le,!1);else if(Ie==="MultiLineString"){if(ie.lineMetrics){for(const Xe of Pe)Je=[],to(Xe,Je,Le,!1),Be.push(Or(ze,"LineString",Je,te.properties));return}Ss(Pe,Je,Le,!1)}else if(Ie==="Polygon")Ss(Pe,Je,Le,!0);else{if(Ie!=="MultiPolygon"){if(Ie==="GeometryCollection"){for(const Xe of te.geometry.geometries)gi(Be,{id:ze,geometry:Xe,properties:te.properties},ie,me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Xe of Pe){const Dt=[];Ss(Xe,Dt,Le,!0),Je.push(Dt)}}Be.push(Or(ze,Ie,Je,te.properties))}function Fi(Be,te){te.push(ua(Be[0]),jo(Be[1]),0)}function to(Be,te,ie,me){let Pe,Ie,Le=0;for(let ze=0;ze<Be.length;ze++){const Xe=ua(Be[ze][0]),Dt=jo(Be[ze][1]);te.push(Xe,Dt,0),ze>0&&(Le+=me?(Pe*Dt-Xe*Ie)/2:Math.sqrt(Math.pow(Xe-Pe,2)+Math.pow(Dt-Ie,2))),Pe=Xe,Ie=Dt}const Je=te.length-3;te[2]=1,pr(te,0,Je,ie),te[Je+2]=1,te.size=Math.abs(Le),te.start=0,te.end=te.size}function Ss(Be,te,ie,me){for(let Pe=0;Pe<Be.length;Pe++){const Ie=[];to(Be[Pe],Ie,ie,me),te.push(Ie)}}function ua(Be){return Be/360+.5}function jo(Be){const te=Math.sin(Be*Math.PI/180),ie=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return ie<0?0:ie>1?1:ie}function Yt(Be,te,ie,me,Pe,Ie,Le,Je){if(me/=te,Ie>=(ie/=te)&&Le<me)return Be;if(Le<ie||Ie>=me)return null;const ze=[];for(const Xe of Be){const Dt=Xe.geometry;let Ct=Xe.type;const dr=Pe===0?Xe.minX:Xe.minY,Lr=Pe===0?Xe.maxX:Xe.maxY;if(dr>=ie&&Lr<me){ze.push(Xe);continue}if(Lr<ie||dr>=me)continue;let Mr=[];if(Ct==="Point"||Ct==="MultiPoint")$n(Dt,Mr,ie,me,Pe);else if(Ct==="LineString")as(Dt,Mr,ie,me,Pe,!1,Je.lineMetrics);else if(Ct==="MultiLineString")bi(Dt,Mr,ie,me,Pe,!1);else if(Ct==="Polygon")bi(Dt,Mr,ie,me,Pe,!0);else if(Ct==="MultiPolygon")for(const br of Dt){const rn=[];bi(br,rn,ie,me,Pe,!0),rn.length&&Mr.push(rn)}if(Mr.length){if(Je.lineMetrics&&Ct==="LineString"){for(const br of Mr)ze.push(Or(Xe.id,Ct,br,Xe.tags));continue}Ct!=="LineString"&&Ct!=="MultiLineString"||(Mr.length===1?(Ct="LineString",Mr=Mr[0]):Ct="MultiLineString"),Ct!=="Point"&&Ct!=="MultiPoint"||(Ct=Mr.length===3?"Point":"MultiPoint"),ze.push(Or(Xe.id,Ct,Mr,Xe.tags))}}return ze.length?ze:null}function $n(Be,te,ie,me,Pe){for(let Ie=0;Ie<Be.length;Ie+=3){const Le=Be[Ie+Pe];Le>=ie&&Le<=me&&rs(te,Be[Ie],Be[Ie+1],Be[Ie+2])}}function as(Be,te,ie,me,Pe,Ie,Le){let Je=Ts(Be);const ze=Pe===0?fi:ro;let Xe,Dt,Ct=Be.start;for(let rn=0;rn<Be.length-3;rn+=3){const hn=Be[rn],si=Be[rn+1],Xi=Be[rn+2],xs=Be[rn+3],cs=Be[rn+4],ns=Pe===0?hn:si,ni=Pe===0?xs:cs;let wn=!1;Le&&(Xe=Math.sqrt(Math.pow(hn-xs,2)+Math.pow(si-cs,2))),ns<ie?ni>ie&&(Dt=ze(Je,hn,si,xs,cs,ie),Le&&(Je.start=Ct+Xe*Dt)):ns>me?ni<me&&(Dt=ze(Je,hn,si,xs,cs,me),Le&&(Je.start=Ct+Xe*Dt)):rs(Je,hn,si,Xi),ni<ie&&ns>=ie&&(Dt=ze(Je,hn,si,xs,cs,ie),wn=!0),ni>me&&ns<=me&&(Dt=ze(Je,hn,si,xs,cs,me),wn=!0),!Ie&&wn&&(Le&&(Je.end=Ct+Xe*Dt),te.push(Je),Je=Ts(Be)),Le&&(Ct+=Xe)}let dr=Be.length-3;const Lr=Be[dr],Mr=Be[dr+1],br=Pe===0?Lr:Mr;br>=ie&&br<=me&&rs(Je,Lr,Mr,Be[dr+2]),dr=Je.length-3,Ie&&dr>=3&&(Je[dr]!==Je[0]||Je[dr+1]!==Je[1])&&rs(Je,Je[0],Je[1],Je[2]),Je.length&&te.push(Je)}function Ts(Be){const te=[];return te.size=Be.size,te.start=Be.start,te.end=Be.end,te}function bi(Be,te,ie,me,Pe,Ie){for(const Le of Be)as(Le,te,ie,me,Pe,Ie,!1)}function rs(Be,te,ie,me){Be.push(te,ie,me)}function fi(Be,te,ie,me,Pe,Ie){const Le=(Ie-te)/(me-te);return rs(Be,Ie,ie+(Pe-ie)*Le,1),Le}function ro(Be,te,ie,me,Pe,Ie){const Le=(Ie-ie)/(Pe-ie);return rs(Be,te+(me-te)*Le,Ie,1),Le}function Cl(Be,te){const ie=[];for(let me=0;me<Be.length;me++){const Pe=Be[me],Ie=Pe.type;let Le;if(Ie==="Point"||Ie==="MultiPoint"||Ie==="LineString")Le=Ro(Pe.geometry,te);else if(Ie==="MultiLineString"||Ie==="Polygon"){Le=[];for(const Je of Pe.geometry)Le.push(Ro(Je,te))}else if(Ie==="MultiPolygon"){Le=[];for(const Je of Pe.geometry){const ze=[];for(const Xe of Je)ze.push(Ro(Xe,te));Le.push(ze)}}ie.push(Or(Pe.id,Ie,Le,Pe.tags))}return ie}function Ro(Be,te){const ie=[];ie.size=Be.size,Be.start!==void 0&&(ie.start=Be.start,ie.end=Be.end);for(let me=0;me<Be.length;me+=3)ie.push(Be[me]+te,Be[me+1],Be[me+2]);return ie}function Yo(Be,te){if(Be.transformed)return Be;const ie=1<<Be.z,me=Be.x,Pe=Be.y;for(const Ie of Be.features){const Le=Ie.geometry,Je=Ie.type;if(Ie.geometry=[],Je===1)for(let ze=0;ze<Le.length;ze+=2)Ie.geometry.push(qn(Le[ze],Le[ze+1],te,ie,me,Pe));else for(let ze=0;ze<Le.length;ze++){const Xe=[];for(let Dt=0;Dt<Le[ze].length;Dt+=2)Xe.push(qn(Le[ze][Dt],Le[ze][Dt+1],te,ie,me,Pe));Ie.geometry.push(Xe)}}return Be.transformed=!0,Be}function qn(Be,te,ie,me,Pe,Ie){return[Math.round(ie*(Be*me-Pe)),Math.round(ie*(te*me-Ie))]}function Ni(Be,te,ie,me,Pe){const Ie=te===Pe.maxZoom?0:Pe.tolerance/((1<<te)*Pe.extent),Le={features:[],numPoints:0,numSimplified:0,numFeatures:Be.length,source:null,x:ie,y:me,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Je of Be)ls(Le,Je,Ie,Pe);return Le}function ls(Be,te,ie,me){const Pe=te.geometry,Ie=te.type,Le=[];if(Be.minX=Math.min(Be.minX,te.minX),Be.minY=Math.min(Be.minY,te.minY),Be.maxX=Math.max(Be.maxX,te.maxX),Be.maxY=Math.max(Be.maxY,te.maxY),Ie==="Point"||Ie==="MultiPoint")for(let Je=0;Je<Pe.length;Je+=3)Le.push(Pe[Je],Pe[Je+1]),Be.numPoints++,Be.numSimplified++;else if(Ie==="LineString")bo(Le,Pe,Be,ie,!1,!1);else if(Ie==="MultiLineString"||Ie==="Polygon")for(let Je=0;Je<Pe.length;Je++)bo(Le,Pe[Je],Be,ie,Ie==="Polygon",Je===0);else if(Ie==="MultiPolygon")for(let Je=0;Je<Pe.length;Je++){const ze=Pe[Je];for(let Xe=0;Xe<ze.length;Xe++)bo(Le,ze[Xe],Be,ie,!0,Xe===0)}if(Le.length){let Je=te.tags||null;if(Ie==="LineString"&&me.lineMetrics){Je={};for(const Xe in te.tags)Je[Xe]=te.tags[Xe];Je.mapbox_clip_start=Pe.start/Pe.size,Je.mapbox_clip_end=Pe.end/Pe.size}const ze={geometry:Le,type:Ie==="Polygon"||Ie==="MultiPolygon"?3:Ie==="LineString"||Ie==="MultiLineString"?2:1,tags:Je};te.id!==null&&(ze.id=te.id),Be.features.push(ze)}}function bo(Be,te,ie,me,Pe,Ie){const Le=me*me;if(me>0&&te.size<(Pe?Le:me))return void(ie.numPoints+=te.length/3);const Je=[];for(let ze=0;ze<te.length;ze+=3)(me===0||te[ze+2]>Le)&&(ie.numSimplified++,Je.push(te[ze],te[ze+1])),ie.numPoints++;Pe&&function(ze,Xe){let Dt=0;for(let Ct=0,dr=ze.length,Lr=dr-2;Ct<dr;Lr=Ct,Ct+=2)Dt+=(ze[Ct]-ze[Lr])*(ze[Ct+1]+ze[Lr+1]);if(Dt>0===Xe)for(let Ct=0,dr=ze.length;Ct<dr/2;Ct+=2){const Lr=ze[Ct],Mr=ze[Ct+1];ze[Ct]=ze[dr-2-Ct],ze[Ct+1]=ze[dr-1-Ct],ze[dr-2-Ct]=Lr,ze[dr-1-Ct]=Mr}}(Je,Ie),Be.push(Je)}const xt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class wo{constructor(te,ie){const me=(ie=this.options=function(Ie,Le){for(const Je in Le)Ie[Je]=Le[Je];return Ie}(Object.create(xt),ie)).debug;if(me&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");let Pe=function(Ie,Le){const Je=[];if(Ie.type==="FeatureCollection")for(let ze=0;ze<Ie.features.length;ze++)gi(Je,Ie.features[ze],Le,ze);else gi(Je,Ie.type==="Feature"?Ie:{geometry:Ie},Le);return Je}(te,ie);this.tiles={},this.tileCoords=[],me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Pe=function(Ie,Le){const Je=Le.buffer/Le.extent;let ze=Ie;const Xe=Yt(Ie,1,-1-Je,Je,0,-1,2,Le),Dt=Yt(Ie,1,1-Je,2+Je,0,-1,2,Le);return(Xe||Dt)&&(ze=Yt(Ie,1,-Je,1+Je,0,-1,2,Le)||[],Xe&&(ze=Cl(Xe,1).concat(ze)),Dt&&(ze=ze.concat(Cl(Dt,-1)))),ze}(Pe,ie),Pe.length&&this.splitTile(Pe,0,0,0),me&&(Pe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(te,ie,me,Pe,Ie,Le,Je){const ze=[te,ie,me,Pe],Xe=this.options,Dt=Xe.debug;for(;ze.length;){Pe=ze.pop(),me=ze.pop(),ie=ze.pop(),te=ze.pop();const Ct=1<<ie,dr=Ea(ie,me,Pe);let Lr=this.tiles[dr];if(!Lr&&(Dt>1&&console.time("creation"),Lr=this.tiles[dr]=Ni(te,ie,me,Pe,Xe),this.tileCoords.push({z:ie,x:me,y:Pe}),Dt)){Dt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,me,Pe,Lr.numFeatures,Lr.numPoints,Lr.numSimplified),console.timeEnd("creation"));const wn=`z${ie}`;this.stats[wn]=(this.stats[wn]||0)+1,this.total++}if(Lr.source=te,Ie==null){if(ie===Xe.indexMaxZoom||Lr.numPoints<=Xe.indexMaxPoints)continue}else{if(ie===Xe.maxZoom||ie===Ie)continue;if(Ie!=null){const wn=Ie-ie;if(me!==Le>>wn||Pe!==Je>>wn)continue}}if(Lr.source=null,te.length===0)continue;Dt>1&&console.time("clipping");const Mr=.5*Xe.buffer/Xe.extent,br=.5-Mr,rn=.5+Mr,hn=1+Mr;let si=null,Xi=null,xs=null,cs=null,ns=Yt(te,Ct,me-Mr,me+rn,0,Lr.minX,Lr.maxX,Xe),ni=Yt(te,Ct,me+br,me+hn,0,Lr.minX,Lr.maxX,Xe);te=null,ns&&(si=Yt(ns,Ct,Pe-Mr,Pe+rn,1,Lr.minY,Lr.maxY,Xe),Xi=Yt(ns,Ct,Pe+br,Pe+hn,1,Lr.minY,Lr.maxY,Xe),ns=null),ni&&(xs=Yt(ni,Ct,Pe-Mr,Pe+rn,1,Lr.minY,Lr.maxY,Xe),cs=Yt(ni,Ct,Pe+br,Pe+hn,1,Lr.minY,Lr.maxY,Xe),ni=null),Dt>1&&console.timeEnd("clipping"),ze.push(si||[],ie+1,2*me,2*Pe),ze.push(Xi||[],ie+1,2*me,2*Pe+1),ze.push(xs||[],ie+1,2*me+1,2*Pe),ze.push(cs||[],ie+1,2*me+1,2*Pe+1)}}getTile(te,ie,me){te=+te,ie=+ie,me=+me;const Pe=this.options,{extent:Ie,debug:Le}=Pe;if(te<0||te>24)return null;const Je=1<<te,ze=Ea(te,ie=ie+Je&Je-1,me);if(this.tiles[ze])return Yo(this.tiles[ze],Ie);Le>1&&console.log("drilling down to z%d-%d-%d",te,ie,me);let Xe,Dt=te,Ct=ie,dr=me;for(;!Xe&&Dt>0;)Dt--,Ct>>=1,dr>>=1,Xe=this.tiles[Ea(Dt,Ct,dr)];return Xe&&Xe.source?(Le>1&&(console.log("found parent tile z%d-%d-%d",Dt,Ct,dr),console.time("drilling down")),this.splitTile(Xe.source,Dt,Ct,dr,te,ie,me),Le>1&&console.timeEnd("drilling down"),this.tiles[ze]?Yo(this.tiles[ze],Ie):null):null}}function Ea(Be,te,ie){return 32*((1<<Be)*ie+te)+Be}function Mo(Be,te){const ie=Be.tileID.canonical;if(!this._geoJSONIndex)return void te(null,null);const me=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!me)return void te(null,null);const Pe=Xe=>Xe.tags&&"3d_elevation_id"in Xe.tags&&"source"in Xe.tags&&Xe.tags.source==="elevation",Ie=me.features.filter(Xe=>Pe(Xe));let Le={_geojsonTileLayer:me.features};Ie.length>0&&(Le={_geojsonTileLayer:me.features.filter(Xe=>!Pe(Xe)),hd_road_elevation:Ie});const Je=new je(Le),ze=function(Xe){const Dt=new o.bs;for(const Ct of Object.keys(Xe))Dt.writeMessage(3,ir,{name:Ct,features:Xe[Ct]});return Dt.finish()}(Le).buffer;te(null,{vectorTile:Je,rawData:ze})}class ln extends Ne{constructor(te,ie,me,Pe,Ie,Le,Je){super(te,ie,me,Pe,Ie,Mo,Je),Le&&(this.loadGeoJSON=Le),this._dynamicIndex=new We}loadData(te,ie){const me=te&&te.request,Pe=me&&me.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(te,(Ie,Le)=>{if(Ie||!Le)return ie(Ie);if(typeof Le!="object")return ie(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));{try{if(te.filter){const ze=o.U(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ze.result==="error")throw new Error(ze.value.map(Xe=>`${Xe.key}: ${Xe.message}`).join(", "));Le.features=Le.features.filter(Xe=>ze.value.evaluate({zoom:0},Xe))}te.dynamic?(Le.type==="Feature"&&(Le={type:"FeatureCollection",features:[Le]}),te.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Le.features,this.loaded),te.cluster&&(Le.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=te.cluster?new Ei(function({superclusterOptions:ze,clusterProperties:Xe}){if(!Xe||!ze)return ze;const Dt={},Ct={},dr={accumulated:null,zoom:0},Lr={properties:null},Mr=Object.keys(Xe);for(const br of Mr){const[rn,hn]=Xe[br],si=o.U(hn),Xi=o.U(typeof rn=="string"?[rn,["accumulated"],["get",br]]:rn);Dt[br]=si.value,Ct[br]=Xi.value}return ze.map=br=>{Lr.properties=br;const rn={};for(const hn of Mr)rn[hn]=Dt[hn].evaluate(dr,Lr);return rn},ze.reduce=(br,rn)=>{Lr.properties=rn;for(const hn of Mr)dr.accumulated=br[hn],br[hn]=Ct[hn].evaluate(dr,Lr)},ze}(te)).load(Le.features):te.dynamic?this._dynamicIndex:function(ze,Xe){return new wo(ze,Xe)}(Le,te.geojsonVtOptions)}catch(ze){return ie(ze)}const Je={};if(Pe){const ze=I(me);ze&&(Je.resourceTiming={},Je.resourceTiming[te.source]=JSON.parse(JSON.stringify(ze)))}ie(null,Je)}})}reloadTile(te,ie){const me=this.loaded;return me&&me[te.uid]?te.partial?ie(null,void 0):super.reloadTile(te,ie):this.loadTile(te,ie)}loadGeoJSON(te,ie){if(te.request)o.m(te.request,ie);else{if(typeof te.data!="string")return ie(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return ie(null,JSON.parse(te.data))}catch{return ie(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(te,ie){try{ie(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(me){ie(me)}}getClusterChildren(te,ie){try{ie(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(me){ie(me)}}getClusterLeaves(te,ie){try{ie(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(me){ie(me)}}}class Do{constructor(te,ie,me){this.tileID=new o.aP(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=te.projection,this.brightness=ie,this.worldview=me}parse(te,ie,me,Pe){this.status="parsing";const Ie=new o.aP(me.tileID.overscaledZ,me.tileID.wrap,me.tileID.canonical.z,me.tileID.canonical.x,me.tileID.canonical.y),Le=[],Je=ie.familiesBySource[me.source],ze=new o.fm(Ie,me.promoteId);ze.bucketLayerIDs=[],ze.is3DTile=!0,o.fB(te).then(Xe=>{if(!Xe)return Pe(new Error("Could not parse tile"));const Dt=Xe.json.extensionsUsed&&Xe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Xe.json.asset.extras&&Xe.json.asset.extras.MAPBOX_mesh_features,Ct=Xe.json.extensionsUsed&&Xe.json.extensionsUsed.includes("EXT_meshopt_compression"),dr=new o.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Lr in Je)for(const Mr of Je[Lr]){const br=Mr[0];ze.bucketLayerIDs.push(Mr.map(si=>o.B(si.id,si.scope))),br.recalculate(dr,[]);const rn=o.fC(Xe,1/o.d6(me.tileID.canonical)),hn=new o.fD(Mr,rn,Ie,Dt,Ct,this.brightness,ze,this.worldview);Dt||(hn.needsUpload=!0),Le.push(hn),hn.evaluate(br)}this.status="done",Pe(null,{buckets:Le,featureIndex:ze,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Xe=>Pe(new Error(Xe.message)))}}class qy{constructor(te,ie,me,Pe,Ie,Le,Je,ze){this.actor=te,this.layerIndex=ie,this.availableImages=me,this.availableModels=Pe,this.brightness=Je,this.loading={},this.loaded={},this.worldview=ze}loadTile(te,ie){const me=te.uid,Pe=this.loading[me]=new Do(te,this.brightness,this.worldview);o.bt(te.request,(Ie,Le)=>{const Je=!this.loading[me];return delete this.loading[me],Je||Ie?(Pe.status="done",Je||(this.loaded[me]=Pe),ie(Ie)):Le&&Le.byteLength!==0?void Pe.parse(Le,this.layerIndex,te,(ze,Xe)=>{Pe.status="done",this.loaded=this.loaded||{},this.loaded[me]=Pe,ze||!Xe?ie(ze):ie(null,Xe)}):(Pe.status="done",this.loaded[me]=Pe,ie())})}reloadTile(te,ie){const me=this.loaded,Pe=te.uid;if(me&&me[Pe]){const Ie=me[Pe];Ie.projection=te.projection,Ie.brightness=te.brightness;const Le=(Je,ze)=>{Ie.reloadCallback&&(delete Ie.reloadCallback,this.loadTile(te,ie)),ie(Je,ze)};Ie.status==="parsing"?Ie.reloadCallback=Le:Ie.status==="done"&&this.loadTile(te,ie)}}abortTile(te,ie){const me=te.uid;this.loading[me]&&delete this.loading[me],ie()}removeTile(te,ie){const me=this.loaded,Pe=te.uid;me&&me[Pe]&&delete me[Pe],ie()}}class Kf{constructor(te){this.self=te,this.actor=new o.fF(te,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new o.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=o.cl({name:"mercator"}),this.workerSourceTypes={vector:Ne,geojson:ln,"raster-dem":lt,"raster-array":tt,"batched-model":qy},this.workerSources={},this.self.registerWorkerSource=(ie,me)=>{if(this.workerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.workerSourceTypes[ie]=me},this.self.registerRTLTextPlugin=ie=>{if(o.fG.isParsed())throw new Error("RTL text plugin already registered.");o.fG.setState({pluginStatus:o.fH.parsed,pluginURL:o.fG.getPluginURL()}),o.fG.applyArabicShaping=ie.applyArabicShaping,o.fG.processBidirectionalText=ie.processBidirectionalText,o.fG.processStyledBidirectionalText=ie.processStyledBidirectionalText;for(const me of this.rtlPluginParsingListeners)me(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(te,ie,me){delete this.layerIndexes[te],delete this.availableImages[te],delete this.availableModels[te],delete this.workerSources[te],me()}checkIfReady(te,ie,me){me()}setReferrer(te,ie){this.referrer=ie}spriteLoaded(te,ie){this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={});const{scope:me,isLoaded:Pe}=ie;if(this.isSpriteLoaded[te][me]=Pe,this.workerSources[te]&&this.workerSources[te][me])for(const Ie in this.workerSources[te][me]){const Le=this.workerSources[te][me][Ie];for(const Je in Le){const ze=Le[Je];ze instanceof Ne&&(ze.isSpriteLoaded=Pe,ze.fire(new o.z("isSpriteLoaded")))}}}setImages(te,ie,me){this.availableImages[te]||(this.availableImages[te]={});const{scope:Pe,images:Ie}=ie;if(this.availableImages[te][Pe]=Ie,this.workerSources[te]&&this.workerSources[te][Pe]){for(const Le in this.workerSources[te][Pe]){const Je=this.workerSources[te][Pe][Le];for(const ze in Je)Je[ze].availableImages=Ie}me()}else me()}setModels(te,{scope:ie,models:me},Pe){if(this.availableModels[te]||(this.availableModels[te]={}),this.availableModels[te][ie]=me,this.workerSources[te]&&this.workerSources[te][ie]){for(const Ie in this.workerSources[te][ie]){const Le=this.workerSources[te][ie][Ie];for(const Je in Le)Le[Je].availableModels=me}Pe()}else Pe()}setProjection(te,ie){this.projections[te]=o.cl(ie)}setBrightness(te,ie,me){this.brightness=ie,me()}setWorldview(te,ie,me){this.worldview=ie,me()}setLayers(te,ie,me){this.getLayerIndex(te,ie.scope).replace(ie.layers,ie.options),me()}updateLayers(te,ie,me){this.getLayerIndex(te,ie.scope).update(ie.layers,ie.removedIds,ie.options),me()}loadTile(te,ie,me){ie.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,ie.type,ie.source,ie.scope).loadTile(ie,me)}decodeRasterArray(te,ie,me){this.getWorkerSource(te,ie.type,ie.source,ie.scope).decodeRasterArray(ie,me)}reloadTile(te,ie,me){ie.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,ie.type,ie.source,ie.scope).reloadTile(ie,me)}abortTile(te,ie,me){this.getWorkerSource(te,ie.type,ie.source,ie.scope).abortTile(ie,me)}removeTile(te,ie,me){this.getWorkerSource(te,ie.type,ie.source,ie.scope).removeTile(ie,me)}removeSource(te,ie,me){if(!(this.workerSources[te]&&this.workerSources[te][ie.scope]&&this.workerSources[te][ie.scope][ie.type]&&this.workerSources[te][ie.scope][ie.type][ie.source]))return;const Pe=this.workerSources[te][ie.scope][ie.type][ie.source];delete this.workerSources[te][ie.scope][ie.type][ie.source],Pe.removeSource!==void 0?Pe.removeSource(ie,me):me()}loadWorkerSource(te,ie,me){try{this.self.importScripts(ie.url),me()}catch(Pe){me(Pe.toString())}}syncRTLPluginState(te,ie,me){if(o.fG.isParsed())me(null,!0);else if(o.fG.isParsing())this.rtlPluginParsingListeners.push(me);else try{o.fG.setState(ie);const Pe=o.fG.getPluginURL();!o.fG.isLoaded()||o.fG.isParsed()||o.fG.isParsing()||Pe==null||(o.fG.setState({pluginStatus:o.fH.parsing,pluginURL:o.fG.getPluginURL()}),this.self.importScripts(Pe),o.fG.isParsed()?me(null,!0):this.rtlPluginParsingListeners.push(me))}catch(Pe){me(Pe.toString())}}setDracoUrl(te,ie){this.dracoUrl=ie}getAvailableImages(te,ie){this.availableImages[te]||(this.availableImages[te]={});let me=this.availableImages[te][ie];return me||(me=[]),me}getAvailableModels(te,ie){this.availableModels[te]||(this.availableModels[te]={});let me=this.availableModels[te][ie];return me||(me={}),me}getLayerIndex(te,ie){this.layerIndexes[te]||(this.layerIndexes[te]={});let me=this.layerIndexes[te][ie];return me||(me=this.layerIndexes[te][ie]=new U,me.scope=ie),me}getWorkerSource(te,ie,me,Pe){const Ie=this.workerSources;return Ie[te]||(Ie[te]={}),Ie[te][Pe]||(Ie[te][Pe]={}),Ie[te][Pe][ie]||(Ie[te][Pe][ie]={}),this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),Ie[te][Pe][ie][me]||(Ie[te][Pe][ie][me]=new this.workerSourceTypes[ie]({send:(Le,Je,ze,Xe,Dt,Ct)=>this.actor.send(Le,Je,ze,te,Dt,Ct),scheduler:this.actor.scheduler},this.getLayerIndex(te,Pe),this.getAvailableImages(te,Pe),this.getAvailableModels(te,Pe),this.isSpriteLoaded[te][Pe],void 0,this.brightness,this.worldview)),Ie[te][Pe][ie][me]}rasterizeImagesWorker(te,ie,me){const Pe=new Map;for(const[Ie,{image:Le,imageVariant:Je}]of ie.tasks.entries()){const ze=this.imageRasterizer.rasterize(Je,Le,ie.scope,te);Pe.set(Ie,ze)}me(void 0,Pe)}removeRasterizedImages(te,ie,me){this.imageRasterizer.removeImagesFromCacheByIds(ie.imageIds,ie.scope,te),me()}enforceCacheSizeLimit(te,ie){o.fI(ie)}getWorkerPerformanceMetrics(te,ie,me){me(void 0,void 0)}}return o.fE(self)&&(self.worker=new Kf(self)),Kf}),_(["./shared"],function(o){var I="3.16.0";const P={create:"create",load:"load",fullLoad:"fullLoad"},N={mark(p){performance.mark(p)},measure(p,n,l){performance.measure(p,n,l)}};function U(p){const n=p.name.split("?")[0];return o.a(n)&&n.includes("mapbox-gl.js")?"javascript":o.a(n)&&n.includes("mapbox-gl.css")?"css":o.b(n)?"fontRange":o.c(n)?"sprite":o.i(n)?"style":o.d(n)?"tilejson":"other"}var $,B={},Y=function(){if($)return B;function p(m){return!n(m)}function n(m){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var w,S,C=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(C);try{S=new Worker(A),w=!0}catch{w=!1}return S&&S.terminate(),URL.revokeObjectURL(A),w}()?function(){var w=document.createElement("canvas");w.width=w.height=1;var S=w.getContext("2d");if(!S)return!1;var C=S.getImageData(0,0,1,1);return C&&C.width===w.width}()?(l[v=m&&m.failIfMajorPerformanceCaveat]===void 0&&(l[v]=function(w){var S,C=function(A){var M=document.createElement("canvas"),D=Object.create(p.webGLContextAttributes);return D.failIfMajorPerformanceCaveat=A,M.getContext("webgl2",D)}(w);if(!C)return!1;try{S=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!S||C.isContextLost())&&(C.shaderSource(S,"void main() {}"),C.compileShader(S),C.getShaderParameter(S,C.COMPILE_STATUS)===!0)}(v)),l[v]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var v}$=1,B.supported=p,B.notSupportedReason=n;var l={};return p.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},B}();function H(p,n,l){const m=document.createElement(p);return n!=null&&(m.className=n),l&&l.appendChild(m),m}function K(p,n,l){const m=document.createElementNS("http://www.w3.org/2000/svg",p);for(const v of Object.keys(n))m.setAttributeNS(null,v,String(n[v]));return l&&l.appendChild(m),m}const re=typeof document<"u"?document.documentElement&&document.documentElement.style:null,G=re&&re.userSelect!==void 0?"userSelect":"WebkitUserSelect";let X;function ue(){re&&G&&(X=re[G],re[G]="none")}function Ee(){re&&G&&(re[G]=X)}function xe(p){p.preventDefault(),p.stopPropagation(),window.removeEventListener("click",xe,!0)}function Ne(){window.addEventListener("click",xe,!0),window.setTimeout(()=>{window.removeEventListener("click",xe,!0)},0)}function lt(p,n){const l=p.getBoundingClientRect();return yt(p,l,n)}function Pt(p,n){const l=p.getBoundingClientRect(),m=[];for(let v=0;v<n.length;v++)m.push(yt(p,l,n[v]));return m}function tt(p){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&p.button===2&&p.ctrlKey?0:p.button}function yt(p,n,l){const m=p.offsetWidth===n.width?1:p.offsetWidth/n.width;return new o.P((l.clientX-n.left)*m,(l.clientY-n.top)*m)}const Me="01",be="NO_ACCESS_TOKEN";class je{constructor(n,l,m){this._transformRequestFn=n,this._customAccessToken=l,this._silenceAuthErrors=!!m,this._createSkuToken()}_createSkuToken(){const n=function(){let l="";for(let m=0;m<10;m++)l+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Me,l].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,l){return this._transformRequestFn&&this._transformRequestFn(n,l)||{url:n}}normalizeStyleURL(n,l){if(!o.h(n))return n;const m=qe(n);return m.params.push(`sdk=js-${I}`),m.path=`/styles/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||l)}normalizeGlyphsURL(n,l){if(!o.h(n))return n;const m=qe(n);return m.path=`/fonts/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||l)}normalizeModelURL(n,l){if(!o.h(n))return n;const m=qe(n);return m.path=`/models/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||l)}normalizeSourceURL(n,l,m,v){if(!o.h(n))return n;const w=qe(n);return w.path=`/v4/${w.authority}.json`,w.params.push("secure"),m&&w.params.push(`language=${m}`),v&&w.params.push(`worldview=${v}`),this._makeAPIURL(w,this._customAccessToken||l)}normalizeIconsetURL(n,l){const m=qe(n);return o.h(n)?(m.path=`/styles/v1${m.path}/iconset.pbf`,this._makeAPIURL(m,this._customAccessToken||l)):We(m)}normalizeSpriteURL(n,l,m,v){const w=qe(n);return o.h(n)?(w.path=`/styles/v1${w.path}/sprite${l}${m}`,this._makeAPIURL(w,this._customAccessToken||v)):(w.path+=`${l}${m}`,We(w))}normalizeTileURL(n,l,m){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!o.h(n))return n;const v=qe(n);v.path=v.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${l||m&&v.authority!=="raster"&&m===512?"@2x":""}${o.k.supported?".webp":"$1"}`),v.authority==="raster"?v.path=`/${o.e.RASTER_URL_PREFIX}${v.path}`:v.authority==="rasterarrays"?v.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${v.path}`:v.authority==="3dtiles"?v.path=`/${o.e.TILES3D_URL_PREFIX}${v.path}`:(v.path=v.path.replace(/^.+\/v4\//,"/"),v.path=`/${o.e.TILE_URL_VERSION}${v.path}`);const w=this._customAccessToken||function(S){for(const C of S){const A=C.match(/^access_token=(.*)$/);if(A)return A[1]}return null}(v.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&w&&this._skuToken&&v.params.push(`sku=${this._skuToken}`),this._makeAPIURL(v,w)}canonicalizeTileURL(n,l){const m=qe(n);if(!m.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!m.path.match(/\.[\w]+$/))return n;let v="mapbox://";m.path.match(/^\/raster\/v1\//)?v+=`raster/${m.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:m.path.match(/^\/rasterarrays\/v1\//)?v+=`rasterarrays/${m.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:v+=`tiles/${m.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let w=m.params;return l&&(w=w.filter(S=>!S.match(/^access_token=/))),w.length&&(v+=`?${w.join("&")}`),v}canonicalizeTileset(n,l){const m=!!l&&o.h(l),v=[];for(const w of n.tiles||[])o.j(w)?v.push(this.canonicalizeTileURL(w,m)):v.push(w);return v}_makeAPIURL(n,l){const m="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",v=qe(o.e.API_URL);if(n.protocol=v.protocol,n.authority=v.authority,n.protocol==="http"){const w=n.params.indexOf("secure");w>=0&&n.params.splice(w,1)}if(v.path!=="/"&&(n.path=`${v.path}${n.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return We(n);if(l=l||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!l)throw new Error(`An API access token is required to use Mapbox GL. ${m}`);if(l[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${m}`)}return n.params=n.params.filter(w=>w.indexOf("access_token")===-1),n.params.push(`access_token=${l||""}`),We(n)}}const Ye=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function qe(p){const n=p.match(Ye);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function We(p){const n=p.params.length?`?${p.params.join("&")}`:"";return`${p.protocol}://${p.authority}${p.path}${n}`}const $e="mapbox.eventData";function _t(p){if(!p)return null;const n=p.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(o.l(n[1]))}catch{return null}}class mt{constructor(n){this.type=n,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const l=_t(o.e.ACCESS_TOKEN);let m="";return m=l&&l.u?o.f(l.u):o.e.ACCESS_TOKEN||"",n?`${$e}.${n}:${m}`:`${$e}:${m}`}fetchEventData(){const n=o.s("localStorage"),l=this.getStorageKey(),m=this.getStorageKey("uuid"),v=this.getStorageKey("uuidTimestamp");if(n)try{const w=localStorage.getItem(l);w&&(this.eventData=JSON.parse(w));const S=localStorage.getItem(m);S&&(this.anonId=S);const C=localStorage.getItem(v);C&&(this.anonIdTimestamp=Number(C));const A=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<A)&&this.refreshUUID()}catch{o.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=o.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const n=o.s("localStorage"),l=this.getStorageKey(),m=this.getStorageKey("uuid"),v=this.getStorageKey("uuidTimestamp"),w=this.anonId,S=this.anonIdTimestamp;if(n&&w)try{localStorage.setItem(m,w),Object.keys(this.eventData).length>=1&&localStorage.setItem(l,JSON.stringify(this.eventData)),S&&localStorage.setItem(v,S.toString())}catch{o.w("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,l,m,v){if(!o.e.EVENTS_URL)return;const w=qe(o.e.EVENTS_URL);w.params.push(`access_token=${v||o.e.ACCESS_TOKEN||""}`);const S={event:this.type,created:new Date(n).toISOString()},C=l?Object.assign(S,l):S,A={url:We(w),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};this.pendingRequest=o.p(A,M=>{this.pendingRequest=null,m(M),this.saveEventData(),this.processRequests(v)})}queueRequest(n,l){this.queue.push(n),this.processRequests(l)}}const rt=new class extends mt{constructor(p){super("appUserTurnstile"),this._customAccessToken=p}postTurnstileEvent(p,n){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(p)&&p.some(l=>o.h(l)||o.j(l))&&this.queueRequest(Date.now(),n)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=_t(o.e.ACCESS_TOKEN),l=n?n.u:o.e.ACCESS_TOKEN;let m=l!==this.eventData.tokenU;o.v(this.anonId)||(this.refreshUUID(),m=!0);const v=this.queue.shift();if(this.eventData.lastSuccess){const w=new Date(this.eventData.lastSuccess),S=new Date(v),C=(v-this.eventData.lastSuccess)/864e5;m=m||C>=1||C<-1||w.getDate()!==S.getDate()}else m=!0;m?this.postEvent(v,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:Me,"enabled.telemetry":!1,userId:this.anonId},w=>{w||(this.eventData.lastSuccess=v,this.eventData.tokenU=l)},p):this.processRequests()}},Tt=rt.postTurnstileEvent.bind(rt),Vt=new class extends mt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(p,n,l,m){this.skuToken=n,this.errorCb=m,o.e.EVENTS_URL&&(l||o.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},l):this.errorCb(new Error(be)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:l}=this.queue.shift();n&&this.success[n]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),o.v(this.anonId)||this.refreshUUID(),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:Me,skuToken:this.skuToken,userId:this.anonId},m=>{m?this.errorCb(m):n&&(this.success[n]=!0)},p))}remove(){this.errorCb=null}},it=Vt.postMapLoadEvent.bind(Vt),ir=new class extends mt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(p){let n=this.mapInstanceIdMap.get(p);return n||(n=o.u(),this.mapInstanceIdMap.set(p,n)),n}getEventId(p){const n=this.eventIdPerMapInstanceMap.get(p)||0;return this.eventIdPerMapInstanceMap.set(p,n+1),n}postStyleLoadEvent(p,n){const{map:l,style:m,importedStyles:v}=n;if(!o.e.EVENTS_URL||!p&&!o.e.ACCESS_TOKEN)return;const w=this.getMapInstanceId(l),S={mapInstanceId:w,eventId:this.getEventId(w),style:m};v.length&&(S.importedStyles=v),this.queueRequest({timestamp:Date.now(),payload:S},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:l}=this.queue.shift();this.postEvent(n,l,()=>{},p)}},wr=ir.postStyleLoadEvent.bind(ir),Bt=new class extends mt{constructor(p){super("metrics"),p&&(this.data=p)}postMetricsEvent(p){if(!o.e.EVENTS_URL||!p&&!o.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),o.v(this.anonId)||this.refreshUUID();const n=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:n},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:l}=this.queue.shift();this.postEvent(n,l,()=>{},p)}}({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Wr=Bt.postMetricsEvent.bind(Bt),Er=new class extends mt{constructor(){super("gljs.performance")}postPerformanceEvent(p,n){o.e.EVENTS_URL&&(p||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:l}=this.queue.shift(),m=function(v){const w=performance.getEntriesByType("resource"),S=performance.getEntriesByType("mark"),C=function(q){const Z={};if(q){for(const Q in q)if(Q!=="other")for(const se of q[Q]){const ne=`${Q}ResolveRangeMin`,ae=`${Q}ResolveRangeMax`,he=`${Q}RequestCount`,ce=`${Q}RequestCachedCount`;Z[ne]=Math.min(Z[ne]||1/0,se.startTime),Z[ae]=Math.max(Z[ae]||-1/0,se.responseEnd);const we=fe=>{Z[fe]===void 0&&(Z[fe]=0),++Z[fe]};se.transferSize!==void 0&&se.transferSize===0&&we(ce),we(he)}}return Z}(function(q,Z){const Q={};if(q)for(const se of q){const ne=Z(se);Q[ne]===void 0&&(Q[ne]=[]),Q[ne].push(se)}return Q}(w,U)),A=window.devicePixelRatio,M=navigator.connection||navigator.mozConnection||navigator.webkitConnection,D=M?M.effectiveType:void 0,F={counters:[],metadata:[],attributes:[]},O=(q,Z,Q)=>{Q!=null&&q.push({name:Z,value:Q.toString()})};for(const q in C)O(F.counters,q,C[q]);if(v.interactionRange[0]!==1/0&&v.interactionRange[1]!==-1/0&&(O(F.counters,"interactionRangeMin",v.interactionRange[0]),O(F.counters,"interactionRangeMax",v.interactionRange[1])),S)for(const q of Object.values(P)){const Z=S.find(Q=>Q.name===q);Z&&O(F.counters,q,Z.startTime)}return O(F.counters,"visibilityHidden",v.visibilityHidden),O(F.attributes,"style",function(q){if(q)for(const Z of q){const Q=Z.name.split("?")[0];if(o.i(Q)){const se=Q.split("/").slice(-2);if(se.length===2)return`mapbox://styles/${se[0]}/${se[1]}`}}}(w)),O(F.attributes,"terrainEnabled",v.terrainEnabled?"true":"false"),O(F.attributes,"fogEnabled",v.fogEnabled?"true":"false"),O(F.attributes,"projection",v.projection),O(F.attributes,"zoom",v.zoom),O(F.metadata,"devicePixelRatio",A),O(F.metadata,"connectionEffectiveType",D),O(F.metadata,"navigatorUserAgent",navigator.userAgent),O(F.metadata,"screenWidth",window.screen.width),O(F.metadata,"screenHeight",window.screen.height),O(F.metadata,"windowWidth",window.innerWidth),O(F.metadata,"windowHeight",window.innerHeight),O(F.metadata,"mapWidth",v.width/A),O(F.metadata,"mapHeight",v.height/A),O(F.metadata,"webglRenderer",v.renderer),O(F.metadata,"webglVendor",v.vendor),O(F.metadata,"sdkVersion",I),O(F.metadata,"sdkIdentifier","mapbox-gl-js"),F}(l);for(const v of m.metadata);for(const v of m.counters);for(const v of m.attributes);this.postEvent(n,m,()=>{},p)}},Vr=Er.postPerformanceEvent.bind(Er),Ur=new class extends mt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(p,n,l,m){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const v=qe(o.e.API_URL+o.e.SESSION_PATH);v.params.push(`sku=${n||""}`),v.params.push(`access_token=${m||o.e.ACCESS_TOKEN||""}`);const w={url:We(v),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(w,S=>{this.pendingRequest=null,l(S),this.saveEventData(),this.processRequests(m)})}getSessionAPI(p,n,l,m){this.skuToken=n,this.errorCb=m,o.e.SESSION_PATH&&o.e.API_URL&&(l||o.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},l):this.errorCb(new Error(be)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:l}=this.queue.shift();n&&this.success[n]||this.getSession(l,this.skuToken,m=>{m?this.errorCb(m):n&&(this.success[n]=!0)},p)}remove(){this.errorCb=null}},jn=Ur.getSessionAPI.bind(Ur),yn=new Set;function os(p,n){n?yn.add(p):yn.delete(p)}class qi{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,l){this._updatedSourceCaches[n]=l,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const l=n.scope;this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._updatedLayers[l].add(n.id),this.setDirty()}removeLayer(n){const l=n.scope;this._removedLayers[l]=this._removedLayers[l]||{},this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._removedLayers[l][n.id]=n,this._updatedLayers[l].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const l in this._updatedLayers)n[l]=n[l]||{},n[l].updatedIds=Array.from(this._updatedLayers[l].values());for(const l in this._removedLayers)n[l]=n[l]||{},n[l].removedIds=Object.keys(this._removedLayers[l]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(n){return this._updatedImages[n]?Array.from(this._updatedImages[n].values()):[]}updateImage(n,l){this._updatedImages[l]=this._updatedImages[l]||new Set,this._updatedImages[l].add(o.I.toString(n)),this.setDirty()}resetUpdatedImages(n){this._updatedImages[n]&&this._updatedImages[n].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function ps(p){const{userImage:n}=p;return!!(n&&n.render&&n.render())&&(p.data.replace(new Uint8Array(n.data.buffer)),!0)}class Os extends o.E{constructor(n){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=n,n!=="raster"&&o.r()&&(this.imageRasterizerDispatcher=new o.D(o.t(),this,"Image Rasterizer Worker",1))}addScope(n){this.loaded.set(n,!1),this.imageProviders.set(n,new Map),this.images.set(n,new Map),this.updatedImages.set(n,new Set),this.callbackDispatchedThisFrame.set(n,new Set),this.patterns.set(n,new Map),this.atlasImage.set(n,new o.q({width:1,height:1}))}removeScope(n){this.loaded.delete(n),this.imageProviders.delete(n),this.images.delete(n),this.updatedImages.delete(n),this.callbackDispatchedThisFrame.delete(n),this.patterns.delete(n),this.atlasImage.delete(n);const l=this.atlasTexture.get(n);l&&(l.destroy(),this.atlasTexture.delete(n))}addImageProvider(n,l){this.imageProviders.has(l)||this.imageProviders.set(l,new Map),this.imageProviders.get(l).set(n.id,n)}removeImageProvider(n,l){this.imageProviders.has(l)&&this.imageProviders.get(l).delete(n)}getPendingImageProviders(){const n=[];for(const l of this.imageProviders.values())for(const m of l.values())m.hasPendingRequests()&&n.push(m);return n}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.x),this._imageRasterizer}isLoaded(){for(const n of this.loaded.keys())if(!this.loaded.get(n))return!1;return!0}setLoaded(n,l){if(this.loaded.get(l)!==n&&(this.loaded.set(l,n),n)){for(const{ids:m,callback:v}of this.requestors)this._notify(m,l,v);this.requestors=[]}}hasImage(n,l){return!!this.getImage(n,l)}getImage(n,l){return this.images.get(l).get(n.toString())}addImage(n,l,m){this._validate(n,m)&&this.images.get(l).set(n.toString(),m)}_validate(n,l){let m=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new o.y(new Error(`Image "${n.name}" has invalid "stretchX" value`))),m=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new o.y(new Error(`Image "${n.name}" has invalid "stretchY" value`))),m=!1),this._validateContent(l.content,l)||(this.fire(new o.y(new Error(`Image "${n.name}" has invalid "content" value`))),m=!1),m}_validateStretch(n,l){if(!n)return!0;let m=0;for(const v of n){if(v[0]<m||v[1]<v[0]||l<v[1])return!1;m=v[1]}return!0}_validateContent(n,l){return n?n.length!==4||!l.usvg&&(n[0]<0||l.data.width<n[0]||n[1]<0||l.data.height<n[1]||n[2]<0||l.data.width<n[2]||n[3]<0||l.data.height<n[3])?!1:!(n[2]<n[0]||n[3]<n[1]):!0}updateImage(n,l,m){const v=this.images.get(l).get(n.toString());m.version=v.version+1,this.images.get(l).set(n.toString(),m),this.updatedImages.get(l).add(n),this.removeFromImageRasterizerCache(n,l)}clearUpdatedImages(n){this.updatedImages.get(n).clear()}removeFromImageRasterizerCache(n,l){this.spriteFormat!=="raster"&&(o.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[n],scope:l}):this.imageRasterizer.removeImagesFromCacheByIds([n],l))}removeImage(n,l){const m=this.images.get(l),v=m.get(n.toString());m.delete(n.toString()),this.patterns.get(l).delete(n.toString()),this.removeFromImageRasterizerCache(n,l),v.userImage&&v.userImage.onRemove&&v.userImage.onRemove()}listImages(n){return Array.from(this.images.get(n).keys()).map(l=>o.I.from(l))}getImages(n,l,m){const v=[],w=[],S=this.imageProviders.get(l);for(const D of n){if(!D.iconsetId){v.push(D);continue}const F=S.get(D.iconsetId);F&&(this.getImage(D,l)?w.push(D):F.addPendingRequest(D))}if(v.length===0)return void this._notify(w,l,m);let C=!0;const A=!!this.loaded.get(l),M=this.images.get(l);if(!A)for(const D of v)M.has(D.toString())||(C=!1);A||C?this._notify(v,l,m):this.requestors.push({ids:v,scope:l,callback:m})}rasterizeImages(n,l){const m=new Map,{tasks:v,scope:w}=n;for(const[S,C]of v.entries()){const A=this.getImage(C.id,w);A&&m.set(S,{image:A,imageVariant:C})}this._rasterizeImages(w,m,l)}_rasterizeImages(n,l,m){if(o.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:l,scope:n},m);else{const v=new Map;for(const[w,{image:S,imageVariant:C}]of l.entries())v.set(w,this.imageRasterizer.rasterize(C,S,n,0));m(void 0,v)}}getUpdatedImages(n){return this.updatedImages.get(n)||new Set}_notify(n,l,m){const v=this.images.get(l),w=new Map;for(const S of n){if(!v.get(S.toString())){if(S.iconsetId)continue;this.fire(new o.z("styleimagemissing",{id:S.name}))}const C=v.get(S.toString());if(!C){o.w(`Image "${S.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const A={data:C.usvg?null:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,usvg:C.usvg,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:!!(C.userImage&&C.userImage.render)};C.usvg&&Object.assign(A,{width:C.icon.usvg_tree.width,height:C.icon.usvg_tree.height}),w.set(o.I.toString(S),A)}m(null,w)}getPixelSize(n){const{width:l,height:m}=this.atlasImage.get(n);return{width:l,height:m}}getPattern(n,l,m){const v=n.toString(),w=this.patterns.get(l),S=w.get(v),C=this.getImage(n,l);if(!C)return null;if(S){if(S.position.version===C.version)return S.position;S.position.version=C.version}else{if(C.usvg&&!C.data){const A=this.getPatternInFlightId(v,l);if(this.patternsInFlight.has(A))return null;this.patternsInFlight.add(A);const M=new o.A(n).scaleSelf(o.o.devicePixelRatio),D=new Map([[M.toString(),{image:C,imageVariant:M}]]);return this._rasterizeImages(l,D,(F,O)=>this.storePatternImage(M,l,C,m,O)),null}this.storePattern(n,l,C)}return this._updatePatternAtlas(l,m),w.get(v).position}getPatternInFlightId(n,l){return o.B(n,l)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(n,l,m,v,w){const S=n.toString(),C=w?w.get(S):void 0;C&&(m.data=C,this.storePattern(n.id,l,m),this._updatePatternAtlas(l,v),this.patternsInFlight.delete(this.getPatternInFlightId(n.id.toString(),l)))}storePattern(n,l,m){const v={w:m.data.width+2*o.C,h:m.data.height+2*o.C,x:0,y:0},w=new o.F(v,m,o.C);this.patterns.get(l).set(n.toString(),{bin:v,position:w})}destroyAtlasTextures(){for(const n of this.atlasTexture.values())n&&n.destroy();this.atlasTexture.clear()}bind(n,l){const m=n.gl;let v=this.atlasTexture.get(l);v?this.dirty&&(v.update(this.atlasImage.get(l)),this.dirty=!1):(v=new o.T(n,this.atlasImage.get(l),m.RGBA8),this.atlasTexture.set(l,v)),v.bind(m.LINEAR,m.CLAMP_TO_EDGE)}_updatePatternAtlas(n,l){const m=this.patterns.get(n),v=Array.from(m.values()).map(({bin:M})=>M),{w,h:S}=o.G(v),C=this.atlasImage.get(n);C.resize({width:w||1,height:S||1});const A=this.images.get(n);for(const[M,{bin:D,position:F}]of m.entries()){let O=F.padding;const q=D.x+O,Z=D.y+O,Q=A.get(M).data,se=Q.width,ne=Q.height;O=O>1?O-1:O,o.q.copy(Q,C,{x:0,y:0},{x:q,y:Z},{width:se,height:ne},l),o.q.copy(Q,C,{x:0,y:ne-O},{x:q,y:Z-O},{width:se,height:O},l),o.q.copy(Q,C,{x:0,y:0},{x:q,y:Z+ne},{width:se,height:O},l),o.q.copy(Q,C,{x:se-O,y:0},{x:q-O,y:Z},{width:O,height:ne},l),o.q.copy(Q,C,{x:0,y:0},{x:q+se,y:Z},{width:O,height:ne},l),o.q.copy(Q,C,{x:se-O,y:ne-O},{x:q-O,y:Z-O},{width:O,height:O},l),o.q.copy(Q,C,{x:0,y:ne-O},{x:q+se,y:Z-O},{width:O,height:O},l),o.q.copy(Q,C,{x:0,y:0},{x:q+se,y:Z+ne},{width:O,height:O},l),o.q.copy(Q,C,{x:se-O,y:0},{x:q-O,y:Z+ne},{width:O,height:O},l)}this.dirty=!0}beginFrame(){for(const n of this.images.keys())this.callbackDispatchedThisFrame.set(n,new Set)}dispatchRenderCallbacks(n,l){const m=this.images.get(l);for(const v of n){if(this.callbackDispatchedThisFrame.get(l).has(v.toString()))continue;this.callbackDispatchedThisFrame.get(l).add(v.toString());const w=m.get(v.toString());ps(w)&&this.updateImage(v,l,w)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Ei(p){const n=p.value,l=p.valueSpec,m=p.style,v=p.styleSpec,w=p.key,S=p.arrayElementValidator||fi;if(!Array.isArray(n))return[new o.V(w,n,`array expected, ${o.K(n)} found`)];if(l.length&&n.length!==l.length)return[new o.V(w,n,`array length ${l.length} expected, length ${n.length} found`)];if(l["min-length"]&&n.length<l["min-length"])return[new o.V(w,n,`array length at least ${l["min-length"]} expected, length ${n.length} found`)];let C={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};v.$version<7&&(C.function=l.function),o.H(l.value)&&(C=l.value);let A=[];for(let M=0;M<n.length;M++)A=A.concat(S({array:n,arrayIndex:M,value:n[M],valueSpec:C,style:m,styleSpec:v,key:`${w}[${M}]`},!0));return A}function po(p){const n=p.key,l=p.value,m=p.valueSpec;if(!o.L(l))return[new o.V(n,l,`number expected, ${o.K(l)} found`)];if(l!=l)return[new o.V(n,l,"number expected, NaN found")];if("minimum"in m){let v=m.minimum;if(Array.isArray(m.minimum)&&(v=m.minimum[p.arrayIndex]),l<v)return[new o.V(n,l,`${l} is less than the minimum value ${v}`)]}if("maximum"in m){let v=m.maximum;if(Array.isArray(m.maximum)&&(v=m.maximum[p.arrayIndex]),l>v)return[new o.V(n,l,`${l} is greater than the maximum value ${v}`)]}return[]}function et(p){const n=p.key,l=p.value;if(!o.H(l))return[new o.V(n,l,`object expected, ${o.K(l)} found`)];const m=p.valueSpec,v=o.J(l.type);let w,S,C,A={};const M=v!=="categorical"&&l.property===void 0,D=!M,F=function(Q){const se=Q.stops;return Array.isArray(se)&&Array.isArray(se[0])&&o.H(se[0][0])}(l),O=ro({key:p.key,value:p.value,valueSpec:p.styleSpec.function,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(Q){if(v==="identity")return[new o.V(Q.key,Q.value,'identity function may not have a "stops" property')];let se=[];const ne=Q.value;return se=se.concat(Ei({key:Q.key,value:ne,valueSpec:Q.valueSpec,style:Q.style,styleSpec:Q.styleSpec,arrayElementValidator:q})),Array.isArray(ne)&&ne.length===0&&se.push(new o.V(Q.key,ne,"array must have at least one stop")),se},default:function(Q){return fi({key:Q.key,value:Q.value,valueSpec:m,style:Q.style,styleSpec:Q.styleSpec})}}});return v==="identity"&&M&&O.push(new o.V(p.key,p.value,'missing required property "property"')),v==="identity"||l.stops||O.push(new o.V(p.key,p.value,'missing required property "stops"')),v==="exponential"&&m.expression&&!o.M(m)&&O.push(new o.V(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(D&&!o.N(m)?O.push(new o.V(p.key,p.value,"property functions not supported")):M&&!o.O(m)&&O.push(new o.V(p.key,p.value,"zoom functions not supported"))),v!=="categorical"&&!F||l.property!==void 0||O.push(new o.V(p.key,p.value,'"property" property is required')),O;function q(Q){let se=[];const ne=Q.value,ae=Q.key;if(!Array.isArray(ne))return[new o.V(ae,ne,`array expected, ${o.K(ne)} found`)];if(ne.length!==2)return[new o.V(ae,ne,`array length 2 expected, length ${ne.length} found`)];if(F){if(!o.H(ne[0]))return[new o.V(ae,ne,`object expected, ${o.K(ne[0])} found`)];const he=ne[0];if(he.zoom===void 0)return[new o.V(ae,ne,"object stop key must have zoom")];if(he.value===void 0)return[new o.V(ae,ne,"object stop key must have value")];const ce=o.J(he.zoom);if(typeof ce!="number")return[new o.V(ae,he.zoom,"stop zoom values must be numbers")];if(C&&C>ce)return[new o.V(ae,he.zoom,"stop zoom values must appear in ascending order")];ce!==C&&(C=ce,S=void 0,A={}),se=se.concat(ro({key:`${ae}[0]`,value:ne[0],valueSpec:{zoom:{}},style:Q.style,styleSpec:Q.styleSpec,objectElementValidators:{zoom:po,value:Z}}))}else se=se.concat(Z({key:`${ae}[0]`,value:ne[0],style:Q.style,styleSpec:Q.styleSpec},ne));return o.Q(o.S(ne[1]))?se.concat([new o.V(`${ae}[1]`,ne[1],"expressions are not allowed in function stops.")]):se.concat(fi({key:`${ae}[1]`,value:ne[1],valueSpec:m,style:Q.style,styleSpec:Q.styleSpec}))}function Z(Q,se){const ne=o.K(Q.value),ae=o.J(Q.value),he=Q.value!==null?Q.value:se;if(w){if(ne!==w)return[new o.V(Q.key,he,`${ne} stop domain type must match previous stop domain type ${w}`)]}else w=ne;if(ne!=="number"&&ne!=="string"&&ne!=="boolean"&&typeof ae!="number"&&typeof ae!="string"&&typeof ae!="boolean")return[new o.V(Q.key,he,"stop domain value must be a number, string, or boolean")];if(ne!=="number"&&v!=="categorical"){let ce=`number expected, ${ne} found`;return o.N(m)&&v===void 0&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(Q.key,he,ce)]}return v!=="categorical"||ne!=="number"||typeof ae=="number"&&isFinite(ae)&&Math.floor(ae)===ae?v!=="categorical"&&ne==="number"&&typeof ae=="number"&&typeof S=="number"&&S!==void 0&&ae<S?[new o.V(Q.key,he,"stop domain values must appear in ascending order")]:(S=ae,v==="categorical"&&ae in A?[new o.V(Q.key,he,"stop domain values must be unique")]:(A[ae]=!0,[])):[new o.V(Q.key,he,`integer expected, found ${String(ae)}`)]}}function Et(p){const n=(p.expressionContext==="property"?o.W:o.U)(o.S(p.value),p.valueSpec);if(n.result==="error")return n.value.map(m=>new o.V(`${p.key}${m.key}`,p.value,m.message));const l=n.value.expression||n.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!l.outputDefined())return[new o.V(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!o.Z(l))return[new o.V(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter")return Wt(l,p);if(p.expressionContext==="appearance")return Ar(l,p);if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!o.X(l,["zoom","feature-state"]))return[new o.V(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!o.Y(l))return[new o.V(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Wt(p,n){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const v of n.valueSpec.expression.parameters)l.delete(v);if(l.size===0)return[];const m=[];return p instanceof o._&&l.has(p.name)?[new o.V(n.key,n.value,`["${p.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(p.eachChild(v=>{m.push(...Wt(v,n))}),m)}function Ar(p,n){const l=new Set;if(n.valueSpec&&n.valueSpec.expression)for(const v of n.valueSpec.expression.parameters)l.add(v);if(l.size===0)return[];const m=[];return p instanceof o._&&!l.has(p.name)?[new o.V(n.key,n.value,`["${p.name}"] is not an allowed parameter`)]:(p.eachChild(v=>{m.push(...Ar(v,n))}),m)}function pr(p){const n=p.key,l=p.value,m=p.valueSpec,v=[];return Array.isArray(m.values)?m.values.indexOf(o.J(l))===-1&&v.push(new o.V(n,l,`expected one of [${m.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(m.values).indexOf(o.J(l))===-1&&v.push(new o.V(n,l,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(l)} found`)),v}function gr(p){return o.a2(o.S(p.value))?Et(Object.assign({},p,{expressionContext:"filter",valueSpec:p.styleSpec[`filter_${p.layerType||"fill"}`]})):Or(p)}function Or(p){const n=p.value,l=p.key;if(!Array.isArray(n))return[new o.V(l,n,`array expected, ${o.K(n)} found`)];if(n.length<1)return[new o.V(l,n,"filter array must have at least 1 element")];const m=p.styleSpec;let v=pr({key:`${l}[0]`,value:n[0],valueSpec:m.filter_operator});switch(o.J(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&o.J(n[1])==="$type"&&v.push(new o.V(l,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&v.push(new o.V(l,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(o.a0(n[1])||v.push(new o.V(`${l}[1]`,n[1],`string expected, ${o.K(n[1])} found`)));for(let w=2;w<n.length;w++)o.J(n[1])==="$type"?v=v.concat(pr({key:`${l}[${w}]`,value:n[w],valueSpec:m.geometry_type})):o.a0(n[w])||o.L(n[w])||o.$(n[w])||v.push(new o.V(`${l}[${w}]`,n[w],`string, number, or boolean expected, ${o.K(n[w])} found.`));break;case"any":case"all":case"none":for(let w=1;w<n.length;w++)v=v.concat(Or({key:`${l}[${w}]`,value:n[w],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":n.length!==2?v.push(new o.V(l,n,`filter array for "${n[0]}" operator must have 2 elements`)):o.a0(n[1])||v.push(new o.V(`${l}[1]`,n[1],`string expected, ${o.K(n[1])} found`))}return v}function Ln(p,n){const l=p.key,m=p.style,v=p.layer,w=p.styleSpec,S=p.value,C=p.objectKey,A=w[`${n}_${p.layerType}`];if(!A)return[];const M=C.match(/^(.*)-use-theme$/);if(M&&A[M[1]])return o.Q(o.S(S))?[].concat(fi({key:l,value:S,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:m,styleSpec:w,expressionContext:"property",propertyType:n,propertyKey:C})):fi({key:l,value:S,valueSpec:{type:"string"},style:m,styleSpec:w});const D=C.match(/^(.*)-transition$/);if(n==="paint"&&D&&A[D[1]]&&A[D[1]].transition)return fi({key:l,value:S,valueSpec:w.transition,style:m,styleSpec:w});const F=p.valueSpec||A[C];if(!F)return[new o.a3(l,S,`unknown property "${C}"`)];let O;if(o.a0(S)&&o.N(F)&&!F.tokens&&(O=/^{([^}]+)}$/.exec(S))){const Z=`\`{ "type": "identity", "property": ${O?JSON.stringify(O[1]):'"_"'} }\``;return[new o.V(l,S,`"${C}" does not support interpolation syntax
Use an identity property function instead: ${Z}.`)]}const q=[];if(p.layerType==="symbol")C!=="text-field"||!m||m.glyphs||m.imports||q.push(new o.V(l,S,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&o.a4(o.S(S))&&o.J(S.type)==="identity"&&q.push(new o.V(l,S,'"text-font" does not support identity functions'));else if(p.layerType==="model"&&n==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&o.N(F)&&(o.a5(F)||o.O(F))){const Z=o.W(o.S(S),F).value,Q="expression"in Z&&Z.expression||"_styleExpression"in Z&&Z._styleExpression&&Z._styleExpression.expression;Q&&!o.X(Q,["measure-light"])&&(C==="model-emissive-strength"&&o.Y(Q)&&o.Z(Q)||q.push(new o.V(l,S,`${C} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return q.concat(fi({key:p.key,value:S,valueSpec:F,style:m,styleSpec:w,expressionContext:"property",propertyType:n,propertyKey:C}))}function gi(p){return Ln(p,"paint")}function Fi(p){return Ln(p,"layout")}function to(p){let n=[];const l=p.value,m=p.key,v=p.style,w=p.styleSpec;if(!o.H(l))return[new o.V(m,l,"object expected")];l.type||l.ref||n.push(new o.V(m,l,'either "type" or "ref" is required'));let S=o.J(l.type);const C=o.J(l.ref);if(l.id){const A=o.J(l.id);for(let M=0;M<p.arrayIndex;M++){const D=v.layers[M];o.J(D.id)===A&&n.push(new o.V(m,l.id,`duplicate layer id "${A}", previously used at line ${D.id.__line__}`))}}if("ref"in l){let A;["type","source","source-layer","filter","layout"].forEach(M=>{M in l&&n.push(new o.V(m,l[M],`"${M}" is prohibited for ref layers`))}),v.layers.forEach(M=>{o.J(M.id)===C&&(A=M)}),A?A.ref?n.push(new o.V(m,l.ref,"ref cannot reference another ref layer")):S=o.J(A.type):typeof C=="string"&&n.push(new o.V(m,l.ref,`ref layer "${C}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(l.source)if(o.a0(l.source)){const A=v.sources&&v.sources[l.source],M=A&&o.J(A.type);A?M==="vector"&&S==="raster"?n.push(new o.V(m,l.source,`layer "${l.id}" requires a raster source`)):M==="raster"&&S!=="raster"?n.push(new o.V(m,l.source,`layer "${l.id}" requires a vector source`)):M!=="vector"||l["source-layer"]?M==="raster-dem"&&S!=="hillshade"?n.push(new o.V(m,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="raster-array"||["raster","raster-particle"].includes(S)?S==="line"&&l.paint&&(l.paint["line-gradient"]||l.paint["line-trim-offset"])&&M==="geojson"&&!A.lineMetrics?n.push(new o.V(m,l,`layer "${l.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):S==="raster-particle"&&M!=="raster-array"&&n.push(new o.V(m,l.source,`layer "${l.id}" requires a 'raster-array' source.`)):n.push(new o.V(m,l.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new o.V(m,l,`layer "${l.id}" must specify a "source-layer"`)):n.push(new o.V(m,l.source,`source "${l.source}" not found`))}else n.push(new o.V(`${m}.source`,l.source,'"source" must be a string'));else n.push(new o.V(m,l,'missing required property "source"'));return n=n.concat(ro({key:m,value:l,valueSpec:w.layer,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":()=>[],type:()=>fi({key:`${m}.type`,value:l.type,valueSpec:w.layer.type,style:p.style,styleSpec:p.styleSpec,object:l,objectKey:"type"}),filter:A=>gr(Object.assign({layerType:S},A)),layout:A=>ro({layer:l,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":M=>Fi(Object.assign({layerType:S},M))}}),paint:A=>ro({layer:l,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":M=>gi(Object.assign({layerType:S,layer:l},M))}}),appearances(A){const M=Ei({key:A.key,value:A.value,valueSpec:A.valueSpec,style:A.style,styleSpec:A.styleSpec,arrayElementValidator:O=>function(q){const{key:Z,layer:Q,layerType:se}=q,ne=o.J(q.value),ae=o.J(ne.name),he=o.J(ne.condition),ce=ro({key:Z,value:ne,valueSpec:q.styleSpec.appearance,style:q.style,styleSpec:q.styleSpec,objectElementValidators:{condition:we=>function(fe){const Te=[];return Te.push(...Et({key:fe.key,value:fe.object.condition,valueSpec:o.a6.appearance.condition,expressionContext:"appearance"})),Te}(Object.assign({layer:Q,layerType:se},we)),properties:we=>function(fe){const Te=[],{styleSpec:ve,layer:ge,layerType:Ce}=fe,Fe=ve[`paint_${Ce}`],Oe=ve[`layout_${Ce}`],st=fe.object[fe.objectKey];for(const He in st){const ht=He in Fe?"paint":He in Oe?"layout":void 0;if(!ht){Te.push(new o.V(fe.key,He,`unknown property "${He}" for layer type "${Ce}"`));continue}const Nt=Object.assign({},fe,{key:`${fe.key}.${He}`,object:st,objectKey:He,layer:ge,layerType:Ce,value:st[He],valueSpec:ht==="paint"?Fe[He]:Oe[He]});Te.push(...Ln(Nt,ht))}return Te}(Object.assign({layer:Q,layerType:se},we))}});return ae!=="hidden"&&he===void 0&&ce.push(new o.V(q.key,"name",'Appearance with name different than "hidden" must have a condition')),ce}(Object.assign({layerType:S,layer:l},O))}),D=Array.isArray(A.value)?A.value:[],F=new Set;return D.forEach((O,q)=>{const Z=o.J(O.name);if(Z)if(F.has(Z)){const Q=o.J(l.id);M.push(new o.V(A.key,Z,`Duplicated appearance name "${Z}" for layer "${Q}"`))}else F.add(Z)}),M}}})),n}function Ss({key:p,value:n}){return o.a0(n)?[]:[new o.V(p,n,`string expected, ${o.K(n)} found`)]}const ua={promoteId:function p({key:n,value:l}){if(o.a0(l))return Ss({key:n,value:l});if(Array.isArray(l)){const v=[],w=o.S(l),S=o.U(w);return S.result==="error"&&S.value.forEach(C=>{v.push(new o.V(`${n}${C.key}`,null,`${C.message}`))}),o.X(S.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||v.push(new o.V(`${n}`,null,"promoteId expression should be only feature dependent")),v}if(!o.H(l))return[new o.V(n,l,`string, expression or object expected, "${o.K(l)}" found`)];const m=[];for(const v in l)m.push(...p({key:`${n}.${v}`,value:l[v]}));return m}};function jo(p){const n=p.value,l=p.key,m=p.styleSpec,v=p.style;if(!o.H(n))return[new o.V(l,n,`object expected, ${o.K(n)} found`)];if(!("type"in n))return[new o.V(l,n,'"type" is required')];const w=o.J(n.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(w)&&("url"in n||"tiles"in n||S.push(new o.a3(l,n,'Either "url" or "tiles" is required.'))),w){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(ro({key:l,value:n,valueSpec:m[`source_${w.replace("-","_")}`],style:p.style,styleSpec:m,objectElementValidators:ua})),S;case"geojson":if(S=ro({key:l,value:n,valueSpec:m.source_geojson,style:v,styleSpec:m,objectElementValidators:ua}),"cluster"in n&&"clusterProperties"in n){if(!o.H(n.clusterProperties))return[new o.V(`${l}.clusterProperties`,n,`object expected, ${o.K(n)} found`)];for(const C in n.clusterProperties){const A=n.clusterProperties[C];if(!Array.isArray(A))return[new o.V(`${l}.clusterProperties.${C}`,A,"array expected")];const[M,D]=A,F=typeof M=="string"?[M,["accumulated"],["get",C]]:M;S.push(...Et({key:`${l}.${C}.map`,value:D,expressionContext:"cluster-map"})),S.push(...Et({key:`${l}.${C}.reduce`,value:F,expressionContext:"cluster-reduce"}))}}return S;case"video":return ro({key:l,value:n,valueSpec:m.source_video,style:v,styleSpec:m});case"image":return ro({key:l,value:n,valueSpec:m.source_image,style:v,styleSpec:m});case"canvas":return[new o.V(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return pr({key:`${l}.type`,value:n.type,valueSpec:{values:Yt(m)}})}}function Yt(p){return p.source.reduce((n,l)=>{const m=p[l];return m.type.type==="enum"&&(n=n.concat(Object.keys(m.type.values||{}))),n},[])}function $n(p){const n=p.value,l=p.styleSpec,m=l.light,v=p.style;if(n===void 0)return[];if(!o.H(n))return[new o.V("light",n,`object expected, ${o.K(n)} found`)];let w=[];for(const S in n){const C=S.match(/^(.*)-transition$/),A=S.match(/^(.*)-use-theme$/);w=w.concat(A&&m[A[1]]?fi({key:S,value:n[S],valueSpec:{type:"string"},style:v,styleSpec:l}):C&&m[C[1]]&&m[C[1]].transition?fi({key:S,value:n[S],valueSpec:l.transition,style:v,styleSpec:l}):m[S]?fi({key:S,value:n[S],valueSpec:m[S],style:v,styleSpec:l}):[new o.V(S,n[S],`unknown property "${S}"`)])}return w}function as(p){const n=p.value;if(!n)return[];const l=p.key;if(!o.H(n))return[new o.V(l,n,`object expected, ${o.K(n)} found`)];let m=[];const v=p.styleSpec,w=v["light-3d"],S=p.style,C=p.style.lights;for(const D of["type","id"])if(!(D in n))return m=m.concat([new o.V(l,n,`missing property "${D}"`)]),m;if(!o.a0(n.type))return m=m.concat([new o.V(`${l}.type`,n.type,"string expected")]),m;if(C)for(let D=0;D<p.arrayIndex;D++){const F=o.J(n.type),O=C[D];o.J(O.type)===F&&m.push(new o.V(l,n.id,`duplicate light type "${n.type}", previously defined at line ${O.id.__line__}`))}const A=`properties_light_${n.type}`;if(!(A in v))return m=m.concat([new o.V(`${l}.type`,n,`Invalid light type ${n.type}`)]),m;const M=v[A];for(const D in n)if(D==="properties"){const F=n[D];if(!o.H(F))return m=m.concat([new o.V("properties",F,`object expected, ${o.K(F)} found`)]),m;for(const O in F){const q=O.match(/^(.*)-transition$/),Z=O.match(/^(.*)-use-theme$/);m=m.concat(Z&&M[Z[1]]?fi({key:D,value:F[O],valueSpec:{type:"string"},style:S,styleSpec:v}):q&&M[q[1]]&&M[q[1]].transition?fi({key:D,value:n[D],valueSpec:v.transition,style:S,styleSpec:v}):M[O]?fi({key:O,value:F[O],valueSpec:M[O],style:S,styleSpec:v}):[new o.a3(p.key,F[O],`unknown property "${O}"`)])}}else m=m.concat(w[D]?fi({key:D,value:n[D],valueSpec:w[D],style:S,styleSpec:v}):[new o.a3(D,n[D],`unknown property "${D}"`)]);return m}function Ts(p){const n=p.value,l=p.key,m=p.style,v=p.styleSpec,w=v.terrain;if(n==null)return[];if(!o.H(n))return[new o.V("terrain",n,`object expected, ${o.K(n)} found`)];let S=[];for(const C in n){const A=C.match(/^(.*)-transition$/),M=C.match(/^(.*)-use-theme$/);S=S.concat(M&&w[M[1]]?fi({key:C,value:n[C],valueSpec:{type:"string"},style:m,styleSpec:v}):A&&w[A[1]]&&w[A[1]].transition?fi({key:C,value:n[C],valueSpec:v.transition,style:m,styleSpec:v}):w[C]?fi({key:C,value:n[C],valueSpec:w[C],style:m,styleSpec:v}):[new o.a3(C,n[C],`unknown property "${C}"`)])}if(n.source)if(o.a0(n.source)){const C=m.sources&&m.sources[n.source],A=C&&o.J(C.type);C?A!=="raster-dem"&&S.push(new o.V(`${l}.source`,n.source,`terrain cannot be used with a source of type ${A}, it only be used with a "raster-dem" source type`)):S.push(new o.V(`${l}.source`,n.source,`source "${n.source}" not found`))}else S.push(new o.V(`${l}.source`,n.source,"source must be a string"));else S.push(new o.V(l,n,'terrain is missing required property "source"'));return S}function bi(p){const n=p.value,l=p.style,m=p.styleSpec,v=m.fog;if(n===void 0)return[];if(!o.H(n))return[new o.V("fog",n,`object expected, ${o.K(n)} found`)];let w=[];for(const S in n){const C=S.match(/^(.*)-transition$/),A=S.match(/^(.*)-use-theme$/);w=w.concat(A&&v[A[1]]?fi({key:S,value:n[S],valueSpec:{type:"string"},style:l,styleSpec:m}):C&&v[C[1]]&&v[C[1]].transition?fi({key:S,value:n[S],valueSpec:m.transition,style:l,styleSpec:m}):v[S]?fi({key:S,value:n[S],valueSpec:v[S],style:l,styleSpec:m}):[new o.a3(S,n[S],`unknown property "${S}"`)])}return w}const rs={"*":()=>[],array:Ei,boolean:function(p){const n=p.value,l=p.key;return o.$(n)?[]:[new o.V(l,n,`boolean expected, ${o.K(n)} found`)]},number:po,color:function({key:p,value:n}){return o.a0(n)?o.a1.parseCSSColor(n)===null?[new o.V(p,n,`color expected, "${n}" found`)]:[]:[new o.V(p,n,`color expected, ${o.K(n)} found`)]},enum:pr,filter:gr,function:et,layer:to,object:ro,source:jo,model:o.a7,light:$n,"light-3d":as,terrain:Ts,fog:bi,string:Ss,formatted:function(p){return Ss(p).length===0?[]:Et(p)},resolvedImage:function(p){return Ss(p).length===0?[]:Et(p)},projection:function(p){const n=p.value,l=p.styleSpec,m=l.projection,v=p.style;if(o.H(n)){let w=[];for(const S in n)w=w.concat(fi({key:S,value:n[S],valueSpec:m[S],style:v,styleSpec:l}));return w}return o.a0(n)?[]:[new o.V("projection",n,`object or string expected, ${o.K(n)} found`)]},import:function(p){const n=p.key,{value:l,styleSpec:m}=p;if(!o.H(l))return[new o.V(n,l,"import must be an object")];const{data:v,...w}=l;Object.defineProperty(w,"__line__",{value:l.__line__,enumerable:!1});let S=ro(Object.assign({},p,{value:w,valueSpec:m.import}));return o.J(w.id)===""&&S.push(new o.V(`${p.key}.id`,w,"import id can't be an empty string")),v&&(S=S.concat(Ro(v,m,{key:`${p.key}.data`}))),S},iconset:function(p){const n=p.value,l=p.key,m=p.styleSpec,v=p.style;if(!o.H(n))return[new o.V(l,n,"object expected")];if(!n.type)return[new o.V(l,n,'"type" is required')];const w=o.J(n.type);let S=[];if(S=S.concat(ro({key:l,value:n,valueSpec:m[`iconset_${w}`],style:v,styleSpec:m})),function(C,A){return!(C!=="source"||!A.source)}(w,n)){const C=v.sources&&v.sources[n.source],A=C&&o.J(C.type);C?A!=="raster-array"&&S.push(new o.V(l,n.source,`iconset cannot be used with a source of type ${String(A)}, it only be used with a "raster-array" source type`)):S.push(new o.V(l,n.source,`source "${n.source}" not found`))}return S}};function fi(p,n=!1){const l=p.value,m=p.valueSpec,v=p.styleSpec;if(m.expression){if(o.a4(o.J(l)))return et(p);if(o.Q(o.S(l)))return Et(p)}if(m.type&&rs[m.type]){const w=rs[m.type](p);return n===!0&&w.length>0&&Array.isArray(p.value)?Et(p):w}return ro(Object.assign({},p,{valueSpec:m.type?v[m.type]:m}))}function ro(p){const n=p.key,l=p.value,m=p.valueSpec||{},v=p.objectElementValidators||{},w=p.style,S=p.styleSpec;if(!o.H(l))return[new o.V(n,l,`object expected, ${o.K(l)} found`)];let C=[];for(const A in l){const M=A.split(".")[0];let D;v[M]?D=v[M]:m[M]?D=fi:v["*"]?D=v["*"]:m["*"]&&(D=fi),D?C=C.concat(D({key:(n&&`${n}.`)+A,value:l[A],valueSpec:m[M]||m["*"],style:w,styleSpec:S,object:l,objectKey:A},l)):C.push(new o.a3(n,l[A],`unknown property "${A}"`))}for(const A in m){if(v[A])continue;const M=m[A];M.required&&M.default===void 0&&l[A]===void 0&&C.push(new o.V(n,l,`missing required property "${A}"`))}return C}function Cl({key:p,value:n}){const l=Ss({key:p,value:n});if(l.length)return l;const m=n;return m.indexOf("{fontstack}")===-1&&l.push(new o.V(p,n,'"glyphs" url must include a "{fontstack}" token')),m.indexOf("{range}")===-1&&l.push(new o.V(p,n,'"glyphs" url must include a "{range}" token')),l}function Ro(p,n=o.a6,l={}){return ro({key:l.key||"",value:p,valueSpec:Object.assign(n.$root,{"*":{type:"*"}}),styleSpec:n,style:p,objectElementValidators:{glyphs:Cl}})}function Yo(p,n=o.a6){return Be(Ro(p,n))}const qn=p=>Be(jo(p)),Ni=p=>Be($n(p)),ls=p=>Be(as(p)),bo=p=>Be(Ts(p)),xt=p=>Be(bi(p)),wo=p=>Be(function(n){const l=n.value,m=n.style,v=n.styleSpec,w=v.snow;if(l===void 0)return[];if(!o.H(l))return[new o.V("snow",l,`object expected, ${o.K(l)} found`)];let S=[];for(const C in l){const A=C.match(/^(.*)-transition$/);S=S.concat(A&&w[A[1]]&&w[A[1]].transition?fi({key:C,value:l[C],valueSpec:v.transition,style:m,styleSpec:v}):w[C]?fi({key:C,value:l[C],valueSpec:w[C],style:m,styleSpec:v}):[new o.a3(C,l[C],`unknown property "${C}"`)])}return S}(p)),Ea=p=>Be(function(n){const l=n.value,m=n.style,v=n.styleSpec,w=v.rain;if(l===void 0)return[];if(!o.H(l))return[new o.V("rain",l,`object expected, ${o.K(l)} found`)];let S=[];for(const C in l){const A=C.match(/^(.*)-transition$/);S=S.concat(A&&w[A[1]]&&w[A[1]].transition?fi({key:C,value:l[C],valueSpec:v.transition,style:m,styleSpec:v}):w[C]?fi({key:C,value:l[C],valueSpec:w[C],style:m,styleSpec:v}):[new o.a3(C,l[C],`unknown property "${C}"`)])}return S}(p)),Mo=p=>Be(to(p)),ln=p=>Be(gr(p)),Do=p=>Be(gi(p)),qy=p=>Be(Fi(p)),Kf=p=>Be(o.a7(p));function Be(p){return p.slice().sort((n,l)=>n.line&&l.line?n.line-l.line:0)}function te(p,n){let l=!1;if(n&&n.length)for(const m of n)m instanceof o.a3?o.w(m.message):(p.fire(new o.y(new Error(m.message))),l=!0);return l}const ie=o.a6.light;let me;class Pe extends o.E{constructor(n,l="flat"){super(),this._transitionable=new o.a8(me||(me=new o.a9({anchor:new o.aa(ie.anchor),position:new o.ab(ie.position),color:new o.aa(ie.color),intensity:new o.aa(ie.intensity)}))),this.setLight(n,l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,l,m={}){this._validate(Ni,n,m)||(this._transitionable.setTransitionOrValue(n),this.id=l)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,m){return(!m||m.validate!==!1)&&te(this,n.call(Yo,Object.assign({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}const Ie=o.a6.terrain;let Le=class extends o.E{constructor(p,n,l,m,v){super(),this.scope=l,this._transitionable=new o.a8(new o.a9({source:new o.aa(Ie.source),exaggeration:new o.aa(Ie.exaggeration)}),l,m),this._transitionable.setTransitionOrValue(p,m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n,this.worldview=v}get(){return this._transitionable.serialize()}set(p,n){this._transitionable.setTransitionOrValue(p,n)}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}getExaggeration(p){return this._transitioning.possiblyEvaluate(new o.ac(p,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const p=this._transitionable._values.exaggeration;if(!p)return null;const n=p.value.expression;if(!n)return null;let l=-1,m=-1,v=1;for(const w of n.zoomStops)v=n.evaluate(new o.ac(w,{worldview:this.worldview})),v>.01?(l=w,m=-1):m=w;return v<.01&&l>0&&m>l?[l,m]:null}isZoomDependent(){const p=this._transitionable._values.exaggeration;return p!=null&&p.value!=null&&p.value.expression!=null&&p.value.expression instanceof o.ad}};const Je=45,ze=65,Xe=.05;function Dt(p,n,l,m){const v=o.ah(Je,ze,l),[w,S]=Ct(p,m);let C=1-Math.min(1,Math.exp((n-w)/(S-w)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*v*p.alpha}function Ct(p,n){const l=.5/Math.tan(.5*n);return[p.range[0]+l,p.range[1]+l]}function dr(p,n,l,m,v){const w=o.af([],[n,l,m],v.mercatorFogMatrix);return Dt(p,o.ag(w),v.pitch,v._fov)}function Lr(p,n,l,m,v,w,S){const C=[[l,m,0],[v,m,0],[v,w,0],[l,w,0]];let A=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(const D of C){const F=o.af([],D,n),O=o.ag(F);A=Math.min(A,O),M=Math.max(M,O)}return[Dt(p,A,S.pitch,S._fov),Dt(p,M,S.pitch,S._fov)]}const Mr=o.a6.fog;class br extends o.E{constructor(n,l,m,v){super();const w=new o.a9({range:new o.aa(Mr.range),color:new o.aa(Mr.color),"color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.aa(Mr["high-color"]),"high-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.aa(Mr["space-color"]),"space-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.aa(Mr["horizon-blend"]),"star-intensity":new o.aa(Mr["star-intensity"]),"vertical-range":new o.aa(Mr["vertical-range"])});this._transitionable=new o.a8(w,m,new Map(v)),this.set(n,v),this._transitioning=this._transitionable.untransitioned(),this._transform=l,this.properties=new o.ai(w),this.scope=m}get state(){const n=this._transform,l=n.projection.name==="globe",m=o.aj(n.zoom),v=this.properties.get("range"),w=[.5,3];return{range:l?[o.ak(w[0],v[0],m),o.ak(w[1],v[1],m)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,l,m={}){if(this._validate(xt,n,m))return;const v=Object.assign({},n);for(const w of Object.keys(Mr))v[w]===void 0&&(v[w]=Mr[w].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,l)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.ah(Je,ze,n))*l.a}getOpacityAtLatLng(n,l){return this._transform.projection.supportsFog?function(m,v,w){const S=o.ae.fromLngLat(v),C=w.elevation?w.elevation.getAtPointOrZero(S):0;return dr(m,S.x,S.y,C,w)}(this.state,n,l):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const l=this._transform.calculateFogTileMatrix(n.toUnwrapped());return Lr(this.state,l,0,0,o.al,o.al,this._transform)}getOpacityForBounds(n,l,m,v,w){return this._transform.projection.supportsFog?Lr(this.state,n,l,m,v,w,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Ct(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const l=[4,5,6,7];for(const m of l){const v=n.points[m];let w;if(v[2]>=0)w=v;else{const S=n.points[m-4];w=o.am(S,v,S[2]/(S[2]-v[2]))}if(dr(this.state,w[0],w[1],0,this._transform)>=Xe)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,m){return(!m||m.validate!==!1)&&te(this,n.call(Yo,Object.assign({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}let rn,hn,si,Xi,xs=class extends o.E{constructor(p,n,l,m){super();const v=rn||(rn=new o.a9({density:new o.aa(o.a6.snow.density),intensity:new o.aa(o.a6.snow.intensity),color:new o.aa(o.a6.snow.color),opacity:new o.aa(o.a6.snow.opacity),vignette:new o.aa(o.a6.snow.vignette),"vignette-color":new o.aa(o.a6.snow["vignette-color"]),"center-thinning":new o.aa(o.a6.snow["center-thinning"]),direction:new o.aa(o.a6.snow.direction),"flake-size":new o.aa(o.a6.snow["flake-size"])}));this._transitionable=new o.a8(v,l,new Map(m)),this.set(p,m),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(v),this.scope=l}get state(){const p=this.properties.get("opacity"),n=this.properties.get("color"),l=this.properties.get("direction"),m=o.an(l[0]),v=-Math.max(o.an(l[1]),.01),w=[Math.cos(m)*Math.cos(v),Math.sin(m)*Math.cos(v),Math.sin(v)],S=this.properties.get("vignette"),C=this.properties.get("vignette-color");return C.a=S,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(n.r,n.g,n.b,n.a*p),direction:w,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:C}}get(){return this._transitionable.serialize()}set(p,n,l={}){if(this._validate(wo,p,l))return;const m=Object.assign({},p),v=o.a6.snow;for(const w of Object.keys(v))m[w]===void 0&&(m[w]=v[w].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,n,l){return(!l||l.validate!==!1)&&te(this,p.call(Yo,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}},cs=class extends o.E{constructor(p,n,l,m){super();const v=hn||(hn=new o.a9({density:new o.aa(o.a6.rain.density),intensity:new o.aa(o.a6.rain.intensity),color:new o.aa(o.a6.rain.color),opacity:new o.aa(o.a6.rain.opacity),vignette:new o.aa(o.a6.rain.vignette),"vignette-color":new o.aa(o.a6.rain["vignette-color"]),"center-thinning":new o.aa(o.a6.rain["center-thinning"]),direction:new o.aa(o.a6.rain.direction),"droplet-size":new o.aa(o.a6.rain["droplet-size"]),"distortion-strength":new o.aa(o.a6.rain["distortion-strength"])}));this._transitionable=new o.a8(v,l,new Map(m)),this.set(p,m),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(v),this.scope=l}get state(){const p=this.properties.get("opacity"),n=this.properties.get("color"),l=this.properties.get("direction"),m=o.an(l[0]),v=-Math.max(o.an(l[1]),.01),w=[Math.cos(m)*Math.cos(v),Math.sin(m)*Math.cos(v),Math.sin(v)],S=this.properties.get("vignette-color");return S.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(n.r,n.g,n.b,n.a*p),direction:w,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(p,n,l={}){if(this._validate(Ea,p,l))return;const m=Object.assign({},p),v=o.a6.rain;for(const w of Object.keys(v))m[w]===void 0&&(m[w]=v[w].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,n,l){return(!l||l.validate!==!1)&&te(this,p.call(Yo,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}};class ns extends o.E{constructor(n,l,m,v){super(),this.scope=m,this._options=n,this.properties=new o.ai(l),this._transitionable=new o.a8(l,m,new Map(v)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,l){this._options=n,this._transitionable.setTransitionOrValue(n.properties,l)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class ni{constructor(n,l,m){this.screenBounds=n,this.cameraPoint=m.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=l,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(n,l){let m,v;if(n instanceof o.P||typeof n[0]=="number"){const w=o.P.convert(n);m=[w],v=l.isPointAboveHorizon(w)}else{const w=o.P.convert(n[0]),S=o.P.convert(n[1]),C=w.add(S)._div(2);m=[w,S],v=o.aq(w,S).every(A=>l.isPointAboveHorizon(A))&&l.isPointAboveHorizon(C)}return new ni(m,v,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return o.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const l=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],v=o.aq(l,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<m.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?v[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(v[3]=this.cameraPoint)),o.ar(v,n)}bufferedCameraGeometryGlobe(n){const l=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],v=o.aq(l,m,n),w=this.cameraPoint.clone();switch(3*((w.y>l.y)+(w.y>m.y))+((w.x>l.x)+(w.x>m.x))){case 0:v[0]=w,v[4]=w.clone();break;case 1:v.splice(1,0,w);break;case 2:v[1]=w;break;case 3:v.splice(4,0,w);break;case 5:v.splice(2,0,w);break;case 6:v[3]=w;break;case 7:v.splice(3,0,w);break;case 8:v[2]=w}return v}containsTile(n,l,m,v=0){const w=Math.max(n.queryPadding,n.evaluateQueryRenderedFeaturePadding())/l._pixelsPerMercatorPixel+1,S=m?this._bufferedCameraMercator(w,l):this._bufferedScreenMercator(w,l);let C=n.tileID.wrap+(S.unwrapped?v:0);const A=S.polygon.map(se=>o.as(n.tileTransform,se,C));if(!o.at(A,0,0,o.al,o.al))return;C=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const M=this.screenGeometryMercator.polygon.map(se=>o.au(n.tileTransform,se,C)),D=M.map(se=>new o.P(se[0],se[1])),F=l.getFreeCameraOptions().position||new o.ae(0,0,0),O=o.au(n.tileTransform,F,C),q=M.map(se=>{const ne=o.av(se,se,O);return o.aw(ne,ne),new o.ax(O,ne)}),Z=o.ay(n,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:D,tilespaceRays:q,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(Q=o.az(A),Q.min.x=o.aA(Q.min.x,0,o.al),Q.min.y=o.aA(Q.min.y,0,o.al),Q.max.x=o.aA(Q.max.x,0,o.al),Q.max.y=o.aA(Q.max.y,0,o.al),Q),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:Z};var Q}_bufferedScreenMercator(n,l){const m=Gi(n);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let v;return v=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),l):{polygon:this.bufferedScreenGeometry(n).map(w=>l.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[m]=v,v}}_bufferedCameraMercator(n,l){const m=Gi(n);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let v;return v=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),l):{polygon:this.bufferedCameraGeometry(n).map(w=>l.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[m]=v,v}}_projectAndResample(n,l){const m=function(w,S){const C=o.aB([],S.pixelMatrix,S.globeMatrix),A=[0,-o.aD,0,1],M=[0,o.aD,0,1],D=[0,0,0,1];o.aC(A,A,C),o.aC(M,M,C),o.aC(D,D,C);const F=new o.P(A[0]/A[3],A[1]/A[3]),O=new o.P(M[0]/M[3],M[1]/M[3]),q=o.aE(w,F)&&A[3]<D[3],Z=o.aE(w,O)&&M[3]<D[3];if(!q&&!Z)return null;const Q=function(Te,ve,ge){for(let Ce=1;Ce<Te.length;Ce++){const Fe=Ci(ve.pointCoordinate3D(Te[Ce-1]).x),Oe=Ci(ve.pointCoordinate3D(Te[Ce]).x);if(ge<0){if(Fe<Oe)return{idx:Ce,t:-Fe/(Oe-1-Fe)}}else if(Oe<Fe)return{idx:Ce,t:(1-Fe)/(Oe+1-Fe)}}return null}(w,S,q?-1:1);if(!Q)return null;const{idx:se,t:ne}=Q;let ae=se>1?wn(w.slice(0,se),S):[],he=se<w.length?wn(w.slice(se),S):[];ae=ae.map(Te=>new o.P(Ci(Te.x),Te.y)),he=he.map(Te=>new o.P(Ci(Te.x),Te.y));const ce=[...ae];ce.length===0&&ce.push(he[he.length-1]);const we=o.ak(ce[ce.length-1].y,(he.length===0?ae[0]:he[0]).y,ne);let fe;return fe=q?[new o.P(0,we),new o.P(0,0),new o.P(1,0),new o.P(1,we)]:[new o.P(1,we),new o.P(1,1),new o.P(0,1),new o.P(0,we)],ce.push(...fe),he.length===0?ce.push(ae[0]):ce.push(...he),{polygon:ce.map(Te=>new o.ae(Te.x,Te.y)),unwrapped:!1}}(n,l);if(m)return m;const v=function(w,S){let C=!1,A=-1/0,M=0;for(let F=0;F<w.length-1;F++)w[F].x>A&&(A=w[F].x,M=F);for(let F=0;F<w.length-1;F++){const O=(M+F)%(w.length-1),q=w[O],Z=w[O+1];Math.abs(q.x-Z.x)>.5&&(q.x<Z.x?(q.x+=1,O===0&&(w[w.length-1].x+=1)):(Z.x+=1,O+1===w.length-1&&(w[0].x+=1)),C=!0)}const D=o.aF(S.center.lng);return C&&D<Math.abs(D-1)&&w.forEach(F=>{F.x-=1}),{polygon:w,unwrapped:C}}(wn(n,l).map(w=>new o.P(Ci(w.x),w.y)),l);return{polygon:v.polygon.map(w=>new o.ae(w.x,w.y)),unwrapped:v.unwrapped}}}function wn(p,n){return o.aG(p,l=>{const m=n.pointCoordinate3D(l);l.x=m.x,l.y=m.y},1/256)}function Ci(p){return p<0?1+p%1:p%1}function Gi(p){return 100*p|0}function li(p,n,l,m,v){const w=function(C,A){if(C)return v(C);if(A){if(p.url&&A.tiles&&p.tiles&&delete p.tiles,A.variants){if(!Array.isArray(A.variants))return v(new Error("variants must be an array"));for(const D of A.variants){if(D==null||typeof D!="object"||D.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(D.capabilities))return v(new Error("capabilities must be an array"));if(D.capabilities.length===1&&D.capabilities[0]==="meshopt"){A=Object.assign(A,D);break}}}const M=o.aH(Object.assign({},A,p),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);M.tiles=n.canonicalizeTileset(M,p.url),v(null,M)}},S=function(C,A,M){if(!C)return null;if(!A&&!M)return C;M=M||C.worldview_default;const D=Object.values(C.language||{});if(D.length===0)return null;const F=Object.values(C.worldview||{});if(F.length===0)return null;const O=D.every(Z=>Z===A),q=F.every(Z=>Z===M);return O&&q?C:A in(C.language_options||{})||M in(C.worldview_options||{})?null:C.language_options&&C.worldview_options?C:null}(p.data,l,m);return S?o.o.frame(()=>w(null,S)):p.url?o.m(n.transformRequest(n.normalizeSourceURL(p.url,null,l,m),o.R.Source),w):o.o.frame(()=>{const{data:C,...A}=p;w(null,A)})}function Ai(p,n){const l=Math.pow(2,n.z),m=Math.floor(o.aF(p.getWest())*l),v=Math.floor(o.aJ(p.getNorth())*l),w=Math.ceil(o.aF(p.getEast())*l),S=Math.ceil(o.aJ(p.getSouth())*l);return n.x>=m&&n.x<w&&n.y>=v&&n.y<S}class ks{constructor(n,l,m){this.bounds=n?o.aI.convert(this.validateBounds(n)):null,this.minzoom=l||0,this.maxzoom=m||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}addExtraBounds(n){if(n){this.extraBounds||(this.extraBounds=[]);for(const l of n)this.extraBounds.push(o.aI.convert(this.validateBounds(l)))}}contains(n){if(n.z>this.maxzoom||n.z<this.minzoom||this.bounds&&!Ai(this.bounds,n))return!1;if(!this.extraBounds)return!0;for(const l of this.extraBounds)if(Ai(l,n))return!0;return!1}static fromTileJSON(n){if(!n.bounds&&!n.extra_bounds)return null;const l=new ks(n.bounds,n.minzoom,n.maxzoom);return l.addExtraBounds(n.extra_bounds),l}}class No extends o.E{constructor(n,l,m,v){if(super(),this.id=n,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,o.aH(l,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},l),this._collectResourceTiming=!!l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new o.aK}load(n){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map.getWorldview();this._tileJSONRequest=li(this._options,this.map._requestManager,l,m,(v,w)=>{if(this._tileJSONRequest=null,this._loaded=!0,v)l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),m&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new o.y(v));else if(w){if(Object.assign(this,w),this.hasWorldviews=!!w.worldview_options,w.worldview_default&&(this.worldviewDefault=w.worldview_default),w.vector_layers){this.vectorLayers=w.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const S of w.vector_layers)this.vectorLayerIds.push(S.id),w.worldview&&w.worldview[S.source]&&this.localizableLayerIds.add(S.id)}this.tileBounds=ks.fromTileJSON(w),Tt(w.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}n&&n(v)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(n,l){const m=n.tileID.canonical.url(this.tiles,this.scheme),v=this.map._requestManager.normalizeTileURL(m),w=this.map._requestManager.transformRequest(v,o.R.Tile),S=this.map.style?this.map.style.getLut(this.scope):null,C=S?{image:S.image.clone()}:null,A={request:w,data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,lut:C,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&o.h(m)&&(A.localizableLayerIds=this.localizableLayerIds),A.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=l:n.request=n.actor.send("reloadTile",A,M.bind(this));else if(n.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",A,M.bind(this),void 0,!0);else{const D=o.aL.call({deduped:this._deduped},A,(F,O)=>{if(F||!O)M.call(this,F);else{const q=o.aM(O.responseHeaders);A.data={cacheControl:q.cacheControl,expires:q.expires,rawData:O.rawData.slice(0)},n.actor&&n.actor.send("loadTile",A,M.bind(this),void 0,!0)}},!0);n.request={cancel:D}}function M(D,F){return delete n.request,n.aborted?l(null):D&&D.status!==404?l(D):(F&&F.resourceTiming&&(n.resourceTiming=F.resourceTiming),this.map._refreshExpiredTiles&&F&&n.setExpiryData(F),n.loadVectorData(F,this.map.painter),o.aN(this.dispatcher),l(null,F),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,l){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Qa extends o.E{constructor(n,l,m,v){super(),this.id=n,this.dispatcher=m,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},l),Object.assign(this,o.aH(l,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const l=this.map.getWorldview();this._tileJSONRequest=li(this._options,this.map._requestManager,null,l,(m,v)=>{this._tileJSONRequest=null,this._loaded=!0,m?this.fire(new o.y(m)):v&&(Object.assign(this,v),v.raster_layers&&(this.rasterLayers=v.raster_layers,this.rasterLayerIds=this.rasterLayers.map(w=>w.id)),this.tileBounds=ks.fromTileJSON(v),Tt(v.tiles),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),n&&n(m)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,l){const m=o.o.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);n.request=o.n(this.map._requestManager.transformRequest(v,o.R.Tile),(w,S,C)=>{if(delete n.request,n.aborted)return n.state="unloaded",l(null);if(w)return n.state="errored",l(w);if(!S)return l(null);const A=o.aM(C);this.map._refreshExpiredTiles&&n.setExpiryData(A),n.setTexture(S,this.map.painter),n.state="loaded",o.aN(this.dispatcher),l(null)})}abortTile(n,l){n.request&&(n.request.cancel(),delete n.request),l&&l()}unloadTile(n,l){n.texture&&n.texture instanceof o.T?(n.destroy(!0),n.texture&&n.texture instanceof o.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),l&&l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Ju([p,n],l,m,{scaled:v=!0}={}){const{tileSize:w,buffer:S}=m,{x:C,y:A,z:M}=l;if(!isFinite(C)||!isFinite(A)||!isFinite(M))throw new Error("Invalid MRT header");const D=2**M,F=D*o.aF(p),O=D*o.aJ(n);return function([q,Z],Q,{scaled:se=!0}={}){if(!Q)throw new Error("bandView is undefined");const{data:ne,tileSize:ae,buffer:he,offset:ce,scale:we,dimension:fe}=Q;if(q<-he||q>ae+he||Z<-he||Z>ae+he)throw new Error(`Point (${q}, ${Z}) out of bounds for tileSize=${ae}, buffer=${he}`);const Te=(Z+he)*(ae+2*he)+(q+he);if(new Uint32Array(ne.buffer)[Te]===4294967295)return null;let ve=[];ve=se?[]:new Q.data.constructor(fe);for(let ge=0;ge<fe;ge++)ve[ge]=Math.round(1e12*(ne[fe*Te+ge]*we+ce))/1e12;return ve}([Math.min(Math.max(-S,Math.floor((F-C)*w)),w-1+S),Math.min(Math.max(-S,Math.floor((O-A)*w)),w-1+S)],m,{scaled:v})}class Ls extends Qa{constructor(n,l,m,v){super(n,l,m,v),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},l)}triggerRepaint(n){const l=this.map.painter._terrain,m=this.map.style.getSourceCache(this.id);l&&l.enabled&&m&&l._clearRenderCacheForTile(m.id,n.tileID),this.map.triggerRepaint()}loadTile(n,l){const m=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(m,o.R.Tile),w={request:v,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};n.source=this.id,n.scope=this.scope,n.requestParams=v,n.actor||(n.actor=this.dispatcher.getActor());const S=(C,A,M)=>{if(delete n.request,n.aborted)return n.state="unloaded",l(null);if(C)return C.name==="AbortError"?void 0:(n.state="errored",l(C));if(this.map._refreshExpiredTiles&&A){const D=o.aM(M);n.setExpiryData(D)}if(this.partial&&n.state!=="expired")n.state="empty";else if(!this.partial){if(!A)return l(null);n.state="loaded",n._isHeaderLoaded=!0,n._mrt=A}l(null)};n.request=this.partial?n.fetchHeader(void 0,S.bind(this)):n.actor.send("loadTile",w,S.bind(this),void 0,!0)}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,l){const m=n.texturePerLayer;if(n.flushAllQueues(),m.size){n.destroy(!0);for(const v of m.values())this.map.painter.saveTileTexture(v)}else n.destroy()}prepareTile(n,l,m,v){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBandForRender(l,m,v,(w,S)=>{if(w)return n.state="errored",this.fire(new o.y(w)),void this.triggerRepaint(n);S&&(n._isHeaderLoaded=!0,n.setTexturePerLayer(m,S,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;const l=this.rasterLayers.find(({id:w})=>w===n),m=l&&l.fields,v=m&&m.bands&&m.bands;return v?v[0]:0}getTextureDescriptor(n,l,m){if(!n)return;const v=l.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let w=null;l instanceof o.aQ?w=l.paint.get("raster-array-band"):l instanceof o.aR&&(w=l.paint.get("raster-particle-array-band"));const S=w||this.getInitialBand(v);if(S==null)return;if(!n.textureDescriptorPerLayer.get(l.id))return void this.prepareTile(n,v,l.id,S);if(n.updateNeeded(l.id,S)&&!m)return;const C=n.textureDescriptorPerLayer.get(l.id);return Object.assign({},C,{texture:n.texturePerLayer.get(l.id)})}getImages(n,l){const m=new Map;for(const v of n)for(const w of l){const[S,C]=w.split("/"),A=v.getLayer(S);if(!A||!A.hasBand(C)||!A.hasDataForBand(C))continue;const{bytes:M,tileSize:D,buffer:F}=A.getBandView(C),O=D+2*F,q={data:new o.q({width:O,height:O},M),pixelRatio:2,sdf:!1,usvg:!1,version:0};m.set(w,q)}return m}queryRasterArrayValueByBandId(n,l,m){const v=l._mrt;return new Promise(w=>{const S={},C=new Set;for(const[A,M]of Object.entries(v.layers)){if(m.layerName&&A!==m.layerName)continue;const D={};S[A]=D;for(const{bands:F}of M.dataIndex)for(const O of F)m.bands&&!m.bands.includes(O)||(C.add(o.B(A,O)),l.fetchBand(A,null,O,q=>{o.o.frame(()=>{D[O]=q?null:Ju([n.lng,n.lat],v,M.getBandView(O)),C.delete(o.B(A,O)),C.size===0&&w(S)})},!1))}C.size===0&&w(S)})}_loadTileForQuery(n,l){if(this._loadTileLoaded[n.uid])return void l(null,n._mrt);if(this._loadTilePending[n.uid])return void this._loadTilePending[n.uid].push(l);this._loadTilePending[n.uid]=[l];const m=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(m,o.R.Tile);n.actor.send("loadTile",{request:v,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(w,S,C)=>{if(w)return this._loadTilePending[n.uid].forEach(A=>A(w,null)),void delete this._loadTilePending[n.uid];if(!S)return this._loadTilePending[n.uid].forEach(A=>A(null,null)),void delete this._loadTilePending[n.uid];if(this.map._refreshExpiredTiles&&S){const A=o.aM(C);n.setExpiryData(A)}n._mrt=S,n._isHeaderLoaded=!0,n.state="loaded",this._loadTilePending[n.uid].forEach(A=>A(null,S)),this._loadTileLoaded[n.uid]=!0,delete this._loadTilePending[n.uid]},void 0,!0)}queryRasterArrayValueByAllBands(n,l,m){return new Promise((v,w)=>{this._loadTileForQuery(l,(S,C)=>{S?w(S):v(C?this.queryRasterArrayValueByBandId(n,l,m):null)})})}queryRasterArrayValue(n,l){const m=o.aS.convert(n),v=this.findLoadedParent(m);return v&&v._mrt?l.bands||!this.partial?this.queryRasterArrayValueByBandId(m,v,l):this.queryRasterArrayValueByAllBands(m,v,l):Promise.resolve(null)}findLoadedParent(n){const l=o.ae.fromLngLat(n,this.map.transform.tileSize),m=this.maxzoom+1,v=1<<m,w=Math.floor(l.x),S=Math.floor((l.x-w)*v),C=Math.floor(l.y*v),A=this.map.style.getSourceCache(this.id),M=new o.aP(m,w,m,S,C);return A.findLoadedParent(M,this.minzoom)}}const el={vector:No,raster:Qa,"raster-dem":class extends Qa{constructor(p,n,l,m){super(p,n,l,m),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(p,n){const l=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(v,w){v&&(p.state="errored",n(v)),w&&(p.dem=w,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",n(null))}p.request=o.n(this.map._requestManager.transformRequest(l,o.R.Tile),(function(v,w,S){if(delete p.request,p.aborted)p.state="unloaded",n(null);else if(v)p.state="errored",n(v);else if(w){const C=o.aM(S);this.map._refreshExpiredTiles&&p.setExpiryData(C);const A=ImageBitmap&&w instanceof ImageBitmap&&o.r(),M=1-(w.width-o.aO(w.width))/2;M<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const D=A?w:o.o.getImageData(w,M),F={uid:p.uid,tileID:p.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:D,encoding:this.encoding,padding:M};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadTile",F,m.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(p){const n=p.canonical,l=Math.pow(2,n.z),m=(n.x-1+l)%l,v=n.x===0?p.wrap-1:p.wrap,w=(n.x+1+l)%l,S=n.x+1===l?p.wrap+1:p.wrap,C={};return C[new o.aP(p.overscaledZ,v,n.z,m,n.y).key]={backfilled:!1},C[new o.aP(p.overscaledZ,S,n.z,w,n.y).key]={backfilled:!1},n.y>0&&(C[new o.aP(p.overscaledZ,v,n.z,m,n.y-1).key]={backfilled:!1},C[new o.aP(p.overscaledZ,p.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},C[new o.aP(p.overscaledZ,S,n.z,w,n.y-1).key]={backfilled:!1}),n.y+1<l&&(C[new o.aP(p.overscaledZ,v,n.z,m,n.y+1).key]={backfilled:!1},C[new o.aP(p.overscaledZ,p.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},C[new o.aP(p.overscaledZ,S,n.z,w,n.y+1).key]={backfilled:!1}),C}},"raster-array":Ls,geojson:class extends o.E{constructor(p,n,l,m){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(m),this._data=n.data,this._options=Object.assign({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const v=o.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*v,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*v,extent:o.al,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:o.al,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*v,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}updateData(p){if(!this._options.dynamic)return this.fire(new o.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof p!="string"&&(p.type==="Feature"&&(p={type:"FeatureCollection",features:[p]}),p.type!=="FeatureCollection"))return this.fire(new o.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof p!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const n=new Map;for(const l of this._data.features)n.set(l.id,l);for(const l of p.features)n.set(l.id,l);this._data.features=[...n.values()]}else this._data=p;return this._updateWorkerData(!0),this}getClusterExpansionZoom(p,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id,scope:this.scope},n),this}getClusterChildren(p,n){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id,scope:this.scope},n),this}getClusterLeaves(p,n,l,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:p,limit:n,offset:l},m),this}_updateWorkerData(p=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.z("dataloading",{dataType:"source"})),this._loaded=!1;const n=Object.assign({append:p},this.workerOptions);n.scope=this.scope;const l=this._data;typeof l=="string"?(n.request=this.map._requestManager.transformRequest(o.o.resolveURL(l),o.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,(m,v)=>{if(this._loaded=!0,this._pendingLoad=null,m)this.fire(new o.y(m));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(w.resourceTiming=v.resourceTiming[this.id]),p&&(this._partialReload=!0),this.fire(new o.z("data",w)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(p),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const p=o.B(this.id,this.scope);this.map.style.clearSource(p),this._updateWorkerData()}loadTile(p,n){const l=p.actor?"reloadTile":"loadTile";p.actor=this.actor;const m=this.map.style?this.map.style.getLut(this.scope):null,v=m?{image:m.image.clone()}:null,w=this._partialReload,S={type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:v,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:p.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:w,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};p.request=this.actor.send(l,S,(C,A)=>w&&!A?(p.state="loaded",n(null)):(delete p.request,p.destroy(),p.aborted?n(null):C?n(C):(p.loadVectorData(A,this.map.painter,l==="reloadTile"),n(null))),void 0,l==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p,n){this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id,scope:this.scope}),p.destroy()}onRemove(p){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aT{constructor(p,n,l,m){super(p,n,l,m),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const n of p.urls)this.urls.push(this.map._requestManager.transformRequest(n,o.R.Source).url);o.aU(this.urls,(n,l)=>{this._loaded=!0,n?this.fire(new o.y(n)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const n=this.video.seekable;p<n.start(0)||p>n.end(0)?this.fire(new o.y(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,n=p.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(p,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aT,model:o.aW,"batched-model":class extends o.E{constructor(p,n,l,m){super(),this.type="batched-model",this.id=p,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=l,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(m)}onAdd(p){this.map=p,this.load()}reload(){this.cancelTileJSONRequest();const p=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(p))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(p){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map.getWorldview();this._tileJSONRequest=li(this._options,this.map._requestManager,n,l,(m,v)=>{this._tileJSONRequest=null,this._loaded=!0,m?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),l&&l.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new o.y(m))):v&&(Object.assign(this,v),v.bounds&&(this.tileBounds=new ks(v.bounds,this.minzoom,this.maxzoom)),Tt(v.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),p&&p(m)})}hasTransition(){return!1}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}loaded(){return this._loaded}loadTile(p,n){const l=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(l,o.R.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:p.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:o.o.devicePixelRatio,promoteId:this.promoteId};if(p.actor&&p.state!=="expired")if(p.state==="loading")p.reloadCallback=n;else{if(p.buckets){const w=Object.values(p.buckets);for(const S of w)S.dirty=!0;return void(p.state="loaded")}p.request=p.actor.send("reloadTile",m,v.bind(this))}else p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",m,v.bind(this),void 0,!0);function v(w,S){return p.aborted?n(null):w&&w.status!==404?n(w):(this.map._refreshExpiredTiles&&S&&p.setExpiryData(S),p.loadModelData(S,this.map.painter),p.state="loaded",void n(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends o.aT{constructor(p,n,l,m){super(p,n,l,m),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(w=>typeof w!="number"))||this.fire(new o.y(new o.V(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.y(new o.V(`sources.${p}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new o.y(new o.V(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new o.y(new o.V(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.y(new o.V(`sources.${p}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(p){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!p&&!this._playing||this.texture instanceof o.aV||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends o.E{constructor(p,n,l,m){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=n,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ks(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,o.aH(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this.map=p,this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:n,y:l,z:m}=p.canonical;return this._implementation.hasTile({x:n,y:l,z:m})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,n){const{x:l,y:m,z:v}=p.tileID.canonical,w=new AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:l,y:m,z:v},{signal:w.signal})).then((function(S){return delete p.request,p.aborted?(p.state="unloaded",n(null)):S===void 0?(p.state="errored",n(null)):S===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",n(null)):function(C){return C instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof ImageBitmap||C instanceof HTMLImageElement}(S)?(this.loadTileData(p,S),p.state="loaded",void n(null)):(p.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.name!=="AbortError"&&(p.state="errored",n(S))}),p.request.cancel=()=>w.abort()}loadTileData(p,n){p.setTexture(n,this.map.painter)}unloadTile(p,n){if(p.texture&&p.texture instanceof o.T?(p.destroy(!0),p.texture&&p.texture instanceof o.T&&this.map.painter.saveTileTexture(p.texture)):p.destroy(),this._implementation.unloadTile){const{x:l,y:m,z:v}=p.tileID.canonical;this._implementation.unloadTile({x:l,y:m,z:v})}n&&n()}abortTile(p,n){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),n&&n()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){const p=o.B(this.id,this.scope);this.map.style.clearSource(p)}_update(){this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}}},qo=function(p,n,l,m){const v=new el[n.type](p,n,l,m);if(v.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${v.id}`);return o.aX(["load","abort","unload","serialize","prepare"],v),v};function Al(p,n,l=""){return`${l}:${n.id||""}:${n.layer.id}:${function(m){if("layerId"in m)return`layer:${m.layerId}`;{const{featuresetId:v,importId:w}=m;return`featureset:${v}${w?`:import:${w}`:""}`}}(p.target)}`}function da(p,n,l,m=""){if(p.uniqueFeatureID){const v=Al(p,n,m);if(l.has(v))return!0;l.add(v)}return!1}function ha(p,n,l,m,v=!1){const w=n.sourceCache.transform,S=n.sourceCache.tilesIn(p,n.has3DLayers,v);S.sort(Jf);const C=[];for(const A of S){const M=A.tile.queryRenderedFeatures(n,A,l,m,w,v);Object.keys(M).length&&C.push({wrappedTileID:A.tile.tileID.wrapped().key,queryResults:M})}for(const A in n.layers){const M=n.layers[A];if(M.styleLayer){const D=M.styleLayer.queryRenderedFeatures(p,n.sourceCache,m);Object.keys(D).length&&C.push({wrappedTileID:0,queryResults:D})}}return C.length===0?{}:function(A){const M={},D={};for(const F of A){const O=F.queryResults,q=F.wrappedTileID,Z=D[q]=D[q]||{};for(const Q in O){const se=O[Q],ne=Z[Q]=Z[Q]||{},ae=M[Q]=M[Q]||[];for(const he of se)ne[he.featureIndex]||(ne[he.featureIndex]=!0,ae.push(he))}}return M}(C)}function Um(p,n,l,m,v,w){const S={},C=m.queryRenderedSymbols(p),A=[];for(const M of Object.keys(C).map(Number))A.push(v[M]);A.sort(Jf);for(const M of A){const D=M.featureIndex.lookupSymbolFeatures(C[M.bucketInstanceId],M.bucketIndex,M.sourceLayerIndex,n,l,w);for(const F in D){const O=S[F]=S[F]||[],q=D[F];q.sort((Z,Q)=>{const se=M.featureSortOrder;if(se){const ne=se.indexOf(Z.featureIndex);return se.indexOf(Q.featureIndex)-ne}return Q.featureIndex-Z.featureIndex});for(const Z of q)O.push(Z)}}return S}function Yf(p,n){const l=p.getRenderableIds().map(w=>p.getTileByID(w)),m=[],v={};for(let w=0;w<l.length;w++){const S=l[w],C=S.tileID.canonical.key;v[C]||(v[C]=!0,S.querySourceFeatures(m,n))}return m}function Jf(p,n){const l=p.tileID,m=n.tileID;return l.overscaledZ-m.overscaledZ||l.canonical.y-m.canonical.y||l.wrap-m.wrap||l.canonical.x-m.canonical.x}function Qf(p,n){const l={};if(!n)return l;for(const m of p){const v=m.layerIds.map(w=>n.getLayer(w)).filter(Boolean);if(v.length!==0){m.layers=v,m.stateDependentLayerIds&&(m.stateDependentLayers=m.stateDependentLayerIds.map(w=>v.filter(S=>S.id===w)[0]));for(const w of v)l[w.fqid]=m}}return l}const Jo=32,Il=33,Go=new Uint16Array(8184);for(let p=0;p<2046;p++){let n=p+2,l=0,m=0,v=0,w=0,S=0,C=0;for(1&n?v=w=S=Jo:l=m=C=Jo;(n>>=1)>1;){const M=l+v>>1,D=m+w>>1;1&n?(v=l,w=m,l=S,m=C):(l=v,m=w,v=S,w=C),S=M,C=D}const A=4*p;Go[A+0]=l,Go[A+1]=m,Go[A+2]=v,Go[A+3]=w}const Ca=new Uint16Array(2178),_c=new Uint8Array(1089),Qu=new Uint16Array(1089);function $m(p){return p===0?-.03125:p===32?.03125:0}const qm={type:2,extent:o.al,loadGeometry:()=>[[new o.P(0,0),new o.P(o.al+1,0),new o.P(o.al+1,o.al+1),new o.P(0,o.al+1),new o.P(0,0)]]};class Xl{constructor(n,l,m,v,w,S){this.tileID=n,this.uid=o.b1(),this.uses=0,this.tileSize=l,this.tileZoom=m,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=w,v&&v.style&&(this._lastUpdatedBrightness=v.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",v&&v.transform&&(this.projection=v.transform.projection),this.worldview=S,this._hasAppearances=null}registerFadeDuration(n){const l=n+this.timeAdded;l<o.o.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aY(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,l,m){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=Qf(n.buckets,l.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const w=this.buckets[v];if(w instanceof o.b3){if(this.hasSymbolBuckets=!0,!m)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const w=this.buckets[v];if(w instanceof o.b3&&w.hasRTLText){this.hasRTLText=!0,o.b4();break}}this.queryPadding=0;for(const v in this.buckets){const w=this.buckets[v],S=l.style.getOwnLayer(v);if(!S)continue;const C=S.queryRadius(w);this.queryPadding=Math.max(this.queryPadding,C)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new o.b2}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(n,l,m){n&&(n.resourceTiming&&(this.resourceTiming=n.resourceTiming),this.buckets=Object.assign({},this.buckets,Qf(n.buckets,l.style)),n.featureIndex&&(this.latestFeatureIndex=n.featureIndex))}getBucket(n){return this.buckets[n.fqid]}upload(n,l){for(const w in this.buckets){const S=this.buckets[w];if(S.uploadPending()){let C={},A=[],M={zoom:0,pitch:0,brightness:0,worldview:""};if(l){if(l.style){A=l.style.listImages();const D=S.layers[0],F=D.sourceLayer||"_geojsonTileLayer",O=l.style.getLayerSourceCache(D);O&&(C=O._state.getState(F,void 0))}M={zoom:l.transform.zoom||0,pitch:l.transform.pitch||0,brightness:l.style.getBrightness()||0,worldview:l.worldview||""}}S.upload(n,this.tileID.canonical,C,A,M)}}const m=n.gl,v=this.imageAtlas;v&&!v.uploaded&&(this.imageAtlasTexture=new o.T(n,v.image,m.RGBA8,{useMipmap:!!v.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(n,this.glyphAtlasImage,m.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(n,this.lineAtlas.image,m.R8),this.lineAtlas.uploaded=!0)}prepare(n,l,m){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,m),!l||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const v=l.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(l)),(this._lastUpdatedBrightness||v||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&v&&Math.abs(this._lastUpdatedBrightness-v)<.001||(this.updateBuckets(l,this._lastUpdatedBrightness!==v),this._lastUpdatedBrightness=v))}evaluateQueryRenderedFeaturePadding(){let n=0;for(const l in this.buckets){const m=this.buckets[l];m.evaluateQueryRenderedFeaturePadding&&(n=Math.max(n,m.evaluateQueryRenderedFeaturePadding()))}return n}queryRenderedFeatures(n,l,m,v,w,S){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const C=this.evaluateQueryRenderedFeaturePadding(),A=function(M,D){const F=o.bp([],[.5*M.width,.5*-M.height,1]);return o.bq(F,F,[1,-1,0]),o.aB(F,F,M.calculateProjMatrix(D.toUnwrapped())),Float32Array.from(F)}(w,this.tileID);return this.latestFeatureIndex.query(n,{tilespaceGeometry:l,pixelPosMatrix:A,transform:v,availableImages:m,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:C})}querySourceFeatures(n,l){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const v=m.loadVTLayers(),w=l?l.sourceLayer:"",S=v._geojsonTileLayer||v[w];if(!S)return;const C=o.b5(l&&l.filter),{z:A,x:M,y:D}=this.tileID.canonical,F={z:A,x:M,y:D};for(let O=0;O<S.length;O++){const q=S.feature(O);if(C.needGeometry){const se=o.b6(q,!0);if(!C.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),se,this.tileID.canonical))continue}else if(!C.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),q))continue;const Z=m.getId(q,w),Q=new o.b7(q,A,M,D,Z);Q.tile=F,n.push(Q)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(n){const l=this.expirationTime;if(n.cacheControl){const m=o.b8(n.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const m=Date.now();let v=!1;if(this.expirationTime>m)v=!1;else if(l)if(this.expirationTime<l)v=!0;else{const w=this.expirationTime-l;w?this.expirationTime=m+Math.max(w,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(n){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&n&&this.updateBuckets(n)}hasAppearances(n){for(const l in this.buckets)if(n.style.hasLayer(l)&&this.buckets[l].layers.some(m=>m.appearances&&m.appearances.length>0))return!0;return!1}updateBuckets(n,l){if(!this.latestFeatureIndex||!n.style)return;const m=this.latestFeatureIndex.loadVTLayers(),v=n.style.listImages(),w=n.style.getBrightness();for(const S in this.buckets){if(!n.style.hasLayer(S))continue;const C=this.buckets[S],A=C.layers[0],M=A.sourceLayer||"_geojsonTileLayer",D=m[M],F=n.style.getLayerSourceCache(A);let O={};F&&(O=F._state.getState(M,void 0));const q=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Z=Object.keys(O).length>0&&!l;if(C.hasAppearances=C.layers.some(se=>se.appearances&&se.appearances.length>0),(Z&&C.stateDependentLayers.length!==0||l)&&C.update(O,D,v,q,Z?C.stateDependentLayers:C.layers,l,w),Z&&C.stateDependentLayers.length!==0||l||C.hasAppearances){const se={zoom:n.transform.zoom,pitch:n.transform.pitch,brightness:n.style.getBrightness()||0,worldview:n.worldview};C.updateAppearances(this.tileID.canonical,O,v,se)}(C instanceof o.b9||C instanceof o.ba)&&n._terrain&&n._terrain.enabled&&F&&C.uploadPending()&&n._terrain._clearRenderCacheForTile(F.id,this.tileID);const Q=n&&n.style&&n.style.getOwnLayer(S);Q&&(this.queryPadding=Math.max(this.queryPadding,Q.queryRadius(C)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=o.o.now()+n}setTexture(n,l){const m=l.context,v=m.gl;this.texture=this.texture||l.getTileTexture(n.width),this.texture&&this.texture instanceof o.T?this.texture.update(n):(this.texture=new o.T(m,n,v.RGBA8,{useMipmap:!0}),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE))}setDependencies(n,l){const m={};for(const v of l)m[v]=!0;this.dependencies[n]=m}hasDependency(n,l){for(const m of n){const v=this.dependencies[m];if(v){for(const w of l)if(v[w])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;const m=o.bb(qm,this.tileID.canonical,this.tileTransform)[0],v=new o.bc,w=new o.bd;for(let S=0;S<m.length;S++){const{x:C,y:A}=m[S];v.emplaceBack(C,A),w.emplaceBack(S)}w.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(w),this._tileDebugBuffer=n.createVertexBuffer(v,o.be.members),this._tileDebugSegments=o.bf.simpleSegment(0,0,v.length,w.length)}_makeTileBoundsBuffers(n,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;const m=o.bb(qm,this.tileID.canonical,this.tileTransform)[0];let v,w;if(this.isRaster){const S=function(C,A){const M=o.aY(C,A),D=Math.pow(2,C.z);for(let se=0;se<Il;se++)for(let ne=0;ne<Il;ne++){const ae=o.aZ((C.x+(ne+$m(ne))/Jo)/D),he=o.a_((C.y+(se+$m(se))/Jo)/D),ce=A.project(ae,he),we=se*Il+ne;Ca[2*we+0]=Math.round((ce.x*M.scale-M.x)*o.al),Ca[2*we+1]=Math.round((ce.y*M.scale-M.y)*o.al)}_c.fill(0),Qu.fill(0);for(let se=2045;se>=0;se--){const ne=4*se,ae=Go[ne+0],he=Go[ne+1],ce=Go[ne+2],we=Go[ne+3],fe=ae+ce>>1,Te=he+we>>1,ve=fe+Te-he,ge=Te+ae-fe,Ce=he*Il+ae,Fe=we*Il+ce,Oe=Te*Il+fe,st=Math.hypot((Ca[2*Ce+0]+Ca[2*Fe+0])/2-Ca[2*Oe+0],(Ca[2*Ce+1]+Ca[2*Fe+1])/2-Ca[2*Oe+1])>=16;_c[Oe]=_c[Oe]||(st?1:0),se<1022&&(_c[Oe]=_c[Oe]||_c[(he+ge>>1)*Il+(ae+ve>>1)]||_c[(we+ge>>1)*Il+(ce+ve>>1)])}const F=new o.a$,O=new o.b0;let q=0;function Z(se,ne){const ae=ne*Il+se;return Qu[ae]===0&&(F.emplaceBack(Ca[2*ae+0],Ca[2*ae+1],se*o.al/Jo,ne*o.al/Jo),Qu[ae]=++q),Qu[ae]-1}function Q(se,ne,ae,he,ce,we){const fe=se+ae>>1,Te=ne+he>>1;if(Math.abs(se-ce)+Math.abs(ne-we)>1&&_c[Te*Il+fe])Q(ce,we,se,ne,fe,Te),Q(ae,he,ce,we,fe,Te);else{const ve=Z(se,ne),ge=Z(ae,he),Ce=Z(ce,we);O.emplaceBack(ve,ge,Ce)}}return Q(0,0,Jo,Jo,Jo,0),Q(Jo,Jo,0,0,0,Jo),{vertices:F,indices:O}}(this.tileID.canonical,l);v=S.vertices,w=S.indices}else{v=new o.a$,w=new o.b0;for(const{x:C,y:A}of m)v.emplaceBack(C,A,0,0);const S=o.bg(v.int16.subarray(0,4*v.length),void 0,4);for(let C=0;C<S.length;C+=3)w.emplaceBack(S[C],S[C+1],S[C+2])}this._tileBoundsBuffer=n.createVertexBuffer(v,o.bh.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(w),this._tileBoundsSegments=o.bf.simpleSegment(0,0,v.length,w.length)}_makeGlobeTileDebugBuffers(n,l){const m=l.projection;if(!m||m.name!=="globe"||l.freezeTileCoverage)return;const v=this.tileID.canonical,w=o.bi(v,l),S=o.bj(w),C=o.aj(l.zoom);let A;C>0&&(A=o.bk(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,v,l,S,A,C),this._makeGlobeTileDebugTextBuffer(n,v,l,S,A,C)}_globePoint(n,l,m,v,w,S,C){let A=o.bl(n,l,m);if(S){const M=1<<m.z,D=o.aF(v.center.lng),F=o.aJ(v.center.lat),O=(m.x+.5)/M-D;let q=0;O>.5?q=-1:O<-.5&&(q=1);let Z=(n/o.al+m.x)/M+q,Q=(l/o.al+m.y)/M;Z=(Z-D)*v._pixelsPerMercatorPixel+D,Q=(Q-F)*v._pixelsPerMercatorPixel+F;const se=[Z*v.worldSize,Q*v.worldSize,0];o.af(se,se,S),A=o.bm(A,se,C)}return o.af(A,A,w)}_makeGlobeTileDebugBorderBuffer(n,l,m,v,w,S){const C=new o.bc,A=new o.bd,M=new o.bn,D=(O,q,Z,Q,se)=>{const ne=(Z-O)/(se-1),ae=(Q-q)/(se-1),he=C.length;for(let ce=0;ce<se;ce++){const we=O+ce*ne,fe=q+ce*ae;C.emplaceBack(we,fe);const Te=this._globePoint(we,fe,l,m,v,w,S);M.emplaceBack(Te[0],Te[1],Te[2]),A.emplaceBack(he+ce)}},F=o.al;D(0,0,F,0,16),D(F,0,F,F,16),D(F,F,0,F,16),D(0,F,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(A),this._tileDebugBuffer=n.createVertexBuffer(C,o.be.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(M,o.bo.members),this._tileDebugSegments=o.bf.simpleSegment(0,0,C.length,A.length)}_makeGlobeTileDebugTextBuffer(n,l,m,v,w,S){const C=o.al/4,A=new o.bc,M=new o.b0,D=new o.bn,F=25;M.reserve(32),A.reserve(F),D.reserve(F);const O=(q,Z)=>F*q+Z;for(let q=0;q<F;q++){const Z=q*C;for(let Q=0;Q<F;Q++){const se=Q*C;A.emplaceBack(se,Z);const ne=this._globePoint(se,Z,l,m,v,w,S);D.emplaceBack(ne[0],ne[1],ne[2])}}for(let q=0;q<4;q++)for(let Z=0;Z<4;Z++){const Q=O(q,Z),se=O(q,Z+1),ne=O(q+1,Z),ae=O(q+1,Z+1);M.emplaceBack(Q,se,ne),M.emplaceBack(ne,se,ae)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(M),this._tileDebugTextBuffer=n.createVertexBuffer(A,o.be.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(D,o.bo.members),this._tileDebugTextSegments=o.bf.simpleSegment(0,0,F,32)}destroy(n=!1){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.br.setPbf(o.bs);class du extends Xl{constructor(n,l,m,v,w){super(n,l,m,v,w),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(n){return this._mrt&&this._mrt.getLayer(n)}setTexturePerLayer(n,l,m){const v=m.context,w=v.gl;let S=this.texturePerLayer.get(n)||m.getTileTexture(l.width);S&&S instanceof o.T?S.update(l,{premultiply:!1}):S=new o.T(v,l,w.RGBA8,{premultiply:!1}),this.texturePerLayer.has(n)||this.texturePerLayer.set(n,S)}flushQueues(n){const l=this._workQueuePerLayer.get(n)||[],m=this._fetchQueuePerLayer.get(n)||[];for(;l.length;)l.pop()();for(;m.length;)m.pop()()}flushAllQueues(){for(const n of this._workQueuePerLayer.keys()){const l=this._workQueuePerLayer.get(n)||[];for(;l.length;)l.pop()()}for(const n of this._fetchQueuePerLayer.keys()){const l=this._fetchQueuePerLayer.get(n)||[];for(;l.length;)l.pop()()}}fetchHeader(n=16384,l){const m=this._mrt=new o.br(30),v=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=o.bt(v,(w,S,C)=>{if(w)l(w);else try{const A=m.getHeaderLength(S);if(A>n)return void(this.request=this.fetchHeader(A,l));m.parseHeader(S),this._isHeaderLoaded=!0;let M=0;for(const D of Object.values(m.layers))M=Math.max(M,D.dataIndex[D.dataIndex.length-1].lastByte);S.byteLength>=M&&(this.entireBuffer=S),l(null,this.entireBuffer||S,C)}catch(A){l(A)}}),this.request}fetchBandForRender(n,l,m,v){this.fetchBand(n,l,m,w=>{if(w)return void v(w);this.updateTextureDescriptor(n,l,m);const S=this.textureDescriptorPerLayer.get(l);v(null,S?S.img:null)})}fetchBand(n,l,m,v,w=!0){const S=this._mrt;if(!this._isHeaderLoaded||!S)return void v(new Error("Tile header is not ready"));const C=this.actor;if(!C)return void v(new Error("Can't fetch tile band without an actor"));let A;const M=o.B(String(m),o.B(this.tileID.key,n));let D=this._taskQueue.get(M);D?D.add(v):(D=new Set,D.add(v),this._taskQueue.set(M,D));const F=(Q,se)=>{A.complete(Q,se),Q?v(Q):(D.values().forEach(ne=>ne(null,se)),this._taskQueue.delete(M))},O=(Q,se)=>{if(Q)return v(Q);const ne=C.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:se,task:A},F,void 0,!0);if(l!==null){const ae=this._workQueuePerLayer.get(l)||[];ae.push(()=>{ne&&ne.cancel(),A.cancel()}),this._workQueuePerLayer.has(l)||this._workQueuePerLayer.set(l,ae)}};let q;try{q=S.getLayer(n)}catch(Q){if(this.state==="reloading")return;throw Q}if(!q)return void v(new Error(`Unknown sourceLayer "${n}"`));if(q.hasDataForBand(m))return D.values().forEach(Q=>Q(null,null)),void this._taskQueue.delete(M);const Z=q.getDataRange([m]);if(A=S.createDecodingTask(Z),!A||A.tasks.length)if(l!==null&&this.flushQueues(l),this.entireBuffer)O(null,this.entireBuffer.slice(Z.firstByte,Z.lastByte+1));else{const Q=Object.assign({},this.requestParams,{headers:{Range:`bytes=${Z.firstByte}-${Z.lastByte}`}}),se=o.bt(Q,O);if(l!==null){const ne=this._fetchQueuePerLayer.get(l)||[];ne.push(()=>{se.cancel(),A.cancel()}),this._fetchQueuePerLayer.has(l)||this._fetchQueuePerLayer.set(l,ne)}}}updateNeeded(n,l){return(!this.textureDescriptorPerLayer.get(n)||this.textureDescriptorPerLayer.get(n).band!==l||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(n,l,m){if(!this._mrt)return;const v=this._mrt.getLayer(n);if(!v||!v.hasBand(m)||!v.hasDataForBand(m))return;const{bytes:w,tileSize:S,buffer:C,offset:A,scale:M}=v.getBandView(m),D=S+2*C,F=new o.q({width:D,height:D},w),O=this.texturePerLayer.get(l);O&&O instanceof o.T&&O.update(F,{premultiply:!1}),this.textureDescriptorPerLayer.set(l,{layer:n,band:m,img:F,buffer:C,offset:A,tileSize:S,format:v.pixelFormat,mix:[M,256*M,65536*M,16777216*M]})}destroy(n=!1){if(super.destroy(n),delete this._mrt,!n)for(const l of this.texturePerLayer.values())l&&l instanceof o.T&&l.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Gy{constructor(n,l){this.max=n,this.onRemove=l,this.reset()}reset(){for(const n in this.data)for(const l of this.data[n])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(n,l,m){const v=n.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const w={value:l,timeout:void 0};if(m!==void 0&&(w.timeout=setTimeout(()=>{this.remove(n,w)},m)),this.data[v].push(w),this.order.push(v),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const l=this.data[n].shift();return l.timeout&&clearTimeout(l.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),l.value}getByKey(n){const l=this.data[n];return l?l[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,l){if(!this.has(n))return this;const m=n.wrapped().key,v=l===void 0?0:this.data[m].indexOf(l),w=this.data[m][v];return this.data[m].splice(v,1),w.timeout&&clearTimeout(w.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(w.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(n){const l=[];for(const m in this.data)for(const v of this.data[m])n(v.value)||l.push(v);for(const m of l)this.remove(m.value.tileID,m)}}class Ob{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,l,m){const v=String(l);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][v]=this.stateChanges[n][v]||{},Object.assign(this.stateChanges[n][v],m),this.deletedStates[n]===null){this.deletedStates[n]={};for(const w in this.state[n])w!==v&&(this.deletedStates[n][w]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][v]===null){this.deletedStates[n][v]={};for(const w in this.state[n][v])m[w]||(this.deletedStates[n][v][w]=null)}else for(const w in m)this.deletedStates[n]&&this.deletedStates[n][v]&&this.deletedStates[n][v][w]===null&&delete this.deletedStates[n][v][w]}removeFeatureState(n,l,m){if(this.deletedStates[n]===null)return;const v=String(l);if(this.deletedStates[n]=this.deletedStates[n]||{},m&&l!==void 0)this.deletedStates[n][v]!==null&&(this.deletedStates[n][v]=this.deletedStates[n][v]||{},this.deletedStates[n][v][m]=null);else if(l!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][v])for(m in this.deletedStates[n][v]={},this.stateChanges[n][v])this.deletedStates[n][v][m]=null;else this.deletedStates[n][v]=null;else this.deletedStates[n]=null}getState(n,l){const m=this.state[n]||{},v=this.stateChanges[n]||{},w=this.deletedStates[n];if(w===null)return{};if(l!==void 0){const C=String(l),A=Object.assign({},m[C],v[C]);if(w){const M=w[l];if(M===null)return{};for(const D in M)delete A[D]}return A}const S=Object.assign({},m,v);if(w)for(const C in w)delete S[C];return S}initializeTileState(n,l){n.refreshFeatureState(l)}coalesceChanges(n,l){const m={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const w={};for(const S in this.stateChanges[v])this.state[v][S]||(this.state[v][S]={}),Object.assign(this.state[v][S],this.stateChanges[v][S]),w[S]=this.state[v][S];m[v]=w}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const w={};if(this.deletedStates[v]===null)for(const S in this.state[v])w[S]={},this.state[v][S]={};else for(const S in this.deletedStates[v]){if(this.deletedStates[v][S]===null)this.state[v][S]={};else if(this.state[v][S])for(const C of Object.keys(this.deletedStates[v][S]))delete this.state[v][S][C];w[S]=this.state[v][S]}m[v]=m[v]||{},Object.assign(m[v],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const v in n)n[v].refreshFeatureState(l)}}class tl extends o.E{constructor(n,l,m){super(),this.id=n,this._onlySymbols=m,l.on("data",v=>{v.dataType==="source"&&v.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&v.dataType==="source"&&v.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new Gy(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Ob,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles)if(!this._tiles[n].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,l){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,l)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const m=this._tiles[l];m.upload(n,this.map?this.map.painter:void 0),m.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(n=>n.tileID).sort(Wy).map(n=>n.key)}getRenderableIds(n,l){const m=[];for(const v in this._tiles)this._isIdRenderable(+v,n,l)&&m.push(this._tiles[v]);return n?m.sort((v,w)=>{const S=v.tileID,C=w.tileID,A=new o.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle),M=new o.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return S.overscaledZ-C.overscaledZ||M.y-A.y||M.x-A.x}).map(v=>v.tileID.key):m.map(v=>v.tileID).sort(Wy).map(v=>v.key)}hasRenderableParent(n){const l=this.findLoadedParent(n,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(n,l,m){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(l||!this._tiles[n].holdingForFade())&&(m||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,l){const m=this._tiles[n];m&&(m.state!=="loading"&&(m.state=l),this._loadTile(m,this._tileLoaded.bind(this,m,n,l)))}_tileLoaded(n,l,m,v,w){if(v){if(n.state="errored",v.status!==404)this._source.fire(new o.y(v,{tile:n}));else{if(this._source.fire(new o.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const C=this.map.painter.terrain;this.update(this.transform,C.getScaledDemTileSize(),!0),C.resetTileLookupCache(this.id)}else this.update(this.transform)}return}n.timeAdded=o.o.now(),m==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(l,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null);let S=new Map;w&&w.responseHeaders&&(S=w.responseHeaders),this._source.fire(new o.z("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id,responseHeaders:S}))}_backfillDEM(n){const l=this.getRenderableIds();for(let v=0;v<l.length;v++){const w=l[v];if(n.neighboringTiles&&n.neighboringTiles[w]){const S=this.getTileByID(w);m(n,S),m(S,n)}}function m(v,w){if(!v.dem||v.dem.borderReady)return;v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0;let S=w.tileID.canonical.x-v.tileID.canonical.x;const C=w.tileID.canonical.y-v.tileID.canonical.y,A=Math.pow(2,v.tileID.canonical.z),M=w.tileID.key;S===0&&C===0||Math.abs(C)>1||(Math.abs(S)>1&&(Math.abs(S+A)===1?S+=A:Math.abs(S-A)===1&&(S-=A)),w.dem&&v.dem&&(v.dem.backfillBorder(w.dem,S,C),v.neighboringTiles&&v.neighboringTiles[M]&&(v.neighboringTiles[M].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,l,m,v){for(const w in this._tiles){let S=this._tiles[w];if(v[w]||!S.hasData()||S.tileID.overscaledZ<=l||S.tileID.overscaledZ>m)continue;let C=S.tileID;for(;S&&S.tileID.overscaledZ>l+1;){const M=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[M.key],S&&S.hasData()&&(C=M)}let A=C;for(;A.overscaledZ>l;)if(A=A.scaledTo(A.overscaledZ-1),n[A.key]){v[C.key]=C;break}}}findLoadedParent(n,l){if(n.key in this._loadedParentTiles){const m=this._loadedParentTiles[n.key];return m&&m.tileID.overscaledZ>=l?m:null}for(let m=n.overscaledZ-1;m>=l;m--){const v=n.scaledTo(m),w=this._getLoadedTile(v);if(w)return w}}_getLoadedTile(n){const l=this._tiles[n.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,l){l=l||this._source.tileSize;const m=Math.ceil(n.width/l)+1,v=Math.ceil(n.height/l)+1,w=Math.floor(m*v*5),S=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,w):w,C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(C)}handleWrapJump(n){const l=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,l){const m={};for(const v in this._tiles){const w=this._tiles[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+l),m[w.tileID.key]=w}this._tiles=m;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(+v,this._tiles[v])}}update(n,l,m,v,w){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!m)return;this.updateCacheSize(n,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const S=this._source.type==="batched-model";let C,A=this._source.maxzoom;const M=this.map&&this.map.painter?this.map.painter._terrain:null;if(M&&M.sourceCache===this&&M.attenuationRange()){const O=M.attenuationRange()[0],q=Math.floor(O)-Math.log2(M.getDemUpscale());A>q&&(A=q)}if(this.used||this.usedForTerrain){if(this._source.tileID)C=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(O=>new o.aP(O.canonical.z,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y));else if(this.tileCoverLift!==0){const O=n.clone();O.tileCoverLift=this.tileCoverLift,C=O.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:S}),this._source.minzoom<=1&&n.projection.name==="globe"&&(C.push(new o.aP(1,0,1,0,0)),C.push(new o.aP(1,0,1,1,0)),C.push(new o.aP(1,0,1,0,1)),C.push(new o.aP(1,0,1,1,1)))}else if(C=n.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:S}),this._source.hasTile){const O=this._source.hasTile.bind(this._source);C=C.filter(q=>O(q))}}else C=[];if(C.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!ed(this._source.type)){const O=n.coveringZoomLevel({tileSize:l||this._source.tileSize,roundZoom:this._source.roundZoom&&!m}),q=Math.min(O,this._source.maxzoom);if(S){const Z=n.extendTileCover(C,q);for(const Q of Z)C.push(Q)}else if(w){const Z=n.extendTileCoverToNearPlane(C,this.transform.getFrustum(q),q);for(const Q of Z)C.push(Q)}else if(this.castsShadows&&v){const Z=n.extendTileCover(C,q,v);for(const Q of Z)this._shadowCasterTiles[Q.key]=!0,C.push(Q)}}const D=this._updateRetainedTiles(C);if(ed(this._source.type)&&C.length!==0){const O={},q={},Z=Object.keys(D);for(const se of Z){const ne=D[se],ae=this._tiles[se];if(!ae||ae.fadeEndTime&&ae.fadeEndTime<=o.o.now())continue;const he=this.findLoadedParent(ne,Math.max(ne.overscaledZ-tl.maxOverzooming,this._source.minzoom));he&&(this._addTile(he.tileID),O[he.tileID.key]=he.tileID),q[se]=ne}const Q=C[C.length-1].overscaledZ;for(const se in this._tiles){const ne=this._tiles[se];if(D[se]||!ne.hasData())continue;let ae=ne.tileID;for(;ae.overscaledZ>Q;){ae=ae.scaledTo(ae.overscaledZ-1);const he=this._tiles[ae.key];if(he&&he.hasData()&&q[ae.key]){D[se]=ne.tileID;break}}}for(const se in O)D[se]||(this._coveredTiles[se]=!0,D[se]=O[se])}for(const O in D)this._tiles[O].clearFadeHold();const F=o.bu(this._tiles,D);for(const O of F){const q=this._tiles[O];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile(+O)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const l={};if(n.length===0)return l;const m={},v=n.reduce((M,D)=>Math.min(M,D.overscaledZ),1/0),w=n[0].overscaledZ,S=Math.max(w-tl.maxOverzooming,this._source.minzoom),C=Math.max(w+tl.maxUnderzooming,this._source.minzoom),A={};for(const M of n){const D=this._addTile(M);l[M.key]=M,D.hasData()||v<this._source.maxzoom&&(A[M.key]=M)}this._retainLoadedChildren(A,v,C,l);for(const M of n){let D=this._tiles[M.key];if(D.hasData())continue;if(M.canonical.z>=this._source.maxzoom){const O=M.children(this._source.maxzoom)[0],q=this.getTile(O);if(q&&q.hasData()){l[O.key]=O;continue}}else{const O=M.children(this._source.maxzoom);if(l[O[0].key]&&l[O[1].key]&&l[O[2].key]&&l[O[3].key])continue}let F=D.wasRequested();for(let O=M.overscaledZ-1;O>=S;--O){const q=M.scaledTo(O);if(m[q.key]||(m[q.key]=!0,D=this.getTile(q),!D&&F&&(D=this._addTile(q)),D&&(l[q.key]=q,F=D.wasRequested(),D.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const l=[];let m,v=this._tiles[n].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){m=this._loadedParentTiles[v.key];break}l.push(v.key);const w=v.scaledTo(v.overscaledZ-1);if(m=this._getLoadedTile(w),m)break;v=w}for(const w of l)this._loadedParentTiles[w]=m}}_addTile(n){let l=this._tiles[n.key];if(l)return l.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),l;l=this._cache.getAndRemove(n),l&&(this._setTileReloadTimer(n.key,l),l.tileID=n,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,l)));const m=!!l;if(!m){const v=this.map?this.map.painter:null,w=this._source.tileSize*n.overscaleFactor();l=this._source.type==="raster-array"?new du(n,w,this.transform.tileZoom,v,this._isRaster):new Xl(n,w,this.transform.tileZoom,v,this._isRaster,this._source.worldview),this._loadTile(l,this._tileLoaded.bind(this,l,n.key,l.state))}return l.uses++,this._tiles[n.key]=l,m||this._source.fire(new o.z("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l}_setTileReloadTimer(n,l){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const m=l.getExpiryTimeout();m&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},m))}_removeTile(n){const l=this._tiles[n];l&&(l.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),l.uses>0||(l.hasData()&&l.state!=="reloading"||l.state==="empty"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,l,m){const v=[],w=this.transform;if(!w)return v;const S=w.projection.name==="globe",C=o.aF(w.center.lng);for(const A in this._tiles){const M=this._tiles[A];if(m&&M.clearQueryDebugViz(),M.holdingForFade())continue;let D;if(S){const F=M.tileID.canonical;if(F.z===0){const O=[Math.abs(o.aA(C,...td(F,-1))-C),Math.abs(o.aA(C,...td(F,1))-C)];D=[0,2*O.indexOf(Math.min(...O))-1]}else{const O=[Math.abs(o.aA(C,...td(F,-1))-C),Math.abs(o.aA(C,...td(F,0))-C),Math.abs(o.aA(C,...td(F,1))-C)];D=[O.indexOf(Math.min(...O))-1]}}else D=[0];for(const F of D){const O=n.containsTile(M,w,l,F);O&&v.push(O)}}return v}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,l){const m=this.getRenderableIds(n,l).map(w=>this._tiles[w].tileID),v=this.transform.projection.name==="globe";for(const w of m)w.projMatrix=this.transform.calculateProjMatrix(w.toUnwrapped()),w.expandedProjMatrix=v?this.transform.calculateProjMatrix(w.toUnwrapped(),!1,!0):w.projMatrix;return m}sortCoordinatesByDistance(n){const l=n.slice(),m=this.transform._camera.position,v=this.transform._camera.forward(),w={};for(const S of l){const C=1/(1<<S.canonical.z);w[S.key]=((S.canonical.x+.5)*C+S.wrap-m[0])*v[0]+((S.canonical.y+.5)*C-m[1])*v[1]-m[2]*v[2]}return l.sort((S,C)=>w[S.key]-w[C.key]),l}hasTransition(){if(this._source.hasTransition())return!0;if(ed(this._source.type))for(const n in this._tiles){const l=this._tiles[n];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=o.o.now())return!0}return!1}setFeatureState(n,l,m){this._state.updateState(n=n||"_geojsonTileLayer",l,m)}removeFeatureState(n,l,m){this._state.removeFeatureState(n=n||"_geojsonTileLayer",l,m)}getFeatureState(n,l){return this._state.getState(n=n||"_geojsonTileLayer",l)}setDependencies(n,l,m){const v=this._tiles[n];v&&v.setDependencies(l,m)}reloadTilesForDependencies(n,l){for(const m in this._tiles)this._tiles[m].hasDependency(n,l)&&this._reloadTile(+m,"reloading");this._cache.filter(m=>!m.hasDependency(n,l))}_preloadTiles(n,l){if(!this._sourceLoaded){const A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(n,l))};return void this._source.on("data",A)}const m=new Map,v=Array.isArray(n)?n:[n],w=this.map.painter.terrain,S=this.usedForTerrain&&w?w.getScaledDemTileSize():this._source.tileSize;for(const A of v){const M=A.coveringTiles({tileSize:S,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of M)m.set(D.key,D);this.usedForTerrain&&A.updateElevation(!1)}const C=Array.from(m.values());o.bv(C,(A,M)=>{const D=new Xl(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(D,F=>{this._source.type==="raster-dem"&&D.dem&&this._backfillDEM(D),M(F,D)})},l)}}function Wy(p,n){const l=Math.abs(2*p.wrap)-+(p.wrap<0),m=Math.abs(2*n.wrap)-+(n.wrap<0);return p.overscaledZ-n.overscaledZ||m-l||n.canonical.y-p.canonical.y||n.canonical.x-p.canonical.x}function ed(p){return p==="raster"||p==="image"||p==="video"||p==="custom"}function td(p,n){const l=1<<p.z;return[p.x/l+n,(p.x+1)/l+n]}tl.maxOverzooming=10,tl.maxUnderzooming=3;class Hy{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,l=!1;for(const m in this.style._mergedLayers){const v=this.style._mergedLayers[m];if(v.type==="fill-extrusion"||v.type==="building")this.layers.push({layer:v,visible:n,visibilityChanged:l});else if(v.type==="model"){const w=this.style.getLayerSource(v);w&&w.type==="batched-model"&&this.layers.push({layer:v,visible:n,visibilityChanged:l})}}}onNewFrame(n){this.layersGotHidden=!1;for(const l of this.layers){const m=l.layer;let v=!1;m.type==="fill-extrusion"?v=!m.isHidden(n)&&m.paint.get("fill-extrusion-opacity")>0:m.type==="building"?v=!m.isHidden(n)&&m.paint.get("building-opacity")>0:m.type==="model"&&(v=!m.isHidden(n)&&m.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!v&&l.visible,l.visible=v}}updateZOffset(n,l){this.currentBuildingBuckets=[];for(const v of this.layers){const w=v.layer,S=this.style.getLayerSourceCache(w);let C=1;w.type==="fill-extrusion"?C=v.visible?w.paint.get("fill-extrusion-vertical-scale"):0:w.type==="building"&&(C=v.visible?w.paint.get("building-vertical-scale"):0);let A=S?S.getTile(l):null;if(!A&&S)for(const M in S._tiles){const D=S._tiles[M];if(l.canonical.isChildOf(D.tileID.canonical)){A=D;break}}this.currentBuildingBuckets.push({bucket:A?A.getBucket(w):null,tileID:A?A.tileID:l,verticalScale:C})}n.hasAnyZOffset=!1;let m=!1;for(let v=0;v<n.symbolInstances.length;v++){const w=n.symbolInstances.get(v),S=w.zOffset,C=this._getHeightAtTileOffset(l,w.tileAnchorX,w.tileAnchorY);w.zOffset=C!==Number.NEGATIVE_INFINITY?C:S,m||S===w.zOffset||(m=!0),n.hasAnyZOffset||w.zOffset===0||(n.hasAnyZOffset=!0)}m&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,l,m,v){let w=l,S=m;if(n.canonical.z!==v.canonical.z){const C=v.canonical,A=1/(1<<n.canonical.z-C.z);w=(l+n.canonical.x*o.al)*A-C.x*o.al|0,S=(m+n.canonical.y*o.al)*A-C.y*o.al|0}return{tileX:w,tileY:S}}_getHeightAtTileOffset(n,l,m){let v,w;for(let S=0;S<this.layers.length;++S){const C=this.layers[S].layer;if(C.type!=="fill-extrusion"&&C.type!=="building")continue;const{bucket:A,tileID:M,verticalScale:D}=this.currentBuildingBuckets[S];if(!A)continue;const{tileX:F,tileY:O}=this._mapCoordToOverlappingTile(n,l,m,M),q=A.getHeightAtTileCoord(F,O);q&&q.height!==void 0&&(q.hidden?v=q.height:w=Math.max(q.height*D,w||0))}if(w!==void 0)return w;for(let S=0;S<this.layers.length;++S){const C=this.layers[S];if(C.layer.type!=="model"||!C.visible)continue;const{bucket:A,tileID:M}=this.currentBuildingBuckets[S];if(!A)continue;const{tileX:D,tileY:F}=this._mapCoordToOverlappingTile(n,l,m,M),O=A.getHeightAtTileCoord(D,F);if(O&&!O.hidden)return O.height===void 0&&v!==void 0?Math.min(O.maxHeight,v)*O.verticalScale:O.height?O.height*O.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ep(p,n){const l={};for(const m in p)m!=="ref"&&(l[m]=p[m]);return o.bw.forEach(m=>{m in n&&(l[m]=n[m])}),l}function th(p){p=p.slice();const n=Object.create(null);for(let l=0;l<p.length;l++)n[p[l].id]=p[l];for(let l=0;l<p.length;l++)"ref"in p[l]&&(p[l]=ep(p[l],n[p[l].ref]));return p}const Gn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Zy(p,n,l){l.push({command:Gn.addSource,args:[p,n[p]]})}function tp(p,n,l){n.push({command:Gn.removeSource,args:[p]}),l[p]=!0}function rp(p,n,l,m){tp(p,l,m),Zy(p,n,l)}function Xy(p,n,l){let m;for(m in p[l])if(p[l].hasOwnProperty(m)&&m!=="data"&&!o.bx(p[l][m],n[l][m]))return!1;for(m in n[l])if(n[l].hasOwnProperty(m)&&m!=="data"&&!o.bx(p[l][m],n[l][m]))return!1;return!0}function np(p,n,l,m,v,w){let S;for(S in n=n||{},p=p||{})p.hasOwnProperty(S)&&(o.bx(p[S],n[S])||l.push({command:w,args:[m,S,n[S],v]}));for(S in n)n.hasOwnProperty(S)&&!p.hasOwnProperty(S)&&(o.bx(p[S],n[S])||l.push({command:w,args:[m,S,n[S],v]}))}function ip(p){return p.id}function sp(p,n){return p[n.id]=n,p}function rd(p,n,l){const m=n.createTileMatrix(p,p.worldSize,l.toUnwrapped());return o.aB(new Float32Array(16),p.projMatrix,m)}function Lb(p,n,l){if(n.projection.name===l.projection.name)return p.projMatrix;const m=l.clone();return m.setProjection(n.projection),rd(m,n.getProjection(),p)}function Gm(p,n,l){return n.name===l.projection.name?p.projMatrix:rd(l,n,p)}class S2{constructor(n,l){this.reset(n,l)}reset(n,l){this.points=n||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=o.aA(n,0,1);let l=1,m=this._distances[l];const v=n*this.paddedLength+this.padding;for(;m<v&&l<this._distances.length;)m=this._distances[++l];const w=l-1,S=this._distances[w],C=m-S,A=C>0?(v-S)/C:0;return this.points[w].mult(1-A).add(this.points[l].mult(A))}}class op{constructor(n,l,m){const v=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(n/m),this.yCellCount=Math.ceil(l/m);for(let S=0;S<this.xCellCount*this.yCellCount;S++)v.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=l,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,l,m,v,w){this._forEachCell(l,m,v,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(l),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(w)}insertCircle(n,l,m,v){this._forEachCell(l-v,m-v,l+v,m+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(l),this.circles.push(m),this.circles.push(v)}_insertBoxCell(n,l,m,v,w,S){this.boxCells[w].push(S)}_insertCircleCell(n,l,m,v,w,S){this.circleCells[w].push(S)}_query(n,l,m,v,w,S){if(m<0||n>this.width||v<0||l>this.height)return!w&&[];const C=[];if(n<=0&&l<=0&&this.width<=m&&this.height<=v){if(w)return!0;for(let A=0;A<this.boxKeys.length;A++)C.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const M=this.circles[3*A],D=this.circles[3*A+1],F=this.circles[3*A+2];C.push({key:this.circleKeys[A],x1:M-F,y1:D-F,x2:M+F,y2:D+F})}return S?C.filter(S):C}return this._forEachCell(n,l,m,v,this._queryCell,C,{hitTest:w,seenUids:{box:{},circle:{}}},S),w?C.length>0:C}_queryCircle(n,l,m,v,w){const S=n-m,C=n+m,A=l-m,M=l+m;if(C<0||S>this.width||M<0||A>this.height)return!v&&[];const D=[];return this._forEachCell(S,A,C,M,this._queryCellCircle,D,{hitTest:v,circle:{x:n,y:l,radius:m},seenUids:{box:{},circle:{}}},w),v?D.length>0:D}query(n,l,m,v,w){return this._query(n,l,m,v,!1,w)}hitTest(n,l,m,v,w){return this._query(n,l,m,v,!0,w)}hitTestCircle(n,l,m,v){return this._queryCircle(n,l,m,!0,v)}_queryCell(n,l,m,v,w,S,C,A){const M=C.seenUids,D=this.boxCells[w];if(D!==null){const O=this.bboxes;for(const q of D)if(!M.box[q]){M.box[q]=!0;const Z=4*q;if(n<=O[Z+2]&&l<=O[Z+3]&&m>=O[Z+0]&&v>=O[Z+1]&&(!A||A(this.boxKeys[q]))){if(C.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[q],x1:O[Z],y1:O[Z+1],x2:O[Z+2],y2:O[Z+3]})}}}const F=this.circleCells[w];if(F!==null){const O=this.circles;for(const q of F)if(!M.circle[q]){M.circle[q]=!0;const Z=3*q;if(this._circleAndRectCollide(O[Z],O[Z+1],O[Z+2],n,l,m,v)&&(!A||A(this.circleKeys[q]))){if(C.hitTest)return S.push(!0),!0;{const Q=O[Z],se=O[Z+1],ne=O[Z+2];S.push({key:this.circleKeys[q],x1:Q-ne,y1:se-ne,x2:Q+ne,y2:se+ne})}}}}}_queryCellCircle(n,l,m,v,w,S,C,A){const M=C.circle,D=C.seenUids,F=this.boxCells[w];if(F!==null){const q=this.bboxes;for(const Z of F)if(!D.box[Z]){D.box[Z]=!0;const Q=4*Z;if(this._circleAndRectCollide(M.x,M.y,M.radius,q[Q+0],q[Q+1],q[Q+2],q[Q+3])&&(!A||A(this.boxKeys[Z])))return S.push(!0),!0}}const O=this.circleCells[w];if(O!==null){const q=this.circles;for(const Z of O)if(!D.circle[Z]){D.circle[Z]=!0;const Q=3*Z;if(this._circlesCollide(q[Q],q[Q+1],q[Q+2],M.x,M.y,M.radius)&&(!A||A(this.circleKeys[Z])))return S.push(!0),!0}}}_forEachCell(n,l,m,v,w,S,C,A){const M=this._convertToXCellCoord(n),D=this._convertToYCellCoord(l),F=this._convertToXCellCoord(m),O=this._convertToYCellCoord(v);for(let q=M;q<=F;q++)for(let Z=D;Z<=O;Z++)if(w.call(this,n,l,m,v,this.xCellCount*Z+q,S,C,A))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,l,m,v,w,S){const C=v-n,A=w-l,M=m+S;return M*M>C*C+A*A}_circleAndRectCollide(n,l,m,v,w,S,C){const A=(S-v)/2,M=Math.abs(n-(v+A));if(M>A+m)return!1;const D=(C-w)/2,F=Math.abs(l-(w+D));if(F>D+m)return!1;if(M<=A||F<=D)return!0;const O=M-A,q=F-D;return O*O+q*q<=m*m}}const Aa={unknown:0,flipRequired:1,flipNotRequired:2},ap=Math.tan(85*Math.PI/180);function rh(p,n,l,m,v,w,S){const C=o.bB();if(l)if(w.name==="globe"){const A=o.bC(v,n);o.aB(C,C,A)}else{const A=o.bD([],S);C[0]=A[0],C[1]=A[1],C[4]=A[2],C[5]=A[3],m||o.bA(C,C,v.angle)}else o.aB(C,v.labelPlaneMatrix,p);return C}function lp(p,n,l,m,v,w,S){const C=rh(p,n,l,m,v,w,S);return w.name==="globe"&&l||(C[2]=C[6]=C[10]=C[14]=0),C}function yc(p,n,l,m,v,w,S){if(l){if(w.name==="globe"){const C=rh(p,n,l,m,v,w,S);return o.bk(C,C),o.aB(C,p,C),C}{const C=o.by(p),A=o.bz([]);return A[0]=S[0],A[1]=S[1],A[4]=S[2],A[5]=S[3],o.aB(C,C,A),m||o.bA(C,C,-v.angle),C}}return v.glCoordMatrix}function js(p,n,l,m){const v=[p,n,l,1];l?o.aC(v,v,m):rl(v,v,m);const w=v[3];return v[0]/=w,v[1]/=w,v[2]/=w,v}function Ky(p,n){return Math.min(.5+p/n*.5,1.5)}function Yy(p,n){const l=p[0]/p[3],m=p[1]/p[3];return l>=-n[0]&&l<=n[0]&&m>=-n[1]&&m<=n[1]}function Jy(p,n,l,m,v,w,S,C,A,M,D=1){const F=l.transform,O=m?p.textSizeData:p.iconSizeData,q=o.bJ(O,l.transform.zoom,D),Z=F.projection.name==="globe",Q=[256/l.width*2+1,256/l.height*2+1],se=m?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;se.clear();let ne=null;Z&&(ne=m?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const ae=p.lineVertexArray,he=m?p.text.placedSymbolArray:p.icon.placedSymbolArray,ce=l.transform.width/l.transform.height;let we,fe=!1;for(let Te=0;Te<he.length;Te++){const ve=he.get(Te),{numGlyphs:ge,writingMode:Ce}=ve;if(Ce!==o.bK.vertical||fe||we===o.bK.horizontal||(fe=!0),we=Ce,(ve.hidden||Ce===o.bK.vertical)&&!fe){vc(ge,se);continue}fe=!1;const Fe=new o.P(ve.tileAnchorX,ve.tileAnchorY),Oe=p.elevationType==="road",st=!!F.elevation||Oe;let{x:He,y:ht,z:Nt}=F.projection.projectTilePoint(Fe.x,Fe.y,M.canonical),Ge=null;if(st){const Qt=Oe?p.getElevationFeatureForText(Te):null;Ge={getElevation:A,elevation:F.elevation,elevationFeature:Qt};const[Tr,pn,En]=A(Fe,F.elevation,Qt);He+=Tr,ht+=pn,Nt+=En}const Re=[He,ht,Nt,1];if(o.aC(Re,Re,n),!Yy(Re,Q)){vc(ge,se);continue}const ft=Re[3],Ze=Ky(l.transform.getCameraToCenterDistance(F.projection),ft),wt=o.bL(O,q,ve),Ft=S?wt/Ze:wt*Ze,sr=js(He,ht,Nt,v);if(sr[3]<=0){vc(ge,se);continue}let Rt={};const Lt=o.an(p.layers[0].layout.get("text-max-angle")),ar=Math.cos(Lt),Jt=S?null:Ge,Zt=zb(ve,Ft,!1,C,n,v,w,p.glyphOffsetArray,ae,se,ne,sr,Fe,Rt,ce,Jt,F.projection,M,S,ar);fe=Zt.useVertical,Jt&&Zt.needsFlipping&&(Rt={}),(Zt.notEnoughRoom||fe||Zt.needsFlipping&&zb(ve,Ft,!0,C,n,v,w,p.glyphOffsetArray,ae,se,ne,sr,Fe,Rt,ce,Jt,F.projection,M,S,ar).notEnoughRoom)&&vc(ge,se)}m?(p.text.dynamicLayoutVertexBuffer.updateData(se),ne&&p.text.globeExtVertexBuffer&&p.text.globeExtVertexBuffer.updateData(ne)):(p.icon.dynamicLayoutVertexBuffer.updateData(se),ne&&p.icon.globeExtVertexBuffer&&p.icon.globeExtVertexBuffer.updateData(ne))}function Yn(p,n,l,m,v,w,S,C,A,M,D,F,O,q,Z,Q,se){const{lineStartIndex:ne,glyphStartIndex:ae,segment:he}=C,ce=ae+C.numGlyphs,we=ne+C.lineLength,fe=n.getoffsetX(ae),Te=n.getoffsetX(ce-1),ve=cp(p*fe,l,m,v,w,S,he,ne,we,A,M,D,F,O,!0,q,Z,Q,se);if(!ve)return null;const ge=cp(p*Te,l,m,v,w,S,he,ne,we,A,M,D,F,O,!0,q,Z,Q,se);return ge?{first:ve,last:ge}:null}function Qy(p,n,l,m){return p===o.bK.horizontal&&Math.abs(m)>Math.abs(l)?{useVertical:!0}:p===o.bK.vertical?m>0?{needsFlipping:!0}:null:n!==Aa.unknown&&function(v,w){return v===0||Math.abs(w/v)>ap}(l,m)?n===Aa.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function zb(p,n,l,m,v,w,S,C,A,M,D,F,O,q,Z,Q,se,ne,ae,he){const ce=n/24,we=p.lineOffsetX*ce,fe=p.lineOffsetY*ce,{lineStartIndex:Te,glyphStartIndex:ve,numGlyphs:ge,segment:Ce,writingMode:Fe,flipState:Oe}=p,st=Te+p.lineLength,He=ht=>{if(D){const[ft,Ze,wt]=ht.up,Ft=M.length;o.bM(D,Ft+0,ft,Ze,wt),o.bM(D,Ft+1,ft,Ze,wt),o.bM(D,Ft+2,ft,Ze,wt),o.bM(D,Ft+3,ft,Ze,wt)}const[Nt,Ge,Re]=ht.point;o.bN(M,Nt,Ge,Re,ht.angle)};if(ge>1){const ht=Yn(ce,C,we,fe,l,F,O,p,A,w,q,Q,!1,se,ne,ae,he);if(!ht)return{notEnoughRoom:!0};if(m&&!l){let[Nt,Ge,Re]=ht.first.point,[ft,Ze,wt]=ht.last.point;[Nt,Ge]=js(Nt,Ge,Re,S),[ft,Ze]=js(ft,Ze,wt,S);const Ft=Qy(Fe,Oe,(ft-Nt)*Z,Ze-Ge);if(p.flipState=Ft&&Ft.needsFlipping?Aa.flipRequired:Aa.flipNotRequired,Ft)return Ft}He(ht.first);for(let Nt=ve+1;Nt<ve+ge-1;Nt++){const Ge=cp(ce*C.getoffsetX(Nt),we,fe,l,F,O,Ce,Te,st,A,w,q,Q,!1,!1,se,ne,ae,he);if(!Ge)return M.length-=4*(Nt-ve),{notEnoughRoom:!0};He(Ge)}He(ht.last)}else{if(m&&!l){const Nt=js(O.x,O.y,0,v),Ge=Te+Ce+1,Re=new o.P(A.getx(Ge),A.gety(Ge)),ft=js(Re.x,Re.y,0,v),Ze=ft[3]>0?ft:Rr(O,Re,Nt,1,v,void 0,se,ne.canonical),wt=Qy(Fe,Oe,(Ze[0]-Nt[0])*Z,Ze[1]-Nt[1]);if(p.flipState=wt&&wt.needsFlipping?Aa.flipRequired:Aa.flipNotRequired,wt)return wt}const ht=cp(ce*C.getoffsetX(ve),we,fe,l,F,O,Ce,Te,st,A,w,q,Q,!1,!1,se,ne,ae,he);if(!ht)return{notEnoughRoom:!0};He(ht)}return{}}function Fb(p,n,l,m,v){const{x:w,y:S,z:C}=m.projectTilePoint(p.x,p.y,n);if(!v)return js(w,S,C,l);const[A,M,D]=v.getElevation(p,v.elevation,v.elevationFeature);return js(w+A,S+M,C+D,l)}function Rr(p,n,l,m,v,w,S,C){const A=Fb(p.sub(n)._unit()._add(p),C,v,S,w);return o.av(A,l,A),o.aw(A,A),o.bG(A,l,A,m)}function cp(p,n,l,m,v,w,S,C,A,M,D,F,O,q,Z,Q,se,ne,ae){const he=m?p-n:p+n;let ce=he>0?1:-1,we=0;m&&(ce*=-1,we=Math.PI),ce<0&&(we+=Math.PI);let fe=C+S+(ce>0?0:1)|0,Te=v,ve=v,ge=0,Ce=0;const Fe=Math.abs(he),Oe=[],st=[];let He=w,ht=He,Nt=o.bE([]);const Ge=()=>Rr(ht,He,ve,Fe-ge+1,D,O,Q,se.canonical);for(;ge+Ce<=Fe;){if(fe+=ce,fe<C||fe>=A)return null;if(ve=Te,ht=He,Oe.push(ve),q&&st.push(ht),He=new o.P(M.getx(fe),M.gety(fe)),Te=F[fe],!Te){const Jt=Fb(He,se.canonical,D,Q,O);Te=Jt[3]>0?F[fe]=Jt:Ge()}ge+=Ce;const Lt=o.av([],Te,ve),ar=o.bF(ve,Te);if(l&&ar>0&&Ce>0&&o.bI(Nt,Lt)/(Ce*ar)<ae)return null;Ce=ar,Nt=Lt}Z&&O&&(F[fe]&&(Te=Ge(),Ce=o.bF(ve,Te),Nt=o.av([],Te,ve)),F[fe]=Te);const Re=(Fe-ge)/Ce,ft=He.sub(ht)._mult(Re)._add(ht),Ze=o.bG([],ve,Nt,Re);let wt=[0,0,1],Ft=Nt[0],sr=Nt[1];if(ne&&(wt=Q.upVector(se.canonical,ft.x,ft.y),wt[0]!==0||wt[1]!==0||wt[2]!==1)){const Lt=[wt[2],0,-wt[0]],ar=o.bH([],wt,Lt);o.aw(Lt,Lt),o.aw(ar,ar),Ft=o.bI(Nt,Lt),sr=o.bI(Nt,ar)}if(l){const Lt=o.bH([],wt,Nt);o.aw(Lt,Lt),o.bG(Ze,Ze,Lt,l*ce)}const Rt=we+Math.atan2(sr,Ft);return Oe.push(Ze),q&&st.push(ft),{point:Ze,angle:Rt,path:Oe,tilePath:st,up:wt}}function vc(p,n){const l=n.length,m=l+4*p;n.resize(m),n.float32.fill(-1/0,4*l,4*m)}function rl(p,n,l){const m=n[0],v=n[1];return p[0]=l[0]*m+l[4]*v+l[12],p[1]=l[1]*m+l[5]*v+l[13],p[3]=l[3]*m+l[7]*v+l[15],p}const nl=100;class nh{constructor(n,l,m=new op(n.width+200,n.height+200,25),v=new op(n.width+200,n.height+200,25)){this.transform=n,this.grid=m,this.ignoredGrid=v,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+nl,this.screenBottomBoundary=n.height+nl,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=l}placeCollisionBox(n,l,m,v,w,S,C,A,M,D,F){let O=m.projectedAnchorX,q=m.projectedAnchorY,Z=m.projectedAnchorZ;const Q=m.tileAnchorX,se=m.tileAnchorY,ne=m.elevation,ae=m.tileID,he=n.getProjection();if(ne&&ae){const[st,He,ht]=he.upVector(ae.canonical,m.tileAnchorX,m.tileAnchorY),Nt=he.upVectorScale(ae.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=st*ne*Nt,q+=He*ne*Nt,Z+=ht*ne*Nt}const ce=n.projection.name==="globe",we=n.projection.name==="globe"?o.aj(this.transform.zoom):0;if(ae&&ce&&we<1&&!S){const st=1<<ae.canonical.z,He=o.bO(Q,se);o.bP(He,He,1/o.al),o.bQ(He,He,o.bO(ae.canonical.x,ae.canonical.y)),o.bP(He,He,1/st),o.bR(He,He,o.bO(v[0],v[1])),He[0]=o.bS(He[0],-.5,.5),o.bP(He,He,o.al);const ht=o.bT(He[0],He[1],o.al/(2*Math.PI),1);o.aC(ht,ht,w),O=o.ak(O,ht[0],we),q=o.ak(q,ht[1],we),Z=o.ak(Z,ht[2],we)}const fe=this.projectAndGetPerspectiveRatio(D,O,q,Z,m.tileID,he.name==="globe"||!!ne||this.transform.pitch>0,he),Te=M*fe.perspectiveRatio,ve=(m.x1*l+C.x-m.padding)*Te+fe.point.x,ge=(m.y1*l+C.y-m.padding)*Te+fe.point.y,Ce=(m.x2*l+C.x+m.padding)*Te+fe.point.x,Fe=(m.y2*l+C.y+m.padding)*Te+fe.point.y,Oe=fe.perspectiveRatio<=.55||fe.occluded;return!this.isInsideGrid(ve,ge,Ce,Fe)||!A&&this.grid.hitTest(ve,ge,Ce,Fe,F)||Oe?{box:[],offscreen:!1,occluded:fe.occluded}:{box:[ve,ge,Ce,Fe],offscreen:this.isOffscreen(ve,ge,Ce,Fe),occluded:!1}}placeCollisionCircles(n,l,m,v,w,S,C,A,M,D,F,O,q,Z,Q,se){const ne=[],ae=this.transform.elevation,he=n.getProjection(),ce=n.elevationType==="road",we=!!ae||ce,fe=o.bU.getAtTileOffsetFunc(se,this.transform.center.lat,this.transform.worldSize,he),Te=new o.P(m.tileAnchorX,m.tileAnchorY),ve=new o.P(m.tileAnchorX,m.tileAnchorY);let{x:ge,y:Ce,z:Fe}=he.projectTilePoint(ve.x,ve.y,se.canonical),Oe=null;if(we){const ar=ce?n.getElevationFeatureForText(v):null;Oe={getElevation:fe,elevation:ae,elevationFeature:ar};const[Jt,Zt,Qt]=fe(Te,ae,ar);ge+=Jt,Ce+=Zt,Fe+=Qt}const st=he.name==="globe",He=this.projectAndGetPerspectiveRatio(A,ge,Ce,Fe,se,st||!!ae||this.transform.pitch>0,he),{perspectiveRatio:ht}=He,Nt=(O?C/ht:C*ht)/o.bX,Ge=js(ge,Ce,Fe,M),Re=m.lineOffsetX*Nt,ft=m.lineOffsetY*Nt,Ze=o.an(n.layers[0].layout.get("text-max-angle")),wt=Math.cos(Ze),Ft=He.signedDistanceFromCamera>0?Yn(Nt,S,Re,ft,ce&&m.flipState===1,Ge,ve,m,w,M,{},we&&!O?Oe:null,O&&we,he,se,O,wt):null;let sr=!1,Rt=!1,Lt=!0;if(Ft&&!He.occluded){const ar=.5*Z*ht+Q,Jt=new o.P(-100,-100),Zt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Qt=new S2,{first:Tr,last:pn}=Ft,En=Tr.path.length;let oi=[];for(let Xr=En-1;Xr>=1;Xr--)oi.push(Tr.path[Xr]);for(let Xr=1;Xr<pn.path.length;Xr++)oi.push(pn.path[Xr]);const Nr=2.5*ar;D&&(oi=oi.map(([Xr,ri,Cn],mi)=>(we&&!st&&(Cn=fe(mi<En-1?Tr.tilePath[En-1-mi]:pn.tilePath[mi-En+2],ae,Oe.elevationFeature)[2]),js(Xr,ri,Cn,D))),oi.some(Xr=>Xr[3]<=0)&&(oi=[]));let Sn=[];if(oi.length>0){let Xr=1/0,ri=-1/0,Cn=1/0,mi=-1/0;for(const Nn of oi)Xr=Math.min(Xr,Nn[0]),Cn=Math.min(Cn,Nn[1]),ri=Math.max(ri,Nn[0]),mi=Math.max(mi,Nn[1]);ri>=Jt.x&&Xr<=Zt.x&&mi>=Jt.y&&Cn<=Zt.y&&(Sn=[oi.map(Nn=>new o.P(Nn[0],Nn[1]))],(Xr<Jt.x||ri>Zt.x||Cn<Jt.y||mi>Zt.y)&&(Sn=o.bV(Sn,Jt.x,Jt.y,Zt.x,Zt.y)))}for(const Xr of Sn){Qt.reset(Xr,.25*ar);let ri=0;ri=Qt.length<=.5*ar?1:Math.ceil(Qt.paddedLength/Nr)+1;for(let Cn=0;Cn<ri;Cn++){const mi=Cn/Math.max(ri-1,1),Nn=Qt.lerp(mi),Kr=Nn.x+nl,Wn=Nn.y+nl;ne.push(Kr,Wn,ar,0);const en=Kr-ar,Ti=Wn-ar,Kn=Kr+ar,zr=Wn+ar;if(Lt=Lt&&this.isOffscreen(en,Ti,Kn,zr),Rt=Rt||this.isInsideGrid(en,Ti,Kn,zr),!l&&this.grid.hitTestCircle(Kr,Wn,ar,q)&&(sr=!0,!F))return{circles:[],offscreen:!1,collisionDetected:sr,occluded:!1}}}}return{circles:!F&&sr||!Rt?[]:ne,offscreen:Lt,collisionDetected:sr,occluded:He.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let m=1/0,v=1/0,w=-1/0,S=-1/0;for(const D of n){const F=new o.P(D.x+nl,D.y+nl);m=Math.min(m,F.x),v=Math.min(v,F.y),w=Math.max(w,F.x),S=Math.max(S,F.y),l.push(F)}const C=this.grid.query(m,v,w,S).concat(this.ignoredGrid.query(m,v,w,S)),A={},M={};for(const D of C){const F=D.key;if(A[F.bucketInstanceId]===void 0&&(A[F.bucketInstanceId]={}),A[F.bucketInstanceId][F.featureIndex])continue;const O=[new o.P(D.x1,D.y1),new o.P(D.x2,D.y1),new o.P(D.x2,D.y2),new o.P(D.x1,D.y2)];o.bW(l,O)&&(A[F.bucketInstanceId][F.featureIndex]=!0,M[F.bucketInstanceId]===void 0&&(M[F.bucketInstanceId]=[]),M[F.bucketInstanceId].push(F.featureIndex))}return M}insertCollisionBox(n,l,m,v,w){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:w},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,l,m,v,w){const S=l?this.ignoredGrid:this.grid,C={bucketInstanceId:m,featureIndex:v,collisionGroupID:w};for(let A=0;A<n.length;A+=4)S.insertCircle(C,n[A],n[A+1],n[A+2])}projectAndGetPerspectiveRatio(n,l,m,v,w,S,C){const A=[l,m,v,1];let M=!1;v||this.transform.pitch>0?(o.aC(A,A,n),this.fogState&&w&&C.name!=="globe"&&(M=function(O,q,Z,Q,se,ne){const ae=ne.calculateFogTileMatrix(se),he=[q,Z,Q];return o.af(he,he,ae),Dt(O,o.ag(he),ne.pitch,ne._fov)}(this.fogState,l,m,v,w.toUnwrapped(),this.transform)>.9)):rl(A,A,n);const D=A[3];return{point:new o.P((A[0]/D+1)/2*this.transform.width+nl,(-A[1]/D+1)/2*this.transform.height+nl),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/D*.5,1.5),signedDistanceFromCamera:D,occluded:S&&A[2]>D||M}}isOffscreen(n,l,m,v){return m<nl||n>=this.screenRightBoundary||v<nl||l>this.screenBottomBoundary}isInsideGrid(n,l,m,v){return m>=0&&n<this.gridRightBoundary&&v>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const n=o.bz([]);return o.bq(n,n,[-100,-100,0]),n}}class fr{constructor(n,l,m,v){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?l:-l))):v&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class Dn{constructor(n,l,m,v,w,S=!1){this.text=new fr(n?n.text:null,l,m,w),this.icon=new fr(n?n.icon:null,l,v,w),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xn{constructor(n,l,m,v=!1){this.text=n,this.icon=l,this.skipFade=m,this.clipped=v}}class fa{constructor(){this.invProjMatrix=o.bB(),this.viewportMatrix=o.bB(),this.circles=[]}}class ih{constructor(n,l,m,v,w){this.bucketInstanceId=n,this.featureIndex=l,this.sourceLayerIndex=m,this.bucketIndex=v,this.tileID=w}}class ti{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const l=++this.maxGroupID;this.collisionGroups[n]={ID:l,predicate:m=>m.collisionGroupID===l}}return this.collisionGroups[n]}}function up(p,n,l,m,v){const{horizontalAlign:w,verticalAlign:S}=o.c0(p),C=-(w-.5)*n,A=-(S-.5)*l,M=o.c1(p,m);return new o.P(C+M[0]*v,A+M[1]*v)}function nd(p,n,l,m,v){const w=new o.P(p,n);return l&&w._rotate(m?v:-v),w}class dp{constructor(n,l,m,v,w,S){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new nh(this.transform,w),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new ti(m),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,l,m,v,w=1){const S=m.getBucket(l),C=m.latestFeatureIndex;if(!S||!C||l.fqid!==S.layerIds[0])return;const A=S.layers[0].layout,M=S.layers[0].paint,D=m.collisionBoxArray,F=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),O=m.tileSize/o.al,q=m.tileID.toUnwrapped();this.transform.setProjection(S.projection);const Z=(Q=m.tileID,se=S.getProjection(),ne=this.transform,se.name===this.projection?ne.calculateProjMatrix(Q.toUnwrapped()):rd(ne,se,Q));var Q,se,ne;const ae=A.get("text-pitch-alignment")==="map",he=A.get("text-rotation-alignment")==="map";l.compileFilter(l.options);const ce=l.dynamicFilter(),we=l.dynamicFilterNeedsFeature(),fe=this.transform.calculatePixelsToTileUnitsMatrix(m),Te=lp(Z,m.tileID.canonical,ae,he,this.transform,S.getProjection(),fe);let ve=null;const ge=S.getProjection().createInversionMatrix(this.transform,m.tileID.canonical);if(ae){const Re=yc(Z,m.tileID.canonical,ae,he,this.transform,S.getProjection(),fe);ve=o.aB([],this.transform.labelPlaneMatrix,Re)}let Ce=null;ce&&m.latestFeatureIndex&&(Ce={unwrappedTileID:q,dynamicFilter:ce,dynamicFilterNeedsFeature:we}),this.retainedQueryData[S.bucketInstanceId]=new ih(S.bucketInstanceId,C,S.sourceLayerIndex,S.index,m.tileID);const[Fe,Oe]=S.layers[0].layout.get("text-size-scale-range"),st=o.aA(w,Fe,Oe),[He,ht]=A.get("icon-size-scale-range"),Nt=o.aA(w,He,ht),Ge={bucket:S,layout:A,paint:M,posMatrix:Z,invMatrix:ge,mercatorCenter:[o.aF(this.transform.center.lng),o.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Te,labelToScreenMatrix:ve,clippingData:Ce,scale:F,textPixelRatio:O,holdingForFade:m.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:o.bJ(S.textSizeData,this.transform.zoom,st),partiallyEvaluatedIconSize:o.bJ(S.iconSizeData,this.transform.zoom,Nt),collisionGroup:this.collisionGroups.get(S.sourceID),latestFeatureIndex:m.latestFeatureIndex};if(v)for(const Re of S.sortKeyRanges){const{sortKey:ft,symbolInstanceStart:Ze,symbolInstanceEnd:wt}=Re;n.push({sortKey:ft,symbolInstanceStart:Ze,symbolInstanceEnd:wt,parameters:Ge})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:Ge})}attemptAnchorPlacement(n,l,m,v,w,S,C,A,M,D,F,O,q,Z,Q,se,ne,ae,he,ce,we){const{textOffset0:fe,textOffset1:Te,crossTileID:ve}=Q,ge=[fe,Te],Ce=up(n,S,C,ge,A),Fe=this.collisionIndex.placeCollisionBox(ne,A,l,m,v,w,nd(Ce.x,Ce.y,M,D,this.transform.angle),Z,F,O,q.predicate);if(he){const Oe=ne.getSymbolInstanceIconSize(we,this.transform.zoom,Q.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ne,Oe,he,m,v,w,nd(Ce.x,Ce.y,M,D,this.transform.angle),Z,F,O,q.predicate).box.length===0)return}if(Fe.box.length>0){let Oe;return this.prevPlacement&&this.prevPlacement.variableOffsets[ve]&&this.prevPlacement.placements[ve]&&this.prevPlacement.placements[ve].text&&(Oe=this.prevPlacement.variableOffsets[ve].anchor),this.variableOffsets[ve]={textOffset:ge,width:S,height:C,anchor:n,textScale:A,prevAnchor:Oe},this.markUsedJustification(ne,n,Q,ae),ne.allowVerticalPlacement&&(this.markUsedOrientation(ne,ae,Q),this.placedOrientations[ve]=ae),{shift:Ce,placedGlyphBoxes:Fe}}}placeLayerBucketPart(n,l,m,v,w=1){const{bucket:S,layout:C,paint:A,posMatrix:M,textLabelPlaneMatrix:D,labelToScreenMatrix:F,clippingData:O,textPixelRatio:q,mercatorCenter:Z,invMatrix:Q,holdingForFade:se,collisionBoxArray:ne,partiallyEvaluatedTextSize:ae,partiallyEvaluatedIconSize:he,collisionGroup:ce,latestFeatureIndex:we}=n.parameters,fe=C.get("text-optional"),Te=C.get("icon-optional"),ve=C.get("text-allow-overlap"),ge=C.get("icon-allow-overlap"),Ce=C.get("text-rotation-alignment")==="map",Fe=C.get("icon-rotation-alignment")==="map",Oe=C.get("text-pitch-alignment")==="map",st=A.get("symbol-z-offset"),He=C.get("symbol-elevation-reference")==="sea",ht=C.get("symbol-placement"),[Nt,Ge]=C.get("text-size-scale-range"),[Re,ft]=C.get("icon-size-scale-range"),Ze=o.aA(w,Nt,Ge),wt=o.aA(w,Re,ft),Ft=C.get("text-variable-anchor"),sr=Ce&&ht!=="point",Rt=Fe&&ht!=="point",Lt=Ft&&S.hasTextData(),ar=S.hasIconTextFit()&&Lt&&S.hasIconData();this.transform.setProjection(S.projection);const Jt=Lt||sr,Zt=Rt||ar;let Qt=ve&&(ge||!S.hasIconData()||Te),Tr=ge&&(ve||!S.hasTextData()||fe);const pn=!st.isConstant();!S.collisionArrays&&ne&&S.deserializeCollisionBoxes(ne),m&&v&&S.updateCollisionDebugBuffers(this.transform.zoom,ne,Ze,wt);const En=(Nr,Sn,Xr)=>{const{crossTileID:ri,numVerticalGlyphVertices:Cn}=Nr;let mi=null;if(O&&O.dynamicFilterNeedsFeature||pn){const Wi=this.retainedQueryData[S.bucketInstanceId];mi=we.loadFeature({featureIndex:Nr.featureIndex,bucketIndex:Wi.bucketIndex,sourceLayerIndex:Wi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(O&&!(0,O.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:S.worldview},mi,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new o.P(Nr.tileAnchorX,Nr.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[ri]=new Xn(!1,!1,!1,!0),void l.add(ri);const Nn=st.evaluate(mi,{});if(l.has(ri))return;if(se)return void(this.placements[ri]=new Xn(!1,!1,!1));let Kr=!1,Wn=!1,en=!0,Ti=!1,Kn=!1,zr=null,In={box:null,offscreen:null,occluded:null},Oi={box:null},is=null,Ui=null,Yi=null,ra=0,Ho=0,mo=0;Xr.textFeatureIndex?ra=Xr.textFeatureIndex:Nr.useRuntimeCollisionCircles&&(ra=Nr.featureIndex),Xr.verticalTextFeatureIndex&&(Ho=Xr.verticalTextFeatureIndex);const To=S.elevationFeatures?S.elevationFeatures[Nr.elevationFeatureIndex]:void 0,Ra=Wi=>{Wi.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const ss=this.transform.elevation;Wi.elevation=He?Nn:Nn+o.bU.getAtTileOffset(Wi.tileID,new o.P(Wi.tileAnchorX,Wi.tileAnchorY),ss,To),Wi.elevation+=Nr.zOffset},go=Xr.textBox;if(go){Ra(go);const Wi=pi=>{let ds=o.bK.horizontal;if(S.allowVerticalPlacement&&!pi&&this.prevPlacement){const $s=this.prevPlacement.placedOrientations[ri];$s&&(this.placedOrientations[ri]=$s,ds=$s,this.markUsedOrientation(S,ds,Nr))}return ds},ss=(pi,ds)=>{if(S.allowVerticalPlacement&&Cn>0&&Xr.verticalTextBox){for(const $s of S.writingModes)if($s===o.bK.vertical?(In=ds(),Oi=In):In=pi(),In&&In.box&&In.box.length)break}else In=pi()};if(Ft){let pi=Ft;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ri]){const Hi=this.prevPlacement.variableOffsets[ri];pi.indexOf(Hi.anchor)>0&&(pi=pi.filter(Da=>Da!==Hi.anchor),pi.unshift(Hi.anchor))}const ds=(Hi,Da,Nh)=>{const Pc=S.getSymbolInstanceTextSize(ae,Nr,this.transform.zoom,Sn),Oh=(Hi.x2-Hi.x1)*Pc+2*Hi.padding,Lh=(Hi.y2-Hi.y1)*Pc+2*Hi.padding,Na=Nr.hasIconTextFit&&!ge?Da:null;Na&&Ra(Na);let tc={box:[],offscreen:!1,occluded:!1};const Fs=ve?2*pi.length:pi.length;for(let Oa=0;Oa<Fs;++Oa){const _d=this.attemptAnchorPlacement(pi[Oa%pi.length],Hi,Z,Q,Jt,Oh,Lh,Pc,Ce,Oe,q,M,ce,Oa>=pi.length,Nr,Sn,S,Nh,Na,ae,he);if(_d&&(tc=_d.placedGlyphBoxes,tc&&tc.box&&tc.box.length)){Kr=!0,zr=_d.shift;break}}return tc};ss(()=>ds(go,Xr.iconBox,o.bK.horizontal),()=>{const Hi=Xr.verticalTextBox;return Hi&&Ra(Hi),S.allowVerticalPlacement&&!(In&&In.box&&In.box.length)&&Cn>0&&Hi?ds(Hi,Xr.verticalIconBox,o.bK.vertical):{box:null,offscreen:null,occluded:null}}),In&&(Kr=In.box,en=In.offscreen,Ti=In.occluded);const $s=Wi(!(!In||!In.box));if(!Kr&&this.prevPlacement){const Hi=this.prevPlacement.variableOffsets[ri];Hi&&(this.variableOffsets[ri]=Hi,this.markUsedJustification(S,Hi.anchor,Nr,$s))}}else{const pi=(ds,$s)=>{const Hi=S.getSymbolInstanceTextSize(ae,Nr,this.transform.zoom,Sn),Da=this.collisionIndex.placeCollisionBox(S,Hi,ds,Z,Q,Jt,new o.P(0,0),ve,q,M,ce.predicate);return Da&&Da.box&&Da.box.length&&(this.markUsedOrientation(S,$s,Nr),this.placedOrientations[ri]=$s),Da};ss(()=>pi(go,o.bK.horizontal),()=>{const ds=Xr.verticalTextBox;return S.allowVerticalPlacement&&Cn>0&&ds?(Ra(ds),pi(ds,o.bK.vertical)):{box:null,offscreen:null,occluded:null}}),Wi(!!(In&&In.box&&In.box.length))}}if(is=In,Kr=is&&is.box&&is.box.length>0,en=is&&is.offscreen,Ti=is&&is.occluded,Nr.useRuntimeCollisionCircles){const Wi=Nr.centerJustifiedTextSymbolIndex>=0?Nr.centerJustifiedTextSymbolIndex:Nr.verticalPlacedTextSymbolIndex,ss=S.text.placedSymbolArray.get(Wi),pi=o.bL(S.textSizeData,ae,ss),ds=C.get("text-padding");Ui=this.collisionIndex.placeCollisionCircles(S,ve,ss,Wi,S.lineVertexArray,S.glyphOffsetArray,pi,M,D,F,m,Oe,ce.predicate,Nr.collisionCircleDiameter*pi/o.bX,ds,this.retainedQueryData[S.bucketInstanceId].tileID),Kr=ve||Ui.circles.length>0&&!Ui.collisionDetected,en=en&&Ui.offscreen,Ti=Ui.occluded}if(Xr.iconFeatureIndex&&(mo=Xr.iconFeatureIndex),Xr.iconBox){const Wi=ss=>{Ra(ss);const pi=Nr.hasIconTextFit&&zr?nd(zr.x,zr.y,Ce,Oe,this.transform.angle):new o.P(0,0),ds=S.getSymbolInstanceIconSize(he,this.transform.zoom,Nr.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,ds,ss,Z,Q,Zt,pi,ge,q,M,ce.predicate)};Oi&&Oi.box&&Oi.box.length&&Xr.verticalIconBox?(Yi=Wi(Xr.verticalIconBox),Wn=Yi.box.length>0):(Yi=Wi(Xr.iconBox),Wn=Yi.box.length>0),en=en&&Yi.offscreen,Kn=Yi.occluded}const Ma=fe||Nr.numHorizontalGlyphVertices===0&&Cn===0,ul=Te||Nr.numIconVertices===0;if(Ma||ul?ul?Ma||(Wn=Wn&&Kr):Kr=Wn&&Kr:Wn=Kr=Wn&&Kr,Kr&&is&&is.box&&this.collisionIndex.insertCollisionBox(is.box,C.get("text-ignore-placement"),S.bucketInstanceId,Oi&&Oi.box&&Ho?Ho:ra,ce.ID),Wn&&Yi&&this.collisionIndex.insertCollisionBox(Yi.box,C.get("icon-ignore-placement"),S.bucketInstanceId,mo,ce.ID),Ui&&(Kr&&this.collisionIndex.insertCollisionCircles(Ui.circles,C.get("text-ignore-placement"),S.bucketInstanceId,ra,ce.ID),m)){const Wi=S.bucketInstanceId;let ss=this.collisionCircleArrays[Wi];ss===void 0&&(ss=this.collisionCircleArrays[Wi]=new fa);for(let pi=0;pi<Ui.circles.length;pi+=4)ss.circles.push(Ui.circles[pi+0]),ss.circles.push(Ui.circles[pi+1]),ss.circles.push(Ui.circles[pi+2]),ss.circles.push(Ui.collisionDetected?1:0)}const Us=S.projection.name!=="globe";Qt=Qt&&(Us||!Ti),Tr=Tr&&(Us||!Kn),this.placements[ri]=new Xn(Kr||Qt,Wn||Tr,en||S.justReloaded),l.add(ri)},oi=this.retainedQueryData[S.bucketInstanceId].tileID;if(S.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(S,oi),S.elevationType==="road"&&S.updateRoadElevation(oi.canonical),S.updateZOffset(),S.sortFeaturesByY){const Nr=S.getSortedSymbolIndexes(this.transform.angle);for(let Sn=Nr.length-1;Sn>=0;--Sn){const Xr=Nr[Sn];En(S.symbolInstances.get(Xr),Xr,S.collisionArrays[Xr])}S.hasAnyZOffset&&o.w(`${S.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(S.hasAnyZOffset){const Nr=S.getSortedIndexesByZOffset();for(let Sn=0;Sn<Nr.length;++Sn){const Xr=Nr[Sn];En(S.symbolInstances.get(Xr),Xr,S.collisionArrays[Xr])}}else for(let Nr=n.symbolInstanceStart;Nr<n.symbolInstanceEnd;Nr++)En(S.symbolInstances.get(Nr),Nr,S.collisionArrays[Nr]);if(m&&S.bucketInstanceId in this.collisionCircleArrays){const Nr=this.collisionCircleArrays[S.bucketInstanceId];o.bk(Nr.invProjMatrix,M),Nr.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(n,l,m,v){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:A,crossTileID:M}=m,D=o.c2(l),F=v===o.bK.vertical?A:D==="left"?w:D==="center"?S:D==="right"?C:-1;w>=0&&(n.text.placedSymbolArray.get(w).crossTileID=F>=0&&w!==F?0:M),S>=0&&(n.text.placedSymbolArray.get(S).crossTileID=F>=0&&S!==F?0:M),C>=0&&(n.text.placedSymbolArray.get(C).crossTileID=F>=0&&C!==F?0:M),A>=0&&(n.text.placedSymbolArray.get(A).crossTileID=F>=0&&A!==F?0:M)}markUsedOrientation(n,l,m){const v=l===o.bK.horizontal||l===o.bK.horizontalOnly?l:0,w=l===o.bK.vertical?l:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:M}=m,D=n.text.placedSymbolArray;S>=0&&(D.get(S).placedOrientation=v),C>=0&&(D.get(C).placedOrientation=v),A>=0&&(D.get(A).placedOrientation=v),M>=0&&(D.get(M).placedOrientation=w)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let m=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const v=l?l.symbolFadeChange(n):1,w=l?l.opacities:{},S=l?l.variableOffsets:{},C=l?l.placedOrientations:{};for(const A in this.placements){const M=this.placements[A],D=w[A];D?(this.opacities[A]=new Dn(D,v,M.text,M.icon,null,M.clipped),m=m||M.text!==D.text.placed||M.icon!==D.icon.placed):(this.opacities[A]=new Dn(null,v,M.text,M.icon,M.skipFade,M.clipped),m=m||M.text||M.icon)}for(const A in w){const M=w[A];if(!this.opacities[A]){const D=new Dn(M,v,!1,!1);D.isHidden()||(this.opacities[A]=D,m=m||M.text.placed||M.icon.placed)}}for(const A in S)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=S[A]);for(const A in C)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=C[A]);m?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:n)}updateLayerOpacities(n,l,m,v){const w=new Set;for(const S of l){const C=S.getBucket(n);C&&S.latestFeatureIndex&&n.fqid===C.layerIds[0]&&(this.updateBucketOpacities(C,w,S,S.collisionBoxArray,m,v,S.tileID,n.scope),C.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(C,S.tileID),C.elevationType==="road"&&C.updateRoadElevation(S.tileID.canonical),C.updateZOffset())}}updateBucketOpacities(n,l,m,v,w,S,C,A){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const M=n.layers[0].layout,D=n.layers[0].paint,F=!!n.layers[0].dynamicFilter(),O=new Dn(null,0,!1,!1,!0),q=M.get("text-allow-overlap"),Z=M.get("icon-allow-overlap"),Q=M.get("text-variable-anchor"),se=M.get("text-rotation-alignment")==="map",ne=M.get("text-pitch-alignment")==="map",ae=D.get("symbol-z-offset"),he=M.get("symbol-elevation-reference")==="sea",ce=!ae.isConstant(),we=new Dn(null,0,q&&(Z||!n.hasIconData()||M.get("icon-optional")),Z&&(q||!n.hasTextData()||M.get("text-optional")),!0);!n.collisionArrays&&v&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(v);const fe=(ve,ge,Ce)=>{for(let Fe=0;Fe<ge/4;Fe++)ve.opacityVertexArray.emplaceBack(Ce)};let Te=0;S&&n.updateReplacement(C,S);for(let ve=0;ve<n.symbolInstances.length;ve++){const ge=n.symbolInstances.get(ve),{numHorizontalGlyphVertices:Ce,numVerticalGlyphVertices:Fe,crossTileID:Oe,numIconVertices:st,tileAnchorX:He,tileAnchorY:ht}=ge;let Nt=null;const Ge=this.retainedQueryData[n.bucketInstanceId];ce&&ge&&Ge&&(Nt=m.latestFeatureIndex.loadFeature({featureIndex:ge.featureIndex,bucketIndex:Ge.bucketIndex,sourceLayerIndex:Ge.sourceLayerIndex,layoutVertexArrayOffset:0}));const Re=ae.evaluate(Nt,{}),ft=l.has(Oe);let Ze=this.opacities[Oe];ft?Ze=O:Ze||(Ze=we,this.opacities[Oe]=Ze),l.add(Oe);const wt=Ce>0||Fe>0,Ft=st>0,sr=this.placedOrientations[Oe],Rt=sr===o.bK.vertical,Lt=sr===o.bK.horizontal||sr===o.bK.horizontalOnly;!wt&&!Ft||Ze.isHidden()||Te++;let ar=!1;if((wt||Ft)&&S)for(const Jt of n.activeReplacements){if(o.bY(Jt,w,o.bZ.Symbol,A)||Jt.min.x>He||He>Jt.max.x||Jt.min.y>ht||ht>Jt.max.y)continue;const Zt=o.b_(He,ht,C.canonical,Jt.footprintTileId.canonical);if(ar=o.b$(Zt,Jt.footprint),ar)break}if(wt){const Jt=ar?Vs:pp(Ze.text);fe(n.text,Ce,Rt?Vs:Jt),fe(n.text,Fe,Lt?Vs:Jt);const Zt=Ze.text.isHidden(),{leftJustifiedTextSymbolIndex:Qt,centerJustifiedTextSymbolIndex:Tr,rightJustifiedTextSymbolIndex:pn,verticalPlacedTextSymbolIndex:En}=ge,oi=n.text.placedSymbolArray,Nr=Zt||Rt?1:0;Qt>=0&&(oi.get(Qt).hidden=Nr),Tr>=0&&(oi.get(Tr).hidden=Nr),pn>=0&&(oi.get(pn).hidden=Nr),En>=0&&(oi.get(En).hidden=Zt||Lt?1:0);const Sn=this.variableOffsets[Oe];Sn&&this.markUsedJustification(n,Sn.anchor,ge,sr);const Xr=this.placedOrientations[Oe];Xr&&(this.markUsedJustification(n,"left",ge,Xr),this.markUsedOrientation(n,Xr,ge))}if(Ft){const Jt=ar?Vs:pp(Ze.icon),{placedIconSymbolIndex:Zt,verticalPlacedIconSymbolIndex:Qt}=ge,Tr=n.icon.placedSymbolArray,pn=Ze.icon.isHidden()?1:0;Zt>=0&&(fe(n.icon,st,Rt?Vs:Jt),Tr.get(Zt).hidden=pn),Qt>=0&&(fe(n.icon,ge.numVerticalIconVertices,Lt?Vs:Jt),Tr.get(Qt).hidden=pn)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Jt=n.collisionArrays[ve];if(Jt){let Zt=new o.P(0,0),Qt=!0;if(Jt.textBox||Jt.verticalTextBox){if(Q){const pn=this.variableOffsets[Oe];pn?(Zt=up(pn.anchor,pn.width,pn.height,pn.textOffset,pn.textScale),se&&Zt._rotate(ne?this.transform.angle:-this.transform.angle)):Qt=!1}F&&(Qt=!Ze.clipped),Jt.textBox&&no(n.textCollisionBox.collisionVertexArray,Ze.text.placed,!Qt||Rt,Re,he,Zt.x,Zt.y),Jt.verticalTextBox&&no(n.textCollisionBox.collisionVertexArray,Ze.text.placed,!Qt||Lt,Re,he,Zt.x,Zt.y)}const Tr=Qt&&!!(!Lt&&Jt.verticalIconBox);Jt.iconBox&&no(n.iconCollisionBox.collisionVertexArray,Ze.icon.placed,Tr,Re,he,ge.hasIconTextFit?Zt.x:0,ge.hasIconTextFit?Zt.y:0),Jt.verticalIconBox&&no(n.iconCollisionBox.collisionVertexArray,Ze.icon.placed,!Tr,Re,he,ge.hasIconTextFit?Zt.x:0,ge.hasIconTextFit?Zt.y:0)}}}if(n.fullyClipped=Te===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const ve=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=ve.invProjMatrix,n.placementViewportMatrix=ve.viewportMatrix,n.collisionCircleArray=ve.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,l){const m=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*m>n}setStale(){this.stale=!0}}function no(p,n,l,m,v,w,S){p.emplaceBack(n?1:0,l?1:0,w||0,S||0,m,v?1:0),p.emplaceBack(n?1:0,l?1:0,w||0,S||0,m,v?1:0),p.emplaceBack(n?1:0,l?1:0,w||0,S||0,m,v?1:0),p.emplaceBack(n?1:0,l?1:0,w||0,S||0,m,v?1:0)}const Es=Math.pow(2,25),T2=Math.pow(2,24),hp=Math.pow(2,17),ev=Math.pow(2,16),fp=Math.pow(2,9),Wm=Math.pow(2,8),tv=Math.pow(2,1);function pp(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const n=p.placed?1:0,l=Math.floor(127*p.opacity);return l*Es+n*T2+l*hp+n*ev+l*fp+n*Wm+l*tv+n}const Vs=0;class xc{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,l,m,v,w,S){const C=this._bucketParts;for(;this._currentTileIndex<n.length;)if(l.getBucketParts(C,v,n[this._currentTileIndex],this._sortAcrossTiles,S),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((A,M)=>A.sortKey-M.sortKey));this._currentPartIndex<C.length;){const A=C[this._currentPartIndex];if(l.placeLayerBucketPart(A,this._seenCrossTileIDs,m,A.symbolInstanceStart===0,S),this._currentPartIndex++,w())return!0}return!1}}class Qo{constructor(n,l,m,v,w,S,C,A,M){this.placement=new dp(n,w,S,C,A,M),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(n,l,m,v,w){const S=o.o.now(),C=()=>{const A=o.o.now()-S;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=l[n[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=M)&&(!A.maxzoom||A.maxzoom>M)){const D=A,F=D.layout.get("symbol-z-elevate"),O=D.layout.get("symbol-sort-key").constantOr(1)!==void 0,q=D.layout.get("symbol-z-order"),Z=q==="viewport-y"||q==="auto"&&!(q!=="viewport-y"&&O),Q=D.layout.get("text-allow-overlap")||D.layout.get("icon-allow-overlap")||D.layout.get("text-ignore-placement")||D.layout.get("icon-ignore-placement"),se=Z&&Q,ne=this._inProgressLayer=this._inProgressLayer||new xc(D),ae=o.B(A.source,A.scope);if(ne.continuePlacement(F||se?v[ae]:m[ae],this.placement,this._showCollisionBoxes,A,C,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Hm=512/o.al/2;class sh{constructor(n,l,m){this.tileID=n,this.bucketInstanceId=m,this.index=new o.c3(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=n.canonical.x*o.al,w=n.canonical.y*o.al;for(let S=0;S<l.length;S++){const{key:C,crossTileID:A,tileAnchorX:M,tileAnchorY:D}=l.get(S),F=Math.floor((v+M)*Hm),O=Math.floor((w+D)*Hm);this.index.add(F,O),this.keys.push(C),this.crossTileIDs.push(A)}this.index.finish()}findMatches(n,l,m){const v=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),w=Hm/Math.pow(2,l.canonical.z-this.tileID.canonical.z),S=l.canonical.x*o.al,C=l.canonical.y*o.al;for(let A=0;A<n.length;A++){const M=n.get(A);if(M.crossTileID)continue;const{key:D,tileAnchorX:F,tileAnchorY:O}=M,q=Math.floor((S+F)*w),Z=Math.floor((C+O)*w),Q=this.index.range(q-v,Z-v,q+v,Z+v).sort((se,ne)=>se-ne);for(const se of Q){const ne=this.crossTileIDs[se];if(this.keys[se]===D&&!m.has(ne)){m.add(ne),M.crossTileID=ne;break}}}}}class zs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Kl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const l=Math.round((n-this.lng)/360);if(l!==0)for(const m in this.indexes){const v=this.indexes[m],w={};for(const S in v){const C=v[S];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+l),w[C.tileID.key]=C}this.indexes[m]=w}this.lng=n}addBucket(n,l,m){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let w=0;w<l.symbolInstances.length;w++)l.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const v=this.usedCrossTileIDs[n.overscaledZ];for(const w in this.indexes){const S=this.indexes[w];if(Number(w)>n.overscaledZ)for(const C in S){const A=S[C];A.tileID.isChildOf(n)&&A.findMatches(l.symbolInstances,n,v)}else{const C=S[n.scaledTo(Number(w)).key];C&&C.findMatches(l.symbolInstances,n,v)}}for(let w=0;w<l.symbolInstances.length;w++){const S=l.symbolInstances.get(w);S.crossTileID||(S.crossTileID=m.generate(),v.add(S.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new sh(n,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(n,l){for(const m of l.crossTileIDs)this.usedCrossTileIDs[n].delete(m)}removeStaleBuckets(n){let l=!1;for(const m in this.indexes){const v=this.indexes[m];for(const w in v)n[v[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,v[w]),delete v[w],l=!0)}return l}}class bc{constructor(){this.layerIndexes={},this.crossTileIDs=new zs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,l,m,v){let w=this.layerIndexes[n.fqid];w===void 0&&(w=this.layerIndexes[n.fqid]=new Kl);let S=!1;const C={};v.name!=="globe"&&w.handleWrapJump(m);for(const A of l){const M=A.getBucket(n);M&&n.fqid===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(A.tileID,M,this.crossTileIDs)&&(S=!0),C[M.bucketInstanceId]=!0)}return w.removeStaleBuckets(C)&&(S=!0),S}pruneUnusedLayers(n){const l={};n.forEach(m=>{l[m]=!0});for(const m in this.layerIndexes)l[m]||delete this.layerIndexes[m]}}const us=771;class Qr{constructor(n,l,m,v){this.blendFunction=n,this.blendColor=l.toNonPremultipliedRenderColor(null),this.mask=m,this.blendEquation=v}}Qr.Replace=[1,0,1,0],Qr.disabled=new Qr(Qr.Replace,o.ao.transparent,[!1,!1,!1,!1]),Qr.unblended=new Qr(Qr.Replace,o.ao.transparent,[!0,!0,!0,!0]),Qr.alphaBlended=new Qr([1,us,1,us],o.ao.transparent,[!0,!0,!0,!0]),Qr.alphaBlendedNonPremultiplied=new Qr([770,us,770,us],o.ao.transparent,[!0,!0,!0,!0]),Qr.multiply=new Qr([774,0,774,0],o.ao.transparent,[!0,!0,!0,!0]),Qr.additive=new Qr([1,1,1,1],o.ao.transparent,[!0,!0,!0,!0]);class cr{constructor(n,l,m){this.func=n,this.mask=l,this.range=m}}cr.ReadOnly=!1,cr.ReadWrite=!0,cr.disabled=new cr(519,cr.ReadOnly,[0,1]);const id=7680;class Br{constructor(n,l,m,v,w,S){this.test=n,this.ref=l,this.mask=m,this.fail=v,this.depthFail=w,this.pass=S}}Br.disabled=new Br({func:519,mask:0},0,0,id,id,id);const oh=1029,Zm=2305;class Dr{constructor(n,l,m){this.enable=n,this.mode=l,this.frontFace=m}}function mp(p,n){const l=o.c9(p,3);o.cb(p,n),o.cf(p,3,l)}function Xm(p,n){const l=o.c6([]);return o.c7(l,l,-n),o.c8(l,l,-p),l}function Bb(p,n){const l=[p[0],p[1],0],m=[n[0],n[1],0];if(o.ag(l)>=1e-15){const S=o.aw([],l);o.c4(m,S,o.bI(m,S)),n[0]=m[0],n[1]=m[1]}const v=o.bH([],n,p);if(o.c5(v)<1e-15)return null;const w=Math.atan2(-v[1],v[0]);return Xm(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),w)}Dr.disabled=new Dr(!1,oh,Zm),Dr.backCCW=new Dr(!0,oh,Zm),Dr.backCW=new Dr(!0,oh,2304),Dr.frontCW=new Dr(!0,1028,2304),Dr.frontCCW=new Dr(!0,1028,Zm);class Yl{constructor(n,l){this.position=n,this.orientation=l}get position(){return this._position}set position(n){if(n){const l=n instanceof o.ae?n:new o.ae(n[0],n[1],n[2]);this._renderWorldCopies&&(l.x=o.bS(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(n,l,m){if(this.orientation=null,!this.position)return;const v=this.position,w=m||(this._elevation?this._elevation.getAtPointOrZero(o.ae.fromLngLat(n)):0),S=o.ae.fromLngLat(n,w),C=[S.x-v.x,S.y-v.y,S.z-v.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=Bb(C,l)}setPitchBearing(n,l){this.orientation=Xm(o.an(n),o.an(-l))}}class Km{constructor(n,l){this._transform=o.bz([]),this.orientation=l,this.position=n}get mercatorPosition(){const n=this.position;return new o.ae(n[0],n[1],n[2])}get position(){const n=o.c9(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var l;n&&o.cf(this._transform,3,[(l=n)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||o.c6([]),n&&mp(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,l){this._orientation=Xm(n,l),mp(this._transform,this._orientation)}forward(){const n=o.c9(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=o.c9(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=o.c9(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,l){const m=new Float64Array(16);return o.bk(m,this.getWorldToCamera(n,l)),m}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,l,m){const v=this.position;o.c4(v,v,-n);const w=new Float64Array(16);return o.bp(w,[m,m,m]),o.bq(w,w,v),w[10]*=l,w}getWorldToCamera(n,l){const m=new Float64Array(16),v=new Float64Array(4),w=this.position;return o.ca(v,this._orientation),o.c4(w,w,-n),o.cb(m,v),o.bq(m,m,w),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=l,m[9]*=l,m[10]*=l,m[11]*=l,m}getCameraToClipPerspective(n,l,m,v){const w=new Float64Array(16);return o.cc(w,n,l,m,v),w}getCameraToClipOrthographic(n,l,m,v,w,S){const C=new Float64Array(16);return o.cd(C,n,l,m,v,w,S),C}getDistanceToElevation(n,l=!1){const m=n===0?0:o.ce(n,l?o.a_(this.position[1]):this.position[1]),v=this.forward();return(m-this.position[2])/v[2]}clone(){return new Km([...this.position],[...this.orientation])}}const io={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Oo{constructor(n=0,l=0,m=0,v=0){if(isNaN(n)||n<0||isNaN(l)||l<0||isNaN(m)||m<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=l,this.left=m,this.right=v}interpolate(n,l,m){return l.top!=null&&n.top!=null&&(this.top=o.ak(n.top,l.top,m)),l.bottom!=null&&n.bottom!=null&&(this.bottom=o.ak(n.bottom,l.bottom,m)),l.left!=null&&n.left!=null&&(this.left=o.ak(n.left,l.left,m)),l.right!=null&&n.right!=null&&(this.right=o.ak(n.right,l.right,m)),this}getCenter(n,l){const m=o.aA((this.left+n-this.right)/2,0,n),v=o.aA((this.top+l-this.bottom)/2,0,l);return new o.P(m,v)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Oo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const sd=15;class ah{constructor(n,l,m,v,w,S,C){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=n||0,this._maxZoom=l||22,this._minPitch=m??0,this._maxPitch=v??60,this.setProjection(S),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new o.aS(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Oo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Km,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const n=new ah(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n._allowWorldUnderZoom=this._allowWorldUnderZoom,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<sd}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,l=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(n||m)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return o.aH(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=o.cl(this.projectionOptions);const m=this.getProjection(),v=!o.bx(l,m);return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.cl({name:"mercator"});const l=n!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bS(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const l=-n*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=o.cm(),o.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const l=o.aA(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=o.an(n),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const l=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,l=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!l||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const m=this._elevation;l||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&m.exaggeration()&&this._centerAltitudeValidForExaggeration!==m.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*m.exaggeration(),this._centerAltitudeValidForExaggeration=m.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=m.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const n=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(n)}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let v=0,w=0;for(let S=0;S<l.length;S++){const C=new o.P(l[S][0]*this.width,m+l[S][1]*(this.height-m)),A=n.pointCoordinate(C);if(!A)continue;const M=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);v+=A[3]*M,w+=M}return w===0?NaN:v/w}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*l,v=this._mercatorZfromZoom(n),w=this._mercatorZfromZoom(this._maxZoom),S=Math.max(v-m,w);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let m;m=n.z<this._camera.position[2]?[l.x,l.y,l.z]:[n.x,n.y,n.z];const v=o.ag(o.av([],this._camera.position,m));return o.aA(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let l=!1;if(n.orientation&&!o.co(n.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(n.orientation)),n.position){const m=[n.position.x,n.position.y,n.position.z];o.cp(m,this._camera.position)||(this._setCameraPosition(m),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,l=new Yl;return l.position=new o.ae(n[0],n[1],n[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(n){if(!o.cq(n))return!1;o.cr(n,n);const l=o.cs([],[0,0,-1],n),m=o.cs([],[0,-1,0],n);if(m[2]<0)return!1;const v=Bb(l,m);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(n){const l=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;n[2]=o.aA(n[2],v/m,v/l),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,l,m){this._unmodified=!1,this._edgeInsets.interpolate(n,l,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const l=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(n){const l=[new o.ct(0,n)];if(this.renderWorldCopies){const m=this.pointCoordinate(new o.P(0,0)),v=this.pointCoordinate(new o.P(this.width,0)),w=this.pointCoordinate(new o.P(this.width,this.height)),S=this.pointCoordinate(new o.P(0,this.height)),C=Math.floor(Math.min(m.x,v.x,w.x,S.x)),A=Math.floor(Math.max(m.x,v.x,w.x,S.x)),M=1;for(let D=C-M;D<=A+M;D++)D!==0&&l.push(new o.ct(D,n))}return l}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(n,l,m){let v=[];const w=m!=null,S=!w;if(S&&this.zoom<l||w&&m[0]===0&&m[1]===0)return v;const C=new Set,A=(D,F,O,q,Z)=>{const Q=o.cX(F,D,O,q,Z);C.has(Q)||(v.push(new o.aP(D,F,O,q,Z)),C.add(Q))};for(let D=0;D<n.length;D++){const F=n[D];if(S&&F.canonical.z!==l)continue;const O=F.canonical,q=F.overscaledZ,Z=F.wrap,Q=1<<O.z,se=O.x+1<Q,ne=O.x>0,ae=O.y+1<Q,he=O.y>0,ce=F.wrap-(ne?0:1),we=F.wrap+(se?0:1),fe=ne?O.x-1:Q-1,Te=se?O.x+1:0;if(w)m[0]<0?(A(q,we,O.z,Te,O.y),m[1]<0&&ae&&(A(q,Z,O.z,O.x,O.y+1),A(q,we,O.z,Te,O.y+1)),m[1]>0&&he&&(A(q,Z,O.z,O.x,O.y-1),A(q,we,O.z,Te,O.y-1))):m[0]>0?(A(q,ce,O.z,fe,O.y),m[1]<0&&ae&&(A(q,Z,O.z,O.x,O.y+1),A(q,ce,O.z,fe,O.y+1)),m[1]>0&&he&&(A(q,Z,O.z,O.x,O.y-1),A(q,ce,O.z,fe,O.y-1))):m[1]<0&&ae?A(q,Z,O.z,O.x,O.y+1):he&&A(q,Z,O.z,O.x,O.y-1);else{const ve=F.visibleQuadrants;1&ve&&(A(q,ce,O.z,fe,O.y),he&&(A(q,Z,O.z,O.x,O.y-1),A(q,ce,O.z,fe,O.y-1))),2&ve&&(A(q,we,O.z,Te,O.y),he&&(A(q,Z,O.z,O.x,O.y-1),A(q,we,O.z,Te,O.y-1))),4&ve&&(A(q,ce,O.z,fe,O.y),ae&&(A(q,Z,O.z,O.x,O.y+1),A(q,ce,O.z,fe,O.y+1))),8&ve&&(A(q,we,O.z,Te,O.y),ae&&(A(q,Z,O.z,O.x,O.y+1),A(q,we,O.z,Te,O.y+1)))}}const M=[];for(const D of v)v.some(F=>D.isChildOf(F))||M.push(D);if(v=M.filter(D=>!n.some(F=>!!(D.overscaledZ<l&&F.isChildOf(D))||D.equals(F)||D.isChildOf(F))),S){const D=1<<l,F=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),O=[D*F.x,D*F.y],q=4,Z=q*q;v=v.filter(Q=>{const se=Q.canonical.x+.5-O[0],ne=Q.canonical.y+.5-O[1];return se*se+ne*ne<Z})}return v}extendTileCoverToNearPlane(n,l,m){const v=[],w=new Set;for(const ae of n)w.add(ae.key);const S=(ae,he,ce,we,fe)=>{const Te=o.cX(he,ae,ce,we,fe);w.has(Te)||(v.push(new o.aP(ae,he,ce,we,fe)),w.add(Te))},C=n.reduce((ae,he)=>Math.max(ae,he.overscaledZ),m),A=1<<m,M=[new o.P(0,0),new o.P(o.al,0),new o.P(o.al,o.al),new o.P(0,o.al)],D=new o.P(0,0),F=new o.P(0,0),O=(ae,he)=>{const ce=Math.floor(ae[0]),we=Math.floor(ae[1]),fe=(ae[0]-ce)*o.al,Te=(ae[1]-we)*o.al,ve=Math.floor(he[0]),ge=Math.floor(he[1]),Ce=(he[0]-ve)*o.al,Fe=(he[1]-ge)*o.al;for(let Oe=-1;Oe<=1;Oe++){const st=ce+Oe;if(!(st<0||st>=A)){D.x=fe-Oe*o.al,F.x=Ce-(st-ve)*o.al;for(let He=-1;He<=1;He++){const ht=we+He;D.y=Te-He*o.al,F.y=Fe-(ht-ge)*o.al,o.cY(D,F,M)&&S(C,0,m,st,ht)}}}},q=l.points,Z=q[o.cu],Q=q[o.cv],se=this._projectToGround(Z,q[o.cw]),ne=this._projectToGround(Q,q[o.cx]);return O(Z,se),O(Q,ne),v}_projectToGround(n,l){return o.cy(o.cz(),n,l,n[2]/(n[2]-l[2]))}coveringTiles(n){let l=this.coveringZoomLevel(n);const m=l,v=this.elevation&&this.elevation.exaggeration(),w=v&&!n.isTerrainDEM,S=this.projection.name==="mercator";if(n.minzoom!==void 0&&l<n.minzoom)return[];n.maxzoom!==void 0&&l>n.maxzoom&&(l=n.maxzoom);const C=this.locationCoordinate(this.center),A=this.center.lat,M=1<<l,D=[M*C.x,M*C.y,0],F=this.projection.name==="globe",O=!F,q=o.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,O),Z=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Q=M*o.ce(1,this.center.lat),se=this._camera.position[2]/o.ce(1,this.center.lat),ne=[M*Z.x,M*Z.y,se*(O?1:Q)],ae=F||v,he=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),ce=this.isLODDisabled(!0)?l:0;let we;if(this._elevation&&n.isTerrainDEM)we=1e4*this._elevation.exaggeration();else if(this._elevation){const Re=this._elevation.getMinMaxForVisibleTiles();we=Re?Re.max:this._centerAltitude}else we=this._centerAltitude;const fe=n.isTerrainDEM?-we:this._elevation?this._elevation.getMinElevationBelowMSL():0,Te=this.projection.isReprojectedInTileSpace?o.cB(this):1,ve=Re=>{const Ze=new o.ae(Re.x+25e-6,Re.y,Re.z),wt=new o.ae(Re.x,Re.y+25e-6,Re.z),Ft=Re.toLngLat(),sr=Ze.toLngLat(),Rt=wt.toLngLat(),Lt=this.locationCoordinate(Ft),ar=this.locationCoordinate(sr),Jt=this.locationCoordinate(Rt),Zt=Math.hypot(ar.x-Lt.x,ar.y-Lt.y),Qt=Math.hypot(Jt.x-Lt.x,Jt.y-Lt.y);return Math.sqrt(Zt*Qt)*Te/25e-6},ge=Re=>{const ft=we,Ze=fe;return{aabb:o.cE(this,M,0,0,0,Re,Ze,ft,this.projection),zoom:0,x:0,y:0,minZ:Ze,maxZ:ft,wrap:Re,fullyVisible:!1}},Ce=[];let Fe=[];const Oe=l,st=n.reparseOverscaled?m:l,He=(se-this._centerAltitude)*Q,ht=Re=>{if(!this._elevation||!Re.tileID||!S)return;const ft=this._elevation.getMinMaxForTile(Re.tileID),Ze=Re.aabb;ft?(Ze.min[2]=ft.min,Ze.max[2]=ft.max,Ze.center[2]=(Ze.min[2]+Ze.max[2])/2):(Re.shouldSplit=Ge(Re),Re.shouldSplit||(Ze.min[2]=Ze.max[2]=Ze.center[2]=this._centerAltitude))},Nt=(Re,ft)=>{if(.707*ft<Re)return 1;const Ze=ft/Re;return Ze/(1.4144271570014144+(Math.pow(1.1,Ze-1.4144271570014144+1)-1)/(1.1-1)-1)},Ge=Re=>{if(Re.zoom<ce)return!0;if(Re.zoom===Oe)return!1;if(Re.shouldSplit!=null)return Re.shouldSplit;const ft=Re.aabb.distanceX(ne),Ze=Re.aabb.distanceY(ne);let wt=He,Ft=1;if(F){wt=Re.aabb.distanceZ(ne);const Qt=Math.pow(2,Re.zoom),Tr=o.a_((Re.y+1)/Qt),pn=o.a_(Re.y/Qt),En=Math.min(Math.max(A,Tr),pn),oi=o.d0(En)/o.d0(A);if(Ft=En===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,oi/this._mercatorScaleRatio),this.zoom<=o.cZ&&Re.zoom===Oe-1&&oi>=.9)return!0}else if(w&&(wt=Re.aabb.distanceZ(ne)*Q),this.projection.isReprojectedInTileSpace&&m<=5){const Qt=Math.pow(2,Re.zoom),Tr=ve(new o.ae((Re.x+.5)/Qt,(Re.y+.5)/Qt));Ft=Tr>.85?1:Tr}if(!S&&!F){const Qt=Math.sqrt(ft*ft+Ze*Ze+wt*wt);let Tr=(1<<Oe-Re.zoom)*he*Ft;return Tr*=Nt(Math.max(wt,He),Qt),Qt<Tr}let sr=Number.MAX_VALUE,Rt=0;const Lt=Re.aabb.getCorners(),ar=[];for(const Qt of Lt){o.av(ar,Qt,ne),F||(w?ar[2]*=Q:ar[2]=He);const Tr=o.bI(ar,this._camera.forward());Tr<sr&&(sr=Tr,Rt=Math.abs(ar[2]))}let Jt=(1<<Oe-Re.zoom)*he*Ft;if(Jt*=Nt(Math.max(Rt,He),sr),sr<Jt)return!0;const Zt=Re.aabb.closestPoint(D);return Zt[0]===D[0]&&Zt[1]===D[1]};if(this.renderWorldCopies)for(let Re=1;Re<=3;Re++)Ce.push(ge(-Re)),Ce.push(ge(Re));for(Ce.push(ge(0));Ce.length>0;){const Re=Ce.pop(),ft=Re.x,Ze=Re.y;let wt=Re.fullyVisible;const Ft=()=>this.projection.name==="globe"&&(Re.y===0||Re.y===(1<<Re.zoom)-1);if(!wt){let sr=ae?Re.aabb.intersects(q):Re.aabb.intersectsFlat(q);if(sr===0&&Ft()){const Rt=new o.cC(Re.zoom,ft,Ze);sr=o.cD(this,M,Rt,!0).intersects(q)}if(sr===0)continue;wt=sr===2}if(Re.zoom!==Oe&&Ge(Re))for(let sr=0;sr<4;sr++){const Rt=(ft<<1)+sr%2,Lt=(Ze<<1)+(sr>>1),ar={aabb:S?Re.aabb.quadrant(sr):o.cE(this,M,Re.zoom+1,Rt,Lt,Re.wrap,Re.minZ,Re.maxZ,this.projection),zoom:Re.zoom+1,x:Rt,y:Lt,wrap:Re.wrap,fullyVisible:wt,tileID:void 0,shouldSplit:void 0,minZ:Re.minZ,maxZ:Re.maxZ};w&&!F&&(ar.tileID=new o.aP(Re.zoom+1===Oe?st:Re.zoom+1,Re.wrap,Re.zoom+1,Rt,Lt),ht(ar)),Ce.push(ar)}else{const sr=Re.zoom===Oe?st:Re.zoom;if(n.minzoom&&n.minzoom>sr)continue;let Rt=0;if(!wt){let Zt=ae?Re.aabb.intersectsPrecise(q):Re.aabb.intersectsPreciseFlat(q);if(Zt===0&&Ft()){const Qt=new o.cC(Re.zoom,ft,Ze);Zt=o.cD(this,M,Qt,!0).intersectsPrecise(q)}if(Zt===0)continue;if(n.calculateQuadrantVisibility)if(q.containsPoint(Re.aabb.center))Rt=15;else for(let Qt=0;Qt<4;Qt++)Re.aabb.quadrant(Qt).intersects(q)!==0&&(Rt|=1<<Qt)}const Lt=D[0]-(.5+ft+(Re.wrap<<Re.zoom))*(1<<l-Re.zoom),ar=D[1]-.5-Ze,Jt=Re.tileID?Re.tileID:new o.aP(sr,Re.wrap,Re.zoom,ft,Ze);n.calculateQuadrantVisibility&&(Jt.visibleQuadrants=Rt),Fe.push({tileID:Jt,distanceSq:Lt*Lt+ar*ar})}}if(this.fogCullDistSq){const Re=this.fogCullDistSq,ft=this.horizonLineFromTop();Fe=Fe.filter(Ze=>{const wt=[0,0,0,1],Ft=[o.al,o.al,0,1],sr=this.calculateFogTileMatrix(Ze.tileID.toUnwrapped());o.aC(wt,wt,sr),o.aC(Ft,Ft,sr);const Rt=o.cF([],wt,Ft),Lt=o.cG([],wt,Ft),ar=o.c_(Rt,Lt);if(ar===0)return!0;let Jt=!1;const Zt=this._elevation;if(Zt&&ar>Re&&ft!==0){const Qt=this.calculateProjMatrix(Ze.tileID.toUnwrapped());let Tr;n.isTerrainDEM||(Tr=Zt.getMinMaxForTile(Ze.tileID)),Tr||(Tr={min:fe,max:we});const pn=o.cH(this.rotation),En=[pn[0]*o.al,pn[1]*o.al,Tr.max];o.af(En,En,Qt),Jt=(1-En[1])*this.height*.5<ft}return ar<Re||Jt})}return Fe.sort((Re,ft)=>Re.distanceSq-ft.distanceSq).map(Re=>Re.tileID)}resize(n,l){this.width=n,this.height=l,this.pixelsToGLUnits=[2/n,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log2(n)}project(n){const l=o.aA(n.lat,-o.cI,o.cI),m=this.projection.project(n.lng,l);return new o.P(m.x*this.worldSize,m.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,l){let m,v;const w=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;m=(l.x-w.x)/C,v=(l.y-w.y)/C}else{const C=this.pointCoordinate(l),A=this.pointCoordinate(w);m=C.x-A.x,v=C.y-A.y}const S=this.locationCoordinate(n);this.setLocation(new o.ae(S.x-m,S.y-v))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n,l){return this.projection.locationPoint(this,n,l)}locationPoint3D(n,l){return this.projection.locationPoint(this,n,l,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n,l){return this.coordinateLocation(this.pointCoordinate3D(n,l))}locationCoordinate(n,l){const m=l?o.ce(l,n.lat):void 0,v=this.projection.project(n.lng,n.lat);return new o.ae(v.x,v.y,m)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,l){const m=l??this._centerAltitude,v=[n.x,n.y,0,1],w=[n.x,n.y,1,1];o.aC(v,v,this.pixelMatrixInverse),o.aC(w,w,this.pixelMatrixInverse);const S=w[3];o.cJ(v,v,1/v[3]),o.cJ(w,w,1/S);const C=v[2],A=w[2];return{p0:v,p1:w,t:C===A?0:(m-C)/(A-C)}}screenPointToMercatorRay(n){const l=[n.x,n.y,0,1],m=[n.x,n.y,1,1];return o.aC(l,l,this.pixelMatrixInverse),o.aC(m,m,this.pixelMatrixInverse),o.cJ(l,l,1/l[3]),o.cJ(m,m,1/m[3]),l[2]=o.ce(l[2],this._center.lat)*this.worldSize,m[2]=o.ce(m[2],this._center.lat)*this.worldSize,o.cJ(l,l,1/this.worldSize),o.cJ(m,m,1/this.worldSize),new o.ax([l[0],l[1],l[2]],o.aw([],o.av([],m,l)))}rayIntersectionCoordinate(n){const{p0:l,p1:m,t:v}=n,w=o.ce(l[2],this._center.lat),S=o.ce(m[2],this._center.lat);return new o.ae(o.ak(l[0],m[0],v)/this.worldSize,o.ak(l[1],m[1],v)/this.worldSize,o.ak(w,S,v))}pointCoordinate(n,l=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,l)}pointCoordinate3D(n,l){if(!this.elevation)return this.pointCoordinate(n,l);let m=this.projection.pointCoordinate3D(this,n.x,n.y);if(m)return new o.ae(m[0],m[1],m[2]);let v=0,w=this.horizonLineFromTop();if(n.y>w)return this.pointCoordinate(n,l);const S=.02*w,C=n.clone();for(let A=0;A<10&&w-v>S;A++){C.y=o.ak(v,w,.66);const M=this.projection.pointCoordinate3D(this,C.x,C.y);M?(w=C.y,m=M):v=C.y}return m?new o.ae(m[0],m[1],m[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=o.cK)return!this.isPointAboveHorizon(n);const l=this.pointCoordinate(n);return l.y>=0&&l.y<=1}_coordinatePoint(n,l){const m=l&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,v=[n.x*this.worldSize,n.y*this.worldSize,m+n.toAltitude(),1];return o.aC(v,v,this.pixelMatrix),v[3]>0?new o.P(v[0]/v[3],v[1]/v[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:l}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,w=this.pointLocation3D(new o.P(l,n)),S=this.pointLocation3D(new o.P(v,n)),C=this.pointLocation3D(new o.P(v,m)),A=this.pointLocation3D(new o.P(l,m));let M=Math.min(w.lng,S.lng,C.lng,A.lng),D=Math.max(w.lng,S.lng,C.lng,A.lng),F=Math.min(w.lat,S.lat,C.lat,A.lat),O=Math.max(w.lat,S.lat,C.lat,A.lat);const q=Math.pow(2,-this.zoom)/16*270,Z=this.projection.name==="globe"?1:4,Q=(se,ne,ae,he,ce)=>{const we=(se+ae)/2,fe=(ne+he)/2,Te=new o.P(we,fe),{lng:ve,lat:ge}=this.pointLocation3D(Te),Ce=Math.max(0,M-ve,F-ge,ve-D,ge-O);M=Math.min(M,ve),D=Math.max(D,ve),F=Math.min(F,ge),O=Math.max(O,ge),(ce<Z||Ce>q)&&(Q(se,ne,we,fe,ce+1),Q(we,fe,ae,he,ce+1))};if(Q(l,n,v,n,1),Q(v,n,v,m,1),Q(v,m,l,m,1),Q(l,m,l,n,1),this.projection.name==="globe"){const[se,ne]=o.cL(this);se?(O=90,D=180,M=-180):ne&&(F=-90,D=180,M=-180)}return new o.aI(new o.aS(M,F),new o.aS(D,O))}_getBoundsRectangular(n,l){const{top:m,left:v}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,C=new o.P(v,m),A=new o.P(S,m),M=new o.P(S,w),D=new o.P(v,w);let F=this.pointCoordinate(C,n),O=this.pointCoordinate(A,n);const q=this.pointCoordinate(M,l),Z=this.pointCoordinate(D,l),Q=(se,ne)=>(ne.y-se.y)/(ne.x-se.x);return F.y>1&&O.y>=0?F=new o.ae((1-Z.y)/Q(Z,F)+Z.x,1):F.y<0&&O.y<=1&&(F=new o.ae(-Z.y/Q(Z,F)+Z.x,0)),O.y>1&&F.y>=0?O=new o.ae((1-q.y)/Q(q,O)+q.x,1):O.y<0&&F.y<=1&&(O=new o.ae(-q.y/Q(q,O)+q.x,0)),new o.aI().extend(this.coordinateLocation(F)).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(q))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const l=n.visibleDemTiles.reduce((m,v)=>{if(v.dem){const w=v.dem.tree;m.min=Math.min(m.min,w.minimums[0]),m.max=Math.max(m.max,w.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*n.exaggeration(),l.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,m=this.height/2-l*(1-this._horizonShift);return n?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-o.cI,this.maxLat=o.cI,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aF(this.minLng)*this.tileSize,this.worldMaxX=o.aF(this.maxLng)*this.tileSize,this.worldMinY=o.aJ(this.maxLat)*this.tileSize,this.worldMaxY=o.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,l){return this.projection.createTileMatrix(this,l,n)}calculateDistanceTileData(n){const l=n.key,m=this._distanceTileDataCache;if(m[l])return m[l];const v=n.canonical,w=1/this.height,S=this.cameraWorldSize,C=S/this.zoomScale(v.z),A=(v.x+Math.pow(2,v.z)*n.wrap)*C,M=v.y*C,D=this.point;D.x*=S/this.worldSize,D.y*=S/this.worldSize;const F=this.angle,O=Math.sin(-F),q=-Math.cos(-F);return m[l]={bearing:[O,q],center:[(D.x-A)*w,(D.y-M)*w],scale:C/o.al*w},m[l]}calculateFogTileMatrix(n){const l=n.key,m=this._fogTileMatrixCache;if(m[l])return m[l];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return o.aB(v,this.worldToFogMatrix,v),m[l]=new Float32Array(v),m[l]}calculateProjMatrix(n,l=!1,m=!1){const v=n.key;let w;if(w=m?this._expandedProjMatrixCache:l?this._alignedProjMatrixCache:this._projMatrixCache,w[v])return w[v];const S=this.calculatePosMatrix(n,this.worldSize);let C;return C=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:m?this.expandedFarZProjMatrix:l?this.alignedProjMatrix:this.projMatrix,o.aB(S,C,S),w[v]=new Float32Array(S),w[v]}calculatePixelsToTileUnitsMatrix(n){const l=n.tileID.key,m=this._pixelsToTileUnitsCache;if(m[l])return m[l];const v=o.cM(n,this);return m[l]=v,m[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,l=o.bp([],[n,n,n]);return o.aB(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const l=o.ce(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(l),v=this._camera.forward(),w=o.ce(1,this._center.lat);m[2]/=w,v[2]/=w,o.aw(v,v);const S=n.raycast(m,v,n.exaggeration());if(S){const C=o.bG([],m,v,S),A=new o.ae(C[0],C[1],o.ce(C[2],o.a_(C[1]))),M=(A.z+o.ag([A.x-m[0],A.y-m[1],A.z-m[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(M),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const l=this._elevation,m=o.ce(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(m),w=l.getAtPointOrZero(new o.ae(...v)),S=this.pixelsPerMeter/this.worldSize*w,C=this._minimumHeightOverTerrain(),A=v[2]-S;if(A<=C)if(A<0||n){const M=this.locationCoordinate(this._center,this._centerAltitude),D=[v[0],v[1],M.z-v[2]],F=o.ag(D);D[2]-=(C-A)/this._pixelsPerMercatorPixel;const O=o.ag(D);if(O===0)return;o.c4(D,D,F/O*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],M.z*this._pixelsPerMercatorPixel-D[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const O=this.center;return O.lat=o.aA(O.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(O.lng=o.aA(O.lng,this.minLng,this.maxLng)),this.center=O,void(this._constraining=!1)}const l=this._unmodified,{x:m,y:v}=this.point;let w=0,S=m,C=v;const A=this.width/2,M=this.height/2,D=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(v-M<D&&(C=D+M),v+M>F&&(C=F-M),F-D<this.height&&(w=Math.max(w,this.height/(F-D)),C=(F+D)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const O=this.worldMinX*this.scale,q=this.worldMaxX*this.scale,Z=this.worldSize/2-(O+q)/2;S=(m+Z+this.worldSize)%this.worldSize-Z,S-A<O&&(S=O+A),S+A>q&&(S=q-A),q-O<this.width&&(w=Math.max(w,this.width/(q-O)),S=(q+O)/2)}S===m&&C===v||this._allowWorldUnderZoom||(this.center=this.unproject(new o.P(S,C))),w&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,l=this.projection.name==="globe",m=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.ce(1,this.center.lat)/o.ce(1,o.d1));const v=o.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this.projection.zAxisUnit==="meters"?m:1,S=this._camera.getWorldToCamera(this.worldSize,w);let C;const A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(A[8]=2*-n.x/this.width,A[9]=2*n.y/this.height,this.isOrthographic){let ge=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ce=ge*this.aspect,Fe=-Ce,Oe=-ge;Ce-=n.x,Fe-=n.x,ge+=n.y,Oe+=n.y,C=this._camera.getCameraToClipOrthographic(Fe,Ce,Oe,ge,this._nearZ,this._farZ),((st,He,ht,Nt)=>{for(let Ge=0;Ge<16;Ge++)st[Ge]=o.ak(He[Ge],ht[Ge],Nt)})(C,C,A,o.c$(this.pitch>=sd?1:this.pitch/sd))}else C=A;const M=o.cO([],A,S);let D=o.cO([],C,S);if(this.projection.isReprojectedInTileSpace){const ge=this.locationCoordinate(this.center),Ce=o.bz([]);o.bq(Ce,Ce,[ge.x*this.worldSize,ge.y*this.worldSize,0]),o.aB(Ce,Ce,o.cP(this)),o.bq(Ce,Ce,[-ge.x*this.worldSize,-ge.y*this.worldSize,0]),o.aB(D,D,Ce),o.aB(M,M,Ce),this.inverseAdjustmentMatrix=o.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.cR([],D,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=D,this.invProjMatrix=o.bk(new Float64Array(16),this.projMatrix),l){const ge=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ge[8]=2*-n.x/this.width,ge[9]=2*n.y/this.height,this.expandedFarZProjMatrix=o.cO([],ge,S)}else this.expandedFarZProjMatrix=this.projMatrix;const F=o.bk([],C);this.frustumCorners=o.cS.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!l);const O=new Float32Array(16);o.bz(O),o.cR(O,O,[1,-1,1]),o.cT(O,O,this._pitch),o.bA(O,O,this.angle);const q=o.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.by(q);const Z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;q[8]=2*-n.x/this.width,q[9]=2*(n.y+Z)/this.height,this.skyboxMatrix=o.aB(O,q,O);const Q=this.point,se=Q.x,ne=Q.y,ae=this.width%2/2,he=this.height%2/2,ce=Math.cos(this.angle),we=Math.sin(this.angle),fe=se-Math.round(se)+ce*ae+we*he,Te=ne-Math.round(ne)+ce*he+we*ae,ve=new Float64Array(D);if(o.bq(ve,ve,[fe>.5?fe-1:fe,Te>.5?Te-1:Te,0]),this.alignedProjMatrix=ve,D=o.bB(),o.cR(D,D,[this.width/2,-this.height/2,1]),o.bq(D,D,[1,-1,0]),this.labelPlaneMatrix=D,D=o.bB(),o.cR(D,D,[1,-1,1]),o.bq(D,D,[-1,-1,0]),o.cR(D,D,[2/this.width,2/this.height,1]),this.glCoordMatrix=D,this.pixelMatrix=o.aB(new Float64Array(16),this.labelPlaneMatrix,M),this._calcFogMatrices(),this._distanceTileDataCache={},D=o.bk(new Float64Array(16),this.pixelMatrix),!D)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=D,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.cU(this);const ge=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.af(ge,ge,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=D;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,m=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,w=[n,n,l];o.c4(w,w,v),o.c4(m,m,-1),o.cV(m,m,w);const S=o.bB();o.bq(S,S,m),o.cR(S,S,w),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,l,v)}_computeCameraPosition(n){const l=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),v=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-n/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-m[0]*w,v.y/this.worldSize-m[1]*w,n/this.worldSize*this._centerAltitude-m[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],v=n[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(w=Math.min((l-m)/v,1)),this._camera.position=o.bG([],this._camera.position,n,w),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,l=this._camera.forward(),{pitch:m,bearing:v}=this._camera.getPitchBearing(),w=o.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.an(this._maxPitch)),C=Math.max((n[2]-w)/Math.cos(m),S),A=this._zoomFromMercatorZ(C);o.bG(n,n,l,C),this._pitch=o.aA(m,o.an(this.minPitch),o.an(this.maxPitch)),this.angle=o.bS(v,-Math.PI,Math.PI),this._setZoom(o.aA(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.ae(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,n)*this.tileSize))}zoomFromMercatorZAdjusted(n){let l=0,m=o.cK,v=0,w=1/0;for(;m-l>1e-6&&m>l;){const S=l+.5*(m-l),C=this.tileSize*Math.pow(2,S),A=this.getCameraToCenterDistance(this.projection,S,C),M=this.scaleZoom(A/(Math.max(0,n)*this.tileSize)),D=Math.abs(S-M);D<w&&(w=D,v=S),S<M?l=S:m=S}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,l){const m=Math.min(n.x,l.x),v=Math.max(n.x,l.x),w=Math.min(n.y,l.y),S=Math.max(n.y,l.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new o.P(m,w),new o.P(v,S),new o.P(m,S),new o.P(v,w)],A=this.renderWorldCopies?-3:0,M=this.renderWorldCopies?4:1;for(const D of C){const F=this.pointRayIntersection(D);if(F.t<0)return!0;const O=this.rayIntersectionCoordinate(F);if(O.x<A||O.y<0||O.x>M||O.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(n,l){const m=o.ag(o.av([],this._camera.position,n)),v=this._zoomFromMercatorZ(m)+l;return m-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([l,m,v],w){const S=[l,m,v,1];o.aC(S,S,w);const C=S[3]=Math.max(S[3],1e-6);return S[0]/=C,S[1]/=C,S[2]/=C,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,n))}}getCameraToCenterDistance(n,l=this.zoom,m=this.worldSize){const v=o.cN(n,l,this.width,this.height,1024),w=n.pixelSpaceConversion(this.center.lat,m,v);let S=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(S=o.ak(1,S,o.c$(this.pitch>=sd?1:this.pitch/sd))),S}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.aB(n,n,this.globeMatrix),n}getFrustum(n){return o.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const wc=(p,n)=>{if(n>0&&p.terrain&&o.w("Cutoff is currently disabled on terrain"),n<=0||p.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const l=p.transform,m=Math.max(Math.abs(l._zoom-(p.minCutoffZoom-1)),1),v=l.isLODDisabled(!1)?o.ah(60,45,l.pitch):o.ah(30,15,l.pitch),w=l._farZ-l._nearZ,S=n*l.height,C=((1-(A=v))*l.cameraToCenterDistance+A*(l._farZ+S))*m;var A;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[l._nearZ,l._farZ,(C-l._nearZ)/w,(C-S-l._nearZ)/w]}}},so={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class E2{constructor(n,l){this.aabb=n,this.lastCascade=l}}class C2{add(n,l){const m=this.receivers[n.key];m!==void 0?(m.aabb.min[0]=Math.min(m.aabb.min[0],l.min[0]),m.aabb.min[1]=Math.min(m.aabb.min[1],l.min[1]),m.aabb.min[2]=Math.min(m.aabb.min[2],l.min[2]),m.aabb.max[0]=Math.max(m.aabb.max[0],l.max[0]),m.aabb.max[1]=Math.max(m.aabb.max[1],l.max[1]),m.aabb.max[2]=Math.max(m.aabb.max[2],l.max[2])):this.receivers[n.key]=new E2(l,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,l,m){const v=o.d8.fromPoints(n.points);let w=0;for(const S in this.receivers){const C=this.receivers[S];if(!C||!v.intersectsAabb(C.aabb))continue;C.aabb.min=v.closestPoint(C.aabb.min),C.aabb.max=v.closestPoint(C.aabb.max);const A=C.aabb.getCorners();for(let M=0;M<m.length;M++){let D=!0;for(const F of A){const O=[F[0]*l,F[1]*l,F[2]];if(o.af(O,O,m[M].matrix),O[0]<-1||O[0]>1||O[1]<-1||O[1]>1){D=!1;break}}if(C.lastCascade=M,w=Math.max(w,M),D)break}}return w+1}}class gp{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new C2,this._depthMode=new cr(n.context.gl.LEQUAL,cr.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,n.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),n.tp.registerParameter(so,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(so,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),n.tp.registerParameter(so,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),n.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,l){const m=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!l||!l.properties)return;const v=l.properties.get("shadow-intensity");if(!l.shadowsEnabled()||v<=0||(this._shadowLayerCount=m.style.order.reduce((Z,Q)=>{const se=m.style._mergedLayers[Q];return Z+(se.hasShadowPass()&&!se.isHidden(n.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const w=m.context,S=so.shadowMapResolution,C=so.shadowMapResolution;if(this._cascades.length===0||so.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Z=0;Z<so.cascadeCount;++Z){const Q=m._shadowMapDebug,se=w.gl,ne=w.createFramebuffer(S,C,Q,"texture"),ae=new o.T(w,{width:S,height:C,data:null},se.DEPTH_COMPONENT16);if(ne.depthAttachment.set(ae.texture),Q){const he=new o.T(w,{width:S,height:C,data:null},se.RGBA8);ne.colorAttachment.set(he.texture)}this._cascades.push({framebuffer:ne,texture:ae,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.cA,scale:0})}}this.shadowDirection=Vb(l);let A=0;if(n.elevation){const Z=n.elevation,Q=[1e4,-1e4];Z.visibleDemTiles.filter(se=>se.dem).forEach(se=>{const ne=se.dem.tree;Q[0]=Math.min(Q[0],ne.minimums[0]),Q[1]=Math.max(Q[1],ne.maximums[0])}),Q[0]!==1e4&&(A=(Q[1]-Q[0])*Z.exaggeration())}const M=1.5*n.cameraToCenterDistance,D=3*M,F=new Float64Array(16);for(let Z=0;Z<this._cascades.length;++Z){const Q=this._cascades[Z];let se=n.height/50,ne=1;so.cascadeCount===1?ne=D:Z===0?ne=M:(se=M,ne=D);const[ae,he]=Ub(n,this.shadowDirection,se,ne,so.shadowMapResolution,A);Q.scale=n.scale,Q.matrix=ae,Q.boundingSphereRadius=he,o.bk(F,Q.matrix),Q.frustum=o.cA.fromInvProjectionMatrix(F,1,0,!0),Q.far=ne}const O=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[O].far,this._cascades[O].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/so.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=so.shadowMapResolution,this._uniformValues.u_shadowmap_0=io.ShadowMap0,this._uniformValues.u_shadowmap_1=io.ShadowMap0+1,this._groundShadowTiles=m.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const q=m.transform.elevation;for(const Z of this._groundShadowTiles){let Q={min:0,max:0};if(q){const se=q.getMinMaxForTile(Z);se&&(Q=se)}this.addShadowReceiver(Z.toUnwrapped(),Q.min,Q.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,l){if(!this.enabled)return;const m=this.painter,v=m.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(m.transform.getFrustum(0),m.transform.worldSize,this._cascades),v.viewport.set([0,0,so.shadowMapResolution,so.shadowMapResolution]);for(let w=0;w<this._numCascadesToRender;++w){m.currentShadowCascade=w,v.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),v.clear({color:o.ao.white,depth:1});for(const S of n.order){const C=n._mergedLayers[S];if(!C.hasShadowPass()||C.isHidden(m.transform.zoom))continue;const A=n.getLayerSourceCache(C),M=A?l[A.id]:void 0;(C.type==="model"||M&&M.length)&&m.renderLayer(m,A,C,M)}}m.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const n=this.painter,l=n.style,m=n.context,v=m.gl,w=l.directionalLight,S=l.ambientLight;if(!w||!S)return;const C=[],A=wc(n,n.longestCutoffRange);A.shouldRenderCutoff&&C.push("RENDER_CUTOFF"),C.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&C.push("NORMAL_OFFSET");const M=il(l,w,S),D=new cr(v.LEQUAL,cr.ReadOnly,n.depthRangeFor3D),F=new Br({func:v.EQUAL,mask:255},0,255,v.KEEP,v.KEEP,v.KEEP);for(const O of this._groundShadowTiles){const q=O.toUnwrapped(),Z=n.isTileAffectedByFog(O),Q=n.getOrCreateProgram("groundShadow",{defines:C,overrideFog:Z});this.setupShadows(q,Q),n.uploadCommonUniforms(m,Q,q,null,A);const se={u_matrix:n.transform.calculateProjMatrix(q),u_ground_shadow_factor:M};Q.draw(n,v.TRIANGLES,D,F,Qr.multiply,Dr.disabled,se,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,null,n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Qr.unblended:Qr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){const l=this.painter.transform,m=l.calculatePosMatrix(n,l.worldSize);return o.aB(m,this._cascades[this.painter.currentShadowCascade].matrix,m),Float32Array.from(m)}calculateShadowPassMatrixFromMatrix(n){const l=o.by(n);return o.aB(l,this._cascades[this.painter.currentShadowCascade].matrix,n),l}setupShadows(n,l,m){if(!this.enabled)return;const v=this.painter.transform,w=this.painter.context,S=w.gl,C=this._uniformValues,A=new Float64Array(16),M=v.calculatePosMatrix(n,v.worldSize);for(let D=0;D<this._cascades.length;D++)o.aB(A,this._cascades[D].matrix,M),C[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),w.activeTexture.set(S.TEXTURE0+io.ShadowMap0+D),this._cascades[D].texture.bindExtraParam(S.LINEAR,S.LINEAR,S.CLAMP_TO_EDGE,S.CLAMP_TO_EDGE,S.GREATER);if(this.useNormalOffset=!!m,this.useNormalOffset){const D=o.d6(n.canonical),F=2/v.tileSize*o.al/so.shadowMapResolution,O=F*this._cascades[0].boundingSphereRadius,q=F*this._cascades[this._cascades.length-1].boundingSphereRadius,Z=(m==="vector-tile"?1:3)*function(Q,se,ne,ae,he){const ce=o.aA((Q-22)/-22,0,1);return .125*(1-ce)+4*ce}(v.zoom);C.u_shadow_normal_offset=[D,O*Z,q*Z],C.u_shadow_bias=[1e-4,.0012,.012]}else C.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(w,C)}setupShadowsFromMatrix(n,l,m=!1){if(!this.enabled)return;const v=this.painter.context,w=v.gl,S=this._uniformValues,C=new Float64Array(16);for(let A=0;A<so.cascadeCount;A++)o.aB(C,this._cascades[A].matrix,n),S[A===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),v.activeTexture.set(w.TEXTURE0+io.ShadowMap0+A),this._cascades[A].texture.bindExtraParam(w.LINEAR,w.LINEAR,w.CLAMP_TO_EDGE,w.CLAMP_TO_EDGE,w.GREATER);if(this.useNormalOffset=m,m){const A=so.normalOffset;S.u_shadow_normal_offset=[1,A,A],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(v,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,l,m,v){if(v[2]>=0)return{};const w=function(A,M,D){const F=D/(1<<A.canonical.z);return new o.d8([A.canonical.x*F+A.wrap*D,A.canonical.y*F+A.wrap*D,0],[(A.canonical.x+1)*F+A.wrap*D,(A.canonical.y+1)*F+A.wrap*D,M])}(n,l,m).getCorners(),S=l/-v[2];v[0]<0?(o.d7(w[0],w[0],[v[0]*S,0,0]),o.d7(w[3],w[3],[v[0]*S,0,0])):v[0]>0&&(o.d7(w[1],w[1],[v[0]*S,0,0]),o.d7(w[2],w[2],[v[0]*S,0,0])),v[1]<0?(o.d7(w[0],w[0],[0,v[1]*S,0]),o.d7(w[1],w[1],[0,v[1]*S,0])):v[1]>0&&(o.d7(w[2],w[2],[0,v[1]*S,0]),o.d7(w[3],w[3],[0,v[1]*S,0]));const C={};return C.vertices=w,C.planes=[hu(w[1],w[0],w[4]),hu(w[2],w[1],w[5]),hu(w[3],w[2],w[6]),hu(w[0],w[3],w[7])],C}addShadowReceiver(n,l,m){this._receivers.add(n,o.d8.fromTileIdAndHeight(n,l,m))}getMaxCascadeForTile(n){const l=this._receivers.get(n);return l&&l.lastCascade?l.lastCascade:0}}function hu(p,n,l){const m=o.av([],l,n),v=o.av([],p,n),w=o.bH([],m,v),S=o.ag(w);return S===0?[0,0,1,0]:(o.c4(w,w,1/S),[w[0],w[1],w[2],-o.bI(w,n)])}function Vb(p){const n=p.properties.get("direction"),l=o.d3(n.x,n.y,n.z);l[2]=o.aA(l[2],0,75);const m=o.d5([l[0],l[1],l[2]]);return o.d4(m.x,m.y,m.z)}function il(p,n,l){const m=n.properties.get("color-use-theme")==="none",v=n.properties.get("color"),w=n.properties.get("intensity"),S=n.properties.get("direction"),C=[S.x,S.y,S.z],A=l.properties.get("color-use-theme")==="none",M=l.properties.get("color"),D=l.properties.get("intensity"),F=Math.max(o.bI([0,0,1],C),0),O=[0,0,0];o.c4(O,M.toPremultipliedRenderColor(A?null:p.getLut(n.scope)).toArray01Linear().slice(0,3),D);const q=[0,0,0];return o.c4(q,v.toPremultipliedRenderColor(m?null:p.getLut(l.scope)).toArray01Linear().slice(0,3),F*w),o.da([O[0]>0?O[0]/(O[0]+q[0]):0,O[1]>0?O[1]/(O[1]+q[1]):0,O[2]>0?O[2]/(O[2]+q[2]):0])}function Ub(p,n,l,m,v,w){const S=p.zoom,C=p.scale,A=p.worldSize,M=1/A,D=p.aspect,F=Math.sqrt(1+D*D)*Math.tan(.5*p.fovX),O=F*F,q=m-l,Z=m+l;let Q,se;O>q/Z?(Q=m,se=m*F):(Q=.5*Z*(1+O),se=.5*Math.sqrt(q*q+2*(m*m+l*l)*O+Z*Z*O*O));const ne=p.projection.pixelsPerMeter(p.center.lat,A),ae=p._camera.getCameraToWorldMercator(),he=[0,0,-Q*M];o.af(he,he,ae);let ce=se*M;const we=p._edgeInsets;if(!(we.left===0&&we.top===0&&we.right===0&&we.bottom===0||we.left===we.right&&we.top===we.bottom)){const wt=p._camera.getWorldToCamera(p.worldSize,p.projection.zAxisUnit==="meters"?ne:1),Ft=p._camera.getCameraToClipPerspective(p._fov,p.width/p.height,l,m);Ft[8]=2*-p.centerOffset.x/p.width,Ft[9]=2*p.centerOffset.y/p.height;const sr=new Float64Array(16);o.cO(sr,Ft,wt);const Rt=new Float64Array(16);o.bk(Rt,sr);const Lt=o.cA.fromInvProjectionMatrix(Rt,A,S,!0);for(const ar of Lt.points){const Jt=((fe=ar)[0]/=C,fe[1]/=C,fe[2]=o.ce(fe[2],p._center.lat),fe);ce=Math.max(ce,o.c5(o.d9([],he,Jt)))}}var fe;ce*=v/(v-1);const Te=Math.acos(n[2]),ve=Math.atan2(-n[0],-n[1]),ge=new Km;ge.position=he,ge.setPitchBearing(Te,ve);const Ce=ge.getWorldToCamera(A,ne),Fe=ce*A,Oe=Math.min(p._mercatorZfromZoom(17)*A*-2,-2*Fe),st=ge.getCameraToClipOrthographic(-Fe,Fe,-Fe,Fe,Oe,(Fe+w*ne)/n[2]),He=new Float64Array(16);o.aB(He,st,Ce);const ht=o.d4(Math.floor(1e6*he[0])/1e6*A,Math.floor(1e6*he[1])/1e6*A,0),Nt=.5*v,Ge=[0,0,0];o.af(Ge,ht,He),o.c4(Ge,Ge,Nt);const Re=[Math.floor(Ge[0]),Math.floor(Ge[1]),Math.floor(Ge[2])],ft=[0,0,0];o.av(ft,Ge,Re),o.c4(ft,ft,-1/Nt);const Ze=new Float64Array(16);return o.bz(Ze),o.bq(Ze,Ze,ft),o.aB(He,Ze,He),[He,Fe]}class Ym extends o.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(n,l){return o.db(this.requestManager.transformRequest(l,o.R.Model).url).then(m=>{if(!m)return;const v=o.dc(m),w=new o.dd(n,l,void 0,void 0,v);return w.computeBoundsAndApplyParent(),w}).catch(m=>{if(m&&m.status===404)return null;this.fire(new o.y(new Error(`Could not load model ${n} from ${l}: ${m.message}`)))})}load(n,l,m={forceReload:!1}){this.models[l]||(this.models[l]={});const v=Object.keys(n),w=[],S=[];for(const C of v){const A=n[C];this.hasURLBeenRequested(A)&&!m.forceReload||(this.modelByURL[A]={modelId:C,scope:l},w.push(this.loadModel(C,A)),S.push(C)),this.models[l][C]||(this.models[l][C]={model:null,numReferences:1})}this.numModelsLoading[l]=(this.numModelsLoading[l]||0)+S.length,Promise.allSettled(w).then(C=>{for(let A=0;A<C.length;A++){const{status:M}=C[A];if(M==="rejected")continue;const{value:D}=C[A];this.models[l][S[A]]||(this.models[l][S[A]]={model:null,numReferences:1}),this.models[l][S[A]].model=D}this.numModelsLoading[l]-=S.length,this.fire(new o.z("data",{dataType:"style"}))}).catch(C=>{this.fire(new o.y(new Error(`Could not load models: ${C.message}`)))})}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,l,m={exactIdMatch:!1}){return!!(m.exactIdMatch?this.getModel(n,l):this.getModelByURL(this.modelUris[l][n]))}getModel(n,l){return this.models[l]||(this.models[l]={}),this.models[l][n]?this.models[l][n].model:void 0}getModelByURL(n){if(!n)return null;const l=this.modelByURL[n];return l?this.models[l.scope][l.modelId].model:null}hasModelBeenAdded(n,l){return this.models[l]&&this.models[l][n]!==void 0}getModelURIs(n){return this.modelUris[n]||{}}addModel(n,l,m){this.models[m]||(this.models[m]={}),this.modelUris[m]||(this.modelUris[m]={});const v=this.requestManager.normalizeModelURL(l);if((this.hasModel(n,m,{exactIdMatch:!0})||this.hasModelBeenAdded(n,m))&&this.modelUris[m][n]===v)this.models[m][n].numReferences++;else if(this.hasURLBeenRequested(v)){const{scope:w,modelId:S}=this.modelByURL[v];this.models[w][S].numReferences++}else this.modelUris[m][n]=v,this.load({[n]:this.modelUris[m][n]},m)}addModelURLs(n,l){this.models[l]||(this.models[l]={}),this.modelUris[l]||(this.modelUris[l]={});const m=this.modelUris[l];for(const v in n)m[v]=this.requestManager.normalizeModelURL(n[v])}reloadModels(n){this.load(this.modelUris[n],n,{forceReload:!0})}addModelsFromBucket(n,l){this.models[l]||(this.models[l]={}),this.modelUris[l]||(this.modelUris[l]={});const m={};for(const v of n)this.hasModel(v,l,{exactIdMatch:!0})||this.hasURLBeenRequested(v)?this.models[l][v].numReferences++:this.modelUris[l][v]&&!this.hasURLBeenRequested(v)?m[v]=this.modelUris[l][v]:!this.hasURLBeenRequested(v)&&o.de(v,!1)&&(this.modelUris[l][v]=this.requestManager.normalizeModelURL(v),m[v]=this.modelUris[l][v]);this.load(m,l)}hasURLBeenRequested(n){return this.modelByURL[n]!==void 0}removeModel(n,l,m=!1,v=!1){if(this.models[l]&&this.models[l][n]&&(this.models[l][n].numReferences--,this.models[l][n].numReferences===0||v)){const w=this.modelUris[l][n];m||delete this.modelUris[l][n],delete this.modelByURL[w];const S=this.models[l][n].model;if(!S)return;delete this.models[l][n],S.destroy()}}destroy(){for(const n of Object.keys(this.models))for(const l of Object.keys(this.models[n])){const m=this.models[n][l].model;delete this.models[n][l],m&&m.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,l){this.models[l]||(this.models[l]={});for(const m in this.models[l])this.models[l][m].model&&this.models[l][m].model.upload(n.context)}}const _p=o.a6.colorTheme,fu=new o.a9({data:new o.aa(_p.data)});function A2(p){if(!p.metadata||!p.metadata.content_area)return;const n=o.o.devicePixelRatio,{left:l,top:m,width:v,height:w}=p.metadata.content_area,S=l*n,C=m*n;return[S,C,S+v*n,C+w*n]}function $b(p){if(p)return p.map(([n,l])=>[n*o.o.devicePixelRatio,l*o.o.devicePixelRatio])}class I2{constructor(n,l,m){this.id=n,this.scope=l,this.sourceCache=m,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(n){this.missingRequests.has(n.name)||this.pendingRequests.has(n.name)||this.pendingRequests.add(n.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const n=new Map;if(!this.sourceCache.loaded())return n;const l=this.sourceCache.getVisibleCoordinates();if(l.length===0)return n;const m=this.sourceCache.getSource();if(!(m instanceof Ls))return n;const v=l.map(S=>this.sourceCache.getTile(S)),w=m.getImages(v,Array.from(this.pendingRequests));for(const[S,C]of w)n.set(o.I.from({name:S,iconsetId:this.id}),C),this.pendingRequests.delete(S);for(const S of this.pendingRequests)this.missingRequests.add(S);return this.pendingRequests.clear(),n}}const pu=(p,n)=>te(p,n&&n.filter(l=>l.identifier!=="source.canvas")),P2=o.aH(Gn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),rv=o.aH(Gn,["setCenter","setZoom","setBearing","setPitch"]),Jm=new Set(["background","sky","slot","custom"]),nv={version:8,layers:[],sources:{}},iv={duration:300,delay:0};class sl extends o.E{constructor(n,l={}){super(),this.map=n,this.scope=l.scope||"",this.globalId=null,this.fragments=[],this.importDepth=l.importDepth||0,this.importsCache=l.importsCache||new Map,this.resolvedImports=l.resolvedImports||new Set,this.transition=Object.assign({},iv),this._buildingIndex=new Hy(this),this.crossTileSymbolIndex=new bc,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=l.styleChanges||new qi,this.dispatcher=l.dispatcher?l.dispatcher:new o.D(o.dg(),this),l.imageManager?this.imageManager=l.imageManager:(this.imageManager=new Os(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=l.glyphManager?l.glyphManager:new o.dh(n._requestManager,l.localFontFamily?o.di.all:l.localIdeographFontFamily?o.di.ideographs:o.di.none,l.localFontFamily||l.localIdeographFontFamily),l.modelManager?this.modelManager=l.modelManager:(this.modelManager=new Ym(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=l.configOptions?l.configOptions:new Map,this._configDependentLayers=l.configDependentLayers?l.configDependentLayers:new Set,this._indoorDependentLayers=l.indoorDependentLayers?l.indoorDependentLayers:new Set,this._config=l.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:l.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=l.initialConfig,this.dispatcher.broadcast("setReferrer",o.dj());const m=this;this._rtlTextPluginCallback=sl.registerForPluginStateChange(v=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(w,S)=>{if(o.dk(w),S&&S.every(C=>C))for(const C in m._sourceCaches){const A=m._sourceCaches[C],M=A.getSource().type;M!=="vector"&&M!=="geojson"||A.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const w=this.getOwnSource(v.sourceId);if(w&&w.vectorLayerIds)for(const S in this._layers){const C=this._layers[S];C.source===w.id&&this._validateLayer(C)}})}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(o.h(n))return n;const l=o.dl(n);if(!l.startsWith("http"))try{return new URL(l,location.href).toString()}catch{return l}return l}return`json://${o.dm(JSON.stringify(n))}`}_diffStyle(n,l,m){this.globalId=this._getGlobalId(n);const v=(w,S)=>{try{S(null,this.setState(w,m))}catch(C){S(C,!1)}};if(typeof n=="string"){const w=this.map._requestManager.normalizeStyleURL(n),S=this.map._requestManager.transformRequest(w,o.R.Style);o.m(S,(C,A)=>{C?this.fire(new o.y(C)):A&&v(A,l)})}else typeof n=="object"&&v(n,l)}loadURL(n,l={}){this.fire(new o.z("dataloading",{dataType:"style"}));const m=typeof l.validate=="boolean"?l.validate:!o.h(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,l.accessToken),this.resolvedImports.add(n);const v=this.importsCache.get(n);if(v)return this._load(v,m);const w=this.map._requestManager.transformRequest(n,o.R.Style);this._request=o.m(w,(S,C)=>{if(this._request=null,S)this.fire(new o.y(S));else if(C)return this.importsCache.set(n,C),this._load(C,m)})}loadJSON(n,l={}){this.fire(new o.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=o.o.frame(()=>{this._request=null,this._load(n,l.validate!==!1)})}loadEmpty(){this.fire(new o.z("dataloading",{dataType:"style"})),this._load(nv,!1)}_loadImports(n,l,m){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const v=[];for(const w of n){const S=this._createFragmentStyle(w),C=new Promise(D=>{S.once("style.import.load",D),S.once("error",D)}).then(()=>this.mergeAll());if(v.push(C),this.resolvedImports.has(w.url)){S.loadEmpty();continue}const A=w.data||this.importsCache.get(w.url);A?(S.loadJSON(A,{validate:l}),this._isInternalStyle(A)&&(S.globalId=null)):w.url?S.loadURL(w.url,{validate:l}):S.loadEmpty();const M={style:S,id:w.id,config:w.config};if(m){const D=this.fragments.findIndex(({id:F})=>F===m);this.fragments=this.fragments.slice(0,D).concat(M).concat(this.fragments.slice(D))}else this.fragments.push(M)}return Promise.allSettled(v)}getImportGlobalIds(n=this,l=new Set){for(const m of n.fragments)m.style.globalId&&l.add(m.style.globalId),this.getImportGlobalIds(m.style,l);return[...l.values()]}_createFragmentStyle(n){const l=this.scope?o.B(n.id,this.scope):n.id;let m;const v=this._initialConfig&&this._initialConfig[l];(n.config||v)&&(m=Object.assign({},n.config,v));const w=new sl(this.map,{scope:l,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:m,configOptions:this.options,colorThemeOverride:n["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return w.setEventedParent(this.map,{style:w}),w}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,l){if(this._isInternalStyle(n)){const w=Object.assign({},nv,{imports:[{id:"basemap",data:n,url:""}]},n.center?{center:n.center}:{},n.bearing?{bearing:n.bearing}:{},n.pitch?{pitch:n.pitch}:{},n.zoom?{zoom:n.zoom}:{},n.light?{light:n.light}:{});return this._importedAsBasemap=!0,void this._load(w,l)}if(this.updateConfig(this._config,n.schema),l&&pu(this,Yo(n)))return;this._loaded=!0,this.stylesheet=o.dn(n);const m=()=>{for(const A in n.sources)this.addSource(A,n.sources[A],{validate:!1,isInitialLoad:!0});if(n.iconsets)for(const A in n.iconsets)this.addIconset(A,n.iconsets[A]);n.sprite?this._loadIconset(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&n.glyphs&&this.glyphManager.setURL(n.glyphs);const w=th(this.stylesheet.layers);if(this._order=w.map(A=>A.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const A=this.stylesheet.lights[0];this.light=new Pe(A.properties,A.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Pe(this.stylesheet.light)),this._layers={};for(const A of w){const M=o.dt(A,this.scope,this._styleColorTheme.lut,this.options);M.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(M.fqid),M.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(M.fqid),this._hasAppearances=this._hasAppearances||M.getAppearances().length!==0,M.setEventedParent(this,{layer:{id:M.id}}),this._layers[M.id]=M;const D=this.getOwnLayerSourceCache(M),F=!!this.directionalLight&&this.directionalLight.shadowsEnabled();D&&M.canCastShadows()&&F&&(D.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const S=this.stylesheet.terrain;S&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(S,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.z("data",{dataType:"style"}));const C=this.isRootStyle();n.imports?this._loadImports(n.imports,l).then(()=>{this._reloadImports(),this.fire(new o.z(C?"style.load":"style.import.load"))}).catch(A=>{this.fire(new o.y(new Error("Failed to load imports",A))),this.fire(new o.z(C?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.z(C?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const v=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(v){const w=this._evaluateColorThemeData(v);this._loadColorTheme(w).then(()=>{m()}).catch(S=>{o.w(`Couldn't load color theme from the stylesheet: ${S}`),m()})}else this._styleColorTheme.lut=null,m()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances}mergeAll(){let n,l,m,v,w,S,C,A,M,D;const F={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(O=>{if(O.stylesheet){if(O.light!=null&&(n=O.light),O.stylesheet.lights)for(const q of O.stylesheet.lights)q.type==="ambient"&&O.ambientLight!=null&&(l=O.ambientLight),q.type==="directional"&&O.directionalLight!=null&&(m=O.directionalLight);v=this._prioritizeTerrain(v,O.terrain,O.stylesheet.terrain),O.stylesheet.fog&&O.fog!=null&&(w=O.fog),O.stylesheet.snow&&O.snow!=null&&(S=O.snow),O.stylesheet.rain&&O.rain!=null&&(C=O.rain),O.stylesheet.camera!=null&&(D=O.stylesheet.camera),O.stylesheet.projection!=null&&(A=O.stylesheet.projection),O.stylesheet.transition!=null&&(M=O.stylesheet.transition),F[O.scope]=O._styleColorTheme}}),this.light=n,this.ambientLight=l,this.directionalLight=m,this.fog=w,this.snow=S,this.rain=C,this._styleColorThemeForScope=F,v===null?delete this.terrain:this.terrain=v,this.camera=D||{"camera-projection":"perspective"},this.projection=A||{name:"mercator"},this.transition=Object.assign({},iv,M),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(n){const l=m=>{for(const v of m.fragments)l(v.style);n(m)};l(this)}_prioritizeTerrain(n,l,m){const v=n&&n.drapeRenderMode===0;return m===null?l&&l.drapeRenderMode===0?l:v?n:null:l!=null&&(!n||v||l&&l.drapeRenderMode===1)?l:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(l=>{n=this._prioritizeTerrain(n,l.terrain,l.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(l=>{l.stylesheet.projection!=null&&(n=l.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){const n={},l={},m={};this.forEachFragmentStyle(v=>{for(const w in v._sourceCaches){const S=o.B(w,v.scope);n[S]=v._sourceCaches[w]}for(const w in v._otherSourceCaches){const S=o.B(w,v.scope);l[S]=v._otherSourceCaches[w]}for(const w in v._symbolSourceCaches){const S=o.B(w,v.scope);m[S]=v._symbolSourceCaches[w]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=l,this._mergedSymbolSourceCaches=m}mergeIndoor(){this.forEachFragmentStyle(n=>{if(n.stylesheet&&n.stylesheet.indoor)for(const l of Object.values(n.stylesheet.indoor)){const m=l,v=o.B(m.sourceId,n.scope);this._mergedIndoor[v]=new Set(m.sourceLayers||[])}})}mergeLayers(){const n={},l=[],m={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(S=>{for(const C of S._order){const A=S._layers[C];if(A.type==="slot"){const M=o.dp(C);if(n[M])continue;n[M]=[]}A.slot&&n[A.slot]?n[A.slot].push(A):l.push(A)}}),this._mergedOrder=[];let v=-1;const w=(S=[])=>{for(const C of S)if(C.type==="slot"){const A=o.dp(C.id);n[A]&&w(n[A]),this._mergedSlots.push(A)}else{const A=o.B(C.id,C.scope);this._mergedOrder.push(A),m[A]=C,C.is3D(!!this.terrain)&&(this._has3DLayers=!0,v=this._mergedOrder.length-1),C.type==="circle"&&(this._hasCircleLayers=!0),C.type==="symbol"&&(this._hasSymbolLayers=!0),C.type==="clip"&&(this._clipLayerPresent=!0)}};if(w(l),this._has3DLayers){const S={};for(let C=0;C<this._mergedOrder.length;++C){const A=this._mergedOrder[C];S[A]=C===v?1:C<v?m[A].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((C,A)=>S[C]-S[A])}this._mergedLayers=m,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(n){return n.data?function(l,m,v,w){const S=Object.assign({},m);for(const A of Object.keys(_p))S[A]===void 0&&(S[A]=_p[A].default);const C=new o.a8(fu,l,new Map(v));return C.setTransitionOrValue(S,v),C.untransitioned().possiblyEvaluate(new o.ac(0,{worldview:void 0}))}(this.scope,n,this.options).get("data"):null}_loadColorTheme(n){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const l=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((m,v)=>{const w="data:image/png;base64,";if(!n||n.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void m();let S=n;S.startsWith(w)||(S=w+S);const C=o.I.from("mapbox-reserved-lut"),A=new Image;A.src=S,A.onerror=()=>{this._styleColorTheme.lutLoading=!1,v(new Error("Failed to load image data"))},A.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==l)return void m();this._styleColorTheme.lutLoading=!1;const{width:M,height:D,data:F}=o.o.getImageData(A);if(D>32)return void v(new Error("The height of the image must be less than or equal to 32 pixels."));if(M!==D*D)return void v(new Error("The width of the image must be equal to the height squared."));this.getImage(C)&&this.removeImage(C),this.addImage(C,{data:new o.q({width:M,height:D},F),pixelRatio:1,sdf:!1,usvg:!1,version:0});const O=this.imageManager.getImage(C,this.scope);O?(this._styleColorTheme.lut={image:O.data,data:n},m()):v(new Error("Missing LUT image."))}})}getLut(n){const l=this._styleColorThemeForScope[n];return l?l.lut:null}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=function(l,m,v){let w,S,C;const A=o.o.devicePixelRatio>1?"@2x":"";let M=o.m(m.transformRequest(m.normalizeSpriteURL(l,A,".json"),o.R.SpriteJSON),(O,q)=>{M=null,C||(C=O,w=q,F())}),D=o.n(m.transformRequest(m.normalizeSpriteURL(l,A,".png"),o.R.SpriteImage),(O,q)=>{D=null,C||(C=O,S=q,F())});function F(){if(C)v(C);else if(w&&S){const O=o.o.getImageData(S),q={};for(const Z in w){const{width:Q,height:se,x:ne,y:ae,sdf:he,pixelRatio:ce,stretchX:we,stretchY:fe,content:Te}=w[Z],ve=new o.q({width:Q,height:se});o.q.copy(O,ve,{x:ne,y:ae},{x:0,y:0},{width:Q,height:se},null),q[Z]={data:ve,pixelRatio:ce!==void 0?ce:1,sdf:he!==void 0&&he,stretchX:we,stretchY:fe,content:Te,usvg:!1,version:0}}v(null,q)}}return{cancel(){M&&(M.cancel(),M=null),D&&(D.cancel(),D=null)}}}(n,this.map._requestManager,(l,m)=>{if(this._spriteRequest=null,l)this.fire(new o.y(l));else if(m){const v=new Map;for(const w in m)v.set(o.I.from(w),m[w]);this.addImages(v)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))})}addIconset(n,l){if(l.type==="sprite")return void this._loadSprite(l.url);const m=this.getOwnSourceCache(l.source);if(!m)return void this.fire(new o.y(new Error(`Source "${l.source}" as specified by iconset "${n}" does not exist and cannot be used as an iconset source`)));const v=m.getSource();if(v.type!=="raster-array")return void this.fire(new o.y(new Error(`Source "${l.source}" as specified by iconset "${n}" is not a "raster-array" source and cannot be used as an iconset source`)));v.partial=!1;const w=new I2(n,this.scope,m);this.imageManager.addImageProvider(w,this.scope)}removeIconset(n){this.imageManager.removeImageProvider(n,this.scope)}_loadIconset(n){if(!o.h(n)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(n);const l=this.map._spriteFormat==="auto";var m,v;this._spriteRequest=(v=(w,S)=>{if(this._spriteRequest=null,w)l?this._loadSprite(n):this.fire(new o.y(w));else if(S){const C=new Map;for(const A in S)C.set(o.I.from(A),S[A]);this.addImages(C)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))},o.bt((m=this.map._requestManager).transformRequest(m.normalizeIconsetURL(n),o.R.Iconset),(w,S)=>{if(w)return void v(w);const C={},A=o.df(new o.bs(S));for(const M of A.icons){const D={version:1,pixelRatio:o.o.devicePixelRatio,content:A2(M),stretchX:M.metadata?$b(M.metadata.stretch_x_areas):void 0,stretchY:M.metadata?$b(M.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:M};C[M.name]=D}v(null,C)}))}_validateLayer(n){const l=this.getOwnSource(n.source);if(!l)return;const m=n.sourceLayer;m&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(m)===-1)&&this.fire(new o.y(new Error(`Source layer "${m}" does not exist on source "${l.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,l)=>{const m=this.fragments[l];return m&&m.style&&(n.data=m.style.serialize()),n})}_serializeSources(){const n={};for(const l in this._sourceCaches){const m=this._sourceCaches[l].getSource();n[m.id]||(n[m.id]=m.serialize())}return n}_serializeLayers(n){const l=[];for(const m of n){const v=this._layers[m];v&&v.type!=="custom"&&l.push(v.serialize())}return l}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(n){return n?this.order:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const l=this.getOwnLayer(n);if(l)return l;this.fire(new o.y(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const l=this.getOwnSource(n);if(l)return l;this.fire(new o.y(new Error(`The source '${n}' does not exist in the map's style.`)))}precompilePrograms(n,l){const m=this.map.painter;if(m)for(let v=n.minzoom||0;v<(n.maxzoom||25.5);v++){const w=n.getProgramIds();if(w)for(const S of w){const C=n.getDefaultProgramParams(S,l.zoom,this._styleColorTheme.lut);C&&(m.style=this,this.fog&&(m._fogVisible=!0,C.overrideFog=!0,m.getOrCreateProgram(S,C)),m._fogVisible=!1,C.overrideFog=!1,m.getOrCreateProgram(S,C),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(C.overrideRtt=!0,m.getOrCreateProgram(S,C)))}}}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const l=this.calculateLightsBrightness();n.brightness=l||0,l!==this._brightness&&(this._brightness=l,this.dispatcher.broadcast("setBrightness",l)),n.worldview!==this._worldview&&(this._worldview=n.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const m=this._changes.isDirty();let v=!1;if(this._changes.isDirty()){const C=this._changes.getLayerUpdatesByScope();for(const A in C){const{updatedIds:M,removedIds:D}=C[A];(M||D)&&(this._updateWorkerLayers(A,M,D),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this.snow&&this.snow.updateTransitions(n),this.rain&&this.rain.updateTransitions(n),this._changes.reset()}const w={};for(const C in this._mergedSourceCaches){const A=this._mergedSourceCaches[C];w[C]=A.used,A.used=!1,A.tileCoverLift=0}for(const C of this._mergedOrder){const A=this._mergedLayers[C];if(A.recalculate(n,this._availableImages),!A.isHidden(n.zoom)){const M=this.getLayerSourceCache(A);M&&(M.used=!0,M.tileCoverLift=Math.max(M.tileCoverLift,A.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(A,n)}):this.precompilePrograms(A,n))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();const S=this.imageManager.getPendingImageProviders();for(const C of S)C.sourceCache.used=!0;for(const C in w){const A=this._mergedSourceCaches[C];w[C]!==A.used&&A.getSource().fire(new o.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.snow&&this.snow.recalculate(n),this.rain&&this.rain.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),m&&this.fire(new o.z("data",{dataType:"style"}))}updateImageProviders(){const n=this.imageManager.getPendingImageProviders();for(const l of n){const m=l.resolvePendingRequests(),v=this.getFragmentStyle(l.scope);v&&v.addImages(m)}}_updateTilesForChangedImages(){const n={};for(const l in this._mergedSourceCaches){const m=this._mergedSourceCaches[l].getSource().scope;n[m]=n[m]||this._changes.getUpdatedImages(m),n[m].length!==0&&this._mergedSourceCaches[l].reloadTilesForDependencies(["icons","patterns"],n[m])}for(const l in n)this._changes.resetUpdatedImages(l)}_updateWorkerLayers(n,l,m){const v=this.getFragmentStyle(n);v&&this.dispatcher.broadcast("updateLayers",{layers:l?v._serializeLayers(l):[],scope:n,removedIds:m||[],options:v.options})}setState(n,l){if(this._checkLoaded(),pu(this,Yo(n)))return!1;(n=o.dn(n)).layers=th(n.layers);const m=function(S,C){if(!S)return[{command:Gn.setStyle,args:[C]}];let A=[];try{if(!o.bx(S.version,C.version))return[{command:Gn.setStyle,args:[C]}];if(o.bx(S.center,C.center)||A.push({command:Gn.setCenter,args:[C.center]}),o.bx(S.zoom,C.zoom)||A.push({command:Gn.setZoom,args:[C.zoom]}),o.bx(S.bearing,C.bearing)||A.push({command:Gn.setBearing,args:[C.bearing]}),o.bx(S.pitch,C.pitch)||A.push({command:Gn.setPitch,args:[C.pitch]}),o.bx(S.sprite,C.sprite)||A.push({command:Gn.setSprite,args:[C.sprite]}),o.bx(S.glyphs,C.glyphs)||A.push({command:Gn.setGlyphs,args:[C.glyphs]}),o.bx(S.imports,C.imports)||function(q=[],Z=[],Q){Z=Z||[];const se=(q=q||[]).map(ip),ne=Z.map(ip),ae=q.reduce(sp,{}),he=Z.reduce(sp,{}),ce=se.slice();let we,fe,Te,ve;for(we=0,fe=0;we<se.length;we++)Te=se[we],he.hasOwnProperty(Te)?fe++:(Q.push({command:Gn.removeImport,args:[Te]}),ce.splice(ce.indexOf(Te,fe),1));for(we=0,fe=0;we<ne.length;we++)Te=ne[ne.length-1-we],ce[ce.length-1-we]!==Te&&(ae.hasOwnProperty(Te)?(Q.push({command:Gn.removeImport,args:[Te]}),ce.splice(ce.lastIndexOf(Te,ce.length-fe),1)):fe++,ve=ce[ce.length-we],Q.push({command:Gn.addImport,args:[he[Te],ve]}),ce.splice(ce.length-we,0,Te));for(const ge of Z){const Ce=ae[ge.id];Ce&&(delete Ce.data,o.bx(Ce,ge)||Q.push({command:Gn.updateImport,args:[ge.id,ge]}))}}(S.imports,C.imports,A),o.bx(S.transition,C.transition)||A.push({command:Gn.setTransition,args:[C.transition]}),o.bx(S.light,C.light)||A.push({command:Gn.setLight,args:[C.light]}),o.bx(S.fog,C.fog)||A.push({command:Gn.setFog,args:[C.fog]}),o.bx(S.snow,C.snow)||A.push({command:Gn.setSnow,args:[C.snow]}),o.bx(S.rain,C.rain)||A.push({command:Gn.setRain,args:[C.rain]}),o.bx(S.projection,C.projection)||A.push({command:Gn.setProjection,args:[C.projection]}),o.bx(S.lights,C.lights)||A.push({command:Gn.setLights,args:[C.lights]}),o.bx(S.camera,C.camera)||A.push({command:Gn.setCamera,args:[C.camera]}),o.bx(S.iconsets,C.iconsets)||function(q,Z,Q){let se;for(se in Z=Z||{},q=q||{})q.hasOwnProperty(se)&&(Z.hasOwnProperty(se)||Q.push({command:Gn.removeIconset,args:[se]}));for(se in Z){if(!Z.hasOwnProperty(se))continue;const ne=Z[se];q.hasOwnProperty(se)?o.bx(q[se],ne)||(Q.push({command:Gn.removeIconset,args:[se]}),Q.push({command:Gn.addIconset,args:[se,ne]})):Q.push({command:Gn.addIconset,args:[se,ne]})}}(S.iconsets,C.iconsets,A),!o.bx(S["color-theme"],C["color-theme"]))return[{command:Gn.setStyle,args:[C]}];const M={},D=[];(function(q,Z,Q,se){let ne;for(ne in Z=Z||{},q=q||{})q.hasOwnProperty(ne)&&(Z.hasOwnProperty(ne)||tp(ne,Q,se));for(ne in Z){if(!Z.hasOwnProperty(ne))continue;const ae=Z[ne];q.hasOwnProperty(ne)?o.bx(q[ne],ae)||(q[ne].type==="geojson"&&ae.type==="geojson"&&Xy(q,Z,ne)?Q.push({command:Gn.setGeoJSONSourceData,args:[ne,ae.data]}):rp(ne,Z,Q,se)):Zy(ne,Z,Q)}})(S.sources,C.sources,D,M);const F=[];S.layers&&S.layers.forEach(q=>{q.source&&M[q.source]?A.push({command:Gn.removeLayer,args:[q.id]}):F.push(q)});let O=S.terrain;O&&M[O.source]&&(A.push({command:Gn.setTerrain,args:[void 0]}),O=void 0),A=A.concat(D),o.bx(O,C.terrain)||A.push({command:Gn.setTerrain,args:[C.terrain]}),function(q,Z,Q){Z=Z||[];const se=(q=q||[]).map(ip),ne=Z.map(ip),ae=q.reduce(sp,{}),he=Z.reduce(sp,{}),ce=se.slice(),we=Object.create(null);let fe,Te,ve,ge,Ce,Fe,Oe;for(fe=0,Te=0;fe<se.length;fe++)ve=se[fe],he.hasOwnProperty(ve)?Te++:(Q.push({command:Gn.removeLayer,args:[ve]}),ce.splice(ce.indexOf(ve,Te),1));for(fe=0,Te=0;fe<ne.length;fe++)ve=ne[ne.length-1-fe],ce[ce.length-1-fe]!==ve&&(ae.hasOwnProperty(ve)?(Q.push({command:Gn.removeLayer,args:[ve]}),ce.splice(ce.lastIndexOf(ve,ce.length-Te),1)):Te++,Fe=ce[ce.length-fe],Q.push({command:Gn.addLayer,args:[he[ve],Fe]}),ce.splice(ce.length-fe,0,ve),we[ve]=!0);for(fe=0;fe<ne.length;fe++)if(ve=ne[fe],ge=ae[ve],Ce=he[ve],!we[ve]&&!o.bx(ge,Ce))if(o.bx(ge.source,Ce.source)&&o.bx(ge["source-layer"],Ce["source-layer"])&&o.bx(ge.type,Ce.type)){for(Oe in np(ge.layout,Ce.layout,Q,ve,null,Gn.setLayoutProperty),np(ge.paint,Ce.paint,Q,ve,null,Gn.setPaintProperty),o.bx(ge.slot,Ce.slot)||Q.push({command:Gn.setSlot,args:[ve,Ce.slot]}),o.bx(ge.filter,Ce.filter)||Q.push({command:Gn.setFilter,args:[ve,Ce.filter]}),o.bx(ge.minzoom,Ce.minzoom)&&o.bx(ge.maxzoom,Ce.maxzoom)||Q.push({command:Gn.setLayerZoomRange,args:[ve,Ce.minzoom,Ce.maxzoom]}),ge)ge.hasOwnProperty(Oe)&&Oe!=="layout"&&Oe!=="paint"&&Oe!=="filter"&&Oe!=="metadata"&&Oe!=="minzoom"&&Oe!=="maxzoom"&&Oe!=="slot"&&(Oe.indexOf("paint.")===0?np(ge[Oe],Ce[Oe],Q,ve,Oe.slice(6),Gn.setPaintProperty):o.bx(ge[Oe],Ce[Oe])||Q.push({command:Gn.setLayerProperty,args:[ve,Oe,Ce[Oe]]}));for(Oe in Ce)Ce.hasOwnProperty(Oe)&&!ge.hasOwnProperty(Oe)&&Oe!=="layout"&&Oe!=="paint"&&Oe!=="filter"&&Oe!=="metadata"&&Oe!=="minzoom"&&Oe!=="maxzoom"&&Oe!=="slot"&&(Oe.indexOf("paint.")===0?np(ge[Oe],Ce[Oe],Q,ve,Oe.slice(6),Gn.setPaintProperty):o.bx(ge[Oe],Ce[Oe])||Q.push({command:Gn.setLayerProperty,args:[ve,Oe,Ce[Oe]]}))}else Q.push({command:Gn.removeLayer,args:[ve]}),Fe=ce[ce.lastIndexOf(ve)+1],Q.push({command:Gn.addLayer,args:[Ce,Fe]})}(F,C.layers,A)}catch(M){console.warn("Unable to compute style diff:",M),A=[{command:Gn.setStyle,args:[C]}]}return A}(this.serialize(),n).filter(S=>!(S.command in rv));if(m.length===0)return!1;const v=m.filter(S=>!(S.command in P2));if(v.length>0)throw new Error(`Unimplemented: ${v.map(S=>S.command).join(", ")}.`);const w=[];return m.forEach(S=>{w.push(this[S.command](...S.args))}),l&&Promise.all(w).then(l).catch(l),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(n){if(n.size===0)return this;for(const[l,m]of n.entries()){if(this.getImage(l))return this.fire(new o.y(new Error(`An image with the name "${l.name}" already exists.`)));this.imageManager.addImage(l,this.scope,m),this._changes.updateImage(l,this.scope)}return this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this}addImage(n,l){return this.getImage(n)?this.fire(new o.y(new Error(`An image with the name "${n.name}" already exists.`))):(this.imageManager.addImage(n,this.scope,l),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this)}updateImage(n,l,m=!1){this.imageManager.updateImage(n,this.scope,l),m&&(this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})))}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(n){return this.modelManager.addModelURLs(n,this.scope),this._updateWorkerModels(),this.fire(new o.z("data",{dataType:"style"})),this}addModel(n,l,m={}){return this._checkLoaded(),this._validate(Kf,`models.${n}`,l,null,m)||(this.modelManager.addModel(n,l,this.scope),this.fire(new o.z("data",{dataType:"style"}))),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope,!1,!0),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,l,m={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(qn,`sources.${n}`,l,null,m))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const v=qo(n,l,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));const w=S=>{const C=(S?"symbol:":"other:")+v.id,A=o.B(C,this.scope),M=this._sourceCaches[C]=new tl(A,v,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=M,M.onAdd(this.map)};w(!1),l.type!=="vector"&&l.type!=="geojson"||w(!0),v.onAdd&&v.onAdd(this.map),m.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const l=this.getOwnSource(n);if(!l)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===n)return this.fire(new o.y(new Error(`Source "${n}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new o.y(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const v=Object.entries(this.stylesheet.iconsets).find(([w,S])=>S.type==="source"&&S.source===n);if(v)return this.fire(new o.y(new Error(`Source "${n}" cannot be removed while iconset "${v[0]}" is using it.`)))}const m=this.getOwnSourceCaches(n);for(const v of m){const w=o.dp(v.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(v.id),v.fire(new o.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,l){this._checkLoaded(),this.getOwnSource(n).setData(l),this._changes.setDirty()}getOwnSource(n){const l=this.getOwnSourceCache(n);return l&&l.getSource()}getOwnSources(){const n=[];for(const l in this._otherSourceCaches){const m=this.getOwnSourceCache(l);m&&n.push(m.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const l in n){const m=n[l]._tiles;for(const v in m){const w=m[v];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const l=this._getTransitionParameters();for(const w of n){if(this._validate(ls,"lights",w))return;switch(w.type){case"ambient":if(this.ambientLight){const S=this.ambientLight;S.set(w),S.updateTransitions(l)}else this.ambientLight=new ns(w,si||(si=new o.a9({color:new o.aa(o.a6.properties_light_ambient.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const S=this.directionalLight;S.set(w),S.updateTransitions(l)}else this.directionalLight=new ns(w,Xi||(Xi=new o.a9({direction:new o.ap(o.a6.properties_light_directional.direction),color:new o.aa(o.a6.properties_light_directional.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_directional.intensity),"cast-shadows":new o.aa(o.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new o.aa(o.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.aa(o.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const m=Object.assign(l,{worldview:this.map.getWorldview()}),v=new o.ac(this.z||0,m);this.ambientLight&&this.ambientLight.recalculate(v),this.directionalLight&&this.directionalLight.recalculate(v),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,l=this.ambientLight;if(!n||!l)return;const m=O=>.2126*(O[0]<=.03928?O[0]/12.92:Math.pow((O[0]+.055)/1.055,2.4))+.7152*(O[1]<=.03928?O[1]/12.92:Math.pow((O[1]+.055)/1.055,2.4))+.0722*(O[2]<=.03928?O[2]/12.92:Math.pow((O[2]+.055)/1.055,2.4)),v=n.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),w=n.properties.get("intensity"),S=n.properties.get("direction"),C=1-o.d3(S.x,S.y,S.z)[2]/90,A=m(v)*w*C,M=l.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),D=l.properties.get("intensity"),F=m(M)*D;return Number(((A+F)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(n==null||n===""&&this.isRootStyle())return this;if(o.dq(n)){const l=o.dr(n),m=this.fragments.find(({id:w})=>w===l);if(!m)return;const v=o.dp(n);return m.style.getFragmentStyle(v)}{const l=this.fragments.find(({id:m})=>m===n);return l?l.style:void 0}}setFeaturesetSelectors(n){if(!n)return;const l={},m=(v,w="")=>`${v}::${w}`;this._featuresetSelectors={};for(const v in n){const w=this._featuresetSelectors[v]=[];for(const S of n[v].selectors){if(S.featureNamespace){const A=this.getOwnLayer(S.layer);if(!A){o.w(`Layer is undefined for selector: ${S.layer}`);continue}const M=m(A.source,A.sourceLayer);if(M in l&&l[M]!==S.featureNamespace){o.w(`"featureNamespace ${S.featureNamespace} of featureset ${v}'s selector is not associated to the same source, skip this selector`);continue}l[M]=S.featureNamespace}let C;if(S.properties)for(const A in S.properties){const M=o.U(S.properties[A]);M.result==="success"&&(C=C||{},C[A]=M.value)}w.push({layerId:S.layer,namespace:S.featureNamespace,properties:C,uniqueFeatureID:S._uniqueFeatureID})}}}getFeaturesetDescriptors(n){const l=this.getFragmentStyle(n);if(!l||!l.stylesheet.featuresets)return[];const m=[];for(const v in l.stylesheet.featuresets)m.push({featuresetId:v,importId:l.scope?l.scope:void 0});return m}getFeaturesetLayers(n,l){const m=this.getFragmentStyle(l),v=m.stylesheet.featuresets;if(!v||!v[n])return this.fire(new o.y(new Error(`The featureset '${n}' does not exist in the map's style and cannot be queried.`))),[];const w=[];for(const S of v[n].selectors){const C=m.getOwnLayer(S.layer);C&&w.push(C)}return w}getConfigProperty(n,l){const m=this.getFragmentStyle(n);if(!m)return null;const v=o.B(l,m.scope),w=m.options.get(v),S=w?w.value||w.default:null;return S?S.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(n,l){const m=o.B(n,l);return this._mergedIndoor[m]}setIndoorData(n,l){this.map.indoor.setIndoorData(l)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(n,l,m){const v=this.getFragmentStyle(n);if(!v)return;const w=v.stylesheet.schema;if(!w||!w[l])return;const S=o.U(m);if(S.result!=="success")return void pu(this,S.value);const C=S.value.expression,A=o.B(l,v.scope),M=v.options.get(A);if(!M)return;let D;const{minValue:F,maxValue:O,stepValue:q,type:Z,values:Q}=w[l],se=o.U(w[l].default);se.result==="success"&&(D=se.value.expression),D?(this.options.set(A,Object.assign({},M,{value:C,default:D,minValue:F,maxValue:O,stepValue:q,type:Z,values:Q})),this.updateConfigDependencies(l)):this.fire(new o.y(new Error(`No schema defined for the config option "${l}" in the "${n}" fragment.`)))}getConfig(n){const l=this.getFragmentStyle(n);if(!l)return null;const m=l.stylesheet.schema;if(!m)return null;const v={};for(const w in m){const S=o.B(w,l.scope),C=l.options.get(S),A=C?C.value||C.default:null;v[w]=A?A.serialize():null}return v}setConfig(n,l){const m=this.getFragmentStyle(n);m&&(m.updateConfig(l,m.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){const l=this.getFragmentStyle(n);return l?l.stylesheet.schema:null}setSchema(n,l){const m=this.getFragmentStyle(n);m&&(m.stylesheet.schema=l,m.updateConfig(m._config,l),this.updateConfigDependencies())}updateConfig(n,l){if(this._config=n,n||l)if(l)for(const m in l){let v,w;const S=o.U(l[m].default);if(S.result==="success"&&(v=S.value.expression),n&&n[m]!==void 0){const O=o.U(n[m]);O.result==="success"&&(w=O.value.expression)}const{minValue:C,maxValue:A,stepValue:M,type:D,values:F}=l[m];if(v){const O=o.B(m,this.scope);this.options.set(O,{default:v,value:w,minValue:C,maxValue:A,stepValue:M,type:D,values:F})}else this.fire(new o.y(new Error(`No schema defined for config option "${m}".`)))}else this.fire(new o.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(n,l=()=>!0){for(const m of n){const v=this.getLayer(m);v&&l(v)&&(v.possiblyEvaluateVisibility(),this._updateLayer(v),this._changes.setDirty())}}updateConfigDependencies(n){this._updateLayers(this._configDependentLayers,l=>!n||l.expressionDependencies.configDependencies.has(n)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(l=>{const m=l._styleColorTheme.colorThemeOverride?l._styleColorTheme.colorThemeOverride:l._styleColorTheme.colorTheme;if(m){const v=l._evaluateColorThemeData(m);(!l._styleColorTheme.lut&&v!==""||l._styleColorTheme.lut&&v!==l._styleColorTheme.lut.data)&&l.setColorTheme(m)}}),this._changes.setDirty()}addLayer(n,l,m={}){this._checkLoaded();const v=n.id;if(this._layers[v])return void this.fire(new o.y(new Error(`Layer with id "${v}" already exists on this map`)));let w;if(n.type==="custom"){if(pu(this,o.ds(n)))return;w=o.dt(n,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof n.source=="object"&&(this.addSource(v,n.source),n=o.dn(n),n=Object.assign(n,{source:v})),this._validate(Mo,`layers.${v}`,n,{arrayIndex:-1},m))return;w=o.dt(n,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:v}})}const S=o.B(w.source,w.scope);w.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(S),w.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(S);let C=this._order.length;if(l){const F=this._order.indexOf(l);if(F===-1)return void this.fire(new o.y(new Error(`Layer with id "${l}" does not exist on this map.`)));w.slot===this._layers[l].slot?C=F:o.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(C,0,v),this._layerOrderChanged=!0,this._layers[v]=w;const A=this.getOwnLayerSourceCache(w),M=!!this.directionalLight&&this.directionalLight.shadowsEnabled();A&&w.canCastShadows()&&M&&(A.castsShadows=!0);const D=this._changes.getRemovedLayer(w);if(D&&w.source&&A&&w.type!=="custom"){this._changes.discardLayerRemoval(w);const F=o.B(w.source,w.scope);D.type!==w.type?this._changes.updateSourceCache(F,"clear"):(this._changes.updateSourceCache(F,"reload"),A.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(n,l){this._checkLoaded();const m=this._checkLayer(n);if(!m||n===l)return;const v=this._order.indexOf(n);this._order.splice(v,1);let w=this._order.length;if(l){const S=this._order.indexOf(l);if(S===-1)return void this.fire(new o.y(new Error(`Layer with id "${l}" does not exist on this map.`)));m.slot===this._layers[l].slot?w=S:o.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();const l=this._checkLayer(n);if(!l)return;l.setEventedParent(null);const m=this._order.indexOf(n);this._order.splice(m,1),delete this._layers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(l.fqid),this._indoorDependentLayers.delete(l.fqid),this._changes.removeLayer(l);const v=this.getOwnLayerSourceCache(l);if(v&&v.castsShadows){let w=!1;for(const S in this._layers)if(this._layers[S].source===l.source&&this._layers[S].canCastShadows()){w=!0;break}v.castsShadows=w}l.onRemove&&l.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const l in this._layers)if(this._layers[l].type===n)return!0;return!1}setLayerZoomRange(n,l,m){this._checkLoaded();const v=this._checkLayer(n);v&&(v.minzoom===l&&v.maxzoom===m||(l!=null&&(v.minzoom=l),m!=null&&(v.maxzoom=m),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(n,l){this._checkLoaded();const m=this._checkLayer(n);m&&m.slot!==l&&(m.slot=l,this._updateLayer(m))}setFilter(n,l,m={}){this._checkLoaded();const v=this._checkLayer(n);if(v&&!o.bx(v.filter,l))return l==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(ln,`layers.${v.id}.filter`,l,{layerType:v.type},m)||(v.filter=o.dn(l),this._updateLayer(v)))}getFilter(n){const l=this._checkLayer(n);if(l)return o.dn(l.filter)}setLayoutProperty(n,l,m,v={}){this._checkLoaded();const w=this._checkLayer(n);if(w&&!o.bx(w.getLayoutProperty(l),m)){if(m!=null&&(!v||v.validate!==!1)&&pu(w,qy.call(Yo,{key:`layers.${n}.layout.${l}`,layerType:w.type,objectKey:l,value:m,styleSpec:o.a6,style:{glyphs:!0,sprite:!0}})))return;w.setLayoutProperty(l,m),w.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),w.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(w.fqid),this._updateLayer(w)}}setLayerProperty(n,l,m,v={}){this._checkLoaded();const w=this._checkLayer(n);w&&(l==="appearances"?(w.setAppearances(m),this._changes.setDirty()):w.isPaintProperty(l)?this.setPaintProperty(n,l,m,v):this.setLayoutProperty(n,l,m,v))}getLayoutProperty(n,l){const m=this._checkLayer(n);if(m)return m.getLayoutProperty(l)}setPaintProperty(n,l,m,v={}){this._checkLoaded();const w=this._checkLayer(n);if(!w||o.bx(w.getPaintProperty(l),m)||m!=null&&(!v||v.validate!==!1)&&pu(w,Do.call(Yo,{key:`layers.${n}.paint.${l}`,layerType:w.type,objectKey:l,value:m,styleSpec:o.a6})))return;const S=w.setPaintProperty(l,m);w.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),w.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(w.fqid),S&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(n,l){const m=this._checkLayer(n);if(m)return m.getPaintProperty(l)}setFeatureState(n,l){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:A,importId:M}=n.target,D=this.getFragmentStyle(M),F=D.getFeaturesetLayers(A);for(const{source:O,sourceLayer:q}of F)D.setFeatureState({id:n.id,source:O,sourceLayer:q},l)}else if("layerId"in n.target){const{layerId:A}=n.target,M=this.getLayer(A);this.setFeatureState({id:n.id,source:M.source,sourceLayer:M.sourceLayer},l)}return}const m=n.source,v=n.sourceLayer,w=this._checkSource(m);if(!w)return;const S=w.type;if(S==="geojson"&&v)return void this.fire(new o.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!v)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided.")));const C=this.getOwnSourceCaches(m);for(const A of C)A.setFeatureState(v,n.id,l)}removeFeatureState(n,l){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:A,importId:M}=n.target,D=this.getFragmentStyle(M),F=D.getFeaturesetLayers(A);for(const{source:O,sourceLayer:q}of F)D.removeFeatureState({id:n.id,source:O,sourceLayer:q},l)}else if("layerId"in n.target){const{layerId:A}=n.target,M=this.getLayer(A);this.removeFeatureState({id:n.id,source:M.source,sourceLayer:M.sourceLayer},l)}return}const m=n.source,v=this._checkSource(m);if(!v)return;const w=v.type,S=w==="vector"?n.sourceLayer:void 0;if(w==="vector"&&!S)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new o.y(new Error("A feature id is required to remove its specific state property.")));const C=this.getOwnSourceCaches(m);for(const A of C)A.removeFeatureState(S,n.id,l)}getFeatureState(n){if(this._checkLoaded(),"target"in n){let w;if("featuresetId"in n.target){const{featuresetId:S,importId:C}=n.target,A=this.getFragmentStyle(C),M=A.getFeaturesetLayers(S);for(const{source:D,sourceLayer:F}of M){const O=A.getFeatureState({id:n.id,source:D,sourceLayer:F});if(O&&!w)w=O;else if(!o.bx(w,O))return void this.fire(new o.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in n.target){const{layerId:S}=n.target,C=this.getLayer(S);w=this.getFeatureState({id:n.id,source:C.source,sourceLayer:C.sourceLayer})}return w}const l=n.source,m=n.sourceLayer,v=this._checkSource(l);if(v){if(v.type!=="vector"||m)return n.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(l)[0].getFeatureState(m,n.id);this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),l=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return o.du({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:l,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},m=>m!==void 0)}_updateFilteredLayers(n){for(const l of Object.values(this._mergedLayers))n(l)&&this._updateLayer(l)}_updateLayer(n){this._changes.updateLayer(n);const l=this.getLayerSourceCache(n),m=o.B(n.source,n.scope),v=this._changes.getUpdatedSourceCaches();n.source&&!v[m]&&l&&l.getSource().type!=="raster"&&(this._changes.updateSourceCache(m,"reload"),l.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const l=C=>this._mergedLayers[C].is3D(!!this.terrain),m=this.order,v={},w=[];for(let C=m.length-1;C>=0;C--){const A=m[C];if(l(A)){v[A]=C;for(const M of n){const D=M[A];if(D)for(const F of D)w.push(F)}}}w.sort((C,A)=>A.intersectionZ-C.intersectionZ);const S=[];for(let C=m.length-1;C>=0;C--){const A=m[C];if(l(A))for(let M=w.length-1;M>=0;M--){const D=w[M].feature;if(D.layer&&v[D.layer.id]<C)break;S.push(D),w.pop()}else for(const M of n){const D=M[A];if(D)for(const F of D)S.push(F.feature)}}return S}queryRasterValue(n,l,m){const v=this.getOwnSource(n);return v?v.type!=="raster-array"?(this.fire(new o.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):v.queryRasterArrayValue(l,m):(this.fire(new o.y(new Error(`Source with id "${n}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(n,l,m){let v;l&&!Array.isArray(l)&&l.filter&&(this._validate(ln,"queryRenderedFeatures.filter",l.filter,null,l),v=o.b5(l.filter));const w={},S=D=>{if(Jm.has(D.type))return;const F=this.getOwnLayerSourceCache(D),O=w[F.id]=w[F.id]||{sourceCache:F,layers:{},has3DLayers:!1};D.is3D(!!this.terrain)&&(O.has3DLayers=!0),O.layers[D.fqid]=O.layers[D.fqid]||{styleLayer:D,targets:[]},O.layers[D.fqid].targets.push({filter:v})};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new o.y(new Error("parameters.layers must be an Array."))),[];for(const D of l.layers){const F=this._layers[D];if(!F)return this.fire(new o.y(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];S(F)}}else for(const D in this._layers)S(this._layers[D]);const C=this._queryRenderedFeatures(n,w,m),A=this._flattenAndSortRenderedFeatures(C),M=[];for(const D of A)o.dv(D.layer.id)===this.scope&&M.push(D);return M}queryRenderedFeatureset(n,l,m){let v;l&&!Array.isArray(l)&&l.filter&&(this._validate(ln,"queryRenderedFeatures.filter",l.filter,null,l),v=o.b5(l.filter));const w="mock",S=[];if(l&&l.target)S.push(Object.assign({},l,{targetId:w,filter:v}));else{const D=this.getFeaturesetDescriptors();for(const F of D)S.push({targetId:w,filter:v,target:F});for(const{style:F}of this.fragments){const O=F.getFeaturesetDescriptors();for(const q of O)S.push({targetId:w,filter:v,target:q})}}const C=this.queryRenderedTargets(n,S,m),A=[],M=new Set;for(const D of C)for(const F of D.variants[w])da(F,D,M)||A.push(new o.dw(D,F));return A}queryRenderedTargets(n,l,m){const v={},w=(C,A,M,D)=>{const F=v[A.id]=v[A.id]||{sourceCache:A,layers:{},has3DLayers:!1};if(F.layers[C.fqid]=F.layers[C.fqid]||{styleLayer:C,targets:[]},C.is3D(!!this.terrain)&&(F.has3DLayers=!0),!D)return M.uniqueFeatureID=!1,void F.layers[C.fqid].targets.push(M);F.layers[C.fqid].targets.push(Object.assign({},M,{namespace:D.namespace,properties:D.properties,uniqueFeatureID:D.uniqueFeatureID}))};for(const C of l)if("featuresetId"in C.target){const{featuresetId:A,importId:M}=C.target,D=this.getFragmentStyle(M);if(!D||!D._featuresetSelectors)continue;const F=D._featuresetSelectors[A];if(!F){this.fire(new o.y(new Error(`The featureset '${A}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const O of F){const q=D.getOwnLayer(O.layerId);q&&!Jm.has(q.type)&&w(q,D.getOwnLayerSourceCache(q),C,O)}}else if("layerId"in C.target){const{layerId:A}=C.target,M=this.getLayer(A);if(!M||Jm.has(M.type))continue;w(M,this.getLayerSourceCache(M),C)}const S=this._queryRenderedFeatures(n,v,m);return this._flattenAndSortRenderedFeatures(S)}_queryRenderedFeatures(n,l,m){const v=[],w=!!this.map._showQueryGeometry,S=ni.createFromScreenPoints(n,m);for(const C in l){const A=ha(S,l[C],this._availableImages,m,w);Object.keys(A).length&&v.push(A)}if(this.placement)for(const C in l){if(!l[C].sourceCache._onlySymbols)continue;const A=Um(S.screenGeometry,l[C],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(A).length&&v.push(A)}return v}querySourceFeatures(n,l){const m=l&&l.filter;m&&this._validate(ln,"querySourceFeatures.filter",m,null,l);let v=[];const w=this.getOwnSourceCaches(n);for(const S of w)v=v.concat(Yf(S,l));return v}addSourceType(n,l,m){return sl.getSourceType(n)?m(new Error(`A source type called "${n}" already exists.`)):(sl.setSourceType(n,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:l.workerSourceURL},m):m(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,l,m={}){this._checkLoaded();const v=this.light.getLight();let w=!1;for(const C in n)if(!o.bx(n[C],v[C])){w=!0;break}if(!w)return;const S=this._getTransitionParameters();this.light.setLight(n,l,m),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(n,l=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),l===0&&delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let m=n;const v=n.source==null;if(l===1){if(this.disableElevatedTerrain)return;if(typeof m.source=="object"){const C="terrain-dem-src";this.addSource(C,m.source),m=o.dn(m),m=Object.assign(m,{source:C})}const w=Object.assign({},m),S={};if(this.terrain&&v){w.source=this.terrain.get().source;const C=this.terrain?this.getFragmentStyle(this.terrain.scope):null;C&&(S.style=C.serialize())}if(this._validate(bo,"terrain",w,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&l!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,l),this.fire(new o.z("data",{dataType:"style"}))}else{const w=this.terrain,S=w.get();for(const C of Object.keys(o.a6.terrain))!m.hasOwnProperty(C)&&o.a6.terrain[C].default&&(m[C]=o.a6.terrain[C].default);for(const C in n)if(!o.bx(n[C],S[C])){w.set(n,this.options),this.stylesheet.terrain=n;const A=this._getTransitionParameters({duration:0});w.updateTransitions(A),this.fire(new o.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const l=this.fog=new br(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=l.get();const m=this._getTransitionParameters({duration:0});l.updateTransitions(m)}_createSnow(n){const l=this.snow=new xs(n,this.map.transform,this.scope,this.options);this.stylesheet.snow=l.get();const m=this._getTransitionParameters({duration:0});l.updateTransitions(m)}_createRain(n){const l=this.rain=new cs(n,this.map.transform,this.scope,this.options);this.stylesheet.rain=l.get();const m=this._getTransitionParameters({duration:0});l.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog;if(!o.bx(l.get(),n)){l.set(n,this.options),this.stylesheet.fog=l.get();const m=this._getTransitionParameters({duration:0});l.updateTransitions(m)}}else this._createFog(n);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(n){if(this._checkLoaded(),!n)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const l=this.snow;if(!o.bx(l.get(),n)){l.set(n,this.options),this.stylesheet.snow=l.get();const m=this._getTransitionParameters({duration:0});l.updateTransitions(m)}}else this._createSnow(n);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(n){if(this._checkLoaded(),!n)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const l=this.rain;if(!o.bx(l.get(),n)){l.set(n,this.options),this.stylesheet.rain=l.get();const m=this._getTransitionParameters({duration:0});l.updateTransitions(m)}}else this._createRain(n);this._markersNeedUpdate=!0}_reloadColorTheme(){const n=()=>{for(const v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(const v in this._sourceCaches)this._sourceCaches[v].clearTiles()},l=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!l)return this._styleColorTheme.lut=null,void n();const m=this._evaluateColorThemeData(l);this._loadColorTheme(m).then(()=>{this.fire(new o.z("colorthemeset")),n()}).catch(v=>{o.w(`Couldn't set color theme: ${v}`)})}setColorTheme(n){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=n,this._reloadColorTheme()}setImportColorTheme(n,l){const m=this.getFragmentStyle(n);m&&(m._styleColorTheme.colorThemeOverride=l,m._reloadColorTheme())}_getTransitionParameters(n){return{now:o.o.now(),transition:Object.assign(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],l=[];for(const m of this._mergedOrder)this.isLayerDraped(this._mergedLayers[m])?n.push(m):l.push(m);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...l)}_createTerrain(n,l){const m=this.terrain=new Le(n,l,this.scope,this.options,this.map.getWorldview());l===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const v=this._getTransitionParameters({duration:0});m.updateTransitions(v)}_force3DLayerUpdate(){for(const n in this._layers){const l=this._layers[n];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const l=this._layers[n];l.type==="symbol"&&this._updateLayer(l)}}_validate(n,l,m,v,w={}){if(w&&w.validate===!1)return!1;const S=Object.assign({},this.serialize());return pu(this,n.call(Yo,Object.assign({key:l,style:S,value:m,styleSpec:o.a6},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.dx.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(n){const l=this.getSourceCaches(n);for(const m of l)m.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}clearLayers(){for(const n in this._mergedLayers){const l=this._mergedLayers[n];l._clear&&l._clear()}}reloadSource(n){const l=this.getSourceCaches(n);for(const m of l)m.resume(),m.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(n=>{n.modelManager.reloadModels(n.scope)})}updateSources(n){let l;this.directionalLight&&(l=Vb(this.directionalLight));const m=new Set;for(const v in this._mergedLayers){const w=this._mergedLayers[v];w.hasElevation()&&!m.has(w.source)&&m.add(w.source)}for(const v in this._mergedSourceCaches){const w=this._mergedSourceCaches[v],S=m.has(w._source.id);w.update(n,void 0,void 0,l,S)}}_generateCollisionBoxes(){for(const n in this._sourceCaches){const l=this._sourceCaches[n];l.resume(),l.reload()}}_updatePlacement(n,l,m,v,w,S,C=!1){let A=!1,M=!1;const D={},F={};for(const O of this._mergedOrder){const q=this._mergedLayers[O];if(q.type!=="symbol")continue;const Z=o.B(q.source,q.scope);let Q=D[Z];if(!Q){const ne=this.getLayerSourceCache(q);if(!ne)continue;const ae=ne.getRenderableIds(!0).map(he=>ne.getTileByID(he));F[Z]=ae.slice(),Q=D[Z]=ae.sort((he,ce)=>ce.tileID.overscaledZ-he.tileID.overscaledZ||(he.tileID.isLessThan(ce.tileID)?-1:1))}const se=this.crossTileSymbolIndex.addLayer(q,Q,l.center.lng,l.projection);A=A||se}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),C=C||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new o.z("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.o.now(),l.zoom))&&(this.pauseablePlacement=new Qo(l,this._mergedOrder,C,m,v,w,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,D,F,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.o.now()),M=!0),A&&this.pauseablePlacement.placement.setStale()),M||A){this._buildingIndex.onNewFrame(l.zoom);for(let O=0;O<this._mergedOrder.length;O++){const q=this._mergedLayers[this._mergedOrder[O]];if(q.type!=="symbol")continue;const Z=this.isLayerClipped(q);this.placement.updateLayerOpacities(q,D[o.B(q.source,q.scope)],O,Z?S:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.o.now())}}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,l){this._checkLoaded();const m=this.stylesheet.imports=this.stylesheet.imports||[];if(m.findIndex(({id:w})=>w===n.id)!==-1)return void this.fire(new o.y(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!l)return m.push(n),this._loadImports([n],!0);const v=m.findIndex(({id:w})=>w===l);return v===-1&&this.fire(new o.y(new Error(`Import with id "${l}" does not exist on this map.`))),this.stylesheet.imports=m.slice(0,v).concat(n).concat(m.slice(v)),this._loadImports([n],!0,l)}updateImport(n,l){this._checkLoaded();const m=this.stylesheet.imports||[],v=this.getImportIndex(n);return v===-1?this:typeof l=="string"?(this.setImportUrl(n,l),this):(l.url&&l.url!==m[v].url&&this.setImportUrl(n,l.url),o.bx(l.config,m[v].config)||this.setImportConfig(n,l.config,l.data.schema),o.bx(l.data,m[v].data)||this.setImportData(n,l.data),this)}moveImport(n,l){this._checkLoaded();let m=this.stylesheet.imports||[];const v=this.getImportIndex(n);if(v===-1)return this;const w=this.getImportIndex(l);if(w===-1)return this;const S=m[v],C=this.fragments[v];return m=m.filter(({id:A})=>A!==n),this.fragments=this.fragments.filter(({id:A})=>A!==n),this.stylesheet.imports=m.slice(0,w).concat(S).concat(m.slice(w)),this.fragments=this.fragments.slice(0,w).concat(C).concat(this.fragments.slice(w)),this.mergeLayers(),this}setImportUrl(n,l){this._checkLoaded();const m=this.stylesheet.imports||[],v=this.getImportIndex(n);if(v===-1)return this;m[v].url=l;const w=this.fragments[v];return w.style=this._createFragmentStyle(m[v]),w.style.on("style.import.load",()=>this.mergeAll()),w.style.loadURL(l),this}setImportData(n,l){this._checkLoaded();const m=this.getImportIndex(n),v=this.stylesheet.imports||[];return m===-1?this:l?(this.fragments[m].style.setState(l),this._reloadImports(),this):(delete v[m].data,this.setImportUrl(n,v[m].url))}setImportConfig(n,l,m){this._checkLoaded();const v=this.getImportIndex(n),w=this.stylesheet.imports||[];if(v===-1)return this;l?w[v].config=l:delete w[v].config;const S=this.fragments[v];m&&S.style.stylesheet&&(S.style.stylesheet.schema=m);const C=S.style.stylesheet&&S.style.stylesheet.schema;return S.config=l,S.style.updateConfig(l,C),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const l=this.stylesheet.imports||[],m=this.getImportIndex(n);m!==-1&&(l.splice(m,1),this.fragments[m].style._remove(),this.fragments.splice(m,1),this._reloadImports())}getImportIndex(n){const l=(this.stylesheet.imports||[]).findIndex(m=>m.id===n);return l===-1&&this.fire(new o.y(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),l}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const l in this._mergedOtherSourceCaches){const m=this._mergedOtherSourceCaches[l];m&&n.push(m.getSource())}return n}getSource(n,l){const m=this.getSourceCache(n,l);return m&&m.getSource()}getLayerSource(n){const l=this.getLayerSourceCache(n);return l&&l.getSource()}getSourceCache(n,l){const m=o.B(n,l);return this._mergedOtherSourceCaches[m]}getLayerSourceCache(n){const l=o.B(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[l]:this._mergedOtherSourceCaches[l]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);const l=[];return this._mergedOtherSourceCaches[n]&&l.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&l.push(this._mergedSymbolSourceCaches[n]),l}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const l in n){const m=n[l];m==="reload"?this.reloadSource(l):m==="clear"&&this.clearSource(l)}}updateLayers(n){const l=this._changes.getUpdatedPaintProperties();for(const m of l){const v=this.getLayer(m);v&&v.updateTransitions(n)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(n){this.stylesheet.glyphs=n,this.glyphManager.setURL(n)}getImages(n,l,m){this.imageManager.getImages(l.images,l.scope,m),this._updateTilesForChangedImages();const v=S=>{if(S){const C=l.images.map(A=>o.I.toString(A));S.setDependencies(l.tileID.key,l.type,C)}},w=o.B(l.source,l.scope);v(this._mergedOtherSourceCaches[w]),v(this._mergedSymbolSourceCaches[w]),l.images.some(S=>S.iconsetId)&&this.fire(new o.z("data",{dataType:"style"}))}rasterizeImages(n,l,m){this.imageManager.rasterizeImages(l,m)}getGlyphs(n,l,m){this.glyphManager.getGlyphs(l.stacks,m)}getResource(n,l,m){return o.dy(l,m)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const l=[];return this._otherSourceCaches[n]&&l.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&l.push(this._symbolSourceCaches[n]),l}_isSourceCacheLoaded(n){const l=this.getOwnSourceCaches(n);return l.length===0?(this.fire(new o.y(new Error(`There is no source with ID '${n}'`))),!1):l.every(m=>m.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(n,l){if(!this._clipLayerPresent&&n.type!=="fill-extrusion"&&n.type!=="building")return!1;const m=n.type==="fill-extrusion"&&(n.sourceLayer==="building"||n.sourceLayer==="procedural_buildings"),v=n.type==="building";if(n.is3D(!!this.terrain)){if(m||v||l&&l.type==="batched-model"||n.type==="model")return!0}else if(n.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}sl.getSourceType=function(p){return el[p]},sl.setSourceType=function(p,n){el[p]=n},sl.registerForPluginStateChange=o.dz;class od extends o.E{constructor(n){super(),this._style=n,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},o.aX(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(n){n===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=n,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(n){this._activeFloorsVisible=n,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(n){for(const[l,m]of Object.entries(n.buildings))if(this._buildings[l])for(const v of m.floorIds)this._buildings[l].floors[v]||(this._buildings[l].floors[v]=m.floors[v]);else this._buildings[l]=m;for(const l of n.activeFloors)this._activeFloors.add(l);this._updateIndoorSelector()}getIndoorTileOptions(n,l){const m=this._style.getIndoorSourceLayers(n,l);return m&&this._indoorState?{sourceLayers:m,indoorState:this._indoorState}:null}_updateUI(n,l,m){const v=function(w,S,C,A){let M=null,D=Number.MAX_SAFE_INTEGER;if(A<16)return null;for(const[F,O]of Object.entries(w)){const q=O.center;if(q){const Z=S.distanceTo(o.aS.convert(q));Z<D&&C.contains(q)&&(D=Z,M=F)}}return M}(this._buildings,l,m,n);v!==this._closestBuildingId&&(this._closestBuildingId=v,this._updateIndoorSelector())}_updateIndoorSelector(){const n=this._buildings,l=this._closestBuildingId,m=l&&n?n[l]:void 0;if(!m)return void this.fire(new o.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let v=null;for(const S of m.floorIds)if(this._activeFloors&&this._activeFloors.has(S)){v=S;break}const w=Array.from(m.floorIds).map(S=>({id:S,name:m.floors[S].name,zIndex:m.floors[S].zIndex})).sort((S,C)=>C.zIndex-S.zIndex);this.fire(new o.z("selector-update",{selectedFloorId:v,activeFloorsVisible:this._activeFloorsVisible,floors:w}))}_updateActiveFloors(){const n=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:n,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var yp=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,sv=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,ov=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,lh="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ch=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,av=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Qm=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Ia=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,eg=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,zt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,lv=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const uh=[];ol(yp,uh),ol(ov,uh),ol(sv,uh);const dh={"_prelude_fog.vertex.glsl":av,"_prelude_terrain.vertex.glsl":ch,"_prelude_shadow.vertex.glsl":zt,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Qm,"_prelude_shadow.fragment.glsl":lv,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Ia,"_prelude_raster_particle.glsl":eg},vp={};vn("",ch),vn(Qm,av),vn(lv,zt),vn(Ia,""),vn(eg,"");const xp=vn(sv,ov),Jl=yp;var tg={background:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:vn(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:vn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:vn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:vn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:vn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:vn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:vn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:vn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:vn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:vn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:vn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:vn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:vn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:vn(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:vn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:vn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:vn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:vn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:vn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:vn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,lh),skyboxGradient:vn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,lh),skyboxCapture:vn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:vn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:vn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:vn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:vn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:vn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:vn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:vn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function ol(p,n){const l=p.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let m of l)if(m=m.trim(),m[0]==="#"&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=m.split(" ");for(const w of v)n.includes(w)||n.push(w)}}function vn(p,n){const l=/#include\s+"([^"]+)"/g,m=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,v={},w=[],S=[];if(p=p.replace(l,(A,M)=>(S.push(M),"")),(n=n.replace(l,(A,M)=>(w.push(M),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let C=[...uh];ol(p,C),ol(n,C);for(const A of[...w,...S])dh[A]||console.error(`Undefined include: ${A}`),vp[A]||(vp[A]=[],ol(dh[A],vp[A])),C=[...C,...vp[A]];return{fragmentSource:p=p.replace(m,(A,M,D,F,O)=>(v[O]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${O}
in ${D} ${F} ${O};
#else
uniform ${D} ${F} u_${O};
#endif
`:M==="initialize"?`
#ifdef HAS_UNIFORM_u_${O}
    ${D} ${F} ${O} = u_${O};
#endif
`:M==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    in ${D} ${F} ${O};
#endif
`:M==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(m,(A,M,D,F,O)=>{const q=`MATERIAL_ATTRIBUTE_OFFSET_${O}`,Z=F==="float"?"vec2":F,Q=`GET_ATTRIBUTE_${Z}(a_${O}, materialInfo, ${q})`,se=O.match(/color/)?"color":Z;return M==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${O}
in ${D} ${F} a_${O};
#endif
`:v[O]?M==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
    #if !defined(${q})
        in ${D} ${Z} a_${O};
    #endif
out ${D} ${F} ${O};
#else
uniform ${D} ${F} u_${O};
#endif
`:M==="initialize"?se==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${D} ${F} ${O} = u_${O};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${O}) 
    #ifdef ${q}
        ${O} = unpack_mix_${se}(${Q}, u_${O}_t);
    #else
        ${O} = unpack_mix_${se}(a_${O}, u_${O}_t);
    #endif
#else
    ${D} ${F} ${O} = u_${O};
#endif
`:M==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    in ${D} ${F} a_${O};
    out ${D} ${F} ${O};
#endif
`:M==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    ${O} = a_${O};
#endif
`:void 0:M==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
    #if !defined(${q})
        in ${D} ${Z} a_${O};
    #endif  
#else
uniform ${D} ${F} u_${O};
#endif
`:M==="define-instanced"?se==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${O}0;
in vec4 a_${O}1;
in vec4 a_${O}2;
in vec4 a_${O}3;
#else
uniform ${D} ${F} u_${O};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${D} ${Z} a_${O};
#else
uniform ${D} ${F} u_${O};
#endif
`:M==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${O}
    ${D} ${F} ${O} = a_${O};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    #ifdef ${q}
        ${D} ${F} ${O} = ${Q};
    #else
        ${D} ${F} ${O} = a_${O};
    #endif
#else
    ${D} ${F} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    #ifdef ${q}
        ${D} ${F} ${O} = unpack_mix_${se}(${Q}, u_${O}_t);
    #else
        ${D} ${F} ${O} = unpack_mix_${se}(a_${O}, u_${O}_t);
    #endif
#else
    ${D} ${F} ${O} = u_${O};
#endif
`}),usedDefines:C,vertexIncludes:w,fragmentIncludes:S}}class hh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,l,m,v,w,S,C,A){this.context=n;let M=this.boundPaintVertexBuffers.length!==v.length;for(let F=0;!M&&F<v.length;F++)this.boundPaintVertexBuffers[F]!==v[F]&&(M=!0);let D=this.boundDynamicVertexBuffers.length!==C.length;for(let F=0;!D&&F<C.length;F++)this.boundDynamicVertexBuffers[F]!==C[F]&&(D=!0);if(!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==m||M||D||this.boundIndexBuffer!==w||this.boundVertexOffset!==S)this.freshBind(l,m,v,w,S,C,A);else{n.bindVertexArrayOES.set(this.vao);for(const F of C)F&&(F.bind(),A&&F.instanceCount&&F.setVertexAttribDivisor(n.gl,l,A));w&&w.dynamicDraw&&w.bind()}}freshBind(n,l,m,v,w,S,C){const A=this.context,M=A.gl;this.vao&&this.destroy(),this.vao=A.gl.createVertexArray(),A.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=v,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=S,l.enableAttributes(M,n),l.bind(),l.setVertexAttribPointers(M,n,w);for(const D of m)D.enableAttributes(M,n),D.bind(),D.setVertexAttribPointers(M,n,w);for(const D of S)D&&(D.enableAttributes(M,n),D.bind(),D.setVertexAttribPointers(M,n,w),C&&D.instanceCount&&D.setVertexAttribDivisor(M,n,C));v&&v.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function k2(p,n){const l=Math.pow(2,n.canonical.z),m=n.canonical.y;return[new o.ae(0,m/l).toLngLat().lat,new o.ae(0,(m+1)/l).toLngLat().lat]}function j2(p,n,l,m,v,w,S){const C=p.context,A=C.gl,M=l.hillshadeFBO;if(!M)return;p.prepareDrawTile();const D=p.isTileAffectedByFog(n),F=p.getOrCreateProgram("hillshade",{overrideFog:D});C.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,M.colorAttachment.get());const O=((se,ne,ae,he)=>{const ce=ae.paint.get("hillshade-shadow-color"),we=ae.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",fe=ae.paint.get("hillshade-highlight-color"),Te=ae.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ve=ae.paint.get("hillshade-accent-color"),ge=ae.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ce=ae.paint.get("hillshade-emissive-strength");let Fe=o.an(ae.paint.get("hillshade-illumination-direction"));if(ae.paint.get("hillshade-illumination-anchor")==="viewport")Fe-=se.transform.angle;else if(se.style&&se.style.enable3dLights()&&se.style.directionalLight){const st=se.style.directionalLight.properties.get("direction"),He=o.d3(st.x,st.y,st.z);Fe=o.an(He[1])}const Oe=!se.options.moving;return{u_matrix:he||se.transform.calculateProjMatrix(ne.tileID.toUnwrapped(),Oe),u_image:0,u_latrange:k2(0,ne.tileID),u_light:[ae.paint.get("hillshade-exaggeration"),Fe],u_shadow:ce.toPremultipliedRenderColor(we?null:ae.lut),u_highlight:fe.toPremultipliedRenderColor(Te?null:ae.lut),u_emissive_strength:Ce,u_accent:ve.toPremultipliedRenderColor(ge?null:ae.lut)}})(p,l,m,p.terrain?n.projMatrix:null);p.uploadCommonUniforms(C,F,n.toUnwrapped());const{tileBoundsBuffer:q,tileBoundsIndexBuffer:Z,tileBoundsSegments:Q}=p.getTileBoundsBuffers(l);F.draw(p,A.TRIANGLES,v,w,S,Dr.disabled,O,m.id,q,Z,Q)}function rg(p,n,l){if(!n.needsDEMTextureUpload)return;const m=p.context,v=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||p.getTileTexture(l.stride);const w=l.getPixels();n.demTexture?n.demTexture.update(w,{premultiply:!1}):n.demTexture=new o.T(m,w,v.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function R2(p,n,l){const m=p.context,v=m.gl;if(!n.dem)return;const w=n.dem;if(m.activeTexture.set(v.TEXTURE1),rg(p,n,w),!n.demTexture)return;n.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);const S=w.dim;m.activeTexture.set(v.TEXTURE0);let C=n.hillshadeFBO;if(!C){const O=new o.T(m,{width:S,height:S,data:null},v.RGBA8);O.bind(v.LINEAR,v.CLAMP_TO_EDGE),C=n.hillshadeFBO=m.createFramebuffer(S,S,!0,"renderbuffer"),C.colorAttachment.set(O.texture)}m.bindFramebuffer.set(C.framebuffer),m.viewport.set([0,0,S,S]);const{tileBoundsBuffer:A,tileBoundsIndexBuffer:M,tileBoundsSegments:D}=p.getMercatorTileBoundsBuffers(),F=[];p.linearFloatFilteringSupported()&&F.push("TERRAIN_DEM_FLOAT_FORMAT"),p.getOrCreateProgram("hillshadePrepare",{defines:F}).draw(p,v.TRIANGLES,cr.disabled,Br.disabled,Qr.unblended,Dr.disabled,((O,q)=>{const Z=q.stride,Q=o.bB();return o.cd(Q,0,o.al,-o.al,0,0,1),o.bq(Q,Q,[0,-o.al,0]),{u_matrix:Q,u_image:1,u_dimension:[Z,Z],u_zoom:O.overscaledZ}})(n.tileID,w),l.id,A,M,D),n.needsHillshadePrepare=!1}class Bi{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class qb extends Bi{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class cv extends Bi{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class M2 extends Bi{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class D2 extends Bi{getDefault(){return[!0,!0,!0,!0]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class N2 extends Bi{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class O2 extends Bi{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Gb extends Bi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const l=this.current;(n.func!==l.func||n.ref!==l.ref||n.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class L2 extends Bi{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class ng extends Bi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=n,this.dirty=!1}}class z2 extends Bi{getDefault(){return[0,1]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Wb extends Bi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=n,this.dirty=!1}}class uv extends Bi{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class ig extends Bi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.BLEND):l.disable(l.BLEND),this.current=n,this.dirty=!1}}class dv extends Bi{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class ad extends Bi{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class fh extends Bi{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class bp extends Bi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=n,this.dirty=!1}}class ph extends Bi{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Hb extends Bi{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let hv=class extends Bi{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class Zb extends Bi{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class mh extends Bi{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class sg extends Bi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class og extends Bi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class fv extends Bi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class ag extends Bi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class wp extends Bi{getDefault(){return null}set(n){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Xb extends Bi{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class Kb extends Bi{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Yb extends Bi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class gh extends Bi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class lg extends Bi{constructor(n,l){super(n),this.context=n,this.parent=l}getDefault(){return null}}class F2 extends lg{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Jb extends lg{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class B2 extends lg{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,this.attachment(),l.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class pv extends Jb{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const mv=(p,n,l)=>({u_matrix:p,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:l}),cg=(p,n,l,m,v,w,S,C,A,M,D,F,O,q,Z,Q)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:l,u_zoom_transition:v,u_merc_center:w,u_image0:0,u_frustum_tl:S,u_frustum_tr:C,u_frustum_br:A,u_frustum_bl:M,u_globe_pos:D,u_globe_radius:F,u_viewport:O,u_grid_matrix:Q?Float32Array.from(Q):new Float32Array(9),u_skirt_height:q,u_far_z_cutoff:Z});function ug(p,n){return p!=null&&n!=null&&!(!p.hasData()||!n.hasData())&&p.demTexture!=null&&n.demTexture!=null&&p.tileID.key!==n.tileID.key}const ld=new class{constructor(){this.operations={}}newMorphing(p,n,l,m,v){if(p in this.operations){const w=this.operations[p];w.to.tileID.key!==l.tileID.key&&(w.queued=l)}else this.operations[p]={startTime:m,phase:0,duration:v,from:n,to:l,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const n=this.operations[p];return{from:n.from,to:n.to,phase:n.phase}}update(p){for(const n in this.operations){const l=this.operations[n];for(l.phase=(p-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,p)){delete this.operations[n];break}}}_nextOp(p,n){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=n,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},gv={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Qb(p,n,l){if(n===0)return 0;const m=n<1&&l===514?.25/n:1;return 6*Math.pow(1.5,22-p)*Math.max(n,1)*m}function Sp(p,n){const l=1<<p.z;return!n&&(p.x===0||p.x===l-1)||p.y===0||p.y===l-1}const cd=p=>({u_matrix:p});function dg(p,n,l,m,v){if(v>0){const w=o.o.now(),S=(w-p.timeAdded)/v,C=n?(w-n.timeAdded)/v:-1,A=l.getSource(),M=m.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),D=!n||Math.abs(n.tileID.overscaledZ-M)>Math.abs(p.tileID.overscaledZ-M),F=D&&p.refreshedUponExpiration?1:o.aA(D?S:1-C,0,1);return n?{opacity:1,mix:1-F,isFading:S<1}:{opacity:F,mix:0,isFading:S<1}}return{opacity:1,mix:0,isFading:!1}}class Pa extends tl{constructor(n){const l=qo("mock-dem",{type:"raster-dem",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("mock-dem",l,!1),l.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,l){n.state="loaded",l(null)}}class _v extends tl{constructor(n){const l=qo("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,l,m){if(n.freezeTileCoverage)return;this.transform=n;const v=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,S)=>{if(w[S.key]="",!this._tiles[S.key]){const C=new Xl(S,this._source.tileSize*S.overscaleFactor(),n.tileZoom,void 0,void 0,this._source.worldview);C.state="loaded",this._tiles[S.key]=C}return w},{});for(const w in this._tiles)w in v||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(n){const l=this.proxyCachedFBO[n];if(l!==void 0){const m=Object.values(l);this.renderCachePool.push(...m),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Tp extends o.aP{constructor(n,l,m){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=l,this.projMatrix=m}}class Ep extends o.bU{constructor(n,l){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,v,w]=function(A){const M=new o.bc,D=new o.b0,F=131;M.reserve(17161),D.reserve(33800);const O=o.al/128,q=o.al+O/2,Z=q+O;for(let se=-O;se<Z;se+=O)for(let ne=-O;ne<Z;ne+=O){const ae=ne<0||ne>q||se<0||se>q?24575:0,he=o.aA(Math.round(ne),0,o.al),ce=o.aA(Math.round(se),0,o.al);M.emplaceBack(he+ae,ce)}const Q=(se,ne)=>{const ae=ne*F+se;D.emplaceBack(ae+1,ae,ae+F),D.emplaceBack(ae+F,ae+F+1,ae+1)};for(let se=1;se<129;se++)for(let ne=1;ne<129;ne++)Q(ne,se);return[0,129].forEach(se=>{for(let ne=0;ne<130;ne++)Q(ne,se),Q(se,ne)}),[M,D,32768]}(),S=n.context;this.gridBuffer=S.createVertexBuffer(m,o.be.members),this.gridIndexBuffer=S.createIndexBuffer(v),this.gridSegments=o.bf.simpleSegment(0,0,m.length,v.length),this.gridNoSkirtSegments=o.bf.simpleSegment(0,0,m.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new _v(l.map),this.orthoMatrix=o.bB(),o.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.al,0,o.al,0,1);const C=S.gl;this._overlapStencilMode=new Br({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Pa(l.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,l,m){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const v=n.terrain.properties,w=n.terrain.drapeRenderMode===0,S=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.o.now();const C=n.terrain&&n.terrain.scope,A=v.get("source"),M=w?this._mockSourceCache:n.getSourceCache(A,C);if(!M)return void o.w(`Couldn't find terrain source "${A}".`);if(this.sourceCache=M,this._attenuationRange=n.terrain.getAttenuationRange(),this._exaggeration=S?this.calculateExaggeration(l):v.get("exaggeration"),!l.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const D=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const F=this.getScaledDemTileSize();this.sourceCache.update(l,F,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,D(),this._initializing=!0),D(),l.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0,this._previousZoom=l.zoom}else this._disable()}calculateExaggeration(n){if(this._attenuationRange&&n.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(n.zoom);const l=this._previousCameraAltitude,m=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=m;const v=l!=null?m-l:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;const w=n.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(w);let C=w-this._previousZoom;const A=this._previousUpdateTimestamp;let M=w;this._evaluationZoom!=null&&(M=this._evaluationZoom,Math.abs(w-M)>.5&&(C=.5*(w-M+C)),C*v<0&&(M+=C)),this._evaluationZoom=M;const D=S.getExaggeration(M),F=D===S.getExaggeration(Math.max(0,M-.1));if(F&&Math.abs(D-this._exaggeration)<.01)return D;let O=Math.min(.1,.00375*(this._updateTimestamp-A));return(F||D<.1||Math.abs(C)<1e-4)&&(O=Math.min(.2,4*O)),o.ak(this._exaggeration,D,O)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.dataType==="source"&&n.coord?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(o.ae.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=l.getIds().map(A=>{const M=l.getTileByID(A).tileID;return M.projMatrix=m.calculateProjMatrix(M.toUnwrapped()),M});(function(A,M){const D=M.transform.pointCoordinate(M.transform.getCameraPoint()),F=new o.P(D.x,D.y);A.sort((O,q)=>{if(q.overscaledZ-O.overscaledZ)return q.overscaledZ-O.overscaledZ;const Z=new o.P(O.canonical.x+(1<<O.canonical.z)*O.wrap,O.canonical.y),Q=new o.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),se=F.mult(1<<O.canonical.z);return se.x-=.5,se.y-=.5,se.distSqr(Z)-se.distSqr(Q)})})(v,this.painter);const w=this.proxyToSource||{};this.proxyToSource={},v.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const A in S){const M=S[A];if(!M.used||(M!==this.sourceCache&&this.resetTileLookupCache(M.id),this._setupProxiedCoordsForOrtho(M,n[A],w),M.usedForTerrain))continue;const D=n[A];M.getSource().reparseOverscaled&&this._assignTerrainTiles(D)}this.proxiedCoords[l.id]=v.map(A=>new Tp(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;const C={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const M=this.terrainTileForTile[A.key];if(!M)continue;const D=M.tileID.key;D in C||(this._visibleDemTiles.push(M),C[D]=D)}}_assignTerrainTiles(n){this._initializing||n.forEach(l=>{if(this.terrainTileForTile[l.key])return;const m=this._findTileCoveringTileID(l,this.sourceCache);m&&(this.terrainTileForTile[l.key]=m)})}_prepareDEMTextures(){const n=this.painter.context,l=n.gl;for(const m in this.terrainTileForTile){const v=this.terrainTileForTile[m],w=v.dem;!w||v.demTexture&&!v.needsDEMTextureUpload||(n.activeTexture.set(l.TEXTURE1),rg(this.painter,v,w))}}_prepareDemTileUniforms(n,l,m,v){if(!l||l.demTexture==null)return!1;const w=n.tileID.canonical,S=Math.pow(2,l.tileID.canonical.z-w.z),C=v||"";return m[`u_dem_tl${C}`]=[w.x*S%1,w.y*S%1],m[`u_dem_scale${C}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let n=0;const l=this._visibleDemTiles.reduce((m,v)=>{if(!v.dem)return m;const w=v.dem.tree.minimums[0];return w>0&&n++,m+w},0);return n?l/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,l=n.gl;n.activeTexture.set(l.TEXTURE2);const m=this._getLoadedAreaMinimum(),v=new o.dK({width:1,height:1},new Float32Array([m]));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(v,{premultiply:!1}):w=this._emptyDEMTexture=new o.T(n,v,l.R32F,{premultiply:!1}),w}setupElevationDraw(n,l,m){const v=this.painter.context,w=v.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};S.u_exaggeration=this.exaggeration();let C=null,A=null,M=1;if(m&&m.morphing&&this._useVertexMorphing){const q=m.morphing.srcDemTile,Z=m.morphing.dstDemTile;M=m.morphing.phase,q&&Z&&(this._prepareDemTileUniforms(n,q,S,"_prev")&&(A=q),this._prepareDemTileUniforms(n,Z,S)&&(C=Z))}const D=q=>q&&q.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST;let F=null;var O;if(this.enabled?A&&C?(F=C.demTexture,v.activeTexture.set(w.TEXTURE4),A.demTexture.bind(D(A),w.CLAMP_TO_EDGE),S.u_dem_lerp=M):(C=this.terrainTileForTile[n.tileID.key],F=this._prepareDemTileUniforms(n,C,S)?C.demTexture:this.emptyDEMTexture):F=this.emptyDEMTexture,v.activeTexture.set(w.TEXTURE2),F&&(S.u_dem_size=(O=F).size[0]===1?1:O.size[0]-2,F.bind(D(C),w.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(m&&m.useDepthForOcclusion,l,S),m&&m.useMeterToDem&&C){const q=(1<<C.tileID.canonical.z)*o.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=q}if(m&&m.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),l.setTerrainUniformValues(v,S),this.painter.transform.projection.name==="globe"){const q=this.globeUniformValues(this.painter.transform,n.tileID.canonical,m&&m.useDenormalizedUpVectorScale);l.setGlobeUniformValues(v,q)}}globeUniformValues(n,l,m){const v=n.projection;return{u_tile_tl_up:v.upVector(l,0,0),u_tile_tr_up:v.upVector(l,o.al,0),u_tile_br_up:v.upVector(l,o.al,o.al),u_tile_bl_up:v.upVector(l,0,o.al),u_tile_up_scale:m?o.dL(1):v.upVectorScale(l,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const l=this.painter,m=this.painter.context;n.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,w,S,C,A){if(v.transform.projection.name==="globe")(function(M,D,F,O,q){const Z=M.context,Q=Z.gl;let se,ne;const ae=M.transform,he=o.dD(M,Z,ae),ce=(st,He)=>{if(ne===He)return;const ht=[gv[He],"PROJECTION_GLOBE_VIEW"];he&&ht.push("CUSTOM_ANTIALIASING");const Nt=M.isTileAffectedByFog(st);se=M.getOrCreateProgram("globeRaster",{defines:ht,overrideFog:Nt}),ne=He},we=M.colorModeForRenderPass(),fe=new cr(Q.LEQUAL,cr.ReadWrite,M.depthRangeFor3D);ld.update(q);const Te=o.dE(ae),ve=[o.aF(ae.center.lng),o.aJ(ae.center.lat)],ge=M.globeSharedBuffers,Ce=[ae.width*o.o.devicePixelRatio,ae.height*o.o.devicePixelRatio],Fe=Float32Array.from(ae.globeMatrix),Oe={useDenormalizedUpVectorScale:!0};{const st=M.transform,He=Qb(st.zoom,D.exaggeration(),D.sourceCache._source.tileSize);ne=-1;const ht=Q.TRIANGLES;for(const Nt of O){const Ge=F.getTile(Nt),Re=Br.disabled,ft=D.prevTerrainTileForTile[Nt.key],Ze=D.terrainTileForTile[Nt.key];ug(ft,Ze)&&ld.newMorphing(Nt.key,ft,Ze,q,250),Z.activeTexture.set(Q.TEXTURE0),Ge.texture&&Ge.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const wt=ld.getMorphValuesForProxy(Nt.key),Ft=wt?1:0;wt&&Object.assign(Oe,{morphing:{srcDemTile:wt.from,dstDemTile:wt.to,phase:o.dC(wt.phase)}});const sr=o.dF(Nt.canonical),Rt=o.dG(sr.getCenter().lat),Lt=o.dH(Nt.canonical,sr,Rt,st.worldSize/st._pixelsPerMercatorPixel),ar=o.bj(o.dI(Nt.canonical)),Jt=cg(st.expandedFarZProjMatrix,Fe,Te,ar,o.aj(st.zoom),ve,st.frustumCorners.TL,st.frustumCorners.TR,st.frustumCorners.BR,st.frustumCorners.BL,st.globeCenterInViewSpace,st.globeRadius,Ce,He,st._farZ,Lt);if(ce(Nt,Ft),se&&(D.setupElevationDraw(Ge,se,Oe),M.uploadCommonUniforms(Z,se,Nt.toUnwrapped()),ge)){const[Zt,Qt,Tr]=ge.getGridBuffers(Rt,He!==0);se.draw(M,ht,fe,Re,we,Dr.backCCW,Jt,"globe_raster",Zt,Qt,Tr)}}}if(ge&&(M.renderDefaultNorthPole||M.renderDefaultSouthPole)){const st=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];he&&st.push("CUSTOM_ANTIALIASING"),se=M.getOrCreateProgram("globeRaster",{defines:st});for(const He of O){const{x:ht,y:Nt,z:Ge}=He.canonical,Re=Nt===0,ft=Nt===(1<<Ge)-1,[Ze,wt,Ft,sr]=ge.getPoleBuffers(Ge,!1);if(sr&&(Re||ft)){const Rt=F.getTile(He);Z.activeTexture.set(Q.TEXTURE0),Rt.texture&&Rt.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);let Lt=o.dJ(Ge,ht,ae);const ar=o.bj(o.dI(He.canonical)),Jt=(Zt,Qt)=>Zt.draw(M,Q.TRIANGLES,fe,Br.disabled,we,Dr.disabled,cg(ae.expandedFarZProjMatrix,Lt,Lt,ar,0,ve,ae.frustumCorners.TL,ae.frustumCorners.TR,ae.frustumCorners.BR,ae.frustumCorners.BL,ae.globeCenterInViewSpace,ae.globeRadius,Ce,0,ae._farZ),"globe_pole_raster",Qt,Ft,sr);D.setupElevationDraw(Rt,se,Oe),M.uploadCommonUniforms(Z,se,He.toUnwrapped()),Re&&M.renderDefaultNorthPole&&Jt(se,Ze),ft&&M.renderDefaultSouthPole&&(Lt=o.cR(o.bB(),Lt,[1,-1,1]),Jt(se,wt))}}}})(v,w,S,C,A);else{const M=v.context,D=M.gl;let F,O;const q=v.shadowRenderer,Z=wc(v,v.longestCutoffRange),Q=we=>{if(O===we)return;const fe=[];fe.push(gv[we]),Z.shouldRenderCutoff&&fe.push("RENDER_CUTOFF"),q&&(fe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&fe.push("NORMAL_OFFSET")),F=v.getOrCreateProgram("terrainRaster",{defines:fe}),O=we},se=v.colorModeForRenderPass(),ne=new cr(D.LEQUAL,cr.ReadWrite,v.depthRangeFor3D);ld.update(A);const ae=v.transform,he=Qb(ae.zoom,w.exaggeration(),w.sourceCache._source.tileSize);let ce=[0,0,0];if(q){const we=v.style.directionalLight,fe=v.style.ambientLight;we&&fe&&(ce=il(v.style,we,fe))}{O=-1;const we=D.TRIANGLES,[fe,Te]=[w.gridIndexBuffer,w.gridSegments];for(const ve of C){const ge=S.getTile(ve),Ce=Br.disabled,Fe=w.prevTerrainTileForTile[ve.key],Oe=w.terrainTileForTile[ve.key];ug(Fe,Oe)&&ld.newMorphing(ve.key,Fe,Oe,A,250),M.activeTexture.set(D.TEXTURE0),ge.texture&&ge.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const st=ld.getMorphValuesForProxy(ve.key),He=st?1:0;let ht;st&&(ht={morphing:{srcDemTile:st.from,dstDemTile:st.to,phase:o.dC(st.phase)}});const Nt=mv(ve.projMatrix,Sp(ve.canonical,ae.renderWorldCopies)?he/10:he,ce);if(Q(He),!F)continue;w.setupElevationDraw(ge,F,ht);const Ge=ve.toUnwrapped();q&&q.setupShadows(Ge,F),v.uploadCommonUniforms(M,F,Ge,null,Z),F.draw(v,we,ne,Ce,se,Dr.backCCW,Nt,"terrain_raster",w.gridBuffer,fe,Te)}}}}(l,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const l=this.painter,m=this.painter.context,v=this.proxySourceCache,w=this.proxiedCoords[v.id],S=this._drapedRenderBatches.shift(),C=l.style.order,A=[];let M=0;for(const D of w){const F=v.getTileByID(D.proxyTileKey),O=v.proxyCachedFBO[D.key]?v.proxyCachedFBO[D.key][n]:void 0,q=O!==void 0?v.renderCache[O]:this.pool[M++],Z=O!==void 0;if(F.texture=q.tex,Z&&!q.dirty){A.push(F.tileID);continue}let Q;m.bindFramebuffer.set(q.fb.framebuffer),this.renderedToTile=!1,q.dirty&&(m.clear({color:o.ao.transparent,stencil:0}),q.dirty=!1);for(let se=S.start;se<=S.end;++se){const ne=l.style._mergedLayers[C[se]];if(ne.isHidden(l.transform.zoom))continue;const ae=l.style.getLayerSourceCache(ne),he=ae?this.proxyToSource[D.key][ae.id]:[D];if(!he)continue;const ce=he;m.viewport.set([0,0,q.fb.width,q.fb.height]),Q!==(ae?ae.id:null)&&(this._setupStencil(q,he,ne,ae),Q=ae?ae.id:null),l.renderLayer(l,ae,ne,ce)}if(this._drapedRenderBatches.length===0)for(const se of this._pendingGroundEffectLayers){const ne=l.style._mergedLayers[C[se]];if(ne.isHidden(l.transform.zoom))continue;const ae=l.style.getLayerSourceCache(ne),he=ae?this.proxyToSource[D.key][ae.id]:[D];if(!he)continue;const ce=he;m.viewport.set([0,0,q.fb.width,q.fb.height]),Q!==(ae?ae.id:null)&&(this._setupStencil(q,he,ne,ae),Q=ae?ae.id:null),l.renderLayer(l,ae,ne,ce)}this.renderedToTile?(q.dirty=!0,A.push(F.tileID)):Z||--M,M===5&&(M=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,l.width,l.height]),S.end+1}postRender(){}isLayerOrderingCorrect(n){const l=n.order.length;let m=-1,v=l;for(let w=0;w<l;++w)this._style.isLayerDraped(n._mergedLayers[n.order[w]])?m=Math.max(m,w):v=Math.min(v,w);return v>m}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{n=Math.min(n,l.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,l,m){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const S=w.tileID,C=1<<S.overscaledZ,{x:A,y:M}=S.canonical,D=A/C,F=(A+1)/C,O=M/C,q=(M+1)/C;return{minx:D,miny:O,maxx:F,maxy:q,t:w.dem.tree.raycastRoot(D,O,F,q,n,l,m),tile:w}});v.sort((w,S)=>(w.t!==null?w.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const w of v){if(w.t==null)return null;const S=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,n,l,m);if(S!=null)return S}return null}_createFBO(){const n=this.painter.context,l=n.gl,m=this.drapeBufferSize;n.activeTexture.set(l.TEXTURE0);const v=new o.T(n,{width:m[0],height:m[1],data:null},l.RGBA8);v.bind(l.LINEAR,l.CLAMP_TO_EDGE);const w=n.createFramebuffer(m[0],m[1],!0,null);return w.colorAttachment.set(v.texture),w.depthAttachment=new pv(n,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:w,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const l=this._style._mergedLayers[n],m=l.isHidden(this.painter.transform.zoom);return l.type==="hillshade"||l.type==="custom"?!m&&l.shouldRedrape():!m&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const m of this._style.getSources())if(m instanceof No){n=!0;break}if(!n)return;const l={};for(let m=0;m<this._style.order.length;++m){const v=this._style._mergedLayers[this._style.order[m]],w=this._style.getLayerSourceCache(v);if(w&&!l[w.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof o.ad){l[w.id]=!0;for(const S of this.proxyCoords){const C=this.proxyToSource[S.key][w.id];if(C)for(const A of C)this._clearRenderCacheForTile(w.id,A)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const m in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[m]._source instanceof Qa){n=!0;break}if(!n)return;const l={};for(let m=0;m<this._style.order.length;++m){const v=this._style._mergedLayers[this._style.order[m]],w=this._style.getLayerSourceCache(v);if(!w||l[w.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;const S=v.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const A=this.proxyToSource[C.key][w.id];if(A)for(const M of A){const D=dg(w.getTile(M),w.findLoadedParent(M,0),w,this.painter.transform,S);(D.opacity!==1||D.mix!==0)&&this._clearRenderCacheForTile(w.id,M)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const n=this._style.order,l=n.length;if(l===0)return;const m=[];this._pendingGroundEffectLayers=[];let v,w=0,S=this._style._mergedLayers[n[w]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++w<l;)S=this._style._mergedLayers[n[w]];for(;w<l;++w){const C=this._style._mergedLayers[n[w]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?v===void 0&&(v=w):(C.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(w),v!==void 0&&(m.push({start:v,end:w-1}),v=void 0)))}if(v!==void 0&&m.push({start:v,end:w-1}),m.length!==0){const C=m[m.length-1];this._pendingGroundEffectLayers.every(A=>A>C.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=m}_setupRenderCache(n){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const S=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let C=0;C<S.length;++C){const A=Object.values(S[C]);l.renderCachePool.push(...A)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,v=this._tilesDirty;for(let S=m.length-1;S>=0;S--){const C=m[S];if(l.getTileByID(C.key),l.proxyCachedFBO[C.key]!==void 0){const A=n[C.key],M=this.proxyToSource[C.key];let D=0;for(const F in M){const O=M[F],q=A[F];if(!q||q.length!==O.length||O.some((Z,Q)=>Z!==q[Q]||v[F]&&v[F].hasOwnProperty(Z.key))){D=-1;break}++D}for(const F in l.proxyCachedFBO[C.key])l.renderCache[l.proxyCachedFBO[C.key][F]].dirty=D<0||D!==Object.values(A).length}}const w=[...this._drapedRenderBatches];w.sort((S,C)=>C.end-C.start-(S.end-S.start));for(const S of w)for(const C of m){if(l.proxyCachedFBO[C.key])continue;let A=l.renderCachePool.pop();A===void 0&&l.renderCache.length<50&&(A=l.renderCache.length,l.renderCache.push(this._createFBO())),A!==void 0&&(l.proxyCachedFBO[C.key]={},l.proxyCachedFBO[C.key][S.start]=A,l.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(n,l,m,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,S=w.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let C;if(m.isTileClipped())C=l.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):Br.disabled}_renderTileClippingMasks(n,l){const m=this.painter,v=this.painter.context,w=v.gl;m._tileClippingMaskIDs={},v.setColorMode(Qr.disabled),v.setDepthMode(cr.disabled);const S=m.getOrCreateProgram("clippingMask");for(const C of n){const A=m._tileClippingMaskIDs[C.key]=--l;S.draw(m,w.TRIANGLES,cr.disabled,new Br({func:w.ALWAYS,mask:0},A,255,w.KEEP,w.KEEP,w.REPLACE),Qr.disabled,Dr.disabled,cd(C.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(n){const l=this.painter.transform;if(n.x<0||n.x>l.width||n.y<0||n.y>l.height)return null;const m=[n.x,n.y,1,1];o.aC(m,m,l.pixelMatrixInverse),o.cJ(m,m,1/m[3]),m[0]/=l.worldSize,m[1]/=l.worldSize;const v=l._camera.position,w=o.ce(1,l.center.lat),S=[v[0],v[1],v[2]/w,0],C=o.d9([],m.slice(0,3),S);o.aw(C,C);const A=this.raycast(S,C,this._exaggeration);return A!==null&&A?(o.bG(S,S,C,A),S[3]=S[2],S[2]*=w,S):null}_setupProxiedCoordsForOrtho(n,l,m){if(n.getSource()instanceof o.aT)return this._setupProxiedCoordsForImageSource(n,l,m);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const v=this.proxiedCoords[n.id]=[],w=this.proxyCoords;for(let A=0;A<w.length;A++){const M=w[A],D=this._findTileCoveringTileID(M,n);if(D){const F=this._createProxiedId(M,D,m[M.key]&&m[M.key][n.id]);v.push(F),this.proxyToSource[M.key][n.id]=[F]}}let S=!1;const C=new Set;for(let A=0;A<l.length;A++){const M=n.getTile(l[A]);if(!M||!M.hasData())continue;const D=this._findTileCoveringTileID(M.tileID,this.proxySourceCache);if(D&&D.tileID.canonical.z!==M.tileID.canonical.z){const F=this.proxyToSource[D.tileID.key][n.id],O=this._createProxiedId(D.tileID,M,m[D.tileID.key]&&m[D.tileID.key][n.id]);F?F.splice(F.length-1,0,O):this.proxyToSource[D.tileID.key][n.id]=[O];const q=this.proxyToSource[D.tileID.key][n.id];C.has(q)||C.add(q),v.push(O),S=!0}}if(this._sourceTilesOverlap[n.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const A of C)A.sort((M,D)=>D.overscaledZ-M.overscaledZ)}_setupProxiedCoordsForImageSource(n,l,m){if(!n.getSource().loaded())return;const v=this.proxiedCoords[n.id]=[],w=this.proxyCoords,S=n.getSource(),C=S.tileID;if(!C)return;const A=new o.P(C.x,C.y)._div(1<<C.z),M=S.coordinates.map(o.ae.fromLngLat).reduce((F,O)=>(F.min.x=Math.min(F.min.x,O.x-A.x),F.min.y=Math.min(F.min.y,O.y-A.y),F.max.x=Math.max(F.max.x,O.x-A.x),F.max.y=Math.max(F.max.y,O.y-A.y),F),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),D=(F,O)=>{const q=F.wrap+F.canonical.x/(1<<F.canonical.z),Z=F.canonical.y/(1<<F.canonical.z),Q=o.al/(1<<F.canonical.z),se=O.wrap+O.canonical.x/(1<<O.canonical.z),ne=O.canonical.y/(1<<O.canonical.z);return q+Q<se+M.min.x||q>se+M.max.x||Z+Q<ne+M.min.y||Z>ne+M.max.y};for(let F=0;F<w.length;F++){const O=w[F];for(let q=0;q<l.length;q++){const Z=n.getTile(l[q]);if(!Z||!Z.hasData()||D(O,Z.tileID))continue;const Q=this._createProxiedId(O,Z,m[O.key]&&m[O.key][n.id]),se=this.proxyToSource[O.key][n.id];se?se.push(Q):this.proxyToSource[O.key][n.id]=[Q],v.push(Q)}}}_createProxiedId(n,l,m){let v=this.orthoMatrix;if(m){const w=m.find(S=>S.key===l.tileID.key);if(w)return w}if(l.tileID.key!==n.key){const w=n.canonical.z-l.tileID.canonical.z;let S,C,A;v=o.bB();const M=l.tileID.wrap-n.wrap<<n.overscaledZ;w>0?(S=o.al>>w,C=S*((l.tileID.canonical.x<<w)-n.canonical.x+M),A=S*((l.tileID.canonical.y<<w)-n.canonical.y)):(S=o.al<<-w,C=o.al*(l.tileID.canonical.x-(n.canonical.x+M<<-w)),A=o.al*(l.tileID.canonical.y-(n.canonical.y<<-w))),o.cd(v,0,S,0,S,0,1),o.bq(v,v,[C,A,0])}return new Tp(l.tileID,n.key,v)}_findTileCoveringTileID(n,l){let m=l.getTile(n);if(m&&m.hasData())return m;const v=this._findCoveringTileCache[l.id],w=v[n.key];if(m=w?l.getTileByID(w):null,m&&m.hasData()||w===null)return m;let S=m?m.tileID:n,C=S.overscaledZ;const A=l.getSource().minzoom,M=[];if(!w){const F=l.getSource().maxzoom;if(n.canonical.z>=F){const O=n.canonical.z-F;l.getSource().reparseOverscaled?(C=Math.max(n.canonical.z+2,l.transform.tileZoom),S=new o.aP(C,n.wrap,F,n.canonical.x>>O,n.canonical.y>>O)):O!==0&&(C=F,S=new o.aP(C,n.wrap,F,n.canonical.x>>O,n.canonical.y>>O))}S.key!==n.key&&(M.push(S.key),m=l.getTile(S))}const D=F=>{M.forEach(O=>{v[O]=F}),M.length=0};for(C-=1;C>=A&&(!m||!m.hasData());C--){m&&D(m.tileID.key);const F=S.calculateScaledKey(C);if(m=l.getTileByID(F),m&&m.hasData())break;const O=v[F];if(O===null)break;O===void 0?M.push(F):m=l.getTileByID(O)}return D(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,l){let m=this._tilesDirty[n];m||(m=this._tilesDirty[n]={}),m[l.key]=!0}}function yv(p,n,l){const m=function(C,A,M){const D=o.bI(A,C),F=o.bI(M,[.2126,.7152,.0722]),O=(Z,Q,se)=>(1-se)*Z+se*Q,q=O(1-.3*Math.min(F,1),1,Math.min(D+1,1));return O(.92,1,Math.asin(o.aA(A[2],-1,1))/Math.PI+.5)*q}(p,[0,0,1],n),v=[0,0,0];o.c4(v,l.slice(0,3),m);const w=[0,0,0];o.c4(w,n.slice(0,3),p[2]);const S=[0,0,0];return o.d7(S,v,w),o.da(S)}const vv=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],xv=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Cp{static cacheKey(n,l,m,v){let w=`${l}${v?v.cacheKey:""}`;for(const S of m)n.usedDefines.includes(S)&&(w+=`/${S}`);return w}constructor(n,l,m,v,w,S){const C=n.gl;this.program=C.createProgram(),this.configuration=v,this.name=l,this.fixedDefines=[...S];let A=v?v.defines():[];A=A.concat(S.map(Z=>`#define ${Z}`));const M=`#version 300 es
`;let D=M+A.concat("precision mediump float;",Jl,xp.fragmentSource).join(`
`);for(const Z of m.fragmentIncludes)D+=`
${dh[Z]}`;D+=`
${m.fragmentSource}`;let F=M+A.concat("precision highp float;",Jl,xp.vertexSource).join(`
`);for(const Z of m.vertexIncludes)F+=`
${dh[Z]}`;this.forceManualRenderingForInstanceIDShaders=n.forceManualRenderingForInstanceIDShaders&&m.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(F+=`
uniform int u_instanceID;
`),F+=`
${m.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(F=F.replaceAll("gl_InstanceID","u_instanceID"));const O=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(O,D),C.compileShader(O),C.attachShader(this.program,O);const q=C.createShader(C.VERTEX_SHADER);C.isContextLost()?this.failedToCreate=!0:(C.shaderSource(q,F),C.compileShader(q),C.attachShader(this.program,q),this.attributes={},C.linkProgram(this.program),C.deleteShader(q),C.deleteShader(O),this.fixedUniforms=w(n),this.binderUniforms=v?v.getUniforms(n):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(Z=>({u_instanceID:new o.cg(Z)}))(n)),(S.includes("TERRAIN")||l.indexOf("symbol")!==-1||l.indexOf("circle")!==-1)&&(this.terrainUniforms=(Z=>({u_dem:new o.cg(Z),u_dem_prev:new o.cg(Z),u_dem_tl:new o.cj(Z),u_dem_scale:new o.ci(Z),u_dem_tl_prev:new o.cj(Z),u_dem_scale_prev:new o.ci(Z),u_dem_size:new o.ci(Z),u_dem_lerp:new o.ci(Z),u_exaggeration:new o.ci(Z),u_depth:new o.cg(Z),u_depth_size_inv:new o.cj(Z),u_depth_range_unpack:new o.cj(Z),u_occluder_half_size:new o.ci(Z),u_occlusion_depth_offset:new o.ci(Z),u_meter_to_dem:new o.ci(Z),u_label_plane_matrix_inv:new o.ck(Z)}))(n)),S.includes("GLOBE")&&(this.globeUniforms=(Z=>({u_tile_tl_up:new o.ch(Z),u_tile_tr_up:new o.ch(Z),u_tile_br_up:new o.ch(Z),u_tile_bl_up:new o.ch(Z),u_tile_up_scale:new o.ci(Z)}))(n)),S.includes("FOG")&&(this.fogUniforms=(Z=>({u_fog_matrix:new o.ck(Z),u_fog_range:new o.cj(Z),u_fog_color:new o.d2(Z),u_fog_horizon_blend:new o.ci(Z),u_fog_vertical_limit:new o.cj(Z),u_fog_temporal_offset:new o.ci(Z),u_frustum_tl:new o.ch(Z),u_frustum_tr:new o.ch(Z),u_frustum_br:new o.ch(Z),u_frustum_bl:new o.ch(Z),u_globe_pos:new o.ch(Z),u_globe_radius:new o.ci(Z),u_globe_transition:new o.ci(Z),u_is_globe:new o.cg(Z),u_viewport:new o.cj(Z)}))(n)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Z=>({u_cutoff_params:new o.d2(Z)}))(n)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Z=>({u_lighting_ambient_color:new o.ch(Z),u_lighting_directional_dir:new o.ch(Z),u_lighting_directional_color:new o.ch(Z),u_ground_radiance:new o.ch(Z)}))(n)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Z=>({u_light_matrix_0:new o.ck(Z),u_light_matrix_1:new o.ck(Z),u_fade_range:new o.cj(Z),u_shadow_normal_offset:new o.ch(Z),u_shadow_intensity:new o.ci(Z),u_shadow_texel_size:new o.ci(Z),u_shadow_map_resolution:new o.ci(Z),u_shadow_direction:new o.ch(Z),u_shadow_bias:new o.ch(Z),u_shadowmap_0:new o.cg(Z),u_shadowmap_1:new o.cg(Z)}))(n)))}getAttributeLocation(n,l){let m=this.attributes[l];return m===void 0&&(m=this.attributes[l]=n.getAttribLocation(this.program,l)),m}setTerrainUniformValues(n,l){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in l)m[v]&&m[v].set(this.program,v,l[v])}}setGlobeUniformValues(n,l){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in l)m[v]&&m[v].set(this.program,v,l[v])}}setFogUniformValues(n,l){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in l)m[v].set(this.program,v,l[v])}}setCutoffUniformValues(n,l){if(!this.cutoffUniforms)return;const m=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in l)m[v].set(this.program,v,l[v])}}setLightsUniformValues(n,l){if(!this.lightsUniforms)return;const m=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const v in l)m[v].set(this.program,v,l[v])}}setShadowUniformValues(n,l){if(this.failedToCreate||!this.shadowUniforms)return;const m=this.shadowUniforms;n.program.set(this.program);for(const v in l)m[v].set(this.program,v,l[v])}_drawDebugWireframe(n,l,m,v,w,S,C,A,M,D){const F=n.options.wireframe;if(F.terrain===!1&&F.layers2D===!1&&F.layers3D===!1)return;const O=n.context;if(!(!(!F.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!F.layers2D||n._terrain&&n._terrain.renderingToTexture||!vv.includes(this.name))||!(!F.layers3D||!xv.includes(this.name))))return;const q=O.gl,Z=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,w,O);if(!Z)return;const Q=[...this.fixedDefines];Q.push("DEBUG_WIREFRAME");const se=n.getOrCreateProgram(this.name,{config:this.configuration,defines:Q});O.program.set(se.program);const ne=(ce,we,fe)=>{if(we[ce]&&fe[ce])for(const Te in we[ce])fe[ce][Te]&&fe[ce][Te].set(fe.program,Te,we[ce][Te].current)};M&&M.setUniforms(se.program,O,se.binderUniforms,C,{zoom:A}),ne("fixedUniforms",this,se),ne("terrainUniforms",this,se),ne("globeUniforms",this,se),ne("fogUniforms",this,se),ne("lightsUniforms",this,se),ne("shadowUniforms",this,se),Z.bind(),O.setColorMode(new Qr([q.ONE,q.ONE_MINUS_SRC_ALPHA,q.ZERO,q.ONE],o.ao.transparent,[!0,!0,!0,!1])),O.setDepthMode(new cr(l.func===q.LESS?q.LEQUAL:l.func,cr.ReadOnly,l.range)),O.setStencilMode(Br.disabled);const ae=3*S.primitiveLength*2,he=3*S.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ce=D||1;for(let we=0;we<ce;++we)se.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",we),q.drawElements(q.LINES,ae,q.UNSIGNED_SHORT,he)}else D&&D>1?q.drawElementsInstanced(q.LINES,ae,q.UNSIGNED_SHORT,he,D):q.drawElements(q.LINES,ae,q.UNSIGNED_SHORT,he);w.bind(),O.program.set(this.program),O.setDepthMode(l),O.setStencilMode(m),O.setColorMode(v)}checkUniforms(n,l,m){if(this.fixedDefines.includes(l)){for(const v of Object.keys(m))if(!m[v].initialized)throw new Error(`Program '${this.name}', from draw '${n}': uniform ${v} not set but required by ${l} being defined`)}}draw(n,l,m,v,w,S,C,A,M,D,F,O,q,Z,Q,se){const ne=n.context,ae=ne.gl;if(this.failedToCreate)return;ne.program.set(this.program),ne.setDepthMode(m),ne.setStencilMode(v),ne.setColorMode(w),ne.setCullFace(S);for(const we of Object.keys(this.fixedUniforms))this.fixedUniforms[we].set(this.program,we,C[we]);Z&&Z.setUniforms(this.program,ne,this.binderUniforms,O,{zoom:q});const he={[ae.POINTS]:1,[ae.LINES]:2,[ae.TRIANGLES]:3,[ae.LINE_STRIP]:1}[l];this.checkUniforms(A,"RENDER_SHADOWS",this.shadowUniforms);const ce=se&&se>0?1:void 0;for(const we of F.get()){const fe=we.vaos||(we.vaos={});if((fe[A]||(fe[A]=new hh)).bind(ne,this,M,Z?Z.getPaintVertexBuffers():[],D,we.vertexOffset,Q||[],ce),this.forceManualRenderingForInstanceIDShaders){const Te=se||1;for(let ve=0;ve<Te;++ve)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ve),D?ae.drawElements(l,we.primitiveLength*he,ae.UNSIGNED_SHORT,we.primitiveOffset*he*2):ae.drawArrays(l,we.vertexOffset,we.vertexLength)}else se&&se>1?ae.drawElementsInstanced(l,we.primitiveLength*he,ae.UNSIGNED_SHORT,we.primitiveOffset*he*2,se):D?ae.drawElements(l,we.primitiveLength*he,ae.UNSIGNED_SHORT,we.primitiveOffset*he*2):ae.drawArrays(l,we.vertexOffset,we.vertexLength);l===ae.TRIANGLES&&D&&this._drawDebugWireframe(n,m,v,w,D,we,O,q,Z,se)}}}function hg(p,n,l=0){const m=Math.pow(2,n.tileID.overscaledZ),v=n.tileSize*Math.pow(2,p.transform.tileZoom)/m,w=v*(n.tileID.canonical.x+n.tileID.wrap*m),S=v*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.ay(n,1,p.transform.tileZoom),u_pixel_coord_upper:[w>>16,S>>16],u_pixel_coord_lower:[65535&w,65535&S],u_pattern_transition:l}}const _h={terrain:0,flat:1},fg=o.bB(),pg=(p,n,l,m,v,w,S,C,A,M,D,F,O,q,Z,Q,se,ne)=>{const ae=n.style.light,he=ae.properties.get("position"),ce=[he.x,he.y,he.z],we=o.dN();ae.properties.get("anchor")==="viewport"&&(o.dO(we,-n.transform.angle),o.dP(ce,ce,we));const fe=ae.properties.get("color").toPremultipliedRenderColor(null),Te=n.transform,ve={u_matrix:p,u_lightpos:ce,u_lightintensity:ae.properties.get("intensity"),u_lightcolor:[fe.r,fe.g,fe.b],u_vertical_gradient:+l,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:fg,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:_h[M],u_base_type:_h[D],u_ao:v,u_edge_radius:w,u_width_scale:S,u_flood_light_color:Z,u_vertical_scale:Q,u_flood_light_intensity:se,u_ground_shadow_factor:ne};return Te.projection.name==="globe"&&(ve.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],ve.u_zoom_transition=F,ve.u_inv_rot_matrix=q,ve.u_merc_center=O,ve.u_up_dir=Te.projection.upVector(new o.cC(0,0,0),O[0]*o.al,O[1]*o.al),ve.u_height_lift=A),ve},e1=(p,n,l,m,v,w)=>({u_matrix:p,u_edge_radius:n,u_width_scale:l,u_vertical_scale:m,u_height_type:_h[v],u_base_type:_h[w]}),t1=(p,n,l,m,v,w,S,C,A,M,D,F,O,q,Z,Q,se,ne)=>{const ae=pg(p,n,l,m,v,w,S,C,M,D,F,O,q,Z,Q,se,1,[0,0,0]),he={u_height_factor:-Math.pow(2,C.overscaledZ)/A.tileSize/8};return Object.assign(ae,hg(n,A,ne),he)},yh=(p,n,l,m,v,w,S,C,A,M,D)=>({u_matrix:n,u_opacity:l,u_ao_pass:m?1:0,u_meter_to_tile:v,u_ao:w,u_flood_light_intensity:S,u_flood_light_color:C,u_attenuation:A,u_edge_radius:M,u_fb:0,u_fb_size:D,u_dynamic_offset:1}),r1=(p,n,l)=>({u_matrix:p,u_emissive_strength:n,u_ground_shadow_factor:l}),n1=(p,n,l,m,v,w=0)=>Object.assign(r1(p,n,v),hg(l,m,w)),V2=(p,n,l,m)=>({u_matrix:p,u_world:l,u_emissive_strength:n,u_ground_shadow_factor:m}),U2=(p,n,l,m,v,w,S=0)=>Object.assign(n1(p,n,l,m,w,S),{u_world:v}),$2=(p,n)=>({u_matrix:p,u_ground_shadow_factor:n}),mg=(p,n,l,m,v)=>({u_matrix:p,u_camera_pos:[n[0],n[1],n[2]],u_depth_bias:l,u_height_scale:m,u_reset_depth:v}),bv=(p,n,l,m,v,w,S,C,A)=>({u_matrix:p,u_normal_matrix:n,u_opacity:l,u_faux_facade_ao_intensity:m,u_camera_pos:v,u_tile_to_meter:w,u_facade_emissive_chance:S,u_flood_light_color:C,u_flood_light_intensity:A}),wv=p=>({u_matrix:p}),i1=p=>({u_matrix:p}),vh=(p,n,l,m,v,w,S,C)=>{const A=o.al/w.tileSize;return{u_matrix:p,u_inv_rot_matrix:n,u_camera_to_center_distance:l.getCameraToCenterDistance(C),u_extrude_scale:[l.pixelsToGLUnits[0]/A,l.pixelsToGLUnits[1]/A],u_zoom_transition:m,u_tile_id:S,u_merc_center:v}},Sv=(p,n,l=1)=>({u_matrix:p,u_color:n,u_overlay:0,u_overlay_scale:l}),s1=o.bB(),o1=(p,n,l,m,v,w,S)=>{const C=p.transform,A=C.projection.name==="globe",M=A?o.dQ(C.zoom,n.canonical)*C._pixelsPerMercatorPixel:o.ay(l,1,w),D={u_matrix:n.projMatrix,u_extrude_scale:M,u_intensity:S,u_inv_rot_matrix:s1,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){D.u_inv_rot_matrix=m,D.u_merc_center=v,D.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],D.u_zoom_transition=o.aj(C.zoom);const F=v[0]*o.al,O=v[1]*o.al;D.u_up_dir=C.projection.upVector(new o.cC(0,0,0),F,O)}return D};function gg(p,[n,l,m,v],[w,S]){if(w===S)return[0,0,0,0];const C=255*(p-1)/(p*(S-w));return[n*C,l*C,m*C,v*C]}function Sc(p,n,[l,m]){return l===m?0:.5/p+(n-l)*(p-1)/(p*(m-l))}const Ap=(p,n,l,m,v,w,S,C,A,M,D,F,O,q,Z,Q,se,ne,ae,he,ce)=>({u_matrix:p,u_normalize_matrix:n,u_globe_matrix:l,u_merc_matrix:m,u_grid_matrix:v,u_tl_parent:w,u_scale_parent:M,u_fade_t:D.mix,u_opacity:D.opacity*F.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:F.paint.get("raster-brightness-min"),u_brightness_high:F.paint.get("raster-brightness-max"),u_saturation_factor:o.dS(F.paint.get("raster-saturation")),u_contrast_factor:o.dR(F.paint.get("raster-contrast")),u_spin_weights:_g(F.paint.get("raster-hue-rotate")),u_perspective_transform:O,u_raster_elevation:q,u_zoom_transition:S,u_merc_center:C,u_cutoff_params:A,u_colorization_mix:gg(o.dT,Q,ne),u_colorization_offset:Sc(o.dT,se,ne),u_color_ramp:Z,u_texture_offset:[he/(ae+2*he),ae/(ae+2*he)],u_texture_res:[ae+2*he,ae+2*he],u_emissive_strength:ce});function _g(p){p*=Math.PI/180;const n=Math.sin(p),l=Math.cos(p);return[(2*l+1)/3,(-Math.sqrt(3)*n-l+1)/3,(Math.sqrt(3)*n-l+1)/3]}const ud=.05,mu=(p,n,l,m,v,w,S,C,A,M,D,F)=>({u_matrix:p,u_normalize_matrix:n,u_globe_matrix:l,u_merc_matrix:m,u_grid_matrix:v,u_tl_parent:w,u_scale_parent:M,u_fade_t:D.mix,u_opacity:D.opacity,u_image0:0,u_image1:1,u_raster_elevation:F,u_zoom_transition:S,u_merc_center:C,u_cutoff_params:A}),Tv=(p,n,l,m,v,w,S,C,A,M)=>({u_particle_texture:p,u_particle_texture_side_len:n,u_tile_offset:l,u_velocity:m,u_color_ramp:w,u_velocity_res:v,u_max_speed:S,u_uv_offset:C,u_data_scale:[255*A[0],255*A[1]],u_data_offset:M,u_particle_pos_scale:1.1,u_particle_pos_offset:[ud,ud]}),yg=(p,n,l,m,v,w,S,C,A,M)=>({u_particle_texture:p,u_particle_texture_side_len:n,u_velocity:l,u_velocity_res:m,u_max_speed:v,u_speed_factor:w,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:C,u_data_scale:[255*A[0],255*A[1]],u_data_offset:M,u_particle_pos_scale:1.1,u_particle_pos_offset:[ud,ud]}),Ev=o.bB(),Cv=(p,n,l,m,v,w,S,C,A,M,D,F,O,q,Z,Q,se,ne,ae,he,ce,we,fe,Te)=>{const ve=v.transform,ge={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:ve.getCameraToCenterDistance(ae),u_rotate_symbol:+l,u_aspect_ratio:ve.width/ve.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:S,u_coord_matrix:C,u_is_text:+M,u_elevation_from_sea:A?1:0,u_pitch_with_map:+m,u_texsize:D,u_texsize_icon:F,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ev,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ev,u_up_vector:[0,-1,0],u_color_adj_mat:we,u_icon_transition:fe||0,u_gamma_scale:m?v.transform.getCameraToCenterDistance(ae)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:o.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Te||1,u_ground_shadow_factor:he,u_inv_matrix:o.bk(o.bB(),S),u_normal_scale:ce,u_lutTexture:io.LUT};return ae.name==="globe"&&(ge.u_tile_id=[q.canonical.x,q.canonical.y,1<<q.canonical.z],ge.u_zoom_transition=Z,ge.u_inv_rot_matrix=se,ge.u_merc_center=Q,ge.u_camera_forward=ve._camera.forward(),ge.u_ecef_origin=o.dU(ve.globeMatrix,q.toUnwrapped()),ge.u_tile_matrix=Float32Array.from(ve.globeMatrix),ge.u_up_vector=ne),ge},vg=(p,n,l,m)=>({u_matrix:p,u_emissive_strength:n,u_opacity:l,u_color:m}),xg=(p,n,l,m,v,w,S,C,A)=>Object.assign(function(M,D,F,O,q,Z){const{width:Q,height:se}=O.imageManager.getPixelSize(D),ne=Math.pow(2,Z.tileID.overscaledZ),ae=Z.tileSize*Math.pow(2,O.transform.tileZoom)/ne,he=ae*(Z.tileID.canonical.x+Z.tileID.wrap*ne),ce=ae*Z.tileID.canonical.y;return{u_image:0,u_pattern_tl:F.tl,u_pattern_br:F.br,u_texsize:[Q,se],u_pattern_size:F.displaySize,u_pattern_units_to_pixels:q?[O.transform.width,-1*O.transform.height]:[1/o.ay(Z,1,O.transform.tileZoom),1/o.ay(Z,1,O.transform.tileZoom)],u_pixel_coord_upper:[he>>16,ce>>16],u_pixel_coord_lower:[65535&he,65535&ce]}}(0,w,S,m,C,A),{u_matrix:p,u_emissive_strength:n,u_opacity:l}),Av=new Float32Array(o.bz([])),bg=(p,n,l,m,v,w,S,C,A,M,D,F,O,q=[0,0,0],Z,Q,se)=>{const ne=v.style.light,ae=ne.properties.get("position"),he=[-ae.x,-ae.y,ae.z],ce=o.dN();ne.properties.get("anchor")==="viewport"&&(o.dO(ce,-v.transform.angle),o.dP(he,he,ce));const we=D.alphaMode==="MASK",fe=ne.properties.get("color").toNonPremultipliedRenderColor(null),Te=O.paint.get("model-ambient-occlusion-intensity"),ve=O.paint.get("model-color").constantOr(o.ao.white).toNonPremultipliedRenderColor(null);return ve.a=O.paint.get("model-color-mix-intensity").constantOr(0),se&&(ve.r=se[0],ve.g=se[1],ve.b=se[2],ve.a=se[3]),Q&&(ve.r=Q.color.r,ve.g=Q.color.g,ve.b=Q.color.b,ve.a=Q.colorMix,F=Q.emissionStrength,w=Q.opacity),{u_matrix:p,u_lighting_matrix:n,u_normal_matrix:l,u_node_matrix:m||Av,u_lightpos:he,u_lightintensity:ne.properties.get("intensity"),u_lightcolor:[fe.r,fe.g,fe.b],u_camera_pos:q,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+we,u_alphaCutoff:D.alphaCutoff,u_baseColorFactor:S.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:C.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:A,u_roughnessFactor:M,u_baseColorTexture:io.BaseColor,u_metallicRoughnessTexture:io.MetallicRoughness,u_normalTexture:io.Normal,u_occlusionTexture:io.Occlusion,u_emissionTexture:io.Emission,u_lutTexture:io.LUT,u_color_mix:ve.toArray01(),u_aoIntensity:Te,u_emissive_strength:F,u_occlusionTextureTransform:Z||[0,0,0,0]}},xh=(p,n=Av,l=Av)=>({u_matrix:p,u_instance:n,u_node_matrix:l}),q2={fillExtrusion:p=>({u_matrix:new o.ck(p),u_lightpos:new o.ch(p),u_lightintensity:new o.ci(p),u_lightcolor:new o.ch(p),u_vertical_gradient:new o.ci(p),u_opacity:new o.ci(p),u_edge_radius:new o.ci(p),u_width_scale:new o.ci(p),u_ao:new o.cj(p),u_height_type:new o.cg(p),u_base_type:new o.cg(p),u_tile_id:new o.ch(p),u_zoom_transition:new o.ci(p),u_inv_rot_matrix:new o.ck(p),u_merc_center:new o.cj(p),u_up_dir:new o.ch(p),u_height_lift:new o.ci(p),u_flood_light_color:new o.ch(p),u_vertical_scale:new o.ci(p),u_flood_light_intensity:new o.ci(p),u_ground_shadow_factor:new o.ch(p)}),fillExtrusionDepth:p=>({u_matrix:new o.ck(p),u_edge_radius:new o.ci(p),u_width_scale:new o.ci(p),u_vertical_scale:new o.ci(p),u_height_type:new o.cg(p),u_base_type:new o.cg(p)}),fillExtrusionPattern:p=>({u_matrix:new o.ck(p),u_lightpos:new o.ch(p),u_lightintensity:new o.ci(p),u_lightcolor:new o.ch(p),u_vertical_gradient:new o.ci(p),u_height_factor:new o.ci(p),u_edge_radius:new o.ci(p),u_width_scale:new o.ci(p),u_ao:new o.cj(p),u_height_type:new o.cg(p),u_base_type:new o.cg(p),u_tile_id:new o.ch(p),u_zoom_transition:new o.ci(p),u_inv_rot_matrix:new o.ck(p),u_merc_center:new o.cj(p),u_up_dir:new o.ch(p),u_height_lift:new o.ci(p),u_image:new o.cg(p),u_texsize:new o.cj(p),u_pixel_coord_upper:new o.cj(p),u_pixel_coord_lower:new o.cj(p),u_tile_units_to_pixels:new o.ci(p),u_opacity:new o.ci(p),u_pattern_transition:new o.ci(p)}),fillExtrusionGroundEffect:p=>({u_matrix:new o.ck(p),u_opacity:new o.ci(p),u_ao_pass:new o.ci(p),u_meter_to_tile:new o.ci(p),u_ao:new o.cj(p),u_flood_light_intensity:new o.ci(p),u_flood_light_color:new o.ch(p),u_attenuation:new o.ci(p),u_edge_radius:new o.ci(p),u_fb:new o.cg(p),u_fb_size:new o.ci(p),u_dynamic_offset:new o.ci(p)}),fill:p=>({u_matrix:new o.ck(p),u_emissive_strength:new o.ci(p),u_ground_shadow_factor:new o.ch(p)}),fillPattern:p=>({u_matrix:new o.ck(p),u_emissive_strength:new o.ci(p),u_image:new o.cg(p),u_texsize:new o.cj(p),u_pixel_coord_upper:new o.cj(p),u_pixel_coord_lower:new o.cj(p),u_tile_units_to_pixels:new o.ci(p),u_ground_shadow_factor:new o.ch(p),u_pattern_transition:new o.ci(p)}),fillOutline:p=>({u_matrix:new o.ck(p),u_emissive_strength:new o.ci(p),u_world:new o.cj(p),u_ground_shadow_factor:new o.ch(p)}),fillOutlinePattern:p=>({u_matrix:new o.ck(p),u_emissive_strength:new o.ci(p),u_world:new o.cj(p),u_image:new o.cg(p),u_texsize:new o.cj(p),u_pixel_coord_upper:new o.cj(p),u_pixel_coord_lower:new o.cj(p),u_tile_units_to_pixels:new o.ci(p),u_ground_shadow_factor:new o.ch(p),u_pattern_transition:new o.ci(p)}),building:p=>({u_matrix:new o.ck(p),u_normal_matrix:new o.ck(p),u_opacity:new o.ci(p),u_faux_facade_ao_intensity:new o.ci(p),u_camera_pos:new o.ch(p),u_tile_to_meter:new o.ci(p),u_facade_emissive_chance:new o.ci(p),u_flood_light_color:new o.ch(p),u_flood_light_intensity:new o.ci(p)}),buildingBloom:p=>({u_matrix:new o.ck(p)}),buildingDepth:p=>({u_matrix:new o.ck(p)}),elevatedStructuresDepth:p=>({u_matrix:new o.ck(p),u_depth_bias:new o.ci(p)}),elevatedStructures:p=>({u_matrix:new o.ck(p),u_ground_shadow_factor:new o.ch(p)}),elevatedStructuresDepthReconstruct:p=>({u_matrix:new o.ck(p),u_camera_pos:new o.ch(p),u_depth_bias:new o.ci(p),u_height_scale:new o.ci(p),u_reset_depth:new o.ci(p)}),circle:o.dX,collisionBox:p=>({u_matrix:new o.ck(p),u_inv_rot_matrix:new o.ck(p),u_camera_to_center_distance:new o.ci(p),u_extrude_scale:new o.cj(p),u_zoom_transition:new o.ci(p),u_merc_center:new o.cj(p),u_tile_id:new o.ch(p)}),collisionCircle:p=>({u_matrix:new o.ck(p),u_inv_matrix:new o.ck(p),u_camera_to_center_distance:new o.ci(p),u_viewport_size:new o.cj(p)}),debug:p=>({u_color:new o.dA(p),u_matrix:new o.ck(p),u_overlay:new o.cg(p),u_overlay_scale:new o.ci(p)}),clippingMask:p=>({u_matrix:new o.ck(p)}),heatmap:p=>({u_extrude_scale:new o.ci(p),u_intensity:new o.ci(p),u_matrix:new o.ck(p),u_inv_rot_matrix:new o.ck(p),u_merc_center:new o.cj(p),u_tile_id:new o.ch(p),u_zoom_transition:new o.ci(p),u_up_dir:new o.ch(p)}),heatmapTexture:p=>({u_image:new o.cg(p),u_color_ramp:new o.cg(p),u_opacity:new o.ci(p)}),hillshade:p=>({u_matrix:new o.ck(p),u_image:new o.cg(p),u_latrange:new o.cj(p),u_light:new o.cj(p),u_shadow:new o.dA(p),u_highlight:new o.dA(p),u_emissive_strength:new o.ci(p),u_accent:new o.dA(p)}),hillshadePrepare:p=>({u_matrix:new o.ck(p),u_image:new o.cg(p),u_dimension:new o.cj(p),u_zoom:new o.ci(p)}),line:o.dW,linePattern:o.dV,raster:p=>({u_matrix:new o.ck(p),u_normalize_matrix:new o.ck(p),u_globe_matrix:new o.ck(p),u_merc_matrix:new o.ck(p),u_grid_matrix:new o.dB(p),u_tl_parent:new o.cj(p),u_scale_parent:new o.ci(p),u_fade_t:new o.ci(p),u_opacity:new o.ci(p),u_image0:new o.cg(p),u_image1:new o.cg(p),u_brightness_low:new o.ci(p),u_brightness_high:new o.ci(p),u_saturation_factor:new o.ci(p),u_contrast_factor:new o.ci(p),u_spin_weights:new o.ch(p),u_perspective_transform:new o.cj(p),u_raster_elevation:new o.ci(p),u_zoom_transition:new o.ci(p),u_merc_center:new o.cj(p),u_cutoff_params:new o.d2(p),u_colorization_mix:new o.d2(p),u_colorization_offset:new o.ci(p),u_color_ramp:new o.cg(p),u_texture_offset:new o.cj(p),u_texture_res:new o.cj(p),u_emissive_strength:new o.ci(p)}),rasterParticle:p=>({u_matrix:new o.ck(p),u_normalize_matrix:new o.ck(p),u_globe_matrix:new o.ck(p),u_merc_matrix:new o.ck(p),u_grid_matrix:new o.dB(p),u_tl_parent:new o.cj(p),u_scale_parent:new o.ci(p),u_fade_t:new o.ci(p),u_opacity:new o.ci(p),u_image0:new o.cg(p),u_image1:new o.cg(p),u_raster_elevation:new o.ci(p),u_zoom_transition:new o.ci(p),u_merc_center:new o.cj(p),u_cutoff_params:new o.d2(p)}),rasterParticleTexture:p=>({u_texture:new o.cg(p),u_opacity:new o.ci(p)}),rasterParticleDraw:p=>({u_particle_texture:new o.cg(p),u_particle_texture_side_len:new o.ci(p),u_tile_offset:new o.cj(p),u_velocity:new o.cg(p),u_color_ramp:new o.cg(p),u_velocity_res:new o.cj(p),u_max_speed:new o.ci(p),u_uv_offset:new o.cj(p),u_data_scale:new o.cj(p),u_data_offset:new o.ci(p),u_particle_pos_scale:new o.ci(p),u_particle_pos_offset:new o.cj(p)}),rasterParticleUpdate:p=>({u_particle_texture:new o.cg(p),u_particle_texture_side_len:new o.ci(p),u_velocity:new o.cg(p),u_velocity_res:new o.cj(p),u_max_speed:new o.ci(p),u_speed_factor:new o.ci(p),u_reset_rate:new o.ci(p),u_rand_seed:new o.ci(p),u_uv_offset:new o.cj(p),u_data_scale:new o.cj(p),u_data_offset:new o.ci(p),u_particle_pos_scale:new o.ci(p),u_particle_pos_offset:new o.cj(p)}),symbol:p=>({u_is_size_zoom_constant:new o.cg(p),u_is_size_feature_constant:new o.cg(p),u_size_t:new o.ci(p),u_size:new o.ci(p),u_camera_to_center_distance:new o.ci(p),u_rotate_symbol:new o.cg(p),u_aspect_ratio:new o.ci(p),u_fade_change:new o.ci(p),u_matrix:new o.ck(p),u_label_plane_matrix:new o.ck(p),u_coord_matrix:new o.ck(p),u_is_text:new o.cg(p),u_elevation_from_sea:new o.cg(p),u_pitch_with_map:new o.cg(p),u_texsize:new o.cj(p),u_texsize_icon:new o.cj(p),u_texture:new o.cg(p),u_texture_icon:new o.cg(p),u_gamma_scale:new o.ci(p),u_device_pixel_ratio:new o.ci(p),u_tile_id:new o.ch(p),u_zoom_transition:new o.ci(p),u_inv_rot_matrix:new o.ck(p),u_merc_center:new o.cj(p),u_camera_forward:new o.ch(p),u_tile_matrix:new o.ck(p),u_up_vector:new o.ch(p),u_ecef_origin:new o.ch(p),u_is_halo:new o.cg(p),u_icon_transition:new o.ci(p),u_color_adj_mat:new o.ck(p),u_scale_factor:new o.ci(p),u_ground_shadow_factor:new o.ch(p),u_inv_matrix:new o.ck(p),u_normal_scale:new o.ci(p),u_lutTexture:new o.cg(p)}),background:p=>({u_matrix:new o.ck(p),u_emissive_strength:new o.ci(p),u_opacity:new o.ci(p),u_color:new o.dA(p)}),backgroundPattern:p=>({u_matrix:new o.ck(p),u_emissive_strength:new o.ci(p),u_opacity:new o.ci(p),u_image:new o.cg(p),u_pattern_tl:new o.cj(p),u_pattern_br:new o.cj(p),u_texsize:new o.cj(p),u_pattern_size:new o.cj(p),u_pixel_coord_upper:new o.cj(p),u_pixel_coord_lower:new o.cj(p),u_pattern_units_to_pixels:new o.cj(p)}),terrainRaster:p=>({u_matrix:new o.ck(p),u_image0:new o.cg(p),u_skirt_height:new o.ci(p),u_ground_shadow_factor:new o.ch(p)}),skybox:p=>({u_matrix:new o.ck(p),u_sun_direction:new o.ch(p),u_cubemap:new o.cg(p),u_opacity:new o.ci(p),u_temporal_offset:new o.ci(p)}),skyboxGradient:p=>({u_matrix:new o.ck(p),u_color_ramp:new o.cg(p),u_center_direction:new o.ch(p),u_radius:new o.ci(p),u_opacity:new o.ci(p),u_temporal_offset:new o.ci(p)}),skyboxCapture:p=>({u_matrix_3f:new o.dB(p),u_sun_direction:new o.ch(p),u_sun_intensity:new o.ci(p),u_color_tint_r:new o.d2(p),u_color_tint_m:new o.d2(p),u_luminance:new o.ci(p)}),globeRaster:p=>({u_proj_matrix:new o.ck(p),u_globe_matrix:new o.ck(p),u_normalize_matrix:new o.ck(p),u_merc_matrix:new o.ck(p),u_zoom_transition:new o.ci(p),u_merc_center:new o.cj(p),u_image0:new o.cg(p),u_grid_matrix:new o.dB(p),u_skirt_height:new o.ci(p),u_far_z_cutoff:new o.ci(p),u_frustum_tl:new o.ch(p),u_frustum_tr:new o.ch(p),u_frustum_br:new o.ch(p),u_frustum_bl:new o.ch(p),u_globe_pos:new o.ch(p),u_globe_radius:new o.ci(p),u_viewport:new o.cj(p)}),globeAtmosphere:p=>({u_frustum_tl:new o.ch(p),u_frustum_tr:new o.ch(p),u_frustum_br:new o.ch(p),u_frustum_bl:new o.ch(p),u_horizon:new o.ci(p),u_transition:new o.ci(p),u_fadeout_range:new o.ci(p),u_atmosphere_fog_color:new o.d2(p),u_high_color:new o.d2(p),u_space_color:new o.d2(p),u_temporal_offset:new o.ci(p),u_horizon_angle:new o.ci(p)}),model:p=>({u_matrix:new o.ck(p),u_lighting_matrix:new o.ck(p),u_normal_matrix:new o.ck(p),u_node_matrix:new o.ck(p),u_lightpos:new o.ch(p),u_lightintensity:new o.ci(p),u_lightcolor:new o.ch(p),u_camera_pos:new o.ch(p),u_opacity:new o.ci(p),u_baseColorFactor:new o.d2(p),u_emissiveFactor:new o.d2(p),u_metallicFactor:new o.ci(p),u_roughnessFactor:new o.ci(p),u_baseTextureIsAlpha:new o.cg(p),u_alphaMask:new o.cg(p),u_alphaCutoff:new o.ci(p),u_baseColorTexture:new o.cg(p),u_metallicRoughnessTexture:new o.cg(p),u_normalTexture:new o.cg(p),u_occlusionTexture:new o.cg(p),u_emissionTexture:new o.cg(p),u_lutTexture:new o.cg(p),u_color_mix:new o.d2(p),u_aoIntensity:new o.ci(p),u_emissive_strength:new o.ci(p),u_occlusionTextureTransform:new o.d2(p)}),modelDepth:p=>({u_matrix:new o.ck(p),u_instance:new o.ck(p),u_node_matrix:new o.ck(p)}),groundShadow:p=>({u_matrix:new o.ck(p),u_ground_shadow_factor:new o.ch(p)}),stars:p=>({u_matrix:new o.ck(p),u_up:new o.ch(p),u_right:new o.ch(p),u_intensity_multiplier:new o.ci(p)}),snowParticle:p=>({u_modelview:new o.ck(p),u_projection:new o.ck(p),u_time:new o.ci(p),u_cam_pos:new o.ch(p),u_velocityConeAperture:new o.ci(p),u_velocity:new o.ci(p),u_horizontalOscillationRadius:new o.ci(p),u_horizontalOscillationRate:new o.ci(p),u_boxSize:new o.ci(p),u_billboardSize:new o.ci(p),u_simpleShapeParameters:new o.cj(p),u_screenSize:new o.cj(p),u_thinningCenterPos:new o.cj(p),u_thinningShape:new o.ch(p),u_thinningAffectedRatio:new o.ci(p),u_thinningParticleOffset:new o.ci(p),u_particleColor:new o.d2(p),u_direction:new o.ch(p)}),rainParticle:p=>({u_modelview:new o.ck(p),u_projection:new o.ck(p),u_time:new o.ci(p),u_cam_pos:new o.ch(p),u_texScreen:new o.cg(p),u_velocityConeAperture:new o.ci(p),u_velocity:new o.ci(p),u_boxSize:new o.ci(p),u_rainDropletSize:new o.cj(p),u_distortionStrength:new o.ci(p),u_rainDirection:new o.ch(p),u_color:new o.d2(p),u_screenSize:new o.cj(p),u_thinningCenterPos:new o.cj(p),u_thinningShape:new o.ch(p),u_thinningAffectedRatio:new o.ci(p),u_thinningParticleOffset:new o.ci(p),u_shapeDirectionalPower:new o.ci(p),u_shapeNormalPower:new o.ci(p),u_mode:new o.ci(p)}),vignette:p=>({u_vignetteShape:new o.ch(p),u_vignetteColor:new o.d2(p)}),occlusion:p=>({u_matrix:new o.ck(p),u_anchorPos:new o.ch(p),u_screenSizePx:new o.cj(p),u_occluderSizePx:new o.cj(p),u_color:new o.d2(p)})};class gu{constructor(n,l,m,v){this.id=gu.uniqueIdxCounter,gu.uniqueIdxCounter++,this.context=n;const w=n.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||v||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=gu.uniqueIdxCounter,gu.uniqueIdxCounter++;const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}gu.uniqueIdxCounter=0;const a1={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class G2{constructor(n,l,m,v,w,S){this.length=l.length,this.attributes=m,this.itemSize=l.bytesPerElement,this.dynamicDraw=v,this.instanceCount=S,this.context=n;const C=n.gl;this.buffer=C.createBuffer(),n.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||w||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,l){for(let m=0;m<this.attributes.length;m++){const v=l.getAttributeLocation(n,this.attributes[m].name);v!==-1&&n.enableVertexAttribArray(v)}}setVertexAttribPointers(n,l,m){for(let v=0;v<this.attributes.length;v++){const w=this.attributes[v],S=l.getAttributeLocation(n,w.name);S!==-1&&n.vertexAttribPointer(S,w.components,n[a1[w.type]],!1,this.itemSize,w.offset+this.itemSize*(m||0))}}setVertexAttribDivisor(n,l,m){for(let v=0;v<this.attributes.length;v++){const w=l.getAttributeLocation(n,this.attributes[v].name);w!==-1&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(w,m)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class wg{constructor(n,l,m,v,w){this.context=n,this.width=l,this.height=m;const S=this.framebuffer=n.gl.createFramebuffer();v&&(this.colorAttachment=new F2(n,S)),w&&(this.depthAttachmentType=w,this.depthAttachment=w==="renderbuffer"?new Jb(n,S):new B2(n,S))}destroy(){const n=this.context.gl;if(this.colorAttachment){const l=this.colorAttachment.get();l&&n.deleteTexture(l)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const l=this.depthAttachment.get();l&&n.deleteRenderbuffer(l)}else{const l=this.depthAttachment.get();l&&n.deleteTexture(l)}n.deleteFramebuffer(this.framebuffer)}}class Sg{constructor(n,l){this.gl=n,this.clearColor=new qb(this),this.clearDepth=new cv(this),this.clearStencil=new M2(this),this.colorMask=new D2(this),this.depthMask=new N2(this),this.stencilMask=new O2(this),this.stencilFunc=new Gb(this),this.stencilOp=new L2(this),this.stencilTest=new ng(this),this.depthRange=new z2(this),this.depthTest=new Wb(this),this.depthFunc=new uv(this),this.blend=new ig(this),this.blendFunc=new dv(this),this.blendColor=new ad(this),this.blendEquation=new fh(this),this.cullFace=new bp(this),this.cullFaceSide=new ph(this),this.frontFace=new Hb(this),this.program=new hv(this),this.activeTexture=new Zb(this),this.viewport=new mh(this),this.bindFramebuffer=new sg(this),this.bindRenderbuffer=new og(this),this.bindTexture=new fv(this),this.bindVertexBuffer=new ag(this),this.bindElementBuffer=new wp(this),this.bindVertexArrayOES=new Xb(this),this.pixelStoreUnpack=new Kb(this),this.pixelStoreUnpackPremultiplyAlpha=new Yb(this),this.pixelStoreUnpackFlipY=new gh(this),this.options=l?Object.assign({},l):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=l&&!!l.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,l,m){return new gu(this,n,l,m)}createVertexBuffer(n,l,m,v,w){return new G2(this,n,l,m,v,w)}createRenderbuffer(n,l,m){const v=this.gl,w=v.createRenderbuffer();return this.bindRenderbuffer.set(w),v.renderbufferStorage(v.RENDERBUFFER,n,l,m),this.bindRenderbuffer.set(null),w}createFramebuffer(n,l,m,v){return new wg(this,n,l,m,v)}clear({color:n,depth:l,stencil:m,colorMask:v}){const w=this.gl;let S=0;n&&(S|=w.COLOR_BUFFER_BIT,this.clearColor.set(n.toNonPremultipliedRenderColor(null)),this.colorMask.set(v||[!0,!0,!0,!0])),l!==void 0&&(S|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),m!==void 0&&(S|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),w.clear(S)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){o.bx(n.blendFunction,Qr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Ql;function Ip(p,n,l,m,v,w,S){const C=p.context,A=C.gl,M=p.transform,D=[o.aF(M.center.lng),o.aJ(M.center.lat)],F=l.layout.get("symbol-placement"),O=l.layout.get("text-variable-anchor"),q=l.layout.get("icon-rotation-alignment")==="map",Z=l.layout.get("text-rotation-alignment")==="map",Q=F!=="point",se=[];let ne=0,ae=0;for(let ge=0;ge<m.length;ge++){const Ce=m[ge],Fe=n.getTile(Ce),Oe=Fe.getBucket(l);if(!Oe)continue;const st=Oe.getProjection().createInversionMatrix(M,Ce.canonical),He=[],ht=Lb(Ce,Oe,M),Nt=!S&&q&&Q,Ge=S&&Z&&Q,Re=O&&Oe.hasTextData(),ft=Oe.hasIconTextFit()&&Re&&Oe.hasIconData(),Ze=Nt||Ge||S&&Re||ft,wt=Oe.projection.name==="globe",Ft=wt?o.aj(M.zoom):0;wt&&(He.push("PROJECTION_GLOBE_VIEW"),Ze&&He.push("PROJECTED_POS_ON_VIEWPORT"));const sr=p.getOrCreateProgram("collisionBox",{defines:He});let Rt=ht;v[0]===0&&v[1]===0||(Rt=p.translatePosMatrix(ht,Fe,v,w));const Lt=S?Oe.textCollisionBox:Oe.iconCollisionBox,ar=Oe.collisionCircleArray;if(ar.length>0){const Zt=o.bB(),Qt=Rt;o.cO(Zt,Oe.placementInvProjMatrix,M.glCoordMatrix),o.cO(Zt,Zt,Oe.placementViewportMatrix),se.push({circleArray:ar,circleOffset:ae,transform:Qt,invTransform:Zt,projection:Oe.getProjection()}),ne+=ar.length/4,ae=ne}if(!Lt)continue;p.terrain&&p.terrain.setupElevationDraw(Fe,sr);const Jt=wt?[Ce.canonical.x,Ce.canonical.y,1<<Ce.canonical.z]:[0,0,0];sr.draw(p,A.LINES,cr.disabled,Br.disabled,p.colorModeForRenderPass(),Dr.disabled,vh(Rt,st,M,Ft,D,Fe,Jt,Oe.getProjection()),l.id,Lt.layoutVertexBuffer,Lt.indexBuffer,Lt.segments,null,M.zoom,null,[Lt.collisionVertexBuffer,Lt.collisionVertexBufferExt])}if(!S||!se.length)return;const he=p.getOrCreateProgram("collisionCircle"),ce=new o.dY;ce.resize(4*ne),ce._trim();let we=0;for(const ge of se)for(let Ce=0;Ce<ge.circleArray.length/4;Ce++){const Fe=4*Ce,Oe=ge.circleArray[Fe+0],st=ge.circleArray[Fe+1],He=ge.circleArray[Fe+2],ht=ge.circleArray[Fe+3];ce.emplace(we++,Oe,st,He,ht,0),ce.emplace(we++,Oe,st,He,ht,1),ce.emplace(we++,Oe,st,He,ht,2),ce.emplace(we++,Oe,st,He,ht,3)}(!Ql||Ql.length<2*ne)&&(Ql=function(ge){const Ce=2*ge,Fe=new o.b0;Fe.resize(Ce),Fe._trim();for(let Oe=0;Oe<Ce;Oe++){const st=6*Oe;Fe.uint16[st+0]=4*Oe+0,Fe.uint16[st+1]=4*Oe+1,Fe.uint16[st+2]=4*Oe+2,Fe.uint16[st+3]=4*Oe+2,Fe.uint16[st+4]=4*Oe+3,Fe.uint16[st+5]=4*Oe+0}return Fe}(ne));const fe=C.createIndexBuffer(Ql,!0),Te=C.createVertexBuffer(ce,o.dZ.members,!0);for(const ge of se){const Ce={u_matrix:ge.transform,u_inv_matrix:ge.invTransform,u_camera_to_center_distance:(ve=M).getCameraToCenterDistance(ge.projection),u_viewport_size:[ve.width,ve.height]};he.draw(p,A.TRIANGLES,cr.disabled,Br.disabled,p.colorModeForRenderPass(),Dr.disabled,Ce,l.id,Te,fe,o.bf.simpleSegment(0,2*ge.circleOffset,ge.circleArray.length,ge.circleArray.length/2),null,M.zoom)}var ve;Te.destroy(),fe.destroy()}const _u=o.bB();function Iv(p){const n=p._camera.getWorldToCamera(p.worldSize,1),l=o.aB([],n,p.globeMatrix);o.bk(l,l);const m=[0,0,0],v=[0,1,0,0];return o.aC(v,v,l),m[0]=v[0],m[1]=v[1],m[2]=v[2],o.aw(m,m),m}function Tg({width:p,height:n,anchor:l,textOffset:m,textScale:v},w){const{horizontalAlign:S,verticalAlign:C}=o.c0(l),A=-(S-.5)*p,M=-(C-.5)*n,D=o.c1(l,m);return new o.P((A/v+D[0])*w,(M/v+D[1])*w)}function Eg(p,n,l,m,v,w,S,C,A,M){const D=p.text.placedSymbolArray,F=p.text.dynamicLayoutVertexArray,O=p.icon.dynamicLayoutVertexArray,q={},Z=p.getProjection(),Q=Gm(S,Z,v),se=v.elevation,ne=Z.upVectorScale(S.canonical,v.center.lat,v.worldSize).metersToTile;F.clear();for(let ae=0;ae<D.length;ae++){const he=D.get(ae),{tileAnchorX:ce,tileAnchorY:we,numGlyphs:fe}=he,Te=he.hidden||!he.crossTileID||p.allowVerticalPlacement&&!he.placedOrientation?null:m[he.crossTileID];if(Te){let ve=0,ge=0,Ce=0;const Fe=p.elevationType==="road";if(se||Fe){const Ze=Fe?p.getElevationFeatureForText(ae):null,wt=o.bU.getAtTileOffset(S,new o.P(ce,we),se,Ze),[Ft,sr,Rt]=Z.upVector(S.canonical,ce,we);ve=wt*Ft*ne,ge=wt*sr*ne,Ce=wt*Rt*ne}let[Oe,st,He,ht]=js(he.projectedAnchorX+ve,he.projectedAnchorY+ge,he.projectedAnchorZ+Ce,l?Q:w);const Nt=Ky(v.getCameraToCenterDistance(Z),ht);let Ge=o.bL(p.textSizeData,A,he)*Nt/o.bX;l&&(Ge*=p.tilePixelRatio/C);const Re=Tg(Te,Ge);l?({x:Oe,y:st,z:He}=Z.projectTilePoint(ce+Re.x,we+Re.y,S.canonical),[Oe,st,He]=js(Oe+ve,st+ge,He+Ce,w)):(n&&Re._rotate(-v.angle),Oe+=Re.x,st+=Re.y,He=0);const ft=p.allowVerticalPlacement&&he.placedOrientation===o.bK.vertical?Math.PI/2:0;for(let Ze=0;Ze<fe;Ze++)o.bN(F,Oe,st,He,ft);M&&he.associatedIconIndex>=0&&(q[he.associatedIconIndex]={x:Oe,y:st,z:He,angle:ft})}else vc(fe,F)}if(M){O.clear();const ae=p.icon.placedSymbolArray;for(let he=0;he<ae.length;he++){const ce=ae.get(he),{numGlyphs:we}=ce,fe=q[he];if(ce.hidden||!fe)vc(we,O);else{const{x:Te,y:ve,z:ge,angle:Ce}=fe;for(let Fe=0;Fe<we;Fe++)o.bN(O,Te,ve,ge,Ce)}}p.icon.dynamicLayoutVertexBuffer.updateData(O)}p.text.dynamicLayoutVertexBuffer.updateData(F)}function Pp(p,n,l,m,v,w,S={}){const C=l.paint.get("icon-translate"),A=l.paint.get("text-translate"),M=l.paint.get("icon-translate-anchor"),D=l.paint.get("text-translate-anchor"),F=l.layout.get("icon-rotation-alignment"),O=l.layout.get("text-rotation-alignment"),q=l.layout.get("icon-pitch-alignment"),Z=l.layout.get("text-pitch-alignment"),Q=l.layout.get("icon-keep-upright"),se=l.layout.get("text-keep-upright"),ne=l.paint.get("icon-color-saturation"),ae=l.paint.get("icon-color-contrast"),he=l.paint.get("icon-color-brightness-min"),ce=l.paint.get("icon-color-brightness-max"),we=l.layout.get("symbol-elevation-reference")==="sea",fe=l.layout.get("icon-image-use-theme")==="none",Te=p.context,ve=Te.gl,ge=p.transform,Ce=F==="map",Fe=O==="map",Oe=q==="map",st=Z==="map",He=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ht=!1;const Nt=p.depthModeForSublayer(0,cr.ReadOnly),Ge=new cr(p.context.gl.LEQUAL,cr.ReadOnly,p.depthRangeFor3D),Re=[o.aF(ge.center.lng),o.aJ(ge.center.lat)],ft=l.layout.get("text-variable-anchor"),Ze=ge.projection.name==="globe",wt=[],Ft=[0,-1,0];for(const sr of m){const Rt=n.getTile(sr),Lt=Rt.getBucket(l);if(!Lt||Lt.projection.name==="mercator"&&Ze||Lt.fullyClipped)continue;const ar=Lt.projection.name==="globe",Jt=ar?o.aj(ge.zoom):0,Zt=Gm(sr,Lt.getProjection(),ge),Qt=ge.calculatePixelsToTileUnitsMatrix(Rt),Tr=ft&&Lt.hasTextData(),pn=Lt.hasIconTextFit()&&Tr&&Lt.hasIconData(),En=Lt.getProjection().createInversionMatrix(ge,sr.canonical),oi=(1<<Rt.tileID.canonical.z)*o.al/p.transform.worldSize,Nr=Kn=>{let zr=[0,0,0];if(Kn){const In=p.style.directionalLight,Oi=p.style.ambientLight;In&&Oi&&(zr=il(p.style,In,Oi))}return zr},Sn=Kn=>{ge.depthOcclusionForSymbolsAndCircles&&(l.hasOcclusionOpacityProperties||p.terrain)&&(Kn.push("DEPTH_D24"),Kn.push("DEPTH_OCCLUSION"))},Xr=Kn=>{l.lut&&!fe&&(l.lut.texture||(l.lut.texture=new o.d_(p.context,l.lut.image,[l.lut.image.height,l.lut.image.height,l.lut.image.height],Te.gl.RGBA8)),Te.activeTexture.set(Te.gl.TEXTURE0+io.LUT),l.lut.texture&&l.lut.texture.bind(Te.gl.LINEAR,Te.gl.CLAMP_TO_EDGE),Kn.push("APPLY_LUT_ON_GPU"))},ri=()=>{const Kn=Ce&&l.layout.get("symbol-placement")!=="point",zr=[];Sn(zr),Xr(zr);const In=Kn||pn,Oi=Lt.elevationType==="road",is=p.shadowRenderer,Ui=Oi&&Oe&&!!is&&is.enabled,Yi=Nr(Ui),ra=Oi&&Oe&&!p.terrain?Ge:Nt,Ho=l.paint.get("icon-image-cross-fade");p.terrainRenderModeElevated()&&Oe&&zr.push("PITCH_WITH_MAP_TERRAIN"),ar&&(zr.push("PROJECTION_GLOBE_VIEW"),In&&zr.push("PROJECTED_POS_ON_VIEWPORT")),Ho>0&&Lt.hasAnySecondaryIcon&&zr.push("ICON_TRANSITION"),!Lt.icon.zOffsetVertexBuffer||Oi&&p.terrain||zr.push("Z_OFFSET"),ne===0&&ae===0&&he===0&&ce===1||zr.push("COLOR_ADJUSTMENT"),Lt.sdfIcons&&zr.push("RENDER_SDF"),Ui&&zr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Oi&&Oe&&!p.terrain&&Lt.icon.orientationVertexBuffer&&zr.push("ELEVATED_ROADS");const mo=Lt.icon.programConfigurations.get(l.id),To=p.getOrCreateProgram("symbol",{config:mo,defines:zr}),Ra=Rt.imageAtlasTexture?Rt.imageAtlasTexture.size:[0,0],go=Lt.iconSizeData,Ma=o.bJ(go,ge.zoom),ul=Oe||!ge.isOrthographic,Us=rh(Zt,Rt.tileID.canonical,Oe,Ce,ge,Lt.getProjection(),Qt),Wi=yc(Zt,Rt.tileID.canonical,Oe,Ce,ge,Lt.getProjection(),Qt),ss=p.translatePosMatrix(Wi,Rt,C,M,!0),pi=p.translatePosMatrix(Zt,Rt,C,M),ds=In?_u:Us,$s=Ce&&!Oe&&!Kn;let Hi=Ft;!Ze&&!ge.mercatorFromTransition||Ce||(Hi=Iv(ge));const Da=ar?Hi:Ft,Nh=l.getColorAdjustmentMatrix(ne,ae,he,ce),Pc=Cv(go.kind,Ma,$s,Oe,p,pi,ds,ss,we,!1,Ra,[0,0],0,sr,Jt,Re,En,Da,Lt.getProjection(),Yi,oi,Nh,Ho,null),Oh=Rt.imageAtlasTexture?Rt.imageAtlasTexture:null,Lh=l.layout.get("icon-size").constantOr(0)!==1||Lt.iconsNeedLinear,Na=Lt.sdfIcons||p.options.rotating||p.options.zooming||Lh||ul?ve.LINEAR:ve.NEAREST,tc=Lt.sdfIcons&&l.paint.get("icon-halo-width").constantOr(1)!==0,Fs=p.terrain&&Oe&&Kn?o.bk(o.bB(),Us):_u;if(Kn&&Lt.icon){const Oa=o.bU.getAtTileOffsetFunc(sr,ge.center.lat,ge.worldSize,Lt.getProjection()),_d=lp(Zt,Rt.tileID.canonical,Oe,Ce,ge,Lt.getProjection(),Qt),j1=l.layout.get("icon-size-scale-range"),Wg=o.aA(p.scaleFactor,j1[0],j1[1]);Jy(Lt,Zt,p,!1,_d,Wi,Oe,Q,Oa,sr,Wg)}return{program:To,buffers:Lt.icon,uniformValues:Pc,atlasTexture:Oh,atlasTextureIcon:null,atlasInterpolation:Na,atlasInterpolationIcon:null,isSDF:Lt.sdfIcons,hasHalo:tc,depthMode:ra,tile:Rt,renderWithShadows:Ui,labelPlaneMatrixInv:Fs}},Cn=()=>{const Kn=Fe&&l.layout.get("symbol-placement")!=="point",zr=[],In=Kn||ft||pn,Oi=Lt.elevationType==="road",is=p.shadowRenderer,Ui=Oi&&st&&!!is&&is.enabled,Yi=Nr(Ui),ra=Oi&&st&&!p.terrain?Ge:Nt;p.terrainRenderModeElevated()&&st&&zr.push("PITCH_WITH_MAP_TERRAIN"),ar&&(zr.push("PROJECTION_GLOBE_VIEW"),In&&zr.push("PROJECTED_POS_ON_VIEWPORT")),!Lt.text.zOffsetVertexBuffer||Oi&&p.terrain||zr.push("Z_OFFSET"),Lt.iconsInText&&zr.push("RENDER_TEXT_AND_SYMBOL"),zr.push("RENDER_SDF"),Ui&&zr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Oi&&st&&!p.terrain&&Lt.text.orientationVertexBuffer&&zr.push("ELEVATED_ROADS"),Sn(zr);const Ho=Lt.text.programConfigurations.get(l.id),mo=p.getOrCreateProgram("symbol",{config:Ho,defines:zr});let To,Ra=[0,0],go=null;const Ma=Lt.textSizeData;Lt.iconsInText&&(Ra=Rt.imageAtlasTexture?Rt.imageAtlasTexture.size:[0,0],go=Rt.imageAtlasTexture?Rt.imageAtlasTexture:null,To=st||!ge.isOrthographic||p.options.rotating||p.options.zooming||Ma.kind==="composite"||Ma.kind==="camera"?ve.LINEAR:ve.NEAREST);const ul=Rt.glyphAtlasTexture?Rt.glyphAtlasTexture.size:[0,0],Us=l.layout.get("text-size-scale-range"),Wi=o.aA(p.scaleFactor,Us[0],Us[1]),ss=o.bJ(Ma,ge.zoom,Wi),pi=rh(Zt,Rt.tileID.canonical,st,Fe,ge,Lt.getProjection(),Qt),ds=yc(Zt,Rt.tileID.canonical,st,Fe,ge,Lt.getProjection(),Qt),$s=p.translatePosMatrix(ds,Rt,A,D,!0),Hi=p.translatePosMatrix(Zt,Rt,A,D),Da=In?_u:pi,Nh=Fe&&!st&&!Kn;let Pc=Ft;!Ze&&!ge.mercatorFromTransition||Fe||(Pc=Iv(ge));const Oh=Cv(Ma.kind,ss,Nh,st,p,Hi,Da,$s,we,!0,ul,Ra,0,sr,Jt,Re,En,ar?Pc:Ft,Lt.getProjection(),Yi,oi,null,null,Wi),Lh=Rt.glyphAtlasTexture?Rt.glyphAtlasTexture:null,Na=ve.LINEAR,tc=l.paint.get("text-halo-width").constantOr(1)!==0,Fs=p.terrain&&st&&Kn?o.bk(o.bB(),pi):_u;if(Kn&&Lt.text){const Oa=o.bU.getAtTileOffsetFunc(sr,ge.center.lat,ge.worldSize,Lt.getProjection()),_d=lp(Zt,Rt.tileID.canonical,st,Fe,ge,Lt.getProjection(),Qt);Jy(Lt,Zt,p,!0,_d,ds,st,se,Oa,sr,Wi)}return{program:mo,buffers:Lt.text,uniformValues:Oh,atlasTexture:Lh,atlasTextureIcon:go,atlasInterpolation:Na,atlasInterpolationIcon:To,isSDF:!0,hasHalo:tc,depthMode:ra,tile:Rt,renderWithShadows:Ui,labelPlaneMatrixInv:Fs}},mi=Lt.icon.segments.get().length,Nn=Lt.text.segments.get().length,Kr=mi&&!S.onlyText?ri():null,Wn=Nn&&!S.onlyIcons?Cn():null,en=l.paint.get("icon-opacity").constantOr(1),Ti=l.paint.get("text-opacity").constantOr(1);if(He&&Lt.canOverlap){ht=!0;const Kn=en&&!S.onlyText?Lt.icon.segments.get():[],zr=Ti&&!S.onlyIcons?Lt.text.segments.get():[];for(const In of Kn)wt.push({segments:new o.bf([In]),sortKey:In.sortKey,state:Kr});for(const In of zr)wt.push({segments:new o.bf([In]),sortKey:In.sortKey,state:Wn})}else S.onlyText||wt.push({segments:en?Lt.icon.segments:new o.bf([]),sortKey:0,state:Kr}),S.onlyIcons||wt.push({segments:Ti?Lt.text.segments:new o.bf([]),sortKey:0,state:Wn})}ht&&wt.sort((sr,Rt)=>sr.sortKey-Rt.sortKey);for(const sr of wt){const Rt=sr.state;if(Rt)if(p.terrain?p.terrain.setupElevationDraw(Rt.tile,Rt.program,{useDepthForOcclusion:ge.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Rt.labelPlaneMatrixInv}):p.setupDepthForOcclusion(ge.depthOcclusionForSymbolsAndCircles,Rt.program),Te.activeTexture.set(ve.TEXTURE0),Rt.atlasTexture&&Rt.atlasTexture.bind(Rt.atlasInterpolation,ve.CLAMP_TO_EDGE,!0),Rt.atlasTextureIcon&&(Te.activeTexture.set(ve.TEXTURE1),Rt.atlasTextureIcon&&Rt.atlasTextureIcon.bind(Rt.atlasInterpolationIcon,ve.CLAMP_TO_EDGE,!0)),Rt.renderWithShadows&&p.shadowRenderer.setupShadows(Rt.tile.tileID.toUnwrapped(),Rt.program,"vector-tile"),p.uploadCommonLightUniforms(p.context,Rt.program),Rt.hasHalo){const Lt=Rt.uniformValues;Lt.u_is_halo=1,Cg(Rt.buffers,sr.segments,l,p,Rt.program,Rt.depthMode,v,w,Lt,2),Lt.u_is_halo=0}else{if(Rt.isSDF){const Lt=Rt.uniformValues;Rt.hasHalo&&(Lt.u_is_halo=1,Cg(Rt.buffers,sr.segments,l,p,Rt.program,Rt.depthMode,v,w,Lt,1)),Lt.u_is_halo=0}Cg(Rt.buffers,sr.segments,l,p,Rt.program,Rt.depthMode,v,w,Rt.uniformValues,1)}}}function Cg(p,n,l,m,v,w,S,C,A,M){const D=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.iconTransitioningVertexBuffer,p.globeExtVertexBuffer,p.zOffsetVertexBuffer,p.orientationVertexBuffer];v.draw(m,m.context.gl.TRIANGLES,w,S,C,Dr.disabled,A,l.id,p.layoutVertexBuffer,p.indexBuffer,n,l.paint,m.transform.zoom,p.programConfigurations.get(l.id),D,M)}function l1(p,n){const l=1<<p.canonical.z,m=(n.x*l-p.canonical.x-p.wrap*l)*o.al,v=(n.y*l-p.canonical.y)*o.al,w=o.e7(n.z,n.y);return o.d4(m,v,w)}function dd(p,n,l,m,v){if(!l.layout||l.layout.get("fill-elevation-reference")==="none"||l.paint.get("fill-opacity").constantOr(1)===0)return;const w=p.context.gl,S=new cr(p.context.gl.LEQUAL,cr.ReadWrite,p.depthRangeFor3D),C=new cr(p.context.gl.GREATER,cr.ReadWrite,p.depthRangeFor3D),A=function(q){let Z=.01;return q.isOrthographic&&(Z=o.ak(1e-4,Z,o.c$(q.pitch>=sd?1:q.pitch/sd))),2*Z}(p.transform),M=p.transform.getFreeCameraOptions().position,D="elevatedStructuresDepthReconstruct",F=p.getOrCreateProgram(D,{defines:["DEPTH_RECONSTRUCTION"]}),O=p.getOrCreateProgram(D);for(const q of m){const Z=n.getTile(q),Q=Z.getBucket(l);if(!Q)continue;const se=Q.elevatedStructures;if(!se)continue;const ne=Q.elevationBufferData.heightRange,ae=l1(q.toUnwrapped(),M),he=p.translatePosMatrix(q.projMatrix,Z,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));let ce,we,fe,Te;if(v==="initialize"){if(!ne||ne.min>=1||se.depthSegments.segments[0].primitiveLength===0)continue;ce=mg(he,ae,A,1,0),we=S,fe=se.depthSegments,Te=F}else if(v==="reset"){if(!ne||ne.min>=0||se.maskSegments.segments[0].primitiveLength===0)continue;ce=mg(he,ae,0,0,1),we=C,fe=se.maskSegments,Te=F}else if(v==="geometry"){if(se.depthSegments.segments[0].primitiveLength===0)continue;ce=mg(he,ae,A,1,0),we=S,fe=se.depthSegments,Te=O}Te.draw(p,w.TRIANGLES,we,Br.disabled,Qr.disabled,Dr.disabled,ce,l.id,se.vertexBuffer,se.indexBuffer,fe,l.paint,p.transform.zoom)}}function bh(p,n,l){const{painter:m,sourceCache:v,layer:w,coords:S,colorMode:C,elevationType:A,terrainEnabled:M,pass:D}=p,F=m.context.gl,O=w.paint.get("fill-pattern"),q=w.paint.get("fill-pattern-cross-fade"),Z=O.constantOr(null);let Q=A;A!=="road"||n&&!M||(Q="none");const se=Q==="road",ne=p.painter.shadowRenderer,ae=se&&!!ne&&ne.enabled,he=new cr(m.context.gl.LEQUAL,cr.ReadOnly,m.depthRangeFor3D);let ce=[0,0,0];if(ae){const Te=m.style.directionalLight,ve=m.style.ambientLight;Te&&ve&&(ce=il(m.style,Te,ve))}const we=O&&O.constantOr(1),fe=(Te,ve)=>{let ge,Ce,Fe,Oe,st;ve?(ge=we&&!w.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Fe=F.LINES):(ge=we?"fillPattern":"fill",Fe=F.TRIANGLES);for(const He of S){const ht=v.getTile(He);if(we&&!ht.patternsLoaded())continue;const Nt=ht.getBucket(w);if(!Nt)continue;const Ge=n?Nt.elevationBufferData:Nt.bufferData;if(Ge.isEmpty())continue;m.prepareDrawTile();const Re=Ge.programConfigurations.get(w.id),ft=m.isTileAffectedByFog(He),Ze=[],wt=[];se&&(Ze.push("ELEVATED_ROADS"),wt.push(Ge.elevatedLayoutVertexBuffer)),ae&&Ze.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),we&&(m.context.activeTexture.set(F.TEXTURE0),ht.imageAtlasTexture&&ht.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Re.updatePaintBuffers());let Ft=!1;if(Z&&ht.imageAtlas){const Jt=ht.imageAtlas,Zt=o.e2.from(Z),Qt=Zt.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),Tr=Zt.getSecondary(),pn=Jt.patternPositions.get(Qt),En=Tr?Jt.patternPositions.get(Tr.scaleSelf(o.o.devicePixelRatio).toString()):null;Ft=!!pn&&!!En,pn&&Re.setConstantPatternPositions(pn,En)}q>0&&(Ft||Re.getPatternTransitionVertexBuffer("fill-pattern"))&&Ze.push("FILL_PATTERN_TRANSITION");const sr=m.getOrCreateProgram(ge,{config:Re,overrideFog:ft,defines:Ze}),Rt=m.translatePosMatrix(He.projMatrix,ht,w.paint.get("fill-translate"),w.paint.get("fill-translate-anchor"));ae&&ne.setupShadows(ht.tileID.toUnwrapped(),sr,"vector-tile");const Lt=w.paint.get("fill-emissive-strength");if(ve){Oe=Ge.lineIndexBuffer,st=Ge.lineSegments;const Jt=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[F.drawingBufferWidth,F.drawingBufferHeight];Ce=ge==="fillOutlinePattern"&&we?U2(Rt,Lt,m,ht,Jt,ce,q):V2(Rt,Lt,Jt,ce)}else Oe=Ge.indexBuffer,st=Ge.triangleSegments,Ce=we?n1(Rt,Lt,m,ht,ce,q):r1(Rt,Lt,ce);m.uploadCommonUniforms(m.context,sr,He.toUnwrapped());let ar=Te;(A==="road"&&!M||A==="offset")&&(ar=he),sr.draw(m,Fe,ar,l||m.stencilModeForClipping(He),C,Dr.disabled,Ce,w.id,Ge.layoutVertexBuffer,Oe,st,w.paint,m.transform.zoom,Re,wt)}};m.renderPass===D&&fe(m.depthModeForSublayer(1,m.renderPass==="opaque"?cr.ReadWrite:cr.ReadOnly),!1),Q==="none"&&m.renderPass==="translucent"&&w.paint.get("fill-antialias")&&fe(m.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,cr.ReadOnly),!0)}function rr(p,n,l,m,v,w,S,C){l.resetLayerRenderingStats(p);const A=p.context,M=A.gl,D=p.transform,F=l.paint.get("fill-extrusion-pattern"),O=l.paint.get("fill-extrusion-pattern-cross-fade"),q=F.constantOr(null),Z=F.constantOr(1),Q=l.paint.get("fill-extrusion-opacity"),se=p.style.enable3dLights(),ne=l.paint.get(se&&!Z?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ae=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),ne],he=l.layout.get("fill-extrusion-edge-radius"),ce=he>0&&!l.paint.get("fill-extrusion-rounded-roof"),we=ce?0:he,fe=D.projection.name==="globe"?o.ea():0,Te=D.projection.name==="globe",ve=Te?o.aj(D.zoom):0,ge=[o.aF(D.center.lng),o.aJ(D.center.lat)],Ce=l.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Fe=l.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ce?null:l.lut).toArray01().slice(0,3),Oe=l.paint.get("fill-extrusion-flood-light-intensity"),st=l.paint.get("fill-extrusion-vertical-scale"),He=l.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ht=l.paint.get("fill-extrusion-height-alignment"),Nt=l.paint.get("fill-extrusion-base-alignment"),Ge=wc(p,l.paint.get("fill-extrusion-cutoff-fade-range")),Re=[];let ft;Te&&Re.push("PROJECTION_GLOBE_VIEW"),ae[0]>0&&Re.push("FAUX_AO"),ce&&Re.push("ZERO_ROOF_RADIUS"),C&&Re.push("HAS_CENTROID"),Oe>0&&Re.push("FLOOD_LIGHT"),Ge.shouldRenderCutoff&&Re.push("RENDER_CUTOFF"),He&&Re.push("RENDER_WALL_MODE");const Ze=p.renderPass==="shadow",wt=p.shadowRenderer,Ft=Ze&&!!wt,sr=Ze?Dr.disabled:Dr.backCCW;p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0);let Rt=[0,0,0];if(wt){const Jt=p.style.directionalLight,Zt=p.style.ambientLight;Jt&&Zt&&(Rt=il(p.style,Jt,Zt)),Ze||(Re.push("RENDER_SHADOWS","DEPTH_TEXTURE"),wt.useNormalOffset&&Re.push("NORMAL_OFFSET")),ft=Re.concat(["SHADOWS_SINGLE_CASCADE"])}const Lt=Ft?"fillExtrusionDepth":Z?"fillExtrusionPattern":"fillExtrusion",ar=l.getLayerRenderingStats();for(const Jt of m){const Zt=n.getTile(Jt),Qt=Zt.getBucket(l);if(!Qt||Qt.projection.name!==D.projection.name)continue;let Tr=!1;wt&&(Tr=wt.getMaxCascadeForTile(Jt.toUnwrapped())===0);const pn=p.isTileAffectedByFog(Jt),En=Qt.programConfigurations.get(l.id);let oi=!1;if(q&&Zt.imageAtlas){const Nn=Zt.imageAtlas,Kr=o.e2.from(q),Wn=Kr.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),en=Kr.getSecondary(),Ti=Nn.patternPositions.get(Wn),Kn=en?Nn.patternPositions.get(en.scaleSelf(o.o.devicePixelRatio).toString()):null;oi=!!Ti&&!!Kn,Ti&&En.setConstantPatternPositions(Ti,Kn)}O>0&&(oi||En.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Re.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Nr=p.getOrCreateProgram(Lt,{config:En,defines:Tr?ft:Re,overrideFog:pn});if(p.terrain&&p.terrain.setupElevationDraw(Zt,Nr,{useMeterToDem:!0}),!Qt.centroidVertexBuffer){const Nn=Nr.getAttributeLocation(M,"a_centroid_pos");Nn!==-1&&M.vertexAttrib2f(Nn,0,0)}!Ze&&wt&&wt.setupShadows(Zt.tileID.toUnwrapped(),Nr,"vector-tile"),Z&&(p.context.activeTexture.set(M.TEXTURE0),Zt.imageAtlasTexture&&Zt.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),En.updatePaintBuffers());const Sn=l.paint.get("fill-extrusion-vertical-gradient"),Xr=1/Qt.tileToMeter;let ri;if(Ze&&wt){if(c1(Zt.tileID,Qt.maxHeight,p))continue;const Nn=wt.calculateShadowPassMatrixFromTile(Zt.tileID.toUnwrapped());ri=e1(Nn,we,Xr,st,ht,Nt)}else{const Nn=p.translatePosMatrix(Jt.expandedProjMatrix,Zt,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Kr=D.projection.createInversionMatrix(D,Jt.canonical);ri=Z?t1(Nn,p,Sn,Q,ae,we,Xr,Jt,Zt,fe,ht,Nt,ve,ge,Kr,Fe,st,O):pg(Nn,p,Sn,Q,ae,we,Xr,Jt,fe,ht,Nt,ve,ge,Kr,Fe,st,Oe,Rt)}p.uploadCommonUniforms(A,Nr,Jt.toUnwrapped(),null,Ge);let Cn=Qt.segments;if(D.projection.name==="mercator"&&!Ze&&(Cn=Qt.getVisibleSegments(Zt.tileID,p.terrain,p.transform.getFrustum(0)),!Cn.get().length))continue;if(ar)if(Ze)for(const Nn of Cn.get())ar.numRenderedVerticesInShadowPass+=Nn.primitiveLength;else for(const Nn of Cn.get())ar.numRenderedVerticesInTransparentPass+=Nn.primitiveLength;const mi=[];(p.terrain||C)&&mi.push(Qt.centroidVertexBuffer),Te&&mi.push(Qt.layoutVertexExtBuffer),He&&mi.push(Qt.wallVertexBuffer),Nr.draw(p,A.gl.TRIANGLES,v,w,S,sr,ri,l.id,Qt.layoutVertexBuffer,Qt.indexBuffer,Cn,l.paint,p.transform.zoom,En,mi)}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1)}class Pv{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Tc(p,n,l,m,v,w,S,C,A,M,D,F,O,q,Z,Q,se,ne,ae,he){const ce=n.context,we=ce.gl,fe=n.transform,Te=n.transform.zoom,ve=[],ge=p.translate,Ce=p.translateAnchor,Fe=p.edgeRadius,Oe=wc(n,p.cutoffFadeRange);D==="clear"?(ve.push("CLEAR_SUBPASS"),he&&(ve.push("CLEAR_FROM_TEXTURE"),ce.activeTexture.set(we.TEXTURE0),he.bind(we.LINEAR,we.CLAMP_TO_EDGE))):D==="sdf"&&ve.push("SDF_SUBPASS"),ne&&ve.push("HAS_CENTROID"),Oe.shouldRenderCutoff&&ve.push("RENDER_CUTOFF");const st=(He,ht,Nt,Ge,Re)=>{let ft=ve;ht.groundRadiusBuffer!=null&&(ft=ve.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const Ze=ht.programConfigurations.get(m.id),wt=n.isTileAffectedByFog(He),Ft=n.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ze,defines:ft,overrideFog:wt}),sr=yh(n,Ge,F,M,Re,[O,q*Re],Z,Q,se,Te>=17?0:Fe*Re,he?he.size[0]:0),Rt=[];ne&&Rt.push(ht.hiddenByLandmarkVertexBuffer),ht.groundRadiusBuffer!=null&&Rt.push(ht.groundRadiusBuffer),n.uploadCommonUniforms(ce,Ft,He.toUnwrapped(),null,Oe),Ft.draw(n,ce.gl.TRIANGLES,w,S,C,A,sr,m.id,ht.vertexBuffer,ht.indexBuffer,Nt,m.paint,Te,Ze,Rt)};for(const He of v){const ht=l.getTile(He),Nt=ht.getBucket(m);if(!Nt||Nt.projection.name!==fe.projection.name||!Nt.groundEffect||Nt.groundEffect&&!Nt.groundEffect.hasData())continue;const Ge=Nt.groundEffect,Re=1/Nt.tileToMeter;{const ft=n.translatePosMatrix(He.projMatrix,ht,ge,Ce),Ze=Ge.getDefaultSegment();st(He,Ge,Ze,ft,Re)}if(ae)for(let ft=0;ft<4;ft++){const Ze=o.e8[ft](He),wt=l.getTile(Ze);if(!wt)continue;const Ft=wt.getBucket(m);if(!Ft||Ft.projection.name!==fe.projection.name||!Ft.groundEffect||Ft.groundEffect&&!Ft.groundEffect.hasData())continue;const sr=Ft.groundEffect;let Rt,Lt;ft===0?(Rt=[-o.al,0,0],Lt=1):ft===1?(Rt=[o.al,0,0],Lt=0):ft===2?(Rt=[0,-o.al,0],Lt=3):(Rt=[0,o.al,0],Lt=2);const ar=sr.regionSegments[Lt];if(!ar)continue;const Jt=new Float32Array(16);o.bq(Jt,He.projMatrix,Rt),st(He,sr,ar,n.translatePosMatrix(Jt,ht,ge,Ce),Re)}}}function yu(p,n,l,m,v,w,S){m.centroidVertexArray.length===0&&m.createCentroidsBuffer();const C=w?w.findDEMTileFor(l):null;if(!(C&&C.dem||S))return;w&&C&&C.dem&&m.selfDEMTileTimestamp!==C.dem._timestamp&&(m.borderDoneWithNeighborZ=[-1,-1,-1,-1],m.selfDEMTileTimestamp=C.dem._timestamp);const A=ne=>new o.P(Math.ceil((ne+o.ec)*o.ed),0),M=ne=>{const ae=n.getSource().minzoom,he=we=>{const fe=n.getTileByID(we);if(fe&&fe.hasData())return fe.getBucket(v)},ce=[0,-1,1];for(const we of ce){if(ne.overscaledZ+we<ae)continue;const fe=he(ne.calculateScaledKey(ne.overscaledZ+we));if(fe)return fe}},D=[0,0,0],F=(ne,ae)=>(D[0]=Math.min(ne.min.y,ae.min.y),D[1]=Math.max(ne.max.y,ae.max.y),D[2]=o.al-ae.min.x>ne.max.x?ae.min.x-o.al:ne.max.x,D),O=(ne,ae)=>(D[0]=Math.min(ne.min.x,ae.min.x),D[1]=Math.max(ne.max.x,ae.max.x),D[2]=o.al-ae.min.y>ne.max.y?ae.min.y-o.al:ne.max.y,D),q=[(ne,ae)=>F(ne,ae),(ne,ae)=>F(ae,ne),(ne,ae)=>O(ne,ae),(ne,ae)=>O(ae,ne)],Z=(ne,ae,he,ce,we,fe,Te)=>{if(!w)return 0;const ve=[[fe?he:ne,fe?ne:he,0],[fe?he:ae,fe?ae:he,0]],ge=Te<0?o.al+Te:Te,Ce=[fe?ge:(ne+ae)/2,fe?(ne+ae)/2:ge,0];return he===0&&Te<0||he!==0&&Te>0?w.getForTilePoints(we,[Ce],!0,ce):ve.push(Ce),w.getForTilePoints(l,ve,!0,C),Math.max(ve[0][2],ve[1][2],Ce[2])/w.exaggeration()};for(let ne=0;ne<4;ne++){const ae=m.borderFeatureIndices[ne];if(ae.length===0)continue;const he=o.e8[ne](l),ce=M(he);if(!(ce&&ce instanceof o.e9))continue;const we=w?w.findDEMTileFor(he):null;if(!(we&&we.dem||S)||(w&&we&&we.dem&&m.borderDEMTileTimestamp[ne]!==we.dem._timestamp&&(m.borderDoneWithNeighborZ[ne]=-1,m.borderDEMTileTimestamp[ne]=we.dem._timestamp),m.borderDoneWithNeighborZ[ne]===ce.canonical.z))continue;ce.centroidVertexArray.length===0&&ce.createCentroidsBuffer();const fe=(ne<2?1:5)-ne,Te=ce.borderDoneWithNeighborZ[fe]!==m.canonical.z,ve=ce.borderFeatureIndices[fe];let ge=0;if(m.canonical.z!==ce.canonical.z){for(const Ce of ae)m.showCentroid(m.featuresOnBorder[Ce]);if(Te)for(const Ce of ve)ce.showCentroid(ce.featuresOnBorder[Ce]);m.borderDoneWithNeighborZ[ne]=ce.canonical.z,ce.borderDoneWithNeighborZ[fe]=m.canonical.z}for(const Ce of ae){const Fe=m.featuresOnBorder[Ce],Oe=m.centroidData[Fe.centroidDataIndex],st=Fe.borders[ne];let He;for(;ge<ve.length;){He=ce.featuresOnBorder[ve[ge]];const ht=He.borders[fe];if(ht[1]>st[0]+3||ht[0]>st[0]-3)break;ce.showCentroid(He),ge++}if(He&&ge<ve.length){const ht=ge;let Nt=0;for(;!(He.borders[fe][0]>st[1]-3)&&(Nt++,++ge!==ve.length);)He=ce.featuresOnBorder[ve[ge]];He=ce.featuresOnBorder[ve[ht]];let Ge=!1;if(Nt>=1){const Ze=He.borders[fe];Math.abs(st[0]-Ze[0])<3&&Math.abs(st[1]-Ze[1])<3&&(Nt=1,Ge=!0,ge=ht+1)}else if(Nt===0){m.showCentroid(Fe);continue}const Re=ce.centroidData[He.centroidDataIndex];S&&Ge&&(((Q=Oe).flags|(se=Re).flags)&o.eb?(Q.flags|=o.eb,se.flags|=o.eb):(Q.flags&=~o.eb,se.flags&=~o.eb));const ft=Fe.intersectsCount()>1||He.intersectsCount()>1;if(Nt>1)ge=ht,Oe.centroidXY=Re.centroidXY=new o.P(0,0);else if(we&&we.dem&&!ft){const Ze=q[ne](Oe,Re),wt=ne%2?o.al-1:0,Ft=Z(Ze[0],Math.min(o.al-1,Ze[1]),wt,we,he,ne<2,Ze[2]);Oe.centroidXY=Re.centroidXY=A(Ft)}else ft?Oe.centroidXY=Re.centroidXY=new o.P(0,0):(Oe.centroidXY=m.encodeBorderCentroid(Fe),Re.centroidXY=ce.encodeBorderCentroid(He));m.writeCentroidToBuffer(Oe),ce.writeCentroidToBuffer(Re)}else m.showCentroid(Fe)}m.borderDoneWithNeighborZ[ne]=ce.canonical.z,ce.borderDoneWithNeighborZ[fe]=m.canonical.z}var Q,se;(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(p)}const vu=[1,0,0],Sr=[0,1,0],kv=[0,0,1];function c1(p,n,l){const m=l.transform,v=l.shadowRenderer;if(!v)return!0;const w=p.toUnwrapped(),S=m.tileSize*v._cascades[l.currentShadowCascade].scale;let C=n;if(m.elevation){const Q=m.elevation.getMinMaxForTile(p);Q&&(C+=Q.max)}const A=[...v.shadowDirection];A[2]=-A[2];const M=v.computeSimplifiedTileShadowVolume(w,C,S,A);if(!M)return!1;const D=[vu,Sr,kv,A,[A[0],0,A[2]],[0,A[1],A[2]]],F=m.projection.name==="globe",O=m.scaleZoom(S),q=o.cA.fromInvProjectionMatrix(m.invProjMatrix,m.worldSize,O,!F),Z=v.getCurrentCascadeFrustum();return q.intersectsPrecise(M.vertices,M.planes,D)===0||Z.intersectsPrecise(M.vertices,M.planes,D)===0}function Ag(p){const{painter:n,source:l,layer:m,coords:v}=p;let w=p.defines;const S=n.context,C=n.renderPass==="shadow",A=n.renderPass==="light-beam",M=n.shadowRenderer,D=o.ee(n.transform.center.lat,n.transform.zoom),F=wc(n,m.paint.get("building-cutoff-fade-range"));F.shouldRenderCutoff&&(w=w.concat("RENDER_CUTOFF")),p.floodLightIntensity>0&&(w=w.concat("FLOOD_LIGHT"));for(const O of v){const q=l.getTile(O),Z=q.getBucket(m);if(!Z)continue;M&&M.getMaxCascadeForTile(O.toUnwrapped())===0&&(w=w.concat("SHADOWS_SINGLE_CASCADE"));const Q=Z.programConfigurations.get(m.id);let se,ne,ae,he=n.translatePosMatrix(O.expandedProjMatrix,q,[0,0],"map");if(he=o.cR(o.bB(),he,[1,1,p.verticalScale]),C&&M){if(c1(q.tileID,Z.maxHeight*D,n))continue;let we=M.calculateShadowPassMatrixFromTile(q.tileID.toUnwrapped());we=o.cR(o.bB(),we,[1,1,p.verticalScale]),ae=i1(we),se=ne=n.getOrCreateProgram("buildingDepth",{config:Q,defines:w,overrideFog:!1})}else if(A)se=ne=n.getOrCreateProgram("buildingBloom",{config:Q,defines:w,overrideFog:!1}),ae=wv(he);else{const we=n.transform.calculatePosMatrix(O.toUnwrapped(),n.transform.worldSize);o.cR(we,we,[1,1,p.verticalScale]);const fe=o.bB();o.cR(fe,we,[1,-1,1/D]),o.bk(fe,fe),o.ef(fe,fe);const Te=n.transform.getFreeCameraOptions().position,ve=1<<O.canonical.z;if(ae=bv(he,fe,p.opacity,p.facadeAOIntensity,[((Te.x-O.wrap)*ve-O.canonical.x)*o.al,(Te.y*ve-O.canonical.y)*o.al,Te.z*ve*o.al],Z.tileToMeter,p.facadeEmissiveChance,p.floodLightColor,p.floodLightIntensity),ne=n.getOrCreateProgram("building",{config:Q,defines:w,overrideFog:!1}),p.depthOnly===!0)se=ne;else{const ge=w.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);se=n.getOrCreateProgram("building",{config:Q,defines:ge,overrideFog:!1})}M&&(M.setupShadowsFromMatrix(we,ne,!0),se!==ne&&M.setupShadowsFromMatrix(we,se,!0))}const ce=(we,fe)=>{if(A){const Te=we.entranceBloom;fe.draw(n,S.gl.TRIANGLES,p.depthMode,Br.disabled,p.blendMode,Dr.disabled,ae,m.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segmentsBucket,m.paint,n.transform.zoom,Q,[Te.layoutAttenuationBuffer,Te.layoutColorBuffer])}else{const Te=we.segmentsBucket;let ve=[we.layoutNormalBuffer,we.layoutCentroidBuffer,we.layoutColorBuffer,we.layoutFloodLightDataBuffer];we.layoutFacadePaintBuffer&&(ve=ve.concat([we.layoutFacadeDataBuffer,we.layoutFacadeVerticalRangeBuffer,we.layoutFacadePaintBuffer])),fe.draw(n,S.gl.TRIANGLES,p.depthMode,Br.disabled,p.blendMode,C?Dr.disabled:Dr.backCW,ae,m.id,we.layoutVertexBuffer,we.indexBuffer,Te,m.paint,n.transform.zoom,Q,ve)}};n.uploadCommonUniforms(S,ne,O.toUnwrapped(),null,F),Z.buildingWithoutFacade&&ce(Z.buildingWithoutFacade,ne),Z.buildingWithFacade&&(se!==ne&&n.uploadCommonUniforms(S,se,O.toUnwrapped(),null,F),ce(Z.buildingWithFacade,se))}}function Ig(p,n,l,m,v,w,S,C,A,M,D,F,O){const q=p.context.gl,Z=p.depthModeForSublayer(1,cr.ReadOnly,q.LEQUAL,!0),Q=.1*(1-(se=D))+3*se;var se;const ne=p._showOverdrawInspector,ae=F,he=new Pv;ne||Tc(he,p,n,l,m,Z,new Br({func:q.ALWAYS,mask:255},255,255,q.KEEP,q.KEEP,q.REPLACE),new Qr([q.ONE,q.ONE,q.ONE,q.ONE],o.ao.transparent,[!1,!1,!1,!0],q.MIN),Dr.disabled,v,"sdf",w,S,C,A,M,Q,ae,!1);{const ce=ne?Br.disabled:new Br({func:q.EQUAL,mask:255},255,255,q.KEEP,q.DECR,q.DECR),we=ne?p.colorModeForRenderPass():new Qr([q.ONE_MINUS_DST_ALPHA,q.DST_ALPHA,q.ONE,q.ONE],o.ao.transparent,[!0,!0,!0,!0]);Tc(he,p,n,l,m,Z,ce,we,Dr.disabled,v,"color",w,S,C,A,M,Q,ae,!1)}}function jv(p){return[p[0]*o.eg,p[1]*o.eg,p[2]*o.eg,0]}function Rv(p,n,l,m,v,w,S,C,A){const M=m.getSource(),D=l.globeSharedBuffers;if(!D)return;let F,O,q;if(n&&(F=m.getTile(n)),M instanceof o.aT?(O=M.texture,q=o.dJ(0,0,l.transform)):F&&n&&(O=F.texture,q=o.dJ(n.canonical.z,n.canonical.x,l.transform)),!O||!q)return;p||(q=o.cR(o.bB(),q,[1,-1,1]));const Z=l.context,Q=Z.gl,se=v.paint.get("raster-resampling")==="nearest"?Q.NEAREST:Q.LINEAR,ne=l.colorModeForDrapableLayerRenderPass(w),ae=S.defines;ae.push("GLOBE_POLES");const he=new cr(Q.LEQUAL,cr.ReadWrite,l.depthRangeFor3D),ce=Float32Array.from(l.transform.expandedFarZProjMatrix),we=Float32Array.from(o.bj(o.dI(new o.cC(0,0,0))));l.terrain&&l.terrain.prepareDrawTile(),Z.activeTexture.set(Q.TEXTURE0),O.bind(se,Q.CLAMP_TO_EDGE),Z.activeTexture.set(Q.TEXTURE1),O.bind(se,Q.CLAMP_TO_EDGE),"useMipmap"in O&&Z.extTextureFilterAnisotropic&&l.transform.pitch>20&&Q.texParameterf(Q.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax);const[fe,Te,ve,ge]=n?D.getPoleBuffers(n.canonical.z,!1):D.getPoleBuffers(0,!0),Ce=v.paint.get("raster-elevation");let Fe;p?(Fe=fe,l.renderDefaultNorthPole=Ce!==0):(Fe=Te,l.renderDefaultSouthPole=Ce!==0);const Oe=jv(S.mix),st=((ht,Nt,Ge,Re,ft,Ze,wt,Ft,sr,Rt,Lt,ar,Jt)=>Ap(ht,Nt,Ge,new Float32Array(16),new Float32Array(9),[0,0],Re,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ze,[0,0],Ft,2,Rt,Lt,ar,1,0,Jt))(ce,we,q,o.aj(l.transform.zoom),0,v,0,Ce,0,Oe,S.offset,S.range,w),He=l.getOrCreateProgram("raster",{defines:ae});l.uploadCommonUniforms(Z,He,null),He.draw(l,Q.TRIANGLES,he,A,ne,C,st,v.id,Fe,ve,ge)}function u1(p){const n=p._nearZ,l=p.projection.farthestPixelDistance(p),m=l-n,v=.2*p.height,w=n+v;return[n,l,(w-v-n)/m,(w-n)/m]}function W2(p,n,l,m){if(p)return n instanceof Ls&&p instanceof du?n.getTextureDescriptor(p,l,!0):{texture:p.texture,mix:jv(m.mix),offset:m.offset,buffer:0,tileSize:1}}var H2=o.eh([{name:"a_index",type:"Int16",components:1}]);class pa{constructor(n,l,m,v){const w={width:m[0],height:m[1],data:null},S=n.gl;this.targetColorTexture=new o.T(n,w,S.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(n,w,S.RGBA8,{useMipmap:!1}),this.context=n,this.updateParticleTexture(l,v),this.lastInvalidatedAt=0}updateParticleTexture(n,l){if(this.particleTextureDimension===l.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const m=this.context.gl,v=l.width*l.height;this.particleTexture0=new o.T(this.context,l,m.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,l,m.RGBA8,{premultiply:!1,useMipmap:!1});const w=new o.ei;w.reserve(v);for(let S=0;S<v;S++)w.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(w,H2.members,!0),this.particleSegment=o.bf.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=l.width}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=o.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Mv(p,n,l){if(!p)return null;const m=n.getTextureDescriptor(p,l,!0);if(!m)return null;let{texture:v,mix:w,offset:S,tileSize:C,buffer:A,format:M}=m;if(!v||!M)return null;let D=!1;return M==="uint32"&&(D=!0,w[3]=0,w=gg(o.ej,w,[0,l.paint.get("raster-particle-max-speed")]),S=Sc(o.ej,S,[0,l.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[A/(C+2*A),C/(C+2*A)],tileSize:C,scalarData:D,scale:w,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[M]]}}function Wo(p){const n=p._nearZ,l=p.projection.farthestPixelDistance(p),m=l-n,v=.2*p.height,w=n+v;return[n,l,(w-v-n)/m,(w-n)/m]}const xu=new o.ao(1,0,0,1),d1=new o.ao(0,1,0,1),Dv=new o.ao(0,0,1,1),Nv=new o.ao(1,0,1,1),Ov=new o.ao(0,1,1,1);function Lv(p,n,l,m,v,w){for(let S=0;S<l.length;S++)if(v){const M=new o.ao(m.r*.8,m.g*.8,m.b*.8,1);ma(p,n,l[S],m,-1,-1,w),ma(p,n,l[S],m,-1,1,w),ma(p,n,l[S],m,1,1,w),ma(p,n,l[S],m,1,-1,w),ma(p,n,l[S],M,0,0,w)}else ma(p,n,l[S],m,0,0,w)}function ma(p,n,l,m,v,w,S){const C=p.context,A=p.transform,M=C.gl,D=A.projection.name==="globe",F=D?["PROJECTION_GLOBE_VIEW"]:[];let O=o.by(l.projMatrix);if(D&&o.aj(A.zoom)>0){const Oe=o.bi(l.canonical,A),st=o.ek(Oe);O=o.aB(new Float32Array(16),A.globeMatrix,st),o.aB(O,A.projMatrix,O)}const q=o.bB();q[12]+=2*v/(o.o.devicePixelRatio*A.width),q[13]+=2*w/(o.o.devicePixelRatio*A.height),o.aB(O,q,O);const Z=p.getOrCreateProgram("debug",{defines:F}),Q=n.getTileByID(l.key);p.terrain&&p.terrain.setupElevationDraw(Q,Z);const se=cr.disabled,ne=Br.disabled,ae=p.colorModeForRenderPass(),he="$debug";C.activeTexture.set(M.TEXTURE0),p.emptyTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),D?Q._makeGlobeTileDebugBuffers(p.context,A):Q._makeDebugTileBoundsBuffers(p.context,A.projection);const ce=Q._tileDebugBuffer||p.debugBuffer,we=Q._tileDebugIndexBuffer||p.debugIndexBuffer,fe=Q._tileDebugSegments||p.debugSegments;if(Z.draw(p,M.LINE_STRIP,se,ne,ae,Dr.disabled,Sv(O,m.toPremultipliedRenderColor(null)),he,ce,we,fe,null,null,null,[Q._globeTileDebugBorderBuffer]),S){const Oe=Q.latestRawTileData,st=Math.floor((Oe&&Oe.byteLength||0)/1024);let He=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(He+=` => ${l.overscaledZ}`),He+=` ${Q.state}`,He+=` ${st}kb`,function(ht,Nt){ht.initDebugOverlayCanvas();const Ge=ht.debugOverlayCanvas,Re=ht.context.gl,ft=ht.debugOverlayCanvas.getContext("2d");ft.clearRect(0,0,Ge.width,Ge.height),ft.shadowColor="white",ft.shadowBlur=2,ft.lineWidth=1.5,ft.strokeStyle="white",ft.textBaseline="top",ft.font="bold 36px Open Sans, sans-serif",ft.fillText(Nt,5,5),ft.strokeText(Nt,5,5),ht.debugOverlayTexture.update(Ge),ht.debugOverlayTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)}(p,He)}const Te=n.getTile(l).tileSize,ve=512/Math.min(Te,512)*(l.overscaledZ/A.zoom)*.5,ge=Q._tileDebugTextBuffer||p.debugBuffer,Ce=Q._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,Fe=Q._tileDebugTextSegments||p.debugSegments;Z.draw(p,M.TRIANGLES,se,ne,Qr.alphaBlended,Dr.disabled,Sv(O,o.ao.transparent.toPremultipliedRenderColor(null),ve),he,ge,Ce,Fe,null,null,null,[Q._globeTileDebugTextBuffer])}function wi(p,n,l,m){wh(p,0,n+l/2,p.transform.width,l,m)}function kp(p,n,l,m){wh(p,n-l/2,0,l,p.transform.height,m)}function wh(p,n,l,m,v,w){const S=p.context,C=S.gl;C.enable(C.SCISSOR_TEST),C.scissor(n*o.o.devicePixelRatio,l*o.o.devicePixelRatio,m*o.o.devicePixelRatio,v*o.o.devicePixelRatio),S.clear({color:w}),C.disable(C.SCISSOR_TEST)}const h1=o.eh([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:f1}=h1;function Ec(p,n,l,m){p.emplaceBack(n,l,m)}class zv{constructor(n){this.vertexArray=new o.el,this.indices=new o.b0,Ec(this.vertexArray,-1,-1,1),Ec(this.vertexArray,1,-1,1),Ec(this.vertexArray,-1,1,1),Ec(this.vertexArray,1,1,1),Ec(this.vertexArray,-1,-1,-1),Ec(this.vertexArray,1,-1,-1),Ec(this.vertexArray,-1,1,-1),Ec(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,f1),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=o.bf.simpleSegment(0,0,36,12)}}function al(p,n,l,m,v,w){const S=p.context.gl,C=n.paint.get("sky-atmosphere-color"),A=n.paint.get("sky-atmosphere-halo-color"),M=n.paint.get("sky-atmosphere-sun-intensity"),D=((F,O,q,Z,Q)=>({u_matrix_3f:F,u_sun_direction:O,u_sun_intensity:q,u_color_tint_r:[Z.r,Z.g,Z.b,Z.a],u_color_tint_m:[Q.r,Q.g,Q.b,Q.a],u_luminance:5e-5}))(o.en(o.dN(),m),v,M,C.toPremultipliedRenderColor(null),A.toPremultipliedRenderColor(null));S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+w,n.skyboxTexture,0),l.draw(p,S.TRIANGLES,cr.disabled,Br.disabled,Qr.unblended,Dr.frontCW,D,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const hd=o.eh([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class jt{constructor(n){const l=new o.eo;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const m=new o.b0;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(l,hd.members),this.indexBuffer=n.createIndexBuffer(m),this.segments=o.bf.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ht=o.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Sh{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Ki{constructor(n){this.colorModeAlphaBlendedWriteRGB=new Qr([1,us,1,us],o.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Qr([1,0,1,0],o.ao.transparent,[!1,!1,!1,!0]),this.params=new Sh,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(n){const l=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new jt(l);const m=this.params.sizeRange,v=this.params.intensityRange,w=function(D){const F=o.eq(30),O=[];for(let q=0;q<D;++q){const Z=2*Math.PI*F(),Q=Math.acos(1-2*F())-.5*Math.PI;O.push(o.d4(Math.cos(Q)*Math.cos(Z),Math.cos(Q)*Math.sin(Z),Math.sin(Q)))}return O}(this.params.starsCount),S=o.eq(300),C=new o.ep,A=new o.b0;let M=0;for(let D=0;D<w.length;++D){const F=o.c4([],w[D],200),O=Math.max(0,1+.01*m*(1*S()-.5)),q=Math.max(0,1+.01*v*(1*S()-.5));C.emplaceBack(F[0],F[1],F[2],-1,-1,O,q),C.emplaceBack(F[0],F[1],F[2],1,-1,O,q),C.emplaceBack(F[0],F[1],F[2],1,1,O,q),C.emplaceBack(F[0],F[1],F[2],-1,1,O,q),A.emplaceBack(M+0,M+1,M+2),A.emplaceBack(M+0,M+2,M+3),M+=4}this.starsVx=l.createVertexBuffer(C,Ht.members),this.starsIdx=l.createIndexBuffer(A),this.starsSegments=o.bf.simpleSegment(0,0,C.length,A.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,l){const m=n.context,v=m.gl,w=n.transform,S=new cr(v.LEQUAL,cr.ReadOnly,[0,1]),C=o.aj(w.zoom),A=n.style.getLut(l.scope),M=l.properties.get("color-use-theme")==="none",D=l.properties.get("color").toNonPremultipliedRenderColor(M?null:A),F=l.properties.get("high-color-use-theme")==="none",O=l.properties.get("high-color").toNonPremultipliedRenderColor(F?null:A),q=l.properties.get("space-color-use-theme")==="none",Z=l.properties.get("space-color").toNonPremultipliedRenderColor(q?null:A),Q=5e-4,se=o.er(l.properties.get("horizon-blend"),0,1,Q,.25),ne=o.dD(n,m,w)&&se===Q?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,ae=n.frameCounter/1e3%1,he=o.ag(w.globeCenterInViewSpace),ce=Math.sqrt(Math.pow(he,2)-Math.pow(ne,2)),we=Math.acos(ce/he),fe=Te=>{const ve=w.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Te&&ve.push("ALPHA_PASS");const ge=n.getOrCreateProgram("globeAtmosphere",{defines:ve}),Ce=((Oe,st,He,ht,Nt,Ge,Re,ft,Ze,wt,Ft,sr)=>({u_frustum_tl:Oe,u_frustum_tr:st,u_frustum_br:He,u_frustum_bl:ht,u_horizon:Nt,u_transition:Ge,u_fadeout_range:Re,u_atmosphere_fog_color:ft.toArray01(),u_high_color:Ze.toArray01(),u_space_color:wt.toArray01(),u_temporal_offset:Ft,u_horizon_angle:sr}))(w.frustumCorners.TL,w.frustumCorners.TR,w.frustumCorners.BR,w.frustumCorners.BL,w.frustumCorners.horizon,C,se,D,O,Z,ae,we);n.uploadCommonUniforms(m,ge);const Fe=this.atmosphereBuffer;Fe&&ge.draw(n,v.TRIANGLES,S,Br.disabled,Te?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Dr.backCW,Ce,Te?"atmosphere_glow_alpha":"atmosphere_glow",Fe.vertexBuffer,Fe.indexBuffer,Fe.segments)};fe(!1),fe(!0)}drawStars(n,l){const m=o.aA(l.properties.get("star-intensity"),0,1);if(m===0)return;const v=n.context,w=v.gl,S=n.transform,C=n.getOrCreateProgram("stars"),A=o.c6([]);o.c8(A,A,-S._pitch),o.c7(A,A,-S.angle),o.c8(A,A,o.an(S._center.lat)),o.es(A,A,-o.an(S._center.lng));const M=o.cb(new Float32Array(16),A),D=o.aB([],S.starsProjMatrix,M),F=o.en([],M),O=o.et([],F),q=[0,1,0];o.dP(q,q,O),o.c4(q,q,this.params.sizeMultiplier);const Z=[1,0,0];o.dP(Z,Z,O),o.c4(Z,Z,this.params.sizeMultiplier);const Q=(se=q,ne=Z,ae=m,{u_matrix:Float32Array.from(D),u_up:se,u_right:ne,u_intensity_multiplier:ae});var se,ne,ae;n.uploadCommonUniforms(v,C),this.starsVx&&this.starsIdx&&C.draw(n,w.TRIANGLES,cr.disabled,Br.disabled,this.colorModeAlphaBlendedWriteRGB,Dr.disabled,Q,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Ve{constructor(){this.visibleTiles=[]}updateBorders(n,l){const m=[],v=[],w=n._getRenderableCoordinates(!1,!0);for(const A of w){const M=n.getTile(A);if(!M.hasData())continue;const D=M.getBucket(l);D&&(D.isEmpty()||(m.push(A.key),v.push({bucket:D,tileID:A.canonical})))}let S=m.length!==this.visibleTiles.length;if(!S){m.sort();for(let A=0;A<m.length;A++)if(m[A]!==this.visibleTiles[A]){S=!0;break}}if(!S)return;const C=new Set;this.visibleTiles=m,v.sort((A,M)=>A.tileID.z-M.tileID.z||A.tileID.x-M.tileID.x||A.tileID.y-M.tileID.y);for(const A of v){const M=new Array,D=new Array,F=A.bucket;for(const O of F.featuresOnBorder)C.has(O.featureId)?D.push(O.footprintIndex):(C.add(O.featureId),M.push(O.footprintIndex));F.updateFootprintHiddenFlags(M,o.eu,!1),F.updateFootprintHiddenFlags(D,o.eu,!0)}}}function Fv(p,n){const l=[...p],m=n.cameraWorldSizeForFog/n.worldSize,v=o.bz([]);return o.cR(v,v,[m,m,1]),o.aB(l,v,l),o.aB(l,n.worldToFogMatrix,l),l}function Th(p,n,l,m,v){const w=l.material,S=m.context,{baseColorTexture:C,metallicRoughnessTexture:A}=w.pbrMetallicRoughness,{normalTexture:M,occlusionTexture:D,emissionTexture:F}=w;function O(Z,Q,se){if(Z&&(p.push(Q),S.activeTexture.set(S.gl.TEXTURE0+se),Z.gfxTexture)){const{minFilter:ne,magFilter:ae,wrapS:he,wrapT:ce}=Z.sampler;Z.gfxTexture.bindExtraParam(ne,ae,he,ce)}}O(C,"HAS_TEXTURE_u_baseColorTexture",io.BaseColor),O(A,"HAS_TEXTURE_u_metallicRoughnessTexture",io.MetallicRoughness),O(M,"HAS_TEXTURE_u_normalTexture",io.Normal),O(D,"HAS_TEXTURE_u_occlusionTexture",io.Occlusion),O(F,"HAS_TEXTURE_u_emissionTexture",io.Emission),v&&(v.texture||(v.texture=new o.d_(m.context,v.image,[v.image.height,v.image.height,v.image.height],S.gl.RGBA8)),S.activeTexture.set(S.gl.TEXTURE0+io.LUT),v.texture&&v.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),p.push("APPLY_LUT_ON_GPU")),l.texcoordBuffer&&(p.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(l.texcoordBuffer)),l.colorBuffer&&(p.push(l.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(l.colorBuffer)),l.normalBuffer&&(p.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(l.normalBuffer)),l.pbrBuffer&&(p.push("HAS_ATTRIBUTE_a_pbr"),p.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(l.pbrBuffer)),w.alphaMode!=="OPAQUE"&&w.alphaMode!=="MASK"||p.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||p.push("DIFFUSE_SHADED");const q=m.shadowRenderer;q&&(p.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&p.push("NORMAL_OFFSET"))}function Eh(p,n,l,m,v,w){const S=l.paint.get("model-opacity").constantOr(1),C=n.context,A=new cr(n.context.gl.LEQUAL,p.isLightMesh?cr.ReadOnly:cr.ReadWrite,n.depthRangeFor3D),M=n.transform,D=p.mesh,F=D.material,O=F.pbrMetallicRoughness,q=n.style.fog;let Z;Z=n.transform.projection.zAxisUnit==="pixels"?[...p.nodeModelMatrix]:o.aB([],m.zScaleMatrix,p.nodeModelMatrix),o.aB(Z,m.negCameraPosMatrix,Z);const Q=o.bk([],Z);o.ef(Q,Q);const se=l.paint.get("model-color-use-theme").constantOr("default")==="none",ne=l.paint.get("model-emissive-strength").constantOr(0),ae=bg(new Float32Array(p.worldViewProjection),new Float32Array(Z),new Float32Array(Q),null,n,S,O.baseColorFactor,F.emissiveFactor,O.metallicFactor,O.roughnessFactor,F,ne,l,void 0,void 0,p.materialOverride,p.modelColor),he={defines:[]},ce=[],we=n.shadowRenderer;we&&(we.useNormalOffset=!1),Th(he.defines,ce,D,n,se?null:l.lut);let fe=null;if(q){const ge=Fv(p.nodeModelMatrix,n.transform);if(fe=new Float32Array(ge),M.projection.name!=="globe"){const Ce=D.aabb.min,Fe=D.aabb.max,[Oe,st]=q.getOpacityForBounds(ge,Ce[0],Ce[1],Fe[0],Fe[1]);he.overrideFog=Oe>=Xe||st>=Xe}}const Te=wc(n,l.paint.get("model-cutoff-fade-range"));Te.shouldRenderCutoff&&he.defines.push("RENDER_CUTOFF");const ve=n.getOrCreateProgram("model",he);n.uploadCommonUniforms(C,ve,null,fe,Te),n.renderPass!=="shadow"&&we&&we.setupShadowsFromMatrix(p.nodeModelMatrix,ve),ve.draw(n,C.gl.TRIANGLES,A,v,w,D.material.doubleSided?Dr.disabled:Dr.backCCW,ae,l.id,D.vertexBuffer,D.indexBuffer,D.segments,l.paint,n.transform.zoom,void 0,ce)}function Pg(p,n,l){return p.type==="vector"?n.scope:l?"basemap":""}function kg(p,n,l,m,v,w,S,C,A){const M=p.transform,D=!!n.isGeometryBloom&&n.isGeometryBloom;if(D&&p.renderPass==="shadow")return;const F=M.projection.name==="globe"?o.eC(l,M):[...l];o.aB(F,F,n.globalMatrix);const O=o.aB([],m,F);if(n.meshes)for(const q of n.meshes){const Z=C.get(q.material.name);if(Z&&Z.opacity<=0)continue;if(q.material.alphaMode!=="BLEND"){S.push({mesh:q,depth:0,modelIndex:v,worldViewProjection:O,nodeModelMatrix:F,isLightMesh:D,materialOverride:Z,modelColor:A});continue}const Q=o.af([],q.centroid,O);!M.isOrthographic&&Q[2]<=0||w.push({mesh:q,depth:Q[2],modelIndex:v,worldViewProjection:O,nodeModelMatrix:F,isLightMesh:D,materialOverride:Z,modelColor:A})}if(n.children)for(const q of n.children)kg(p,q,l,m,v,w,S,C,A)}function Ch(p,n,l,m){const v=l.shadowRenderer;if(!v)return;const w=v.getShadowPassDepthMode(),S=v.getShadowPassColorMode(),C=v.calculateShadowPassMatrixFromMatrix(n),A=xh(C);l.getOrCreateProgram("modelDepth",{defines:l._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(l,l.context.gl.TRIANGLES,w,Br.disabled,S,Dr.disabled,A,m.id,p.vertexBuffer,p.indexBuffer,p.segments,m.paint,l.transform.zoom,void 0,void 0)}function Ah(p,n,l,m,v,w){for(const S of v){const C=Object.assign({},m);C.part=S;const A={type:"Unknown",id:n,properties:C},M={orientation:p.paint.get("model-rotation").evaluate(A,l)};w.set(S,M)}}function Z2(p,n,l,m,v,w){for(const S of v){const C=Object.assign({},m);C.part=S;const A={type:"Unknown",id:n,properties:C},M={color:p.paint.get("model-color").evaluate(A,l),colorMix:p.paint.get("model-color-mix-intensity").evaluate(A,l),opacity:p.paint.get("model-opacity").evaluate(A,l),emissionStrength:p.paint.get("model-emissive-strength").evaluate(A,l)};w.set(S,M)}}function p1(p,n,l,m,v,w){if(l===1)for(const C of v)Eh(C,p,n,w[C.modelIndex],Br.disabled,p.colorModeForRenderPass());else{for(const C of v)Eh(C,p,n,w[C.modelIndex],Br.disabled,Qr.disabled);for(const C of v)Eh(C,p,n,w[C.modelIndex],p.stencilModeFor3D(),p.colorModeForRenderPass());p.resetStencilClippingMasks()}const S=Qr.additive;for(const C of m)Eh(C,p,n,w[C.modelIndex],Br.disabled,C.isLightMesh?S:p.colorModeForRenderPass())}function m1(p,n,l){const m=n.updateZoomBasedPaintProperties(),v=function(w,S,C){let A,M,D,F=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&F>0){const O=w.terrain,q=O.findDEMTileFor(C);q&&q.dem?A=o.eE.create(O,C,q):F=0}if(F===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),F===S.validForExaggeration&&(F===0||A&&A._demTile&&A._demTile.tileID===S.validForDEMTile.id&&A._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const O in S.instancesPerModel){const q=S.instancesPerModel[O];for(let Z=0;Z<q.instancedDataArray.length;++Z){const Q=(A?F*A.getElevationAt(0|q.instancedDataArray.float32[16*Z],0|q.instancedDataArray.float32[16*Z+1],!0,!0):0)+q.instancesEvaluatedElevation[Z];q.instancedDataArray.float32[16*Z+6]=Q,M=M?Math.min(S.terrainElevationMin,Q):Q,D=D?Math.max(S.terrainElevationMax,Q):Q}}return S.terrainElevationMin=M||0,S.terrainElevationMax=D||0,S.validForExaggeration=F,S.validForDEMTile=A&&A._demTile?{id:A._demTile.tileID,timestamp:A._dem._timestamp}:{id:void 0,timestamp:0},!0}(p,n,l);(m||v)&&(n.uploaded=!1,n.upload(p.context))}const ka={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.d8([0,0,0],[o.al,o.al,0])};function Bv(p,n){const l=1<<p.canonical.z,m=n.getFreeCameraOptions().position,v=n.elevation,w=p.canonical.x/l,S=(p.canonical.x+1)/l,C=p.canonical.y/l,A=(p.canonical.y+1)/l;let M=n._centerAltitude;if(v){const q=v.getMinMaxForTile(p);q&&q.max>M&&(M=q.max)}const D=o.aA(m.x,w,S)-m.x,F=o.aA(m.y,C,A)-m.y,O=o.ce(M,n.center.lat)-m.z;return n._zoomFromMercatorZ(Math.sqrt(D*D+F*F+O*O))}function Vv(p,n,l,m,v,w,S){const C=p.context,A=p.renderPass==="shadow",M=p.shadowRenderer,D=A&&M?M.getShadowPassDepthMode():new cr(C.gl.LEQUAL,cr.ReadWrite,p.depthRangeFor3D),F=p.isTileAffectedByFog(w),O=p.transform.projection.name==="globe";if(l.meshes)for(const q of l.meshes){const Z=O?[]:["MODEL_POSITION_ON_GPU"],Q=[];let se,ne,ae;const he=!O&&m.instancedDataArray.length>20;he&&Z.push("INSTANCED_ARRAYS");const ce=wc(p,n.paint.get("model-cutoff-fade-range"));if(ce.shouldRenderCutoff&&Z.push("RENDER_CUTOFF"),A&&M)se=p.getOrCreateProgram("modelDepth",{defines:Z}),ne=xh(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(l.globalMatrix)),ae=M.getShadowPassColorMode();else{Th(Z,Q,q,p,n.paint.get("model-color-use-theme").constantOr("default")==="none"?null:n.lut),se=p.getOrCreateProgram("model",{defines:Z,overrideFog:F});const fe=q.material,Te=fe.pbrMetallicRoughness,ve=n.paint.get("model-opacity").constantOr(1),ge=n.paint.get("model-emissive-strength").constantOr(0);ne=bg(w.expandedProjMatrix,Float32Array.from(l.globalMatrix),new Float32Array(16),null,p,ve,Te.baseColorFactor,fe.emissiveFactor,Te.metallicFactor,Te.roughnessFactor,fe,ge,n,v),M&&(S.shadowUniformsInitialized?se.setShadowUniformValues(C,M.getShadowUniformValues()):(M.setupShadows(w.toUnwrapped(),se,"model-tile"),S.shadowUniformsInitialized=!0)),ae=ce.shouldRenderCutoff||ve<1||fe.alphaMode!=="OPAQUE"?Qr.alphaBlended:Qr.unblended}p.uploadCommonUniforms(C,se,w.toUnwrapped(),null,ce);const we=q.material.doubleSided?Dr.disabled:Dr.backCCW;if(he)Q.push(m.instancedDataBuffer),se.draw(p,C.gl.TRIANGLES,D,Br.disabled,ae,we,ne,n.id,q.vertexBuffer,q.indexBuffer,q.segments,n.paint,p.transform.zoom,void 0,Q,m.instancedDataArray.length);else{const fe=A?"u_instance":"u_normal_matrix";for(let Te=0;Te<m.instancedDataArray.length;++Te)ne[fe]=new Float32Array(m.instancedDataArray.arrayBuffer,64*Te,16),se.draw(p,C.gl.TRIANGLES,D,Br.disabled,ae,we,ne,n.id,q.vertexBuffer,q.indexBuffer,q.segments,n.paint,p.transform.zoom,void 0,Q)}}if(l.children)for(const q of l.children)Vv(p,n,q,m,v,w,S)}const g1=[1,-1,1];function jg(p,n,l,m){if(!l.modelManager)return!0;const v=l.modelManager;if(!l.shadowRenderer)return!0;const w=l.shadowRenderer,S=n.aabb;let C=!0,A=p.maxHeight;if(A===0){let D=0;for(const F in p.instancesPerModel){const O=v.getModel(F,m);O?D=Math.max(D,Math.max(Math.max(O.aabb.max[0],O.aabb.max[1]),O.aabb.max[2])):C=!1}A=p.maxScale*D*1.41+p.maxVerticalOffset,C&&(p.maxHeight=A)}S.max[2]=A,S.min[2]+=p.terrainElevationMin,S.max[2]+=p.terrainElevationMax,o.af(S.min,S.min,n.tileMatrix),o.af(S.max,S.max,n.tileMatrix);const M=S.intersects(w.getCurrentCascadeFrustum());return l.currentShadowCascade===0&&(p.isInsideFirstShadowMapFrustum=M===2),M===0}function jp(p,n){const l=p.uniformValues.u_cutoff_params[0],m=p.uniformValues.u_cutoff_params[1],v=p.uniformValues.u_cutoff_params[2],w=p.uniformValues.u_cutoff_params[3];return m===l||w===v?1:o.aA(((n-l)/(m-l)-v)/(w-v),0,1)}function fd(p,n,l,m){if(n.pitch<20)return 1;const v=n.getWorldToCameraMatrix();o.aB(v,v,p);const w=o.bT(l.min[0],l.min[1],l.min[2],1);let S=o.aC(o.eF(),w,v),C=S,A=S;w[1]=l.max[1],S=o.aC(o.eF(),w,v),C=S[1]<C[1]?S:C,A=S[1]>A[1]?S:A,w[0]=l.max[0],S=o.aC(o.eF(),w,v),C=S[1]<C[1]?S:C,A=S[1]>A[1]?S:A,w[1]=l.min[1],S=o.aC(o.eF(),w,v),C=S[1]<C[1]?S:C,A=S[1]>A[1]?S:A;const M=o.aA(m[0],0,1),D=100*n.pixelsPerMeter*o.aA(m[1],0,1),F=o.aA(m[2],0,1),O=o.eG(o.eF(),C,A,M),q=Math.tan(.5*n.fovX),Z=-O[2]*q;if(D===0)return O[1]<-Math.abs(Z)?F:1;const Q=(-Math.abs(Z)-O[1])/D,se=(ae,he,ce)=>(1-ce)*ae+ce*he,ne=o.aA(se(1,F,Q),F,1);return se(1,ne,o.aA((n.pitch-20)/20,0,1))}class _1{}class y1{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,l,m){{const F=this._storage.get(l.id);if(F)return F.lastUsedFrameIdx=n,F.buf}const v=m.gl,w=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),S=new ArrayBuffer(w),C=new Int16Array(S);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const A=new o.eI;for(let F=0;F<w/2;F+=3){const O=C[F],q=C[F+1],Z=C[F+2];A.emplaceBack(O,q),A.emplaceBack(q,Z),A.emplaceBack(Z,O)}const M=m.bindVertexArrayOES.current,D=new _1;return D.buf=new gu(m,A),D.lastUsedFrameIdx=n,this._storage.set(l.id,D),m.bindVertexArrayOES.set(M),D.buf}update(n){for(const[l,m]of this._storage)n-m.lastUsedFrameIdx>30&&(m.buf.destroy(),this._storage.delete(l))}destroy(){for(const[n,l]of this._storage)l.buf.destroy(),this._storage.delete(n)}}class X2{constructor(n){this.occluderSize=30,this.depthOffset=-1e-4,n.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),n.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const v1=o.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class K2{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Lo{constructor(n,l){this.revealStart=11,this.revealRange=2,n.registerParameter(this,[...l,"Reveal"],"revealStart",{min:0,max:17,step:.05}),n.registerParameter(this,[...l,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Y2=o.eh([{type:"Float32",name:"a_pos_2f",components:2}]);class Rp{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(n,l){const m=n.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const S=new o.eJ,C=new o.b0;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(1,1),S.emplaceBack(-1,1),C.emplaceBack(0,1,2),C.emplaceBack(0,2,3),this.vignetteVx=n.context.createVertexBuffer(S,Y2.members),this.vignetteIdx=n.context.createIndexBuffer(C)}const v=o.bf.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){n.uploadCommonUniforms(n.context,m);const S={u_vignetteShape:(w={vignetteShape:[l.start,l.range,Math.pow(10,l.fadePower)],vignetteColor:[l.color.r,l.color.g,l.color.b,l.color.a*l.strength]}).vignetteShape,u_vignetteColor:w.vignetteColor};m.draw(n,n.context.gl.TRIANGLES,cr.disabled,Br.disabled,Qr.alphaBlended,Dr.disabled,S,"vignette",this.vignetteVx,this.vignetteIdx,v)}var w}}class Ii{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(n,l){const m=n.getFreeCameraOptions().position,v=m.toAltitude(),w=m.toLngLat(),S=o.an(w.lng),C=o.an(w.lat),A=n.pixelsPerMeter/l,M=S*o.eL,D=o.eL*Math.log(Math.tan(Math.PI/4+C/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const F=-this._offsetYPrev+D,O=-this._elevationPrev+v;this._accumulatedOffsetX+=(-this._offsetXPrev+M)*A,this._accumulatedOffsetY+=F*A,this._accumulatedElevation+=O*A,this._offsetXPrev=M,this._offsetYPrev=D,this._elevationPrev=v}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function fn(p,n){return[-(p[0]-Math.floor(p[0]/n)*n),-(p[1]-Math.floor(p[1]/n)*n),-(p[2]-Math.floor(p[2]/n)*n)]}function Uv(p){const n=o.eq(1323123451230),l=[];for(let m=0;m<p;++m){const v=2*n()-1,w=2*n()-1,S=2*n()-1;l.push(o.d4(v,w,S))}return l}function ea(p,n,l,m,v){const w=o.aA((v-l)/(m-l),0,1);return(1-w)*p+w*n}class pd{constructor(n){this._movement=new Ii,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Rp,this._ppmScaleFactor=n}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(n,l){const m=n.transform;this._movement.update(m,this._ppmScaleFactor);const v=m.starsProjMatrix,w=o.c6([]);o.c8(w,w,o.an(90)-m._pitch),o.c7(w,w,-m.angle);const S=o.cb(new Float32Array(16),w),C=o.eK(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),A=o.ef([],C),M=o.aB([],A,S),D=Date.now()/1e3;return this._accumulatedTimeFromStart+=(D-this._prevTime)*l,this._prevTime=D,{projectionMatrix:v,modelviewMatrix:M}}}class Ih extends pd{constructor(n){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Lo(n.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(n){const l=n.context;if(!this.particlesVx){const m=Uv(this.particlesCount),v=new o.eM,w=new o.b0;let S=0;const C=o.eq(1323123451230);for(let A=0;A<m.length;++A){const M=m[A],D=[2*C()-1,C(),C(),C()];v.emplaceBack(M[0],M[1],M[2],-1,-1,...D),v.emplaceBack(M[0],M[1],M[2],1,-1,...D),v.emplaceBack(M[0],M[1],M[2],1,1,...D),v.emplaceBack(M[0],M[1],M[2],-1,1,...D),w.emplaceBack(S+0,S+1,S+2),w.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=l.createVertexBuffer(v,v1.members),this.particlesIdx=l.createIndexBuffer(w)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.rain)return;const l=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},m=n.transform.zoom;if(l.revealStart>m)return;const v=ea(0,1,l.revealStart,l.revealStart+l.revealRange,m);if(!this.particlesVx||!this.particlesIdx)return;const w=structuredClone(this._params);let S=[-w.direction.x,w.direction.y,-100];o.aw(S,S);const C=structuredClone(this._vignetteParams);C.strength*=v,w.overrideStyleParameters||(w.intensity=n.style.rain.state.density,w.timeFactor=n.style.rain.state.intensity,w.color=structuredClone(n.style.rain.state.color),S=structuredClone(n.style.rain.state.direction),w.screenThinning.intensity=n.style.rain.state.centerThinning,w.dropletSizeX=n.style.rain.state.dropletSize[0],w.dropletSizeYScale=n.style.rain.state.dropletSize[1]/n.style.rain.state.dropletSize[0],w.distortionStrength=100*n.style.rain.state.distortionStrength,C.strength=1,C.color=structuredClone(n.style.rain.state.vignetteColor));const A=this.updateOnRender(n,w.timeFactor),M=n.context,D=M.gl,F=n.transform;this.screenTexture&&this.screenTexture.size[0]===n.width&&this.screenTexture.size[1]===n.height||(this.screenTexture=new o.T(M,{width:n.width,height:n.height,data:null},D.RGBA8)),w.distortionStrength>0&&(M.activeTexture.set(D.TEXTURE0),this.screenTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),D.copyTexSubImage2D(D.TEXTURE_2D,0,0,0,0,0,n.width,n.height));const O=n.getOrCreateProgram("rainParticle");n.uploadCommonUniforms(M,O),M.activeTexture.set(D.TEXTURE0),this.screenTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const q=[w.color.r,w.color.g,w.color.b,w.color.a],Z=(Q,se)=>{const ne=fn(this._movement.getPosition(),Q),ae=w.dropletSizeX,he=w.dropletSizeX*w.dropletSizeYScale,ce=n.width/2,we=n.height/2,fe=ea(0,w.screenThinning.start,0,1,w.screenThinning.intensity),Te=ea(.001,w.screenThinning.range,0,1,w.screenThinning.intensity),ve=ea(0,w.screenThinning.particleOffset,0,1,w.screenThinning.intensity),ge=(Ce={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ne,velocityConeAperture:w.velocityConeAperture,velocity:w.velocity,boxSize:Q,rainDropletSize:[ae,he],distortionStrength:w.distortionStrength,rainDirection:S,color:q,screenSize:[F.width,F.height],thinningCenterPos:[ce,we],thinningShape:[fe,Te,Math.pow(10,w.screenThinning.fadePower)],thinningAffectedRatio:w.screenThinning.affectedRatio,thinningParticleOffset:ve,shapeDirectionalPower:w.shapeDirPower,shapeNormalPower:w.shapeNormalPower,mode:se?0:1},{u_modelview:Float32Array.from(Ce.modelview),u_projection:Float32Array.from(Ce.projection),u_time:Ce.time,u_cam_pos:Ce.camPos,u_texScreen:0,u_velocityConeAperture:Ce.velocityConeAperture,u_velocity:Ce.velocity,u_boxSize:Ce.boxSize,u_rainDropletSize:Ce.rainDropletSize,u_distortionStrength:Ce.distortionStrength,u_rainDirection:Ce.rainDirection,u_color:Ce.color,u_screenSize:Ce.screenSize,u_thinningCenterPos:Ce.thinningCenterPos,u_thinningShape:Ce.thinningShape,u_thinningAffectedRatio:Ce.thinningAffectedRatio,u_thinningParticleOffset:Ce.thinningParticleOffset,u_shapeDirectionalPower:Ce.shapeDirectionalPower,u_shapeNormalPower:Ce.shapeNormalPower,u_mode:Ce.mode});var Ce;const Fe=Math.round(w.intensity*this.particlesCount),Oe=o.bf.simpleSegment(0,0,4*Fe,2*Fe);O.draw(n,D.TRIANGLES,cr.disabled,Br.disabled,Qr.alphaBlended,Dr.disabled,ge,"rain_particles",this.particlesVx,this.particlesIdx,Oe)};w.distortionStrength>0&&Z(w.boxSize,!0),Z(w.boxSize,!1),this._vignette.draw(n,C)}}const Cc=o.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class $v extends pd{constructor(n){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Lo(n.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(n){const l=n.context;if(!this.particlesVx){const m=Uv(this.particlesCount),v=new o.eN,w=new o.b0;let S=0;const C=o.eq(1323123451230);for(let A=0;A<m.length;++A){const M=m[A],D=C(),F=C(),O=C(),q=[A/m.length,D,F,O],Z=[C(),C()];v.emplaceBack(M[0],M[1],M[2],-1,-1,...q,...Z),v.emplaceBack(M[0],M[1],M[2],1,-1,...q,...Z),v.emplaceBack(M[0],M[1],M[2],1,1,...q,...Z),v.emplaceBack(M[0],M[1],M[2],-1,1,...q,...Z),w.emplaceBack(S+0,S+1,S+2),w.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=l.createVertexBuffer(v,Cc.members),this.particlesIdx=l.createIndexBuffer(w)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.snow)return;const l=structuredClone(this._params);let m=[-l.direction.x,l.direction.y,-100];o.aw(m,m);const v=structuredClone(this._vignetteParams),w=l.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},S=n.transform.zoom;if(w.revealStart>S)return;const C=ea(0,1,w.revealStart,w.revealStart+w.revealRange,S);v.strength*=C,l.overrideStyleParameters||(l.intensity=n.style.snow.state.density,l.timeFactor=n.style.snow.state.intensity,l.color=structuredClone(n.style.snow.state.color),m=structuredClone(n.style.snow.state.direction),l.screenThinning.intensity=n.style.snow.state.centerThinning,l.billboardSize=2.79*n.style.snow.state.flakeSize,v.strength=1,v.color=structuredClone(n.style.snow.state.vignetteColor));const A=this.updateOnRender(n,l.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const M=n.context,D=M.gl,F=n.transform,O=n.getOrCreateProgram("snowParticle");n.uploadCommonUniforms(M,O),((q,Z,Q)=>{const se=fn(this._movement.getPosition(),q),ne=F.width/2,ae=F.height/2,he=ea(0,Q.screenThinning.start,0,1,Q.screenThinning.intensity),ce=ea(.001,Q.screenThinning.range,0,1,Q.screenThinning.intensity),we=ea(0,Q.screenThinning.particleOffset,0,1,Q.screenThinning.intensity),fe=(Te={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:se,velocityConeAperture:Q.velocityConeAperture,velocity:Q.velocity,horizontalOscillationRadius:Q.horizontalOscillationRadius,horizontalOscillationRate:Q.horizontalOscillationRate,boxSize:q,billboardSize:1*Q.billboardSize,simpleShapeParameters:[Q.shapeFadeStart,Q.shapeFadePower],screenSize:[F.width,F.height],thinningCenterPos:[ne,ae],thinningShape:[he,ce,Math.pow(10,Q.screenThinning.fadePower)],thinningAffectedRatio:Q.screenThinning.affectedRatio,thinningParticleOffset:we,color:[Q.color.r,Q.color.g,Q.color.b,Q.color.a],direction:m},{u_modelview:Float32Array.from(Te.modelview),u_projection:Float32Array.from(Te.projection),u_time:Te.time,u_cam_pos:Te.camPos,u_velocityConeAperture:Te.velocityConeAperture,u_velocity:Te.velocity,u_horizontalOscillationRadius:Te.horizontalOscillationRadius,u_horizontalOscillationRate:Te.horizontalOscillationRate,u_boxSize:Te.boxSize,u_billboardSize:Te.billboardSize,u_simpleShapeParameters:Te.simpleShapeParameters,u_screenSize:Te.screenSize,u_thinningCenterPos:Te.thinningCenterPos,u_thinningShape:Te.thinningShape,u_thinningAffectedRatio:Te.thinningAffectedRatio,u_thinningParticleOffset:Te.thinningParticleOffset,u_particleColor:Te.color,u_direction:Te.direction});var Te;const ve=Math.round(Q.intensity*this.particlesCount),ge=o.bf.simpleSegment(0,0,4*ve,2*ve);this.particlesVx&&this.particlesIdx&&O.draw(n,D.TRIANGLES,cr.disabled,Br.disabled,Qr.alphaBlended,Dr.disabled,fe,"snow_particles",this.particlesVx,this.particlesIdx,ge)})(l.boxSize,0,l),this._vignette.draw(n,v)}}const qv={symbol:function(p,n,l,m,v){if(p.renderPass!=="translucent")return;const w=Br.disabled,S=p.colorModeForRenderPass(),C=l.layout.get("text-variable-anchor"),A=l.layout.get("text-size-scale-range"),M=o.aA(p.scaleFactor,A[0],A[1]);C&&function(O,q,Z,Q,se,ne,ae,he){const ce=q.transform,we=se==="map",fe=ne==="map";for(const Te of O){const ve=Q.getTile(Te),ge=ve.getBucket(Z);if(!ge||!ge.text||!ge.text.segments.get().length)continue;const Ce=o.bJ(ge.textSizeData,ce.zoom,he),Fe=Gm(Te,ge.getProjection(),ce),Oe=ce.calculatePixelsToTileUnitsMatrix(ve),st=rh(Fe,ve.tileID.canonical,fe,we,ce,ge.getProjection(),Oe),He=ge.hasIconTextFit()&&ge.hasIconData();Ce&&Eg(ge,we,fe,ae,ce,st,Te,Math.pow(2,ce.zoom-ve.tileID.overscaledZ),Ce,He)}}(m,p,l,n,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),v,M);const D=l.paint.get("icon-opacity").constantOr(1)!==0,F=l.paint.get("text-opacity").constantOr(1)!==0;l.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(D||F)?Pp(p,n,l,m,w,S):(D&&Pp(p,n,l,m,w,S,{onlyIcons:!0}),F&&Pp(p,n,l,m,w,S,{onlyText:!0})),n.map.showCollisionBoxes&&(Ip(p,n,l,m,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),Ip(p,n,l,m,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(p,n,l,m){if(p.renderPass!=="translucent")return;const v=l.paint.get("circle-opacity"),w=l.paint.get("circle-stroke-width"),S=l.paint.get("circle-stroke-opacity"),C=l.layout.get("circle-sort-key").constantOr(1)!==void 0,A=l.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(w.constantOr(1)===0||S.constantOr(1)===0))return;const M=p.context,D=M.gl,F=p.transform,O=!(!p.terrain||!p.terrain.enabled),q=l.layout.get("circle-elevation-reference"),Z=p.depthModeForSublayer(0,cr.ReadOnly),Q=new cr(p.context.gl.LEQUAL,cr.ReadOnly,p.depthRangeFor3D),se=q==="none"||O?Z:Q,ne=Br.disabled,ae=p.colorModeForDrapableLayerRenderPass(A),he=F.projection.name==="globe",ce=[o.aF(F.center.lng),o.aJ(F.center.lat)],we=[];for(let Te=0;Te<m.length;Te++){const ve=m[Te],ge=n.getTile(ve),Ce=ge.getBucket(l);if(!Ce||Ce.projection.name!==F.projection.name)continue;const Fe=Ce.programConfigurations.get(l.id),Oe=Ce.layoutVertexBuffer,st=Ce.globeExtVertexBuffer,He=Ce.indexBuffer,ht=o.d$(l),Nt=[st],Ge=p.isTileAffectedByFog(ve);he&&ht.push("PROJECTION_GLOBE_VIEW"),ht.push("DEPTH_D24"),p.terrain&&F.depthOcclusionForSymbolsAndCircles&&ht.push("DEPTH_OCCLUSION"),Ce.hasElevation&&!p.terrain&&(ht.push("ELEVATED_ROADS"),Nt.push(Ce.elevatedLayoutVertexBuffer));const Re=p.getOrCreateProgram("circle",{config:Fe,defines:ht,overrideFog:Ge}),ft=F.projection.createInversionMatrix(F,ve.canonical),Ze={programConfiguration:Fe,program:Re,layoutVertexBuffer:Oe,dynamicBuffers:Nt,indexBuffer:He,uniformValues:o.e0(p,ve,ge,ft,ce,l),tile:ge};if(C){const wt=Ce.segments.get();for(const Ft of wt)we.push({segments:new o.bf([Ft]),sortKey:Ft.sortKey,state:Ze})}else we.push({segments:Ce.segments,sortKey:0,state:Ze})}C&&we.sort((Te,ve)=>Te.sortKey-ve.sortKey);const fe={useDepthForOcclusion:F.depthOcclusionForSymbolsAndCircles};for(const Te of we){const{programConfiguration:ve,program:ge,layoutVertexBuffer:Ce,dynamicBuffers:Fe,indexBuffer:Oe,uniformValues:st,tile:He}=Te.state,ht=Te.segments;p.terrain&&p.terrain.setupElevationDraw(He,ge,fe),p.uploadCommonUniforms(M,ge,He.tileID.toUnwrapped()),ge.draw(p,D.TRIANGLES,se,ne,ae,Dr.disabled,st,l.id,Ce,Oe,ht,l.paint,F.zoom,ve,Fe)}},heatmap:function(p,n,l,m){if(l.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const v=p.context,w=v.gl,S=Br.disabled,C=new Qr([w.ONE,w.ONE,w.ONE,w.ONE],o.ao.transparent,[!0,!0,!0,!0]);(function(q,Z,Q,se){const ne=q.gl,ae=Z.width*se,he=Z.height*se;q.activeTexture.set(ne.TEXTURE1),q.viewport.set([0,0,ae,he]);let ce=Q.heatmapFbo;if(!ce||ce&&(ce.width!==ae||ce.height!==he)){ce&&ce.destroy();const we=ne.createTexture();ne.bindTexture(ne.TEXTURE_2D,we),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_MAG_FILTER,ne.LINEAR),ce=Q.heatmapFbo=q.createFramebuffer(ae,he,!0,null),function(fe,Te,ve,ge,Ce,Fe){const Oe=fe.gl;Oe.texImage2D(Oe.TEXTURE_2D,0,fe.extRenderToTextureHalfFloat?Oe.RGBA16F:Oe.RGBA,Ce,Fe,0,Oe.RGBA,fe.extRenderToTextureHalfFloat?Oe.HALF_FLOAT:Oe.UNSIGNED_BYTE,null),ge.colorAttachment.set(ve)}(q,0,we,ce,ae,he)}else ne.bindTexture(ne.TEXTURE_2D,ce.colorAttachment.get()),q.bindFramebuffer.set(ce.framebuffer)})(v,p,l,p.transform.projection.name==="globe"?.5:.25),v.clear({color:o.ao.transparent});const A=p.transform,M=A.projection.name==="globe",D=M?["PROJECTION_GLOBE_VIEW"]:[],F=M?Dr.frontCCW:Dr.disabled,O=[o.aF(A.center.lng),o.aJ(A.center.lat)];for(let q=0;q<m.length;q++){const Z=m[q];if(n.hasRenderableParent(Z))continue;const Q=n.getTile(Z),se=Q.getBucket(l);if(!se||se.projection.name!==A.projection.name)continue;const ne=p.isTileAffectedByFog(Z),ae=se.programConfigurations.get(l.id),he=p.getOrCreateProgram("heatmap",{config:ae,defines:D,overrideFog:ne}),{zoom:ce}=p.transform;p.terrain&&p.terrain.setupElevationDraw(Q,he),p.uploadCommonUniforms(v,he,Z.toUnwrapped());const we=A.projection.createInversionMatrix(A,Z.canonical);he.draw(p,w.TRIANGLES,cr.disabled,S,C,F,o1(p,Z,Q,we,O,ce,l.paint.get("heatmap-intensity")),l.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,l.paint,p.transform.zoom,ae,M?[se.globeExtVertexBuffer]:null)}v.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(v,w){const S=v.context,C=S.gl,A=w.heatmapFbo;if(!A)return;S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,A.colorAttachment.get()),S.activeTexture.set(C.TEXTURE1);let M=w.colorRampTexture;M||(M=w.colorRampTexture=new o.T(S,w.colorRamp,C.RGBA8)),M.bind(C.LINEAR,C.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,C.TRIANGLES,cr.disabled,Br.disabled,v.colorModeForRenderPass(),Dr.disabled,((D,F,O,q)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,w),w.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,w.paint,v.transform.zoom)}(p,l))},line:function(p,n,l,m){if(p.renderPass!=="translucent")return;const v=l.paint.get("line-opacity"),w=l.paint.get("line-width");if(v.constantOr(1)===0||w.constantOr(1)===0)return;const S=l.paint.get("line-emissive-strength"),C=l.paint.get("line-occlusion-opacity"),A=l.layout.get("line-elevation-reference"),M=l.layout.get("line-width-unit")==="meters",D=A==="sea",F=!(!p.terrain||!p.terrain.enabled),O=p.context,q=O.gl;if(l.hasElevatedBuckets&&p.transform.projection.name==="globe")return;const Z=l.layout.get("line-cross-slope"),Q=Z!==void 0,se=Z<1,ne=p.colorModeForDrapableLayerRenderPass(S),ae=p.terrain&&p.terrain.renderingToTexture,he=ae?1:o.o.devicePixelRatio,ce=l.paint.get("line-dasharray"),we=ce.constantOr(1),fe=l.layout.get("line-cap"),Te=ce.constantOr(null),ve=fe.constantOr(null),ge=l.paint.get("line-pattern"),Ce=ge.constantOr(1),Fe=l.paint.get("line-pattern-cross-fade"),Oe=ge.constantOr(null),st=l.paint.get("line-opacity").constantOr(1);let He=!Ce&&st!==1||p.depthOcclusion&&C>0&&C<1;const ht=l.paint.get("line-gradient"),Nt=Ce?"linePattern":"line",Ge=o.e1(l);let Re;if(ae&&p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(He=!1),C!==0&&p.depthOcclusion){const Ft=l.paint._values["line-opacity"];Ft&&Ft.value&&Ft.value.kind==="constant"?Re=Ft.value:o.w(`Occlusion opacity for layer ${l.id} is supported only when line-opacity isn't data-driven.`)}w.value.kind!=="constant"&&w.value.isLineProgressConstant===!1&&Ge.push("VARIABLE_LINE_WIDTH");const ft=(Ft,sr,Rt,Lt,ar,Jt)=>{for(const Zt of Ft){const Qt=n.getTile(Zt);if(Ce&&!Qt.patternsLoaded())continue;const Tr=Qt.getBucket(l);if(!Tr||Tr.elevationType!=="none"&&!ar||Tr.elevationType==="none"&&ar)continue;p.prepareDrawTile();const pn=[...sr],En=p.shadowRenderer,oi=Tr.elevationType==="road"&&!!En&&En.enabled;let Nr=[0,0,0];if(oi){const zr=p.style.directionalLight,In=p.style.ambientLight;zr&&In&&(Nr=il(p.style,zr,In)),pn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Sn=Tr.programConfigurations.get(l.id);let Xr=!1;if(Oe&&Qt.imageAtlas){const zr=o.e2.from(Oe),In=zr.getPrimary().scaleSelf(he).toString(),Oi=Qt.imageAtlas.patternPositions.get(In),is=zr.getSecondary(),Ui=is?Qt.imageAtlas.patternPositions.get(is.scaleSelf(he).toString()):null;Xr=!!Oi&&!!Ui,Oi&&Sn.setConstantPatternPositions(Oi,Ui)}Fe>0&&(Xr||Sn.getPatternTransitionVertexBuffer("line-pattern"))&&pn.push("LINE_PATTERN_TRANSITION");const ri=p.isTileAffectedByFog(Zt),Cn=p.getOrCreateProgram(Nt,{config:Sn,defines:pn,overrideFog:ri});if(!Ce&&Te&&ve&&Qt.lineAtlas){const zr=Qt.lineAtlas.getDash(Te,ve);zr&&Sn.setConstantPatternPositions(zr)}oi&&En.setupShadows(Qt.tileID.toUnwrapped(),Cn,"vector-tile");let[mi,Nn]=l.paint.get("line-trim-offset");(ve==="round"||ve==="square")&&mi!==Nn&&(mi===0&&(mi-=1),Nn===1&&(Nn+=1));const Kr=ae?Zt.projMatrix:null,Wn=M?1/Tr.tileToMeter/o.ay(Qt,1,p.transform.zoom):1,en=M?1/Tr.tileToMeter/o.ay(Qt,1,Math.floor(p.transform.zoom)):1,Ti=Ce?o.e3(p,Qt,l,Kr,he,Wn,en,[mi,Nn],Nr,Fe):o.e4(p,Qt,l,Kr,Tr.lineClipsArray.length,he,Wn,en,[mi,Nn],Nr);if(ht){const zr=Tr.gradients[l.id];let In=zr.texture;if(l.gradientVersion!==zr.version){let Oi=256;if(l.stepInterpolant){const is=n.getSource().maxzoom,Ui=Zt.canonical.z===is?Math.ceil(1<<p.transform.maxZoom-Zt.canonical.z):1;Oi=o.aA(o.e5(Tr.maxLineLength/o.al*1024*Ui),256,O.maxTextureSize)}zr.gradient=o.e6({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Oi,image:zr.gradient||void 0,clips:Tr.lineClipsArray}),zr.texture?zr.texture.update(zr.gradient):zr.texture=new o.T(O,zr.gradient,q.RGBA8),zr.version=l.gradientVersion,In=zr.texture}O.activeTexture.set(q.TEXTURE1),In.bind(l.stepInterpolant?q.NEAREST:q.LINEAR,q.CLAMP_TO_EDGE)}we&&(O.activeTexture.set(q.TEXTURE0),Qt.lineAtlasTexture&&Qt.lineAtlasTexture.bind(q.LINEAR,q.REPEAT),Sn.updatePaintBuffers()),Ce&&(O.activeTexture.set(q.TEXTURE0),Qt.imageAtlasTexture&&Qt.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),Sn.updatePaintBuffers()),ar&&!D&&p.terrain.setupElevationDraw(Qt,Cn),p.uploadCommonUniforms(O,Cn,Zt.toUnwrapped());const Kn=zr=>{Re!=null&&(Re.value=st*C),Cn.draw(p,q.TRIANGLES,Rt,zr,ne,Dr.disabled,Ti,l.id,Tr.layoutVertexBuffer,Tr.indexBuffer,Tr.segments,l.paint,p.transform.zoom,Sn,[Tr.layoutVertexBuffer2,Tr.patternVertexBuffer,Tr.zOffsetVertexBuffer]),Re!=null&&(Re.value=st)};if(He&&!ar){const zr=p.stencilModeForClipping(Zt).ref;zr===0&&ae&&O.clear({stencil:0});const In={func:q.EQUAL,mask:255};Ti.u_alpha_discard_threshold=.8,Kn(new Br(In,zr,255,q.KEEP,q.KEEP,q.INVERT)),Ti.u_alpha_discard_threshold=0,Kn(new Br(In,zr,255,q.KEEP,q.KEEP,q.KEEP))}else Ti.u_alpha_discard_threshold=He&&ar&&Jt?.8:0,Kn(ar?Lt:p.stencilModeForClipping(Zt))}};let Ze=p.depthModeForSublayer(0,cr.ReadOnly);const wt=new cr(p.depthOcclusion?q.GREATER:q.LEQUAL,cr.ReadOnly,p.depthRangeFor3D);if(l.hasNonElevatedBuckets){const Ft=!ae&&p.terrain;C!==0&&Ft?o.w(`Occlusion opacity for layer ${l.id} is supported on terrain only if the layer has line-z-offset enabled.`):Ft?o.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${l.id}.`):ft(m,Ge,Ze,Br.disabled,!1,!0)}if(l.hasElevatedBuckets){A==="hd-road-markup"?F||(Ze=wt,Ge.push("ELEVATED_ROADS")):(Ge.push("ELEVATED"),Ze=wt,Q&&Ge.push(se?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),D&&Ge.push("ELEVATION_REFERENCE_SEA"));const Ft=He?p.stencilModeFor3D():Br.disabled;p.forceTerrainMode=!0,ft(m,Ge,Ze,Ft,!0,!0),He&&ft(m,Ge,Ze,Ft,!0,!1),p.forceTerrainMode=!1}He&&(p.resetStencilClippingMasks(),ae&&O.clear({stencil:0})),C===0||p.depthOcclusion||ae||p.layersWithOcclusionOpacity.push(p.currentLayer)},fill:function(p,n,l,m){const v=l.paint.get("fill-color"),w=l.paint.get("fill-opacity");if(w.constantOr(1)===0)return;const S=l.paint.get("fill-emissive-strength"),C=p.colorModeForDrapableLayerRenderPass(S),A=l.paint.get("fill-pattern"),M=p.opaquePassEnabledForLayer()&&!A.constantOr(1)&&v.constantOr(o.ao.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";let D="none";l.layout.get("fill-elevation-reference")!=="none"?D="road":l.paint.get("fill-z-offset").constantOr(1)!==0&&(D="offset");const F=!(!p.terrain||!p.terrain.enabled),O={painter:p,sourceCache:n,layer:l,coords:m,colorMode:C,elevationType:D,terrainEnabled:F,pass:M};if(p.renderPass!=="shadow")if(D!=="offset"){if(bh(O,!1),D==="road"){const q=!F&&p.renderPass==="translucent";q&&dd(p,n,l,m,"geometry"),bh(O,!0,Br.disabled),q&&function(Z){const{painter:Q,sourceCache:se,layer:ne,coords:ae,colorMode:he}=Z,ce=Q.context.gl,we=Z.painter.shadowRenderer,fe=!!we&&we.enabled,Te=new cr(Q.context.gl.LEQUAL,cr.ReadOnly,Q.depthRangeFor3D);let ve=[0,0,0];if(fe){const Ce=Q.style.directionalLight,Fe=Q.style.ambientLight;Ce&&Fe&&(ve=il(Q.style,Ce,Fe))}const ge=Ce=>{for(const Fe of ae){const Oe=se.getTile(Fe),st=Oe.getBucket(ne);if(!st)continue;const He=st.elevatedStructures;if(!He)continue;let ht,Nt;if(Ce?(ht=He.renderableBridgeSegments,Nt=He.bridgeProgramConfigurations.get(ne.id)):(ht=He.renderableTunnelSegments,Nt=He.tunnelProgramConfigurations.get(ne.id)),!ht||ht.segments[0].primitiveLength===0)continue;Nt.updatePaintBuffers(),Q.prepareDrawTile();const Ge=Q.isTileAffectedByFog(Fe),Re=[];fe&&Re.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const ft=Q.getOrCreateProgram("elevatedStructures",{config:Nt,overrideFog:Ge,defines:Re}),Ze=Q.translatePosMatrix(Fe.projMatrix,Oe,ne.paint.get("fill-translate"),ne.paint.get("fill-translate-anchor"));fe&&we.setupShadows(Oe.tileID.toUnwrapped(),ft,"vector-tile");const wt=$2(Ze,ve);Q.uploadCommonUniforms(Q.context,ft,Fe.toUnwrapped()),ft.draw(Q,ce.TRIANGLES,Te,Br.disabled,he,Dr.backCCW,wt,ne.id,He.vertexBuffer,He.indexBuffer,ht,ne.paint,Q.transform.zoom,Nt,[He.vertexBufferNormal])}};ge(!0),ge(!1)}(O)}}else bh(O,!1,p.stencilModeFor3D());else p.shadowRenderer&&D==="road"&&!F&&function(q){const{painter:Z,sourceCache:Q,layer:se,coords:ne}=q,ae=Z.context.gl,he=q.painter.shadowRenderer;for(const ce of ne){const we=Q.getTile(ce),fe=we.getBucket(se);if(!fe)continue;const Te=fe.elevatedStructures;if(!Te||!Te.shadowCasterSegments||Te.shadowCasterSegments.segments[0].primitiveLength===0)continue;Z.prepareDrawTile();const ve=fe.bufferData.programConfigurations.get(se.id),ge=Z.isTileAffectedByFog(ce),Ce=Z.getOrCreateProgram("elevatedStructuresDepth",{config:ve,overrideFog:ge}),Fe=he.calculateShadowPassMatrixFromTile(we.tileID.toUnwrapped());Z.uploadCommonUniforms(Z.context,Ce,ce.toUnwrapped());const Oe={u_matrix:Fe,u_depth_bias:0};Ce.draw(Z,ae.TRIANGLES,he.getShadowPassDepthMode(),Br.disabled,he.getShadowPassColorMode(),Dr.disabled,Oe,se.id,Te.vertexBuffer,Te.indexBuffer,Te.shadowCasterSegments,se.paint,Z.transform.zoom,ve)}}(O)},"fill-extrusion":function(p,n,l,m){const v=l.paint.get("fill-extrusion-opacity"),w=p.context,S=w.gl,C=p.terrain,A=C&&C.renderingToTexture;if(v===0)return;const M=p.conflationActive&&p.style.isLayerClipped(l,n.getSource()),D=p.style.order.indexOf(l.fqid);if(M&&function(F,O,q,Z,Q){for(const se of Z){const ne=O.getTile(se).getBucket(q);ne&&(ne.updateReplacement(se,F.replacementSource,Q),ne.uploadCentroid(F.context))}}(p,n,l,m,D),C||M)for(const F of m){const O=n.getTile(F).getBucket(l);O&&yu(p.context,n,F,O,l,C,M)}if(p.renderPass==="shadow"&&p.shadowRenderer){const F=p.shadowRenderer;if(C&&v<.65&&l._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.ad)return;const O=F.getShadowPassDepthMode(),q=F.getShadowPassColorMode();rr(p,n,l,m,O,Br.disabled,q,M)}else if(p.renderPass==="translucent"){const F=!l.paint.get("fill-extrusion-pattern").constantOr(1),O=l.paint.get("fill-extrusion-color").constantOr(o.ao.white);if(!A&&O.a!==0){const q=new cr(p.context.gl.LEQUAL,cr.ReadWrite,p.depthRangeFor3D);v===1&&F?rr(p,n,l,m,q,Br.disabled,Qr.unblended,M):(rr(p,n,l,m,q,Br.disabled,Qr.disabled,M),rr(p,n,l,m,q,p.stencilModeFor3D(),p.colorModeForRenderPass(),M),p.resetStencilClippingMasks())}if(p.style.enable3dLights()&&F&&(!C&&p.transform.projection.name!=="globe"||A)){const q=l.paint.get("fill-extrusion-opacity"),Z=l.paint.get("fill-extrusion-ambient-occlusion-intensity"),Q=l.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),se=l.paint.get("fill-extrusion-flood-light-intensity"),ne=l.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ae=l.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ne?null:l.lut).toArray01().slice(0,3),he=Z>0&&Q>0,ce=se>0,we=(ve,ge,Ce)=>(1-Ce)*ve+Ce*ge,fe=new Pv;fe.translate=l.paint.get("fill-extrusion-translate"),fe.translateAnchor=l.paint.get("fill-extrusion-translate-anchor"),fe.edgeRadius=l.layout.get("fill-extrusion-edge-radius"),fe.cutoffFadeRange=l.paint.get("fill-extrusion-cutoff-fade-range");const Te=ve=>{const ge=p.depthModeForSublayer(1,cr.ReadOnly,S.LEQUAL,!0),Ce=l.paint.get(ve?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Fe=we(.1,3,Ce),Oe=p._showOverdrawInspector;if(!Oe){const st=new Br({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),He=new Qr([S.ONE,S.ONE,S.ONE,S.ONE],o.ao.transparent,[!1,!1,!1,!0],S.MIN);Tc(fe,p,n,l,m,ge,st,He,Dr.disabled,ve,"sdf",q,Z,Q,se,ae,Fe,M,!1)}{const st=Oe?Br.disabled:new Br({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),He=Oe?p.colorModeForRenderPass():new Qr([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],o.ao.transparent,[!0,!0,!0,!0]);Tc(fe,p,n,l,m,ge,st,He,Dr.disabled,ve,"color",q,Z,Q,se,ae,Fe,M,!1)}};if(A){const ve=(ge,Ce,Fe)=>{const Oe=p.depthModeForSublayer(1,cr.ReadOnly,S.LEQUAL,!1),st=l.paint.get(ge?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),He=we(.1,3,st);{const ht=new Qr([S.ONE,S.ONE,S.ONE,S.ONE],o.ao.transparent,[!1,!1,!1,!0]);Tc(fe,p,n,l,m,Oe,Br.disabled,ht,Dr.disabled,ge,"clear",q,Z,Q,se,ae,He,M,Ce)}{const ht=new Br({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Nt=new Qr([S.ONE,S.ONE,S.ONE,S.ONE],o.ao.transparent,[!1,!1,!1,!0],S.MIN);Tc(fe,p,n,l,m,Oe,ht,Nt,Dr.disabled,ge,"sdf",q,Z,Q,se,ae,He,M,Ce)}{const ht=ge?S.ZERO:S.ONE_MINUS_DST_ALPHA,Nt=new Br({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Ge=new Qr([ht,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],o.ao.transparent,[!0,!0,!0,!0]);Tc(fe,p,n,l,m,Oe,Nt,Ge,Dr.disabled,ge,"color",q,Z,Q,se,ae,He,M,Ce)}{const ht=new Qr([S.ONE,S.ONE,S.ONE,ge?S.ZERO:S.ONE],o.ao.transparent,[!1,!1,!1,!0],ge?S.FUNC_ADD:S.MAX);Tc(fe,p,n,l,m,Oe,Br.disabled,ht,Dr.disabled,ge,"clear",q,Z,Q,se,ae,He,M,Ce,Fe)}};if(he||ce){let ge;if(p.prepareDrawTile(),C){const Ce=C.drapeBufferSize[0],Fe=C.drapeBufferSize[1];ge=C.framebufferCopyTexture,ge&&(!ge||ge.size[0]===Ce&&ge.size[1]===Fe)||(ge&&ge.destroy(),ge=C.framebufferCopyTexture=new o.T(w,new o.q({width:Ce,height:Fe}),S.RGBA8)),ge.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexSubImage2D(S.TEXTURE_2D,0,0,0,0,0,Ce,Fe)}he&&ve(!0,!1,ge),ce&&ve(!1,!0,ge)}}else he&&Te(!0),ce&&Te(!1),(he||ce)&&p.resetStencilClippingMasks()}}},building:function(p,n,l,m){p.currentLayer<p.firstLightBeamLayer&&(p.firstLightBeamLayer=p.currentLayer);const v=l.paint.get("building-ambient-occlusion-ground-intensity"),w=l.paint.get("building-ambient-occlusion-ground-radius"),S=l.paint.get("building-ambient-occlusion-ground-attenuation"),C=l.paint.get("building-opacity");if(C<=0)return;let A=v>0&&w>0,M=!0;const D=l.paint.get("building-vertical-scale");if(D<=0)return;(!p.shadowRenderer||D<1)&&(M=!1);const F=p.conflationActive&&p.style.isLayerClipped(l,n.getSource()),O=p.style.order.indexOf(l.fqid);if(function(q,Z,Q,se,ne,ae){for(const he of ae){const ce=Z.getTile(he).getBucket(Q);ce&&(ne&&ce.updateReplacement(he,q.replacementSource,se),ce.uploadUpdatedIndexBuffer(q.context))}}(p,n,l,O,F,m),function(q,Z,Q,se){for(const ne of se){const ae=Z.getTile(ne).getBucket(Q);ae&&ae.needsEvaluation()&&ae.uploadUpdatedColorBuffer(q.context)}}(p,n,l,m),l.resetLayerRenderingStats(p),p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0),p.renderPass==="shadow"&&p.shadowRenderer){const q=p.shadowRenderer,Z=[],Q=q.getShadowPassDepthMode();Ag({painter:p,source:n,layer:l,coords:m,defines:Z,blendMode:q.getShadowPassColorMode(),depthMode:Q,opacity:C,verticalScale:D,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(p.renderPass==="translucent"){let q=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];M&&(q=q.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),p.shadowRenderer&&p.shadowRenderer.useNormalOffset&&(q=q.concat("NORMAL_OFFSET"));const Z=l.paint.get("building-facade-emissive-chance"),Q=l.paint.get("building-ambient-occlusion-intensity"),se=l.paint.get("building-flood-light-intensity"),ne=l.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",ae=l.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(ne?null:l.lut).toArray01().slice(0,3),he=l.paint.get("building-flood-light-ground-attenuation"),ce=se>0,we=new cr(p.context.gl.LEQUAL,cr.ReadWrite,p.depthRangeFor3D);C<1&&Ag({painter:p,source:n,layer:l,coords:m,defines:q,blendMode:Qr.disabled,depthMode:we,opacity:C,verticalScale:D,facadeEmissiveChance:Z,facadeAOIntensity:Q,floodLightIntensity:se,floodLightColor:ae,depthOnly:!0});const fe=p.colorModeForRenderPass();Ag({painter:p,source:n,layer:l,coords:m,defines:q,blendMode:fe,depthMode:we,opacity:C,verticalScale:D,facadeEmissiveChance:Z,facadeAOIntensity:Q,floodLightIntensity:se,floodLightColor:ae}),A&&Ig(p,n,l,m,!0,C,v,w,se,ae,S,F),ce&&Ig(p,n,l,m,!1,C,v,w,se,ae,he,F)}else if(p.renderPass==="light-beam"){const q=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],Z=new cr(p.context.gl.LEQUAL,cr.ReadOnly,p.depthRangeFor3D);Ag({painter:p,source:n,layer:l,coords:m,defines:q,blendMode:Qr.alphaBlended,depthMode:Z,opacity:C,verticalScale:D,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1),p.resetStencilClippingMasks()},hillshade:function(p,n,l,m){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent"||p.style.disableElevatedTerrain)return;const v=p.context,w=p.terrain&&p.terrain.renderingToTexture,[S,C]=p.renderPass!=="translucent"||w?[{},m]:p.stencilConfigForOverlap(m);for(const A of C){const M=n.getTile(A);if(M.needsHillshadePrepare&&p.renderPass==="offscreen")R2(p,M,l);else if(p.renderPass==="translucent"){const D=p.depthModeForSublayer(0,cr.ReadOnly),F=l.paint.get("hillshade-emissive-strength"),O=p.colorModeForDrapableLayerRenderPass(F),q=w&&p.terrain?p.terrain.stencilModeForRTTOverlap(A):S[A.overscaledZ];j2(p,A,M,l,D,q,O)}}v.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,n,l,m,v,w){if(p.renderPass!=="translucent"||l.paint.get("raster-opacity")===0)return;const S=p.transform.projection.name==="globe",C=l.paint.get("raster-elevation")!==0,A=C&&S;if(p.renderElevatedRasterBackface&&!A)return;const M=p.context,D=M.gl,F=n.getSource(),O=function(fe,Te,ve,ge){const Ce=Te.paint.get("raster-color"),Fe=fe.type==="raster-array",Oe=[],st=Te.paint.get("raster-resampling"),He=Te.paint.get("raster-color-mix");let ht=Te.paint.get("raster-color-range");const Nt=[He[0],He[1],He[2],0],Ge=He[3];let Re=st==="nearest"?ge.NEAREST:ge.LINEAR;if(Fe&&(Oe.push("RASTER_ARRAY"),Ce||Oe.push("RASTER_COLOR"),st==="linear"&&Oe.push("RASTER_ARRAY_LINEAR"),Re=ge.NEAREST,!ht&&fe.rasterLayers)){const ft=fe.rasterLayers.find(({id:Ze})=>Ze===Te.sourceLayer);ft&&ft.fields&&ft.fields.range&&(ht=ft.fields.range)}if(ht=ht||[0,1],Ce){Oe.push("RASTER_COLOR"),ve.activeTexture.set(ge.TEXTURE2),Te.updateColorRamp(ht);let ft=Te.colorRampTexture;ft||(ft=Te.colorRampTexture=new o.T(ve,Te.colorRamp,ge.RGBA8)),ft.bind(ge.LINEAR,ge.CLAMP_TO_EDGE)}return{mix:Nt,range:ht,offset:Ge,defines:Oe,resampling:Re}}(F,l,M,D);if(F instanceof o.aT&&!m.length&&!S)return;const q=l.paint.get("raster-emissive-strength"),Z=p.colorModeForDrapableLayerRenderPass(q),Q=p.terrain&&p.terrain.renderingToTexture,se=!p.options.moving,ne=l.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;if(F instanceof o.aT&&!m.length&&(F.onNorthPole||F.onSouthPole)){const fe=C?p.stencilModeFor3D():Br.disabled;return void Rv(!!F.onNorthPole,null,p,n,l,q,O,Dr.disabled,fe)}if(!m.length)return;const[ae,he]=F instanceof o.aT||Q?[{},m]:p.stencilConfigForOverlap(m),ce=he[he.length-1].overscaledZ;A&&O.defines.push("PROJECTION_GLOBE_VIEW"),C&&O.defines.push("RENDER_CUTOFF");const we=(fe,Te,ve)=>{for(const ge of fe){const Ce=ge.toUnwrapped(),Fe=n.getTile(ge);if(Q&&(!Fe||!Fe.hasData()))continue;M.activeTexture.set(D.TEXTURE0);const Oe=W2(Fe,F,l,O);if(!Oe||!Oe.texture)continue;const{texture:st,mix:He,offset:ht,tileSize:Nt,buffer:Ge}=Oe;let Re,ft;Q?(Re=cr.disabled,ft=ge.projMatrix):C?(Re=new cr(D.LEQUAL,cr.ReadWrite,p.depthRangeFor3D),ft=S?Float32Array.from(p.transform.expandedFarZProjMatrix):p.transform.calculateProjMatrix(Ce,se)):(Re=p.depthModeForSublayer(ge.overscaledZ-ce,l.paint.get("raster-opacity")===1?cr.ReadWrite:cr.ReadOnly,D.LESS),ft=p.transform.calculateProjMatrix(Ce,se));const Ze=p.terrain&&Q?p.terrain.stencilModeForRTTOverlap(ge):ae[ge.overscaledZ],wt=w?0:l.paint.get("raster-fade-duration");Fe.registerFadeDuration(wt);const Ft=n.findLoadedParent(ge,0),sr=dg(Fe,Ft,n,p.transform,wt);let Rt,Lt;!sr.isFading&&Fe.refreshedUponExpiration&&(Fe.refreshedUponExpiration=!1),p.terrain&&p.terrain.prepareDrawTile(),M.activeTexture.set(D.TEXTURE0),st.bind(ne,D.CLAMP_TO_EDGE),M.activeTexture.set(D.TEXTURE1),Ft?(Ft.texture&&Ft.texture.bind(ne,D.CLAMP_TO_EDGE),Rt=Math.pow(2,Ft.tileID.overscaledZ-Fe.tileID.overscaledZ),Lt=[Fe.tileID.canonical.x*Rt%1,Fe.tileID.canonical.y*Rt%1]):st.bind(ne,D.CLAMP_TO_EDGE),"useMipmap"in st&&M.extTextureFilterAnisotropic&&p.transform.pitch>20&&D.texParameterf(D.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);const ar=p.transform;let Jt;const Zt=C?u1(ar):[0,0,0,0];let Qt,Tr,pn,En,oi,Nr=0;if(A&&F instanceof o.aT&&F.coordinates.length>3)Qt=Float32Array.from(o.bj(o.dI(new o.cC(0,0,0)))),Tr=Float32Array.from(ar.globeMatrix),pn=Float32Array.from(o.dE(ar)),En=[o.aF(ar.center.lng),o.aJ(ar.center.lat)],Jt=F.elevatedGlobePerspectiveTransform,oi=F.elevatedGlobeGridMatrix||new Float32Array(9);else if(A){const Cn=o.dF(ge.canonical);Nr=o.dG(Cn.getCenter().lat),Qt=Float32Array.from(o.bj(o.dI(ge.canonical))),Tr=Float32Array.from(ar.globeMatrix),pn=Float32Array.from(o.dE(ar)),En=[o.aF(ar.center.lng),o.aJ(ar.center.lat)],Jt=[0,0],oi=Float32Array.from(o.dH(ge.canonical,Cn,Nr,ar.worldSize/ar._pixelsPerMercatorPixel))}else Jt=F instanceof o.aT?F.perspectiveTransform:[0,0],Qt=new Float32Array(16),Tr=new Float32Array(9),pn=new Float32Array(16),En=[0,0],oi=new Float32Array(9);const Sn=Ap(ft,Qt,Tr,pn,oi,Lt||[0,0],o.aj(p.transform.zoom),En,Zt,Rt||1,sr,l,Jt,C?l.paint.get("raster-elevation"):0,2,He,ht,O.range,Nt,Ge,q),Xr=p.isTileAffectedByFog(ge),ri=p.getOrCreateProgram("raster",{defines:O.defines,overrideFog:Xr});if(p.uploadCommonUniforms(M,ri,Ce),F instanceof o.aT){const Cn=F.elevatedGlobeVertexBuffer,mi=F.elevatedGlobeIndexBuffer;if(Q||!S)F.boundsBuffer&&F.boundsSegments&&ri.draw(p,D.TRIANGLES,Re,Br.disabled,Z,Dr.disabled,Sn,l.id,F.boundsBuffer,p.quadTriangleIndexBuffer,F.boundsSegments);else if(Cn&&mi){const Nn=ar.zoom<=o.cZ?F.elevatedGlobeSegments:F.getSegmentsForLongitude(ar.center.lng);Nn&&ri.draw(p,D.TRIANGLES,Re,Br.disabled,Z,Te,Sn,l.id,Cn,mi,Nn)}}else if(A){Re=new cr(D.LEQUAL,cr.ReadOnly,p.depthRangeFor3D);const Cn=p.globeSharedBuffers;if(Cn){const[mi,Nn,Kr]=Cn.getGridBuffers(Nr,!1);ri.draw(p,D.TRIANGLES,Re,ve||Ze,p.colorModeForRenderPass(),Te,Sn,l.id,mi,Nn,Kr)}}else{const{tileBoundsBuffer:Cn,tileBoundsIndexBuffer:mi,tileBoundsSegments:Nn}=p.getTileBoundsBuffers(Fe);ri.draw(p,D.TRIANGLES,Re,Ze,Z,Dr.disabled,Sn,l.id,Cn,mi,Nn)}}if(!(F instanceof o.aT)&&A)for(const ge of fe){const Ce=ge.canonical.y===(1<<ge.canonical.z)-1;ge.canonical.y===0&&Rv(!0,ge,p,n,l,q,O,Te,ve||Br.disabled),Ce&&Rv(!1,ge,p,n,l,q,O,Te===Dr.frontCW?Dr.backCW:Dr.frontCW,ve||Br.disabled)}};A?we(he,p.renderElevatedRasterBackface?Dr.backCW:Dr.frontCW,p.stencilModeFor3D()):we(he,Dr.disabled,void 0),p.resetStencilClippingMasks()},"raster-particle":function(p,n,l,m,v,w){p.renderPass==="offscreen"&&function(S,C,A,M){if(!M.length)return;const D=S.context,F=D.gl,O=C.getSource();if(!(O instanceof Ls))return;const q=Math.ceil(Math.sqrt(A.paint.get("raster-particle-count")));let Z=A.particlePositionRGBAImage;if(!Z||Z.width!==q){const he=function(ce){const we=ce*ce,fe=new Uint8Array(4*we),Te=function(ge){return ge|=0,ge=Math.imul(2747636419^ge,2654435769),ge=Math.imul(ge^ge>>>16,2654435769),((ge=Math.imul(ge^ge>>>16,2654435769))>>>0)/4294967296},ve=1/1.1;for(let ge=0;ge<we;ge++){const Ce=ve*(Te(2*ge+0)+ud),Fe=ve*(Te(2*ge+1)+ud),Oe=255*Ce%1,st=255*Fe%1,He=Oe,ht=Fe-st/255,Nt=st;fe[4*ge+0]=255*(Ce-Oe/255),fe[4*ge+1]=255*He,fe[4*ge+2]=255*ht,fe[4*ge+3]=255*Nt}return fe}(q);Z=A.particlePositionRGBAImage=new o.q({width:q,height:q},he)}let Q=A.particleFramebuffer;Q?Q.width!==q&&(Q.destroy(),Q=A.particleFramebuffer=D.createFramebuffer(q,q,!0,null)):Q=A.particleFramebuffer=D.createFramebuffer(q,q,!0,null);const se=[];for(const he of M){const ce=C.getTile(he);if(!(ce instanceof du))continue;const we=Mv(ce,O,A);if(!we)continue;const fe=[ce.tileSize,ce.tileSize];let Te=A.tileFramebuffer;Te||(Te=A.tileFramebuffer=D.createFramebuffer(fe[0],fe[1],!0,null));let ve=ce.rasterParticleState;ve||(ve=ce.rasterParticleState=new pa(D,he,fe,Z));const ge=ve.update(A.lastInvalidatedAt);ve.particleTextureDimension!==q&&ve.updateParticleTexture(he,Z);const Ce=ve.targetColorTexture;ve.targetColorTexture=ve.backgroundColorTexture,ve.backgroundColorTexture=Ce;const Fe=ve.particleTexture0;ve.particleTexture0=ve.particleTexture1,ve.particleTexture1=Fe,se.push([he,we,ve,ge])}if(se.length===0)return;const ne=o.o.now(),ae=A.previousDrawTimestamp?.001*(ne-A.previousDrawTimestamp):.0167;if(A.previousDrawTimestamp=ne,A.hasColorMap()){D.activeTexture.set(F.TEXTURE0+2);let he=A.colorRampTexture;he||(he=A.colorRampTexture=new o.T(D,A.colorRamp,F.RGBA8)),he.bind(F.LINEAR,F.CLAMP_TO_EDGE)}D.bindFramebuffer.set(A.tileFramebuffer.framebuffer),function(he,ce,we){const fe=he.context,Te=fe.gl,ve=ce.tileFramebuffer;fe.activeTexture.set(Te.TEXTURE0);const ge={u_texture:0,u_opacity:1.05*(Fe=ce.paint.get("raster-particle-fade-opacity-factor"))/(Fe+.05)},Ce=he.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Fe;for(const Oe of we){const[,,st,He]=Oe;ve.colorAttachment.set(st.targetColorTexture.texture),fe.viewport.set([0,0,ve.width,ve.height]),fe.clear({color:o.ao.transparent}),He&&(st.backgroundColorTexture.bind(Te.NEAREST,Te.CLAMP_TO_EDGE),Ce.draw(he,Te.TRIANGLES,cr.disabled,Br.disabled,Qr.alphaBlended,Dr.disabled,ge,ce.id,he.viewportBuffer,he.quadTriangleIndexBuffer,he.viewportSegments))}}(S,A,se),function(he,ce,we,fe){const Te=he.context,ve=Te.gl,ge=we.tileFramebuffer,Ce=he.transform.projection.name==="globe",Fe=we.paint.get("raster-particle-max-speed");for(const Oe of fe){const[st,He,ht]=Oe;Te.activeTexture.set(ve.TEXTURE0+0),He.texture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE),ge.colorAttachment.set(ht.targetColorTexture.texture);const Nt=he.getOrCreateProgram("rasterParticleDraw",{defines:He.defines,overrideFog:!1});Te.activeTexture.set(ve.TEXTURE0+1);const Ge=He.scalarData?[]:[0,1,2,3].map(Ze=>o.e8[Ze](st));Ge.push(st);const Re=st.canonical.x,ft=st.canonical.y;for(const Ze of Ge){const wt=ce.getTile(Ce?Ze.wrapped():Ze);if(!wt)continue;const Ft=wt.rasterParticleState;if(!Ft)continue;const sr=Ze.canonical.x+(1<<Ze.canonical.z)*(Ze.wrap-st.wrap),Rt=Ze.canonical.y;Ft.particleTexture0.bind(ve.NEAREST,ve.CLAMP_TO_EDGE);const Lt=Tv(1,Ft.particleTexture0.size[0],[sr-Re,Rt-ft],0,He.texture.size,2,Fe,He.textureOffset,He.scale,He.offset);Nt.draw(he,ve.POINTS,cr.disabled,Br.disabled,Qr.alphaBlended,Dr.disabled,Lt,we.id,Ft.particleIndexBuffer,void 0,Ft.particleSegment)}}}(S,C,A,se),D.bindFramebuffer.set(A.particleFramebuffer.framebuffer),function(he,ce,we,fe){const Te=he.context,ve=Te.gl,ge=ce.paint.get("raster-particle-max-speed"),Ce=fe*ce.paint.get("raster-particle-speed-factor")*.15,Fe=function(st){return Math.pow(st,6)}(.01+1*ce.paint.get("raster-particle-reset-rate-factor")),Oe=ce.particleFramebuffer;Te.viewport.set([0,0,Oe.width,Oe.height]);for(const st of we){const[,He,ht]=st;Te.activeTexture.set(ve.TEXTURE0+0),He.texture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE),Te.activeTexture.set(ve.TEXTURE0+1);const Nt=ht.particleTexture0;Nt.bind(ve.NEAREST,ve.CLAMP_TO_EDGE);const Ge=yg(1,Nt.size[0],0,He.texture.size,ge,Ce,Fe,He.textureOffset,He.scale,He.offset);Oe.colorAttachment.set(ht.particleTexture1.texture),Te.clear({color:o.ao.transparent}),he.getOrCreateProgram("rasterParticleUpdate",{defines:He.defines}).draw(he,ve.TRIANGLES,cr.disabled,Br.disabled,Qr.unblended,Dr.disabled,Ge,ce.id,he.viewportBuffer,he.quadTriangleIndexBuffer,he.viewportSegments)}}(S,A,se,ae)}(p,n,l,m),p.renderPass==="translucent"&&(function(S,C,A,M,D){const F=S.context,O=F.gl,q=C.getSource().tileSize,Z=5*(1-o.ah(o.cK,o.cK+1,S.transform.zoom))*q+A.paint.get("raster-particle-elevation"),Q=!S.options.moving,se=S.transform.projection.name==="globe";if(!M.length)return;const[ne,ae]=S.stencilConfigForOverlap(M),he=[];se&&he.push("PROJECTION_GLOBE_VIEW");const ce=S.stencilModeFor3D();for(const we of ae){const fe=we.toUnwrapped(),Te=C.getTile(we);if(!Te.rasterParticleState)continue;const ve=Te.rasterParticleState,ge=100;Te.registerFadeDuration(ge);const Ce=C.findLoadedParent(we,0),Fe=dg(Te,Ce,C,S.transform,ge);let Oe,st;S.terrain&&S.terrain.prepareDrawTile(),F.activeTexture.set(O.TEXTURE0),ve.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),F.activeTexture.set(O.TEXTURE1),Ce&&Ce.rasterParticleState?(Ce.rasterParticleState.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Oe=Math.pow(2,Ce.tileID.overscaledZ-Te.tileID.overscaledZ),st=[Te.tileID.canonical.x*Oe%1,Te.tileID.canonical.y*Oe%1]):ve.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const He=se?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(fe,Q),ht=S.transform,Nt=Wo(ht),Ge=o.dF(we.canonical),Re=o.dG(Ge.getCenter().lat);let ft,Ze,wt,Ft,sr;se?(ft=Float32Array.from(o.bj(o.dI(we.canonical))),Ze=Float32Array.from(ht.globeMatrix),wt=Float32Array.from(o.dE(ht)),Ft=[o.aF(ht.center.lng),o.aJ(ht.center.lat)],sr=Float32Array.from(o.dH(we.canonical,Ge,Re,ht.worldSize/ht._pixelsPerMercatorPixel))):(ft=new Float32Array(16),Ze=new Float32Array(9),wt=new Float32Array(16),Ft=[0,0],sr=new Float32Array(9));const Rt=mu(He,ft,Ze,wt,sr,st||[0,0],o.aj(S.transform.zoom),Ft,Nt,Oe||1,Fe,Z),Lt=S.isTileAffectedByFog(we),ar=S.getOrCreateProgram("rasterParticle",{defines:he,overrideFog:Lt});if(S.uploadCommonUniforms(F,ar,fe),se){const Jt=new cr(O.LEQUAL,cr.ReadOnly,S.depthRangeFor3D),Zt=0,Qt=S.globeSharedBuffers;if(Qt){const[Tr,pn,En]=Qt.getGridBuffers(Re,Zt!==0);ar.draw(S,O.TRIANGLES,Jt,ce,Qr.alphaBlended,S.renderElevatedRasterBackface?Dr.frontCCW:Dr.backCCW,Rt,A.id,Tr,pn,En)}}else{const Jt=S.depthModeForSublayer(0,cr.ReadOnly),Zt=ne[we.overscaledZ],{tileBoundsBuffer:Qt,tileBoundsIndexBuffer:Tr,tileBoundsSegments:pn}=S.getTileBoundsBuffers(Te);ar.draw(S,O.TRIANGLES,Jt,Zt,Qr.alphaBlended,Dr.disabled,Rt,A.id,Qt,Tr,pn)}}S.resetStencilClippingMasks()}(p,n,l,m),p.style.map.triggerRepaint())},background:function(p,n,l,m){const v=l.paint.get("background-color"),w=l.paint.get("background-color-use-theme").constantOr("default")==="none",S=l.paint.get("background-opacity"),C=l.paint.get("background-emissive-strength"),A=l.paint.get("background-pitch-alignment")==="viewport";if(S===0)return;const M=p.context,D=M.gl,F=p.transform,O=F.tileSize,q=l.paint.get("background-pattern");let Z;if(q!==void 0&&(q===null||(Z=p.imageManager.getPattern(o.I.from(q.toString()),l.scope,p.style.getLut(l.scope)),!Z)))return;const Q=!q&&v.a===1&&S===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==Q)return;const se=Br.disabled,ne=p.depthModeForSublayer(0,Q==="opaque"?cr.ReadWrite:cr.ReadOnly),ae=p.colorModeForDrapableLayerRenderPass(C),he=q?"backgroundPattern":"background";let ce,we=m;if(we||(ce=p.getBackgroundTiles(),we=Object.values(ce).map(fe=>fe.tileID)),q&&(M.activeTexture.set(D.TEXTURE0),p.imageManager.bind(p.context,l.scope)),A){const fe=p.getOrCreateProgram(he,{overrideFog:!1,overrideRtt:!0}),Te=new Float32Array(o.bz([])),ve=new o.aP(0,0,0,0,0),ge=q?xg(Te,C,S,p,0,l.scope,Z,A,{tileID:ve,tileSize:O}):vg(Te,C,S,v.toPremultipliedRenderColor(w?null:l.lut));fe.draw(p,D.TRIANGLES,ne,se,ae,Dr.disabled,ge,l.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments)}else for(const fe of we){const Te=p.isTileAffectedByFog(fe),ve=p.getOrCreateProgram(he,{overrideFog:Te}),ge=fe.toUnwrapped(),Ce=m?fe.projMatrix:p.transform.calculateProjMatrix(ge);p.prepareDrawTile();const Fe=n?n.getTile(fe):ce?ce[fe.key]:new Xl(fe,O,F.zoom,p),Oe=q?xg(Ce,C,S,p,0,l.scope,Z,A,{tileID:fe,tileSize:O}):vg(Ce,C,S,v.toPremultipliedRenderColor(w?null:l.lut));p.uploadCommonUniforms(M,ve,ge);const{tileBoundsBuffer:st,tileBoundsIndexBuffer:He,tileBoundsSegments:ht}=p.getTileBoundsBuffers(Fe);ve.draw(p,D.TRIANGLES,ne,se,ae,Dr.disabled,Oe,l.id,st,He,ht)}},sky:function(p,n,l){const m=p._atmosphere?o.aj(p.transform.zoom):1,v=l.paint.get("sky-opacity")*m;if(v===0)return;const w=p.context,S=l.paint.get("sky-type"),C=new cr(w.gl.LEQUAL,cr.ReadOnly,[0,1]),A=p.frameCounter/1e3%1;S==="atmosphere"?p.renderPass==="offscreen"?l.needsSkyboxCapture(p)&&(function(M,D,F,O){const q=M.context,Z=q.gl;let Q=D.skyboxFbo;if(!Q){Q=D.skyboxFbo=q.createFramebuffer(32,32,!0,null),D.skyboxGeometry=new zv(q),D.skyboxTexture=q.gl.createTexture(),Z.bindTexture(Z.TEXTURE_CUBE_MAP,D.skyboxTexture),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAG_FILTER,Z.LINEAR);for(let he=0;he<6;++he)Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,Z.RGBA,32,32,0,Z.RGBA,Z.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(Q.framebuffer),q.viewport.set([0,0,32,32]);const se=D.getCenter(M,!0),ne=M.getOrCreateProgram("skyboxCapture"),ae=new Float64Array(16);o.bz(ae),o.em(ae,ae,.5*-Math.PI),al(M,D,ne,ae,se,0),o.bz(ae),o.em(ae,ae,.5*Math.PI),al(M,D,ne,ae,se,1),o.bz(ae),o.cT(ae,ae,.5*-Math.PI),al(M,D,ne,ae,se,2),o.bz(ae),o.cT(ae,ae,.5*Math.PI),al(M,D,ne,ae,se,3),o.bz(ae),al(M,D,ne,ae,se,4),o.bz(ae),o.em(ae,ae,Math.PI),al(M,D,ne,ae,se,5),q.viewport.set([0,0,M.width,M.height])}(p,l),l.markSkyboxValid(p)):p.renderPass==="sky"&&function(M,D,F,O,q){const Z=M.context,Q=Z.gl,se=M.transform,ne=M.getOrCreateProgram("skybox");Z.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_CUBE_MAP,D.skyboxTexture);const ae=((he,ce,we,fe,Te)=>({u_matrix:he,u_sun_direction:ce,u_cubemap:0,u_opacity:fe,u_temporal_offset:Te}))(se.skyboxMatrix,D.getCenter(M,!1),0,O,q);M.uploadCommonUniforms(Z,ne),ne.draw(M,Q.TRIANGLES,F,Br.disabled,M.colorModeForRenderPass(),Dr.backCW,ae,"skybox",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)}(p,l,C,v,A):S==="gradient"&&p.renderPass==="sky"&&function(M,D,F,O,q){const Z=M.context,Q=Z.gl,se=M.transform,ne=M.getOrCreateProgram("skyboxGradient");D.skyboxGeometry||(D.skyboxGeometry=new zv(Z)),Z.activeTexture.set(Q.TEXTURE0);let ae=D.colorRampTexture;ae||(ae=D.colorRampTexture=new o.T(Z,D.colorRamp,Q.RGBA8)),ae.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const he=((ce,we,fe,Te,ve)=>({u_matrix:ce,u_color_ramp:0,u_center_direction:we,u_radius:o.an(fe),u_opacity:Te,u_temporal_offset:ve}))(se.skyboxMatrix,D.getCenter(M,!1),D.paint.get("sky-gradient-radius"),O,q);M.uploadCommonUniforms(Z,ne),ne.draw(M,Q.TRIANGLES,F,Br.disabled,M.colorModeForRenderPass(),Dr.backCW,he,"skyboxGradient",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)}(p,l,C,v,A)},custom:function(p,n,l,m){const v=p.context,w=l.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||p.renderPass==="offscreen")&&l.isDraped(n)){if(p.renderPass==="offscreen"){const S=w.prerender;if(S){if(p.setCustomLayerDefaults(),v.setColorMode(p.colorModeForRenderPass()),p.transform.projection.name==="globe"){const C=p.transform.pointMerc;S.call(w,v.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),o.aj(p.transform.zoom),[C.x,C.y],p.transform.pixelsPerMeterRatio)}else S.call(w,v.gl,p.transform.customLayerMatrix());v.setDirty(),p.setBaseState()}}else if(p.renderPass==="translucent"){if(p.terrain&&p.terrain.renderingToTexture){const C=w.renderToTile;if(C){const A=m[0].canonical,M={x:A.x+m[0].wrap*(w.wrapTileId?0:1<<A.z),y:A.y,z:A.z};v.setDepthMode(cr.disabled),v.setStencilMode(Br.disabled),v.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),C.call(w,v.gl,M),v.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),v.setColorMode(p.colorModeForRenderPass()),v.setStencilMode(Br.disabled);const S=w.renderingMode==="3d"?new cr(p.context.gl.LEQUAL,cr.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,cr.ReadOnly);if(v.setDepthMode(S),p.transform.projection.name==="globe"){const C=p.transform.pointMerc;w.render(v.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),o.aj(p.transform.zoom),[C.x,C.y],p.transform.pixelsPerMeterRatio)}else w.render(v.gl,p.transform.customLayerMatrix());v.setDirty(),p.setBaseState(),v.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(p,n,l,m){if(p.renderPass==="opaque")return;const v=l.paint.get("model-opacity").constantOr(1),w=l.paint.get("model-elevation-reference"),S=w==="ground",C=w==="ground";if(v===0)return;const A=l.paint.get("model-cast-shadows");if(p.renderPass==="shadow"&&(!A||p.terrain&&v<.65&&l._transitionablePaint._values["model-opacity"].value.expression instanceof o.ad))return;const M=p.shadowRenderer,D=l.paint.get("model-receive-shadows");M&&(M.useNormalOffset=!0,D||(M.enabled=!1));const F=()=>{M&&(M.useNormalOffset=!0,D||(M.enabled=!0))},O=n.getSource();if(p.renderPass==="light-beam"&&O.type!=="batched-model")return;if(O.type==="vector"||O.type==="geojson")return function(ce,we,fe,Te,ve){const ge=ce.transform,Ce=ge.projection.name==="globe",Fe=ge.getFreeCameraOptions().position;if(!ce.modelManager)return;const Oe=ce.modelManager;fe.modelManager=Oe;const st=ce.shadowRenderer;if(!fe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const He=fe._unevaluatedLayout._values["model-id"],ht=Object.assign({},fe.layout.get("model-id").parameters),Nt=ce.style.order.indexOf(fe.fqid);for(const Ge of Te){const Re=we.getTile(Ge).getBucket(fe);if(!Re||Re.projection.name!==ge.projection.name)continue;const ft=Re.getModelUris();if(ft&&!Re.modelsRequested&&(Oe.addModelsFromBucket(ft,ve),Re.modelsRequested=!0),Ce)ht.zoom=Ge.overscaledZ;else{const Jt=Bv(Ge,ge);ht.zoom=Jt}const Ze=He.possiblyEvaluate(ht);if(m1(ce,Re,Ge),ka.shadowUniformsInitialized=!1,ka.useSingleShadowCascade=!!st&&st.getMaxCascadeForTile(Ge.toUnwrapped())===0,ce.renderPass==="shadow"&&st){if(ce.currentShadowCascade===1&&Re.isInsideFirstShadowMapFrustum)continue;const Jt=ge.calculatePosMatrix(Ge.toUnwrapped(),ge.worldSize);if(ka.tileMatrix.set(Jt),ka.shadowTileMatrix=Float32Array.from(st.calculateShadowPassMatrixFromMatrix(Jt)),ka.aabb.min=[0,0,0],ka.aabb.max[0]=ka.aabb.max[1]=o.al,ka.aabb.max[2]=0,jg(Re,ka,ce,fe.scope))continue}const wt=1<<Ge.canonical.z,Ft=[((Fe.x-Ge.wrap)*wt-Ge.canonical.x)*o.al,(Fe.y*wt-Ge.canonical.y)*o.al,Fe.z*wt*o.al];ce.conflationActive&&Object.keys(Re.instancesPerModel).length>0&&ce.style.isLayerClipped(fe,we.getSource())&&Re.updateReplacement(Ge,ce.replacementSource,Nt,ve)&&(Re.uploaded=!1,Re.upload(ce.context));let sr=0;const Rt=new Array,Lt=new Array,ar=new Array;for(let Jt in Re.instancesPerModel){const Zt=Re.instancesPerModel[Jt];Zt.features.length>0&&!Ce&&(Jt=Ze.evaluate(Zt.features[0].feature,{}));const Qt=Oe.getModel(Jt,ve);if(Qt||Oe.hasURLBeenRequested(Jt)||Re.modelUris.includes(Jt)||(Re.modelUris.push(Jt),Re.modelsRequested=!1),Qt&&Qt.uploaded)if(Ce){const Tr=o.c4([],[Fe.x,Fe.y,Fe.z],ce.transform.worldSize);o.ev(Tr,Tr);for(let pn=0;pn<Zt.instancedDataArray.length;++pn){const En=[0,0,0],oi=[1,1,1],Nr=o.ew(),Sn=Zt.tileCoordinatesForInstance(pn),Xr=Zt.transformForInstance(pn);o.ex(oi,Xr),o.ey(Nr,Xr),o.ez(En,Nr);const ri=Zt.translationForInstance(pn),Cn=new o.aS(0,0);o.eA(Re.canonical,Cn,Sn.x,Sn.y);const mi=o.bB();o.eB(mi,Qt,ce.transform,Cn,En,oi,ri,!0,!1,!1);const Nn=Zt.colorForInstance(pn),Kr=o.bz([]),Wn=o.ee(Cn.lat,ce.transform.zoom),en=o.bp([],[1,1,1/Wn]);o.bq(Kr,Kr,Tr),ar.push({zScaleMatrix:en,negCameraPosMatrix:Kr});for(const Ti of Qt.nodes)kg(ce,Ti,mi,ce.transform.expandedFarZProjMatrix,sr,Rt,Lt,Qt.materialOverrides,Nn);++sr}}else for(const Tr of Qt.nodes)Vv(ce,fe,Tr,Zt,Ft,Ge,ka)}if(Ce)if(ce.renderPass==="shadow"){for(const Jt of Lt)Ch(Jt.mesh,Jt.nodeModelMatrix,ce,fe);for(const Jt of Rt)Ch(Jt.mesh,Jt.nodeModelMatrix,ce,fe)}else p1(ce,fe,1,Rt,Lt,ar)}}(p,n,l,m,Pg(O,l,p.style._importedAsBasemap)),void F();if(!O.loaded())return;if(O.type==="batched-model")return function(ce,we,fe,Te){fe.resetLayerRenderingStats(ce);const ve=ce.context,ge=ce.transform,Ce=ce.style.fog,Fe=ce.shadowRenderer;if(ge.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${ge.projection.name} projection is not yet implemented`);const Oe=ce.transform.getFreeCameraOptions().position,st=o.c4([],[Oe.x,Oe.y,Oe.z],ce.transform.worldSize),He=o.ev([],st),ht=o.bz([]),Nt=o.ee(ge.center.lat,ge.zoom),Ge=o.bp([],[1,1,1/Nt]);o.bq(ht,ht,He);const Re=fe.paint.get("model-opacity").constantOr(1),ft=new cr(ve.gl.LEQUAL,cr.ReadWrite,ce.depthRangeFor3D),Ze=new cr(ve.gl.LEQUAL,cr.ReadOnly,ce.depthRangeFor3D),wt=new o.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ft=ce.renderPass==="shadow",sr=Ft&&Fe?Fe.getCurrentCascadeFrustum():ge.getFrustum(ge.scaleZoom(ge.worldSize)),Rt=fe.paint.get("model-front-cutoff"),Lt=Rt[2]<1,ar=wc(ce,fe.paint.get("model-cutoff-fade-range")),Jt=fe.getLayerRenderingStats();(function(Zt,Qt,Tr,pn){const En=Zt.terrain?Zt.terrain.exaggeration():0,oi=Zt.transform.zoom;for(const Nr of pn){const Sn=Qt.getTile(Nr).getBucket(Tr);Sn&&(Sn.setFilter(Tr.filter),Zt.conflationActive&&Sn.updateReplacement(Nr,Zt.replacementSource),Sn.evaluateTransform(Zt,Tr),Zt.terrain&&En>0&&Sn.elevationUpdate(Zt.terrain,En,Nr,Tr.source),Sn.needsReEvaluation(Zt,oi,Tr)&&Sn.evaluate(Tr))}})(ce,we,fe,Te),function(){let Zt,Qt,Tr;Lt?(Zt=Te.length-1,Qt=-1,Tr=-1):(Zt=0,Qt=Te.length,Tr=1);const pn=new Float64Array(16),En=o.cz(),oi=new o.P(0,0);for(let Nr=Zt;Nr!==Qt;Nr+=Tr){const Sn=Te[Nr],Xr=we.getTile(Sn).getBucket(fe);if(!Xr||!Xr.uploaded)continue;let ri=!1;Fe&&(ri=Fe.getMaxCascadeForTile(Sn.toUnwrapped())===0);const Cn=ge.calculatePosMatrix(Sn.toUnwrapped(),ge.worldSize),mi=Xr.modelTraits;!Ft&&Lt&&(o.bk(pn,Cn),o.af(En,st,pn),oi.x=En[0],oi.y=En[1]);const Nn=[];Xr.setFilter(fe.filter);for(const Kr of Xr.getNodesInfo()){if(Kr.hiddenByReplacement||!Kr.node.meshes)continue;const Wn=Kr.node;let en=0;ce.terrain&&Wn.elevation&&(en=Wn.elevation*ce.terrain.exaggeration());const Ti=(()=>{const To=Kr.aabb;return wt.min=[...To.min],wt.max=[...To.max],wt.min[2]+=en,wt.max[2]+=en,o.af(wt.min,wt.min,Cn),o.af(wt.max,wt.max,Cn),wt})(),Kn=Kr.evaluatedScale;if(Kn[0]<=1&&Kn[1]<=1&&Kn[2]<=1&&Ti.intersects(sr)===0)continue;if(!Ft&&Lt){const To=.16666666666666666;Kr.cameraCollisionOpacity=st[0]>Ti.min[0]&&st[0]<Ti.max[0]&&st[1]>Ti.min[1]&&st[1]<Ti.max[1]&&st[2]*Nt<Ti.max[2]&&Wn.footprint&&o.b$(oi,Wn.footprint)?Math.max(Kr.cameraCollisionOpacity-To,0):Math.min(1,Kr.cameraCollisionOpacity+To)}const zr=[...Cn],In=1/o.d6(Sn.canonical),Oi=Wn.anchor?Wn.anchor[0]:0,is=Wn.anchor?Wn.anchor[1]:0;o.bq(zr,zr,[Oi*(Kn[0]-1)+Kr.evaluatedTranslation[0]*In,is*(Kn[1]-1)+Kr.evaluatedTranslation[1]*In,en+Kr.evaluatedTranslation[2]]),o.cp(Kn,o.eD)||o.cR(zr,zr,Kn);const Ui=o.aB([],zr,Wn.globalMatrix),Yi=o.aB([],ge.expandedFarZProjMatrix,Ui),ra=o.aB([],ge.expandedFarZProjMatrix,zr),Ho=o.aC([],[Oi,is,en,1],Yi)[2];Wn.hidden=!1;let mo=Re;Ft||(Lt&&(mo*=Kr.cameraCollisionOpacity,mo*=fd(zr,ge,Kr.aabb,Rt)),mo*=jp(ar,Ho)),mo!==0?Nn.push({nodeInfo:Kr,depth:Ho,opacity:mo,wvpForNode:Yi,wvpForTile:ra,nodeModelMatrix:Ui,tileModelMatrix:zr}):Wn.hidden=!0}Ft||Nn.sort((Kr,Wn)=>!Lt||Kr.opacity===1&&Wn.opacity===1?Kr.depth<Wn.depth?-1:1:Kr.opacity===1?-1:Wn.opacity===1?1:Kr.depth>Wn.depth?-1:1);for(const Kr of Nn){const Wn=Kr.nodeInfo,en=Wn.node;let Ti=o.aB([],Ge,Kr.tileModelMatrix);o.aB(Ti,ht,Ti);const Kn=o.bk([],Ti);o.ef(Kn,Kn),o.cR(Kn,Kn,g1),Ti=o.aB(Ti,Ti,en.globalMatrix);const zr=ce.renderPass==="light-beam",In=fe.paint.get("model-color-use-theme").constantOr("default")==="none",Oi=mi&o.eH.HasMapboxMeshFeatures,is=Oi?0:Wn.evaluatedRMEA[0][2];for(let Ui=0;Ui<en.meshes.length;++Ui){const Yi=en.meshes[Ui],ra=Ui===en.lightMeshIndex;let Ho=Kr.wvpForNode;if(ra){if(!zr&&!ce.terrain&&ce.shadowRenderer){ce.currentLayer<ce.firstLightBeamLayer&&(ce.firstLightBeamLayer=ce.currentLayer);continue}Ho=Kr.wvpForTile}else if(zr)continue;const mo={defines:[]},To=[];if(!Ft&&Fe&&(Fe.useNormalOffset=!!Yi.normalBuffer),Th(mo.defines,To,Yi,ce,In?null:fe.lut),Oi||mo.defines.push("DIFFUSE_SHADED"),ri&&mo.defines.push("SHADOWS_SINGLE_CASCADE"),Jt&&(Ft?Jt.numRenderedVerticesInShadowPass+=Yi.vertexArray.length:Jt.numRenderedVerticesInTransparentPass+=Yi.vertexArray.length),Ft){Ch(Yi,Kr.nodeModelMatrix,ce,fe);continue}let Ra=null;if(Ce){const ss=Fv(Kr.nodeModelMatrix,ce.transform);if(Ra=new Float32Array(ss),ge.projection.name!=="globe"){const pi=Yi.aabb.min,ds=Yi.aabb.max,[$s,Hi]=Ce.getOpacityForBounds(ss,pi[0],pi[1],ds[0],ds[1]);mo.overrideFog=$s>=Xe||Hi>=Xe}}const go=Yi.material;let Ma;go.occlusionTexture&&go.occlusionTexture.offsetScale&&(Ma=go.occlusionTexture.offsetScale,mo.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const ul=ce.getOrCreateProgram("model",mo);!Ft&&Fe&&Fe.setupShadowsFromMatrix(Kr.tileModelMatrix,ul,Fe.useNormalOffset),ce.uploadCommonUniforms(ve,ul,null,Ra);const Us=go.pbrMetallicRoughness;Us.metallicFactor=.9,Us.roughnessFactor=.5;const Wi=bg(new Float32Array(Ho),new Float32Array(Ti),new Float32Array(Kn),new Float32Array(en.globalMatrix),ce,Kr.opacity,Us.baseColorFactor,go.emissiveFactor,Us.metallicFactor,Us.roughnessFactor,go,is,fe,[0,0,0],Ma);!ra&&(Wn.hasTranslucentParts||Kr.opacity<1)&&ul.draw(ce,ve.gl.TRIANGLES,ft,Br.disabled,Qr.disabled,Dr.backCCW,Wi,fe.id,Yi.vertexBuffer,Yi.indexBuffer,Yi.segments,fe.paint,ce.transform.zoom,void 0,To),ul.draw(ce,ve.gl.TRIANGLES,ra?Ze:ft,Br.disabled,ra||Kr.opacity<1||Wn.hasTranslucentParts?Qr.alphaBlended:Qr.unblended,Dr.backCCW,Wi,fe.id,Yi.vertexBuffer,Yi.indexBuffer,Yi.segments,fe.paint,ce.transform.zoom,void 0,To)}}}}()}(p,n,l,m),void F();if(O.type!=="model")return;const q=O.getModels(),Z=[],Q=p.transform.getFreeCameraOptions().position,se=o.c4([],[Q.x,Q.y,Q.z],p.transform.worldSize);o.ev(se,se);const ne=[],ae=[];let he=0;for(const ce of q){const we=n.getFeatureState("",ce.id),fe={type:"Unknown",id:ce.id,properties:ce.featureProperties},Te=l.paint.get("model-rotation").evaluate(fe,we),ve=l.paint.get("model-scale").evaluate(fe,we),ge=l.paint.get("model-translation").evaluate(fe,we);Ah(l,ce.id,we,ce.featureProperties,ce.nodeOverrideNames,ce.nodeOverrides),Z2(l,ce.id,we,ce.featureProperties,ce.materialOverrideNames,ce.materialOverrides),ce.nodeOverrides.size>0&&ce.computeBoundsAndApplyParent(),ce.computeModelMatrix(p,Te,ve,ge,C,S,!1);const Ce=o.bz([]),Fe=o.ee(ce.position.lat,p.transform.zoom),Oe=o.bp([],[1,1,1/Fe]);o.bq(Ce,Ce,se),Z.push({zScaleMatrix:Oe,negCameraPosMatrix:Ce});for(const st of ce.nodes)kg(p,st,ce.matrix,p.transform.expandedFarZProjMatrix,he,ne,ae,ce.materialOverrides);he++}if(ne.sort((ce,we)=>we.depth-ce.depth),p.renderPass!=="shadow")p1(p,l,v,ne,ae,Z),F();else{for(const ce of ae)Ch(ce.mesh,ce.nodeModelMatrix,p,l);for(const ce of ne)Ch(ce.mesh,ce.nodeModelMatrix,p,l);F()}}},Rg={line:function(p,n,l){if(p.hasElevatedBuckets=!1,p.hasNonElevatedBuckets=!1,p._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||p._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(n){const m=n.getVisibleCoordinates();for(const v of m){const w=n.getTile(v).getBucket(p);if(w&&(w.elevationType!=="none"?p.hasElevatedBuckets=!0:p.hasNonElevatedBuckets=!0,p.hasElevatedBuckets&&p.hasNonElevatedBuckets))break}}}else p.hasNonElevatedBuckets=!0},model:function(p,n,l){const m=n.getSource();if(!m.loaded())return;if(m.type==="vector"||m.type==="geojson"){const w=Pg(m,p,l.style._importedAsBasemap);return void(l.modelManager&&l.modelManager.upload(l,w))}if(m.type==="batched-model"||m.type!=="model")return;const v=m.getModels();for(const w of v)w.upload(l.context)},raster:function(p,n,l){const m=n.getSource();if(!(m instanceof Ls&&m.loaded()))return;const v=p.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!v)return;const w=p.paint.get("raster-array-band")||m.getInitialBand(v);if(w==null)return;const S=n.getIds().map(C=>n.getTileByID(C));for(const C of S)C.updateNeeded(p.id,w)&&m.prepareTile(C,v,p.id,w)},"raster-particle":function(p,n,l){const m=n.getSource();if(!(m instanceof Ls&&m.loaded()))return;const v=p.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!v)return;const w=p.paint.get("raster-particle-array-band")||m.getInitialBand(v);if(w==null)return;const S=n.getIds().map(C=>n.getTileByID(C));for(const C of S)C.updateNeeded(p.id,w)&&m.prepareTile(C,v,p.id,w)}},Mg={fill:dd},ja={fill:function(p,n,l,m){if(!l.layout||l.layout.get("fill-elevation-reference")==="none"||l.paint.get("fill-opacity").constantOr(1)===0)return;const v=p.context.gl,w=new cr(v.LEQUAL,cr.ReadOnly,p.depthRangeFor3D),S=new Br({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),C=p.transform.getFreeCameraOptions().position,A=p.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const M of m){const D=n.getTile(M),F=D.getBucket(l);if(!F)continue;const O=F.elevatedStructures;if(!O||O.depthSegments.segments[0].primitiveLength===0)continue;const q=l1(M.toUnwrapped(),C),Z=p.translatePosMatrix(M.projMatrix,D,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor")),Q=mg(Z,q,0,1,0);A.draw(p,v.TRIANGLES,w,S,Qr.disabled,Dr.disabled,Q,l.id,O.vertexBuffer,O.indexBuffer,O.depthSegments,l.paint,p.transform.zoom)}}};class bu{constructor(n,l,m,v,w,S){this.context=new Sg(n,l),this.transform=m,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=w,this._timeStamp=o.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const C=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const M of C)this._debugParams.enabledLayers[M]=!0;w.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),w.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),w.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),w.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const M of C)w.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],M);this.occlusionParams=new X2(w),this.setup(),this.numSublayers=tl.maxUnderzooming+tl.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.eO,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new gp(this),this._wireframeDebugCache=new y1,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const A=new o.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,A,n.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=v,this.worldview=S}updateTerrain(n,l){const m=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ep(this,n));const v=this._terrain;this.transform.elevation=m?v:null,v.update(n,this.transform,l),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(n){const l=n.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,v]=l.getFovAdjustedRange(this.transform._fov);if(m>v)return void(this.transform.fogCullDistSq=null);const w=m+.78*(v-m);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(n){n&&!this._terrain&&(this._terrain=new Ep(this,this.style)),this._forceTerrainMode=n}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,l){if(this.width=n*o.o.devicePixelRatio,this.height=l*o.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._mergedLayers[m].resize()}setup(){const n=this.context,l=new o.bc;l.emplaceBack(0,0),l.emplaceBack(o.al,0),l.emplaceBack(0,o.al),l.emplaceBack(o.al,o.al),this.tileExtentBuffer=n.createVertexBuffer(l,o.be.members),this.tileExtentSegments=o.bf.simpleSegment(0,0,4,2);const m=new o.bc;m.emplaceBack(0,0),m.emplaceBack(o.al,0),m.emplaceBack(0,o.al),m.emplaceBack(o.al,o.al),this.debugBuffer=n.createVertexBuffer(m,o.be.members),this.debugSegments=o.bf.simpleSegment(0,0,4,5);const v=new o.bc;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(v,o.be.members),this.viewportSegments=o.bf.simpleSegment(0,0,4,2);const w=new o.a$;w.emplaceBack(0,0,0,0),w.emplaceBack(o.al,0,o.al,0),w.emplaceBack(0,o.al,0,o.al),w.emplaceBack(o.al,o.al,o.al,o.al),this.mercatorBoundsBuffer=n.createVertexBuffer(w,o.bh.members),this.mercatorBoundsSegments=o.bf.simpleSegment(0,0,4,2);const S=new o.b0;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(S);const C=new o.bd;for(const M of[0,1,3,2,0])C.emplaceBack(M);this.debugIndexBuffer=n.createIndexBuffer(C),this.emptyTexture=new o.T(n,new o.q({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA8),this.identityMat=o.bB();const A=this.context.gl;this.stencilClearMode=new Br({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,cr.disabled,this.stencilClearMode,Qr.disabled,Dr.disabled,cd(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,l,m){if(!l||this.currentStencilSource===l.id||!n.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const A of m)if(this._tileClippingMaskIDs[A.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=l.id;const v=this.context,w=v.gl;this.nextStencilID+m.length>256&&this.clearStencil(),v.setColorMode(Qr.disabled),v.setDepthMode(cr.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of m){const A=l.getTile(C),M=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:D,tileBoundsIndexBuffer:F,tileBoundsSegments:O}=this.getTileBoundsBuffers(A);S.draw(this,w.TRIANGLES,cr.disabled,new Br({func:w.ALWAYS,mask:0},M,255,w.KEEP,w.KEEP,w.REPLACE),Qr.disabled,Dr.disabled,cd(C.projMatrix),"$clipping",D,F,O)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,l=this.context.gl;return new Br({func:l.NOTEQUAL,mask:255},n,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const l=this.context.gl;return new Br({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(n){const l=this.context.gl,m=n.sort((S,C)=>C.overscaledZ-S.overscaledZ),v=m[m.length-1].overscaledZ,w=m[0].overscaledZ-v+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const S={};for(let C=0;C<w;C++)S[C+v]=new Br({func:l.GEQUAL,mask:255},C+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=w,[S,m]}return[{[v]:Br.disabled},m]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new Qr([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new o.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Qr.unblended:Qr.alphaBlended}colorModeForDrapableLayerRenderPass(n){const l=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Qr([l.ONE,l.ONE_MINUS_SRC_ALPHA,l.CONSTANT_ALPHA,l.ONE_MINUS_SRC_ALPHA],new o.ao(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,l,m,v=!1){if(this.depthOcclusion)return new cr(this.context.gl.GREATER,cr.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return cr.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new cr(m||this.context.gl.LEQUAL,l,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const n=this.context.gl,l=Math.ceil(this.width),m=Math.ceil(this.height),v=this.context.bindFramebuffer.get(),w=n.getParameter(n.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===l&&this.depthFBO.height===m||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),l!==0&&m!==0&&(this.depthFBO=new wg(this.context,l,m,!1,"texture"),this.depthTexture=new o.T(this.context,{width:l,height:m,data:null},n.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(v),n.bindTexture(n.TEXTURE_2D,w),this.depthFBO&&(n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),n.blitFramebuffer(0,0,l,m,0,0,l,m,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((n,l)=>n+l/this._fpsHistory.length,0))}render(n,l){const m=o.o.now();this._dt=m-this._timeStamp,this._timeStamp=m,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=l;const v=this.style._mergedLayers,w=!(!this.terrain||!this.terrain.enabled),S=()=>this.style._getOrder(w).filter(Ge=>{const Re=v[Ge];return!(Re.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Re.type]});let C=S(),A=!1,M=!1,D=null;for(const Ge of C){const Re=v[Ge];Re.type==="circle"?A=!0:Re.type==="building"?D=Re:Re.type==="symbol"&&(Re.hasOcclusionOpacityProperties?M=!0:A=!0)}let F=C.map(Ge=>v[Ge]);const O=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(o.o.now()),this.imageManager.beginFrame();let q=0,Z=!1;for(const Ge in O){const Re=O[Ge];Re.used&&(Re.prepare(this.context),Re.getSource().usedInConflation&&++q)}let Q=!1;for(const Ge of F)Ge.isHidden(this.transform.zoom)||(Ge.type==="clip"&&(Q=!0),this.prepareLayer(Ge));const se={},ne={},ae={},he={},ce={};for(const Ge in O){const Re=O[Ge];se[Ge]=Re.getVisibleCoordinates(),ne[Ge]=se[Ge].slice().reverse(),ae[Ge]=Re.getVisibleCoordinates(!0).reverse(),he[Ge]=Re.getShadowCasterCoordinates(),ce[Ge]=Re.sortCoordinatesByDistance(se[Ge])}const we=Ge=>{const Re=this.style.getLayerSourceCache(Ge);return Re&&Re.used?Re.getSource():null};if(q||Q||this._clippingActiveLastFrame){const Ge=[],Re=[];let ft=0;for(const Ze of F)this.isSourceForClippingOrConflation(Ze,we(Ze))&&(Ge.push(Ze),Re.push(ft)),ft++;if(Ge&&(Q||Ge.length>1)||this._clippingActiveLastFrame){Q=!1;const Ze=[];for(let wt=0;wt<Ge.length;wt++){const Ft=Ge[wt],sr=Re[wt],Rt=this.style.getLayerSourceCache(Ft);if(!Rt||!Rt.used||!Rt.getSource().usedInConflation&&Ft.type!=="clip"&&Ft.type!=="building")continue;let Lt=o.eP,ar=o.bZ.None;const Jt=[];let Zt=!0;if(Ft.type==="building")Lt=o.eR;else if(Ft.type==="clip"){Lt=sr;for(const Qt of Ft.layout.get("clip-layer-types"))ar|=Qt==="model"?o.bZ.Model:Qt==="symbol"?o.bZ.Symbol:o.bZ.FillExtrusion;for(const Qt of Ft.layout.get("clip-layer-scope"))Jt.push(Qt);Ft.isHidden(this.transform.zoom)?Zt=!1:Q=!0}Zt&&Ze.push({layer:Ft.fqid,cache:Rt,order:Lt,clipMask:ar,clipScope:Jt})}this.replacementSource.setSources(Ze),Z=!0}}this._clippingActiveLastFrame=Q,Z||this.replacementSource.clear(),this.conflationActive=Z,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ge=0;Ge<F.length;Ge++){const Re=F[Ge],ft=Re.cutoffRange();if(this.longestCutoffRange=Math.max(ft,this.longestCutoffRange),ft>0){const Ze=we(Re);Ze&&(this.minCutoffZoom=Math.max(Ze.minzoom,this.minCutoffZoom)),Re.minzoom&&(this.minCutoffZoom=Math.max(Re.minzoom,this.minCutoffZoom))}Re.is3D(w)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ge),this._lastOcclusionLayer=Ge)}const fe=this.style&&this.style.fog;fe?(this._fogVisible=fe.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=fe.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ae),this.opaquePassCutoff=0,C=S(),F=C.map(Ge=>v[Ge]));const Te=this._shadowRenderer;if(Te){Te.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ge in O)for(const Re of se[Ge]){let ft={min:0,max:0};this.terrain&&(ft=this.terrain.getMinMaxForTile(Re)||ft),Te.addShadowReceiver(Re.toUnwrapped(),ft.min,ft.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.eQ(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ki(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ve=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ge=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ve&&!this._snow&&(this._snow=new $v(this)),!ve&&this._snow&&(this._snow.destroy(),delete this._snow),ge&&!this._rain&&(this._rain=new Ih(this)),!ge&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),D){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Ve);const Ge=this.style.getLayerSourceCache(D);this.buildingTileBorderManager.updateBorders(Ge,D)}if(!yn.has(this.context.gl))return;this.renderPass="offscreen";for(const Ge of F){const Re=n.getLayerSourceCache(Ge);if(!Ge.hasOffscreenPass()||Ge.isHidden(this.transform.zoom))continue;const ft=Re?ne[Re.id]:void 0;(Ge.type==="custom"||Ge.type==="raster"||Ge.type==="raster-particle"||Ge.isSky()||ft&&ft.length)&&this.renderLayer(this,Re,Ge,ft)}this.depthRangeFor3D=[0,1-(F.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,he)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ce=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Fe=(()=>{if(l.showOverdrawInspector)return o.ao.black;const Ge=this.style.fog;if(Ge&&this.transform.projection.supportsFog){const Re=this.style.getLut(Ge.scope);if(!Ce){const ft=Ge.properties.get("color-use-theme")==="none",Ze=Ge.properties.get("color").toNonPremultipliedRenderColor(ft?null:Re).toArray01();return new o.ao(...Ze)}if(Ce){const ft=Ge.properties.get("space-color-use-theme")==="none",Ze=Ge.properties.get("space-color").toNonPremultipliedRenderColor(ft?null:Re).toArray01();return new o.ao(...Ze)}}return o.ao.transparent})();if(this.context.clear({color:Fe,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ce&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=C.length-1;this.currentLayer>=0;this.currentLayer--){const Ge=F[this.currentLayer],Re=n.getLayerSourceCache(Ge);if(Ge.isSky())continue;const ft=Re?(Ge.is3D(w)?ce:ne)[Re.id]:void 0;this._renderTileClippingMasks(Ge,Re,ft),this.renderLayer(this,Re,Ge,ft)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ce&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){const Ge=F[this.currentLayer],Re=n.getLayerSourceCache(Ge);Ge.isSky()&&this.renderLayer(this,Re,Ge,Re?ne[Re.id]:void 0)}function Oe(Ge,Re){let ft;return Re&&(ft=(Ge.type==="symbol"?ae:Ge.is3D(w)?ce:ne)[Re.id]),ft}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<C.length;){const Ge=F[this.currentLayer];if(Ge.type==="raster"||Ge.type==="raster-particle"){const Re=n.getLayerSourceCache(Ge);this.renderLayer(this,Re,Ge,Oe(Ge,Re))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let st=0;Te&&(st=Te.getShadowCastingLayerCount());let He=!1,ht=-1;for(let Ge=0;Ge<C.length;++Ge){const Re=F[Ge];Re.isHidden(this.transform.zoom)||Re.is3D(w)&&(ht=Ge)}M&&ht===-1&&(A=!0);let Nt=!1;for(;this.currentLayer<C.length;){const Ge=F[this.currentLayer],Re=n.getLayerSourceCache(Ge);if(Ge.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ge)){if(Ge.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Nt&&Ge.is3D(w)&&!w){const ft=this.currentLayer,Ze=wt=>{for(this.currentLayer=0;this.currentLayer<F.length;this.currentLayer++){const Ft=F[this.currentLayer];if(Mg[Ft.type]){const sr=this.style.getLayerSourceCache(Ft);Mg[Ft.type](this,sr,Ft,Oe(Ft,sr),wt)}}};Ze("initialize"),Ze("reset"),this.currentLayer=ft,Nt=!0}if(A&&!He&&this.terrain&&!this.transform.isOrthographic&&(He=!0,this.blitDepth()),M&&ht!==-1&&this.currentLayer===ht+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ge,Re,Re?se[Re.id]:void 0),this.renderLayer(this,Re,Ge,Oe(Ge,Re)),!this.terrain&&Te&&st>0&&Ge.hasShadowPass()&&--st==0){{this.clearStencil(),this.resetStencilClippingMasks();const ft=this.currentLayer;for(this.currentLayer=0;this.currentLayer<F.length;this.currentLayer++){const Ze=F[this.currentLayer];if(ja[Ze.type]){const wt=this.style.getLayerSourceCache(Ze);ja[Ze.type](this,wt,Ze,Oe(Ze,wt))}}this.currentLayer=ft}if(Te.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const ft=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ft;this.currentLayer++){const Ze=F[this.currentLayer];if(!Ze.hasLightBeamPass())continue;const wt=n.getLayerSourceCache(Ze);this.renderLayer(this,wt,Ze,wt?ne[wt.id]:void 0)}this.currentLayer=ft,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const ft=this.currentLayer;this.depthOcclusion=!0;for(const Ze of this.layersWithOcclusionOpacity){this.currentLayer=Ze;const wt=F[this.currentLayer],Ft=n.getLayerSourceCache(wt),sr=Ft?ne[Ft.id]:void 0;this.terrain||this._renderTileClippingMasks(wt,Ft,Ft?se[Ft.id]:void 0),this.renderLayer(this,Ft,wt,sr)}this.depthOcclusion=!1,this.currentLayer=ft,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ge=null;F.forEach(Re=>{const ft=n.getLayerSourceCache(Re);ft&&!Re.isHidden(this.transform.zoom)&&ft.getVisibleCoordinates().length&&(!Ge||Ge.getSource().maxzoom<ft.getSource().maxzoom)&&(Ge=ft)}),Ge&&this.options.showTileBoundaries&&Lv(this,Ge,Ge.getVisibleCoordinates(),o.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Lv(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ge){const Re=Ge.transform.padding;wi(Ge,Ge.transform.height-(Re.top||0),3,xu),wi(Ge,Re.bottom||0,3,d1),kp(Ge,Re.left||0,3,Dv),kp(Ge,Ge.transform.width-(Re.right||0),3,Nv);const ft=Ge.transform.centerPoint;(function(Ze,wt,Ft,sr){wh(Ze,wt-1,Ft-10,2,20,sr),wh(Ze,wt-10,Ft-1,20,2,sr)})(Ge,ft.x,Ge.transform.height-ft.y,Ov)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Z||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:l}=this.transform.projection,m=!l||!l.includes(n.type);if(Rg[n.type]&&(m||this.terrain&&n.type==="custom")){const v=this.style.getLayerSourceCache(n);Rg[n.type](n,v,this)}this.gpuTimingEnd()}renderLayer(n,l,m,v){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||m.type==="model"||m.type==="raster"||m.type==="raster-particle"||v&&v.length)&&(this.id=m.id,this.gpuTimingStart(m),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(m.type)&&(!n.terrain||m.type!=="custom")||m.type==="clip"||qv[m.type](n,l,m,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery,m=this.context.gl;let v=this.gpuTimers[n.id];v||(v=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:m.createQuery()}),v.calls++,m.beginQuery(l.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,l=this.context.gl,m=l.createQuery();this.deferredRenderGpuTimeQueries.push(m),l.beginQuery(n.TIME_ELAPSED_EXT,m)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const l={};for(const m in n){const v=n[m],w=this.context.extTimerQuery,S=w.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(v.query),l[m]=S}return l}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.gl;let m=0;for(const v of n)m+=l.getQueryParameter(v,l.QUERY_RESULT)/1e6,l.deleteQuery(v);return m}translatePosMatrix(n,l,m,v,w){if(!m[0]&&!m[1])return n;const S=w?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(S){const M=Math.sin(S),D=Math.cos(S);m=[m[0]*D-m[1]*M,m[0]*M+m[1]*D]}const C=[w?m[0]:o.ay(l,m[0],this.transform.zoom),w?m[1]:o.ay(l,m[1],this.transform.zoom),0],A=new Float32Array(16);return o.bq(A,n,C),A}saveTileTexture(n){if(n.context!==this.context)return;const l=n.size[0],m=this._tileTextures[l];m?m.push(n):this._tileTextures[l]=[n]}getTileTexture(n){const l=this._tileTextures[n];return l&&l.length>0?l.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,l,m){const v=m===void 0?this.terrain&&this.terrain.renderingToTexture:m,w=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(w.push("LIGHTING_3D_MODE"),w.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||w.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||w.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(w.push("TERRAIN"),this.linearFloatFilteringSupported()&&w.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&w.push("GLOBE"),!this._fogVisible||v||l!==void 0&&!l||w.push("FOG","FOG_DITHERING"),v&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}getOrCreateProgram(n,l){this.cache=this.cache||{};const m=l&&l.defines||[],v=l&&l.config,w=this.currentGlobalDefines(n,l&&l.overrideFog,l&&l.overrideRtt).concat(m),S=Cp.cacheKey(tg[n],n,w,v);return this.cache[S]||(this.cache[S]=new Cp(this.context,n,tg[n],v,q2[n],w)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,l){if(this.style.enable3dLights()){const m=this.style.directionalLight,v=this.style.ambientLight;if(m&&v){const w=((S,C,A)=>{const M=S.properties.get("direction"),D=S.properties.get("color-use-theme")==="none",F=S.properties.get("color").toNonPremultipliedRenderColor(D?null:A.getLut(S.scope)).toArray01(),O=S.properties.get("intensity"),q=C.properties.get("color-use-theme")==="none",Z=C.properties.get("color").toNonPremultipliedRenderColor(q?null:A.getLut(C.scope)).toArray01(),Q=C.properties.get("intensity"),se=[M.x,M.y,M.z],ne=o.dM(Z,Q),ae=o.dM(F,O);return{u_lighting_ambient_color:ne,u_lighting_directional_dir:se,u_lighting_directional_color:ae,u_ground_radiance:yv(se,ae,ne)}})(m,v,this.style);l.setLightsUniformValues(n,w)}}}uploadCommonUniforms(n,l,m,v,w){if(this.uploadCommonLightUniforms(n,l),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const C=S.getOpacity(this.transform.pitch),A=((M,D,F,O,q,Z,Q,se,ne,ae,he,ce)=>{const we=M.transform,fe=D.properties.get("color-use-theme")==="none",Te=D.properties.get("color").toNonPremultipliedRenderColor(fe?null:M.style.getLut(D.scope)).toArray01();Te[3]=O;const ve=M.frameCounter/1e3%1,[ge,Ce]=D.properties.get("vertical-range");return{u_fog_matrix:F?we.calculateFogTileMatrix(F):ce||M.identityMat,u_fog_range:D.getFovAdjustedRange(we._fov),u_fog_color:Te,u_fog_horizon_blend:D.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ge,Ce),Ce],u_fog_temporal_offset:ve,u_frustum_tl:q,u_frustum_tr:Z,u_frustum_br:Q,u_frustum_bl:se,u_globe_pos:ne,u_globe_radius:ae,u_viewport:he,u_globe_transition:o.aj(we.zoom),u_is_globe:+(we.projection.name==="globe")}})(this,S,m,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.o.devicePixelRatio,this.transform.height*o.o.devicePixelRatio],v);l.setFogUniformValues(n,A)}w&&l.setCutoffUniformValues(n,w.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,l=n.createTexture();return n.bindTexture(n.TEXTURE_2D,l),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,l=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const v of m)l[v.key]=n[v.key]||new Xl(v,512,this.transform.tileZoom,this,void 0,this.worldview);return l}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(n,l){return!(!n.is3D(!(!this.terrain||!this.terrain.enabled))||n.type!=="clip"&&n.type!=="building"&&(n.minzoom&&n.minzoom>this.transform.zoom||(this.style._clipLayerPresent||n.sourceLayer!=="building"&&n.sourceLayer!=="procedural_buildings")&&(!l||l.type!=="batched-model")))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let l=this._cachedTileFogOpacities[n.key];return l||(this._cachedTileFogOpacities[n.key]=l=this.style.fog.getOpacityForTile(n)),l[0]>=Xe||l[1]>=Xe}setupDepthForOcclusion(n,l,m){const v=this.context,w=v.gl,S=!!m;var C;m||(m={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),v.activeTexture.set(w.TEXTURE3),n&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),m.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],m.u_depth_range_unpack=[2/((C=this.depthRangeFor3D)[1]-C[0]),-1-2*C[0]/(C[1]-C[0])],m.u_occluder_half_size=.5*this.occlusionParams.occluderSize,m.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),v.activeTexture.set(w.TEXTURE0),S||l.setTerrainUniformValues(v,m)}}function md(p,n){let l=!1,m=null;const v=()=>{m=null,l&&(p(),m=setTimeout(v,n),l=!1)};return()=>(l=!0,m||v(),m)}class Dg{constructor(n){this._hashName=n&&encodeURIComponent(n),o.aX(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=md(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const l=Ng(n);if(this._hashName){const m=this._hashName;let v=!1;const w=location.hash.slice(1).split("&").map(S=>{const C=S.split("=")[0];return C===m?(v=!0,`${C}=${l}`):S}).filter(S=>S);return v||w.push(`${m}=${l}`),`#${w.join("&")}`}return`#${l}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let l;return n.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(l=m)}),(l&&l[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(m=>isNaN(Number(m)))){const m=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(l[3]||0):n.getBearing();return n.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:m,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Ng(p,n){const l=p.getCenter(),m=Math.round(100*p.getZoom())/100,v=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,v),S=Math.round(l.lng*w)/w,C=Math.round(l.lat*w)/w,A=p.getBearing(),M=p.getPitch();let D=n?`/${S}/${C}/${m}`:`${m}/${C}/${S}`;return(A||M)&&(D+="/"+Math.round(10*A)/10),M&&(D+=`/${Math.round(M)}`),D}const Ph={linearity:.3,easing:o.eS(0,0,.3,1)},wu=Object.assign({deceleration:2500,maxSpeed:1400},Ph),Gv=Object.assign({deceleration:20,maxSpeed:1400},Ph),ll=Object.assign({deceleration:1e3,maxSpeed:360},Ph),Wv=Object.assign({deceleration:1e3,maxSpeed:90},Ph);class Og{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.o.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,l=o.o.now();for(;n.length>0&&l-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const l={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)l.zoom+=w.zoomDelta||0,l.bearing+=w.bearingDelta||0,l.pitch+=w.pitchDelta||0,w.panDelta&&l.pan._add(w.panDelta),w.around&&(l.around=w.around),w.pinchAround&&(l.pinchAround=w.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(l.pan.mag()){const w=jh(l.pan.mag(),m,Object.assign({},wu,n||{}));v.offset=l.pan.mult(w.amount/l.pan.mag()),v.center=this._map.transform.center,kh(v,w)}if(l.zoom){const w=jh(l.zoom,m,Gv);v.zoom=this._map.transform.zoom+w.amount,kh(v,w)}if(l.bearing){const w=jh(l.bearing,m,ll);v.bearing=this._map.transform.bearing+o.aA(w.amount,-179,179),kh(v,w)}if(l.pitch){const w=jh(l.pitch,m,Wv);v.pitch=this._map.transform.pitch+w.amount,kh(v,w)}if(v.zoom||v.bearing){const w=l.pinchAround===void 0?l.around:l.pinchAround;v.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function kh(p,n){(!p.duration||p.duration<n.duration)&&(p.duration=n.duration,p.easing=n.easing)}function jh(p,n,l){const{maxSpeed:m,linearity:v,deceleration:w}=l,S=o.aA(p*v/(n/1e3),-m,m),C=Math.abs(S)/(w*v);return{easing:l.easing,duration:1e3*C,amount:S*(C/2)}}class Mi extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,m,v={}){const w=lt(l.getCanvasContainer(),m),S=l.unproject(w);super(n,Object.assign({point:w,lngLat:S,originalEvent:m},v)),this._defaultPrevented=!1,this.target=l}}class Rh extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,m){const v=n==="touchend"?m.changedTouches:m.touches,w=Pt(l.getCanvasContainer(),v),S=w.map(A=>l.unproject(A)),C=w.reduce((A,M,D,F)=>A.add(M.div(F.length)),new o.P(0,0));super(n,{points:w,point:C,lngLats:S,lngLat:l.unproject(C),originalEvent:m}),this._defaultPrevented=!1}}class Hv extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l){super("wheel",{originalEvent:l}),this._defaultPrevented=!1}}class Zv{constructor(n,l){this._map=n,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new Hv(this._map,n))}mousedown(n,l){return this._mousedownPos=l,this._firePreventable(new Mi(n.type,this._map,n))}mouseup(n){this._map.fire(new Mi(n.type,this._map,n))}preclick(n){const l=new MouseEvent("preclick",n);this._map.fire(new Mi(l.type,this._map,l))}click(n,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Mi(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Mi(n.type,this._map,n))}mouseover(n){this._map.fire(new Mi(n.type,this._map,n))}mouseout(n){this._map.fire(new Mi(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Rh(n.type,this._map,n))}touchmove(n){this._map.fire(new Rh(n.type,this._map,n))}touchend(n){this._map.fire(new Rh(n.type,this._map,n))}touchcancel(n){this._map.fire(new Rh(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gd{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new Mi(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Mi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Mi(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xv{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,l){this.isEnabled()&&n.shiftKey&&n.button===0&&(ue(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(n,l){if(!this._active)return;const m=l,v=this._startPos,w=this._lastPos;if(!v||!w||w.equals(m)||!this._box&&m.dist(v)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=H("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const S=Math.min(v.x,m.x),C=Math.max(v.x,m.x),A=Math.min(v.y,m.y),M=Math.max(v.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${A}px)`,this._box.style.width=C-S+"px",this._box.style.height=M-A+"px")})}mouseupWindow(n,l){if(!this._active)return;const m=this._startPos,v=l;if(m&&n.button===0){if(this.reset(),Ne(),m.x!==v.x||m.y!==v.y)return this._map.fire(new o.z("boxzoomend",{originalEvent:n})),{cameraAnimation:w=>w.fitScreenCoordinates(m,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ee(),delete this._startPos,delete this._lastPos}_fireEvent(n,l){return this._map.fire(new o.z(n,{originalEvent:l}))}}function Mp(p,n){const l={};for(let m=0;m<p.length;m++)l[p[m].identifier]=n[m];return l}class Kv{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,l,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),m.length===this.numTouches&&(this.centroid=function(v){const w=new o.P(0,0);for(const S of v)w._add(S);return w.div(v.length)}(l),this.touches=Mp(m,l)))}touchmove(n,l,m){if(this.aborted||!this.centroid)return;const v=Mp(m,l);for(const w in this.touches){const S=v[w];(!S||S.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(n,l,m){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Su{constructor(n){this.singleTap=new Kv(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,l,m){this.singleTap.touchstart(n,l,m)}touchmove(n,l,m){this.singleTap.touchmove(n,l,m)}touchend(n,l,m){const v=this.singleTap.touchend(n,l,m);if(v){const w=n.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(v)<30;if(w&&S||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Yv{constructor(){this._zoomIn=new Su({numTouches:1,numTaps:2}),this._zoomOut=new Su({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,l,m){this._zoomIn.touchstart(n,l,m),this._zoomOut.touchstart(n,l,m)}touchmove(n,l,m){this._zoomIn.touchmove(n,l,m),this._zoomOut.touchmove(n,l,m)}touchend(n,l,m){const v=this._zoomIn.touchend(n,l,m),w=this._zoomOut.touchend(n,l,m);return v?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(v)},{originalEvent:n})}):w?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(w)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Lg={0:1,2:2},zg={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Mh{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,l){return!1}_move(n,l){return{}}mousedown(n,l){if(this._lastPoint)return;const m=tt(n);this._correctButton(n,m)&&(this._lastPoint=l,this._eventButton=m)}mousemoveWindow(n,l){const m=this._lastPoint;if(m){if(n.preventDefault(),this._eventButton!=null&&function(v,w){const S=Lg[w];return v.buttons===void 0||(v.buttons&S)!==S}(n,this._eventButton))this.reset();else if(this._moved||!(l.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(m,l)}}mouseupWindow(n){this._lastPoint&&tt(n)===this._eventButton&&(this._moved&&Ne(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jv extends Mh{mousedown(n,l){super.mousedown(n,l),this._lastPoint&&(this._active=!0)}_correctButton(n,l){return l===0&&!n.ctrlKey}_move(n,l){return{around:l,panDelta:l.sub(n)}}}class Fg extends Mh{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?zg[n.pitchRotateKey]:void 0}_correctButton(n,l){return this._pitchRotateKey?l===0&&n[this._pitchRotateKey]:l===0&&n.ctrlKey||l===2}_move(n,l){const m=.8*(l.x-n.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class Qv extends Mh{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?zg[n.pitchRotateKey]:void 0}_correctButton(n,l){return this._pitchRotateKey?l===0&&n[this._pitchRotateKey]:l===0&&n.ctrlKey||l===2}_move(n,l){const m=-.5*(l.y-n.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class x1{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),o.aX(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(n,l,m){return this._calculateTransform(n,l,m)}touchmove(n,l,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!o.eT())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,l,m)}}touchend(n,l,m){this._calculateTransform(n,l,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,l,m){m.length>0&&(this._active=!0);const v=Mp(m,l),w=new o.P(0,0),S=new o.P(0,0);let C=0;for(const M in v){const D=v[M],F=this._touches[M];F&&(w._add(D),S._add(D.sub(F)),C++,v[M]=D)}if(this._touches=v,C<this._minTouches||!S.mag())return;const A=S.div(C);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(C),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=H("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Bg{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,l,m){return{}}touchstart(n,l,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([l[0],l[1]]))}touchmove(n,l,m){const v=this._firstTwoTouches;if(!v)return;n.preventDefault();const[w,S]=v,C=Dp(m,l,w),A=Dp(m,l,S);if(!C||!A)return;const M=this._aroundCenter?null:C.add(A).div(2);return this._move([C,A],M,n)}touchend(n,l,m){if(!this._firstTwoTouches)return;const[v,w]=this._firstTwoTouches,S=Dp(m,l,v),C=Dp(m,l,w);S&&C||(this._active&&Ne(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Dp(p,n,l){for(let m=0;m<p.length;m++)if(p[m].identifier===l)return n[m]}function ex(p,n){return Math.log2(p/n)}class b1 extends Bg{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,l){const m=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(ex(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ex(this._distance,m),pinchAround:l}}}function tx(p,n){return 180*p.angleWith(n)/Math.PI}class w1 extends Bg{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,l){const m=this._vector;if(this._vector=n[0].sub(n[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:tx(this._vector,m),pinchAround:l}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const l=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const v=tx(n,m);return Math.abs(v)<l}}function Vg(p){return Math.abs(p.y)>Math.abs(p.x)}class S1 extends Bg{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Vg(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,l,m){const v=this._lastPoints;if(!v)return;const w=n[0].sub(v[0]),S=n[1].sub(v[1]);return this._map._cooperativeGestures&&!o.eT()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(w,S,m.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(w.y+S.y)/2*-.5})}gestureBeginsVertically(n,l,m){if(this._valid!==void 0)return this._valid;const v=n.mag()>=2,w=l.mag()>=2;if(!v&&!w)return;if(!v||!w)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const S=n.y>0==l.y>0;return Vg(n)&&Vg(l)&&S}}const T1={panStep:100,bearingStep:15,pitchStep:10};class E1{constructor(){const n=T1;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let l=0,m=0,v=0,w=0,S=0;switch(n.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:n.shiftKey?m=-1:(n.preventDefault(),w=-1);break;case 39:n.shiftKey?m=1:(n.preventDefault(),w=1);break;case 38:n.shiftKey?v=1:(n.preventDefault(),S=-1);break;case 40:n.shiftKey?v=-1:(n.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(m=0,v=0),{cameraAnimation:C=>{const A=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:C1,zoom:l?Math.round(A)+l*(n.shiftKey?2:1):A,bearing:C.getBearing()+m*this._bearingStep,pitch:C.getPitch()+v*this._pitchStep,offset:[-w*this._panStep,-S*this._panStep],center:C.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function C1(p){return p*(2-p)}const A1=4.000244140625,J2=1/450;class Q2{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._handler=l,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=J2,o.aX(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||o.eT()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const m=o.o.now(),v=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,l!==0&&l%A1==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=l,this._timeout=window.setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(v*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),n.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=n,this._delta-=l,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=lt(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>A1?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&D!==0&&(D=1/D);const F=l(),O=Math.pow(2,F),q=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):O;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(q*D))),this._type==="wheel"&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:l(),v=this._startZoom,w=this._easing;let S,C=!1;if(this._type==="wheel"&&v&&w){const M=Math.min((o.o.now()-this._lastWheelEventTime)/200,1),D=w(M);S=o.ak(v,m,D),M<1?this._frameId||(this._frameId=!0):C=!0}else S=m,C=!0;this._active=!0,C&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let A=S-l();return A*this._lastDelta<0&&(A=0),{noInertia:!0,needsRenderFrame:!C,zoomDelta:A,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let l=o.eU;if(this._prevEase){const m=this._prevEase,v=(o.o.now()-m.start)/m.duration,w=m.easing(v+.01)-m.easing(v),S=.27/Math.sqrt(w*w+1e-4)*.01,C=Math.sqrt(.0729-S*S);l=o.eS(S,C,.25,1)}return this._prevEase={start:o.o.now(),duration:n,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=H("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Vi{constructor(n,l){this._clickZoom=n,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class I1{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,l){return n.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(n.shiftKey?-1:1),around:m.unproject(l)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class eE{constructor(){this._tap=new Su({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,l,m){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=l[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(n,l,m))}touchmove(n,l,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const v=l[0],w=v.y-this._swipePoint.y;return this._swipePoint=v,n.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(n,l,m)}touchend(n,l,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(n,l,m)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tE{constructor(n,l,m){this._el=n,this._mousePan=l,this._touchPan=m}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class rE{constructor(n,l,m){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=l,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Np{constructor(n,l,m,v){this._el=n,this._touchZoom=l,this._touchRotate=m,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Op=p=>p.zoom||p.drag||p.pitch||p.rotate;class rx extends o.z{}class Ug{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,l){const m=o.av([],l,n);this.radius=o.ag(m[2]<0?o.eW([],m,this.constants):[m[0],m[1],0])}projectRay(n){o.eW(n,n,this.constants),o.aw(n,n),o.eX(n,n,this.constants);const l=o.c4([],n,this.radius);if(l[2]>0){const m=o.c4([],[0,0,1],o.bI(l,[0,0,1])),v=o.c4([],o.aw([],[l[0],l[1],0]),this.radius),w=o.d7([],l,o.c4([],o.av([],o.d7([],v,m),l),2));l[0]=w[0],l[1]=w[1]}return l}}function cl(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class $g{constructor(n,l){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Og(n),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ug,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),o.aX(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,w,S]of this._listeners){const C=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(w,C,S)}}destroy(){for(const[n,l,m]of this._listeners){const v=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(l,v,m)}}_addDefaultHandlers(n){const l=this._map,m=l.getCanvasContainer();this._add("mapEvent",new Zv(l,n));const v=l.boxZoom=new Xv(l,n);this._add("boxZoom",v);const w=new Yv,S=new I1;l.doubleClickZoom=new Vi(S,w),this._add("tapZoom",w),this._add("clickZoom",S);const C=new eE;this._add("tapDragZoom",C);const A=l.touchPitch=new S1(l);this._add("touchPitch",A);const M=new Fg(n),D=new Qv(n);l.dragRotate=new rE(n,M,D),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]);const F=new Jv(n),O=new x1(l,n);l.dragPan=new tE(m,F,O),this._add("mousePan",F),this._add("touchPan",O,["touchZoom","touchRotate"]);const q=new w1,Z=new b1;l.touchZoomRotate=new Np(m,Z,q,C),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),this._add("blockableMapEvent",new gd(l));const Q=l.scrollZoom=new Q2(l,this);this._add("scrollZoom",Q,["mousePan"]);const se=l.keyboard=new E1;this._add("keyboard",se);for(const ne of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[ne]&&l[ne].enable(n[ne])}_add(n,l,m){this._handlers.push({handlerName:n,handler:l,allowed:m}),this._handlersById[n]=l}stop(n){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Op(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,l,m){for(const v in n)if(v!==m&&(!l||l.indexOf(v)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const l=[];for(const m of n)this._el.contains(m.target)&&l.push(m);return l}handleEvent(n,l){this._updatingCamera=!0;const m=n.type==="renderFrame",v=m?void 0:n,w={needsRenderFrame:!1},S={},C={},A=n.touches?this._getMapTouches(n.touches):void 0,M=A?Pt(this._el,A):m?void 0:lt(this._el,n);for(const{handlerName:O,handler:q,allowed:Z}of this._handlers){if(!q.isEnabled())continue;let Q;this._blockedByActive(C,Z,O)?q.reset():q[l||n.type]&&(Q=q[l||n.type](n,M,A),this.mergeHandlerResult(w,S,Q,O,v),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||q.isActive())&&(C[O]=q)}const D={};for(const O in this._previousActiveHandlers)C[O]||(D[O]=v);this._previousActiveHandlers=C,(Object.keys(D).length||cl(w))&&(this._changes.push([w,S,D]),this._triggerRenderFrame()),(Object.keys(C).length||cl(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=w;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(n,l,m,v,w){if(!m)return;Object.assign(n,m);const S={handlerName:v,originalEvent:m.originalEvent||w};m.zoomDelta!==void 0&&(l.zoom=S),m.panDelta!==void 0&&(l.drag=S),m.pitchDelta!==void 0&&(l.pitch=S),m.bearingDelta!==void 0&&(l.rotate=S)}_applyChanges(){const n={},l={},m={};for(const[v,w,S]of this._changes)v.panDelta&&(n.panDelta=(n.panDelta||new o.P(0,0))._add(v.panDelta)),v.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(n.around=v.around),v.aroundCoord!==void 0&&(n.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(n.pinchAround=v.pinchAround),v.noInertia&&(n.noInertia=v.noInertia),Object.assign(l,w),Object.assign(m,S);this._updateMapTransform(n,l,m),this._changes=[]}_updateMapTransform(n,l,m){const v=this._map,w=v.transform,S=ae=>[ae.x,ae.y,ae.z];if((ae=>{const he=this._eventsInProgress.drag;return he&&!this._handlersById[he.handlerName].isActive()})()&&!cl(n)){const ae=w.zoom;w.cameraElevationReference="sea",this._originalZoom!=null&&w._orthographicProjectionAtLowPitch&&w.projection.name!=="globe"&&w.pitch===0?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),ae!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&v._stop(!0),!cl(n))return void this._fireEvents(l,m,!0);let{panDelta:C,zoomDelta:A,bearingDelta:M,pitchDelta:D,around:F,aroundCoord:O,pinchAround:q}=n;w._isCameraConstrained&&(A>0&&(A=0),w._isCameraConstrained=!1),q!==void 0&&(F=q),(A||(ae=>l[ae]&&!this._eventsInProgress[ae])("drag"))&&F&&(this._dragOrigin=S(w.pointCoordinate3D(F)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",v._stop(!0),F=F||v.transform.centerPoint,M&&(w.bearing+=M),D&&(w.pitch+=D),w._updateCameraState();const Z=[0,0,0];if(C)if(w.projection.name==="mercator"){const ae=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(F).dir),he=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(F.sub(C)).dir);Z[0]=he[0]-ae[0],Z[1]=he[1]-ae[1]}else{const ae=w.pointCoordinate(F);if(w.projection.name==="globe"){C=C.rotate(-w.angle);const he=w._pixelsPerMercatorPixel/w.worldSize;Z[0]=-C.x*o.eV(o.a_(ae.y))*he,Z[1]=-C.y*o.eV(w.center.lat)*he}else{const he=w.pointCoordinate(F.sub(C));ae&&he&&(Z[0]=he.x-ae.x,Z[1]=he.y-ae.y)}}const Q=w.zoom,se=[0,0,0];if(A){const ae=S(O||w.pointCoordinate3D(F)),he={dir:o.aw([],o.av([],ae,w._camera.position))};if(he.dir[2]<0){const ce=w.zoomDeltaToMovement(ae,A);o.c4(se,he.dir,ce)}}const ne=o.d7(Z,Z,se);w._translateCameraConstrained(ne),A&&Math.abs(w.zoom-Q)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(l,m,!0)}_fireEvents(n,l,m){const v=Op(this._eventsInProgress),w=Op(n),S={};for(const D in n){const{originalEvent:F}=n[D];this._eventsInProgress[D]||(S[`${D}start`]=F),this._eventsInProgress[D]=n[D]}!v&&w&&this._fireEvent("movestart",w.originalEvent);for(const D in S)this._fireEvent(D,S[D]);w&&this._fireEvent("move",w.originalEvent);for(const D in n){const{originalEvent:F}=n[D];this._fireEvent(D,F)}const C={};let A;for(const D in this._eventsInProgress){const{handlerName:F,originalEvent:O}=this._eventsInProgress[D];this._handlersById[F].isActive()||(delete this._eventsInProgress[D],A=l[F]||O,C[`${D}end`]=A)}for(const D in C)this._fireEvent(D,C[D]);const M=Op(this._eventsInProgress);if(m&&(v||w)&&!M){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;D?(F(D.bearing||this._map.getBearing())&&(D.bearing=0),this._map.easeTo(D,{originalEvent:A})):(this._map.fire(new o.z("moveend",{originalEvent:A})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,l){this._map.fire(new o.z(n,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new rx("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ms="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ec extends o.E{constructor(n,l){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,o.aX(["_renderFrameCallback"],this)}getCenter(){return new o.aS(this.transform.center.lng,this.transform.center.lat)}setCenter(n,l){return this.jumpTo({center:n},l)}panBy(n,l,m){return n=o.P.convert(n).mult(-1),this.panTo(this.transform.center,Object.assign({offset:n},l),m)}panTo(n,l,m){return this.easeTo(Object.assign({center:n},l),m)}getZoom(){return this.transform.zoom}setZoom(n,l){return this.jumpTo({zoom:n},l),this}zoomTo(n,l,m){return this.easeTo(Object.assign({zoom:n},l),m)}zoomIn(n,l){return this.zoomTo(this.getZoom()+1,n,l),this}zoomOut(n,l){return this.zoomTo(this.getZoom()-1,n,l),this}getBearing(){return this.transform.bearing}setBearing(n,l){return this.jumpTo({bearing:n},l),this}getPadding(){return this.transform.padding}setPadding(n,l){return this.jumpTo({padding:n},l),this}rotateTo(n,l,m){return this.easeTo(Object.assign({bearing:n},l),m)}resetNorth(n,l){return this.rotateTo(0,Object.assign({duration:1e3},n),l),this}resetNorthPitch(n,l){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},n),l),this}snapToNorth(n,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,l):this}getPitch(){return this.transform.pitch}setPitch(n,l){return this.jumpTo({pitch:n},l),this}cameraForBounds(n,l){n=o.aI.convert(n);const m=l&&l.bearing||0,v=l&&l.pitch||0,w=n.getNorthWest(),S=n.getSouthEast();return this._cameraForBounds(this.transform,w,S,m,v,l)}_extendPadding(n){const l={top:0,right:0,bottom:0,left:0};return n==null?Object.assign({},l,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:Object.assign({},l,n)}_extendCameraOptions(n){return(n=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,l){const m=l.max[0]-l.min[0],v=l.max[1]-l.min[1];return m/v>n.aspect?m/(2*Math.tan(.5*n.fovX)*n.aspect):v/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,l,m,v,w,S){const C=n.clone(),A=this._extendCameraOptions(S);C.bearing=v,C.pitch=w;const M=o.aS.convert(l),D=o.aS.convert(m),F=.5*(M.lat+D.lat),O=.5*(M.lng+D.lng),q=o.eY(F,O),Z=o.aw([],q),Q=o.aw([],o.bH([],Z,[0,1,0])),se=o.bH([],Q,Z),ne=[Q[0],Q[1],Q[2],0,se[0],se[1],se[2],0,Z[0],Z[1],Z[2],0,0,0,0,1],ae=[q,o.eY(M.lat,M.lng),o.eY(D.lat,M.lng),o.eY(D.lat,D.lng),o.eY(M.lat,D.lng),o.eY(F,M.lng),o.eY(F,D.lng),o.eY(M.lat,O),o.eY(D.lat,O)];let he=o.d8.fromPoints(ae.map(Ze=>[o.bI(Q,Ze),o.bI(se,Ze),o.bI(Z,Ze)]));const ce=o.af([],he.center,ne);o.eZ(ce)===0&&o.e_(ce,0,0,1),o.aw(ce,ce),o.c4(ce,ce,o.aD),C.center=o.e$(ce);const we=C.getWorldToCameraMatrix(),fe=o.bk(new Float64Array(16),we);he=o.d8.applyTransform(he,o.aB([],we,ne));const Te=this._extendAABB(he,C,A,v);if(!Te)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");he=Te,o.af(ce,ce,we);const ve=.5*(he.max[2]-he.min[2]),ge=this._minimumAABBFrustumDistance(C,he),Ce=o.c4([],[0,0,1],ve),Fe=o.d7(Ce,ce,Ce),Oe=ge+(C.pitch===0?0:o.bF(ce,Fe)),st=C.globeCenterInViewSpace,He=o.av([],ce,[st[0],st[1],st[2]]);o.aw(He,He),o.c4(He,He,Oe);const ht=o.d7([],ce,He);o.af(ht,ht,fe);const Nt=o.eL/o.aD,Ge=o.ag(ht),Re=o.ce(Math.max(Ge*Nt-o.eL,Number.EPSILON),0),ft=Math.min(C.zoomFromMercatorZAdjusted(Re),A.maxZoom);return ft>.5*(o.cZ+o.cK)?(C.setProjection({name:"mercator"}),C.zoom=ft,this._cameraForBounds(C,l,m,v,w,S)):{center:C.center,zoom:ft,bearing:v,pitch:w}}_extendAABB(n,l,m,v){const w=.5*((m.padding.left||0)+(m.padding.right||0)),S=.5*((m.padding.top||0)+(m.padding.bottom||0)),C=S,A=w,M=w,D=S,F=l.width-(A+M),O=l.height-(C+D),q=o.av([],n.max,n.min),Z=Math.min(F/q[0],O/q[1]),Q=Math.min(l.scaleZoom(l.scale*Z),m.maxZoom);if(isNaN(Q))return null;const se=l.scale/l.zoomScale(Q),ne=new o.d8([n.min[0]-A*se,n.min[1]-D*se,n.min[2]],[n.max[0]+M*se,n.max[1]+C*se,n.max[2]]),ae=(typeof m.offset.x=="number"&&typeof m.offset.y=="number"?new o.P(m.offset.x,m.offset.y):o.P.convert(m.offset)).rotate(-o.an(v));return ne.center[0]-=ae.x*se,ne.center[1]+=ae.y*se,ne}queryTerrainElevation(n,l){const m=this.transform.elevation;return m?(l=Object.assign({},{exaggerated:!0},l),m.getAtPoint(o.ae.fromLngLat(n),null,l.exaggerated)):null}_cameraForBounds(n,l,m,v,w,S){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,l,m,v,w,S);const C=n.clone(),A=this._extendCameraOptions(S);C.bearing=v,C.pitch=w;const M=o.aS.convert(l),D=o.aS.convert(m),F=new o.aS(M.lng,D.lat),O=new o.aS(D.lng,M.lat),q=C.project(M),Z=C.project(D),Q=this.queryTerrainElevation(M),se=this.queryTerrainElevation(D),ne=this.queryTerrainElevation(F),ae=this.queryTerrainElevation(O),he=[[q.x,q.y,Math.min(Q||0,se||0,ne||0,ae||0)],[Z.x,Z.y,Math.max(Q||0,se||0,ne||0,ae||0)]];let ce=o.d8.fromPoints(he);const we=C.getWorldToCameraMatrix(),fe=o.bk(new Float64Array(16),we);ce=o.d8.applyTransform(ce,we);const Te=this._extendAABB(ce,C,A,v);if(!Te)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ce=Te;const ve=.5*o.av([],ce.max,ce.min)[2],ge=this._minimumAABBFrustumDistance(C,ce),Ce=[0,0,1,0];o.aC(Ce,Ce,we),o.f0(Ce,Ce);const Fe=o.c4([],Ce,ge+ve),Oe=o.d7([],ce.center,Fe);o.af(ce.center,ce.center,fe),o.af(Oe,Oe,fe);const st=C.unproject(new o.P(ce.center[0],ce.center[1])),He=o.f1(C.projection,st),ht=Math.pow(2,He),Nt=Math.min(C._zoomFromMercatorZ(Oe[2]*C.pixelsPerMeter*ht/C.worldSize),A.maxZoom);return C.mercatorFromTransition&&Nt<.5*(o.cZ+o.cK)?(C.setProjection({name:"globe"}),C.zoom=Nt,this._cameraForBounds(C,l,m,v,w,S)):{center:st,zoom:Nt,bearing:v,pitch:w}}fitBounds(n,l,m){const v=this.cameraForBounds(n,l);return this._fitInternal(v,l,m)}fitScreenCoordinates(n,l,m,v,w){const S=o.P.convert(n),C=o.P.convert(l),A=new o.P(Math.min(S.x,C.x),Math.min(S.y,C.y)),M=new o.P(Math.max(S.x,C.x),Math.max(S.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,C))return this;const D=this.transform.pointLocation3D(A),F=this.transform.pointLocation3D(M),O=this.transform.pointLocation3D(new o.P(A.x,M.y)),q=this.transform.pointLocation3D(new o.P(M.x,A.y)),Z=[Math.min(D.lng,F.lng,O.lng,q.lng),Math.min(D.lat,F.lat,O.lat,q.lat)],Q=[Math.max(D.lng,F.lng,O.lng,q.lng),Math.max(D.lat,F.lat,O.lat,q.lat)],se=v&&v.pitch?v.pitch:this.getPitch(),ne=this._cameraForBounds(this.transform,Z,Q,m,se,v);return this._fitInternal(ne,v,w)}_fitInternal(n,l,m){return n?(l=Object.assign(n,l)).linear?this.easeTo(l,m):this.flyTo(l,m):this}jumpTo(n,l){this.stop();const m=n.preloadOnly?this.transform.clone():this.transform;let v=!1,w=!1,S=!1;"zoom"in n&&m.zoom!==+n.zoom&&(v=!0,m.zoom=+n.zoom),n.center!==void 0&&(m.center=o.aS.convert(n.center)),"bearing"in n&&m.bearing!==+n.bearing&&(w=!0,m.bearing=+n.bearing),"pitch"in n&&m.pitch!==+n.pitch&&(S=!0,m.pitch=+n.pitch);const C=typeof n.padding=="number"?this._extendPadding(n.padding):n.padding;if(n.padding!=null&&!m.isPaddingEqual(C))if(n.retainPadding===!1){const A=m.clone();A.padding=C,m.setLocationAtPoint(m.center,A.centerPoint)}else m.padding=C;return n.preloadOnly?(this._preloadTiles(m),this):(this.fire(new o.z("movestart",l)).fire(new o.z("move",l)),v&&this.fire(new o.z("zoomstart",l)).fire(new o.z("zoom",l)).fire(new o.z("zoomend",l)),w&&this.fire(new o.z("rotatestart",l)).fire(new o.z("rotate",l)).fire(new o.z("rotateend",l)),S&&this.fire(new o.z("pitchstart",l)).fire(new o.z("pitch",l)).fire(new o.z("pitchend",l)),this.fire(new o.z("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(ms),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,l){const m=this.transform;if(!m.projection.supportsFreeCamera)return o.w(ms),this;this.stop();const v=m.zoom,w=m.pitch,S=m.bearing;m.setFreeCameraOptions(n);const C=v!==m.zoom,A=w!==m.pitch,M=S!==m.bearing;return this.fire(new o.z("movestart",l)).fire(new o.z("move",l)),C&&this.fire(new o.z("zoomstart",l)).fire(new o.z("zoom",l)).fire(new o.z("zoomend",l)),M&&this.fire(new o.z("rotatestart",l)).fire(new o.z("rotate",l)).fire(new o.z("rotateend",l)),A&&this.fire(new o.z("pitchstart",l)).fire(new o.z("pitch",l)).fire(new o.z("pitchend",l)),this.fire(new o.z("moveend",l)),this}easeTo(n,l){this._stop(!1,n.easeId),((n=Object.assign({offset:[0,0],duration:500,easing:o.eU},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const m=this.transform,v=this.getZoom(),w=this.getBearing(),S=this.getPitch(),C=this.getPadding(),A="zoom"in n?+n.zoom:v,M="bearing"in n?this._normalizeBearing(n.bearing,w):w,D="pitch"in n?+n.pitch:S,F=this._extendPadding(n.padding),O=o.P.convert(n.offset);let q,Z,Q;if(m.projection.name==="globe"){const Ce=o.ae.fromLngLat(m.center),Fe=O.rotate(-m.angle);Ce.x+=Fe.x/m.worldSize,Ce.y+=Fe.y/m.worldSize;const Oe=Ce.toLngLat(),st=o.aS.convert(n.center||Oe);this._normalizeCenter(st),q=m.centerPoint.add(Fe),Z=new o.P(Ce.x,Ce.y).mult(m.worldSize),Q=new o.P(o.aF(st.lng),o.aJ(st.lat)).mult(m.worldSize).sub(Z)}else{q=m.centerPoint.add(O);const Ce=m.pointLocation(q),Fe=o.aS.convert(n.center||Ce);this._normalizeCenter(Fe),Z=m.project(Ce),Q=m.project(Fe).sub(Z)}const se=m.zoomScale(A-v);let ne,ae;n.around&&(ne=o.aS.convert(n.around),ae=m.locationPoint(ne));const he=this._zooming||A!==v,ce=this._rotating||w!==M,we=this._pitching||D!==S,fe=!m.isPaddingEqual(F),Te=n.retainPadding===!1?m.clone():m,ve=Ce=>Fe=>{if(he&&(Ce.zoom=o.ak(v,A,Fe)),ce&&(Ce.bearing=o.ak(w,M,Fe)),we&&(Ce.pitch=o.ak(S,D,Fe)),fe&&(Te.interpolatePadding(C,F,Fe),q=Te.centerPoint.add(O)),ne)Ce.setLocationAtPoint(ne,ae);else{const Oe=Ce.zoomScale(Ce.zoom-v),st=A>v?Math.min(2,se):Math.max(.5,se),He=Math.pow(st,1-Fe),ht=Ce.unproject(Z.add(Q.mult(Fe*He)).mult(Oe));Ce.setLocationAtPoint(Ce.renderWorldCopies?ht.wrap():ht,q)}return n.preloadOnly||this._fireMoveEvents(l),Ce};if(n.preloadOnly){const Ce=this._emulate(ve,n.duration,m);return this._preloadTiles(Ce),this}const ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=he,this._rotating=ce,this._pitching=we,this._padding=fe,this._easeId=n.easeId,this._prepareEase(l,n.noMoveStart,ge),this._ease(ve(m),Ce=>{m.cameraElevationReference==="sea"&&m.recenterOnTerrain(),this._afterEase(l,Ce)},n),this}_prepareEase(n,l,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),l||m.moving||this.fire(new o.z("movestart",n)),this._zooming&&!m.zooming&&this.fire(new o.z("zoomstart",n)),this._rotating&&!m.rotating&&this.fire(new o.z("rotatestart",n)),this._pitching&&!m.pitching&&this.fire(new o.z("pitchstart",n))}_fireMoveEvents(n){this.fire(new o.z("move",n)),this._zooming&&this.fire(new o.z("zoom",n)),this._rotating&&this.fire(new o.z("rotate",n)),this._pitching&&this.fire(new o.z("pitch",n))}_afterEase(n,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,v=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new o.z("zoomend",n)),v&&this.fire(new o.z("rotateend",n)),w&&this.fire(new o.z("pitchend",n)),this.fire(new o.z("moveend",n))}flyTo(n,l){if(this._prefersReducedMotion(n)){const Ze=o.aH(n,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ze,l)}this.stop(),n=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:o.eU},n);const m=this.transform,v=this.getZoom(),w=this.getBearing(),S=this.getPitch(),C=this.getPadding(),A="zoom"in n?o.aA(+n.zoom,m.minZoom,m.maxZoom):v,M="bearing"in n?this._normalizeBearing(n.bearing,w):w,D="pitch"in n?+n.pitch:S,F=this._extendPadding(n.padding),O=m.zoomScale(A-v),q=o.P.convert(n.offset);let Z=m.centerPoint.add(q);const Q=m.pointLocation(Z),se=o.aS.convert(n.center||Q);this._normalizeCenter(se);const ne=m.project(Q),ae=m.project(se).sub(ne);let he=n.curve;const ce=Math.max(m.width,m.height),we=ce/O,fe=ae.mag();if("minZoom"in n){const Ze=o.aA(Math.min(n.minZoom,v,A),m.minZoom,m.maxZoom),wt=ce/m.zoomScale(Ze-v);he=Math.sqrt(wt/fe*2)}const Te=he*he;function ve(Ze){const wt=(we*we-ce*ce+(Ze?-1:1)*Te*Te*fe*fe)/(2*(Ze?we:ce)*Te*fe);return Math.log(Math.sqrt(wt*wt+1)-wt)}function ge(Ze){return(Math.exp(Ze)-Math.exp(-Ze))/2}function Ce(Ze){return(Math.exp(Ze)+Math.exp(-Ze))/2}const Fe=ve(0);let Oe=function(Ze){return Ce(Fe)/Ce(Fe+he*Ze)},st=function(Ze){return ce*((Ce(Fe)*(ge(wt=Fe+he*Ze)/Ce(wt))-ge(Fe))/Te)/fe;var wt},He=(ve(1)-Fe)/he;if(Math.abs(fe)<1e-6||!isFinite(He)){if(Math.abs(ce-we)<1e-6)return this.easeTo(n,l);const Ze=we<ce?-1:1;He=Math.abs(Math.log(we/ce))/he,st=function(){return 0},Oe=function(wt){return Math.exp(Ze*he*wt)}}n.duration="duration"in n?+n.duration:1e3*He/("screenSpeed"in n?+n.screenSpeed/he:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const ht=w!==M,Nt=D!==S,Ge=!m.isPaddingEqual(F),Re=n.retainPadding===!1?m.clone():m,ft=Ze=>wt=>{const Ft=wt*He,sr=1/Oe(Ft);Ze.zoom=wt===1?A:v+Ze.scaleZoom(sr),ht&&(Ze.bearing=o.ak(w,M,wt)),Nt&&(Ze.pitch=o.ak(S,D,wt)),Ge&&(Re.interpolatePadding(C,F,wt),Z=Re.centerPoint.add(q));const Rt=wt===1?se:Ze.unproject(ne.add(ae.mult(st(Ft))).mult(sr));return Ze.setLocationAtPoint(Ze.renderWorldCopies?Rt.wrap():Rt,Z),Ze._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(l),Ze};if(n.preloadOnly){const Ze=this._emulate(ft,n.duration,m);return this._preloadTiles(Ze),this}return this._zooming=!0,this._rotating=ht,this._pitching=Nt,this._padding=Ge,this._prepareEase(l,!1),this._ease(ft(m),()=>this._afterEase(l),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,l)}if(!n){const m=this.handlers;m&&m.stop(!1)}return this}_ease(n,l,m){m.animate===!1||m.duration===0?(n(1),l()):(this._easeStart=o.o.now(),this._easeOptions=m,this._onEaseFrame=n,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((o.o.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,l){n=o.bS(n,-180,180);const m=Math.abs(n-l);return Math.abs(n-360-l)<m&&(n-=360),Math.abs(n+360-l)<m&&(n+=360),n}_normalizeCenter(n){const l=this.transform;if(l.maxBounds||l.projection.name!=="globe"&&!l.renderWorldCopies)return;const m=n.lng-l.center.lng;n.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&o.o.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,l,m){const v=Math.ceil(15*l/1e3),w=[],S=n(m.clone());for(let C=0;C<=v;C++){const A=S(C/v);w.push(A.clone())}return w}_preloadTiles(n,l){}}class Dh{constructor(n={}){this.options=n,o.aX(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const l=this.options&&this.options.compact,m=n._getUIString("AttributionControl.ToggleAttribution");this._map=n,this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=H("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",m);const v=H("span","mapboxgl-ctrl-icon",this._compactButton);return v.setAttribute("aria-hidden","true"),v.setAttribute("title",m),this._innerContainer=H("div","mapboxgl-ctrl-attrib-inner",this._container),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(n){const m=l.reduce((v,w,S)=>(w.value&&(v+=`${w.key}=${w.value}${S<l.length-1?"&":""}`),v),"?");n.href=`${o.e.FEEDBACK_URL}/${m}#${Ng(this._map,!0)}`,n.rel="noopener nofollow"}}_updateData(n){!n||(n.dataType!=="source"||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility")&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const l=this._map.style._mergedSourceCaches;for(const v in l){const w=l[v];if(w.used){const S=w.getSource();S.attribution&&n.indexOf(S.attribution)<0&&n.push(S.attribution)}}n.sort((v,w)=>v.length-w.length),n=n.filter((v,w)=>{for(let S=w+1;S<n.length;S++)if(n[S].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const m=n.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,n.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Lp{constructor(){o.aX(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=H("div","mapboxgl-ctrl");const l=H("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const l in n){const m=n[l].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const l=n[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class nx{constructor(){o.aX(["_onIndoorUpdate"],this)}onAdd(n){return this._map=n,this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",l=>this._onIndoorUpdate(l)),this._container}_createButton(n,l){const m=H("button",n,this._container);return m.type="button",m.addEventListener("click",l),m}_createSeparator(){return H("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(n,l){this._map&&(n.setAttribute("aria-label",l),n.textContent=l)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(n){if(!n||!n.floors)return this._model=n,void(this._container.style.display="none");const l=this._model;this._model=n,this._container.style.display="inline-block",this._container.style.borderRadius="8px",l&&Array.from(this._container.children).forEach(m=>m.remove()),n.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(n.floors,n.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const n=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const l=this._map;this._model&&l&&l._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});H("span","mapboxgl-ctrl-icon",n).setAttribute("aria-hidden","true"),n.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&n.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(n),this._createSeparator()}_updateBuildingsButtonState(){const n=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");n&&this._model&&(this._model.activeFloorsVisible?n.classList.remove("mapboxgl-ctrl-level-button-selected"):n.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(n,l){for(let m=0;m<n.length;m++){const v=n[m],w=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(v.id)});this._setButtonTitle(w,v.zIndex.toString()),this._model&&v.id===this._model.selectedFloorId&&l&&w.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(w),m<n.length-1&&this._createSeparator()}}}class P1{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const l=++this._id;return this._queue.push({callback:n,id:l,cancelled:!1}),l}remove(n){const l=this._currentlyRunning,m=l?this._queue.concat(l):this._queue;for(const v of m)if(v.id===n)return void(v.cancelled=!0)}run(n=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const m of l)if(!m.cancelled&&(m.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class zp{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const l=o.dC((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,l,m){this._start=this.getValue(l),this._end=n,this._startTime=l,this._endTime=l+m}}const nE={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class k1 extends o.z{constructor(n,l,m,v){const{point:w,lngLat:S,originalEvent:C,target:A}=n;super(n.type,{point:w,lngLat:S,originalEvent:C,target:A}),this.preventDefault=()=>{n.preventDefault()},this.id=l,this.interaction=m,this.feature=v}}class ix{constructor(n){this.map=n,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(n,l){if(this.typeById.has(n))throw new Error(`Interaction id "${n}" already exists.`);const m=l.filter;let v=l.type;m&&this.filters.set(n,o.b5(m)),v==="mouseover"&&(v="mouseenter"),v==="mouseout"&&(v="mouseleave");const w=this.interactionsByType.get(v)||new Map;v==="mouseenter"||v==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(n,l)):w.size===0&&this.map.on(v,this.handleType),w.size===0&&this.interactionsByType.set(v,w),w.set(n,l),this.typeById.set(n,v)}get(n){const l=this.typeById.get(n);if(!l)return;const m=this.interactionsByType.get(l);return m?m.get(n):void 0}remove(n){const l=this.typeById.get(n);if(!l)return;this.typeById.delete(n),this.filters.delete(n);const m=this.interactionsByType.get(l);m&&(m.delete(n),l==="mouseenter"||l==="mouseleave"?(this.delegatedInteractions.delete(n),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):m.size===0&&this.map.off(l,this.handleType))}queryTargets(n,l){const m=[];for(const[v,w]of l)w.target&&m.push({targetId:v,target:w.target,filter:this.filters.get(v)});return this.map.style.queryRenderedTargets(n,m,this.map.transform)}handleMove(n){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const l=this.queryTargets(n.point,Array.from(this.delegatedInteractions).reverse());l.length&&(n.type="mouseenter",this.handleType(n,l));const m=new Map;for(const[v,{feature:w}]of this.prevHoveredFeatures)this.hoveredFeatures.has(v)||m.set(w.id,w);m.size&&(n.type="mouseleave",this.handleType(n,Array.from(m.values())))}handleOut(n){const l=Array.from(this.hoveredFeatures.values()).map(({feature:m})=>m);l.length&&(n.type="mouseleave",this.handleType(n,l)),this.hoveredFeatures.clear()}handleType(n,l){const m=n.type==="mouseenter";if(m&&!this.interactionsByType.has(n.type))return void o.w("mouseenter interaction required for mouseleave to work.");const v=Array.from(this.interactionsByType.get(n.type)).reverse(),w=!!l;l=l||this.queryTargets(n.point,v);let S=!1;const C=new Set;for(const A of l){for(const[M,D]of v){if(!D.target)continue;const F=A.variants?A.variants[M]:null;if(F){for(const O of F){if(da(O,A,C,M))continue;const q=new o.dw(A,O),Z=Al(O,A,M);w&&q.id!==void 0&&(q.state=this.map.getFeatureState(q));const Q=m?this.prevHoveredFeatures.get(Z):null,se=new k1(n,M,D,q),ne=Q?Q.stop:D.handler(se);if(m&&this.hoveredFeatures.set(Z,{feature:A,stop:ne}),ne!==!1){S=!0;break}}if(S)break}}if(S)break}if(!S)for(const[A,M]of v){const{handler:D,target:F}=M;if(!F&&D(new k1(n,A,M,null))!==!1)break}}}function sx(p,n){if(Array.isArray(p)&&Array.isArray(n)){const l=new Set(p),m=new Set(n);return l.size===m.size&&p.every(v=>m.has(v))}return o.bx(p,n)}const qg={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Gg={showCompass:!0,showZoom:!0,visualizePitch:!1};class Fp{constructor(n,l,m=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new Fg({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,m&&(this.mousePitch=new Qv({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),o.aX(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(n,l){this.mouseRotate.mousedown(n,l),this.mousePitch&&this.mousePitch.mousedown(n,l),ue()}move(n,l){const m=this.map,v=this.mouseRotate.mousemoveWindow(n,l),w=v&&v.bearingDelta;if(w&&m.setBearing(m.getBearing()+w),this.mousePitch){const S=this.mousePitch.mousemoveWindow(n,l),C=S&&S.pitchDelta;C&&m.setPitch(m.getPitch()+C)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ee(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(Object.assign({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),lt(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,lt(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Pt(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Pt(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Ac(p,n,l){if(p=new o.aS(p.lng,p.lat),n){const m=new o.aS(p.lng-360,p.lat),v=new o.aS(p.lng+360,p.lat),w=360*Math.ceil(Math.abs(p.lng-l.center.lng)/360),S=l.locationPoint3D(p).distSqr(n),C=n.x<0||n.y<0||n.x>l.width||n.y>l.height;l.locationPoint3D(m).distSqr(n)<S&&(C||Math.abs(m.lng-l.center.lng)<w)?p=m:l.locationPoint3D(v).distSqr(n)<S&&(C||Math.abs(v.lng-l.center.lng)<w)&&(p=v)}for(;Math.abs(p.lng-l.center.lng)>180;){const m=l.locationPoint3D(p);if(m.x>=0&&m.y>=0&&m.x<=l.width&&m.y<=l.height)break;p.lng>l.center.lng?p.lng-=360:p.lng+=360}return p}const Pl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},So={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Ic extends o.E{constructor(n,l){super(),(n instanceof HTMLElement||l)&&(n=Object.assign({element:n},l)),o.aX(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:m="center",color:v="#3FB1CE",scale:w=1,draggable:S=!1,clickTolerance:C=0,rotation:A=So.rotation,rotationAlignment:M=So.rotationAlignment,pitchAlignment:D=So.pitchAlignment,occludedOpacity:F=So.occludedOpacity,altitude:O=So.altitude}=n||{};this._anchor=m,this._color=v,this._scale=w,this._draggable=S,this._clickTolerance=C,this._rotation=A,this._rotationAlignment=M,this._pitchAlignment=D,this._occludedOpacity=F,this._altitude=O,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),n&&n.element?(this._element=n.element,this._offset=o.P.convert(n&&n.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=o.P.convert(n&&n.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",Q=>{Q.preventDefault()}),this._element.addEventListener("mousedown",Q=>{Q.preventDefault()});const q=this._element.classList;for(const Q in Pl)q.remove(`mapboxgl-marker-anchor-${Q}`);q.add(`mapboxgl-marker-anchor-${this._anchor}`);const Z=n&&n.className?n.className.trim().split(/\s+/):[];q.add(...Z),this._popup=null}_createDefaultMarker(){const n=H("div"),l=K("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},n);if(this._altitude===0){const m=K("radialGradient",{id:"shadowGradient"},K("defs",{},l));K("stop",{offset:"10%","stop-opacity":.4},m),K("stop",{offset:"100%","stop-opacity":.05},m),K("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},l)}return K("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},l),K("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},l),K("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},l),n}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=o.aS.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(n){return n===this._altitude||(this._defaultMarker&&(this._altitude===0&&n!==0||this._altitude!==0&&n===0)&&(this._element=this._createDefaultMarker()),this._altitude=n||So.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,n._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const l=n.code,m=n.charCode||n.keyCode;l!=="Space"&&l!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(n){const l=n.originalEvent.target,m=this._element;this._popup&&(l===m||m.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,l=this._pos;if(!n||!l)return!1;const m=n.unproject(l,this._altitude),v=n.getFreeCameraOptions();if(!v.position)return!1;const w=v.position.toLngLat();return w.distanceTo(m)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const l=this._pos;if(!l||l.x<0||l.x>n.transform.width||l.y<0||l.y>n.transform.height)return void this._clearFadeTimer();const m=n.unproject(l,this._altitude);let v;n._showingGlobe()&&o.f4(n.transform,this._lngLat)?v=0:(v=1-n._queryFogOpacity(m),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${Pl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){const n=this._pos,l=this._map,m=this.getPitchAlignment();if(!l||!n||m!=="map")return"";if(!l._showingGlobe()){const A=l.getPitch();return A?`rotateX(${A}deg)`:""}const v=o.cW(o.f5(l.transform,this._lngLat)),w=n.sub(o.f6(l.transform)),S=Math.abs(w.x)+Math.abs(w.y);if(S===0)return"";const C=v/S;return`rotateX(${-w.y*C}deg) rotateY(${w.x*C}deg)`}_calculateZTransform(){const n=this._pos,l=this._map;if(!l||!n)return"";let m=0;const v=this.getRotationAlignment();if(v==="map")if(l._showingGlobe()){const w=l.project(new o.aS(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),S=l.project(new o.aS(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(w);m=o.cW(Math.atan2(S.y,S.x))-90}else m=-l.getBearing();else if(v==="horizon"){const w=o.ah(4,6,l.getZoom()),S=o.f6(l.transform);S.y+=w*l.transform.height;const C=n.sub(S),A=o.cW(Math.atan2(C.y,C.x));m=(A>90?A-270:A+90)*(1-w)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=Ac(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat,this._altitude),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=o.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const l=this._map;if(!l)return;const m=this._pointerdownPos,v=this._positionDelta;if(m&&v){if(!this._isDragging){const w=this._clickTolerance||l._clickTolerance;if(n.point.dist(m)<w)return;this._isDragging=!0}this._pos=n.point.sub(v),this._lngLat=l.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.z("dragstart"))),this.fire(new o.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.z("dragend")),this._state="inactive"}_addDragHandler(n){const l=this._map,m=this._pos;l&&m&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(m),this._pointerdownPos=n.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const l=this._map;return l&&(n?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||So.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||So.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||So.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||So.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const kl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},iE={maxWidth:100,unit:"metric"},sE={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},oE={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},aE=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ox(p=new o.P(0,0),n="bottom"){if(typeof p=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(n){case"top":return new o.P(0,p);case"top-left":return new o.P(l,l);case"top-right":return new o.P(-l,l);case"bottom":return new o.P(0,-p);case"bottom-left":return new o.P(l,-l);case"bottom-right":return new o.P(-l,-l);case"left":return new o.P(p,0);case"right":return new o.P(-p,0)}return new o.P(0,0)}return p instanceof o.P||Array.isArray(p)?o.P.convert(p):o.P.convert(p[n]||[0,0])}return{version:I,supported:Y.supported,setRTLTextPlugin:o.fa,getRTLTextPluginStatus:o.f9,Map:class extends ec{constructor(p){N.mark(P.create);const n=p;if((p=Object.assign({},qg,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&o.f2(window)&&(p.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ah(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies,null,null),p),this._repaint=!!p.repaint,this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new P1,this._domRenderTaskQueue=new P1,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.b1(),this._locale=Object.assign({},nE,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._tessellationStep=p.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=p.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new zp(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=p.scaleFactor,this._requestManager=new je(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,this._contextCreateOptions=p.contextCreateOptions?Object.assign({},p.contextCreateOptions):{},typeof p.container=="string"){const l=document.getElementById(p.container);if(!l)throw new Error(`Container '${p.container.toString()}' not found.`);this._container=l}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),this._spriteFormat=p.spriteFormat,o.aX(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new K2),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new $g(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,(p.style||!p.testMode)&&this.setStyle(p.style||o.e.DEFAULT_STYLE,{config:p.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),p.hash&&(this._hash=new Dg(typeof p.hash=="string"&&p.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch});const l=p.bounds;l&&(this.resize(),this.fitBounds(l,Object.assign({},p.fitBoundsOptions,{duration:0})))}this.resize(),p.attributionControl&&this.addControl(new Dh({customAttribution:p.customAttribution})),this._logoControl=new Lp,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new o.z(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new o.z(`${l.dataType}dataloading`,l))}),this._interactions=new ix(this)}_getMapId(){return this._mapId}addControl(p,n){if(n===void 0&&(n=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new o.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=p.onAdd(this);this._controls.push(p);const m=this._controlPositions[n];return n.indexOf("bottom")!==-1?m.insertBefore(l,m.firstChild):m.appendChild(l),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new o.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(p);return n>-1&&this._controls.splice(n,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new o.z("movestart",p)).fire(new o.z("move",p)),this.fire(new o.z("resize",p)),n&&this.fire(new o.z("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(o.aI.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(p){return this._scaleFactor=p,this.painter.scaleFactor=p,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(n=>n.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?navigator.language:Array.isArray(p)?p.length===0?void 0:p.map(n=>n==="auto"?navigator.language:n):p}setLanguage(p){const n=this._parseLanguage(p);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const p=this.transform,n=p.projection.name;let l;n==="globe"&&p.zoom>=o.cK?(p.setMercatorFromTransition(),l=!0):n==="mercator"&&p.zoom<o.cK&&(p.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(p,n){return this._updateProjection(p||n||{name:"mercator"})}_updateProjection(p){let n;const l=this.transform.mercatorFromTransition;n=p.name==="globe"&&this.transform.zoom>=o.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate();const m=this.transform.getProjection().name==="mercator"&&l!==this.transform.mercatorFromTransition;return(n||m)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(p,n){return this.transform.locationPoint3D(o.aS.convert(p),n)}unproject(p,n){return this.transform.pointLocation3D(o.P.convert(p),n)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,n,l){const m=v=>{let w=[];if(Array.isArray(n)){const S=n.filter(C=>this.getLayer(C));w=S.length?this.queryRenderedFeatures(v,{layers:S}):[]}else w=this.queryRenderedFeatures(v,{target:n});return w};if(p==="mouseenter"||p==="mouseover"){let v=!1;return{listener:l,targets:n,delegates:{mousemove:S=>{const C=m(S.point);C.length?v||(v=!0,l.call(this,new Mi(p,this,S.originalEvent,{features:C}))):v=!1},mouseout:()=>{v=!1}}}}if(p==="mouseleave"||p==="mouseout"){let v=!1;return{listener:l,targets:n,delegates:{mousemove:C=>{m(C.point).length?v=!0:v&&(v=!1,l.call(this,new Mi(p,this,C.originalEvent)))},mouseout:C=>{v&&(v=!1,l.call(this,new Mi(p,this,C.originalEvent)))}}}}{const v=w=>{const S=m(w.point);S.length&&(w.features=S,l.call(this,w),delete w.features)};return{listener:l,targets:n,delegates:{[p]:v}}}}on(p,n,l){if(typeof n=="function"||l===void 0)return super.on(p,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const m=this._createDelegatedListener(p,n,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(m);for(const v in m.delegates)this.on(v,m.delegates[v]);return this}once(p,n,l){if(typeof n=="function"||l===void 0)return super.once(p,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const m=this._createDelegatedListener(p,n,l);for(const v in m.delegates)this.once(v,m.delegates[v]);return this}off(p,n,l){if(typeof n=="function"||l===void 0)return super.off(p,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const m=this._delegatedListeners?this._delegatedListeners[p]:void 0;return m&&(v=>{for(let w=0;w<v.length;w++){const S=v[w];if(S.listener===l&&sx(S.targets,n)){for(const C in S.delegates)this.off(C,S.delegates[C]);return v.splice(w,1),this}}})(m),this}queryRenderedFeatures(p,n){if(!this.style)return[];if(p===void 0||p instanceof o.P||Array.isArray(p)||n!==void 0||(n=p,p=void 0),p=p||[[0,0],[this.transform.width,this.transform.height]],!n){const w=this.style.queryRenderedFeatures(p,void 0,this.transform),S=this.style.queryRenderedFeatureset(p,void 0,this.transform);return w.concat(S)}let l=!0;if(n.target&&(l=this._isTargetValid(n.target),l&&!n.layers))return this.style.queryRenderedFeatureset(p,n,this.transform);let m=!0;if(n.layers&&Array.isArray(n.layers)){for(const w of n.layers)if(!this._isValidId(w)){m=!1;break}if(m&&!n.target)return this.style.queryRenderedFeatures(p,n,this.transform)}let v=[];return m&&(v=v.concat(this.style.queryRenderedFeatures(p,n,this.transform))),l&&(v=v.concat(this.style.queryRenderedFeatureset(p,n,this.transform))),v}querySourceFeatures(p,n){return!p||typeof p=="string"&&!this._isValidId(p)?[]:this.style.querySourceFeatures(p,n)}queryRasterValue(p,n,l){return this._isValidId(p)?this.style.queryRasterValue(p,n,l):Promise.resolve(null)}isPointOnSurface(p){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&o.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(p))}addInteraction(p,n){return this._interactions.add(p,n),this}removeInteraction(p){return this._interactions.remove(p),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(p){return this._cooperativeGestures=p,this}setStyle(p,n){return n=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&p&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(p,(l,m)=>{if(l){const v=typeof l=="string"?l:l instanceof Error?l.message:l.error;o.w(`Unable to perform style diff: ${v}. Rebuilding the style from scratch.`),this._updateStyle(p,n)}else m&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(p,n))}_getUIString(p){const n=this._locale[p];if(n==null)throw new Error(`Missing UI string '${p}'`);return n}_updateStyle(p,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p){const l=Object.assign({},n);n&&n.config&&(l.initialConfig=n.config,delete l.config),this.style=new sl(this,l).load(p),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new sl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(p){return p==null?(this.fire(new o.y(new Error("IDs can't be empty."))),!1):!o.dq(p)||(this.fire(new o.y(new Error(`IDs can't contain special symbols: "${p}".`))),!1)}_isTargetValid(p){return"featuresetId"in p?this._isValidId("importId"in p?p.importId:p.featuresetId):"layerId"in p&&this._isValidId(p.layerId)}_areTargetsValid(p){if(Array.isArray(p)){for(const n of p)if(!this._isValidId(n))return!1;return!0}return this._isTargetValid(p)}addSource(p,n){return this._isValidId(p)?(this._lazyInitEmptyStyle(),this.style.addSource(p,n),this._update(!0)):this}isSourceLoaded(p){return!!this._isValidId(p)&&!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(p,n,l){this._lazyInitEmptyStyle(),this.style.addSourceType(p,n,l)}removeSource(p){return this._isValidId(p)?(this.style.removeSource(p),this._updateTerrain(),this._update(!0)):this}getSource(p){return this._isValidId(p)?this.style.getOwnSource(p):null}addImage(p,n,{pixelRatio:l=1,sdf:m=!1,stretchX:v,stretchY:w,content:S}={}){this._lazyInitEmptyStyle();const C=o.I.from(p);if(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:A,height:M,data:D}=o.o.getImageData(n);this.style.addImage(C,{data:new o.q({width:A,height:M},D),pixelRatio:l,stretchX:v,stretchY:w,content:S,sdf:m,version:0,usvg:!1})}else if(n.width===void 0||n.height===void 0)this.fire(new o.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:M}=n,D=n;this.style.addImage(C,{data:new o.q({width:A,height:M},new Uint8Array(D.data)),pixelRatio:l,stretchX:v,stretchY:w,content:S,sdf:m,usvg:!1,version:0,userImage:D}),D.onAdd&&D.onAdd(this,p)}}updateImage(p,n){this._lazyInitEmptyStyle();const l=o.I.from(p),m=this.style.getImage(l);if(!m)return void this.fire(new o.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?o.o.getImageData(n):n,{width:w,height:S,data:C}=v;if(w===void 0||S===void 0)return void this.fire(new o.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(w!==(m.usvg?m.icon.usvg_tree.width:m.data.width)||S!==(m.usvg?m.icon.usvg_tree.height:m.data.height))return void this.fire(new o.y(new Error(`The width and height of the updated image (${w}, ${S})
                must be that same as the previous version of the image
                (${m.data.width}, ${m.data.height})`)));const A=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);let M=!1;m.usvg?(m.data=new o.q({width:w,height:S},new Uint8Array(C)),m.usvg=!1,m.icon=void 0,M=!0):m.data.replace(C,A),this.style.updateImage(l,m,M)}hasImage(p){return p?!!this.style&&!!this.style.getImage(o.I.from(p)):(this.fire(new o.y(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(o.I.from(p))}loadImage(p,n){o.n(this._requestManager.transformRequest(p,o.R.Image),(l,m)=>{n(l,m instanceof HTMLImageElement?o.o.getImageData(m):m)})}listImages(){return this.style.listImages().map(p=>p.name)}addModel(p,n){this._lazyInitEmptyStyle(),this.style.addModel(p,n)}hasModel(p){return p?this.style.hasModel(p):(this.fire(new o.y(new Error("Missing required model id"))),!1)}removeModel(p){this.style.removeModel(p)}listModels(){return this.style.listModels()}addLayer(p,n){return this._isValidId(p.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(p,n),this._update(!0)):this}getSlot(p){const n=this.getLayer(p);return n&&n.slot||null}setSlot(p,n){return this.style.setSlot(p,n),this.style.mergeLayers(),this._update(!0)}addImport(p,n){return this.style.addImport(p,n).catch(l=>this.fire(new o.y(new Error("Failed to add import",l)))),this}updateImport(p,n){return typeof n!="string"&&n.id!==p?(this.removeImport(p),this.addImport(n)):(this.style.updateImport(p,n),this._update(!0))}removeImport(p){return this.style.removeImport(p),this}moveImport(p,n){return this.style.moveImport(p,n),this._update(!0)}moveLayer(p,n){return this._isValidId(p)?(this.style.moveLayer(p,n),this._update(!0)):this}removeLayer(p){return this._isValidId(p)?(this.style.removeLayer(p),this._update(!0)):this}getLayer(p){if(!this._isValidId(p))return null;const n=this.style.getOwnLayer(p);return n?n.type==="custom"?n.implementation:n.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(p,n,l){return this._isValidId(p)?(this.style.setLayerZoomRange(p,n,l),this._update(!0)):this}setFilter(p,n,l={}){return this._isValidId(p)?(this.style.setFilter(p,n,l),this._update(!0)):this}getFilter(p){return this._isValidId(p)?this.style.getFilter(p):null}setPaintProperty(p,n,l,m={}){return this._isValidId(p)?(this.style.setPaintProperty(p,n,l,m),this._update(!0)):this}getPaintProperty(p,n){return this._isValidId(p)?this.style.getPaintProperty(p,n):null}setLayoutProperty(p,n,l,m={}){return this._isValidId(p)?(this.style.setLayoutProperty(p,n,l,m),this._update(!0)):this}getLayoutProperty(p,n){return this._isValidId(p)?this.style.getLayoutProperty(p,n):null}setLayerProperty(p,n,l,m={}){return this._isValidId(p)?(this.style.setLayerProperty(p,n,l,m),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(p){return this.style.setGlyphsUrl(p),this._update(!0)}getSchema(p){return this.style.getSchema(p)}setSchema(p,n){return this.style.setSchema(p,n),this._update(!0)}getConfig(p){return this.style.getConfig(p)}setConfig(p,n){return this.style.setConfig(p,n),this._update(!0)}getConfigProperty(p,n){return this.style.getConfigProperty(p,n)}setConfigProperty(p,n,l){return this.style.setConfigProperty(p,n,l),this._update(!0)}getFeaturesetDescriptors(p){return this.style.getFeaturesetDescriptors(p)}setLights(p){if(this._lazyInitEmptyStyle(),p&&p.length===1&&p[0].type==="flat"){const n=p[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(p),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const p=this.style.getLights()||[];return p.length===0&&p.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),p}setLight(p,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:p}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(p){return this._lazyInitEmptyStyle(),this.style.setSnow(p),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(p){return this._lazyInitEmptyStyle(),this.style.setRain(p),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(p){return this._lazyInitEmptyStyle(),this.style.setColorTheme(p),this._update(!0)}setImportColorTheme(p,n){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(p,n),this._update(!0)}setCamera(p){return this.style.setCamera(p),this._triggerCameraUpdate(p)}_triggerCameraUpdate(p){return this._update(this.transform.setOrthographicProjectionAtLowPitch(p["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.aS.convert(p),this.transform):0}setFeatureState(p,n){return p.source&&!this._isValidId(p.source)?this:(this.style.setFeatureState(p,n),this._update())}removeFeatureState(p,n){return p.source&&!this._isValidId(p.source)?this:(this.style.removeFeatureState(p,n),this._update())}getFeatureState(p){return p.source&&!this._isValidId(p.source)?null:this.style.getFeatureState(p)}_selectIndoorFloor(p){this.indoor.selectFloor(p)}_setIndoorActiveFloorsVisibility(p){this.indoor.setActiveFloorsVisibility(p)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new nx),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let l,m,v,w=this._container;for(;w&&(!m||!v);){const S=window.getComputedStyle(w).transform;S&&S!=="none"&&(l=S.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(m=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(v=l[3])),w=w.parentElement}this._containerWidth=m?Math.abs(p/m):p,this._containerHeight=v?Math.abs(n/v):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new od(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=H("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=H("div","mapboxgl-canvas-container",p);this._canvas=H("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=H("div","mapboxgl-control-container",p),m=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(v=>{m[v]=H("div",`mapboxgl-ctrl-${v}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,n){const l=o.o.devicePixelRatio||1;this._canvas.width=l*Math.ceil(p),this._canvas.height=l*Math.ceil(n),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${n}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const n=this._markers.indexOf(p);n!==-1&&this._markers.splice(n,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){const n=this._popups.indexOf(p);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const p=Object.assign({},Y.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",p);n?(os(n,!0),this.painter=new bu(n,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.k.testSupport(n)):this.fire(new o.y(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.z("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new o.z("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let n;this.fire(new o.z("renderstart")),++this._frameId;const l=this.painter.context.extTimerQuery,m=o.o.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=v.createQuery(),v.beginQuery(l.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const M=this.transform.zoom,D=this.transform.pitch,F=o.o.now(),O=new o.ac(M,{now:F,fadeDuration:w,pitch:D,transition:this.style.transition,worldview:this._worldview});this.style.update(O)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(m),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(m);const C=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),C&&(this._placementDirty=C.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,N.mark(P.load),this.fire(new o.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const M=o.o.now()-m;v.endQuery(l.TIME_ELAPSED_EXT),setTimeout(()=>{const D=v.getQueryParameter(n,v.QUERY_RESULT)/1e6;v.deleteQuery(n),this.fire(new o.z("gpu-timing-frame",{cpuTime:M,gpuTime:D}))},50)}if(this.listens("gpu-timing-layer")){const M=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(M);this.fire(new o.z("gpu-timing-layer",{layerTimes:D}))},50)}if(this.listens("gpu-timing-deferred-render")){const M=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const D=this.painter.queryGpuTimeDeferredRender(M);this.fire(new o.z("gpu-timing-deferred-render",{gpuTime:D}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(A||this._repaint)this.triggerRepaint();else{const M=this.idle();if(M&&(S=this._updateAverageElevation(m,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new o.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const D=this._calculateSpeedIndex();this.fire(new o.z("speedindexcompleted",{speedIndex:D})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,N.mark(P.fullLoad),this._performanceMetricsCollection&&Vr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(const n of this._markers)p&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!p||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(p,n=!1){const l=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);const m=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(m||(n||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const v=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=p;const S=Math.abs(v-w);if(S>1){if(this._isInitialLoad||m)return this._averageElevation.jumpTo(w),l(w);this._averageElevation.easeTo(w,p,300)}else if(S>1e-4)return this._averageElevation.jumpTo(w),l(w)}return!!this._averageElevation.isEasing(p)&&l(this._averageElevation.getValue(p))}_authenticate(){jn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===be||p.status===401)){const n=this.painter.context.gl;os(n,!1),this._logoControl instanceof Lp&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),it(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&wr(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Wr(this._requestManager._customAccessToken)}_updateTerrain(){const p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const l=this.painter.context.gl,m=l.createFramebuffer();function v(w){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,w,0);const S=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,S),S}return l.bindFramebuffer(l.FRAMEBUFFER,m),this._canvasPixelComparison(v(p),n.canvasCopies.map(v),n.timeStamps)}_canvasPixelComparison(p,n,l){let m=l[1]-l[0];const v=p.length/4;for(let w=0;w<n.length;w++){const S=n[w];let C=0;for(let A=0;A<S.length;A+=4)S[A]===p[A]&&S[A+1]===p[A+1]&&S[A+2]===p[A+2]&&S[A+3]===p[A+3]&&(C+=1);m+=(l[w+2]-l[w+1])*(1-C/v)}return m}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),yn.delete(this.painter.context.gl),Ur.remove(),Vt.remove(),this._removed=!0,this.fire(new o.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=o.o.frame(n=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(n)}))}_preloadTiles(p){const n=this.style?this.style.getSourceCaches():[];return o.bv(n,(l,m)=>l._preloadTiles(p,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(p){this._showParseStatus!==p&&(this._showParseStatus=p,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(p){this._showLayers2DWireframe!==p&&(this._showLayers2DWireframe=p,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(p){this._showLayers3DWireframe!==p&&(this._showLayers3DWireframe=p,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,this._tp.refreshUI(),p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,this._tp.refreshUI(),p&&this._update())}_setCacheLimits(p,n){o.f3(p,n)}get version(){return I}},NavigationControl:class{constructor(p={}){this.options=Object.assign({},Gg,p),this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(o.aX(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),H("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),H("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aX(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:n}):l.resetNorth({},{originalEvent:n}))}),this._compassIcon=H("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const n=p.getZoom(),l=n===p.getMaxZoom(),m=n===p.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Fp(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,n){const l=H("button",p,this._container);return l.type="button",l.addEventListener("click",n),l}_setButtonTitle(p,n){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${n}`);p.setAttribute("aria-label",l),p.firstElementChild&&p.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends o.E{constructor(p={}){super();const n=navigator.geolocation;this.options=Object.assign({geolocation:n},kl,p),o.aX(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=md(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){const n=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,p(l)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(l=>n(l.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(p){const n=this._map.getMaxBounds(),l=p.coords;return!!n&&(l.longitude<n.getWest()||l.longitude>n.getEast()||l.latitude<n.getSouth()||l.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new o.z("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("geolocate",Object.assign({coords:p.coords,timestamp:p.timestamp},p.toJSON?{toJSON:p.toJSON.bind(p)}:{}))),this._finish()}}_updateCamera(p){const n=new o.aS(p.coords.longitude,p.coords.latitude),l=p.coords.accuracy,m=this._map.getBearing(),v=Object.assign({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(l),v,{geolocateSource:!0})}_updateMarker(p){if(p){const n=new o.aS(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,n=o.ce(1,p._center.lat)*p.worldSize,l=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=H("button","mapboxgl-ctrl-geolocate",this._container),H("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=H("div","mapboxgl-user-location"),this._dotElement.appendChild(H("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(H("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ic({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=H("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ic({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.z("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Dh,ScaleControl:class{constructor(p={}){this.options=Object.assign({},iE,p),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aX(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,n=this._map,l=n._containerHeight/2,m=n._containerWidth/2-p/2,v=n.unproject([m,l]),w=n.unproject([m+p,l]),S=v.distanceTo(w);if(this.options.unit==="imperial"){const C=3.2808*S;C>5280?this._setScale(p,C/5280,"mile"):this._setScale(p,C,"foot")}else this.options.unit==="nautical"?this._setScale(p,S/1852,"nautical-mile"):S>=1e3?this._setScale(p,S/1e3,"kilometer"):this._setScale(p,S,"meter")}_setScale(p,n,l){this._map._requestDomTask(()=>{const m=function(w){const S=Math.pow(10,`${Math.floor(w)}`.length-1);let C=w/S;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(A){const M=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*M)/M}(C),S*C}(n),v=m/n;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(m):`${m}&nbsp;${sE[l]}`,this._container.style.width=p*v+"px"})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p={}){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:o.w("Full screen control 'container' must be a DOM element.")),o.aX(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=H("button","mapboxgl-ctrl-fullscreen",this._controlContainer);H("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:nx,Popup:class extends o.E{constructor(p){super(),this.options=Object.assign(Object.create(oE),p),this._altitude=this.options.altitude,o.aX(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new o.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new o.z("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=o.aS.convert(p),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(p){return this._altitude=p,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const n=document.createDocumentFragment(),l=document.createElement("body");let m;for(l.innerHTML=p;m=l.firstChild,m;)n.appendChild(m);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=H("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(p),this.options.closeButton){const l=this._closeButton=H("button","mapboxgl-popup-close-button",n);l.type="button",l.setAttribute("aria-label","Close popup"),l.innerHTML='<span aria-hidden="true">&#215;</span>',l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let n;return this._classList.delete(p)?n=!1:(this._classList.add(p),n=!0),this._updateClassList(),n}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const n=this._map,l=this._container,m=this._pos;if(!n||!l||!m)return"bottom";const v=l.offsetWidth,w=l.offsetHeight,S=m.x<v/2,C=m.x>n.transform.width-v/2;if(m.y+p<w)return S?"top-left":C?"top-right":"top";if(m.y>n.transform.height-w){if(S)return"bottom-left";if(C)return"bottom-right"}return S?"left":C?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),p.className=n.join(" ")}_update(p){const n=this._map,l=this._content;if(!n||!this._lngLat&&!this._trackPointer||!l)return;let m=this._container;if(m||(m=this._container=H("div","mapboxgl-popup",n.getContainer()),this._tip=H("div","mapboxgl-popup-tip",m),m.appendChild(l)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ac(this._lngLat,this._pos,n.transform)),!this._trackPointer||p){const v=this._pos=this._trackPointer&&p instanceof o.P?p:n.project(this._lngLat,this._altitude),w=ox(this.options.offset),S=this._anchor=this._getAnchor(w.y),C=ox(this.options.offset,S),A=v.add(C).round();n._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${Pl[S]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&n._showingGlobe()){const v=o.f4(n.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(aE);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:Ic,Style:sl,LngLat:o.aS,LngLatBounds:o.aI,Point:o.P,MercatorCoordinate:o.ae,FreeCameraOptions:Yl,Evented:o.E,config:o.e,prewarm:o.f8,clearPrewarmedResources:o.f7,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(p){o.e.ACCESS_TOKEN=p},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(p){o.e.API_URL=p},get workerCount(){return o.fh.workerCount},set workerCount(p){o.fh.workerCount=p},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){o.e.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){o.fg(p)},get workerUrl(){return o.ff.workerUrl},set workerUrl(p){o.ff.workerUrl=p},get workerClass(){return o.ff.workerClass},set workerClass(p){o.ff.workerClass=p},get workerParams(){return o.ff.workerParams},set workerParams(p){o.ff.workerParams=p},get dracoUrl(){return o.fe()},set dracoUrl(p){o.fd(p)},get meshoptUrl(){return o.fc()},set meshoptUrl(p){o.fb(p)},setNow:o.o.setNow,restoreNow:o.o.restoreNow}});var x=f;return x})})(IU);var Mne=IU.exports;const Nu=MP(Mne);function Dne(){const e=cu(),t=V.useRef(null),i=V.useRef(null),[c,f]=V.useState([]),[_,x]=V.useState([]),[o,I]=V.useState([]),[P,N]=V.useState(!0),[U,$]=V.useState(null);V.useState("all"),V.useState("all"),V.useState("all"),V.useState("all");const[B,Y]=V.useState({sla_dia:0,incidentes_critico:0,incidentes_alto:0,incidentes_medio:0,chamados_urgente:0,chamados_alto:0,chamados_medio:0,postos_cobertos:0,postos_total:0,variacao_presenca:0,preventivas_prazo:0,nps_7d:0,nps_30d:0,inspecoes_total:0});V.useEffect(()=>{H()},[]),V.useEffect(()=>{c.length>0&&lt()},[c]);const H=async()=>{try{const{data:{user:Me}}=await Qe.auth.getUser();if(!Me){e("/auth");return}const{data:be}=await Qe.from("user_roles").select("role").eq("user_id",Me.id).single();$((be==null?void 0:be.role)||null),await Promise.all([K(be==null?void 0:be.role),Ee(be==null?void 0:be.role),Ne(be==null?void 0:be.role),xe()])}catch(Me){console.error("Error:",Me),mr.error("Erro ao carregar dados")}finally{N(!1)}},K=async Me=>{try{let be=Qe.from("unidades").select(`
          id,
          nome,
          codigo,
          latitude,
          longitude,
          cidade,
          uf,
          contrato_id,
          contratos (
            nome,
            sla_alvo_pct,
            cliente_id,
            clientes (
              razao_social
            )
          )
        `).eq("status","ativo").not("latitude","is",null).not("longitude","is",null);const{data:je,error:Ye}=await be;if(Ye)throw Ye;const qe=await Promise.all((je||[]).map(async We=>{var it,ir,wr,Bt;const[$e,_t,mt,rt]=await Promise.all([G(We.id),X(We.id),ue(We.id),re(We.id)]),Tt=rt.cobertos,Vt=rt.total>0?Math.round(Tt/rt.total*100):0;return{id:We.id,nome:We.nome,codigo:We.codigo,latitude:Number(We.latitude),longitude:Number(We.longitude),cidade:We.cidade||"",uf:We.uf||"",contrato:{nome:((it=We.contratos)==null?void 0:it.nome)||"Sem contrato",cliente:{razao_social:((wr=(ir=We.contratos)==null?void 0:ir.clientes)==null?void 0:wr.razao_social)||"Sem cliente"}},sla_atual:$e,chamados_abertos:_t,nps_atual:mt,postos_vagos:rt.vagos,total_postos:rt.total,postos_preenchidos:Tt,porcentagem_ocupacao:Vt,meta_sla:((Bt=We.contratos)==null?void 0:Bt.sla_alvo_pct)||null}}));f(qe)}catch(be){console.error("Error loading unidades:",be),mr.error("Erro ao carregar unidades")}},re=async Me=>{try{const{data:be,error:je}=await Qe.from("postos_servico").select("id, efetivo_planejado, escala").eq("unidade_id",Me).eq("status","ativo");if(je)throw je;if(!be||be.length===0)return{total:0,vagos:0,cobertos:0};let Ye=0,qe=0;for(const We of be){const $e=Py(We);qe+=$e;const{count:_t}=await Qe.from("colaboradores").select("id",{count:"exact",head:!0}).eq("posto_servico_id",We.id).eq("status","ativo"),rt=SP(_t||0,We),Tt=rt.efetivoNecessario-rt.efetivoConsiderado;Ye+=Tt}return{total:qe,vagos:Ye,cobertos:qe-Ye}}catch(be){return console.error("Error getting postos info:",be),{total:0,vagos:0,cobertos:0}}},G=async Me=>{const{data:be}=await Qe.from("ordens_servico").select("status").eq("unidade_id",Me);if(!be||be.length===0)return 100;const je=be.filter(Ye=>Ye.status==="concluida").length;return Math.round(je/be.length*100)},X=async Me=>{const{count:be}=await Qe.from("chamados").select("*",{count:"exact",head:!0}).eq("unidade_id",Me).in("status",["aberto","em_andamento"]);return be||0},ue=async Me=>{const{data:be}=await Qe.from("chamados").select("avaliacao").eq("unidade_id",Me).not("avaliacao","is",null).gte("created_at",new Date(Date.now()-6048e5).toISOString());if(!be||be.length===0)return 0;const je=be.filter(qe=>qe.avaliacao>=9).length,Ye=be.filter(qe=>qe.avaliacao<=6).length;return Math.round((je-Ye)/be.length*100)},Ee=async Me=>{try{const{data:be}=await Qe.from("ordens_servico").select("status").gte("data_abertura",new Date().toISOString().split("T")[0]),je=be&&be.length>0?Math.round(be.filter(Bt=>Bt.status==="concluida").length/be.length*100):100,{data:Ye}=await Qe.from("incidentes").select("severidade").in("status",["aberto","em_investigacao"]),{data:qe}=await Qe.from("chamados").select("prioridade").in("status",["aberto","em_andamento"]),{data:We}=await Qe.from("postos_servico").select("id, efetivo_planejado, escala").eq("status","ativo");let $e=0,_t=0;if(We)for(const Bt of We){const Wr=Py(Bt);$e+=Wr;const{count:Er}=await Qe.from("colaboradores").select("*",{count:"exact",head:!0}).eq("posto_servico_id",Bt.id).eq("status","ativo"),Vr=Er||0,{efetivoConsiderado:Ur}=SP(Vr,Bt);_t+=Ur}const{data:mt}=await Qe.from("ordens_servico").select("data_prevista, data_conclusao").eq("tipo","preventiva").eq("status","concluida").gte("created_at",new Date(Date.now()-30*24*60*60*1e3).toISOString()),rt=mt?mt.filter(Bt=>Bt.data_conclusao&&Bt.data_prevista&&new Date(Bt.data_conclusao)<=new Date(Bt.data_prevista)).length:0,Tt=mt&&mt.length>0?Math.round(rt/mt.length*100):100,{data:Vt}=await Qe.from("chamados").select("avaliacao").not("avaliacao","is",null).gte("created_at",new Date(Date.now()-7*24*60*60*1e3).toISOString()),{data:it}=await Qe.from("chamados").select("avaliacao").not("avaliacao","is",null).gte("created_at",new Date(Date.now()-30*24*60*60*1e3).toISOString()),{count:ir}=await Qe.from("inspecoes").select("*",{count:"exact",head:!0}),wr=Bt=>{if(!Bt||Bt.length===0)return 0;const Wr=Bt.filter(Vr=>Vr.avaliacao>=9).length,Er=Bt.filter(Vr=>Vr.avaliacao<=6).length;return Math.round((Wr-Er)/Bt.length*100)};Y({sla_dia:je,incidentes_critico:(Ye==null?void 0:Ye.filter(Bt=>Bt.severidade==="critica").length)||0,incidentes_alto:(Ye==null?void 0:Ye.filter(Bt=>Bt.severidade==="alta").length)||0,incidentes_medio:(Ye==null?void 0:Ye.filter(Bt=>Bt.severidade==="media").length)||0,chamados_urgente:(qe==null?void 0:qe.filter(Bt=>Bt.prioridade==="urgente").length)||0,chamados_alto:(qe==null?void 0:qe.filter(Bt=>Bt.prioridade==="alta").length)||0,chamados_medio:(qe==null?void 0:qe.filter(Bt=>Bt.prioridade==="media").length)||0,postos_cobertos:_t,postos_total:$e,variacao_presenca:95,preventivas_prazo:Tt,nps_7d:wr(Vt||[]),nps_30d:wr(it||[]),inspecoes_total:ir||0})}catch(be){console.error("Error loading stats:",be)}},xe=async()=>{try{const{data:Me,error:be}=await Qe.from("checklist_execucoes").select(`
          id,
          checklist_id,
          data_execucao,
          status,
          observacoes,
          checklist:checklists ( nome ),
          colaborador:colaboradores ( nome_completo )
        `).order("data_execucao",{ascending:!1});if(be)throw be;I(Me||[])}catch(Me){console.error("Error loading checklist executions:",Me)}},Ne=async Me=>{try{const{data:be}=await Qe.from("incidentes").select(`
          id,
          numero,
          titulo,
          severidade,
          status,
          created_at,
          unidade:unidades(nome),
          cliente:unidades(contratos(clientes(razao_social)))
        `).in("status",["aberto","em_investigacao"]).order("created_at",{ascending:!1}).limit(10),{data:je}=await Qe.from("chamados").select(`
          id,
          numero,
          titulo,
          prioridade,
          status,
          created_at,
          unidade:unidades(nome),
          cliente:unidades(contratos(clientes(razao_social)))
        `).in("status",["aberto","em_andamento"]).order("created_at",{ascending:!1}).limit(10),Ye=[...(be||[]).map(qe=>{var We,$e,_t,mt;return{id:qe.id,timestamp:qe.created_at,tipo:"Incidente",cliente:((_t=($e=(We=qe.cliente)==null?void 0:We.contratos)==null?void 0:$e.clientes)==null?void 0:_t.razao_social)||"N/A",unidade:((mt=qe.unidade)==null?void 0:mt.nome)||"N/A",status:qe.status,severidade:qe.severidade,descricao:qe.titulo}}),...(je||[]).map(qe=>{var We,$e,_t,mt;return{id:qe.id,timestamp:qe.created_at,tipo:"Chamado",cliente:((_t=($e=(We=qe.cliente)==null?void 0:We.contratos)==null?void 0:$e.clientes)==null?void 0:_t.razao_social)||"N/A",unidade:((mt=qe.unidade)==null?void 0:mt.nome)||"N/A",status:qe.status,severidade:qe.prioridade,descricao:qe.titulo}})].sort((qe,We)=>new Date(We.timestamp).getTime()-new Date(qe.timestamp).getTime());x(Ye)}catch(be){console.error("Error loading alertas:",be)}},lt=async()=>{if(!(!t.current||i.current))try{const{data:Me,error:be}=await Qe.functions.invoke("get-mapbox-token");if(be||!(Me!=null&&Me.token)){mr.error("Erro ao carregar token do Mapbox");return}Nu.accessToken=Me.token,i.current=new Nu.Map({container:t.current,style:"mapbox://styles/mapbox/light-v11",center:[-47.9292,-15.7801],zoom:4}),i.current.addControl(new Nu.NavigationControl,"top-right"),c.forEach(je=>{if(!i.current)return;const Ye=document.createElement("div");Ye.className="marker",Ye.style.backgroundColor=Pt(je.porcentagem_ocupacao),Ye.style.width="24px",Ye.style.height="24px",Ye.style.borderRadius="50%",Ye.style.border="3px solid white",Ye.style.cursor="pointer",Ye.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)";const qe=new Nu.Marker(Ye).setLngLat([je.longitude,je.latitude]).addTo(i.current),We=new Nu.Popup({offset:25}).setHTML(`<div style="padding: 12px; min-width: 200px;">
            <h3 style="font-weight: bold; margin-bottom: 8px; font-size: 14px;">${je.nome}</h3>
            <p style="font-size: 12px; color: #666; margin-bottom: 8px;">${je.cidade}/${je.uf}</p>
            <div style="border-top: 1px solid #e5e7eb; padding-top: 8px;">
              <p style="font-size: 12px; margin-bottom: 4px;">Meta de SLA: <strong>${je.meta_sla??"N/A"}${je.meta_sla?"%":""}</strong></p>
              <p style="font-size: 12px; margin-bottom: 4px;">Postos Preenchidos: <strong>${je.postos_preenchidos}/${je.total_postos}</strong></p>
              <p style="font-size: 12px;">Taxa de Ocupao: <strong style="color: ${je.porcentagem_ocupacao>=90?"#22c55e":je.porcentagem_ocupacao>=70?"#eab308":"#ef4444"};">${je.porcentagem_ocupacao}%</strong></p>
            </div>
          </div>`);qe.setPopup(We)})}catch(Me){console.error("Error initializing map:",Me),mr.error("Erro ao inicializar mapa")}},Pt=Me=>Me>=100?"#22c55e":Me>=70?"#eab308":"#ef4444",tt=Me=>({critica:"destructive",urgente:"destructive",alta:"destructive",media:"secondary",baixa:"default"})[Me]||"default",yt=Me=>Me==="concluido"?"default":Me==="em_andamento"?"secondary":"outline";return P?h.jsx($o,{children:h.jsx("div",{className:"flex items-center justify-center h-screen",children:h.jsxs("div",{className:"text-center",children:[h.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),h.jsx("p",{className:"text-muted-foreground",children:"Carregando dashboard..."})]})})}):h.jsx($o,{children:h.jsxs("div",{className:"min-h-screen bg-background p-6 space-y-6",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard 24/7  Resumo Executivo"}),h.jsx("p",{className:"text-muted-foreground",children:"Monitoramento em tempo real"})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx($u,{className:"h-4 w-4 text-muted-foreground"}),h.jsx("span",{className:"text-sm text-muted-foreground",children:new Date().toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[h.jsxs(kr,{children:[h.jsx(Mn,{children:h.jsxs(Zn,{className:"flex items-center gap-2",children:[h.jsx(vm,{className:"h-5 w-5 text-destructive"}),"Incidentes por Severidade (Disponvel em breve!)"]})}),h.jsxs(tn,{className:"space-y-2",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("span",{className:"text-sm",children:"Crtico"}),h.jsx(ai,{variant:"destructive",children:B.incidentes_critico})]}),h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("span",{className:"text-sm",children:"Alto"}),h.jsx(ai,{variant:"destructive",children:B.incidentes_alto})]}),h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("span",{className:"text-sm",children:"Mdio"}),h.jsx(ai,{variant:"secondary",children:B.incidentes_medio})]})]})]}),h.jsxs(kr,{children:[h.jsx(Mn,{children:h.jsxs(Zn,{className:"flex items-center gap-2",children:[h.jsx(G0,{className:"h-5 w-5 text-primary"}),"Chamados por Prioridade"]})}),h.jsxs(tn,{className:"space-y-2",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("span",{className:"text-sm",children:"Urgente"}),h.jsx(ai,{variant:"destructive",children:B.chamados_urgente})]}),h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("span",{className:"text-sm",children:"Alta"}),h.jsx(ai,{variant:"destructive",children:B.chamados_alto})]}),h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("span",{className:"text-sm",children:"Mdia"}),h.jsx(ai,{variant:"secondary",children:B.chamados_medio})]})]})]})]}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[h.jsxs(kr,{className:"h-[500px]",children:[h.jsxs(Mn,{children:[h.jsx(Zn,{children:"Feed de Alertas ao Vivo"}),h.jsx(Xa,{children:"Atualizaes em tempo real"})]}),h.jsx(tn,{className:"h-[calc(100%-100px)] overflow-y-auto space-y-3",children:_.map(Me=>h.jsxs("div",{className:`p-3 rounded-lg border ${Me.severidade==="critica"||Me.severidade==="urgente"?"bg-red-50 border-red-200":Me.severidade==="alta"?"bg-yellow-50 border-yellow-200":"bg-background border-border"}`,children:[h.jsxs("div",{className:"flex items-start justify-between mb-2",children:[h.jsx(ai,{variant:tt(Me.severidade),children:Me.tipo}),h.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(Me.timestamp).toLocaleTimeString("pt-BR")})]}),h.jsx("p",{className:"text-sm font-medium mb-1",children:Me.descricao}),h.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[h.jsxs("div",{children:[h.jsx("strong",{children:"Cliente:"})," ",Me.cliente]}),h.jsxs("div",{children:[h.jsx("strong",{children:"Unidade:"})," ",Me.unidade]}),h.jsxs("div",{children:[h.jsx("strong",{children:"Status:"})," ",Me.status]})]}),h.jsx(tr,{size:"sm",variant:"outline",className:"w-full mt-2",onClick:()=>e("/chamados"),children:"Ver Detalhes"})]},Me.id))})]}),h.jsxs(kr,{className:"h-[500px]",children:[h.jsxs(Mn,{children:[h.jsx(Zn,{children:"Execuo de Checklists"}),h.jsx(Xa,{children:"Acompanhamento das execues registradas"})]}),h.jsxs(tn,{className:"h-[calc(100%-100px)] overflow-y-auto space-y-3",children:[o.length===0&&h.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhuma execuo de checklist cadastrada at o momento."}),o.map(Me=>{var be,je;return h.jsxs("div",{className:"p-3 rounded-lg border bg-background space-y-2",children:[h.jsxs("div",{className:"flex items-start justify-between gap-2",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-semibold",children:((be=Me.checklist)==null?void 0:be.nome)||`Checklist ${Me.checklist_id??"-"}`}),h.jsx("p",{className:"text-xs text-muted-foreground",children:(je=Me.colaborador)!=null&&je.nome_completo?`Responsvel: ${Me.colaborador.nome_completo}`:"Responsvel no informado"})]}),h.jsx(ai,{variant:yt(Me.status),className:"capitalize",children:Me.status?Me.status.replace("_"," "):"sem status"})]}),h.jsx("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:h.jsxs("span",{children:["Execuo:"," ",Me.data_execucao?new Date(Me.data_execucao).toLocaleString("pt-BR"):"-"]})}),Me.observacoes&&h.jsxs("p",{className:"text-xs text-muted-foreground line-clamp-2",children:["Observaes: ",Me.observacoes]})]},Me.id)})]}),h.jsx("div",{className:"px-6 pb-6",children:h.jsx(tr,{className:"w-full",variant:"outline",onClick:()=>e("/checklist-execucoes"),children:"Gerenciar execues"})})]})]})]})})}function Mz(e,[t,i]){return Math.min(i,Math.max(t,e))}var Nne=V.createContext(void 0);function yj(e){const t=V.useContext(Nne);return e||t||"ltr"}function One(e){const t=V.useRef({value:e,previous:e});return V.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var Lne=[" ","Enter","ArrowUp","ArrowDown"],zne=[" ","Enter"],Mm="Select",[f2,p2,Fne]=Pk(Mm),[$y,Oce]=Xd(Mm,[Fne,e2]),m2=e2(),[Bne,Zf]=$y(Mm),[Vne,Une]=$y(Mm),kU=e=>{const{__scopeSelect:t,children:i,open:c,defaultOpen:f,onOpenChange:_,value:x,defaultValue:o,onValueChange:I,dir:P,name:N,autoComplete:U,disabled:$,required:B,form:Y}=e,H=m2(t),[K,re]=V.useState(null),[G,X]=V.useState(null),[ue,Ee]=V.useState(!1),xe=yj(P),[Ne,lt]=Em({prop:c,defaultProp:f??!1,onChange:_,caller:Mm}),[Pt,tt]=Em({prop:x,defaultProp:o,onChange:I,caller:Mm}),yt=V.useRef(null),Me=K?Y||!!K.closest("form"):!0,[be,je]=V.useState(new Set),Ye=Array.from(be).map(qe=>qe.props.value).join(";");return h.jsx(Z4,{...H,children:h.jsxs(Bne,{required:B,scope:t,trigger:K,onTriggerChange:re,valueNode:G,onValueNodeChange:X,valueNodeHasChildren:ue,onValueNodeHasChildrenChange:Ee,contentId:zd(),value:Pt,onValueChange:tt,open:Ne,onOpenChange:lt,dir:xe,triggerPointerDownPosRef:yt,disabled:$,children:[h.jsx(f2.Provider,{scope:t,children:h.jsx(Vne,{scope:e.__scopeSelect,onNativeOptionAdd:V.useCallback(qe=>{je(We=>new Set(We).add(qe))},[]),onNativeOptionRemove:V.useCallback(qe=>{je(We=>{const $e=new Set(We);return $e.delete(qe),$e})},[]),children:i})}),Me?h.jsxs(e6,{"aria-hidden":!0,required:B,tabIndex:-1,name:N,autoComplete:U,value:Pt,onChange:qe=>tt(qe.target.value),disabled:$,form:Y,children:[Pt===void 0?h.jsx("option",{value:""}):null,Array.from(be)]},Ye):null]})})};kU.displayName=Mm;var jU="SelectTrigger",RU=V.forwardRef((e,t)=>{const{__scopeSelect:i,disabled:c=!1,...f}=e,_=m2(i),x=Zf(jU,i),o=x.disabled||c,I=vs(t,x.onTriggerChange),P=p2(i),N=V.useRef("touch"),[U,$,B]=r6(H=>{const K=P().filter(X=>!X.disabled),re=K.find(X=>X.value===x.value),G=n6(K,H,re);G!==void 0&&x.onValueChange(G.value)}),Y=H=>{o||(x.onOpenChange(!0),B()),H&&(x.triggerPointerDownPosRef.current={x:Math.round(H.pageX),y:Math.round(H.pageY)})};return h.jsx(X4,{asChild:!0,..._,children:h.jsx(xi.button,{type:"button",role:"combobox","aria-controls":x.contentId,"aria-expanded":x.open,"aria-required":x.required,"aria-autocomplete":"none",dir:x.dir,"data-state":x.open?"open":"closed",disabled:o,"data-disabled":o?"":void 0,"data-placeholder":t6(x.value)?"":void 0,...f,ref:I,onClick:Un(f.onClick,H=>{H.currentTarget.focus(),N.current!=="mouse"&&Y(H)}),onPointerDown:Un(f.onPointerDown,H=>{N.current=H.pointerType;const K=H.target;K.hasPointerCapture(H.pointerId)&&K.releasePointerCapture(H.pointerId),H.button===0&&H.ctrlKey===!1&&H.pointerType==="mouse"&&(Y(H),H.preventDefault())}),onKeyDown:Un(f.onKeyDown,H=>{const K=U.current!=="";!(H.ctrlKey||H.altKey||H.metaKey)&&H.key.length===1&&$(H.key),!(K&&H.key===" ")&&Lne.includes(H.key)&&(Y(),H.preventDefault())})})})});RU.displayName=jU;var MU="SelectValue",DU=V.forwardRef((e,t)=>{const{__scopeSelect:i,className:c,style:f,children:_,placeholder:x="",...o}=e,I=Zf(MU,i),{onValueNodeHasChildrenChange:P}=I,N=_!==void 0,U=vs(t,I.onValueNodeChange);return ca(()=>{P(N)},[P,N]),h.jsx(xi.span,{...o,ref:U,style:{pointerEvents:"none"},children:t6(I.value)?h.jsx(h.Fragment,{children:x}):_})});DU.displayName=MU;var $ne="SelectIcon",NU=V.forwardRef((e,t)=>{const{__scopeSelect:i,children:c,...f}=e;return h.jsx(xi.span,{"aria-hidden":!0,...f,ref:t,children:c||""})});NU.displayName=$ne;var qne="SelectPortal",OU=e=>h.jsx(HT,{asChild:!0,...e});OU.displayName=qne;var Dm="SelectContent",LU=V.forwardRef((e,t)=>{const i=Zf(Dm,e.__scopeSelect),[c,f]=V.useState();if(ca(()=>{f(new DocumentFragment)},[]),!i.open){const _=c;return _?zm.createPortal(h.jsx(zU,{scope:e.__scopeSelect,children:h.jsx(f2.Slot,{scope:e.__scopeSelect,children:h.jsx("div",{children:e.children})})}),_):null}return h.jsx(FU,{...e,ref:t})});LU.displayName=Dm;var Fc=10,[zU,Xf]=$y(Dm),Gne="SelectContentImpl",Wne=vy("SelectContent.RemoveScroll"),FU=V.forwardRef((e,t)=>{const{__scopeSelect:i,position:c="item-aligned",onCloseAutoFocus:f,onEscapeKeyDown:_,onPointerDownOutside:x,side:o,sideOffset:I,align:P,alignOffset:N,arrowPadding:U,collisionBoundary:$,collisionPadding:B,sticky:Y,hideWhenDetached:H,avoidCollisions:K,...re}=e,G=Zf(Dm,i),[X,ue]=V.useState(null),[Ee,xe]=V.useState(null),Ne=vs(t,Bt=>ue(Bt)),[lt,Pt]=V.useState(null),[tt,yt]=V.useState(null),Me=p2(i),[be,je]=V.useState(!1),Ye=V.useRef(!1);V.useEffect(()=>{if(X)return HV(X)},[X]),FV();const qe=V.useCallback(Bt=>{const[Wr,...Er]=Me().map(jn=>jn.ref.current),[Vr]=Er.slice(-1),Ur=document.activeElement;for(const jn of Bt)if(jn===Ur||(jn==null||jn.scrollIntoView({block:"nearest"}),jn===Wr&&Ee&&(Ee.scrollTop=0),jn===Vr&&Ee&&(Ee.scrollTop=Ee.scrollHeight),jn==null||jn.focus(),document.activeElement!==Ur))return},[Me,Ee]),We=V.useCallback(()=>qe([lt,X]),[qe,lt,X]);V.useEffect(()=>{be&&We()},[be,We]);const{onOpenChange:$e,triggerPointerDownPosRef:_t}=G;V.useEffect(()=>{if(X){let Bt={x:0,y:0};const Wr=Vr=>{var Ur,jn;Bt={x:Math.abs(Math.round(Vr.pageX)-(((Ur=_t.current)==null?void 0:Ur.x)??0)),y:Math.abs(Math.round(Vr.pageY)-(((jn=_t.current)==null?void 0:jn.y)??0))}},Er=Vr=>{Bt.x<=10&&Bt.y<=10?Vr.preventDefault():X.contains(Vr.target)||$e(!1),document.removeEventListener("pointermove",Wr),_t.current=null};return _t.current!==null&&(document.addEventListener("pointermove",Wr),document.addEventListener("pointerup",Er,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Wr),document.removeEventListener("pointerup",Er,{capture:!0})}}},[X,$e,_t]),V.useEffect(()=>{const Bt=()=>$e(!1);return window.addEventListener("blur",Bt),window.addEventListener("resize",Bt),()=>{window.removeEventListener("blur",Bt),window.removeEventListener("resize",Bt)}},[$e]);const[mt,rt]=r6(Bt=>{const Wr=Me().filter(Ur=>!Ur.disabled),Er=Wr.find(Ur=>Ur.ref.current===document.activeElement),Vr=n6(Wr,Bt,Er);Vr&&setTimeout(()=>Vr.ref.current.focus())}),Tt=V.useCallback((Bt,Wr,Er)=>{const Vr=!Ye.current&&!Er;(G.value!==void 0&&G.value===Wr||Vr)&&(Pt(Bt),Vr&&(Ye.current=!0))},[G.value]),Vt=V.useCallback(()=>X==null?void 0:X.focus(),[X]),it=V.useCallback((Bt,Wr,Er)=>{const Vr=!Ye.current&&!Er;(G.value!==void 0&&G.value===Wr||Vr)&&yt(Bt)},[G.value]),ir=c==="popper"?TP:BU,wr=ir===TP?{side:o,sideOffset:I,align:P,alignOffset:N,arrowPadding:U,collisionBoundary:$,collisionPadding:B,sticky:Y,hideWhenDetached:H,avoidCollisions:K}:{};return h.jsx(zU,{scope:i,content:X,viewport:Ee,onViewportChange:xe,itemRefCallback:Tt,selectedItem:lt,onItemLeave:Vt,itemTextRefCallback:it,focusSelectedItem:We,selectedItemText:tt,position:c,isPositioned:be,searchRef:mt,children:h.jsx(hj,{as:Wne,allowPinchZoom:!0,children:h.jsx(dj,{asChild:!0,trapped:G.open,onMountAutoFocus:Bt=>{Bt.preventDefault()},onUnmountAutoFocus:Un(f,Bt=>{var Wr;(Wr=G.trigger)==null||Wr.focus({preventScroll:!0}),Bt.preventDefault()}),children:h.jsx(gb,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:_,onPointerDownOutside:x,onFocusOutside:Bt=>Bt.preventDefault(),onDismiss:()=>G.onOpenChange(!1),children:h.jsx(ir,{role:"listbox",id:G.contentId,"data-state":G.open?"open":"closed",dir:G.dir,onContextMenu:Bt=>Bt.preventDefault(),...re,...wr,onPlaced:()=>je(!0),ref:Ne,style:{display:"flex",flexDirection:"column",outline:"none",...re.style},onKeyDown:Un(re.onKeyDown,Bt=>{const Wr=Bt.ctrlKey||Bt.altKey||Bt.metaKey;if(Bt.key==="Tab"&&Bt.preventDefault(),!Wr&&Bt.key.length===1&&rt(Bt.key),["ArrowUp","ArrowDown","Home","End"].includes(Bt.key)){let Vr=Me().filter(Ur=>!Ur.disabled).map(Ur=>Ur.ref.current);if(["ArrowUp","End"].includes(Bt.key)&&(Vr=Vr.slice().reverse()),["ArrowUp","ArrowDown"].includes(Bt.key)){const Ur=Bt.target,jn=Vr.indexOf(Ur);Vr=Vr.slice(jn+1)}setTimeout(()=>qe(Vr)),Bt.preventDefault()}})})})})})})});FU.displayName=Gne;var Hne="SelectItemAlignedPosition",BU=V.forwardRef((e,t)=>{const{__scopeSelect:i,onPlaced:c,...f}=e,_=Zf(Dm,i),x=Xf(Dm,i),[o,I]=V.useState(null),[P,N]=V.useState(null),U=vs(t,Ne=>N(Ne)),$=p2(i),B=V.useRef(!1),Y=V.useRef(!0),{viewport:H,selectedItem:K,selectedItemText:re,focusSelectedItem:G}=x,X=V.useCallback(()=>{if(_.trigger&&_.valueNode&&o&&P&&H&&K&&re){const Ne=_.trigger.getBoundingClientRect(),lt=P.getBoundingClientRect(),Pt=_.valueNode.getBoundingClientRect(),tt=re.getBoundingClientRect();if(_.dir!=="rtl"){const Ur=tt.left-lt.left,jn=Pt.left-Ur,yn=Ne.left-jn,os=Ne.width+yn,qi=Math.max(os,lt.width),ps=window.innerWidth-Fc,Os=Mz(jn,[Fc,Math.max(Fc,ps-qi)]);o.style.minWidth=os+"px",o.style.left=Os+"px"}else{const Ur=lt.right-tt.right,jn=window.innerWidth-Pt.right-Ur,yn=window.innerWidth-Ne.right-jn,os=Ne.width+yn,qi=Math.max(os,lt.width),ps=window.innerWidth-Fc,Os=Mz(jn,[Fc,Math.max(Fc,ps-qi)]);o.style.minWidth=os+"px",o.style.right=Os+"px"}const yt=$(),Me=window.innerHeight-Fc*2,be=H.scrollHeight,je=window.getComputedStyle(P),Ye=parseInt(je.borderTopWidth,10),qe=parseInt(je.paddingTop,10),We=parseInt(je.borderBottomWidth,10),$e=parseInt(je.paddingBottom,10),_t=Ye+qe+be+$e+We,mt=Math.min(K.offsetHeight*5,_t),rt=window.getComputedStyle(H),Tt=parseInt(rt.paddingTop,10),Vt=parseInt(rt.paddingBottom,10),it=Ne.top+Ne.height/2-Fc,ir=Me-it,wr=K.offsetHeight/2,Bt=K.offsetTop+wr,Wr=Ye+qe+Bt,Er=_t-Wr;if(Wr<=it){const Ur=yt.length>0&&K===yt[yt.length-1].ref.current;o.style.bottom="0px";const jn=P.clientHeight-H.offsetTop-H.offsetHeight,yn=Math.max(ir,wr+(Ur?Vt:0)+jn+We),os=Wr+yn;o.style.height=os+"px"}else{const Ur=yt.length>0&&K===yt[0].ref.current;o.style.top="0px";const yn=Math.max(it,Ye+H.offsetTop+(Ur?Tt:0)+wr)+Er;o.style.height=yn+"px",H.scrollTop=Wr-it+H.offsetTop}o.style.margin=`${Fc}px 0`,o.style.minHeight=mt+"px",o.style.maxHeight=Me+"px",c==null||c(),requestAnimationFrame(()=>B.current=!0)}},[$,_.trigger,_.valueNode,o,P,H,K,re,_.dir,c]);ca(()=>X(),[X]);const[ue,Ee]=V.useState();ca(()=>{P&&Ee(window.getComputedStyle(P).zIndex)},[P]);const xe=V.useCallback(Ne=>{Ne&&Y.current===!0&&(X(),G==null||G(),Y.current=!1)},[X,G]);return h.jsx(Xne,{scope:i,contentWrapper:o,shouldExpandOnScrollRef:B,onScrollButtonChange:xe,children:h.jsx("div",{ref:I,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:ue},children:h.jsx(xi.div,{...f,ref:U,style:{boxSizing:"border-box",maxHeight:"100%",...f.style}})})})});BU.displayName=Hne;var Zne="SelectPopperPosition",TP=V.forwardRef((e,t)=>{const{__scopeSelect:i,align:c="start",collisionPadding:f=Fc,..._}=e,x=m2(i);return h.jsx(K4,{...x,..._,ref:t,align:c,collisionPadding:f,style:{boxSizing:"border-box",..._.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});TP.displayName=Zne;var[Xne,vj]=$y(Dm,{}),EP="SelectViewport",VU=V.forwardRef((e,t)=>{const{__scopeSelect:i,nonce:c,...f}=e,_=Xf(EP,i),x=vj(EP,i),o=vs(t,_.onViewportChange),I=V.useRef(0);return h.jsxs(h.Fragment,{children:[h.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:c}),h.jsx(f2.Slot,{scope:i,children:h.jsx(xi.div,{"data-radix-select-viewport":"",role:"presentation",...f,ref:o,style:{position:"relative",flex:1,overflow:"hidden auto",...f.style},onScroll:Un(f.onScroll,P=>{const N=P.currentTarget,{contentWrapper:U,shouldExpandOnScrollRef:$}=x;if($!=null&&$.current&&U){const B=Math.abs(I.current-N.scrollTop);if(B>0){const Y=window.innerHeight-Fc*2,H=parseFloat(U.style.minHeight),K=parseFloat(U.style.height),re=Math.max(H,K);if(re<Y){const G=re+B,X=Math.min(Y,G),ue=G-X;U.style.height=X+"px",U.style.bottom==="0px"&&(N.scrollTop=ue>0?ue:0,U.style.justifyContent="flex-end")}}}I.current=N.scrollTop})})})]})});VU.displayName=EP;var UU="SelectGroup",[Kne,Yne]=$y(UU),Jne=V.forwardRef((e,t)=>{const{__scopeSelect:i,...c}=e,f=zd();return h.jsx(Kne,{scope:i,id:f,children:h.jsx(xi.div,{role:"group","aria-labelledby":f,...c,ref:t})})});Jne.displayName=UU;var $U="SelectLabel",qU=V.forwardRef((e,t)=>{const{__scopeSelect:i,...c}=e,f=Yne($U,i);return h.jsx(xi.div,{id:f.id,...c,ref:t})});qU.displayName=$U;var TT="SelectItem",[Qne,GU]=$y(TT),WU=V.forwardRef((e,t)=>{const{__scopeSelect:i,value:c,disabled:f=!1,textValue:_,...x}=e,o=Zf(TT,i),I=Xf(TT,i),P=o.value===c,[N,U]=V.useState(_??""),[$,B]=V.useState(!1),Y=vs(t,G=>{var X;return(X=I.itemRefCallback)==null?void 0:X.call(I,G,c,f)}),H=zd(),K=V.useRef("touch"),re=()=>{f||(o.onValueChange(c),o.onOpenChange(!1))};if(c==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return h.jsx(Qne,{scope:i,value:c,disabled:f,textId:H,isSelected:P,onItemTextChange:V.useCallback(G=>{U(X=>X||((G==null?void 0:G.textContent)??"").trim())},[]),children:h.jsx(f2.ItemSlot,{scope:i,value:c,disabled:f,textValue:N,children:h.jsx(xi.div,{role:"option","aria-labelledby":H,"data-highlighted":$?"":void 0,"aria-selected":P&&$,"data-state":P?"checked":"unchecked","aria-disabled":f||void 0,"data-disabled":f?"":void 0,tabIndex:f?void 0:-1,...x,ref:Y,onFocus:Un(x.onFocus,()=>B(!0)),onBlur:Un(x.onBlur,()=>B(!1)),onClick:Un(x.onClick,()=>{K.current!=="mouse"&&re()}),onPointerUp:Un(x.onPointerUp,()=>{K.current==="mouse"&&re()}),onPointerDown:Un(x.onPointerDown,G=>{K.current=G.pointerType}),onPointerMove:Un(x.onPointerMove,G=>{var X;K.current=G.pointerType,f?(X=I.onItemLeave)==null||X.call(I):K.current==="mouse"&&G.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Un(x.onPointerLeave,G=>{var X;G.currentTarget===document.activeElement&&((X=I.onItemLeave)==null||X.call(I))}),onKeyDown:Un(x.onKeyDown,G=>{var ue;((ue=I.searchRef)==null?void 0:ue.current)!==""&&G.key===" "||(zne.includes(G.key)&&re(),G.key===" "&&G.preventDefault())})})})})});WU.displayName=TT;var h0="SelectItemText",HU=V.forwardRef((e,t)=>{const{__scopeSelect:i,className:c,style:f,..._}=e,x=Zf(h0,i),o=Xf(h0,i),I=GU(h0,i),P=Une(h0,i),[N,U]=V.useState(null),$=vs(t,re=>U(re),I.onItemTextChange,re=>{var G;return(G=o.itemTextRefCallback)==null?void 0:G.call(o,re,I.value,I.disabled)}),B=N==null?void 0:N.textContent,Y=V.useMemo(()=>h.jsx("option",{value:I.value,disabled:I.disabled,children:B},I.value),[I.disabled,I.value,B]),{onNativeOptionAdd:H,onNativeOptionRemove:K}=P;return ca(()=>(H(Y),()=>K(Y)),[H,K,Y]),h.jsxs(h.Fragment,{children:[h.jsx(xi.span,{id:I.textId,..._,ref:$}),I.isSelected&&x.valueNode&&!x.valueNodeHasChildren?zm.createPortal(_.children,x.valueNode):null]})});HU.displayName=h0;var ZU="SelectItemIndicator",XU=V.forwardRef((e,t)=>{const{__scopeSelect:i,...c}=e;return GU(ZU,i).isSelected?h.jsx(xi.span,{"aria-hidden":!0,...c,ref:t}):null});XU.displayName=ZU;var CP="SelectScrollUpButton",KU=V.forwardRef((e,t)=>{const i=Xf(CP,e.__scopeSelect),c=vj(CP,e.__scopeSelect),[f,_]=V.useState(!1),x=vs(t,c.onScrollButtonChange);return ca(()=>{if(i.viewport&&i.isPositioned){let o=function(){const P=I.scrollTop>0;_(P)};const I=i.viewport;return o(),I.addEventListener("scroll",o),()=>I.removeEventListener("scroll",o)}},[i.viewport,i.isPositioned]),f?h.jsx(JU,{...e,ref:x,onAutoScroll:()=>{const{viewport:o,selectedItem:I}=i;o&&I&&(o.scrollTop=o.scrollTop-I.offsetHeight)}}):null});KU.displayName=CP;var AP="SelectScrollDownButton",YU=V.forwardRef((e,t)=>{const i=Xf(AP,e.__scopeSelect),c=vj(AP,e.__scopeSelect),[f,_]=V.useState(!1),x=vs(t,c.onScrollButtonChange);return ca(()=>{if(i.viewport&&i.isPositioned){let o=function(){const P=I.scrollHeight-I.clientHeight,N=Math.ceil(I.scrollTop)<P;_(N)};const I=i.viewport;return o(),I.addEventListener("scroll",o),()=>I.removeEventListener("scroll",o)}},[i.viewport,i.isPositioned]),f?h.jsx(JU,{...e,ref:x,onAutoScroll:()=>{const{viewport:o,selectedItem:I}=i;o&&I&&(o.scrollTop=o.scrollTop+I.offsetHeight)}}):null});YU.displayName=AP;var JU=V.forwardRef((e,t)=>{const{__scopeSelect:i,onAutoScroll:c,...f}=e,_=Xf("SelectScrollButton",i),x=V.useRef(null),o=p2(i),I=V.useCallback(()=>{x.current!==null&&(window.clearInterval(x.current),x.current=null)},[]);return V.useEffect(()=>()=>I(),[I]),ca(()=>{var N;const P=o().find(U=>U.ref.current===document.activeElement);(N=P==null?void 0:P.ref.current)==null||N.scrollIntoView({block:"nearest"})},[o]),h.jsx(xi.div,{"aria-hidden":!0,...f,ref:t,style:{flexShrink:0,...f.style},onPointerDown:Un(f.onPointerDown,()=>{x.current===null&&(x.current=window.setInterval(c,50))}),onPointerMove:Un(f.onPointerMove,()=>{var P;(P=_.onItemLeave)==null||P.call(_),x.current===null&&(x.current=window.setInterval(c,50))}),onPointerLeave:Un(f.onPointerLeave,()=>{I()})})}),eie="SelectSeparator",QU=V.forwardRef((e,t)=>{const{__scopeSelect:i,...c}=e;return h.jsx(xi.div,{"aria-hidden":!0,...c,ref:t})});QU.displayName=eie;var IP="SelectArrow",tie=V.forwardRef((e,t)=>{const{__scopeSelect:i,...c}=e,f=m2(i),_=Zf(IP,i),x=Xf(IP,i);return _.open&&x.position==="popper"?h.jsx(Y4,{...f,...c,ref:t}):null});tie.displayName=IP;var rie="SelectBubbleInput",e6=V.forwardRef(({__scopeSelect:e,value:t,...i},c)=>{const f=V.useRef(null),_=vs(c,f),x=One(t);return V.useEffect(()=>{const o=f.current;if(!o)return;const I=window.HTMLSelectElement.prototype,N=Object.getOwnPropertyDescriptor(I,"value").set;if(x!==t&&N){const U=new Event("change",{bubbles:!0});N.call(o,t),o.dispatchEvent(U)}},[x,t]),h.jsx(xi.select,{...i,style:{...UB,...i.style},ref:_,defaultValue:t})});e6.displayName=rie;function t6(e){return e===""||e===void 0}function r6(e){const t=fc(e),i=V.useRef(""),c=V.useRef(0),f=V.useCallback(x=>{const o=i.current+x;t(o),function I(P){i.current=P,window.clearTimeout(c.current),P!==""&&(c.current=window.setTimeout(()=>I(""),1e3))}(o)},[t]),_=V.useCallback(()=>{i.current="",window.clearTimeout(c.current)},[]);return V.useEffect(()=>()=>window.clearTimeout(c.current),[]),[i,f,_]}function n6(e,t,i){const f=t.length>1&&Array.from(t).every(P=>P===t[0])?t[0]:t,_=i?e.indexOf(i):-1;let x=nie(e,Math.max(_,0));f.length===1&&(x=x.filter(P=>P!==i));const I=x.find(P=>P.textValue.toLowerCase().startsWith(f.toLowerCase()));return I!==i?I:void 0}function nie(e,t){return e.map((i,c)=>e[(t+c)%e.length])}var iie=kU,i6=RU,sie=DU,oie=NU,aie=OU,s6=LU,lie=VU,o6=qU,a6=WU,cie=HU,uie=XU,l6=KU,c6=YU,u6=QU;const un=iie,dn=sie,on=V.forwardRef(({className:e,children:t,...i},c)=>h.jsxs(i6,{ref:c,className:yr("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...i,children:[t,h.jsx(oie,{asChild:!0,children:h.jsx(d4,{className:"h-4 w-4 opacity-50"})})]}));on.displayName=i6.displayName;const d6=V.forwardRef(({className:e,...t},i)=>h.jsx(l6,{ref:i,className:yr("flex cursor-default items-center justify-center py-1",e),...t,children:h.jsx(q7,{className:"h-4 w-4"})}));d6.displayName=l6.displayName;const h6=V.forwardRef(({className:e,...t},i)=>h.jsx(c6,{ref:i,className:yr("flex cursor-default items-center justify-center py-1",e),...t,children:h.jsx(d4,{className:"h-4 w-4"})}));h6.displayName=c6.displayName;const an=V.forwardRef(({className:e,children:t,position:i="popper",...c},f)=>h.jsx(aie,{children:h.jsxs(s6,{ref:f,className:yr("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",i==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:i,...c,children:[h.jsx(d6,{}),h.jsx(lie,{className:yr("p-1",i==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),h.jsx(h6,{})]})}));an.displayName=s6.displayName;const die=V.forwardRef(({className:e,...t},i)=>h.jsx(o6,{ref:i,className:yr("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));die.displayName=o6.displayName;const kt=V.forwardRef(({className:e,children:t,...i},c)=>h.jsxs(a6,{ref:c,className:yr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...i,children:[h.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:h.jsx(uie,{children:h.jsx($7,{className:"h-4 w-4"})})}),h.jsx(cie,{children:t})]}));kt.displayName=a6.displayName;const hie=V.forwardRef(({className:e,...t},i)=>h.jsx(u6,{ref:i,className:yr("-mx-1 my-1 h-px bg-muted",e),...t}));hie.displayName=u6.displayName;const fie=()=>{const[e,t]=V.useState([]),[i,c]=V.useState([]),[f,_]=V.useState(""),[x,o]=V.useState(!0),[I,P]=V.useState(!1),N=cu(),{toast:U}=$f();V.useEffect(()=>{$()},[]),V.useEffect(()=>{Y()},[f,e]);const $=async()=>{try{const{data:{user:G}}=await Qe.auth.getUser();if(!G){N("/auth");return}const{data:X}=await Qe.from("user_roles").select("role").eq("user_id",G.id).single();if((X==null?void 0:X.role)!=="admin"){U({title:"Acesso negado",description:"Apenas administradores podem acessar esta pgina.",variant:"destructive"}),N("/dashboard");return}P(!0),await B()}catch(G){console.error("Error:",G)}finally{o(!1)}},B=async()=>{try{const{data:G,error:X}=await Qe.from("profiles").select(`
          id,
          email,
          full_name,
          phone,
          user_roles (role)
        `);if(X)throw X;const ue=(G==null?void 0:G.map(Ee=>{var xe,Ne;return{id:Ee.id,email:Ee.email,full_name:Ee.full_name,phone:Ee.phone,role:((Ne=(xe=Ee.user_roles)==null?void 0:xe[0])==null?void 0:Ne.role)||"tecnico"}}))||[];t(ue),c(ue)}catch(G){U({title:"Erro ao carregar usurios",description:G.message,variant:"destructive"})}},Y=()=>{if(!f.trim()){c(e);return}const G=f.toLowerCase(),X=e.filter(ue=>{var Ee,xe;return((Ee=ue.email)==null?void 0:Ee.toLowerCase().includes(G))||((xe=ue.full_name)==null?void 0:xe.toLowerCase().includes(G))});c(X)},H=async(G,X)=>{try{const{error:ue}=await Qe.from("user_roles").update({role:X}).eq("user_id",G);if(ue)throw ue;U({title:"Perfil atualizado",description:"O perfil do usurio foi alterado com sucesso."}),await B()}catch(ue){U({title:"Erro ao atualizar perfil",description:ue.message,variant:"destructive"})}},K={admin:"Administrador",gestor_operacoes:"Gestor de Operaes",supervisor:"Supervisor",analista_centro_controle:"Analista Centro Controle",tecnico:"Tcnico",cliente_view:"Cliente (Visualizao)"},re=G=>({admin:"bg-red-500",gestor_operacoes:"bg-purple-500",supervisor:"bg-blue-500",analista_centro_controle:"bg-cyan-500",tecnico:"bg-green-500",cliente_view:"bg-gray-500"})[G]||"bg-gray-500";return x?h.jsx("div",{className:"min-h-screen flex items-center justify-center",children:h.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):I?h.jsx($o,{children:h.jsxs("div",{className:"min-h-screen bg-background",children:[h.jsx("header",{className:"border-b bg-card shadow-sm",children:h.jsx("div",{className:"container mx-auto px-4 py-4",children:h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("div",{className:"p-2 bg-gradient-to-br from-primary to-accent rounded-lg",children:h.jsx(Df,{className:"h-6 w-6 text-primary-foreground"})}),h.jsxs("div",{children:[h.jsx("h1",{className:"text-xl font-bold",children:"Facilities Center"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Gesto de Usurios"})]})]})})}),h.jsxs("main",{className:"container mx-auto px-4 py-8",children:[h.jsxs("div",{className:"mb-6",children:[h.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[h.jsx(Nk,{className:"h-6 w-6 text-primary"}),h.jsx("h2",{className:"text-2xl font-bold",children:"Gesto de Perfis de Usurios"})]}),h.jsx("p",{className:"text-muted-foreground mb-6",children:"Gerencie os perfis de acesso de todos os usurios do sistema"}),h.jsxs("div",{className:"relative max-w-md",children:[h.jsx(Xc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),h.jsx(_r,{placeholder:"Buscar por nome ou email...",value:f,onChange:G=>_(G.target.value),className:"pl-10"})]})]}),h.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(G=>h.jsxs(kr,{className:"hover:shadow-md transition-shadow",children:[h.jsx(Mn,{children:h.jsx("div",{className:"flex items-start justify-between",children:h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:h.jsx(aZ,{className:"h-5 w-5 text-primary"})}),h.jsxs("div",{children:[h.jsx(Zn,{className:"text-base",children:G.full_name||"Sem nome"}),h.jsx(Xa,{className:"text-xs",children:G.email})]})]})})}),h.jsx(tn,{children:h.jsxs("div",{className:"space-y-3",children:[G.phone&&h.jsxs("p",{className:"text-sm text-muted-foreground",children:["Tel: ",G.phone]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx("label",{className:"text-sm font-medium",children:"Perfil de Acesso"}),h.jsxs(un,{value:G.role,onValueChange:X=>H(G.id,X),children:[h.jsx(on,{children:h.jsx(dn,{})}),h.jsx(an,{children:Object.entries(K).map(([X,ue])=>h.jsx(kt,{value:X,children:h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("div",{className:`w-2 h-2 rounded-full ${re(X)}`}),ue]})},X))})]})]}),h.jsx(ai,{className:`${re(G.role)} text-white`,children:K[G.role]})]})})]},G.id))}),i.length===0&&h.jsx(kr,{className:"mt-8",children:h.jsx(tn,{className:"py-12 text-center",children:h.jsx("p",{className:"text-muted-foreground",children:"Nenhum usurio encontrado com os filtros aplicados."})})})]})]})}):null},pie=Sb({password:sa().min(6,{message:"Senha deve ter no mnimo 6 caracteres"}).max(72,{message:"Senha deve ter no mximo 72 caracteres"}),confirmPassword:sa()}).refine(e=>e.password===e.confirmPassword,{message:"As senhas no coincidem",path:["confirmPassword"]}),mie=()=>{const[e,t]=V.useState(""),[i,c]=V.useState(""),[f,_]=V.useState(!1),[x,o]=V.useState(!1),I=cu(),{toast:P}=$f();V.useEffect(()=>{Qe.auth.getSession().then(({data:{session:U}})=>{U?o(!0):(P({title:"Sesso invlida",description:"O link de redefinio expirou ou  invlido.",variant:"destructive"}),I("/auth"))})},[I,P]);const N=async U=>{U.preventDefault(),_(!0);try{const $=pie.parse({password:e,confirmPassword:i}),{error:B}=await Qe.auth.updateUser({password:$.password});if(B)throw B;P({title:"Senha redefinida!",description:"Sua senha foi alterada com sucesso. Faa login com a nova senha."}),await Qe.auth.signOut(),I("/auth")}catch($){$ instanceof pc?P({title:"Erro de validao",description:$.errors[0].message,variant:"destructive"}):P({title:"Erro",description:$.message||"No foi possvel redefinir a senha",variant:"destructive"})}finally{_(!1)}};return x?h.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary/5 via-background to-accent/5 p-4",children:h.jsxs(kr,{className:"w-full max-w-md shadow-lg",children:[h.jsxs(Mn,{className:"space-y-3 text-center",children:[h.jsx("div",{className:"flex justify-center mb-2",children:h.jsx("div",{className:"p-3 bg-gradient-to-br from-destructive to-destructive/80 rounded-xl",children:h.jsx(K7,{className:"h-8 w-8 text-destructive-foreground"})})}),h.jsx(Zn,{className:"text-2xl font-bold",children:"Nova Senha"}),h.jsx(Xa,{children:"Crie uma nova senha segura para sua conta"})]}),h.jsxs(tn,{children:[h.jsxs("form",{onSubmit:N,className:"space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"password",children:"Nova Senha"}),h.jsx(_r,{id:"password",type:"password",placeholder:"",value:e,onChange:U=>t(U.target.value),required:!0,disabled:f,minLength:6,maxLength:72}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Mnimo de 6 caracteres"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"confirmPassword",children:"Confirmar Nova Senha"}),h.jsx(_r,{id:"confirmPassword",type:"password",placeholder:"",value:i,onChange:U=>c(U.target.value),required:!0,disabled:f,minLength:6,maxLength:72})]}),h.jsx(tr,{type:"submit",className:"w-full",disabled:f,children:f?h.jsxs(h.Fragment,{children:[h.jsx(Xu,{className:"mr-2 h-4 w-4 animate-spin"}),"Redefinindo..."]}):"Redefinir Senha"})]}),h.jsx("div",{className:"mt-6 text-center",children:h.jsx("button",{type:"button",onClick:()=>I("/auth"),className:"text-sm text-muted-foreground hover:text-primary",disabled:f,children:"Voltar para login"})})]})]})}):null},Yd=V.forwardRef(({className:e,...t},i)=>h.jsx("div",{className:"relative w-full overflow-auto",children:h.jsx("table",{ref:i,className:yr("w-full caption-bottom text-sm",e),...t})}));Yd.displayName="Table";const Jd=V.forwardRef(({className:e,...t},i)=>h.jsx("thead",{ref:i,className:yr("[&_tr]:border-b",e),...t}));Jd.displayName="TableHeader";const Qd=V.forwardRef(({className:e,...t},i)=>h.jsx("tbody",{ref:i,className:yr("[&_tr:last-child]:border-0",e),...t}));Qd.displayName="TableBody";const gie=V.forwardRef(({className:e,...t},i)=>h.jsx("tfoot",{ref:i,className:yr("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}));gie.displayName="TableFooter";const Zs=V.forwardRef(({className:e,...t},i)=>h.jsx("tr",{ref:i,className:yr("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",e),...t}));Zs.displayName="TableRow";const xn=V.forwardRef(({className:e,...t},i)=>h.jsx("th",{ref:i,className:yr("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));xn.displayName="TableHead";const cn=V.forwardRef(({className:e,...t},i)=>h.jsx("td",{ref:i,className:yr("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));cn.displayName="TableCell";const _ie=V.forwardRef(({className:e,...t},i)=>h.jsx("caption",{ref:i,className:yr("mt-4 text-sm text-muted-foreground",e),...t}));_ie.displayName="TableCaption";var Pb=e=>e.type==="checkbox",am=e=>e instanceof Date,Wa=e=>e==null;const f6=e=>typeof e=="object";var xo=e=>!Wa(e)&&!Array.isArray(e)&&f6(e)&&!am(e),p6=e=>xo(e)&&e.target?Pb(e.target)?e.target.checked:e.target.value:e,yie=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,m6=(e,t)=>e.has(yie(t)),vie=e=>{const t=e.constructor&&e.constructor.prototype;return xo(t)&&t.hasOwnProperty("isPrototypeOf")},xj=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Fo(e){let t;const i=Array.isArray(e),c=typeof FileList<"u"?e instanceof FileList:!1;if(e instanceof Date)t=new Date(e);else if(!(xj&&(e instanceof Blob||c))&&(i||xo(e)))if(t=i?[]:{},!i&&!vie(e))t=e;else for(const f in e)e.hasOwnProperty(f)&&(t[f]=Fo(e[f]));else return e;return t}var g2=e=>/^\w*$/.test(e),_o=e=>e===void 0,bj=e=>Array.isArray(e)?e.filter(Boolean):[],wj=e=>bj(e.replace(/["|']|\]/g,"").split(/\.|\[/)),qr=(e,t,i)=>{if(!t||!xo(e))return i;const c=(g2(t)?[t]:wj(t)).reduce((f,_)=>Wa(f)?f:f[_],e);return _o(c)||c===e?_o(e[t])?i:e[t]:c},Ol=e=>typeof e=="boolean",gs=(e,t,i)=>{let c=-1;const f=g2(t)?[t]:wj(t),_=f.length,x=_-1;for(;++c<_;){const o=f[c];let I=i;if(c!==x){const P=e[o];I=xo(P)||Array.isArray(P)?P:isNaN(+f[c+1])?{}:[]}if(o==="__proto__"||o==="constructor"||o==="prototype")return;e[o]=I,e=e[o]}};const ET={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},Hc={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Sd={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},Sj=nr.createContext(null);Sj.displayName="HookFormContext";const _2=()=>nr.useContext(Sj),xie=e=>{const{children:t,...i}=e;return nr.createElement(Sj.Provider,{value:i},t)};var g6=(e,t,i,c=!0)=>{const f={defaultValues:t._defaultValues};for(const _ in e)Object.defineProperty(f,_,{get:()=>{const x=_;return t._proxyFormState[x]!==Hc.all&&(t._proxyFormState[x]=!c||Hc.all),i&&(i[x]=!0),e[x]}});return f};const Tj=typeof window<"u"?nr.useLayoutEffect:nr.useEffect;function bie(e){const t=_2(),{control:i=t.control,disabled:c,name:f,exact:_}=e||{},[x,o]=nr.useState(i._formState),I=nr.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return Tj(()=>i._subscribe({name:f,formState:I.current,exact:_,callback:P=>{!c&&o({...i._formState,...P})}}),[f,c,_]),nr.useEffect(()=>{I.current.isValid&&i._setValid(!0)},[i]),nr.useMemo(()=>g6(x,i,I.current,!1),[x,i])}var Fu=e=>typeof e=="string",_6=(e,t,i,c,f)=>Fu(e)?(c&&t.watch.add(e),qr(i,e,f)):Array.isArray(e)?e.map(_=>(c&&t.watch.add(_),qr(i,_))):(c&&(t.watchAll=!0),i),PP=e=>Wa(e)||!f6(e);function jd(e,t,i=new WeakSet){if(PP(e)||PP(t))return e===t;if(am(e)&&am(t))return e.getTime()===t.getTime();const c=Object.keys(e),f=Object.keys(t);if(c.length!==f.length)return!1;if(i.has(e)||i.has(t))return!0;i.add(e),i.add(t);for(const _ of c){const x=e[_];if(!f.includes(_))return!1;if(_!=="ref"){const o=t[_];if(am(x)&&am(o)||xo(x)&&xo(o)||Array.isArray(x)&&Array.isArray(o)?!jd(x,o,i):x!==o)return!1}}return!0}function wie(e){const t=_2(),{control:i=t.control,name:c,defaultValue:f,disabled:_,exact:x,compute:o}=e||{},I=nr.useRef(f),P=nr.useRef(o),N=nr.useRef(void 0);P.current=o;const U=nr.useMemo(()=>i._getWatch(c,I.current),[i,c]),[$,B]=nr.useState(P.current?P.current(U):U);return Tj(()=>i._subscribe({name:c,formState:{values:!0},exact:x,callback:Y=>{if(!_){const H=_6(c,i._names,Y.values||i._formValues,!1,I.current);if(P.current){const K=P.current(H);jd(K,N.current)||(B(K),N.current=K)}else B(H)}}}),[i,_,c,x]),nr.useEffect(()=>i._removeUnmounted()),$}function Sie(e){const t=_2(),{name:i,disabled:c,control:f=t.control,shouldUnregister:_,defaultValue:x}=e,o=m6(f._names.array,i),I=nr.useMemo(()=>qr(f._formValues,i,qr(f._defaultValues,i,x)),[f,i,x]),P=wie({control:f,name:i,defaultValue:I,exact:!0}),N=bie({control:f,name:i,exact:!0}),U=nr.useRef(e),$=nr.useRef(f.register(i,{...e.rules,value:P,...Ol(e.disabled)?{disabled:e.disabled}:{}}));U.current=e;const B=nr.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!qr(N.errors,i)},isDirty:{enumerable:!0,get:()=>!!qr(N.dirtyFields,i)},isTouched:{enumerable:!0,get:()=>!!qr(N.touchedFields,i)},isValidating:{enumerable:!0,get:()=>!!qr(N.validatingFields,i)},error:{enumerable:!0,get:()=>qr(N.errors,i)}}),[N,i]),Y=nr.useCallback(G=>$.current.onChange({target:{value:p6(G),name:i},type:ET.CHANGE}),[i]),H=nr.useCallback(()=>$.current.onBlur({target:{value:qr(f._formValues,i),name:i},type:ET.BLUR}),[i,f._formValues]),K=nr.useCallback(G=>{const X=qr(f._fields,i);X&&G&&(X._f.ref={focus:()=>G.focus&&G.focus(),select:()=>G.select&&G.select(),setCustomValidity:ue=>G.setCustomValidity(ue),reportValidity:()=>G.reportValidity()})},[f._fields,i]),re=nr.useMemo(()=>({name:i,value:P,...Ol(c)||N.disabled?{disabled:N.disabled||c}:{},onChange:Y,onBlur:H,ref:K}),[i,c,N.disabled,Y,H,K,P]);return nr.useEffect(()=>{const G=f._options.shouldUnregister||_;f.register(i,{...U.current.rules,...Ol(U.current.disabled)?{disabled:U.current.disabled}:{}});const X=(ue,Ee)=>{const xe=qr(f._fields,ue);xe&&xe._f&&(xe._f.mount=Ee)};if(X(i,!0),G){const ue=Fo(qr(f._options.defaultValues,i));gs(f._defaultValues,i,ue),_o(qr(f._formValues,i))&&gs(f._formValues,i,ue)}return!o&&f.register(i),()=>{(o?G&&!f._state.action:G)?f.unregister(i):X(i,!1)}},[i,f,o,_]),nr.useEffect(()=>{f._setDisabledField({disabled:c,name:i})},[c,i,f]),nr.useMemo(()=>({field:re,formState:N,fieldState:B}),[re,N,B])}const Tie=e=>e.render(Sie(e));var y6=(e,t,i,c,f)=>t?{...i[e],types:{...i[e]&&i[e].types?i[e].types:{},[c]:f||!0}}:{},C0=e=>Array.isArray(e)?e:[e],Dz=()=>{let e=[];return{get observers(){return e},next:f=>{for(const _ of e)_.next&&_.next(f)},subscribe:f=>(e.push(f),{unsubscribe:()=>{e=e.filter(_=>_!==f)}}),unsubscribe:()=>{e=[]}}},gl=e=>xo(e)&&!Object.keys(e).length,Ej=e=>e.type==="file",Zc=e=>typeof e=="function",CT=e=>{if(!xj)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},v6=e=>e.type==="select-multiple",Cj=e=>e.type==="radio",Eie=e=>Cj(e)||Pb(e),EA=e=>CT(e)&&e.isConnected;function Cie(e,t){const i=t.slice(0,-1).length;let c=0;for(;c<i;)e=_o(e)?c++:e[t[c++]];return e}function Aie(e){for(const t in e)if(e.hasOwnProperty(t)&&!_o(e[t]))return!1;return!0}function Io(e,t){const i=Array.isArray(t)?t:g2(t)?[t]:wj(t),c=i.length===1?e:Cie(e,i),f=i.length-1,_=i[f];return c&&delete c[_],f!==0&&(xo(c)&&gl(c)||Array.isArray(c)&&Aie(c))&&Io(e,i.slice(0,-1)),e}var x6=e=>{for(const t in e)if(Zc(e[t]))return!0;return!1};function AT(e,t={}){const i=Array.isArray(e);if(xo(e)||i)for(const c in e)Array.isArray(e[c])||xo(e[c])&&!x6(e[c])?(t[c]=Array.isArray(e[c])?[]:{},AT(e[c],t[c])):Wa(e[c])||(t[c]=!0);return t}function b6(e,t,i){const c=Array.isArray(e);if(xo(e)||c)for(const f in e)Array.isArray(e[f])||xo(e[f])&&!x6(e[f])?_o(t)||PP(i[f])?i[f]=Array.isArray(e[f])?AT(e[f],[]):{...AT(e[f])}:b6(e[f],Wa(t)?{}:t[f],i[f]):i[f]=!jd(e[f],t[f]);return i}var n0=(e,t)=>b6(e,t,AT(t));const Nz={value:!1,isValid:!1},Oz={value:!0,isValid:!0};var w6=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(i=>i&&i.checked&&!i.disabled).map(i=>i.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!_o(e[0].attributes.value)?_o(e[0].value)||e[0].value===""?Oz:{value:e[0].value,isValid:!0}:Oz:Nz}return Nz},S6=(e,{valueAsNumber:t,valueAsDate:i,setValueAs:c})=>_o(e)?e:t?e===""?NaN:e&&+e:i&&Fu(e)?new Date(e):c?c(e):e;const Lz={isValid:!1,value:null};var T6=e=>Array.isArray(e)?e.reduce((t,i)=>i&&i.checked&&!i.disabled?{isValid:!0,value:i.value}:t,Lz):Lz;function zz(e){const t=e.ref;return Ej(t)?t.files:Cj(t)?T6(e.refs).value:v6(t)?[...t.selectedOptions].map(({value:i})=>i):Pb(t)?w6(e.refs).value:S6(_o(t.value)?e.ref.value:t.value,e)}var Iie=(e,t,i,c)=>{const f={};for(const _ of e){const x=qr(t,_);x&&gs(f,_,x._f)}return{criteriaMode:i,names:[...e],fields:f,shouldUseNativeValidation:c}},IT=e=>e instanceof RegExp,i0=e=>_o(e)?e:IT(e)?e.source:xo(e)?IT(e.value)?e.value.source:e.value:e,Fz=e=>({isOnSubmit:!e||e===Hc.onSubmit,isOnBlur:e===Hc.onBlur,isOnChange:e===Hc.onChange,isOnAll:e===Hc.all,isOnTouch:e===Hc.onTouched});const Bz="AsyncFunction";var Pie=e=>!!e&&!!e.validate&&!!(Zc(e.validate)&&e.validate.constructor.name===Bz||xo(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===Bz)),kie=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate),Vz=(e,t,i)=>!i&&(t.watchAll||t.watch.has(e)||[...t.watch].some(c=>e.startsWith(c)&&/^\.\w+/.test(e.slice(c.length))));const A0=(e,t,i,c)=>{for(const f of i||Object.keys(e)){const _=qr(e,f);if(_){const{_f:x,...o}=_;if(x){if(x.refs&&x.refs[0]&&t(x.refs[0],f)&&!c)return!0;if(x.ref&&t(x.ref,x.name)&&!c)return!0;if(A0(o,t))break}else if(xo(o)&&A0(o,t))break}}};function Uz(e,t,i){const c=qr(e,i);if(c||g2(i))return{error:c,name:i};const f=i.split(".");for(;f.length;){const _=f.join("."),x=qr(t,_),o=qr(e,_);if(x&&!Array.isArray(x)&&i!==_)return{name:i};if(o&&o.type)return{name:_,error:o};if(o&&o.root&&o.root.type)return{name:`${_}.root`,error:o.root};f.pop()}return{name:i}}var jie=(e,t,i,c)=>{i(e);const{name:f,..._}=e;return gl(_)||Object.keys(_).length>=Object.keys(t).length||Object.keys(_).find(x=>t[x]===(!c||Hc.all))},Rie=(e,t,i)=>!e||!t||e===t||C0(e).some(c=>c&&(i?c===t:c.startsWith(t)||t.startsWith(c))),Mie=(e,t,i,c,f)=>f.isOnAll?!1:!i&&f.isOnTouch?!(t||e):(i?c.isOnBlur:f.isOnBlur)?!e:(i?c.isOnChange:f.isOnChange)?e:!0,Die=(e,t)=>!bj(qr(e,t)).length&&Io(e,t),Nie=(e,t,i)=>{const c=C0(qr(e,i));return gs(c,"root",t[i]),gs(e,i,c),e},kS=e=>Fu(e);function $z(e,t,i="validate"){if(kS(e)||Array.isArray(e)&&e.every(kS)||Ol(e)&&!e)return{type:i,message:kS(e)?e:"",ref:t}}var T_=e=>xo(e)&&!IT(e)?e:{value:e,message:""},qz=async(e,t,i,c,f,_)=>{const{ref:x,refs:o,required:I,maxLength:P,minLength:N,min:U,max:$,pattern:B,validate:Y,name:H,valueAsNumber:K,mount:re}=e._f,G=qr(i,H);if(!re||t.has(H))return{};const X=o?o[0]:x,ue=Me=>{f&&X.reportValidity&&(X.setCustomValidity(Ol(Me)?"":Me||""),X.reportValidity())},Ee={},xe=Cj(x),Ne=Pb(x),lt=xe||Ne,Pt=(K||Ej(x))&&_o(x.value)&&_o(G)||CT(x)&&x.value===""||G===""||Array.isArray(G)&&!G.length,tt=y6.bind(null,H,c,Ee),yt=(Me,be,je,Ye=Sd.maxLength,qe=Sd.minLength)=>{const We=Me?be:je;Ee[H]={type:Me?Ye:qe,message:We,ref:x,...tt(Me?Ye:qe,We)}};if(_?!Array.isArray(G)||!G.length:I&&(!lt&&(Pt||Wa(G))||Ol(G)&&!G||Ne&&!w6(o).isValid||xe&&!T6(o).isValid)){const{value:Me,message:be}=kS(I)?{value:!!I,message:I}:T_(I);if(Me&&(Ee[H]={type:Sd.required,message:be,ref:X,...tt(Sd.required,be)},!c))return ue(be),Ee}if(!Pt&&(!Wa(U)||!Wa($))){let Me,be;const je=T_($),Ye=T_(U);if(!Wa(G)&&!isNaN(G)){const qe=x.valueAsNumber||G&&+G;Wa(je.value)||(Me=qe>je.value),Wa(Ye.value)||(be=qe<Ye.value)}else{const qe=x.valueAsDate||new Date(G),We=mt=>new Date(new Date().toDateString()+" "+mt),$e=x.type=="time",_t=x.type=="week";Fu(je.value)&&G&&(Me=$e?We(G)>We(je.value):_t?G>je.value:qe>new Date(je.value)),Fu(Ye.value)&&G&&(be=$e?We(G)<We(Ye.value):_t?G<Ye.value:qe<new Date(Ye.value))}if((Me||be)&&(yt(!!Me,je.message,Ye.message,Sd.max,Sd.min),!c))return ue(Ee[H].message),Ee}if((P||N)&&!Pt&&(Fu(G)||_&&Array.isArray(G))){const Me=T_(P),be=T_(N),je=!Wa(Me.value)&&G.length>+Me.value,Ye=!Wa(be.value)&&G.length<+be.value;if((je||Ye)&&(yt(je,Me.message,be.message),!c))return ue(Ee[H].message),Ee}if(B&&!Pt&&Fu(G)){const{value:Me,message:be}=T_(B);if(IT(Me)&&!G.match(Me)&&(Ee[H]={type:Sd.pattern,message:be,ref:x,...tt(Sd.pattern,be)},!c))return ue(be),Ee}if(Y){if(Zc(Y)){const Me=await Y(G,i),be=$z(Me,X);if(be&&(Ee[H]={...be,...tt(Sd.validate,be.message)},!c))return ue(be.message),Ee}else if(xo(Y)){let Me={};for(const be in Y){if(!gl(Me)&&!c)break;const je=$z(await Y[be](G,i),X,be);je&&(Me={...je,...tt(be,je.message)},ue(je.message),c&&(Ee[H]=Me))}if(!gl(Me)&&(Ee[H]={ref:X,...Me},!c))return Ee}}return ue(!0),Ee};const Oie={mode:Hc.onSubmit,reValidateMode:Hc.onChange,shouldFocusError:!0};function Lie(e={}){let t={...Oie,...e},i={submitCount:0,isDirty:!1,isReady:!1,isLoading:Zc(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},c={},f=xo(t.defaultValues)||xo(t.values)?Fo(t.defaultValues||t.values)||{}:{},_=t.shouldUnregister?{}:Fo(f),x={action:!1,mount:!1,watch:!1},o={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},I,P=0;const N={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let U={...N};const $={array:Dz(),state:Dz()},B=t.criteriaMode===Hc.all,Y=et=>Et=>{clearTimeout(P),P=setTimeout(et,Et)},H=async et=>{if(!t.disabled&&(N.isValid||U.isValid||et)){const Et=t.resolver?gl((await Ne()).errors):await Pt(c,!0);Et!==i.isValid&&$.state.next({isValid:Et})}},K=(et,Et)=>{!t.disabled&&(N.isValidating||N.validatingFields||U.isValidating||U.validatingFields)&&((et||Array.from(o.mount)).forEach(Wt=>{Wt&&(Et?gs(i.validatingFields,Wt,Et):Io(i.validatingFields,Wt))}),$.state.next({validatingFields:i.validatingFields,isValidating:!gl(i.validatingFields)}))},re=(et,Et=[],Wt,Ar,pr=!0,gr=!0)=>{if(Ar&&Wt&&!t.disabled){if(x.action=!0,gr&&Array.isArray(qr(c,et))){const Or=Wt(qr(c,et),Ar.argA,Ar.argB);pr&&gs(c,et,Or)}if(gr&&Array.isArray(qr(i.errors,et))){const Or=Wt(qr(i.errors,et),Ar.argA,Ar.argB);pr&&gs(i.errors,et,Or),Die(i.errors,et)}if((N.touchedFields||U.touchedFields)&&gr&&Array.isArray(qr(i.touchedFields,et))){const Or=Wt(qr(i.touchedFields,et),Ar.argA,Ar.argB);pr&&gs(i.touchedFields,et,Or)}(N.dirtyFields||U.dirtyFields)&&(i.dirtyFields=n0(f,_)),$.state.next({name:et,isDirty:yt(et,Et),dirtyFields:i.dirtyFields,errors:i.errors,isValid:i.isValid})}else gs(_,et,Et)},G=(et,Et)=>{gs(i.errors,et,Et),$.state.next({errors:i.errors})},X=et=>{i.errors=et,$.state.next({errors:i.errors,isValid:!1})},ue=(et,Et,Wt,Ar)=>{const pr=qr(c,et);if(pr){const gr=qr(_,et,_o(Wt)?qr(f,et):Wt);_o(gr)||Ar&&Ar.defaultChecked||Et?gs(_,et,Et?gr:zz(pr._f)):je(et,gr),x.mount&&H()}},Ee=(et,Et,Wt,Ar,pr)=>{let gr=!1,Or=!1;const Ln={name:et};if(!t.disabled){if(!Wt||Ar){(N.isDirty||U.isDirty)&&(Or=i.isDirty,i.isDirty=Ln.isDirty=yt(),gr=Or!==Ln.isDirty);const gi=jd(qr(f,et),Et);Or=!!qr(i.dirtyFields,et),gi?Io(i.dirtyFields,et):gs(i.dirtyFields,et,!0),Ln.dirtyFields=i.dirtyFields,gr=gr||(N.dirtyFields||U.dirtyFields)&&Or!==!gi}if(Wt){const gi=qr(i.touchedFields,et);gi||(gs(i.touchedFields,et,Wt),Ln.touchedFields=i.touchedFields,gr=gr||(N.touchedFields||U.touchedFields)&&gi!==Wt)}gr&&pr&&$.state.next(Ln)}return gr?Ln:{}},xe=(et,Et,Wt,Ar)=>{const pr=qr(i.errors,et),gr=(N.isValid||U.isValid)&&Ol(Et)&&i.isValid!==Et;if(t.delayError&&Wt?(I=Y(()=>G(et,Wt)),I(t.delayError)):(clearTimeout(P),I=null,Wt?gs(i.errors,et,Wt):Io(i.errors,et)),(Wt?!jd(pr,Wt):pr)||!gl(Ar)||gr){const Or={...Ar,...gr&&Ol(Et)?{isValid:Et}:{},errors:i.errors,name:et};i={...i,...Or},$.state.next(Or)}},Ne=async et=>{K(et,!0);const Et=await t.resolver(_,t.context,Iie(et||o.mount,c,t.criteriaMode,t.shouldUseNativeValidation));return K(et),Et},lt=async et=>{const{errors:Et}=await Ne(et);if(et)for(const Wt of et){const Ar=qr(Et,Wt);Ar?gs(i.errors,Wt,Ar):Io(i.errors,Wt)}else i.errors=Et;return Et},Pt=async(et,Et,Wt={valid:!0})=>{for(const Ar in et){const pr=et[Ar];if(pr){const{_f:gr,...Or}=pr;if(gr){const Ln=o.array.has(gr.name),gi=pr._f&&Pie(pr._f);gi&&N.validatingFields&&K([Ar],!0);const Fi=await qz(pr,o.disabled,_,B,t.shouldUseNativeValidation&&!Et,Ln);if(gi&&N.validatingFields&&K([Ar]),Fi[gr.name]&&(Wt.valid=!1,Et))break;!Et&&(qr(Fi,gr.name)?Ln?Nie(i.errors,Fi,gr.name):gs(i.errors,gr.name,Fi[gr.name]):Io(i.errors,gr.name))}!gl(Or)&&await Pt(Or,Et,Wt)}}return Wt.valid},tt=()=>{for(const et of o.unMount){const Et=qr(c,et);Et&&(Et._f.refs?Et._f.refs.every(Wt=>!EA(Wt)):!EA(Et._f.ref))&&Bt(et)}o.unMount=new Set},yt=(et,Et)=>!t.disabled&&(et&&Et&&gs(_,et,Et),!jd(mt(),f)),Me=(et,Et,Wt)=>_6(et,o,{...x.mount?_:_o(Et)?f:Fu(et)?{[et]:Et}:Et},Wt,Et),be=et=>bj(qr(x.mount?_:f,et,t.shouldUnregister?qr(f,et,[]):[])),je=(et,Et,Wt={})=>{const Ar=qr(c,et);let pr=Et;if(Ar){const gr=Ar._f;gr&&(!gr.disabled&&gs(_,et,S6(Et,gr)),pr=CT(gr.ref)&&Wa(Et)?"":Et,v6(gr.ref)?[...gr.ref.options].forEach(Or=>Or.selected=pr.includes(Or.value)):gr.refs?Pb(gr.ref)?gr.refs.forEach(Or=>{(!Or.defaultChecked||!Or.disabled)&&(Array.isArray(pr)?Or.checked=!!pr.find(Ln=>Ln===Or.value):Or.checked=pr===Or.value||!!pr)}):gr.refs.forEach(Or=>Or.checked=Or.value===pr):Ej(gr.ref)?gr.ref.value="":(gr.ref.value=pr,gr.ref.type||$.state.next({name:et,values:Fo(_)})))}(Wt.shouldDirty||Wt.shouldTouch)&&Ee(et,pr,Wt.shouldTouch,Wt.shouldDirty,!0),Wt.shouldValidate&&_t(et)},Ye=(et,Et,Wt)=>{for(const Ar in Et){if(!Et.hasOwnProperty(Ar))return;const pr=Et[Ar],gr=et+"."+Ar,Or=qr(c,gr);(o.array.has(et)||xo(pr)||Or&&!Or._f)&&!am(pr)?Ye(gr,pr,Wt):je(gr,pr,Wt)}},qe=(et,Et,Wt={})=>{const Ar=qr(c,et),pr=o.array.has(et),gr=Fo(Et);gs(_,et,gr),pr?($.array.next({name:et,values:Fo(_)}),(N.isDirty||N.dirtyFields||U.isDirty||U.dirtyFields)&&Wt.shouldDirty&&$.state.next({name:et,dirtyFields:n0(f,_),isDirty:yt(et,gr)})):Ar&&!Ar._f&&!Wa(gr)?Ye(et,gr,Wt):je(et,gr,Wt),Vz(et,o)&&$.state.next({...i,name:et}),$.state.next({name:x.mount?et:void 0,values:Fo(_)})},We=async et=>{x.mount=!0;const Et=et.target;let Wt=Et.name,Ar=!0;const pr=qr(c,Wt),gr=gi=>{Ar=Number.isNaN(gi)||am(gi)&&isNaN(gi.getTime())||jd(gi,qr(_,Wt,gi))},Or=Fz(t.mode),Ln=Fz(t.reValidateMode);if(pr){let gi,Fi;const to=Et.type?zz(pr._f):p6(et),Ss=et.type===ET.BLUR||et.type===ET.FOCUS_OUT,ua=!kie(pr._f)&&!t.resolver&&!qr(i.errors,Wt)&&!pr._f.deps||Mie(Ss,qr(i.touchedFields,Wt),i.isSubmitted,Ln,Or),jo=Vz(Wt,o,Ss);gs(_,Wt,to),Ss?(pr._f.onBlur&&pr._f.onBlur(et),I&&I(0)):pr._f.onChange&&pr._f.onChange(et);const Yt=Ee(Wt,to,Ss),$n=!gl(Yt)||jo;if(!Ss&&$.state.next({name:Wt,type:et.type,values:Fo(_)}),ua)return(N.isValid||U.isValid)&&(t.mode==="onBlur"?Ss&&H():Ss||H()),$n&&$.state.next({name:Wt,...jo?{}:Yt});if(!Ss&&jo&&$.state.next({...i}),t.resolver){const{errors:as}=await Ne([Wt]);if(gr(to),Ar){const Ts=Uz(i.errors,c,Wt),bi=Uz(as,c,Ts.name||Wt);gi=bi.error,Wt=bi.name,Fi=gl(as)}}else K([Wt],!0),gi=(await qz(pr,o.disabled,_,B,t.shouldUseNativeValidation))[Wt],K([Wt]),gr(to),Ar&&(gi?Fi=!1:(N.isValid||U.isValid)&&(Fi=await Pt(c,!0)));Ar&&(pr._f.deps&&_t(pr._f.deps),xe(Wt,Fi,gi,Yt))}},$e=(et,Et)=>{if(qr(i.errors,Et)&&et.focus)return et.focus(),1},_t=async(et,Et={})=>{let Wt,Ar;const pr=C0(et);if(t.resolver){const gr=await lt(_o(et)?et:pr);Wt=gl(gr),Ar=et?!pr.some(Or=>qr(gr,Or)):Wt}else et?(Ar=(await Promise.all(pr.map(async gr=>{const Or=qr(c,gr);return await Pt(Or&&Or._f?{[gr]:Or}:Or)}))).every(Boolean),!(!Ar&&!i.isValid)&&H()):Ar=Wt=await Pt(c);return $.state.next({...!Fu(et)||(N.isValid||U.isValid)&&Wt!==i.isValid?{}:{name:et},...t.resolver||!et?{isValid:Wt}:{},errors:i.errors}),Et.shouldFocus&&!Ar&&A0(c,$e,et?pr:o.mount),Ar},mt=et=>{const Et={...x.mount?_:f};return _o(et)?Et:Fu(et)?qr(Et,et):et.map(Wt=>qr(Et,Wt))},rt=(et,Et)=>({invalid:!!qr((Et||i).errors,et),isDirty:!!qr((Et||i).dirtyFields,et),error:qr((Et||i).errors,et),isValidating:!!qr(i.validatingFields,et),isTouched:!!qr((Et||i).touchedFields,et)}),Tt=et=>{et&&C0(et).forEach(Et=>Io(i.errors,Et)),$.state.next({errors:et?i.errors:{}})},Vt=(et,Et,Wt)=>{const Ar=(qr(c,et,{_f:{}})._f||{}).ref,pr=qr(i.errors,et)||{},{ref:gr,message:Or,type:Ln,...gi}=pr;gs(i.errors,et,{...gi,...Et,ref:Ar}),$.state.next({name:et,errors:i.errors,isValid:!1}),Wt&&Wt.shouldFocus&&Ar&&Ar.focus&&Ar.focus()},it=(et,Et)=>Zc(et)?$.state.subscribe({next:Wt=>"values"in Wt&&et(Me(void 0,Et),Wt)}):Me(et,Et,!0),ir=et=>$.state.subscribe({next:Et=>{Rie(et.name,Et.name,et.exact)&&jie(Et,et.formState||N,Os,et.reRenderRoot)&&et.callback({values:{..._},...i,...Et,defaultValues:f})}}).unsubscribe,wr=et=>(x.mount=!0,U={...U,...et.formState},ir({...et,formState:U})),Bt=(et,Et={})=>{for(const Wt of et?C0(et):o.mount)o.mount.delete(Wt),o.array.delete(Wt),Et.keepValue||(Io(c,Wt),Io(_,Wt)),!Et.keepError&&Io(i.errors,Wt),!Et.keepDirty&&Io(i.dirtyFields,Wt),!Et.keepTouched&&Io(i.touchedFields,Wt),!Et.keepIsValidating&&Io(i.validatingFields,Wt),!t.shouldUnregister&&!Et.keepDefaultValue&&Io(f,Wt);$.state.next({values:Fo(_)}),$.state.next({...i,...Et.keepDirty?{isDirty:yt()}:{}}),!Et.keepIsValid&&H()},Wr=({disabled:et,name:Et})=>{(Ol(et)&&x.mount||et||o.disabled.has(Et))&&(et?o.disabled.add(Et):o.disabled.delete(Et))},Er=(et,Et={})=>{let Wt=qr(c,et);const Ar=Ol(Et.disabled)||Ol(t.disabled);return gs(c,et,{...Wt||{},_f:{...Wt&&Wt._f?Wt._f:{ref:{name:et}},name:et,mount:!0,...Et}}),o.mount.add(et),Wt?Wr({disabled:Ol(Et.disabled)?Et.disabled:t.disabled,name:et}):ue(et,!0,Et.value),{...Ar?{disabled:Et.disabled||t.disabled}:{},...t.progressive?{required:!!Et.required,min:i0(Et.min),max:i0(Et.max),minLength:i0(Et.minLength),maxLength:i0(Et.maxLength),pattern:i0(Et.pattern)}:{},name:et,onChange:We,onBlur:We,ref:pr=>{if(pr){Er(et,Et),Wt=qr(c,et);const gr=_o(pr.value)&&pr.querySelectorAll&&pr.querySelectorAll("input,select,textarea")[0]||pr,Or=Eie(gr),Ln=Wt._f.refs||[];if(Or?Ln.find(gi=>gi===gr):gr===Wt._f.ref)return;gs(c,et,{_f:{...Wt._f,...Or?{refs:[...Ln.filter(EA),gr,...Array.isArray(qr(f,et))?[{}]:[]],ref:{type:gr.type,name:et}}:{ref:gr}}}),ue(et,!1,void 0,gr)}else Wt=qr(c,et,{}),Wt._f&&(Wt._f.mount=!1),(t.shouldUnregister||Et.shouldUnregister)&&!(m6(o.array,et)&&x.action)&&o.unMount.add(et)}}},Vr=()=>t.shouldFocusError&&A0(c,$e,o.mount),Ur=et=>{Ol(et)&&($.state.next({disabled:et}),A0(c,(Et,Wt)=>{const Ar=qr(c,Wt);Ar&&(Et.disabled=Ar._f.disabled||et,Array.isArray(Ar._f.refs)&&Ar._f.refs.forEach(pr=>{pr.disabled=Ar._f.disabled||et}))},0,!1))},jn=(et,Et)=>async Wt=>{let Ar;Wt&&(Wt.preventDefault&&Wt.preventDefault(),Wt.persist&&Wt.persist());let pr=Fo(_);if($.state.next({isSubmitting:!0}),t.resolver){const{errors:gr,values:Or}=await Ne();i.errors=gr,pr=Fo(Or)}else await Pt(c);if(o.disabled.size)for(const gr of o.disabled)Io(pr,gr);if(Io(i.errors,"root"),gl(i.errors)){$.state.next({errors:{}});try{await et(pr,Wt)}catch(gr){Ar=gr}}else Et&&await Et({...i.errors},Wt),Vr(),setTimeout(Vr);if($.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:gl(i.errors)&&!Ar,submitCount:i.submitCount+1,errors:i.errors}),Ar)throw Ar},yn=(et,Et={})=>{qr(c,et)&&(_o(Et.defaultValue)?qe(et,Fo(qr(f,et))):(qe(et,Et.defaultValue),gs(f,et,Fo(Et.defaultValue))),Et.keepTouched||Io(i.touchedFields,et),Et.keepDirty||(Io(i.dirtyFields,et),i.isDirty=Et.defaultValue?yt(et,Fo(qr(f,et))):yt()),Et.keepError||(Io(i.errors,et),N.isValid&&H()),$.state.next({...i}))},os=(et,Et={})=>{const Wt=et?Fo(et):f,Ar=Fo(Wt),pr=gl(et),gr=pr?f:Ar;if(Et.keepDefaultValues||(f=Wt),!Et.keepValues){if(Et.keepDirtyValues){const Or=new Set([...o.mount,...Object.keys(n0(f,_))]);for(const Ln of Array.from(Or))qr(i.dirtyFields,Ln)?gs(gr,Ln,qr(_,Ln)):qe(Ln,qr(gr,Ln))}else{if(xj&&_o(et))for(const Or of o.mount){const Ln=qr(c,Or);if(Ln&&Ln._f){const gi=Array.isArray(Ln._f.refs)?Ln._f.refs[0]:Ln._f.ref;if(CT(gi)){const Fi=gi.closest("form");if(Fi){Fi.reset();break}}}}if(Et.keepFieldsRef)for(const Or of o.mount)qe(Or,qr(gr,Or));else c={}}_=t.shouldUnregister?Et.keepDefaultValues?Fo(f):{}:Fo(gr),$.array.next({values:{...gr}}),$.state.next({values:{...gr}})}o={mount:Et.keepDirtyValues?o.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},x.mount=!N.isValid||!!Et.keepIsValid||!!Et.keepDirtyValues,x.watch=!!t.shouldUnregister,$.state.next({submitCount:Et.keepSubmitCount?i.submitCount:0,isDirty:pr?!1:Et.keepDirty?i.isDirty:!!(Et.keepDefaultValues&&!jd(et,f)),isSubmitted:Et.keepIsSubmitted?i.isSubmitted:!1,dirtyFields:pr?{}:Et.keepDirtyValues?Et.keepDefaultValues&&_?n0(f,_):i.dirtyFields:Et.keepDefaultValues&&et?n0(f,et):Et.keepDirty?i.dirtyFields:{},touchedFields:Et.keepTouched?i.touchedFields:{},errors:Et.keepErrors?i.errors:{},isSubmitSuccessful:Et.keepIsSubmitSuccessful?i.isSubmitSuccessful:!1,isSubmitting:!1})},qi=(et,Et)=>os(Zc(et)?et(_):et,Et),ps=(et,Et={})=>{const Wt=qr(c,et),Ar=Wt&&Wt._f;if(Ar){const pr=Ar.refs?Ar.refs[0]:Ar.ref;pr.focus&&(pr.focus(),Et.shouldSelect&&Zc(pr.select)&&pr.select())}},Os=et=>{i={...i,...et}},po={control:{register:Er,unregister:Bt,getFieldState:rt,handleSubmit:jn,setError:Vt,_subscribe:ir,_runSchema:Ne,_focusError:Vr,_getWatch:Me,_getDirty:yt,_setValid:H,_setFieldArray:re,_setDisabledField:Wr,_setErrors:X,_getFieldArray:be,_reset:os,_resetDefaultValues:()=>Zc(t.defaultValues)&&t.defaultValues().then(et=>{qi(et,t.resetOptions),$.state.next({isLoading:!1})}),_removeUnmounted:tt,_disableForm:Ur,_subjects:$,_proxyFormState:N,get _fields(){return c},get _formValues(){return _},get _state(){return x},set _state(et){x=et},get _defaultValues(){return f},get _names(){return o},set _names(et){o=et},get _formState(){return i},get _options(){return t},set _options(et){t={...t,...et}}},subscribe:wr,trigger:_t,register:Er,handleSubmit:jn,watch:it,setValue:qe,getValues:mt,reset:qi,resetField:yn,clearErrors:Tt,unregister:Bt,setError:Vt,setFocus:ps,getFieldState:rt};return{...po,formControl:po}}function Aj(e={}){const t=nr.useRef(void 0),i=nr.useRef(void 0),[c,f]=nr.useState({isDirty:!1,isValidating:!1,isLoading:Zc(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,isReady:!1,defaultValues:Zc(e.defaultValues)?void 0:e.defaultValues});if(!t.current)if(e.formControl)t.current={...e.formControl,formState:c},e.defaultValues&&!Zc(e.defaultValues)&&e.formControl.reset(e.defaultValues,e.resetOptions);else{const{formControl:x,...o}=Lie(e);t.current={...o,formState:c}}const _=t.current.control;return _._options=e,Tj(()=>{const x=_._subscribe({formState:_._proxyFormState,callback:()=>f({..._._formState}),reRenderRoot:!0});return f(o=>({...o,isReady:!0})),_._formState.isReady=!0,x},[_]),nr.useEffect(()=>_._disableForm(e.disabled),[_,e.disabled]),nr.useEffect(()=>{e.mode&&(_._options.mode=e.mode),e.reValidateMode&&(_._options.reValidateMode=e.reValidateMode)},[_,e.mode,e.reValidateMode]),nr.useEffect(()=>{e.errors&&(_._setErrors(e.errors),_._focusError())},[_,e.errors]),nr.useEffect(()=>{e.shouldUnregister&&_._subjects.state.next({values:_._getWatch()})},[_,e.shouldUnregister]),nr.useEffect(()=>{if(_._proxyFormState.isDirty){const x=_._getDirty();x!==c.isDirty&&_._subjects.state.next({isDirty:x})}},[_,c.isDirty]),nr.useEffect(()=>{e.values&&!jd(e.values,i.current)?(_._reset(e.values,{keepFieldsRef:!0,..._._options.resetOptions}),i.current=e.values,f(x=>({...x}))):_._resetDefaultValues()},[_,e.values]),nr.useEffect(()=>{_._state.mount||(_._setValid(),_._state.mount=!0),_._state.watch&&(_._state.watch=!1,_._subjects.state.next({..._._formState})),_._removeUnmounted()}),t.current.formState=g6(c,_),t.current}const Gz=(e,t,i)=>{if(e&&"reportValidity"in e){const c=qr(i,t);e.setCustomValidity(c&&c.message||""),e.reportValidity()}},E6=(e,t)=>{for(const i in t.fields){const c=t.fields[i];c&&c.ref&&"reportValidity"in c.ref?Gz(c.ref,i,e):c.refs&&c.refs.forEach(f=>Gz(f,i,e))}},zie=(e,t)=>{t.shouldUseNativeValidation&&E6(e,t);const i={};for(const c in e){const f=qr(t.fields,c),_=Object.assign(e[c]||{},{ref:f&&f.ref});if(Fie(t.names||Object.keys(e),c)){const x=Object.assign({},qr(i,c));gs(x,"root",_),gs(i,c,x)}else gs(i,c,_)}return i},Fie=(e,t)=>e.some(i=>i.startsWith(t+"."));var Bie=function(e,t){for(var i={};e.length;){var c=e[0],f=c.code,_=c.message,x=c.path.join(".");if(!i[x])if("unionErrors"in c){var o=c.unionErrors[0].errors[0];i[x]={message:o.message,type:o.code}}else i[x]={message:_,type:f};if("unionErrors"in c&&c.unionErrors.forEach(function(N){return N.errors.forEach(function(U){return e.push(U)})}),t){var I=i[x].types,P=I&&I[c.code];i[x]=y6(x,t,i,f,P?[].concat(P,c.message):c.message)}e.shift()}return i},Vie=function(e,t,i){return i===void 0&&(i={}),function(c,f,_){try{return Promise.resolve(function(x,o){try{var I=Promise.resolve(e[i.mode==="sync"?"parse":"parseAsync"](c,t)).then(function(P){return _.shouldUseNativeValidation&&E6({},_),{errors:{},values:i.raw?c:P}})}catch(P){return o(P)}return I&&I.then?I.then(void 0,o):I}(0,function(x){if(function(o){return Array.isArray(o==null?void 0:o.errors)}(x))return{values:{},errors:zie(Bie(x.errors,!_.shouldUseNativeValidation&&_.criteriaMode==="all"),_)};throw x}))}catch(x){return Promise.reject(x)}}};const Uie=xie,C6=V.createContext({}),nc=({...e})=>h.jsx(C6.Provider,{value:{name:e.name},children:h.jsx(Tie,{...e})}),y2=()=>{const e=V.useContext(C6),t=V.useContext(A6),{getFieldState:i,formState:c}=_2(),f=i(e.name,c);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:_}=t;return{id:_,name:e.name,formItemId:`${_}-form-item`,formDescriptionId:`${_}-form-item-description`,formMessageId:`${_}-form-item-message`,...f}},A6=V.createContext({}),dl=V.forwardRef(({className:e,...t},i)=>{const c=V.useId();return h.jsx(A6.Provider,{value:{id:c},children:h.jsx("div",{ref:i,className:yr("space-y-2",e),...t})})});dl.displayName="FormItem";const hl=V.forwardRef(({className:e,...t},i)=>{const{error:c,formItemId:f}=y2();return h.jsx(Kt,{ref:i,className:yr(c&&"text-destructive",e),htmlFor:f,...t})});hl.displayName="FormLabel";const fl=V.forwardRef(({...e},t)=>{const{error:i,formItemId:c,formDescriptionId:f,formMessageId:_}=y2();return h.jsx(Fm,{ref:t,id:c,"aria-describedby":i?`${f} ${_}`:`${f}`,"aria-invalid":!!i,...e})});fl.displayName="FormControl";const $ie=V.forwardRef(({className:e,...t},i)=>{const{formDescriptionId:c}=y2();return h.jsx("p",{ref:i,id:c,className:yr("text-sm text-muted-foreground",e),...t})});$ie.displayName="FormDescription";const Dl=V.forwardRef(({className:e,children:t,...i},c)=>{const{error:f,formMessageId:_}=y2(),x=f?String(f==null?void 0:f.message):t;return x?h.jsx("p",{ref:c,id:_,className:yr("text-sm font-medium text-destructive",e),...i,children:x}):null});Dl.displayName="FormMessage";const Tl=V.forwardRef(({className:e,...t},i)=>h.jsx("textarea",{className:yr("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:i,...t}));Tl.displayName="Textarea";const qie=Sb({titulo:sa().min(3,"Ttulo deve ter no mnimo 3 caracteres"),descricao:sa().optional(),tipo:sa().min(1,"Tipo  obrigatrio"),categoria:oS(["manutencao","rh","suprimentos","atendimento"]),subcategoria:sa().optional(),prioridade:oS(["baixa","media","alta","critica"]),status:oS(["aberto","em_andamento","pendente","concluido"]),unidade_id:sa().uuid("Unidade  obrigatria"),posto_servico_id:sa().uuid().optional(),contrato_id:sa().uuid().optional(),solicitante_id:sa().uuid().optional(),sla_horas:Fte.number().min(1).default(24),canal:oS(["app","webhook","qr"]).default("app")}),Wz=[".pdf",".doc",".docx",".xls",".xlsx",".jpg",".jpeg",".png"],Gie={manutencao:["Equipamento","Veculo","Infraestrutura"],rh:["Benefcios","Movimentao","Dvidas"],suprimentos:["Material","Uniforme","EPI"],atendimento:["Limpeza","Organizao","Predial","Outros"]};function Wie({open:e,onOpenChange:t,chamado:i,onSuccess:c}){const{toast:f}=$f(),[_,x]=V.useState(!1),[o,I]=V.useState(null),[P,N]=V.useState(null),[U,$]=V.useState([]),B=(i==null?void 0:i.id)??null,Y=Aj({resolver:Vie(qie),defaultValues:{titulo:"",descricao:"",tipo:"",categoria:"atendimento",subcategoria:"",prioridade:"media",status:"aberto",sla_horas:24,canal:"app"}});V.useEffect(()=>{(async()=>{const{data:{user:be}}=await Qe.auth.getUser();if(be){I(be.id);const{data:je}=await Qe.from("user_roles").select("role").eq("user_id",be.id).single();je&&N(je.role)}})()},[]);const{data:H}=vo({queryKey:["unidades"],queryFn:async()=>{const{data:Me,error:be}=await Qe.from("unidades").select("id, nome, codigo").eq("status","ativo").order("nome");if(be)throw be;return Me}}),{data:K}=vo({queryKey:["contratos"],queryFn:async()=>{const{data:Me,error:be}=await Qe.from("contratos").select("id, nome, codigo").eq("status","ativo").order("nome");if(be)throw be;return Me}}),{data:re,isLoading:G}=vo({queryKey:["chamado-anexos",B],enabled:!!B&&e,queryFn:async()=>{if(!B)return[];const{data:Me,error:be}=await Qe.from("chamados_anexos").select(`
          *,
          usuario:profiles(full_name)
        `).eq("chamado_id",B).order("created_at",{ascending:!1});if(be)throw be;return Me||[]}}),X=Y.watch("unidade_id"),{data:ue}=vo({queryKey:["postos",X],queryFn:async()=>{if(!X)return[];const{data:Me,error:be}=await Qe.from("postos_servico").select("id, nome, codigo").eq("unidade_id",X).eq("status","ativo").order("nome");if(be)throw be;return Me},enabled:!!X}),{data:Ee}=vo({queryKey:["colaboradores"],queryFn:async()=>{const{data:Me,error:be}=await Qe.from("colaboradores").select("id, nome_completo, cpf").eq("status","ativo").order("nome_completo");if(be)throw be;return Me}}),xe=re??[],Ne=Me=>{if(!Me){$([]);return}const be=Array.from(Me),je=[],Ye=[];be.forEach(qe=>{var $e;const We=`.${(($e=qe.name.split(".").pop())==null?void 0:$e.toLowerCase())||""}`;Wz.includes(We)?je.push(qe):Ye.push(qe.name)}),Ye.length>0&&f({title:"Formato no suportado",description:`Os arquivos (${Ye.join(", ")}) no so permitidos. Use PDF, DOCX, XLS ou imagens.`,variant:"destructive"}),$(je)},lt=async Me=>{try{const{data:be,error:je}=await Qe.storage.from("chamados-anexos").download(Me.caminho_storage);if(je||!be)throw je;const Ye=URL.createObjectURL(be),qe=document.createElement("a");qe.href=Ye,qe.download=Me.nome_arquivo,document.body.appendChild(qe),qe.click(),qe.remove(),URL.revokeObjectURL(Ye)}catch(be){console.error("Erro ao baixar anexo:",be),f({title:"Erro ao baixar anexo",description:"No foi possvel baixar o arquivo. Tente novamente.",variant:"destructive"})}},Pt=Y.watch("categoria");V.useEffect(()=>{i&&Y.reset({titulo:i.titulo||"",descricao:i.descricao||"",tipo:i.tipo||"",categoria:i.categoria||"atendimento",subcategoria:i.subcategoria||"",prioridade:i.prioridade||"media",status:i.status||"aberto",unidade_id:i.unidade_id||"",posto_servico_id:i.posto_servico_id||"",contrato_id:i.contrato_id||"",solicitante_id:i.solicitante_id||"",sla_horas:i.sla_horas||24,canal:i.canal||"app"})},[i,Y]);const tt=async Me=>{var be;x(!0);try{const je={titulo:Me.titulo,descricao:Me.descricao||null,tipo:Me.tipo,categoria:Me.categoria,subcategoria:Me.subcategoria||null,prioridade:Me.prioridade,status:Me.status,unidade_id:Me.unidade_id,posto_servico_id:Me.posto_servico_id||null,contrato_id:Me.contrato_id||null,sla_horas:Me.sla_horas,canal:Me.canal,numero:(i==null?void 0:i.numero)||`CH-${Date.now()}`};let Ye=i==null?void 0:i.id;if(i){const{error:qe}=await Qe.from("chamados").update(je).eq("id",i.id);if(qe)throw qe;f({title:"Chamado atualizado com sucesso!"})}else{const{data:qe,error:We}=await Qe.from("chamados").insert([je]).select().single();if(We)throw We;Ye=qe.id,f({title:"Chamado criado com sucesso!"})}if(U.length>0&&Ye){const{data:{user:qe}}=await Qe.auth.getUser();if(qe)for(const We of U){const $e=`.${((be=We.name.split(".").pop())==null?void 0:be.toLowerCase())||""}`;if(!Wz.includes($e)){f({title:"Formato no permitido",description:`O arquivo ${We.name} no est em um formato suportado.`,variant:"destructive"});continue}const _t=We.name.toLowerCase().replace(/[^\w.-]/g,"_"),mt=`${Ye}/${Date.now()}-${_t}`,{error:rt}=await Qe.storage.from("chamados-anexos").upload(mt,We);if(rt){console.error("Erro ao fazer upload:",rt);continue}await Qe.from("chamados_anexos").insert({chamado_id:Ye,usuario_id:qe.id,nome_arquivo:We.name,caminho_storage:mt,tipo_arquivo:We.type,tamanho_bytes:We.size})}}c(),Y.reset(),$([])}catch(je){f({title:"Erro ao salvar chamado",description:je.message,variant:"destructive"})}finally{x(!1)}},yt=P==="admin";return h.jsx(fo,{open:e,onOpenChange:t,children:h.jsxs(Js,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[h.jsxs(Qs,{children:[h.jsx(eo,{children:i?"Editar Chamado":"Novo Chamado"}),h.jsx(Yu,{children:i?"Atualize dados, anexos e informaes operacionais deste chamado.":"Preencha os campos para registrar um novo chamado."})]}),h.jsx(Uie,{...Y,children:h.jsxs("form",{onSubmit:Y.handleSubmit(tt),className:"space-y-4",children:[h.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[h.jsx(nc,{control:Y.control,name:"titulo",render:({field:Me})=>h.jsxs(dl,{className:"md:col-span-2",children:[h.jsx(hl,{children:"Ttulo *"}),h.jsx(fl,{children:h.jsx(_r,{...Me,placeholder:"Digite o ttulo do chamado"})}),h.jsx(Dl,{})]})}),h.jsx(nc,{control:Y.control,name:"tipo",render:({field:Me})=>h.jsxs(dl,{children:[h.jsx(hl,{children:"Tipo *"}),h.jsx(fl,{children:h.jsx(_r,{...Me,placeholder:"Ex: Corretiva, Preventiva"})}),h.jsx(Dl,{})]})}),h.jsx(nc,{control:Y.control,name:"categoria",render:({field:Me})=>h.jsxs(dl,{children:[h.jsx(hl,{children:"Categoria *"}),h.jsxs(un,{onValueChange:Me.onChange,value:Me.value,children:[h.jsx(fl,{children:h.jsx(on,{children:h.jsx(dn,{})})}),h.jsxs(an,{children:[h.jsx(kt,{value:"manutencao",children:"Manuteno"}),h.jsx(kt,{value:"rh",children:"RH"}),h.jsx(kt,{value:"suprimentos",children:"Suprimentos"}),h.jsx(kt,{value:"atendimento",children:"Atendimento"})]})]}),h.jsx(Dl,{})]})}),h.jsx(nc,{control:Y.control,name:"subcategoria",render:({field:Me})=>{var be;return h.jsxs(dl,{children:[h.jsx(hl,{children:"Subcategoria"}),h.jsxs(un,{onValueChange:Me.onChange,value:Me.value,children:[h.jsx(fl,{children:h.jsx(on,{children:h.jsx(dn,{placeholder:"Selecione..."})})}),h.jsx(an,{children:(be=Gie[Pt])==null?void 0:be.map(je=>h.jsx(kt,{value:je.toLowerCase(),children:je},je))})]}),h.jsx(Dl,{})]})}}),h.jsx(nc,{control:Y.control,name:"prioridade",render:({field:Me})=>h.jsxs(dl,{children:[h.jsx(hl,{children:"Prioridade *"}),h.jsxs(un,{onValueChange:Me.onChange,value:Me.value,children:[h.jsx(fl,{children:h.jsx(on,{children:h.jsx(dn,{})})}),h.jsxs(an,{children:[h.jsx(kt,{value:"baixa",children:"Baixa"}),h.jsx(kt,{value:"media",children:"Mdia"}),h.jsx(kt,{value:"alta",children:"Alta"}),h.jsx(kt,{value:"critica",children:"Crtica"})]})]}),h.jsx(Dl,{})]})}),h.jsx(nc,{control:Y.control,name:"status",render:({field:Me})=>h.jsxs(dl,{children:[h.jsx(hl,{children:"Status *"}),h.jsxs(un,{onValueChange:Me.onChange,value:Me.value,children:[h.jsx(fl,{children:h.jsx(on,{children:h.jsx(dn,{})})}),h.jsxs(an,{children:[h.jsx(kt,{value:"aberto",children:"Aberto"}),h.jsx(kt,{value:"em_andamento",children:"Em Andamento"}),h.jsx(kt,{value:"pendente",children:"Pendente"}),h.jsx(kt,{value:"concluido",children:"Concludo"})]})]}),h.jsx(Dl,{})]})}),h.jsx(nc,{control:Y.control,name:"sla_horas",render:({field:Me})=>h.jsxs(dl,{children:[h.jsx(hl,{children:"SLA (horas) *"}),h.jsx(fl,{children:h.jsx(_r,{type:"number",...Me,min:1})}),h.jsx(Dl,{})]})}),h.jsx(nc,{control:Y.control,name:"contrato_id",render:({field:Me})=>h.jsxs(dl,{children:[h.jsx(hl,{children:"Contrato"}),h.jsxs(un,{onValueChange:Me.onChange,value:Me.value,children:[h.jsx(fl,{children:h.jsx(on,{children:h.jsx(dn,{placeholder:"Selecione o contrato"})})}),h.jsx(an,{children:K==null?void 0:K.map(be=>h.jsxs(kt,{value:be.id,children:[be.codigo," - ",be.nome]},be.id))})]}),h.jsx(Dl,{})]})}),h.jsx(nc,{control:Y.control,name:"unidade_id",render:({field:Me})=>h.jsxs(dl,{children:[h.jsx(hl,{children:"Unidade *"}),h.jsxs(un,{onValueChange:Me.onChange,value:Me.value,children:[h.jsx(fl,{children:h.jsx(on,{children:h.jsx(dn,{placeholder:"Selecione a unidade"})})}),h.jsx(an,{children:H==null?void 0:H.map(be=>h.jsxs(kt,{value:be.id,children:[be.codigo," - ",be.nome]},be.id))})]}),h.jsx(Dl,{})]})}),h.jsx(nc,{control:Y.control,name:"posto_servico_id",render:({field:Me})=>h.jsxs(dl,{children:[h.jsx(hl,{children:"Posto de Servio"}),h.jsxs(un,{onValueChange:Me.onChange,value:Me.value,disabled:!X,children:[h.jsx(fl,{children:h.jsx(on,{children:h.jsx(dn,{placeholder:X?"Selecione o posto":"Selecione a unidade primeiro"})})}),h.jsx(an,{children:ue==null?void 0:ue.map(be=>h.jsxs(kt,{value:be.id,children:[be.codigo," - ",be.nome]},be.id))})]}),h.jsx(Dl,{})]})}),yt&&h.jsx(nc,{control:Y.control,name:"solicitante_id",render:({field:Me})=>h.jsxs(dl,{children:[h.jsx(hl,{children:"Solicitante"}),h.jsxs(un,{onValueChange:Me.onChange,value:Me.value,children:[h.jsx(fl,{children:h.jsx(on,{children:h.jsx(dn,{placeholder:"Selecione o solicitante"})})}),h.jsx(an,{children:Ee==null?void 0:Ee.map(be=>h.jsx(kt,{value:be.id,children:be.nome_completo},be.id))})]}),h.jsx(Dl,{})]})}),h.jsx(nc,{control:Y.control,name:"descricao",render:({field:Me})=>h.jsxs(dl,{className:"md:col-span-2",children:[h.jsx(hl,{children:"Descrio"}),h.jsx(fl,{children:h.jsx(Tl,{...Me,placeholder:"Descreva os detalhes do chamado",rows:4})}),h.jsx(Dl,{})]})}),h.jsxs(dl,{className:"md:col-span-2",children:[h.jsx(hl,{children:"Anexos"}),h.jsx(fl,{children:h.jsx(_r,{type:"file",multiple:!0,accept:".doc,.docx,.pdf,.xls,.xlsx,.jpg,.jpeg,.png,image/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:Me=>Ne(Me.target.files)})}),U.length>0&&h.jsxs("p",{className:"text-sm text-muted-foreground",children:[U.length," arquivo(s) selecionado(s)"]})]}),i&&h.jsxs("div",{className:"md:col-span-2 space-y-2",children:[h.jsxs("p",{className:"text-sm font-medium flex items-center gap-2",children:[h.jsx(g4,{className:"h-4 w-4"}),"Anexos atuais"]}),G?h.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando anexos..."}):xe.length>0?h.jsx("div",{className:"space-y-2",children:xe.map(Me=>{var be;return h.jsxs("div",{className:"flex items-center justify-between rounded-md border px-3 py-2 text-sm",children:[h.jsxs("div",{className:"min-w-0",children:[h.jsx("p",{className:"truncate font-medium",children:Me.nome_arquivo}),h.jsxs("p",{className:"text-xs text-muted-foreground",children:[Me.created_at?new Date(Me.created_at).toLocaleString("pt-BR"):"Sem data",(be=Me.usuario)!=null&&be.full_name?`  ${Me.usuario.full_name}`:""]})]}),h.jsx(tr,{type:"button",variant:"ghost",size:"sm",onClick:()=>lt(Me),children:"Baixar"})]},Me.id)})}):h.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum anexo cadastrado para este chamado."})]})]}),h.jsxs("div",{className:"flex justify-end gap-2",children:[h.jsx(tr,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancelar"}),h.jsxs(tr,{type:"submit",disabled:_,children:[_&&h.jsx(Xu,{className:"mr-2 h-4 w-4 animate-spin"}),i?"Atualizar":"Criar"," Chamado"]})]})]})})]})})}function zi(e){const t=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&t==="[object Date]"?new e.constructor(+e):typeof e=="number"||t==="[object Number]"||typeof e=="string"||t==="[object String]"?new Date(e):new Date(NaN)}function Gl(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}function Ha(e,t){const i=zi(e);return isNaN(t)?Gl(e,NaN):(t&&i.setDate(i.getDate()+t),i)}function Wl(e,t){const i=zi(e);if(isNaN(t))return Gl(e,NaN);if(!t)return i;const c=i.getDate(),f=Gl(e,i.getTime());f.setMonth(i.getMonth()+t+1,0);const _=f.getDate();return c>=_?f:(i.setFullYear(f.getFullYear(),f.getMonth(),c),i)}const Ij=6048e5,Hie=864e5;let Zie={};function kb(){return Zie}function tu(e,t){var o,I,P,N;const i=kb(),c=(t==null?void 0:t.weekStartsOn)??((I=(o=t==null?void 0:t.locale)==null?void 0:o.options)==null?void 0:I.weekStartsOn)??i.weekStartsOn??((N=(P=i.locale)==null?void 0:P.options)==null?void 0:N.weekStartsOn)??0,f=zi(e),_=f.getDay(),x=(_<c?7:0)+_-c;return f.setDate(f.getDate()-x),f.setHours(0,0,0,0),f}function Nm(e){return tu(e,{weekStartsOn:1})}function I6(e){const t=zi(e),i=t.getFullYear(),c=Gl(e,0);c.setFullYear(i+1,0,4),c.setHours(0,0,0,0);const f=Nm(c),_=Gl(e,0);_.setFullYear(i,0,4),_.setHours(0,0,0,0);const x=Nm(_);return t.getTime()>=f.getTime()?i+1:t.getTime()>=x.getTime()?i:i-1}function ky(e){const t=zi(e);return t.setHours(0,0,0,0),t}function PT(e){const t=zi(e),i=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return i.setUTCFullYear(t.getFullYear()),+e-+i}function Bu(e,t){const i=ky(e),c=ky(t),f=+i-PT(i),_=+c-PT(c);return Math.round((f-_)/Hie)}function Xie(e){const t=I6(e),i=Gl(e,0);return i.setFullYear(t,0,4),i.setHours(0,0,0,0),Nm(i)}function kP(e,t){const i=t*7;return Ha(e,i)}function Kie(e,t){return Wl(e,t*12)}function Yie(e){let t;return e.forEach(function(i){const c=zi(i);(t===void 0||t<c||isNaN(Number(c)))&&(t=c)}),t||new Date(NaN)}function Jie(e){let t;return e.forEach(i=>{const c=zi(i);(!t||t>c||isNaN(+c))&&(t=c)}),t||new Date(NaN)}function xl(e,t){const i=ky(e),c=ky(t);return+i==+c}function Pj(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function Qie(e){if(!Pj(e)&&typeof e!="number")return!1;const t=zi(e);return!isNaN(Number(t))}function sb(e,t){const i=zi(e),c=zi(t),f=i.getFullYear()-c.getFullYear(),_=i.getMonth()-c.getMonth();return f*12+_}function ese(e,t,i){const c=tu(e,i),f=tu(t,i),_=+c-PT(c),x=+f-PT(f);return Math.round((_-x)/Ij)}function ob(e){const t=zi(e),i=t.getMonth();return t.setFullYear(t.getFullYear(),i+1,0),t.setHours(23,59,59,999),t}function tse(e,t){const i=zi(e.start),c=zi(e.end);let f=+i>+c;const _=f?+i:+c,x=f?c:i;x.setHours(0,0,0,0);let o=1;const I=[];for(;+x<=_;)I.push(zi(x)),x.setDate(x.getDate()+o),x.setHours(0,0,0,0);return f?I.reverse():I}function Sa(e){const t=zi(e);return t.setDate(1),t.setHours(0,0,0,0),t}function P6(e){const t=zi(e),i=Gl(e,0);return i.setFullYear(t.getFullYear(),0,1),i.setHours(0,0,0,0),i}function v2(e,t){var o,I,P,N;const i=kb(),c=(t==null?void 0:t.weekStartsOn)??((I=(o=t==null?void 0:t.locale)==null?void 0:o.options)==null?void 0:I.weekStartsOn)??i.weekStartsOn??((N=(P=i.locale)==null?void 0:P.options)==null?void 0:N.weekStartsOn)??0,f=zi(e),_=f.getDay(),x=(_<c?-7:0)+6-(_-c);return f.setDate(f.getDate()+x),f.setHours(23,59,59,999),f}function k6(e){return v2(e,{weekStartsOn:1})}const rse={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},nse=(e,t,i)=>{let c;const f=rse[e];return typeof f=="string"?c=f:t===1?c=f.one:c=f.other.replace("{{count}}",t.toString()),i!=null&&i.addSuffix?i.comparison&&i.comparison>0?"in "+c:c+" ago":c};function J_(e){return(t={})=>{const i=t.width?String(t.width):e.defaultWidth;return e.formats[i]||e.formats[e.defaultWidth]}}const ise={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},sse={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},ose={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},ase={date:J_({formats:ise,defaultWidth:"full"}),time:J_({formats:sse,defaultWidth:"full"}),dateTime:J_({formats:ose,defaultWidth:"full"})},lse={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},cse=(e,t,i,c)=>lse[e];function Ou(e){return(t,i)=>{const c=i!=null&&i.context?String(i.context):"standalone";let f;if(c==="formatting"&&e.formattingValues){const x=e.defaultFormattingWidth||e.defaultWidth,o=i!=null&&i.width?String(i.width):x;f=e.formattingValues[o]||e.formattingValues[x]}else{const x=e.defaultWidth,o=i!=null&&i.width?String(i.width):e.defaultWidth;f=e.values[o]||e.values[x]}const _=e.argumentCallback?e.argumentCallback(t):t;return f[_]}}const use={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},dse={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},hse={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},fse={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},pse={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},mse={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},gse=(e,t)=>{const i=Number(e),c=i%100;if(c>20||c<10)switch(c%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}return i+"th"},_se={ordinalNumber:gse,era:Ou({values:use,defaultWidth:"wide"}),quarter:Ou({values:dse,defaultWidth:"wide",argumentCallback:e=>e-1}),month:Ou({values:hse,defaultWidth:"wide"}),day:Ou({values:fse,defaultWidth:"wide"}),dayPeriod:Ou({values:pse,defaultWidth:"wide",formattingValues:mse,defaultFormattingWidth:"wide"})};function Lu(e){return(t,i={})=>{const c=i.width,f=c&&e.matchPatterns[c]||e.matchPatterns[e.defaultMatchWidth],_=t.match(f);if(!_)return null;const x=_[0],o=c&&e.parsePatterns[c]||e.parsePatterns[e.defaultParseWidth],I=Array.isArray(o)?vse(o,U=>U.test(x)):yse(o,U=>U.test(x));let P;P=e.valueCallback?e.valueCallback(I):I,P=i.valueCallback?i.valueCallback(P):P;const N=t.slice(x.length);return{value:P,rest:N}}}function yse(e,t){for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t(e[i]))return i}function vse(e,t){for(let i=0;i<e.length;i++)if(t(e[i]))return i}function j6(e){return(t,i={})=>{const c=t.match(e.matchPattern);if(!c)return null;const f=c[0],_=t.match(e.parsePattern);if(!_)return null;let x=e.valueCallback?e.valueCallback(_[0]):_[0];x=i.valueCallback?i.valueCallback(x):x;const o=t.slice(f.length);return{value:x,rest:o}}}const xse=/^(\d+)(th|st|nd|rd)?/i,bse=/\d+/i,wse={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Sse={any:[/^b/i,/^(a|c)/i]},Tse={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Ese={any:[/1/i,/2/i,/3/i,/4/i]},Cse={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Ase={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Ise={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Pse={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},kse={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},jse={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Rse={ordinalNumber:j6({matchPattern:xse,parsePattern:bse,valueCallback:e=>parseInt(e,10)}),era:Lu({matchPatterns:wse,defaultMatchWidth:"wide",parsePatterns:Sse,defaultParseWidth:"any"}),quarter:Lu({matchPatterns:Tse,defaultMatchWidth:"wide",parsePatterns:Ese,defaultParseWidth:"any",valueCallback:e=>e+1}),month:Lu({matchPatterns:Cse,defaultMatchWidth:"wide",parsePatterns:Ase,defaultParseWidth:"any"}),day:Lu({matchPatterns:Ise,defaultMatchWidth:"wide",parsePatterns:Pse,defaultParseWidth:"any"}),dayPeriod:Lu({matchPatterns:kse,defaultMatchWidth:"any",parsePatterns:jse,defaultParseWidth:"any"})},R6={code:"en-US",formatDistance:nse,formatLong:ase,formatRelative:cse,localize:_se,match:Rse,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Mse(e){const t=zi(e);return Bu(t,P6(t))+1}function M6(e){const t=zi(e),i=+Nm(t)-+Xie(t);return Math.round(i/Ij)+1}function D6(e,t){var N,U,$,B;const i=zi(e),c=i.getFullYear(),f=kb(),_=(t==null?void 0:t.firstWeekContainsDate)??((U=(N=t==null?void 0:t.locale)==null?void 0:N.options)==null?void 0:U.firstWeekContainsDate)??f.firstWeekContainsDate??((B=($=f.locale)==null?void 0:$.options)==null?void 0:B.firstWeekContainsDate)??1,x=Gl(e,0);x.setFullYear(c+1,0,_),x.setHours(0,0,0,0);const o=tu(x,t),I=Gl(e,0);I.setFullYear(c,0,_),I.setHours(0,0,0,0);const P=tu(I,t);return i.getTime()>=o.getTime()?c+1:i.getTime()>=P.getTime()?c:c-1}function Dse(e,t){var o,I,P,N;const i=kb(),c=(t==null?void 0:t.firstWeekContainsDate)??((I=(o=t==null?void 0:t.locale)==null?void 0:o.options)==null?void 0:I.firstWeekContainsDate)??i.firstWeekContainsDate??((N=(P=i.locale)==null?void 0:P.options)==null?void 0:N.firstWeekContainsDate)??1,f=D6(e,t),_=Gl(e,0);return _.setFullYear(f,0,c),_.setHours(0,0,0,0),tu(_,t)}function N6(e,t){const i=zi(e),c=+tu(i,t)-+Dse(i,t);return Math.round(c/Ij)+1}function _s(e,t){const i=e<0?"-":"",c=Math.abs(e).toString().padStart(t,"0");return i+c}const Kh={y(e,t){const i=e.getFullYear(),c=i>0?i:1-i;return _s(t==="yy"?c%100:c,t.length)},M(e,t){const i=e.getMonth();return t==="M"?String(i+1):_s(i+1,2)},d(e,t){return _s(e.getDate(),t.length)},a(e,t){const i=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return i.toUpperCase();case"aaa":return i;case"aaaaa":return i[0];case"aaaa":default:return i==="am"?"a.m.":"p.m."}},h(e,t){return _s(e.getHours()%12||12,t.length)},H(e,t){return _s(e.getHours(),t.length)},m(e,t){return _s(e.getMinutes(),t.length)},s(e,t){return _s(e.getSeconds(),t.length)},S(e,t){const i=t.length,c=e.getMilliseconds(),f=Math.trunc(c*Math.pow(10,i-3));return _s(f,t.length)}},E_={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Hz={G:function(e,t,i){const c=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return i.era(c,{width:"abbreviated"});case"GGGGG":return i.era(c,{width:"narrow"});case"GGGG":default:return i.era(c,{width:"wide"})}},y:function(e,t,i){if(t==="yo"){const c=e.getFullYear(),f=c>0?c:1-c;return i.ordinalNumber(f,{unit:"year"})}return Kh.y(e,t)},Y:function(e,t,i,c){const f=D6(e,c),_=f>0?f:1-f;if(t==="YY"){const x=_%100;return _s(x,2)}return t==="Yo"?i.ordinalNumber(_,{unit:"year"}):_s(_,t.length)},R:function(e,t){const i=I6(e);return _s(i,t.length)},u:function(e,t){const i=e.getFullYear();return _s(i,t.length)},Q:function(e,t,i){const c=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(c);case"QQ":return _s(c,2);case"Qo":return i.ordinalNumber(c,{unit:"quarter"});case"QQQ":return i.quarter(c,{width:"abbreviated",context:"formatting"});case"QQQQQ":return i.quarter(c,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(c,{width:"wide",context:"formatting"})}},q:function(e,t,i){const c=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(c);case"qq":return _s(c,2);case"qo":return i.ordinalNumber(c,{unit:"quarter"});case"qqq":return i.quarter(c,{width:"abbreviated",context:"standalone"});case"qqqqq":return i.quarter(c,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(c,{width:"wide",context:"standalone"})}},M:function(e,t,i){const c=e.getMonth();switch(t){case"M":case"MM":return Kh.M(e,t);case"Mo":return i.ordinalNumber(c+1,{unit:"month"});case"MMM":return i.month(c,{width:"abbreviated",context:"formatting"});case"MMMMM":return i.month(c,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(c,{width:"wide",context:"formatting"})}},L:function(e,t,i){const c=e.getMonth();switch(t){case"L":return String(c+1);case"LL":return _s(c+1,2);case"Lo":return i.ordinalNumber(c+1,{unit:"month"});case"LLL":return i.month(c,{width:"abbreviated",context:"standalone"});case"LLLLL":return i.month(c,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(c,{width:"wide",context:"standalone"})}},w:function(e,t,i,c){const f=N6(e,c);return t==="wo"?i.ordinalNumber(f,{unit:"week"}):_s(f,t.length)},I:function(e,t,i){const c=M6(e);return t==="Io"?i.ordinalNumber(c,{unit:"week"}):_s(c,t.length)},d:function(e,t,i){return t==="do"?i.ordinalNumber(e.getDate(),{unit:"date"}):Kh.d(e,t)},D:function(e,t,i){const c=Mse(e);return t==="Do"?i.ordinalNumber(c,{unit:"dayOfYear"}):_s(c,t.length)},E:function(e,t,i){const c=e.getDay();switch(t){case"E":case"EE":case"EEE":return i.day(c,{width:"abbreviated",context:"formatting"});case"EEEEE":return i.day(c,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(c,{width:"short",context:"formatting"});case"EEEE":default:return i.day(c,{width:"wide",context:"formatting"})}},e:function(e,t,i,c){const f=e.getDay(),_=(f-c.weekStartsOn+8)%7||7;switch(t){case"e":return String(_);case"ee":return _s(_,2);case"eo":return i.ordinalNumber(_,{unit:"day"});case"eee":return i.day(f,{width:"abbreviated",context:"formatting"});case"eeeee":return i.day(f,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(f,{width:"short",context:"formatting"});case"eeee":default:return i.day(f,{width:"wide",context:"formatting"})}},c:function(e,t,i,c){const f=e.getDay(),_=(f-c.weekStartsOn+8)%7||7;switch(t){case"c":return String(_);case"cc":return _s(_,t.length);case"co":return i.ordinalNumber(_,{unit:"day"});case"ccc":return i.day(f,{width:"abbreviated",context:"standalone"});case"ccccc":return i.day(f,{width:"narrow",context:"standalone"});case"cccccc":return i.day(f,{width:"short",context:"standalone"});case"cccc":default:return i.day(f,{width:"wide",context:"standalone"})}},i:function(e,t,i){const c=e.getDay(),f=c===0?7:c;switch(t){case"i":return String(f);case"ii":return _s(f,t.length);case"io":return i.ordinalNumber(f,{unit:"day"});case"iii":return i.day(c,{width:"abbreviated",context:"formatting"});case"iiiii":return i.day(c,{width:"narrow",context:"formatting"});case"iiiiii":return i.day(c,{width:"short",context:"formatting"});case"iiii":default:return i.day(c,{width:"wide",context:"formatting"})}},a:function(e,t,i){const f=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return i.dayPeriod(f,{width:"abbreviated",context:"formatting"});case"aaa":return i.dayPeriod(f,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return i.dayPeriod(f,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(f,{width:"wide",context:"formatting"})}},b:function(e,t,i){const c=e.getHours();let f;switch(c===12?f=E_.noon:c===0?f=E_.midnight:f=c/12>=1?"pm":"am",t){case"b":case"bb":return i.dayPeriod(f,{width:"abbreviated",context:"formatting"});case"bbb":return i.dayPeriod(f,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return i.dayPeriod(f,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(f,{width:"wide",context:"formatting"})}},B:function(e,t,i){const c=e.getHours();let f;switch(c>=17?f=E_.evening:c>=12?f=E_.afternoon:c>=4?f=E_.morning:f=E_.night,t){case"B":case"BB":case"BBB":return i.dayPeriod(f,{width:"abbreviated",context:"formatting"});case"BBBBB":return i.dayPeriod(f,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(f,{width:"wide",context:"formatting"})}},h:function(e,t,i){if(t==="ho"){let c=e.getHours()%12;return c===0&&(c=12),i.ordinalNumber(c,{unit:"hour"})}return Kh.h(e,t)},H:function(e,t,i){return t==="Ho"?i.ordinalNumber(e.getHours(),{unit:"hour"}):Kh.H(e,t)},K:function(e,t,i){const c=e.getHours()%12;return t==="Ko"?i.ordinalNumber(c,{unit:"hour"}):_s(c,t.length)},k:function(e,t,i){let c=e.getHours();return c===0&&(c=24),t==="ko"?i.ordinalNumber(c,{unit:"hour"}):_s(c,t.length)},m:function(e,t,i){return t==="mo"?i.ordinalNumber(e.getMinutes(),{unit:"minute"}):Kh.m(e,t)},s:function(e,t,i){return t==="so"?i.ordinalNumber(e.getSeconds(),{unit:"second"}):Kh.s(e,t)},S:function(e,t){return Kh.S(e,t)},X:function(e,t,i){const c=e.getTimezoneOffset();if(c===0)return"Z";switch(t){case"X":return Xz(c);case"XXXX":case"XX":return em(c);case"XXXXX":case"XXX":default:return em(c,":")}},x:function(e,t,i){const c=e.getTimezoneOffset();switch(t){case"x":return Xz(c);case"xxxx":case"xx":return em(c);case"xxxxx":case"xxx":default:return em(c,":")}},O:function(e,t,i){const c=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+Zz(c,":");case"OOOO":default:return"GMT"+em(c,":")}},z:function(e,t,i){const c=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+Zz(c,":");case"zzzz":default:return"GMT"+em(c,":")}},t:function(e,t,i){const c=Math.trunc(e.getTime()/1e3);return _s(c,t.length)},T:function(e,t,i){const c=e.getTime();return _s(c,t.length)}};function Zz(e,t=""){const i=e>0?"-":"+",c=Math.abs(e),f=Math.trunc(c/60),_=c%60;return _===0?i+String(f):i+String(f)+t+_s(_,2)}function Xz(e,t){return e%60===0?(e>0?"-":"+")+_s(Math.abs(e)/60,2):em(e,t)}function em(e,t=""){const i=e>0?"-":"+",c=Math.abs(e),f=_s(Math.trunc(c/60),2),_=_s(c%60,2);return i+f+t+_}const Kz=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},O6=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},Nse=(e,t)=>{const i=e.match(/(P+)(p+)?/)||[],c=i[1],f=i[2];if(!f)return Kz(e,t);let _;switch(c){case"P":_=t.dateTime({width:"short"});break;case"PP":_=t.dateTime({width:"medium"});break;case"PPP":_=t.dateTime({width:"long"});break;case"PPPP":default:_=t.dateTime({width:"full"});break}return _.replace("{{date}}",Kz(c,t)).replace("{{time}}",O6(f,t))},Ose={p:O6,P:Nse},Lse=/^D+$/,zse=/^Y+$/,Fse=["D","DD","YY","YYYY"];function Bse(e){return Lse.test(e)}function Vse(e){return zse.test(e)}function Use(e,t,i){const c=$se(e,t,i);if(console.warn(c),Fse.includes(e))throw new RangeError(c)}function $se(e,t,i){const c=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${c} to the input \`${i}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const qse=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Gse=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Wse=/^'([^]*?)'?$/,Hse=/''/g,Zse=/[a-zA-Z]/;function Hs(e,t,i){var N,U,$,B,Y,H,K,re;const c=kb(),f=(i==null?void 0:i.locale)??c.locale??R6,_=(i==null?void 0:i.firstWeekContainsDate)??((U=(N=i==null?void 0:i.locale)==null?void 0:N.options)==null?void 0:U.firstWeekContainsDate)??c.firstWeekContainsDate??((B=($=c.locale)==null?void 0:$.options)==null?void 0:B.firstWeekContainsDate)??1,x=(i==null?void 0:i.weekStartsOn)??((H=(Y=i==null?void 0:i.locale)==null?void 0:Y.options)==null?void 0:H.weekStartsOn)??c.weekStartsOn??((re=(K=c.locale)==null?void 0:K.options)==null?void 0:re.weekStartsOn)??0,o=zi(e);if(!Qie(o))throw new RangeError("Invalid time value");let I=t.match(Gse).map(G=>{const X=G[0];if(X==="p"||X==="P"){const ue=Ose[X];return ue(G,f.formatLong)}return G}).join("").match(qse).map(G=>{if(G==="''")return{isToken:!1,value:"'"};const X=G[0];if(X==="'")return{isToken:!1,value:Xse(G)};if(Hz[X])return{isToken:!0,value:G};if(X.match(Zse))throw new RangeError("Format string contains an unescaped latin alphabet character `"+X+"`");return{isToken:!1,value:G}});f.localize.preprocessor&&(I=f.localize.preprocessor(o,I));const P={firstWeekContainsDate:_,weekStartsOn:x,locale:f};return I.map(G=>{if(!G.isToken)return G.value;const X=G.value;(!(i!=null&&i.useAdditionalWeekYearTokens)&&Vse(X)||!(i!=null&&i.useAdditionalDayOfYearTokens)&&Bse(X))&&Use(X,t,String(e));const ue=Hz[X[0]];return ue(o,X,f.localize,P)}).join("")}function Xse(e){const t=e.match(Wse);return t?t[1].replace(Hse,"'"):e}function Kse(e){const t=zi(e),i=t.getFullYear(),c=t.getMonth(),f=Gl(e,0);return f.setFullYear(i,c+1,0),f.setHours(0,0,0,0),f.getDate()}function Yse(e){return Math.trunc(+zi(e)/1e3)}function Jse(e){const t=zi(e),i=t.getMonth();return t.setFullYear(t.getFullYear(),i+1,0),t.setHours(0,0,0,0),t}function Qse(e,t){return ese(Jse(e),Sa(e),t)+1}function jP(e,t){const i=zi(e),c=zi(t);return i.getTime()>c.getTime()}function L6(e,t){const i=zi(e),c=zi(t);return+i<+c}function x2(e,t){const i=zi(e),c=zi(t);return i.getFullYear()===c.getFullYear()&&i.getMonth()===c.getMonth()}function eoe(e,t){const i=zi(e),c=zi(t);return i.getFullYear()===c.getFullYear()}function CA(e,t){return Ha(e,-t)}function AA(e,t){const i=zi(e),c=i.getFullYear(),f=i.getDate(),_=Gl(e,0);_.setFullYear(c,t,15),_.setHours(0,0,0,0);const x=Kse(_);return i.setMonth(t,Math.min(f,x)),i}function Yz(e,t){const i=zi(e);return isNaN(+i)?Gl(e,NaN):(i.setFullYear(t),i)}const toe={lessThanXSeconds:{one:"menos de um segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"meio minuto",lessThanXMinutes:{one:"menos de um minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"cerca de 1 hora",other:"cerca de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 dia",other:"{{count}} dias"},aboutXWeeks:{one:"cerca de 1 semana",other:"cerca de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"cerca de 1 ms",other:"cerca de {{count}} meses"},xMonths:{one:"1 ms",other:"{{count}} meses"},aboutXYears:{one:"cerca de 1 ano",other:"cerca de {{count}} anos"},xYears:{one:"1 ano",other:"{{count}} anos"},overXYears:{one:"mais de 1 ano",other:"mais de {{count}} anos"},almostXYears:{one:"quase 1 ano",other:"quase {{count}} anos"}},roe=(e,t,i)=>{let c;const f=toe[e];return typeof f=="string"?c=f:t===1?c=f.one:c=f.other.replace("{{count}}",String(t)),i!=null&&i.addSuffix?i.comparison&&i.comparison>0?"em "+c:"h "+c:c},noe={full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/yyyy"},ioe={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},soe={full:"{{date}} 's' {{time}}",long:"{{date}} 's' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},ooe={date:J_({formats:noe,defaultWidth:"full"}),time:J_({formats:ioe,defaultWidth:"full"}),dateTime:J_({formats:soe,defaultWidth:"full"})},aoe={lastWeek:e=>{const t=e.getDay();return"'"+(t===0||t===6?"ltimo":"ltima")+"' eeee 's' p"},yesterday:"'ontem s' p",today:"'hoje s' p",tomorrow:"'amanh s' p",nextWeek:"eeee 's' p",other:"P"},loe=(e,t,i,c)=>{const f=aoe[e];return typeof f=="function"?f(t):f},coe={narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","depois de cristo"]},uoe={narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1 trimestre","2 trimestre","3 trimestre","4 trimestre"]},doe={narrow:["j","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov","dez"],wide:["janeiro","fevereiro","maro","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"]},hoe={narrow:["D","S","T","Q","Q","S","S"],short:["dom","seg","ter","qua","qui","sex","sab"],abbreviated:["domingo","segunda","tera","quarta","quinta","sexta","sbado"],wide:["domingo","segunda-feira","tera-feira","quarta-feira","quinta-feira","sexta-feira","sbado"]},foe={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"manh",afternoon:"tarde",evening:"tarde",night:"noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"manh",afternoon:"tarde",evening:"tarde",night:"noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"manh",afternoon:"tarde",evening:"tarde",night:"noite"}},poe={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"da manh",afternoon:"da tarde",evening:"da tarde",night:"da noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"da manh",afternoon:"da tarde",evening:"da tarde",night:"da noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"da manh",afternoon:"da tarde",evening:"da tarde",night:"da noite"}},moe=(e,t)=>{const i=Number(e);return(t==null?void 0:t.unit)==="week"?i+"":i+""},goe={ordinalNumber:moe,era:Ou({values:coe,defaultWidth:"wide"}),quarter:Ou({values:uoe,defaultWidth:"wide",argumentCallback:e=>e-1}),month:Ou({values:doe,defaultWidth:"wide"}),day:Ou({values:hoe,defaultWidth:"wide"}),dayPeriod:Ou({values:foe,defaultWidth:"wide",formattingValues:poe,defaultFormattingWidth:"wide"})},_oe=/^(\d+)[o]?/i,yoe=/\d+/i,voe={narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|d\.?\s?c\.?)/i,wide:/^(antes de cristo|depois de cristo)/i},xoe={any:[/^ac/i,/^dc/i],wide:[/^antes de cristo/i,/^depois de cristo/i]},boe={narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234]()? trimestre/i},woe={any:[/1/i,/2/i,/3/i,/4/i]},Soe={narrow:/^[jfmajsond]/i,abbreviated:/^(jan|fev|mar|abr|mai|jun|jul|ago|set|out|nov|dez)/i,wide:/^(janeiro|fevereiro|maro|abril|maio|junho|julho|agosto|setembro|outubro|novembro|dezembro)/i},Toe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^fev/i,/^mar/i,/^abr/i,/^mai/i,/^jun/i,/^jul/i,/^ago/i,/^set/i,/^out/i,/^nov/i,/^dez/i]},Eoe={narrow:/^(dom|[23456]?|s[a]b)/i,short:/^(dom|[23456]?|s[a]b)/i,abbreviated:/^(dom|seg|ter|qua|qui|sex|s[a]b)/i,wide:/^(domingo|(segunda|ter[c]a|quarta|quinta|sexta)([- ]feira)?|s[a]bado)/i},Coe={short:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[a]/i],narrow:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[a]/i],any:[/^d/i,/^seg/i,/^t/i,/^qua/i,/^qui/i,/^sex/i,/^s[a]b/i]},Aoe={narrow:/^(a|p|mn|md|(da) (manh|tarde|noite))/i,any:/^([ap]\.?\s?m\.?|meia[-\s]noite|meio[-\s]dia|(da) (manh|tarde|noite))/i},Ioe={any:{am:/^a/i,pm:/^p/i,midnight:/^mn|^meia[-\s]noite/i,noon:/^md|^meio[-\s]dia/i,morning:/manh/i,afternoon:/tarde/i,evening:/tarde/i,night:/noite/i}},Poe={ordinalNumber:j6({matchPattern:_oe,parsePattern:yoe,valueCallback:e=>parseInt(e,10)}),era:Lu({matchPatterns:voe,defaultMatchWidth:"wide",parsePatterns:xoe,defaultParseWidth:"any"}),quarter:Lu({matchPatterns:boe,defaultMatchWidth:"wide",parsePatterns:woe,defaultParseWidth:"any",valueCallback:e=>e+1}),month:Lu({matchPatterns:Soe,defaultMatchWidth:"wide",parsePatterns:Toe,defaultParseWidth:"any"}),day:Lu({matchPatterns:Eoe,defaultMatchWidth:"wide",parsePatterns:Coe,defaultParseWidth:"any"}),dayPeriod:Lu({matchPatterns:Aoe,defaultMatchWidth:"any",parsePatterns:Ioe,defaultParseWidth:"any"})},Fd={code:"pt-BR",formatDistance:roe,formatLong:ooe,formatRelative:loe,localize:goe,match:Poe,options:{weekStartsOn:0,firstWeekContainsDate:1}};function koe({chamado:e,open:t,onOpenChange:i,onEdit:c,onDelete:f}){var Ee;const{toast:_}=$f(),x=i2(),[o,I]=V.useState(""),[P,N]=V.useState(e.avaliacao||null),[U,$]=V.useState(null);V.useEffect(()=>{(async()=>{const{data:{user:Ne}}=await Qe.auth.getUser();Ne&&$(Ne.id)})()},[]);const{data:B,isLoading:Y}=vo({queryKey:["chamados_comentarios",e.id],queryFn:async()=>{const{data:xe,error:Ne}=await Qe.from("chamados_comentarios").select(`
          *,
          usuario:profiles(full_name)
        `).eq("chamado_id",e.id).order("created_at",{ascending:!0});if(Ne)throw Ne;return xe},enabled:t}),H=Kw({mutationFn:async xe=>{const{data:{user:Ne}}=await Qe.auth.getUser();if(!Ne)throw new Error("Usurio no autenticado");const{error:lt}=await Qe.from("chamados_comentarios").insert([{chamado_id:e.id,usuario_id:Ne.id,comentario:xe}]);if(lt)throw lt},onSuccess:()=>{x.invalidateQueries({queryKey:["chamados_comentarios",e.id]}),I(""),_({title:"Comentrio adicionado com sucesso!"})},onError:xe=>{_({title:"Erro ao adicionar comentrio",description:xe.message,variant:"destructive"})}}),K=Kw({mutationFn:async xe=>{const{error:Ne}=await Qe.from("chamados").update({avaliacao:xe}).eq("id",e.id);if(Ne)throw Ne},onSuccess:()=>{_({title:"Avaliao registrada com sucesso!"})},onError:xe=>{_({title:"Erro ao avaliar chamado",description:xe.message,variant:"destructive"})}}),re=Kw({mutationFn:async()=>{if(!U)throw new Error("Usurio no autenticado");const{error:xe}=await Qe.from("chamados").update({atribuido_para_id:U}).eq("id",e.id);if(xe)throw xe},onSuccess:()=>{x.invalidateQueries({queryKey:["chamados"]}),_({title:"Voc foi atribudo ao chamado com sucesso!"}),i(!1)},onError:xe=>{_({title:"Erro ao atribuir chamado",description:xe.message,variant:"destructive"})}}),G=Kw({mutationFn:async()=>{const{error:xe}=await Qe.from("chamados").update({status:"concluido",data_conclusao:new Date().toISOString()}).eq("id",e.id);if(xe)throw xe},onSuccess:()=>{x.invalidateQueries({queryKey:["chamados"]}),_({title:"Chamado concludo com sucesso!"}),i(!1)},onError:xe=>{_({title:"Erro ao concluir chamado",description:xe.message,variant:"destructive"})}}),X=()=>{o.trim()&&H.mutate(o)},ue=xe=>{N(xe),K.mutate(xe)};return h.jsx(fo,{open:t,onOpenChange:i,children:h.jsxs(Js,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[h.jsxs(Qs,{children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs(eo,{className:"flex items-center gap-2",children:[h.jsx("span",{children:e.numero}),h.jsx(ai,{children:(Ee=e.status)==null?void 0:Ee.replace("_"," ")})]}),h.jsxs("div",{className:"flex gap-2",children:[!e.atribuido_para_id&&U&&h.jsxs(tr,{variant:"default",size:"sm",onClick:()=>re.mutate(),disabled:re.isPending,children:[h.jsx(nT,{className:"mr-2 h-4 w-4"}),"Atribuir para mim"]}),e.comentario_avaliacao&&h.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Comentrio: ",e.comentario_avaliacao]}),e.atribuido_para_id===U&&e.status!=="concluido"&&h.jsx(tr,{variant:"default",size:"sm",onClick:()=>{confirm("Tem certeza que deseja concluir este chamado?")&&G.mutate()},disabled:G.isPending,children:"Concluir"}),h.jsx(tr,{variant:"outline",size:"sm",onClick:()=>{c(e),i(!1)},children:"Editar"}),h.jsx(tr,{variant:"destructive",size:"sm",onClick:()=>{confirm("Tem certeza que deseja excluir este chamado?")&&(f(e.id),i(!1))},children:"Excluir"})]})]}),h.jsx(Yu,{children:"Consulte dados completos, anexos e comentrios antes de atualizar o chamado."})]}),h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{children:[h.jsx("h2",{className:"text-2xl font-bold mb-2",children:e.titulo}),e.descricao&&h.jsx("p",{className:"text-muted-foreground",children:e.descricao})]}),h.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[h.jsxs(kr,{className:"p-4 space-y-2",children:[h.jsx("h3",{className:"font-semibold",children:"Informaes"}),h.jsxs("div",{className:"text-sm space-y-1",children:[h.jsxs("div",{children:[h.jsx("span",{className:"font-medium",children:"Tipo:"})," ",e.tipo]}),e.categoria&&h.jsxs("div",{children:[h.jsx("span",{className:"font-medium",children:"Categoria:"})," ",e.categoria]}),e.subcategoria&&h.jsxs("div",{children:[h.jsx("span",{className:"font-medium",children:"Subcategoria:"})," ",e.subcategoria]}),h.jsxs("div",{children:[h.jsx("span",{className:"font-medium",children:"Prioridade:"})," ",e.prioridade]}),h.jsxs("div",{children:[h.jsx("span",{className:"font-medium",children:"Canal:"})," ",e.canal]}),e.sla_horas&&h.jsxs("div",{children:[h.jsx("span",{className:"font-medium",children:"SLA:"})," ",e.sla_horas," horas"]}),typeof e.avaliacao=="number"&&h.jsxs("div",{children:[h.jsx("span",{className:"font-medium",children:"Nota NPS:"})," ",e.avaliacao,"/5"]}),e.comentario_avaliacao&&h.jsxs("div",{children:[h.jsx("span",{className:"font-medium",children:"Comentrio NPS:"})," ",e.comentario_avaliacao]})]})]}),h.jsxs(kr,{className:"p-4 space-y-2",children:[h.jsx("h3",{className:"font-semibold",children:"Localizao"}),h.jsxs("div",{className:"text-sm space-y-1",children:[e.contrato&&h.jsxs("div",{children:[h.jsx("span",{className:"font-medium",children:"Contrato:"})," ",e.contrato.nome]}),e.unidade&&h.jsxs("div",{children:[h.jsx("span",{className:"font-medium",children:"Unidade:"})," ",e.unidade.nome]}),e.posto_servico&&h.jsxs("div",{children:[h.jsx("span",{className:"font-medium",children:"Posto:"})," ",e.posto_servico.nome]})]})]}),h.jsxs(kr,{className:"p-4 space-y-2",children:[h.jsx("h3",{className:"font-semibold",children:"Pessoas"}),h.jsxs("div",{className:"text-sm space-y-1",children:[e.solicitante&&h.jsxs("div",{children:[h.jsx("span",{className:"font-medium",children:"Solicitante:"})," ",e.solicitante.nome_completo]}),e.atribuido&&h.jsxs("div",{children:[h.jsx("span",{className:"font-medium",children:"Atribudo:"})," ",e.atribuido.nome_completo]}),e.responsavel&&h.jsxs("div",{children:[h.jsx("span",{className:"font-medium",children:"Responsvel:"})," ",e.responsavel.nome_completo]})]})]}),h.jsxs(kr,{className:"p-4 space-y-2",children:[h.jsx("h3",{className:"font-semibold",children:"Datas"}),h.jsxs("div",{className:"text-sm space-y-1",children:[h.jsxs("div",{children:[h.jsx("span",{className:"font-medium",children:"Abertura:"})," ",Hs(new Date(e.data_abertura),"dd/MM/yyyy HH:mm",{locale:Fd})]}),e.data_conclusao&&h.jsxs("div",{children:[h.jsx("span",{className:"font-medium",children:"Concluso:"})," ",Hs(new Date(e.data_conclusao),"dd/MM/yyyy HH:mm",{locale:Fd})]})]})]})]}),e.status==="concluido"&&h.jsxs(kr,{className:"p-4",children:[h.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[h.jsx(iZ,{className:"h-5 w-5"}),"Avaliacao do Chamado"]}),h.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(xe=>h.jsx(tr,{variant:P===xe?"default":"outline",size:"sm",onClick:()=>ue(xe),children:xe},xe))}),P&&h.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Avaliao: ",P,"/5"]}),e.comentario_avaliacao&&h.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Comentrio: ",e.comentario_avaliacao]})]}),h.jsx(ib,{}),h.jsxs("div",{children:[h.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[h.jsx(G0,{className:"h-5 w-5"}),"Comentrios (",(B==null?void 0:B.length)||0,")"]}),h.jsx("div",{className:"space-y-3 mb-4",children:Y?h.jsx(xP,{className:"h-20 w-full"}):B&&B.length>0?B.map(xe=>{var Ne;return h.jsx(kr,{className:"p-3",children:h.jsxs("div",{className:"flex items-start gap-3",children:[h.jsx(p4,{className:"h-8 w-8 text-muted-foreground"}),h.jsxs("div",{className:"flex-1",children:[h.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[h.jsx("span",{className:"text-sm font-medium",children:((Ne=xe.usuario)==null?void 0:Ne.full_name)||"Usurio"}),h.jsx("span",{className:"text-xs text-muted-foreground",children:Hs(new Date(xe.created_at),"dd/MM/yyyy HH:mm",{locale:Fd})})]}),h.jsx("p",{className:"text-sm",children:xe.comentario})]})]})},xe.id)}):h.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum comentrio ainda"})}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx(Tl,{placeholder:"Adicione um comentrio...",value:o,onChange:xe=>I(xe.target.value),rows:2}),h.jsx(tr,{onClick:X,disabled:!o.trim()||H.isPending,children:h.jsx(rZ,{className:"h-4 w-4"})})]})]})]})]})})}function joe(){const[e,t]=V.useState(""),[i,c]=V.useState("todos"),[f,_]=V.useState("todos"),[x,o]=V.useState("todos"),[I,P]=V.useState("todos"),[N,U]=V.useState(!1),[$,B]=V.useState(null),[Y,H]=V.useState(null),[K,re]=V.useState(null);V.useEffect(()=>{(async()=>{const{data:{user:Me}}=await Qe.auth.getUser();Me&&re(Me.id)})()},[]);const{data:G,isLoading:X,refetch:ue}=vo({queryKey:["chamados",i,f,x,I,K],queryFn:async()=>{let yt=Qe.from("chamados").select(`
          *,
          unidade:unidades(nome, codigo)
        `).order("data_abertura",{ascending:!1});i!=="todos"&&(yt=yt.eq("status",i)),f!=="todos"&&(yt=yt.eq("categoria",f)),x!=="todos"&&(yt=yt.eq("prioridade",x)),I==="meus"&&K&&(yt=yt.eq("atribuido_para_id",K));const{data:Me,error:be}=await yt;if(be)throw be;return Me}}),Ee=G==null?void 0:G.filter(yt=>{var Me,be,je;return((Me=yt.titulo)==null?void 0:Me.toLowerCase().includes(e.toLowerCase()))||((be=yt.numero)==null?void 0:be.toLowerCase().includes(e.toLowerCase()))||((je=yt.descricao)==null?void 0:je.toLowerCase().includes(e.toLowerCase()))}),xe={total:(G==null?void 0:G.length)||0,abertos:(G==null?void 0:G.filter(yt=>yt.status==="aberto").length)||0,em_andamento:(G==null?void 0:G.filter(yt=>yt.status==="em_andamento").length)||0,concluidos:(G==null?void 0:G.filter(yt=>yt.status==="concluido").length)||0},Ne=yt=>{B(yt),U(!0)},lt=async yt=>{const{error:Me}=await Qe.from("chamados").delete().eq("id",yt);Me||ue()},Pt=yt=>({aberto:"bg-yellow-500/10 text-yellow-600 border-yellow-500/20",em_andamento:"bg-blue-500/10 text-blue-600 border-blue-500/20",pendente:"bg-orange-500/10 text-orange-600 border-orange-500/20",concluido:"bg-green-500/10 text-green-600 border-green-500/20"})[yt]||"",tt=yt=>({baixa:"bg-gray-500/10 text-gray-600 border-gray-500/20",media:"bg-blue-500/10 text-blue-600 border-blue-500/20",alta:"bg-orange-500/10 text-orange-600 border-orange-500/20",critica:"bg-red-500/10 text-red-600 border-red-500/20"})[yt]||"";return h.jsx($o,{children:h.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[h.jsxs("div",{className:"flex items-center justify-between rounded-lg border bg-card p-4",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-3xl font-bold",children:"Chamados"}),h.jsx("p",{className:"text-muted-foreground",children:"Gesto completa de chamados e solicitaes"})]}),h.jsxs(tr,{onClick:()=>{B(null),U(!0)},children:[h.jsx(oa,{className:"mr-2 h-4 w-4"}),"Novo Chamado"]})]}),h.jsxs("div",{className:"grid gap-4 md:grid-cols-4 rounded-lg border bg-card p-4",children:[h.jsxs(kr,{className:"p-4",children:[h.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Total"}),h.jsx("div",{className:"text-2xl font-bold",children:xe.total})]}),h.jsxs(kr,{className:"p-4",children:[h.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Abertos"}),h.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:xe.abertos})]}),h.jsxs(kr,{className:"p-4",children:[h.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Em Andamento"}),h.jsx("div",{className:"text-2xl font-bold text-blue-600",children:xe.em_andamento})]}),h.jsxs(kr,{className:"p-4",children:[h.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Concludos"}),h.jsx("div",{className:"text-2xl font-bold text-green-600",children:xe.concluidos})]})]}),h.jsxs("div",{className:"flex flex-col gap-4 md:flex-row rounded-lg border bg-card p-4",children:[h.jsxs("div",{className:"relative flex-1",children:[h.jsx(Xc,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),h.jsx(_r,{placeholder:"Buscar por ttulo, nmero ou descrio...",value:e,onChange:yt=>t(yt.target.value),className:"pl-9"})]}),h.jsxs(un,{value:i,onValueChange:c,children:[h.jsx(on,{className:"w-full md:w-[180px]",children:h.jsx(dn,{placeholder:"Status"})}),h.jsxs(an,{children:[h.jsx(kt,{value:"todos",children:"Todos Status"}),h.jsx(kt,{value:"aberto",children:"Aberto"}),h.jsx(kt,{value:"em_andamento",children:"Em Andamento"}),h.jsx(kt,{value:"pendente",children:"Pendente"}),h.jsx(kt,{value:"concluido",children:"Concludo"})]})]}),h.jsxs(un,{value:f,onValueChange:_,children:[h.jsx(on,{className:"w-full md:w-[180px]",children:h.jsx(dn,{placeholder:"Categoria"})}),h.jsxs(an,{children:[h.jsx(kt,{value:"todos",children:"Todas Categorias"}),h.jsx(kt,{value:"manutencao",children:"Manuteno"}),h.jsx(kt,{value:"rh",children:"RH"}),h.jsx(kt,{value:"suprimentos",children:"Suprimentos"}),h.jsx(kt,{value:"atendimento",children:"Atendimento"})]})]}),h.jsxs(un,{value:x,onValueChange:o,children:[h.jsx(on,{className:"w-full md:w-[180px]",children:h.jsx(dn,{placeholder:"Prioridade"})}),h.jsxs(an,{children:[h.jsx(kt,{value:"todos",children:"Todas Prioridades"}),h.jsx(kt,{value:"baixa",children:"Baixa"}),h.jsx(kt,{value:"media",children:"Mdia"}),h.jsx(kt,{value:"alta",children:"Alta"}),h.jsx(kt,{value:"critica",children:"Crtica"})]})]}),h.jsxs(un,{value:I,onValueChange:P,children:[h.jsx(on,{className:"w-full md:w-[180px]",children:h.jsx(dn,{placeholder:"Atribuio"})}),h.jsxs(an,{children:[h.jsx(kt,{value:"todos",children:"Todos"}),h.jsx(kt,{value:"meus",children:"Meus Chamados"})]})]})]}),h.jsx("div",{className:"rounded-md border p-4",children:h.jsxs(Yd,{children:[h.jsx(Jd,{children:h.jsxs(Zs,{children:[h.jsx(xn,{children:"Nmero"}),h.jsx(xn,{children:"Ttulo"}),h.jsx(xn,{children:"Unidade"}),h.jsx(xn,{children:"Status"}),h.jsx(xn,{children:"Prioridade"}),h.jsx(xn,{children:"Data Abertura"}),h.jsx(xn,{className:"text-right",children:"Aes"})]})}),h.jsx(Qd,{children:Ee==null?void 0:Ee.map(yt=>{var Me,be;return h.jsxs(Zs,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>H(yt),children:[h.jsx(cn,{className:"font-mono text-sm",children:yt.numero}),h.jsx(cn,{className:"font-medium",children:yt.titulo}),h.jsx(cn,{children:((Me=yt.unidade)==null?void 0:Me.nome)||"-"}),h.jsx(cn,{children:h.jsx(ai,{variant:"outline",className:Pt(yt.status),children:(be=yt.status)==null?void 0:be.replace("_"," ")})}),h.jsx(cn,{children:h.jsx(ai,{variant:"outline",className:tt(yt.prioridade),children:yt.prioridade})}),h.jsx(cn,{children:Hs(new Date(yt.data_abertura),"dd/MM/yyyy HH:mm",{locale:Fd})}),h.jsx(cn,{className:"text-right",children:h.jsx(tr,{variant:"ghost",size:"icon",onClick:je=>{je.stopPropagation(),H(yt)},children:h.jsx(Dk,{className:"h-4 w-4"})})})]},yt.id)})})]})}),N&&h.jsx(Wie,{open:N,onOpenChange:yt=>{U(yt),yt||B(null)},chamado:$,onSuccess:()=>{U(!1),B(null),ue()}}),Y&&h.jsx(koe,{chamado:Y,open:!!Y,onOpenChange:yt=>!yt&&H(null),onEdit:Ne,onDelete:lt})]})})}var IA="rovingFocusGroup.onEntryFocus",Roe={bubbles:!1,cancelable:!0},jb="RovingFocusGroup",[RP,z6,Moe]=Pk(jb),[Doe,F6]=Xd(jb,[Moe]),[Noe,Ooe]=Doe(jb),B6=V.forwardRef((e,t)=>h.jsx(RP.Provider,{scope:e.__scopeRovingFocusGroup,children:h.jsx(RP.Slot,{scope:e.__scopeRovingFocusGroup,children:h.jsx(Loe,{...e,ref:t})})}));B6.displayName=jb;var Loe=V.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:i,orientation:c,loop:f=!1,dir:_,currentTabStopId:x,defaultCurrentTabStopId:o,onCurrentTabStopIdChange:I,onEntryFocus:P,preventScrollOnEntryFocus:N=!1,...U}=e,$=V.useRef(null),B=vs(t,$),Y=yj(_),[H,K]=Em({prop:x,defaultProp:o??null,onChange:I,caller:jb}),[re,G]=V.useState(!1),X=fc(P),ue=z6(i),Ee=V.useRef(!1),[xe,Ne]=V.useState(0);return V.useEffect(()=>{const lt=$.current;if(lt)return lt.addEventListener(IA,X),()=>lt.removeEventListener(IA,X)},[X]),h.jsx(Noe,{scope:i,orientation:c,dir:Y,loop:f,currentTabStopId:H,onItemFocus:V.useCallback(lt=>K(lt),[K]),onItemShiftTab:V.useCallback(()=>G(!0),[]),onFocusableItemAdd:V.useCallback(()=>Ne(lt=>lt+1),[]),onFocusableItemRemove:V.useCallback(()=>Ne(lt=>lt-1),[]),children:h.jsx(xi.div,{tabIndex:re||xe===0?-1:0,"data-orientation":c,...U,ref:B,style:{outline:"none",...e.style},onMouseDown:Un(e.onMouseDown,()=>{Ee.current=!0}),onFocus:Un(e.onFocus,lt=>{const Pt=!Ee.current;if(lt.target===lt.currentTarget&&Pt&&!re){const tt=new CustomEvent(IA,Roe);if(lt.currentTarget.dispatchEvent(tt),!tt.defaultPrevented){const yt=ue().filter(qe=>qe.focusable),Me=yt.find(qe=>qe.active),be=yt.find(qe=>qe.id===H),Ye=[Me,be,...yt].filter(Boolean).map(qe=>qe.ref.current);$6(Ye,N)}}Ee.current=!1}),onBlur:Un(e.onBlur,()=>G(!1))})})}),V6="RovingFocusGroupItem",U6=V.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:i,focusable:c=!0,active:f=!1,tabStopId:_,children:x,...o}=e,I=zd(),P=_||I,N=Ooe(V6,i),U=N.currentTabStopId===P,$=z6(i),{onFocusableItemAdd:B,onFocusableItemRemove:Y,currentTabStopId:H}=N;return V.useEffect(()=>{if(c)return B(),()=>Y()},[c,B,Y]),h.jsx(RP.ItemSlot,{scope:i,id:P,focusable:c,active:f,children:h.jsx(xi.span,{tabIndex:U?0:-1,"data-orientation":N.orientation,...o,ref:t,onMouseDown:Un(e.onMouseDown,K=>{c?N.onItemFocus(P):K.preventDefault()}),onFocus:Un(e.onFocus,()=>N.onItemFocus(P)),onKeyDown:Un(e.onKeyDown,K=>{if(K.key==="Tab"&&K.shiftKey){N.onItemShiftTab();return}if(K.target!==K.currentTarget)return;const re=Boe(K,N.orientation,N.dir);if(re!==void 0){if(K.metaKey||K.ctrlKey||K.altKey||K.shiftKey)return;K.preventDefault();let X=$().filter(ue=>ue.focusable).map(ue=>ue.ref.current);if(re==="last")X.reverse();else if(re==="prev"||re==="next"){re==="prev"&&X.reverse();const ue=X.indexOf(K.currentTarget);X=N.loop?Voe(X,ue+1):X.slice(ue+1)}setTimeout(()=>$6(X))}}),children:typeof x=="function"?x({isCurrentTabStop:U,hasTabStop:H!=null}):x})})});U6.displayName=V6;var zoe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Foe(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function Boe(e,t,i){const c=Foe(e.key,i);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(c))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(c)))return zoe[c]}function $6(e,t=!1){const i=document.activeElement;for(const c of e)if(c===i||(c.focus({preventScroll:t}),document.activeElement!==i))return}function Voe(e,t){return e.map((i,c)=>e[(t+c)%e.length])}var Uoe=B6,$oe=U6,b2="Tabs",[qoe,Lce]=Xd(b2,[F6]),q6=F6(),[Goe,kj]=qoe(b2),G6=V.forwardRef((e,t)=>{const{__scopeTabs:i,value:c,onValueChange:f,defaultValue:_,orientation:x="horizontal",dir:o,activationMode:I="automatic",...P}=e,N=yj(o),[U,$]=Em({prop:c,onChange:f,defaultProp:_??"",caller:b2});return h.jsx(Goe,{scope:i,baseId:zd(),value:U,onValueChange:$,orientation:x,dir:N,activationMode:I,children:h.jsx(xi.div,{dir:N,"data-orientation":x,...P,ref:t})})});G6.displayName=b2;var W6="TabsList",H6=V.forwardRef((e,t)=>{const{__scopeTabs:i,loop:c=!0,...f}=e,_=kj(W6,i),x=q6(i);return h.jsx(Uoe,{asChild:!0,...x,orientation:_.orientation,dir:_.dir,loop:c,children:h.jsx(xi.div,{role:"tablist","aria-orientation":_.orientation,...f,ref:t})})});H6.displayName=W6;var Z6="TabsTrigger",X6=V.forwardRef((e,t)=>{const{__scopeTabs:i,value:c,disabled:f=!1,..._}=e,x=kj(Z6,i),o=q6(i),I=J6(x.baseId,c),P=Q6(x.baseId,c),N=c===x.value;return h.jsx($oe,{asChild:!0,...o,focusable:!f,active:N,children:h.jsx(xi.button,{type:"button",role:"tab","aria-selected":N,"aria-controls":P,"data-state":N?"active":"inactive","data-disabled":f?"":void 0,disabled:f,id:I,..._,ref:t,onMouseDown:Un(e.onMouseDown,U=>{!f&&U.button===0&&U.ctrlKey===!1?x.onValueChange(c):U.preventDefault()}),onKeyDown:Un(e.onKeyDown,U=>{[" ","Enter"].includes(U.key)&&x.onValueChange(c)}),onFocus:Un(e.onFocus,()=>{const U=x.activationMode!=="manual";!N&&!f&&U&&x.onValueChange(c)})})})});X6.displayName=Z6;var K6="TabsContent",Y6=V.forwardRef((e,t)=>{const{__scopeTabs:i,value:c,forceMount:f,children:_,...x}=e,o=kj(K6,i),I=J6(o.baseId,c),P=Q6(o.baseId,c),N=c===o.value,U=V.useRef(N);return V.useEffect(()=>{const $=requestAnimationFrame(()=>U.current=!1);return()=>cancelAnimationFrame($)},[]),h.jsx(Bm,{present:f||N,children:({present:$})=>h.jsx(xi.div,{"data-state":N?"active":"inactive","data-orientation":o.orientation,role:"tabpanel","aria-labelledby":I,hidden:!$,id:P,tabIndex:0,...x,ref:t,style:{...e.style,animationDuration:U.current?"0s":void 0},children:$&&_})})});Y6.displayName=K6;function J6(e,t){return`${e}-trigger-${t}`}function Q6(e,t){return`${e}-content-${t}`}var Woe=G6,e$=H6,t$=X6,r$=Y6;const n$=Woe,jj=V.forwardRef(({className:e,...t},i)=>h.jsx(e$,{ref:i,className:yr("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));jj.displayName=e$.displayName;const vf=V.forwardRef(({className:e,...t},i)=>h.jsx(t$,{ref:i,className:yr("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",e),...t}));vf.displayName=t$.displayName;const xf=V.forwardRef(({className:e,...t},i)=>h.jsx(r$,{ref:i,className:yr("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));xf.displayName=r$.displayName;const Hoe=({clienteId:e,onClose:t,onSuccess:i})=>{const[c,f]=V.useState(!1),_={razao_social:"",cnpj:"",contato_nome:"",contato_email:"",contato_telefone:"",status:"ativo"},[x,o]=V.useState(_);V.useEffect(()=>{if(!e){o(_);return}(async()=>{f(!0);const{data:N,error:U}=await Qe.from("clientes").select("razao_social, cnpj, contato_nome, contato_email, contato_telefone, status").eq("id",e).single();U?Hn({title:"Erro",description:"No foi possvel carregar os dados do cliente",variant:"destructive"}):N&&o({razao_social:N.razao_social??"",cnpj:N.cnpj??"",contato_nome:N.contato_nome??"",contato_email:N.contato_email??"",contato_telefone:N.contato_telefone??"",status:N.status??"ativo"}),f(!1)})()},[e]);const I=async P=>{P.preventDefault(),f(!0);try{if(e){const{error:N}=await Qe.from("clientes").update(x).eq("id",e);if(N)throw N;Hn({title:"Cliente atualizado",description:"Cliente atualizado com sucesso"})}else{const{error:N}=await Qe.from("clientes").insert([x]);if(N)throw N;Hn({title:"Cliente criado",description:"Cliente criado com sucesso"})}i()}catch(N){Hn({title:"Erro",description:N.message,variant:"destructive"})}finally{f(!1)}};return h.jsx(fo,{open:!0,onOpenChange:t,children:h.jsxs(Js,{className:"max-w-2xl",children:[h.jsxs(Qs,{children:[h.jsx(eo,{children:e?"Editar Cliente":"Novo Cliente"}),h.jsx(Yu,{children:"Preencha os dados do cliente"})]}),h.jsxs("form",{onSubmit:I,className:"space-y-4",children:[h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"razao_social",children:"Razao Social *"}),h.jsx(_r,{id:"razao_social",value:x.razao_social,onChange:P=>o({...x,razao_social:P.target.value}),required:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"cnpj",children:"CNPJ *"}),h.jsx(_r,{id:"cnpj",value:x.cnpj,onChange:P=>o({...x,cnpj:P.target.value}),placeholder:"00.000.000/0000-00",required:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"contato_nome",children:"Nome do Contato"}),h.jsx(_r,{id:"contato_nome",value:x.contato_nome,onChange:P=>o({...x,contato_nome:P.target.value})})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"contato_email",children:"Email do Contato"}),h.jsx(_r,{id:"contato_email",type:"email",value:x.contato_email,onChange:P=>o({...x,contato_email:P.target.value})})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"contato_telefone",children:"Telefone do Contato"}),h.jsx(_r,{id:"contato_telefone",value:x.contato_telefone,onChange:P=>o({...x,contato_telefone:P.target.value}),placeholder:"(00) 00000-0000"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"status",children:"Status"}),h.jsxs(un,{value:x.status,onValueChange:P=>o({...x,status:P}),children:[h.jsx(on,{children:h.jsx(dn,{})}),h.jsxs(an,{children:[h.jsx(kt,{value:"ativo",children:"Ativo"}),h.jsx(kt,{value:"inativo",children:"Inativo"})]})]})]})]}),h.jsxs("div",{className:"flex justify-end gap-2",children:[h.jsx(tr,{type:"button",variant:"outline",onClick:t,children:"Cancelar"}),h.jsxs(tr,{type:"submit",disabled:c,children:[c&&h.jsx(Xu,{className:"mr-2 h-4 w-4 animate-spin"}),e?"Atualizar":"Criar"]})]})]})]})})},Zoe=({contratoId:e,clienteId:t,onClose:i,onSuccess:c})=>{const[f,_]=V.useState(!1),[x,o]=V.useState([]),I={cliente_id:t||"",nome:"",codigo:"",data_inicio:"",data_fim:"",sla_alvo_pct:"95",nps_meta:"",status:"ativo"},[P,N]=V.useState(I);V.useEffect(()=>{U()},[]),V.useEffect(()=>{if(!e){N(Y=>({...I,cliente_id:t||""}));return}(async()=>{var K,re;_(!0);const{data:Y,error:H}=await Qe.from("contratos").select("cliente_id, nome, codigo, data_inicio, data_fim, sla_alvo_pct, nps_meta, status").eq("id",e).single();H?Hn({title:"Erro",description:"No foi possvel carregar os dados do contrato",variant:"destructive"}):Y&&N({cliente_id:Y.cliente_id??"",nome:Y.nome??"",codigo:Y.codigo??"",data_inicio:Y.data_inicio??"",data_fim:Y.data_fim??"",sla_alvo_pct:((K=Y.sla_alvo_pct)==null?void 0:K.toString())??"95",nps_meta:((re=Y.nps_meta)==null?void 0:re.toString())??"",status:Y.status??"ativo"}),_(!1)})()},[e,t]);const U=async()=>{const{data:B}=await Qe.from("clientes").select("id, razao_social").eq("status","ativo").order("razao_social");o(B||[])},$=async B=>{B.preventDefault(),_(!0);try{const Y={...P,sla_alvo_pct:parseFloat(P.sla_alvo_pct),nps_meta:P.nps_meta?parseFloat(P.nps_meta):null,data_fim:P.data_fim||null};if(e){const{error:H}=await Qe.from("contratos").update(Y).eq("id",e);if(H)throw H;Hn({title:"Contrato atualizado",description:"Contrato atualizado com sucesso"})}else{const{error:H}=await Qe.from("contratos").insert([Y]);if(H)throw H;Hn({title:"Contrato criado",description:"Contrato criado com sucesso"})}c()}catch(Y){Hn({title:"Erro",description:Y.message,variant:"destructive"})}finally{_(!1)}};return h.jsx(fo,{open:!0,onOpenChange:i,children:h.jsxs(Js,{className:"max-w-2xl",children:[h.jsxs(Qs,{children:[h.jsx(eo,{children:e?"Editar Contrato":"Novo Contrato"}),h.jsx(Yu,{children:"Preencha os dados do contrato"})]}),h.jsxs("form",{onSubmit:$,className:"space-y-4",children:[h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2 col-span-2",children:[h.jsx(Kt,{htmlFor:"cliente_id",children:"Cliente *"}),h.jsxs(un,{value:P.cliente_id,onValueChange:B=>N({...P,cliente_id:B}),disabled:!!t,children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Selecione um cliente"})}),h.jsx(an,{children:x.map(B=>h.jsx(kt,{value:B.id,children:B.razao_social},B.id))})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"nome",children:"Nome do Contrato *"}),h.jsx(_r,{id:"nome",value:P.nome,onChange:B=>N({...P,nome:B.target.value}),required:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"codigo",children:"Cdigo *"}),h.jsx(_r,{id:"codigo",value:P.codigo,onChange:B=>N({...P,codigo:B.target.value}),required:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"data_inicio",children:"Data Incio *"}),h.jsx(_r,{id:"data_inicio",type:"date",value:P.data_inicio,onChange:B=>N({...P,data_inicio:B.target.value}),required:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"data_fim",children:"Data Fim"}),h.jsx(_r,{id:"data_fim",type:"date",value:P.data_fim,onChange:B=>N({...P,data_fim:B.target.value})})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"sla_alvo_pct",children:"SLA Alvo (%)"}),h.jsx(_r,{id:"sla_alvo_pct",type:"number",step:"0.01",value:P.sla_alvo_pct,onChange:B=>N({...P,sla_alvo_pct:B.target.value})})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"nps_meta",children:"NPS Meta"}),h.jsx(_r,{id:"nps_meta",type:"number",step:"0.01",value:P.nps_meta,onChange:B=>N({...P,nps_meta:B.target.value})})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"status",children:"Status"}),h.jsxs(un,{value:P.status,onValueChange:B=>N({...P,status:B}),children:[h.jsx(on,{children:h.jsx(dn,{})}),h.jsxs(an,{children:[h.jsx(kt,{value:"ativo",children:"Ativo"}),h.jsx(kt,{value:"inativo",children:"Inativo"}),h.jsx(kt,{value:"suspenso",children:"Suspenso"})]})]})]})]}),h.jsxs("div",{className:"flex justify-end gap-2",children:[h.jsx(tr,{type:"button",variant:"outline",onClick:i,children:"Cancelar"}),h.jsxs(tr,{type:"submit",disabled:f,children:[f&&h.jsx(Xu,{className:"mr-2 h-4 w-4 animate-spin"}),e?"Atualizar":"Criar"]})]})]})]})})},Xoe=({unidadeId:e,contratoId:t,onClose:i,onSuccess:c})=>{const[f,_]=V.useState(!1),[x,o]=V.useState([]),[I,P]=V.useState({contrato_id:t||"",nome:"",codigo:"",endereco:"",cidade:"",uf:"",cep:"",latitude:"",longitude:"",status:"ativo"});V.useEffect(()=>{N(),e&&U()},[e]);const N=async()=>{const{data:B}=await Qe.from("contratos").select("id, nome").eq("status","ativo").order("nome");o(B||[])},U=async()=>{if(!e)return;const{data:B,error:Y}=await Qe.from("unidades").select("*").eq("id",e).single();if(Y){Hn({title:"Erro ao carregar unidade",description:Y.message,variant:"destructive"});return}B&&P({contrato_id:B.contrato_id||"",nome:B.nome,codigo:B.codigo,endereco:B.endereco||"",cidade:B.cidade||"",uf:B.uf||"",cep:B.cep||"",latitude:B.latitude?String(B.latitude):"",longitude:B.longitude?String(B.longitude):"",status:B.status||"ativo"})},$=async B=>{B.preventDefault(),_(!0);try{const Y={...I,latitude:I.latitude?parseFloat(I.latitude):null,longitude:I.longitude?parseFloat(I.longitude):null};if(e){const{error:H}=await Qe.from("unidades").update(Y).eq("id",e);if(H)throw H;Hn({title:"Unidade atualizada",description:"Unidade atualizada com sucesso"})}else{const{error:H}=await Qe.from("unidades").insert([Y]);if(H)throw H;Hn({title:"Unidade criada",description:"Unidade criada com sucesso"})}c()}catch(Y){Hn({title:"Erro",description:Y.message,variant:"destructive"})}finally{_(!1)}};return h.jsx(fo,{open:!0,onOpenChange:i,children:h.jsxs(Js,{className:"max-w-2xl",children:[h.jsxs(Qs,{children:[h.jsx(eo,{children:e?"Editar Unidade":"Nova Unidade"}),h.jsx(Yu,{children:"Preencha os dados da unidade"})]}),h.jsxs("form",{onSubmit:$,className:"space-y-4",children:[h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2 col-span-2",children:[h.jsx(Kt,{htmlFor:"contrato_id",children:"Contrato *"}),h.jsxs(un,{value:I.contrato_id,onValueChange:B=>P({...I,contrato_id:B}),disabled:!!t,children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Selecione um contrato"})}),h.jsx(an,{children:x.map(B=>h.jsx(kt,{value:B.id,children:B.nome},B.id))})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"nome",children:"Nome da Unidade *"}),h.jsx(_r,{id:"nome",value:I.nome,onChange:B=>P({...I,nome:B.target.value}),required:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"codigo",children:"Cdigo *"}),h.jsx(_r,{id:"codigo",value:I.codigo,onChange:B=>P({...I,codigo:B.target.value}),required:!0})]}),h.jsxs("div",{className:"space-y-2 col-span-2",children:[h.jsx(Kt,{htmlFor:"endereco",children:"Endereo"}),h.jsx(_r,{id:"endereco",value:I.endereco,onChange:B=>P({...I,endereco:B.target.value})})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"cidade",children:"Cidade"}),h.jsx(_r,{id:"cidade",value:I.cidade,onChange:B=>P({...I,cidade:B.target.value})})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"uf",children:"UF"}),h.jsx(_r,{id:"uf",value:I.uf,onChange:B=>P({...I,uf:B.target.value.toUpperCase()}),maxLength:2,placeholder:"SP"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"cep",children:"CEP"}),h.jsx(_r,{id:"cep",value:I.cep,onChange:B=>P({...I,cep:B.target.value}),placeholder:"00000-000"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"latitude",children:"Latitude"}),h.jsx(_r,{id:"latitude",type:"number",step:"any",value:I.latitude,onChange:B=>P({...I,latitude:B.target.value}),placeholder:"-15.7801"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"longitude",children:"Longitude"}),h.jsx(_r,{id:"longitude",type:"number",step:"any",value:I.longitude,onChange:B=>P({...I,longitude:B.target.value}),placeholder:"-47.9292"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"status",children:"Status"}),h.jsxs(un,{value:I.status,onValueChange:B=>P({...I,status:B}),children:[h.jsx(on,{children:h.jsx(dn,{})}),h.jsxs(an,{children:[h.jsx(kt,{value:"ativo",children:"Ativo"}),h.jsx(kt,{value:"inativo",children:"Inativo"})]})]})]})]}),h.jsxs("div",{className:"flex justify-end gap-2",children:[h.jsx(tr,{type:"button",variant:"outline",onClick:i,children:"Cancelar"}),h.jsxs(tr,{type:"submit",disabled:f,children:[f&&h.jsx(Xu,{className:"mr-2 h-4 w-4 animate-spin"}),e?"Atualizar":"Criar"]})]})]})]})})},Koe=({postoId:e,unidadeId:t,onClose:i,onSuccess:c})=>{const[f,_]=V.useState(!1),[x,o]=V.useState([]),I={unidade_id:t||"",nome:"",codigo:"",funcao:"",escala:"",turno:"",jornada:"",horario_inicio:"",horario_fim:"",intervalo_refeicao:"",efetivo_planejado:"1",status:"ativo",observacoes:""},[P,N]=V.useState(I);V.useEffect(()=>{U()},[]),V.useEffect(()=>{if(!e){N(Y=>({...I,unidade_id:t||""}));return}(async()=>{var K,re;_(!0);const{data:Y,error:H}=await Qe.from("postos_servico").select("unidade_id, nome, codigo, funcao, escala, turno, jornada, horario_inicio, horario_fim, intervalo_refeicao, efetivo_planejado, status, observacoes").eq("id",e).single();H?Hn({title:"Erro",description:"No foi possvel carregar os dados do posto",variant:"destructive"}):Y&&N({unidade_id:Y.unidade_id??"",nome:Y.nome??"",codigo:Y.codigo??"",funcao:Y.funcao??"",escala:Y.escala??"",turno:Y.turno??"",jornada:Y.jornada??"",horario_inicio:Y.horario_inicio??"",horario_fim:Y.horario_fim??"",intervalo_refeicao:((K=Y.intervalo_refeicao)==null?void 0:K.toString())??"",efetivo_planejado:((re=Y.efetivo_planejado)==null?void 0:re.toString())??"1",status:Y.status??"ativo",observacoes:Y.observacoes??""}),_(!1)})()},[e,t]);const U=async()=>{const{data:B}=await Qe.from("unidades").select("id, nome").eq("status","ativo").order("nome");o(B||[])},$=async B=>{B.preventDefault(),_(!0);try{const Y={...P,efetivo_planejado:parseInt(P.efetivo_planejado),intervalo_refeicao:P.intervalo_refeicao?parseInt(P.intervalo_refeicao):null,observacoes:P.observacoes||null};if(e){const{error:H}=await Qe.from("postos_servico").update(Y).eq("id",e);if(H)throw H;Hn({title:"Posto atualizado",description:"Posto de servio atualizado com sucesso"})}else{const{error:H}=await Qe.from("postos_servico").insert([Y]);if(H)throw H;Hn({title:"Posto criado",description:"Posto de servio criado com sucesso"})}c()}catch(Y){Hn({title:"Erro",description:Y.message,variant:"destructive"})}finally{_(!1)}};return h.jsx(fo,{open:!0,onOpenChange:i,children:h.jsxs(Js,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[h.jsxs(Qs,{children:[h.jsx(eo,{children:e?"Editar Posto":"Novo Posto de Servio"}),h.jsx(Yu,{children:"Preencha os dados do posto de servio"})]}),h.jsxs("form",{onSubmit:$,className:"space-y-4",children:[h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2 col-span-2",children:[h.jsx(Kt,{htmlFor:"unidade_id",children:"Unidade *"}),h.jsxs(un,{value:P.unidade_id,onValueChange:B=>N({...P,unidade_id:B}),disabled:!!t,children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Selecione uma unidade"})}),h.jsx(an,{children:x.map(B=>h.jsx(kt,{value:B.id,children:B.nome},B.id))})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"nome",children:"Nome do Posto *"}),h.jsx(_r,{id:"nome",value:P.nome,onChange:B=>N({...P,nome:B.target.value}),required:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"codigo",children:"Cdigo *"}),h.jsx(_r,{id:"codigo",value:P.codigo,onChange:B=>N({...P,codigo:B.target.value}),required:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"funcao",children:"Funo *"}),h.jsx(_r,{id:"funcao",value:P.funcao,onChange:B=>N({...P,funcao:B.target.value}),placeholder:"Ex: Tcnico de Limpeza",required:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"escala",children:"Escala"}),h.jsx(_r,{id:"escala",value:P.escala,onChange:B=>N({...P,escala:B.target.value}),placeholder:"Ex: 12x36"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"turno",children:"Turno"}),h.jsxs(un,{value:P.turno,onValueChange:B=>N({...P,turno:B}),children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Selecione o turno"})}),h.jsxs(an,{children:[h.jsx(kt,{value:"manha",children:"Manh"}),h.jsx(kt,{value:"tarde",children:"Tarde"}),h.jsx(kt,{value:"noite",children:"Noite"}),h.jsx(kt,{value:"integral",children:"Integral"}),h.jsx(kt,{value:"24 horas",children:"24 horas"})]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"jornada",children:"Jornada"}),h.jsx(_r,{id:"jornada",value:P.jornada,onChange:B=>N({...P,jornada:B.target.value}),placeholder:"Ex: 44h semanais"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"horario_inicio",children:"Horrio Incio"}),h.jsx(_r,{id:"horario_inicio",type:"time",value:P.horario_inicio,onChange:B=>N({...P,horario_inicio:B.target.value})})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"horario_fim",children:"Horrio Fim"}),h.jsx(_r,{id:"horario_fim",type:"time",value:P.horario_fim,onChange:B=>N({...P,horario_fim:B.target.value})})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"intervalo_refeicao",children:"Intervalo Refeio (min)"}),h.jsx(_r,{id:"intervalo_refeicao",type:"number",value:P.intervalo_refeicao,onChange:B=>N({...P,intervalo_refeicao:B.target.value}),placeholder:"60"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"efetivo_planejado",children:"Efetivo Planejado *"}),h.jsx(_r,{id:"efetivo_planejado",type:"number",value:P.efetivo_planejado,onChange:B=>N({...P,efetivo_planejado:B.target.value}),required:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"status",children:"Status"}),h.jsxs(un,{value:P.status,onValueChange:B=>N({...P,status:B}),children:[h.jsx(on,{children:h.jsx(dn,{})}),h.jsxs(an,{children:[h.jsx(kt,{value:"ativo",children:"Ativo"}),h.jsx(kt,{value:"inativo",children:"Inativo"}),h.jsx(kt,{value:"vago",children:"Vago"})]})]})]}),h.jsxs("div",{className:"space-y-2 col-span-2",children:[h.jsx(Kt,{htmlFor:"observacoes",children:"Observaes"}),h.jsx(Tl,{id:"observacoes",value:P.observacoes,onChange:B=>N({...P,observacoes:B.target.value}),rows:3})]})]}),h.jsxs("div",{className:"flex justify-end gap-2",children:[h.jsx(tr,{type:"button",variant:"outline",onClick:i,children:"Cancelar"}),h.jsxs(tr,{type:"submit",disabled:f,children:[f&&h.jsx(Xu,{className:"mr-2 h-4 w-4 animate-spin"}),e?"Atualizar":"Criar"]})]})]})]})})};var i$="AlertDialog",[Yoe,zce]=Xd(i$,[XV]),eh=XV(),s$=e=>{const{__scopeAlertDialog:t,...i}=e,c=eh(t);return h.jsx(gj,{...c,...i,modal:!0})};s$.displayName=i$;var Joe="AlertDialogTrigger",o$=V.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...c}=e,f=eh(i);return h.jsx(dU,{...f,...c,ref:t})});o$.displayName=Joe;var Qoe="AlertDialogPortal",a$=e=>{const{__scopeAlertDialog:t,...i}=e,c=eh(t);return h.jsx(_j,{...c,...i})};a$.displayName=Qoe;var eae="AlertDialogOverlay",l$=V.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...c}=e,f=eh(i);return h.jsx(Tb,{...f,...c,ref:t})});l$.displayName=eae;var Q_="AlertDialogContent",[tae,rae]=Yoe(Q_),nae=LB("AlertDialogContent"),c$=V.forwardRef((e,t)=>{const{__scopeAlertDialog:i,children:c,...f}=e,_=eh(i),x=V.useRef(null),o=vs(t,x),I=V.useRef(null);return h.jsx(Ure,{contentName:Q_,titleName:u$,docsSlug:"alert-dialog",children:h.jsx(tae,{scope:i,cancelRef:I,children:h.jsxs(Eb,{role:"alertdialog",..._,...f,ref:o,onOpenAutoFocus:Un(f.onOpenAutoFocus,P=>{var N;P.preventDefault(),(N=I.current)==null||N.focus({preventScroll:!0})}),onPointerDownOutside:P=>P.preventDefault(),onInteractOutside:P=>P.preventDefault(),children:[h.jsx(nae,{children:c}),h.jsx(sae,{contentRef:x})]})})})});c$.displayName=Q_;var u$="AlertDialogTitle",d$=V.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...c}=e,f=eh(i);return h.jsx(Cb,{...f,...c,ref:t})});d$.displayName=u$;var h$="AlertDialogDescription",f$=V.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...c}=e,f=eh(i);return h.jsx(Ab,{...f,...c,ref:t})});f$.displayName=h$;var iae="AlertDialogAction",p$=V.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...c}=e,f=eh(i);return h.jsx(h2,{...f,...c,ref:t})});p$.displayName=iae;var m$="AlertDialogCancel",g$=V.forwardRef((e,t)=>{const{__scopeAlertDialog:i,...c}=e,{cancelRef:f}=rae(m$,i),_=eh(i),x=vs(t,f);return h.jsx(h2,{..._,...c,ref:x})});g$.displayName=m$;var sae=({contentRef:e})=>{const t=`\`${Q_}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Q_}\` by passing a \`${h$}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Q_}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return V.useEffect(()=>{var c;document.getElementById((c=e.current)==null?void 0:c.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},oae=s$,aae=o$,lae=a$,_$=l$,y$=c$,v$=p$,x$=g$,b$=d$,w$=f$;const Hu=oae,Rb=aae,cae=lae,S$=V.forwardRef(({className:e,...t},i)=>h.jsx(_$,{className:yr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:i}));S$.displayName=_$.displayName;const ru=V.forwardRef(({className:e,...t},i)=>h.jsxs(cae,{children:[h.jsx(S$,{}),h.jsx(y$,{ref:i,className:yr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));ru.displayName=y$.displayName;const nu=({className:e,...t})=>h.jsx("div",{className:yr("flex flex-col space-y-2 text-center sm:text-left",e),...t});nu.displayName="AlertDialogHeader";const iu=({className:e,...t})=>h.jsx("div",{className:yr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});iu.displayName="AlertDialogFooter";const su=V.forwardRef(({className:e,...t},i)=>h.jsx(b$,{ref:i,className:yr("text-lg font-semibold",e),...t}));su.displayName=b$.displayName;const ou=V.forwardRef(({className:e,...t},i)=>h.jsx(w$,{ref:i,className:yr("text-sm text-muted-foreground",e),...t}));ou.displayName=w$.displayName;const au=V.forwardRef(({className:e,...t},i)=>h.jsx(v$,{ref:i,className:yr(rb(),e),...t}));au.displayName=v$.displayName;const Zu=V.forwardRef(({className:e,...t},i)=>h.jsx(x$,{ref:i,className:yr(rb({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));Zu.displayName=x$.displayName;const uae=({cliente:e,onSelect:t,onEdit:i,onDelete:c})=>{const f=async()=>{try{const{data:_}=await Qe.from("contratos").select("id").eq("cliente_id",e.id).limit(1);if(_&&_.length>0){Hn({title:"No  possvel excluir",description:"Este cliente possui contratos relacionados. Exclua os contratos primeiro.",variant:"destructive"});return}const{error:x}=await Qe.from("clientes").delete().eq("id",e.id);if(x)throw x;Hn({title:"Cliente excludo",description:"Cliente excludo com sucesso"}),c()}catch(_){Hn({title:"Erro",description:_.message,variant:"destructive"})}};return h.jsxs(kr,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:[h.jsx(Mn,{onClick:t,children:h.jsxs("div",{className:"flex items-start justify-between",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:h.jsx(Df,{className:"h-4 w-4 text-primary"})}),h.jsxs("div",{children:[h.jsx(Zn,{className:"text-base",children:e.razao_social}),h.jsx("p",{className:"text-sm text-muted-foreground",children:e.cnpj})]})]}),h.jsx(ai,{variant:e.status==="ativo"?"default":"secondary",children:e.status})]})}),h.jsxs(tn,{children:[h.jsxs("div",{className:"space-y-2",children:[e.contato_nome&&h.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[h.jsx(W0,{className:"h-4 w-4 text-muted-foreground"}),h.jsx("span",{children:e.contato_nome})]}),e.contato_email&&h.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[h.jsx(J7,{className:"h-4 w-4 text-muted-foreground"}),h.jsx("span",{className:"truncate",children:e.contato_email})]}),e.contato_telefone&&h.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[h.jsx(tZ,{className:"h-4 w-4 text-muted-foreground"}),h.jsx("span",{children:e.contato_telefone})]})]}),h.jsxs("div",{className:"flex gap-2 mt-4",children:[h.jsxs(tr,{variant:"outline",size:"sm",className:"flex-1",onClick:i,children:[h.jsx(mc,{className:"h-3 w-3 mr-1"}),"Editar"]}),h.jsxs(Hu,{children:[h.jsx(Rb,{asChild:!0,children:h.jsx(tr,{variant:"outline",size:"sm",onClick:_=>_.stopPropagation(),children:h.jsx(El,{className:"h-3 w-3"})})}),h.jsxs(ru,{children:[h.jsxs(nu,{children:[h.jsx(su,{children:"Confirmar excluso"}),h.jsx(ou,{children:"Tem certeza que deseja excluir este cliente? Esta ao no pode ser desfeita."})]}),h.jsxs(iu,{children:[h.jsx(Zu,{children:"Cancelar"}),h.jsx(au,{onClick:f,children:"Excluir"})]})]})]})]})]})]})},dae=({contrato:e,cliente:t,onSelect:i,onEdit:c,onDelete:f})=>{const _=async()=>{try{const{data:x}=await Qe.from("chamados").select("id").eq("contrato_id",e.id).limit(1),{data:o}=await Qe.from("unidades").select("id").eq("contrato_id",e.id).limit(1);if(x&&x.length>0){Hn({title:"No  possvel excluir",description:"Este contrato possui chamados relacionados. Exclua os chamados primeiro.",variant:"destructive"});return}if(o&&o.length>0){Hn({title:"No  possvel excluir",description:"Este contrato possui unidades relacionadas. Exclua as unidades primeiro.",variant:"destructive"});return}const{error:I}=await Qe.from("contratos").delete().eq("id",e.id);if(I)throw I;Hn({title:"Contrato excludo",description:"Contrato excludo com sucesso"}),f()}catch(x){Hn({title:"Erro",description:x.message,variant:"destructive"})}};return h.jsxs(kr,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:[h.jsx(Mn,{onClick:i,children:h.jsxs("div",{className:"flex items-start justify-between",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:h.jsx(Gd,{className:"h-4 w-4 text-primary"})}),h.jsxs("div",{children:[h.jsx(Zn,{className:"text-base",children:e.nome}),h.jsx("p",{className:"text-sm text-muted-foreground",children:e.codigo})]})]}),h.jsx(ai,{variant:e.status==="ativo"?"default":"secondary",children:e.status})]})}),h.jsxs(tn,{children:[h.jsxs("div",{className:"space-y-2",children:[t&&h.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cliente: ",t.razao_social]}),h.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[h.jsx($u,{className:"h-4 w-4 text-muted-foreground"}),h.jsxs("span",{children:[Hs(new Date(e.data_inicio),"dd/MM/yyyy"),e.data_fim&&` - ${Hs(new Date(e.data_fim),"dd/MM/yyyy")}`]})]}),h.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[h.jsx(Ok,{className:"h-4 w-4 text-muted-foreground"}),h.jsxs("span",{children:["SLA: ",e.sla_alvo_pct,"%"]}),e.nps_meta&&h.jsxs("span",{children:[" NPS: ",e.nps_meta]})]})]}),h.jsxs("div",{className:"flex gap-2 mt-4",children:[h.jsxs(tr,{variant:"outline",size:"sm",className:"flex-1",onClick:c,children:[h.jsx(mc,{className:"h-3 w-3 mr-1"}),"Editar"]}),h.jsxs(Hu,{children:[h.jsx(Rb,{asChild:!0,children:h.jsx(tr,{variant:"outline",size:"sm",onClick:x=>x.stopPropagation(),children:h.jsx(El,{className:"h-3 w-3"})})}),h.jsxs(ru,{children:[h.jsxs(nu,{children:[h.jsx(su,{children:"Confirmar excluso"}),h.jsx(ou,{children:"Tem certeza que deseja excluir este contrato? Esta ao no pode ser desfeita."})]}),h.jsxs(iu,{children:[h.jsx(Zu,{children:"Cancelar"}),h.jsx(au,{onClick:_,children:"Excluir"})]})]})]})]})]})]})},hae=({unidade:e,contrato:t,onSelect:i,onEdit:c,onDelete:f})=>{const _=async()=>{try{const{data:x}=await Qe.from("postos_servico").select("id").eq("unidade_id",e.id).limit(1),{data:o}=await Qe.from("colaboradores").select("id").eq("unidade_id",e.id).limit(1),{data:I}=await Qe.from("chamados").select("id").eq("unidade_id",e.id).limit(1),{data:P}=await Qe.from("ordens_servico").select("id").eq("unidade_id",e.id).limit(1);if(x&&x.length>0){Hn({title:"No  possvel excluir",description:"Esta unidade possui postos de servio relacionados. Exclua os postos primeiro.",variant:"destructive"});return}if(o&&o.length>0){Hn({title:"No  possvel excluir",description:"Esta unidade possui colaboradores relacionados. Remova a vinculao dos colaboradores primeiro.",variant:"destructive"});return}if(I&&I.length>0){Hn({title:"No  possvel excluir",description:"Esta unidade possui chamados relacionados. Exclua os chamados primeiro.",variant:"destructive"});return}if(P&&P.length>0){Hn({title:"No  possvel excluir",description:"Esta unidade possui ordens de servio relacionadas. Exclua as ordens primeiro.",variant:"destructive"});return}const{error:N}=await Qe.from("unidades").delete().eq("id",e.id);if(N)throw N;Hn({title:"Unidade excluda",description:"Unidade excluda com sucesso"}),f()}catch(x){Hn({title:"Erro",description:x.message,variant:"destructive"})}};return h.jsxs(kr,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:[h.jsx(Mn,{onClick:i,children:h.jsxs("div",{className:"flex items-start justify-between",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:h.jsx(Nf,{className:"h-4 w-4 text-primary"})}),h.jsxs("div",{children:[h.jsx(Zn,{className:"text-base",children:e.nome}),h.jsx("p",{className:"text-sm text-muted-foreground",children:e.codigo})]})]}),h.jsx(ai,{variant:e.status==="ativo"?"default":"secondary",children:e.status})]})}),h.jsxs(tn,{children:[h.jsxs("div",{className:"space-y-2",children:[t&&h.jsxs("p",{className:"text-sm text-muted-foreground",children:["Contrato: ",t.nome]}),e.endereco&&h.jsx("p",{className:"text-sm",children:e.endereco}),(e.cidade||e.uf)&&h.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.cidade,e.cidade&&e.uf?"/":"",e.uf]})]}),h.jsxs("div",{className:"flex gap-2 mt-4",children:[h.jsxs(tr,{variant:"outline",size:"sm",className:"flex-1",onClick:c,children:[h.jsx(mc,{className:"h-3 w-3 mr-1"}),"Editar"]}),h.jsxs(Hu,{children:[h.jsx(Rb,{asChild:!0,children:h.jsx(tr,{variant:"outline",size:"sm",onClick:x=>x.stopPropagation(),children:h.jsx(El,{className:"h-3 w-3"})})}),h.jsxs(ru,{children:[h.jsxs(nu,{children:[h.jsx(su,{children:"Confirmar excluso"}),h.jsx(ou,{children:"Tem certeza que deseja excluir esta unidade? Esta ao no pode ser desfeita."})]}),h.jsxs(iu,{children:[h.jsx(Zu,{children:"Cancelar"}),h.jsx(au,{onClick:_,children:"Excluir"})]})]})]})]})]})]})};var ei=function(){return ei=Object.assign||function(t){for(var i,c=1,f=arguments.length;c<f;c++){i=arguments[c];for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&(t[_]=i[_])}return t},ei.apply(this,arguments)};function fae(e,t){var i={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&t.indexOf(c)<0&&(i[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,c=Object.getOwnPropertySymbols(e);f<c.length;f++)t.indexOf(c[f])<0&&Object.prototype.propertyIsEnumerable.call(e,c[f])&&(i[c[f]]=e[c[f]]);return i}function T$(e,t,i){for(var c=0,f=t.length,_;c<f;c++)(_||!(c in t))&&(_||(_=Array.prototype.slice.call(t,0,c)),_[c]=t[c]);return e.concat(_||Array.prototype.slice.call(t))}function Mb(e){return e.mode==="multiple"}function Db(e){return e.mode==="range"}function w2(e){return e.mode==="single"}var pae={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function mae(e,t){return Hs(e,"LLLL y",t)}function gae(e,t){return Hs(e,"d",t)}function _ae(e,t){return Hs(e,"LLLL",t)}function yae(e){return"".concat(e)}function vae(e,t){return Hs(e,"cccccc",t)}function xae(e,t){return Hs(e,"yyyy",t)}var bae=Object.freeze({__proto__:null,formatCaption:mae,formatDay:gae,formatMonthCaption:_ae,formatWeekNumber:yae,formatWeekdayName:vae,formatYearCaption:xae}),wae=function(e,t,i){return Hs(e,"do MMMM (EEEE)",i)},Sae=function(){return"Month: "},Tae=function(){return"Go to next month"},Eae=function(){return"Go to previous month"},Cae=function(e,t){return Hs(e,"cccc",t)},Aae=function(e){return"Week n. ".concat(e)},Iae=function(){return"Year: "},Pae=Object.freeze({__proto__:null,labelDay:wae,labelMonthDropdown:Sae,labelNext:Tae,labelPrevious:Eae,labelWeekNumber:Aae,labelWeekday:Cae,labelYearDropdown:Iae});function kae(){var e="buttons",t=pae,i=R6,c={},f={},_=1,x={},o=new Date;return{captionLayout:e,classNames:t,formatters:bae,labels:Pae,locale:i,modifiersClassNames:c,modifiers:f,numberOfMonths:_,styles:x,today:o,mode:"default"}}function jae(e){var t=e.fromYear,i=e.toYear,c=e.fromMonth,f=e.toMonth,_=e.fromDate,x=e.toDate;return c?_=Sa(c):t&&(_=new Date(t,0,1)),f?x=ob(f):i&&(x=new Date(i,11,31)),{fromDate:_?ky(_):void 0,toDate:x?ky(x):void 0}}var E$=V.createContext(void 0);function Rae(e){var t,i=e.initialProps,c=kae(),f=jae(i),_=f.fromDate,x=f.toDate,o=(t=i.captionLayout)!==null&&t!==void 0?t:c.captionLayout;o!=="buttons"&&(!_||!x)&&(o="buttons");var I;(w2(i)||Mb(i)||Db(i))&&(I=i.onSelect);var P=ei(ei(ei({},c),i),{captionLayout:o,classNames:ei(ei({},c.classNames),i.classNames),components:ei({},i.components),formatters:ei(ei({},c.formatters),i.formatters),fromDate:_,labels:ei(ei({},c.labels),i.labels),mode:i.mode||c.mode,modifiers:ei(ei({},c.modifiers),i.modifiers),modifiersClassNames:ei(ei({},c.modifiersClassNames),i.modifiersClassNames),onSelect:I,styles:ei(ei({},c.styles),i.styles),toDate:x});return h.jsx(E$.Provider,{value:P,children:e.children})}function Ps(){var e=V.useContext(E$);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function C$(e){var t=Ps(),i=t.locale,c=t.classNames,f=t.styles,_=t.formatters.formatCaption;return h.jsx("div",{className:c.caption_label,style:f.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:_(e.displayMonth,{locale:i})})}function Mae(e){return h.jsx("svg",ei({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:h.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function A$(e){var t,i,c=e.onChange,f=e.value,_=e.children,x=e.caption,o=e.className,I=e.style,P=Ps(),N=(i=(t=P.components)===null||t===void 0?void 0:t.IconDropdown)!==null&&i!==void 0?i:Mae;return h.jsxs("div",{className:o,style:I,children:[h.jsx("span",{className:P.classNames.vhidden,children:e["aria-label"]}),h.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:P.classNames.dropdown,style:P.styles.dropdown,value:f,onChange:c,children:_}),h.jsxs("div",{className:P.classNames.caption_label,style:P.styles.caption_label,"aria-hidden":"true",children:[x,h.jsx(N,{className:P.classNames.dropdown_icon,style:P.styles.dropdown_icon})]})]})}function Dae(e){var t,i=Ps(),c=i.fromDate,f=i.toDate,_=i.styles,x=i.locale,o=i.formatters.formatMonthCaption,I=i.classNames,P=i.components,N=i.labels.labelMonthDropdown;if(!c)return h.jsx(h.Fragment,{});if(!f)return h.jsx(h.Fragment,{});var U=[];if(eoe(c,f))for(var $=Sa(c),B=c.getMonth();B<=f.getMonth();B++)U.push(AA($,B));else for(var $=Sa(new Date),B=0;B<=11;B++)U.push(AA($,B));var Y=function(K){var re=Number(K.target.value),G=AA(Sa(e.displayMonth),re);e.onChange(G)},H=(t=P==null?void 0:P.Dropdown)!==null&&t!==void 0?t:A$;return h.jsx(H,{name:"months","aria-label":N(),className:I.dropdown_month,style:_.dropdown_month,onChange:Y,value:e.displayMonth.getMonth(),caption:o(e.displayMonth,{locale:x}),children:U.map(function(K){return h.jsx("option",{value:K.getMonth(),children:o(K,{locale:x})},K.getMonth())})})}function Nae(e){var t,i=e.displayMonth,c=Ps(),f=c.fromDate,_=c.toDate,x=c.locale,o=c.styles,I=c.classNames,P=c.components,N=c.formatters.formatYearCaption,U=c.labels.labelYearDropdown,$=[];if(!f)return h.jsx(h.Fragment,{});if(!_)return h.jsx(h.Fragment,{});for(var B=f.getFullYear(),Y=_.getFullYear(),H=B;H<=Y;H++)$.push(Yz(P6(new Date),H));var K=function(G){var X=Yz(Sa(i),Number(G.target.value));e.onChange(X)},re=(t=P==null?void 0:P.Dropdown)!==null&&t!==void 0?t:A$;return h.jsx(re,{name:"years","aria-label":U(),className:I.dropdown_year,style:o.dropdown_year,onChange:K,value:i.getFullYear(),caption:N(i,{locale:x}),children:$.map(function(G){return h.jsx("option",{value:G.getFullYear(),children:N(G,{locale:x})},G.getFullYear())})})}function Oae(e,t){var i=V.useState(e),c=i[0],f=i[1],_=t===void 0?c:t;return[_,f]}function Lae(e){var t=e.month,i=e.defaultMonth,c=e.today,f=t||i||c||new Date,_=e.toDate,x=e.fromDate,o=e.numberOfMonths,I=o===void 0?1:o;if(_&&sb(_,f)<0){var P=-1*(I-1);f=Wl(_,P)}return x&&sb(f,x)<0&&(f=x),Sa(f)}function zae(){var e=Ps(),t=Lae(e),i=Oae(t,e.month),c=i[0],f=i[1],_=function(x){var o;if(!e.disableNavigation){var I=Sa(x);f(I),(o=e.onMonthChange)===null||o===void 0||o.call(e,I)}};return[c,_]}function Fae(e,t){for(var i=t.reverseMonths,c=t.numberOfMonths,f=Sa(e),_=Sa(Wl(f,c)),x=sb(_,f),o=[],I=0;I<x;I++){var P=Wl(f,I);o.push(P)}return i&&(o=o.reverse()),o}function Bae(e,t){if(!t.disableNavigation){var i=t.toDate,c=t.pagedNavigation,f=t.numberOfMonths,_=f===void 0?1:f,x=c?_:1,o=Sa(e);if(!i)return Wl(o,x);var I=sb(i,e);if(!(I<_))return Wl(o,x)}}function Vae(e,t){if(!t.disableNavigation){var i=t.fromDate,c=t.pagedNavigation,f=t.numberOfMonths,_=f===void 0?1:f,x=c?_:1,o=Sa(e);if(!i)return Wl(o,-x);var I=sb(o,i);if(!(I<=0))return Wl(o,-x)}}var I$=V.createContext(void 0);function Uae(e){var t=Ps(),i=zae(),c=i[0],f=i[1],_=Fae(c,t),x=Bae(c,t),o=Vae(c,t),I=function(U){return _.some(function($){return x2(U,$)})},P=function(U,$){I(U)||($&&L6(U,$)?f(Wl(U,1+t.numberOfMonths*-1)):f(U))},N={currentMonth:c,displayMonths:_,goToMonth:f,goToDate:P,previousMonth:o,nextMonth:x,isDateDisplayed:I};return h.jsx(I$.Provider,{value:N,children:e.children})}function Nb(){var e=V.useContext(I$);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function Jz(e){var t,i=Ps(),c=i.classNames,f=i.styles,_=i.components,x=Nb().goToMonth,o=function(N){x(Wl(N,e.displayIndex?-e.displayIndex:0))},I=(t=_==null?void 0:_.CaptionLabel)!==null&&t!==void 0?t:C$,P=h.jsx(I,{id:e.id,displayMonth:e.displayMonth});return h.jsxs("div",{className:c.caption_dropdowns,style:f.caption_dropdowns,children:[h.jsx("div",{className:c.vhidden,children:P}),h.jsx(Dae,{onChange:o,displayMonth:e.displayMonth}),h.jsx(Nae,{onChange:o,displayMonth:e.displayMonth})]})}function $ae(e){return h.jsx("svg",ei({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:h.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function qae(e){return h.jsx("svg",ei({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:h.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var kT=V.forwardRef(function(e,t){var i=Ps(),c=i.classNames,f=i.styles,_=[c.button_reset,c.button];e.className&&_.push(e.className);var x=_.join(" "),o=ei(ei({},f.button_reset),f.button);return e.style&&Object.assign(o,e.style),h.jsx("button",ei({},e,{ref:t,type:"button",className:x,style:o}))});function Gae(e){var t,i,c=Ps(),f=c.dir,_=c.locale,x=c.classNames,o=c.styles,I=c.labels,P=I.labelPrevious,N=I.labelNext,U=c.components;if(!e.nextMonth&&!e.previousMonth)return h.jsx(h.Fragment,{});var $=P(e.previousMonth,{locale:_}),B=[x.nav_button,x.nav_button_previous].join(" "),Y=N(e.nextMonth,{locale:_}),H=[x.nav_button,x.nav_button_next].join(" "),K=(t=U==null?void 0:U.IconRight)!==null&&t!==void 0?t:qae,re=(i=U==null?void 0:U.IconLeft)!==null&&i!==void 0?i:$ae;return h.jsxs("div",{className:x.nav,style:o.nav,children:[!e.hidePrevious&&h.jsx(kT,{name:"previous-month","aria-label":$,className:B,style:o.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:f==="rtl"?h.jsx(K,{className:x.nav_icon,style:o.nav_icon}):h.jsx(re,{className:x.nav_icon,style:o.nav_icon})}),!e.hideNext&&h.jsx(kT,{name:"next-month","aria-label":Y,className:H,style:o.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:f==="rtl"?h.jsx(re,{className:x.nav_icon,style:o.nav_icon}):h.jsx(K,{className:x.nav_icon,style:o.nav_icon})})]})}function Qz(e){var t=Ps().numberOfMonths,i=Nb(),c=i.previousMonth,f=i.nextMonth,_=i.goToMonth,x=i.displayMonths,o=x.findIndex(function(Y){return x2(e.displayMonth,Y)}),I=o===0,P=o===x.length-1,N=t>1&&(I||!P),U=t>1&&(P||!I),$=function(){c&&_(c)},B=function(){f&&_(f)};return h.jsx(Gae,{displayMonth:e.displayMonth,hideNext:N,hidePrevious:U,nextMonth:f,previousMonth:c,onPreviousClick:$,onNextClick:B})}function Wae(e){var t,i=Ps(),c=i.classNames,f=i.disableNavigation,_=i.styles,x=i.captionLayout,o=i.components,I=(t=o==null?void 0:o.CaptionLabel)!==null&&t!==void 0?t:C$,P;return f?P=h.jsx(I,{id:e.id,displayMonth:e.displayMonth}):x==="dropdown"?P=h.jsx(Jz,{displayMonth:e.displayMonth,id:e.id}):x==="dropdown-buttons"?P=h.jsxs(h.Fragment,{children:[h.jsx(Jz,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),h.jsx(Qz,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):P=h.jsxs(h.Fragment,{children:[h.jsx(I,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),h.jsx(Qz,{displayMonth:e.displayMonth,id:e.id})]}),h.jsx("div",{className:c.caption,style:_.caption,children:P})}function Hae(e){var t=Ps(),i=t.footer,c=t.styles,f=t.classNames.tfoot;return i?h.jsx("tfoot",{className:f,style:c.tfoot,children:h.jsx("tr",{children:h.jsx("td",{colSpan:8,children:i})})}):h.jsx(h.Fragment,{})}function Zae(e,t,i){for(var c=i?Nm(new Date):tu(new Date,{locale:e,weekStartsOn:t}),f=[],_=0;_<7;_++){var x=Ha(c,_);f.push(x)}return f}function Xae(){var e=Ps(),t=e.classNames,i=e.styles,c=e.showWeekNumber,f=e.locale,_=e.weekStartsOn,x=e.ISOWeek,o=e.formatters.formatWeekdayName,I=e.labels.labelWeekday,P=Zae(f,_,x);return h.jsxs("tr",{style:i.head_row,className:t.head_row,children:[c&&h.jsx("td",{style:i.head_cell,className:t.head_cell}),P.map(function(N,U){return h.jsx("th",{scope:"col",className:t.head_cell,style:i.head_cell,"aria-label":I(N,{locale:f}),children:o(N,{locale:f})},U)})]})}function Kae(){var e,t=Ps(),i=t.classNames,c=t.styles,f=t.components,_=(e=f==null?void 0:f.HeadRow)!==null&&e!==void 0?e:Xae;return h.jsx("thead",{style:c.head,className:i.head,children:h.jsx(_,{})})}function Yae(e){var t=Ps(),i=t.locale,c=t.formatters.formatDay;return h.jsx(h.Fragment,{children:c(e.date,{locale:i})})}var Rj=V.createContext(void 0);function Jae(e){if(!Mb(e.initialProps)){var t={selected:void 0,modifiers:{disabled:[]}};return h.jsx(Rj.Provider,{value:t,children:e.children})}return h.jsx(Qae,{initialProps:e.initialProps,children:e.children})}function Qae(e){var t=e.initialProps,i=e.children,c=t.selected,f=t.min,_=t.max,x=function(P,N,U){var $,B;($=t.onDayClick)===null||$===void 0||$.call(t,P,N,U);var Y=!!(N.selected&&f&&(c==null?void 0:c.length)===f);if(!Y){var H=!!(!N.selected&&_&&(c==null?void 0:c.length)===_);if(!H){var K=c?T$([],c):[];if(N.selected){var re=K.findIndex(function(G){return xl(P,G)});K.splice(re,1)}else K.push(P);(B=t.onSelect)===null||B===void 0||B.call(t,K,P,N,U)}}},o={disabled:[]};c&&o.disabled.push(function(P){var N=_&&c.length>_-1,U=c.some(function($){return xl($,P)});return!!(N&&!U)});var I={selected:c,onDayClick:x,modifiers:o};return h.jsx(Rj.Provider,{value:I,children:i})}function Mj(){var e=V.useContext(Rj);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}function ele(e,t){var i=t||{},c=i.from,f=i.to;return c&&f?xl(f,e)&&xl(c,e)?void 0:xl(f,e)?{from:f,to:void 0}:xl(c,e)?void 0:jP(c,e)?{from:e,to:f}:{from:c,to:e}:f?jP(e,f)?{from:f,to:e}:{from:e,to:f}:c?L6(e,c)?{from:e,to:c}:{from:c,to:e}:{from:e,to:void 0}}var Dj=V.createContext(void 0);function tle(e){if(!Db(e.initialProps)){var t={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return h.jsx(Dj.Provider,{value:t,children:e.children})}return h.jsx(rle,{initialProps:e.initialProps,children:e.children})}function rle(e){var t=e.initialProps,i=e.children,c=t.selected,f=c||{},_=f.from,x=f.to,o=t.min,I=t.max,P=function(B,Y,H){var K,re;(K=t.onDayClick)===null||K===void 0||K.call(t,B,Y,H);var G=ele(B,c);(re=t.onSelect)===null||re===void 0||re.call(t,G,B,Y,H)},N={range_start:[],range_end:[],range_middle:[],disabled:[]};if(_?(N.range_start=[_],x?(N.range_end=[x],xl(_,x)||(N.range_middle=[{after:_,before:x}])):N.range_end=[_]):x&&(N.range_start=[x],N.range_end=[x]),o&&(_&&!x&&N.disabled.push({after:CA(_,o-1),before:Ha(_,o-1)}),_&&x&&N.disabled.push({after:_,before:Ha(_,o-1)}),!_&&x&&N.disabled.push({after:CA(x,o-1),before:Ha(x,o-1)})),I){if(_&&!x&&(N.disabled.push({before:Ha(_,-I+1)}),N.disabled.push({after:Ha(_,I-1)})),_&&x){var U=Bu(x,_)+1,$=I-U;N.disabled.push({before:CA(_,$)}),N.disabled.push({after:Ha(x,$)})}!_&&x&&(N.disabled.push({before:Ha(x,-I+1)}),N.disabled.push({after:Ha(x,I-1)}))}return h.jsx(Dj.Provider,{value:{selected:c,onDayClick:P,modifiers:N},children:i})}function Nj(){var e=V.useContext(Dj);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function jS(e){return Array.isArray(e)?T$([],e):e!==void 0?[e]:[]}function nle(e){var t={};return Object.entries(e).forEach(function(i){var c=i[0],f=i[1];t[c]=jS(f)}),t}var lu;(function(e){e.Outside="outside",e.Disabled="disabled",e.Selected="selected",e.Hidden="hidden",e.Today="today",e.RangeStart="range_start",e.RangeEnd="range_end",e.RangeMiddle="range_middle"})(lu||(lu={}));var ile=lu.Selected,Td=lu.Disabled,sle=lu.Hidden,ole=lu.Today,PA=lu.RangeEnd,kA=lu.RangeMiddle,jA=lu.RangeStart,ale=lu.Outside;function lle(e,t,i){var c,f=(c={},c[ile]=jS(e.selected),c[Td]=jS(e.disabled),c[sle]=jS(e.hidden),c[ole]=[e.today],c[PA]=[],c[kA]=[],c[jA]=[],c[ale]=[],c);return e.fromDate&&f[Td].push({before:e.fromDate}),e.toDate&&f[Td].push({after:e.toDate}),Mb(e)?f[Td]=f[Td].concat(t.modifiers[Td]):Db(e)&&(f[Td]=f[Td].concat(i.modifiers[Td]),f[jA]=i.modifiers[jA],f[kA]=i.modifiers[kA],f[PA]=i.modifiers[PA]),f}var P$=V.createContext(void 0);function cle(e){var t=Ps(),i=Mj(),c=Nj(),f=lle(t,i,c),_=nle(t.modifiers),x=ei(ei({},f),_);return h.jsx(P$.Provider,{value:x,children:e.children})}function k$(){var e=V.useContext(P$);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function ule(e){return!!(e&&typeof e=="object"&&"before"in e&&"after"in e)}function dle(e){return!!(e&&typeof e=="object"&&"from"in e)}function hle(e){return!!(e&&typeof e=="object"&&"after"in e)}function fle(e){return!!(e&&typeof e=="object"&&"before"in e)}function ple(e){return!!(e&&typeof e=="object"&&"dayOfWeek"in e)}function mle(e,t){var i,c=t.from,f=t.to;if(c&&f){var _=Bu(f,c)<0;_&&(i=[f,c],c=i[0],f=i[1]);var x=Bu(e,c)>=0&&Bu(f,e)>=0;return x}return f?xl(f,e):c?xl(c,e):!1}function gle(e){return Pj(e)}function _le(e){return Array.isArray(e)&&e.every(Pj)}function yle(e,t){return t.some(function(i){if(typeof i=="boolean")return i;if(gle(i))return xl(e,i);if(_le(i))return i.includes(e);if(dle(i))return mle(e,i);if(ple(i))return i.dayOfWeek.includes(e.getDay());if(ule(i)){var c=Bu(i.before,e),f=Bu(i.after,e),_=c>0,x=f<0,o=jP(i.before,i.after);return o?x&&_:_||x}return hle(i)?Bu(e,i.after)>0:fle(i)?Bu(i.before,e)>0:typeof i=="function"?i(e):!1})}function Oj(e,t,i){var c=Object.keys(t).reduce(function(_,x){var o=t[x];return yle(e,o)&&_.push(x),_},[]),f={};return c.forEach(function(_){return f[_]=!0}),i&&!x2(e,i)&&(f.outside=!0),f}function vle(e,t){for(var i=Sa(e[0]),c=ob(e[e.length-1]),f,_,x=i;x<=c;){var o=Oj(x,t),I=!o.disabled&&!o.hidden;if(!I){x=Ha(x,1);continue}if(o.selected)return x;o.today&&!_&&(_=x),f||(f=x),x=Ha(x,1)}return _||f}var xle=365;function j$(e,t){var i=t.moveBy,c=t.direction,f=t.context,_=t.modifiers,x=t.retry,o=x===void 0?{count:0,lastFocused:e}:x,I=f.weekStartsOn,P=f.fromDate,N=f.toDate,U=f.locale,$={day:Ha,week:kP,month:Wl,year:Kie,startOfWeek:function(K){return f.ISOWeek?Nm(K):tu(K,{locale:U,weekStartsOn:I})},endOfWeek:function(K){return f.ISOWeek?k6(K):v2(K,{locale:U,weekStartsOn:I})}},B=$[i](e,c==="after"?1:-1);c==="before"&&P?B=Yie([P,B]):c==="after"&&N&&(B=Jie([N,B]));var Y=!0;if(_){var H=Oj(B,_);Y=!H.disabled&&!H.hidden}return Y?B:o.count>xle?o.lastFocused:j$(B,{moveBy:i,direction:c,context:f,modifiers:_,retry:ei(ei({},o),{count:o.count+1})})}var R$=V.createContext(void 0);function ble(e){var t=Nb(),i=k$(),c=V.useState(),f=c[0],_=c[1],x=V.useState(),o=x[0],I=x[1],P=vle(t.displayMonths,i),N=f??(o&&t.isDateDisplayed(o))?o:P,U=function(){I(f),_(void 0)},$=function(K){_(K)},B=Ps(),Y=function(K,re){if(f){var G=j$(f,{moveBy:K,direction:re,context:B,modifiers:i});xl(f,G)||(t.goToDate(G,f),$(G))}},H={focusedDay:f,focusTarget:N,blur:U,focus:$,focusDayAfter:function(){return Y("day","after")},focusDayBefore:function(){return Y("day","before")},focusWeekAfter:function(){return Y("week","after")},focusWeekBefore:function(){return Y("week","before")},focusMonthBefore:function(){return Y("month","before")},focusMonthAfter:function(){return Y("month","after")},focusYearBefore:function(){return Y("year","before")},focusYearAfter:function(){return Y("year","after")},focusStartOfWeek:function(){return Y("startOfWeek","before")},focusEndOfWeek:function(){return Y("endOfWeek","after")}};return h.jsx(R$.Provider,{value:H,children:e.children})}function Lj(){var e=V.useContext(R$);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}function wle(e,t){var i=k$(),c=Oj(e,i,t);return c}var zj=V.createContext(void 0);function Sle(e){if(!w2(e.initialProps)){var t={selected:void 0};return h.jsx(zj.Provider,{value:t,children:e.children})}return h.jsx(Tle,{initialProps:e.initialProps,children:e.children})}function Tle(e){var t=e.initialProps,i=e.children,c=function(_,x,o){var I,P,N;if((I=t.onDayClick)===null||I===void 0||I.call(t,_,x,o),x.selected&&!t.required){(P=t.onSelect)===null||P===void 0||P.call(t,void 0,_,x,o);return}(N=t.onSelect)===null||N===void 0||N.call(t,_,_,x,o)},f={selected:t.selected,onDayClick:c};return h.jsx(zj.Provider,{value:f,children:i})}function M$(){var e=V.useContext(zj);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function Ele(e,t){var i=Ps(),c=M$(),f=Mj(),_=Nj(),x=Lj(),o=x.focusDayAfter,I=x.focusDayBefore,P=x.focusWeekAfter,N=x.focusWeekBefore,U=x.blur,$=x.focus,B=x.focusMonthBefore,Y=x.focusMonthAfter,H=x.focusYearBefore,K=x.focusYearAfter,re=x.focusStartOfWeek,G=x.focusEndOfWeek,X=function(We){var $e,_t,mt,rt;w2(i)?($e=c.onDayClick)===null||$e===void 0||$e.call(c,e,t,We):Mb(i)?(_t=f.onDayClick)===null||_t===void 0||_t.call(f,e,t,We):Db(i)?(mt=_.onDayClick)===null||mt===void 0||mt.call(_,e,t,We):(rt=i.onDayClick)===null||rt===void 0||rt.call(i,e,t,We)},ue=function(We){var $e;$(e),($e=i.onDayFocus)===null||$e===void 0||$e.call(i,e,t,We)},Ee=function(We){var $e;U(),($e=i.onDayBlur)===null||$e===void 0||$e.call(i,e,t,We)},xe=function(We){var $e;($e=i.onDayMouseEnter)===null||$e===void 0||$e.call(i,e,t,We)},Ne=function(We){var $e;($e=i.onDayMouseLeave)===null||$e===void 0||$e.call(i,e,t,We)},lt=function(We){var $e;($e=i.onDayPointerEnter)===null||$e===void 0||$e.call(i,e,t,We)},Pt=function(We){var $e;($e=i.onDayPointerLeave)===null||$e===void 0||$e.call(i,e,t,We)},tt=function(We){var $e;($e=i.onDayTouchCancel)===null||$e===void 0||$e.call(i,e,t,We)},yt=function(We){var $e;($e=i.onDayTouchEnd)===null||$e===void 0||$e.call(i,e,t,We)},Me=function(We){var $e;($e=i.onDayTouchMove)===null||$e===void 0||$e.call(i,e,t,We)},be=function(We){var $e;($e=i.onDayTouchStart)===null||$e===void 0||$e.call(i,e,t,We)},je=function(We){var $e;($e=i.onDayKeyUp)===null||$e===void 0||$e.call(i,e,t,We)},Ye=function(We){var $e;switch(We.key){case"ArrowLeft":We.preventDefault(),We.stopPropagation(),i.dir==="rtl"?o():I();break;case"ArrowRight":We.preventDefault(),We.stopPropagation(),i.dir==="rtl"?I():o();break;case"ArrowDown":We.preventDefault(),We.stopPropagation(),P();break;case"ArrowUp":We.preventDefault(),We.stopPropagation(),N();break;case"PageUp":We.preventDefault(),We.stopPropagation(),We.shiftKey?H():B();break;case"PageDown":We.preventDefault(),We.stopPropagation(),We.shiftKey?K():Y();break;case"Home":We.preventDefault(),We.stopPropagation(),re();break;case"End":We.preventDefault(),We.stopPropagation(),G();break}($e=i.onDayKeyDown)===null||$e===void 0||$e.call(i,e,t,We)},qe={onClick:X,onFocus:ue,onBlur:Ee,onKeyDown:Ye,onKeyUp:je,onMouseEnter:xe,onMouseLeave:Ne,onPointerEnter:lt,onPointerLeave:Pt,onTouchCancel:tt,onTouchEnd:yt,onTouchMove:Me,onTouchStart:be};return qe}function Cle(){var e=Ps(),t=M$(),i=Mj(),c=Nj(),f=w2(e)?t.selected:Mb(e)?i.selected:Db(e)?c.selected:void 0;return f}function Ale(e){return Object.values(lu).includes(e)}function Ile(e,t){var i=[e.classNames.day];return Object.keys(t).forEach(function(c){var f=e.modifiersClassNames[c];if(f)i.push(f);else if(Ale(c)){var _=e.classNames["day_".concat(c)];_&&i.push(_)}}),i}function Ple(e,t){var i=ei({},e.styles.day);return Object.keys(t).forEach(function(c){var f;i=ei(ei({},i),(f=e.modifiersStyles)===null||f===void 0?void 0:f[c])}),i}function kle(e,t,i){var c,f,_,x=Ps(),o=Lj(),I=wle(e,t),P=Ele(e,I),N=Cle(),U=!!(x.onDayClick||x.mode!=="default");V.useEffect(function(){var xe;I.outside||o.focusedDay&&U&&xl(o.focusedDay,e)&&((xe=i.current)===null||xe===void 0||xe.focus())},[o.focusedDay,e,i,U,I.outside]);var $=Ile(x,I).join(" "),B=Ple(x,I),Y=!!(I.outside&&!x.showOutsideDays||I.hidden),H=(_=(f=x.components)===null||f===void 0?void 0:f.DayContent)!==null&&_!==void 0?_:Yae,K=h.jsx(H,{date:e,displayMonth:t,activeModifiers:I}),re={style:B,className:$,children:K,role:"gridcell"},G=o.focusTarget&&xl(o.focusTarget,e)&&!I.outside,X=o.focusedDay&&xl(o.focusedDay,e),ue=ei(ei(ei({},re),(c={disabled:I.disabled,role:"gridcell"},c["aria-selected"]=I.selected,c.tabIndex=X||G?0:-1,c)),P),Ee={isButton:U,isHidden:Y,activeModifiers:I,selectedDays:N,buttonProps:ue,divProps:re};return Ee}function jle(e){var t=V.useRef(null),i=kle(e.date,e.displayMonth,t);return i.isHidden?h.jsx("div",{role:"gridcell"}):i.isButton?h.jsx(kT,ei({name:"day",ref:t},i.buttonProps)):h.jsx("div",ei({},i.divProps))}function Rle(e){var t=e.number,i=e.dates,c=Ps(),f=c.onWeekNumberClick,_=c.styles,x=c.classNames,o=c.locale,I=c.labels.labelWeekNumber,P=c.formatters.formatWeekNumber,N=P(Number(t),{locale:o});if(!f)return h.jsx("span",{className:x.weeknumber,style:_.weeknumber,children:N});var U=I(Number(t),{locale:o}),$=function(B){f(t,i,B)};return h.jsx(kT,{name:"week-number","aria-label":U,className:x.weeknumber,style:_.weeknumber,onClick:$,children:N})}function Mle(e){var t,i,c=Ps(),f=c.styles,_=c.classNames,x=c.showWeekNumber,o=c.components,I=(t=o==null?void 0:o.Day)!==null&&t!==void 0?t:jle,P=(i=o==null?void 0:o.WeekNumber)!==null&&i!==void 0?i:Rle,N;return x&&(N=h.jsx("td",{className:_.cell,style:f.cell,children:h.jsx(P,{number:e.weekNumber,dates:e.dates})})),h.jsxs("tr",{className:_.row,style:f.row,children:[N,e.dates.map(function(U){return h.jsx("td",{className:_.cell,style:f.cell,role:"presentation",children:h.jsx(I,{displayMonth:e.displayMonth,date:U})},Yse(U))})]})}function eF(e,t,i){for(var c=i!=null&&i.ISOWeek?k6(t):v2(t,i),f=i!=null&&i.ISOWeek?Nm(e):tu(e,i),_=Bu(c,f),x=[],o=0;o<=_;o++)x.push(Ha(f,o));var I=x.reduce(function(P,N){var U=i!=null&&i.ISOWeek?M6(N):N6(N,i),$=P.find(function(B){return B.weekNumber===U});return $?($.dates.push(N),P):(P.push({weekNumber:U,dates:[N]}),P)},[]);return I}function Dle(e,t){var i=eF(Sa(e),ob(e),t);if(t!=null&&t.useFixedWeeks){var c=Qse(e,t);if(c<6){var f=i[i.length-1],_=f.dates[f.dates.length-1],x=kP(_,6-c),o=eF(kP(_,1),x,t);i.push.apply(i,o)}}return i}function Nle(e){var t,i,c,f=Ps(),_=f.locale,x=f.classNames,o=f.styles,I=f.hideHead,P=f.fixedWeeks,N=f.components,U=f.weekStartsOn,$=f.firstWeekContainsDate,B=f.ISOWeek,Y=Dle(e.displayMonth,{useFixedWeeks:!!P,ISOWeek:B,locale:_,weekStartsOn:U,firstWeekContainsDate:$}),H=(t=N==null?void 0:N.Head)!==null&&t!==void 0?t:Kae,K=(i=N==null?void 0:N.Row)!==null&&i!==void 0?i:Mle,re=(c=N==null?void 0:N.Footer)!==null&&c!==void 0?c:Hae;return h.jsxs("table",{id:e.id,className:x.table,style:o.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!I&&h.jsx(H,{}),h.jsx("tbody",{className:x.tbody,style:o.tbody,children:Y.map(function(G){return h.jsx(K,{displayMonth:e.displayMonth,dates:G.dates,weekNumber:G.weekNumber},G.weekNumber)})}),h.jsx(re,{displayMonth:e.displayMonth})]})}function Ole(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var Lle=Ole()?V.useLayoutEffect:V.useEffect,RA=!1,zle=0;function tF(){return"react-day-picker-".concat(++zle)}function Fle(e){var t,i=e??(RA?tF():null),c=V.useState(i),f=c[0],_=c[1];return Lle(function(){f===null&&_(tF())},[]),V.useEffect(function(){RA===!1&&(RA=!0)},[]),(t=e??f)!==null&&t!==void 0?t:void 0}function Ble(e){var t,i,c=Ps(),f=c.dir,_=c.classNames,x=c.styles,o=c.components,I=Nb().displayMonths,P=Fle(c.id?"".concat(c.id,"-").concat(e.displayIndex):void 0),N=c.id?"".concat(c.id,"-grid-").concat(e.displayIndex):void 0,U=[_.month],$=x.month,B=e.displayIndex===0,Y=e.displayIndex===I.length-1,H=!B&&!Y;f==="rtl"&&(t=[B,Y],Y=t[0],B=t[1]),B&&(U.push(_.caption_start),$=ei(ei({},$),x.caption_start)),Y&&(U.push(_.caption_end),$=ei(ei({},$),x.caption_end)),H&&(U.push(_.caption_between),$=ei(ei({},$),x.caption_between));var K=(i=o==null?void 0:o.Caption)!==null&&i!==void 0?i:Wae;return h.jsxs("div",{className:U.join(" "),style:$,children:[h.jsx(K,{id:P,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),h.jsx(Nle,{id:N,"aria-labelledby":P,displayMonth:e.displayMonth})]},e.displayIndex)}function Vle(e){var t=Ps(),i=t.classNames,c=t.styles;return h.jsx("div",{className:i.months,style:c.months,children:e.children})}function Ule(e){var t,i,c=e.initialProps,f=Ps(),_=Lj(),x=Nb(),o=V.useState(!1),I=o[0],P=o[1];V.useEffect(function(){f.initialFocus&&_.focusTarget&&(I||(_.focus(_.focusTarget),P(!0)))},[f.initialFocus,I,_.focus,_.focusTarget,_]);var N=[f.classNames.root,f.className];f.numberOfMonths>1&&N.push(f.classNames.multiple_months),f.showWeekNumber&&N.push(f.classNames.with_weeknumber);var U=ei(ei({},f.styles.root),f.style),$=Object.keys(c).filter(function(Y){return Y.startsWith("data-")}).reduce(function(Y,H){var K;return ei(ei({},Y),(K={},K[H]=c[H],K))},{}),B=(i=(t=c.components)===null||t===void 0?void 0:t.Months)!==null&&i!==void 0?i:Vle;return h.jsx("div",ei({className:N.join(" "),style:U,dir:f.dir,id:f.id,nonce:c.nonce,title:c.title,lang:c.lang},$,{children:h.jsx(B,{children:x.displayMonths.map(function(Y,H){return h.jsx(Ble,{displayIndex:H,displayMonth:Y},H)})})}))}function $le(e){var t=e.children,i=fae(e,["children"]);return h.jsx(Rae,{initialProps:i,children:h.jsx(Uae,{children:h.jsx(Sle,{initialProps:i,children:h.jsx(Jae,{initialProps:i,children:h.jsx(tle,{initialProps:i,children:h.jsx(cle,{children:h.jsx(ble,{children:t})})})})})})})}function qle(e){return h.jsx($le,ei({},e,{children:h.jsx(Ule,{initialProps:e})}))}function Fj({className:e,classNames:t,showOutsideDays:i=!0,...c}){return h.jsx(qle,{showOutsideDays:i,className:yr("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:yr(rb({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:yr(rb({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...f})=>h.jsx(h4,{className:"h-4 w-4"}),IconRight:({...f})=>h.jsx(f4,{className:"h-4 w-4"})},...c})}Fj.displayName="Calendar";const Gle=({posto:e,unidade:t,onEdit:i,onDelete:c})=>{const[f,_]=V.useState([]),[x,o]=V.useState("vago"),[I,P]=V.useState(),[N,U]=V.useState(!1),[$,B]=V.useState([]),[Y,H]=V.useState([]),[K,re]=V.useState([]),[G,X]=V.useState(!1),[ue,Ee]=V.useState(null),[xe,Ne]=V.useState("");V.useEffect(()=>{tt(),Pt(),lt();const mt=Qe.channel(`posto-${e.id}-colaboradores`).on("postgres_changes",{event:"*",schema:"public",table:"colaboradores",filter:`posto_servico_id=eq.${e.id}`},()=>{tt()}).subscribe();return()=>{Qe.removeChannel(mt)}},[e.id]);const lt=async()=>{const mt=new Date,rt=new Date(mt.getFullYear(),mt.getMonth(),1),Tt=new Date(mt.getFullYear(),mt.getMonth()+1,0),{data:Vt,error:it}=await Qe.from("posto_dias_vagos").select("data").eq("posto_servico_id",e.id).gte("data",rt.toISOString().split("T")[0]).lte("data",Tt.toISOString().split("T")[0]);if(!it&&Vt){const ir=Vt.map(wr=>new Date(wr.data+"T00:00:00"));re(ir)}},Pt=async()=>{const mt=new Date,rt=mt.getMonth()+1,Tt=mt.getFullYear(),{data:Vt,error:it}=await Qe.from("posto_jornadas").select("dias_trabalho").eq("posto_servico_id",e.id).eq("mes",rt).eq("ano",Tt).maybeSingle();if(!it&&Vt){const ir=Vt.dias_trabalho.map(wr=>new Date(wr+"T00:00:00"));B(ir)}},tt=async()=>{const{data:mt,error:rt}=await Qe.from("colaboradores").select("id, nome_completo, status").eq("posto_servico_id",e.id);!rt&&mt&&(_(mt),yt(mt.length))},yt=mt=>{let rt=e.efetivo_planejado||1;e.escala==="12x36"?(rt=4,mt>=rt?o("ocupado"):o("vago")):mt===0?o("vago"):mt>=rt?o("ocupado"):o("parcial")},Me=async()=>{try{const{data:mt}=await Qe.from("colaboradores").select("id").eq("posto_servico_id",e.id).limit(1),{data:rt}=await Qe.from("chamados").select("id").eq("posto_servico_id",e.id).limit(1);if(mt&&mt.length>0){Hn({title:"No  possvel excluir",description:"Este posto possui colaboradores relacionados. Remova a vinculao dos colaboradores primeiro.",variant:"destructive"});return}if(rt&&rt.length>0){Hn({title:"No  possvel excluir",description:"Este posto possui chamados relacionados. Exclua os chamados primeiro.",variant:"destructive"});return}const{error:Tt}=await Qe.from("postos_servico").delete().eq("id",e.id);if(Tt)throw Tt;Hn({title:"Posto excludo",description:"Posto de servio excludo com sucesso"}),c()}catch(mt){Hn({title:"Erro",description:mt.message,variant:"destructive"})}},be=mt=>{switch(mt){case"ativo":return"default";case"vago":return"secondary";default:return"outline"}},je=mt=>{switch(mt){case"ocupado":return"default";case"parcial":return"secondary";case"vago":return"destructive";default:return"outline"}},Ye=mt=>{switch(mt){case"ocupado":return h.jsx(nT,{className:"h-4 w-4"});case"vago":return h.jsx(nL,{className:"h-4 w-4"});default:return h.jsx(Ld,{className:"h-4 w-4"})}},qe=async()=>{if(!e.escala)return;if(x==="vago"){Hn({title:"Posto vago",description:" necessrio ter colaboradores lotados no posto para cadastrar a jornada",variant:"destructive"});return}const mt=e.escala.match(/(\d+)x(\d+)/);if(!mt)return;const rt=parseInt(mt[1]),Tt=parseInt(mt[2]),Vt=new Date,it=[];new Date(Vt.getFullYear(),Vt.getMonth(),1);const wr=new Date(Vt.getFullYear(),Vt.getMonth()+1,0).getDate();if(rt===5&&Tt===2)for(let Bt=1;Bt<=wr;Bt++){const Wr=new Date(Vt.getFullYear(),Vt.getMonth(),Bt),Er=Wr.getDay();Er>=1&&Er<=5&&it.push(Wr)}else if(rt===12&&Tt===36)for(let Bt=1;Bt<=wr;Bt++){const Wr=new Date(Vt.getFullYear(),Vt.getMonth(),Bt);it.push(Wr)}else{const Bt=rt+Tt;for(let Wr=1;Wr<=wr;Wr++){const Er=new Date(Vt.getFullYear(),Vt.getMonth(),Wr),Vr=Vt.getDate(),Ur=Wr-Vr;(Ur>=0?Ur%Bt:(Bt+Ur%Bt)%Bt)<rt&&it.push(Er)}}try{const{data:{user:Bt}}=await Qe.auth.getUser();if(!Bt)throw new Error("Usurio no autenticado");const Wr=Vt.getMonth()+1,Er=Vt.getFullYear(),Vr=it.map(jn=>jn.toISOString().split("T")[0]),{error:Ur}=await Qe.from("posto_jornadas").upsert({posto_servico_id:e.id,mes:Wr,ano:Er,dias_trabalho:Vr,created_by:Bt.id},{onConflict:"posto_servico_id,mes,ano"});if(Ur)throw Ur;B(it),Hn({title:"Jornada confirmada",description:`Jornada de ${e.escala} confirmada para ${it.length} dias do ms corrente`})}catch(Bt){Hn({title:"Erro ao salvar jornada",description:Bt.message,variant:"destructive"})}},We=mt=>{mt&&(Ee(mt),X(!0))},$e=async()=>{if(ue)try{const{error:mt}=await Qe.from("posto_dias_vagos").delete().eq("posto_servico_id",e.id).eq("data",ue.toISOString().split("T")[0]);if(mt)throw mt;re(rt=>rt.filter(Tt=>Tt.getTime()!==ue.getTime())),Y.some(rt=>rt.getTime()===ue.getTime())||H(rt=>[...rt,ue]),X(!1),Hn({title:"Presena confirmada",description:`Presena confirmada para ${ue.toLocaleDateString("pt-BR")}`})}catch(mt){Hn({title:"Erro ao confirmar presena",description:mt.message,variant:"destructive"})}},_t=async()=>{if(!ue||!xe){Hn({title:"Motivo obrigatrio",description:"Selecione um motivo para marcar o posto como vago",variant:"destructive"});return}try{const{data:{user:mt}}=await Qe.auth.getUser();if(!mt)throw new Error("Usurio no autenticado");const{data:rt}=await Qe.from("colaboradores").select("id").eq("posto_servico_id",e.id).eq("status","ativo").limit(1).single(),{error:Tt}=await Qe.from("posto_dias_vagos").insert({posto_servico_id:e.id,colaborador_id:(rt==null?void 0:rt.id)||null,data:ue.toISOString().split("T")[0],motivo:xe,created_by:mt.id});if(Tt&&!Tt.message.includes("duplicate key"))throw Tt;H(Vt=>Vt.filter(it=>it.getTime()!==ue.getTime())),K.some(Vt=>Vt.getTime()===ue.getTime())||re(Vt=>[...Vt,ue]),X(!1),Ne(""),Hn({title:"Posto vago",description:`Posto marcado como vago para ${ue.toLocaleDateString("pt-BR")}`,variant:"destructive"})}catch(mt){Hn({title:"Erro ao marcar dia vago",description:mt.message,variant:"destructive"})}};return h.jsxs(kr,{className:"hover:shadow-lg transition-shadow",children:[h.jsx(Mn,{children:h.jsxs("div",{className:"flex items-start justify-between",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:h.jsx(tL,{className:"h-4 w-4 text-primary"})}),h.jsxs("div",{children:[h.jsx(Zn,{className:"text-base",children:e.nome}),h.jsx("p",{className:"text-sm text-muted-foreground",children:e.codigo})]})]}),h.jsxs("div",{className:"flex gap-2 items-center",children:[h.jsxs(fo,{open:N,onOpenChange:U,children:[h.jsx(hU,{asChild:!0,children:h.jsx(tr,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:h.jsx($u,{className:"h-4 w-4"})})}),h.jsxs(Js,{className:"sm:max-w-md",children:[h.jsx(Qs,{children:h.jsxs(eo,{children:["Calendrio - ",e.nome]})}),h.jsxs("div",{className:"space-y-4",children:[h.jsx("div",{className:"flex justify-center",children:h.jsx(Fj,{mode:"single",selected:I,onSelect:We,className:"rounded-md border pointer-events-auto",modifiers:{confirmado:$,presenca:Y,vago:K},modifiersStyles:{confirmado:{backgroundColor:"hsl(var(--primary) / 0.2)",color:"hsl(var(--foreground))"},presenca:{backgroundColor:"hsl(142 76% 36%)",color:"white",fontWeight:"bold"},vago:{backgroundColor:"hsl(0 84% 60%)",color:"white",fontWeight:"bold"}}})}),e.escala&&h.jsxs("div",{className:"space-y-2",children:[x==="vago"&&h.jsx("p",{className:"text-sm text-destructive text-center",children:" necessrio ter colaboradores lotados para cadastrar jornada"}),h.jsxs("div",{className:"flex justify-center gap-2",children:[h.jsx(tr,{onClick:qe,className:"w-full",disabled:$.length>0||x==="vago",children:$.length>0?"Jornada Confirmada":"Confirmar Jornada"}),$.length>0&&h.jsx(tr,{onClick:async()=>{try{const mt=new Date,{error:rt}=await Qe.from("posto_jornadas").delete().eq("posto_servico_id",e.id).eq("mes",mt.getMonth()+1).eq("ano",mt.getFullYear());if(rt)throw rt;B([]),Hn({title:"Jornada limpa",description:"Jornada removida com sucesso"})}catch(mt){Hn({title:"Erro ao limpar jornada",description:mt.message,variant:"destructive"})}},variant:"outline",children:"Limpar"})]})]})]})]})]}),h.jsx(ai,{variant:be(e.status),children:e.status}),h.jsxs(ai,{variant:je(x),className:"flex items-center gap-1",children:[Ye(x),x]})]})]})}),h.jsxs(tn,{children:[h.jsxs("div",{className:"space-y-2",children:[t&&h.jsxs("p",{className:"text-sm text-muted-foreground",children:["Unidade: ",t.nome]}),h.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[h.jsx(Ld,{className:"h-4 w-4 text-muted-foreground"}),h.jsx("span",{children:e.funcao})]}),e.escala&&h.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[h.jsx(tL,{className:"h-4 w-4"}),h.jsxs("span",{children:["Escala: ",e.escala]})]}),h.jsxs("div",{className:"flex items-center justify-between text-sm pt-2 border-t",children:[h.jsx("span",{className:"text-muted-foreground",children:"Colaboradores lotados:"}),h.jsxs("span",{className:"font-semibold",children:[f.length,"/",e.escala==="12x36"?4:e.efetivo_planejado||1]})]}),e.horario_inicio&&e.horario_fim&&h.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[h.jsx(vb,{className:"h-4 w-4"}),h.jsxs("span",{children:[e.horario_inicio," - ",e.horario_fim]})]})]}),h.jsxs("div",{className:"flex gap-2 mt-4",children:[h.jsxs(tr,{variant:"outline",size:"sm",className:"flex-1",onClick:i,children:[h.jsx(mc,{className:"h-3 w-3 mr-1"}),"Editar"]}),h.jsxs(Hu,{children:[h.jsx(Rb,{asChild:!0,children:h.jsx(tr,{variant:"outline",size:"sm",children:h.jsx(El,{className:"h-3 w-3"})})}),h.jsxs(ru,{children:[h.jsxs(nu,{children:[h.jsx(su,{children:"Confirmar excluso"}),h.jsx(ou,{children:"Tem certeza que deseja excluir este posto? Esta ao no pode ser desfeita."})]}),h.jsxs(iu,{children:[h.jsx(Zu,{children:"Cancelar"}),h.jsx(au,{onClick:Me,children:"Excluir"})]})]})]})]})]}),h.jsx(fo,{open:G,onOpenChange:X,children:h.jsxs(Js,{className:"sm:max-w-md",children:[h.jsx(Qs,{children:h.jsx(eo,{children:ue&&`Marcar dia ${ue.toLocaleDateString("pt-BR")}`})}),h.jsxs("div",{className:"flex flex-col gap-4",children:[h.jsxs(tr,{onClick:$e,className:"w-full bg-green-600 hover:bg-green-700",children:[h.jsx(nT,{className:"h-4 w-4 mr-2"}),"Confirmar Presena"]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"motivo",children:"Motivo da Ausncia"}),h.jsxs(un,{value:xe,onValueChange:Ne,children:[h.jsx(on,{id:"motivo",children:h.jsx(dn,{placeholder:"Selecione o motivo"})}),h.jsxs(an,{children:[h.jsx(kt,{value:"falta_justificada",children:"Falta Justificada"}),h.jsx(kt,{value:"falta_injustificada",children:"Falta Injustificada"}),h.jsx(kt,{value:"pedido",children:"Pedido"}),h.jsx(kt,{value:"afastamento_inss",children:"Afastamento INSS"}),h.jsx(kt,{value:"folga",children:"Folga"}),h.jsx(kt,{value:"ferias",children:"Frias"}),h.jsx(kt,{value:"suspensao",children:"Suspenso"})]})]})]}),h.jsxs(tr,{onClick:_t,variant:"destructive",className:"w-full",disabled:!xe,children:[h.jsx(nL,{className:"h-4 w-4 mr-2"}),"Posto Vago"]})]})]})})]})},Wle=()=>{var Ss,ua,jo;const e=cu(),[t,i]=V.useState(!0),[c,f]=V.useState(""),[_,x]=V.useState("clientes"),[o,I]=V.useState("all"),[P,N]=V.useState("all"),[U,$]=V.useState({}),[B,Y]=V.useState(0),[H,K]=V.useState(0),[re,G]=V.useState(0),[X,ue]=V.useState(0),[Ee,xe]=V.useState(0),[Ne,lt]=V.useState([]),[Pt,tt]=V.useState([]),[yt,Me]=V.useState([]),[be,je]=V.useState([]),[Ye,qe]=V.useState(!1),[We,$e]=V.useState(!1),[_t,mt]=V.useState(!1),[rt,Tt]=V.useState(!1),[Vt,it]=V.useState(void 0),[ir,wr]=V.useState(void 0),[Bt,Wr]=V.useState(void 0),[Er,Vr]=V.useState(void 0),[Ur,jn]=V.useState(null),[yn,os]=V.useState(null),[qi,ps]=V.useState(null);V.useEffect(()=>{Os(),Ei()},[]);const Os=async()=>{const{data:{user:Yt}}=await Qe.auth.getUser();Yt||e("/auth")},Ei=async()=>{i(!0);try{await Promise.all([po(),et(),Et(),Wt(),Ar(),pr(),gr(),Or()])}catch(Yt){console.error("Erro ao carregar dados:",Yt),Hn({title:"Erro",description:"Erro ao carregar dados",variant:"destructive"})}finally{i(!1)}},po=async()=>{const{data:Yt,error:$n}=await Qe.from("clientes").select("*").order("razao_social");if($n)throw $n;lt(Yt||[])},et=async()=>{const{data:Yt,error:$n}=await Qe.from("contratos").select("*").order("nome");if($n)throw $n;tt(Yt||[])},Et=async()=>{const{data:Yt,error:$n}=await Qe.from("unidades").select("*").order("nome");if($n)throw $n;Me(Yt||[])},Wt=async()=>{const{data:Yt,error:$n}=await Qe.from("postos_servico").select("*").order("nome");if($n)throw $n;if(je(Yt||[]),Yt){const as=Yt.map(bi=>bi.id),{data:Ts}=await Qe.from("colaboradores").select("posto_servico_id").in("posto_servico_id",as);if(Ts){const bi={};Ts.forEach(rs=>{rs.posto_servico_id&&(bi[rs.posto_servico_id]=(bi[rs.posto_servico_id]||0)+1)}),$(bi)}}},Ar=async()=>{const{count:Yt,error:$n}=await Qe.from("ordens_servico").select("id",{count:"exact",head:!0}).eq("status","aberta");if($n)throw $n;Y(Yt||0)},pr=async()=>{const{data:Yt,error:$n}=await Qe.from("chamados").select("sla_horas, avaliacao").eq("status","concluido").not("avaliacao","is",null);if($n)throw $n;if(Yt&&Yt.length>0){const as=Yt.map(bi=>bi.sla_horas).filter(bi=>typeof bi=="number"),Ts=Yt.map(bi=>bi.avaliacao).filter(bi=>typeof bi=="number");if(as.length>0){const bi=as.reduce((rs,fi)=>rs+fi,0);K(Math.round(bi/as.length*100)/100)}if(Ts.length>0){const bi=Ts.reduce((rs,fi)=>rs+fi,0);G(Math.round(bi/Ts.length*10)/10)}}else K(0),G(0)},gr=async()=>{const{count:Yt,error:$n}=await Qe.from("checklists").select("id",{count:"exact",head:!0});if($n)throw $n;ue(Yt||0)},Or=async()=>{const{count:Yt,error:$n}=await Qe.from("inspecoes").select("id",{count:"exact",head:!0});if($n)throw $n;xe(Yt||0)},Ln=Ne.filter(Yt=>Yt.razao_social.toLowerCase().includes(c.toLowerCase())||Yt.cnpj.includes(c)),gi=Ur?Pt.filter(Yt=>Yt.cliente_id===Ur):Pt.filter(Yt=>Yt.nome.toLowerCase().includes(c.toLowerCase())||Yt.codigo.toLowerCase().includes(c.toLowerCase())),Fi=yn?yt.filter(Yt=>Yt.contrato_id===yn):yt.filter(Yt=>Yt.nome.toLowerCase().includes(c.toLowerCase())||Yt.codigo.toLowerCase().includes(c.toLowerCase())),to=qi?be.filter(Yt=>{const $n=Yt.unidade_id===qi,as=Yt.nome.toLowerCase().includes(c.toLowerCase())||Yt.codigo.toLowerCase().includes(c.toLowerCase());if(P==="all")return $n&&as;const Ts=U[Yt.id]||0,bi=Py(Yt),rs=Ts>=bi;return $n&&as&&(P==="ocupado"?rs:!rs)}):be.filter(Yt=>{const $n=Yt.nome.toLowerCase().includes(c.toLowerCase())||Yt.codigo.toLowerCase().includes(c.toLowerCase()),as=o==="all"||Yt.unidade_id===o;if(P==="all")return $n&&as;const Ts=U[Yt.id]||0,bi=Py(Yt),rs=Ts>=bi;return $n&&as&&(P==="ocupado"?rs:!rs)});return t?h.jsx("div",{className:"min-h-screen flex items-center justify-center",children:h.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):h.jsx($o,{children:h.jsxs("div",{className:"min-h-screen bg-background",children:[h.jsx("header",{className:"border-b bg-card shadow-sm",children:h.jsx("div",{className:"container mx-auto px-4 py-4",children:h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("div",{className:"p-2 bg-gradient-to-br from-primary to-accent rounded-lg",children:h.jsx(Df,{className:"h-6 w-6 text-primary-foreground"})}),h.jsxs("div",{children:[h.jsx("h1",{className:"text-xl font-bold",children:"Gesto de Contratos"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Hierarquia: Cliente  Contrato  Unidade  Posto"})]})]})})}),h.jsxs("main",{className:"container mx-auto px-4 py-8",children:[h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8",children:[h.jsx(kr,{children:h.jsxs(Mn,{className:"pb-3",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx(Zn,{className:"text-sm font-medium text-muted-foreground",children:"Total Clientes"}),h.jsx(Ld,{className:"h-4 w-4 text-primary"})]}),h.jsx("p",{className:"text-2xl font-bold",children:Ne.length})]})}),h.jsx(kr,{children:h.jsxs(Mn,{className:"pb-3",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx(Zn,{className:"text-sm font-medium text-muted-foreground",children:"Checklists Ativos"}),h.jsx(Mk,{className:"h-4 w-4 text-emerald-600"})]}),h.jsx("p",{className:"text-2xl font-bold text-emerald-600",children:X})]})}),h.jsx(kr,{children:h.jsxs(Mn,{className:"pb-3",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx(Zn,{className:"text-sm font-medium text-muted-foreground",children:"Inspees Registradas"}),h.jsx(V7,{className:"h-4 w-4 text-indigo-600"})]}),h.jsx("p",{className:"text-2xl font-bold text-indigo-600",children:Ee})]})}),h.jsx(kr,{children:h.jsxs(Mn,{className:"pb-3",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx(Zn,{className:"text-sm font-medium text-muted-foreground",children:"Chamados: NPS Mdio Geral"}),h.jsx(Ok,{className:"h-4 w-4 text-blue-600"})]}),h.jsx("p",{className:"text-2xl font-bold text-blue-600",children:re>0?re.toFixed(1):"0"})]})}),h.jsx(kr,{children:h.jsxs(Mn,{className:"pb-3",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx(Zn,{className:"text-sm font-medium text-muted-foreground",children:"OS Abertas"}),h.jsx(Gd,{className:"h-4 w-4 text-orange-600"})]}),h.jsx("p",{className:"text-2xl font-bold text-orange-600",children:B})]})})]}),(Ur||yn||qi)&&h.jsxs("div",{className:"mb-4 flex items-center gap-2 text-sm",children:[h.jsx(tr,{variant:"link",size:"sm",onClick:()=>{jn(null),os(null),ps(null),x("clientes")},children:"Clientes"}),Ur&&h.jsxs(h.Fragment,{children:[h.jsx("span",{children:"/"}),h.jsx(tr,{variant:"link",size:"sm",onClick:()=>{os(null),ps(null),x("contratos")},children:(Ss=Ne.find(Yt=>Yt.id===Ur))==null?void 0:Ss.razao_social})]}),yn&&h.jsxs(h.Fragment,{children:[h.jsx("span",{children:"/"}),h.jsx(tr,{variant:"link",size:"sm",onClick:()=>{ps(null),x("unidades")},children:(ua=Pt.find(Yt=>Yt.id===yn))==null?void 0:ua.nome})]}),qi&&h.jsxs(h.Fragment,{children:[h.jsx("span",{children:"/"}),h.jsx("span",{className:"text-muted-foreground",children:(jo=yt.find(Yt=>Yt.id===qi))==null?void 0:jo.nome})]})]}),h.jsxs(n$,{value:_,onValueChange:x,children:[h.jsxs(jj,{className:"grid w-full grid-cols-4",children:[h.jsx(vf,{value:"clientes",children:"Clientes"}),h.jsx(vf,{value:"contratos",children:"Contratos"}),h.jsx(vf,{value:"unidades",children:"Unidades"}),h.jsx(vf,{value:"postos",children:"Postos"})]}),h.jsxs(xf,{value:"clientes",className:"space-y-4",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"relative flex-1 max-w-sm",children:[h.jsx(Xc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),h.jsx(_r,{placeholder:"Buscar cliente...",value:c,onChange:Yt=>f(Yt.target.value),className:"pl-10"})]}),h.jsxs(tr,{onClick:()=>qe(!0),children:[h.jsx(oa,{className:"h-4 w-4 mr-2"}),"Novo Cliente"]})]}),Ye&&h.jsx(Hoe,{clienteId:Vt,onClose:()=>{qe(!1),it(void 0)},onSuccess:()=>{po(),qe(!1),it(void 0)}}),h.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Ln.map(Yt=>h.jsx(uae,{cliente:Yt,onSelect:()=>{jn(Yt.id),x("contratos")},onEdit:()=>{it(Yt.id),qe(!0)},onDelete:()=>po()},Yt.id))}),Ln.length===0&&h.jsx(kr,{children:h.jsxs(tn,{className:"flex flex-col items-center justify-center py-12",children:[h.jsx(V_,{className:"h-12 w-12 text-muted-foreground mb-4"}),h.jsx("p",{className:"text-muted-foreground",children:"Nenhum cliente encontrado"})]})})]}),h.jsxs(xf,{value:"contratos",className:"space-y-4",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"relative flex-1 max-w-sm",children:[h.jsx(Xc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),h.jsx(_r,{placeholder:"Buscar contrato...",value:c,onChange:Yt=>f(Yt.target.value),className:"pl-10"})]}),h.jsxs(tr,{onClick:()=>$e(!0),children:[h.jsx(oa,{className:"h-4 w-4 mr-2"}),"Novo Contrato"]})]}),We&&h.jsx(Zoe,{contratoId:ir,clienteId:Ur||void 0,onClose:()=>{$e(!1),wr(void 0)},onSuccess:()=>{et(),$e(!1),wr(void 0)}}),h.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:gi.map(Yt=>h.jsx(dae,{contrato:Yt,cliente:Ne.find($n=>$n.id===Yt.cliente_id),onSelect:()=>{os(Yt.id),x("unidades")},onEdit:()=>{wr(Yt.id),$e(!0)},onDelete:()=>et()},Yt.id))}),gi.length===0&&h.jsx(kr,{children:h.jsxs(tn,{className:"flex flex-col items-center justify-center py-12",children:[h.jsx(V_,{className:"h-12 w-12 text-muted-foreground mb-4"}),h.jsx("p",{className:"text-muted-foreground",children:"Nenhum contrato encontrado"})]})})]}),h.jsxs(xf,{value:"unidades",className:"space-y-4",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"relative flex-1 max-w-sm",children:[h.jsx(Xc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),h.jsx(_r,{placeholder:"Buscar unidade...",value:c,onChange:Yt=>f(Yt.target.value),className:"pl-10"})]}),h.jsxs(tr,{onClick:()=>mt(!0),children:[h.jsx(oa,{className:"h-4 w-4 mr-2"}),"Nova Unidade"]})]}),_t&&h.jsx(Xoe,{unidadeId:Bt,contratoId:yn||void 0,onClose:()=>{mt(!1),Wr(void 0)},onSuccess:()=>{Et(),mt(!1),Wr(void 0)}}),h.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Fi.map(Yt=>h.jsx(hae,{unidade:Yt,contrato:Pt.find($n=>$n.id===Yt.contrato_id),onSelect:()=>{ps(Yt.id),x("postos")},onEdit:()=>{Wr(Yt.id),mt(!0)},onDelete:()=>Et()},Yt.id))}),Fi.length===0&&h.jsx(kr,{children:h.jsxs(tn,{className:"flex flex-col items-center justify-center py-12",children:[h.jsx(V_,{className:"h-12 w-12 text-muted-foreground mb-4"}),h.jsx("p",{className:"text-muted-foreground",children:"Nenhuma unidade encontrada"})]})})]}),h.jsxs(xf,{value:"postos",className:"space-y-4",children:[h.jsxs("div",{className:"flex items-center justify-between gap-4",children:[h.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[h.jsxs("div",{className:"relative flex-1 max-w-sm",children:[h.jsx(Xc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),h.jsx(_r,{placeholder:"Buscar posto...",value:c,onChange:Yt=>f(Yt.target.value),className:"pl-10"})]}),!qi&&h.jsxs(un,{value:o,onValueChange:I,children:[h.jsx(on,{className:"w-[250px]",children:h.jsx(dn,{placeholder:"Filtrar por unidade"})}),h.jsxs(an,{className:"bg-popover z-50",children:[h.jsx(kt,{value:"all",children:"Todas as unidades"}),yt.map(Yt=>h.jsx(kt,{value:Yt.id,children:Yt.nome},Yt.id))]})]}),h.jsxs(un,{value:P,onValueChange:N,children:[h.jsx(on,{className:"w-[200px]",children:h.jsx(dn,{placeholder:"Filtrar por ocupao"})}),h.jsxs(an,{className:"bg-popover z-50",children:[h.jsx(kt,{value:"all",children:"Todos os postos"}),h.jsx(kt,{value:"ocupado",children:"Ocupados"}),h.jsx(kt,{value:"vago",children:"Vagos"})]})]})]}),h.jsxs(tr,{onClick:()=>Tt(!0),children:[h.jsx(oa,{className:"h-4 w-4 mr-2"}),"Novo Posto"]})]}),rt&&h.jsx(Koe,{postoId:Er,unidadeId:qi||void 0,onClose:()=>{Tt(!1),Vr(void 0)},onSuccess:()=>{Wt(),Tt(!1),Vr(void 0)}}),h.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:to.map(Yt=>h.jsx(Gle,{posto:Yt,unidade:yt.find($n=>$n.id===Yt.unidade_id),onEdit:()=>{Vr(Yt.id),Tt(!0)},onDelete:()=>Wt()},Yt.id))}),to.length===0&&h.jsx(kr,{children:h.jsxs(tn,{className:"flex flex-col items-center justify-center py-12",children:[h.jsx(V_,{className:"h-12 w-12 text-muted-foreground mb-4"}),h.jsx("p",{className:"text-muted-foreground",children:"Nenhum posto encontrado"})]})})]})]})]})]})})};function Hle({open:e,onClose:t}){const[i,c]=V.useState(!0),[f,_]=V.useState([]),[x,o]=V.useState([]),[I,P]=V.useState([]),[N,U]=V.useState([]),[$,B]=V.useState("all"),[Y,H]=V.useState(void 0),[K,re]=V.useState([]);V.useEffect(()=>{e&&G()},[e]);const G=async()=>{c(!0);try{await Promise.all([ue(),Ee(),X(),xe(),Ne()])}catch(tt){Hn({title:"Erro ao carregar dados",description:tt.message,variant:"destructive"})}finally{c(!1)}},X=async()=>{const{data:tt,error:yt}=await Qe.from("postos_servico").select("id, nome, codigo").eq("status","ativo").order("nome");if(yt)throw yt;re(tt||[])},ue=async()=>{var be,je,Ye;const{data:tt,error:yt}=await Qe.from("postos_servico").select(`
        id,
        nome,
        codigo,
        funcao,
        efetivo_planejado,
        escala,
        unidades (
          nome,
          codigo,
          contratos (
            nome,
            codigo
          )
        )
      `).eq("status","ativo");if(yt)throw yt;const Me=[];for(const qe of tt||[]){const{data:We}=await Qe.from("colaboradores").select("id").eq("posto_servico_id",qe.id).eq("status","ativo"),$e=(We==null?void 0:We.length)||0,_t=Py(qe);$e<_t&&Me.push({id:qe.id,nome:qe.nome,codigo:qe.codigo,funcao:qe.funcao,efetivo_planejado:_t,efetivo_atual:$e,unidade:{nome:((be=qe.unidades)==null?void 0:be.nome)||"Sem unidade",codigo:((je=qe.unidades)==null?void 0:je.codigo)||"",contrato:(Ye=qe.unidades)!=null&&Ye.contratos?{nome:qe.unidades.contratos.nome,codigo:qe.unidades.contratos.codigo}:null}})}_(Me)},Ee=async()=>{const{data:tt,error:yt}=await Qe.from("posto_dias_vagos").select(`
        id,
        data,
        motivo,
        postos_servico (
          nome,
          codigo,
          unidades (
            nome,
            contratos (
              nome,
              codigo
            )
          )
        ),
        colaboradores (
          nome_completo,
          cargo
        )
      `).gte("data",new Date().toISOString().split("T")[0]).order("data");if(yt)throw yt;const Me=(tt||[]).map(be=>{var je,Ye,qe,We,$e,_t;return{id:be.id,data:be.data,motivo:be.motivo,posto:{nome:((je=be.postos_servico)==null?void 0:je.nome)||"Desconhecido",codigo:((Ye=be.postos_servico)==null?void 0:Ye.codigo)||"",unidade:{nome:((We=(qe=be.postos_servico)==null?void 0:qe.unidades)==null?void 0:We.nome)||"Sem unidade",contrato:(_t=($e=be.postos_servico)==null?void 0:$e.unidades)!=null&&_t.contratos?{nome:be.postos_servico.unidades.contratos.nome,codigo:be.postos_servico.unidades.contratos.codigo}:null}},colaborador:be.colaboradores?{nome_completo:be.colaboradores.nome_completo,cargo:be.colaboradores.cargo||"Sem cargo"}:null}});o(Me)},xe=async()=>{const{data:tt,error:yt}=await Qe.from("colaboradores").select("id, nome_completo, cargo").is("posto_servico_id",null).eq("status","ativo").order("nome_completo");if(yt)throw yt;const Me=(tt||[]).map(be=>({id:be.id,nome_completo:be.nome_completo,cargo:be.cargo||"Sem cargo",funcao:be.cargo||"Sem funo"}));P(Me)},Ne=async()=>{const{data:tt,error:yt}=await Qe.from("diaristas").select("id, nome_completo, telefone, cidade").eq("status","ativo").order("nome_completo");if(yt)throw yt;U(tt||[])},lt=f.filter(tt=>!($!=="all"&&tt.id!==$)),Pt=x.filter(tt=>{if($!=="all"){const yt=K.find(Me=>Me.id===$);if(yt&&tt.posto.codigo!==yt.codigo)return!1}if(Y){const yt=new Date(tt.data);if(yt.getDate()!==Y.getDate()||yt.getMonth()!==Y.getMonth()||yt.getFullYear()!==Y.getFullYear())return!1}return!0});return h.jsx(fo,{open:e,onOpenChange:t,children:h.jsxs(Js,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[h.jsxs(Qs,{children:[h.jsxs(eo,{className:"text-2xl flex items-center gap-2",children:[h.jsx(V_,{className:"h-6 w-6 text-orange-500"}),"Gesto de Cobertura"]}),h.jsx(Yu,{children:"Monitore postos vagos e dias com ausncias programadas"})]}),h.jsxs("div",{className:"space-y-6",children:[h.jsxs(kr,{children:[h.jsx(Mn,{children:h.jsx(Zn,{className:"text-lg",children:"Filtros"})}),h.jsxs(tn,{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{children:[h.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Posto"}),h.jsxs(un,{value:$,onValueChange:B,children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Todos os postos"})}),h.jsxs(an,{children:[h.jsx(kt,{value:"all",children:"Todos os postos"}),K.map(tt=>h.jsxs(kt,{value:tt.id,children:[tt.codigo," - ",tt.nome]},tt.id))]})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Data"}),h.jsx(Fj,{mode:"single",selected:Y,onSelect:H,className:"border rounded-md",locale:Fd})]})]})]}),h.jsxs(kr,{children:[h.jsxs(Mn,{children:[h.jsxs(Zn,{className:"flex items-center gap-2",children:[h.jsx(Ld,{className:"h-5 w-5 text-red-500"}),"Postos Vagos (",lt.length,")"]}),h.jsx(Xa,{children:"Postos com vagas no preenchidas"})]}),h.jsx(tn,{children:i?h.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando..."}):lt.length===0?h.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum posto vago encontrado"}):h.jsxs("div",{className:"space-y-3",children:[lt.map(tt=>h.jsx(kr,{className:"border-red-200",children:h.jsx(tn,{className:"p-4",children:h.jsx("div",{className:"flex items-start justify-between",children:h.jsxs("div",{className:"flex-1",children:[h.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[h.jsx("h4",{className:"font-semibold",children:tt.nome}),h.jsx(ai,{variant:"outline",children:tt.codigo})]}),h.jsxs("div",{className:"space-y-1 mb-2",children:[tt.unidade.contrato&&h.jsxs("p",{className:"text-sm text-muted-foreground",children:[h.jsx("span",{className:"font-medium",children:"Contrato:"})," ",tt.unidade.contrato.codigo," - ",tt.unidade.contrato.nome]}),h.jsxs("p",{className:"text-sm text-muted-foreground",children:[h.jsx("span",{className:"font-medium",children:"Unidade:"})," ",tt.unidade.nome,"  ",tt.funcao]})]}),h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsxs("div",{className:"text-sm",children:[h.jsx("span",{className:"text-muted-foreground",children:"Efetivo atual: "}),h.jsx("span",{className:"font-medium text-red-500",children:tt.efetivo_atual})]}),h.jsxs("div",{className:"text-sm",children:[h.jsx("span",{className:"text-muted-foreground",children:"Efetivo necessrio: "}),h.jsx("span",{className:"font-medium",children:tt.efetivo_planejado})]}),h.jsxs(ai,{variant:"destructive",children:["Faltam ",tt.efetivo_planejado-tt.efetivo_atual," colaboradores"]})]})]})})})},tt.id)),I.length>0&&h.jsxs("div",{className:"mt-6 pt-6 border-t",children:[h.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[h.jsx(Ld,{className:"h-5 w-5 text-green-500"}),"Reservas Tcnicas Disponveis (",I.length,")"]}),h.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:I.map(tt=>h.jsx(kr,{className:"border-green-200",children:h.jsx(tn,{className:"p-3",children:h.jsxs("div",{children:[h.jsx("h4",{className:"font-semibold text-sm mb-1",children:tt.nome_completo}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(ai,{variant:"secondary",className:"text-xs",children:tt.cargo}),h.jsx(ai,{variant:"outline",className:"text-xs bg-green-50",children:"Disponvel"})]})]})})},tt.id))})]})]})})]}),h.jsxs(kr,{children:[h.jsxs(Mn,{children:[h.jsxs(Zn,{className:"flex items-center gap-2",children:[h.jsx(U7,{className:"h-5 w-5 text-orange-500"}),"Dias Vagos (",Pt.length,")"]}),h.jsx(Xa,{children:"Dias com ausncias programadas de colaboradores"})]}),h.jsx(tn,{children:i?h.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando..."}):Pt.length===0?h.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum dia vago encontrado"}):h.jsxs("div",{className:"space-y-3",children:[Pt.map(tt=>h.jsx(kr,{className:"border-orange-200",children:h.jsx(tn,{className:"p-4",children:h.jsx("div",{className:"flex items-start justify-between",children:h.jsxs("div",{className:"flex-1",children:[h.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[h.jsx("h4",{className:"font-semibold",children:Hs(new Date(tt.data),"dd 'de' MMMM 'de' yyyy",{locale:Fd})}),h.jsx(ai,{variant:"outline",children:tt.posto.codigo})]}),h.jsxs("div",{className:"space-y-1 mb-2",children:[tt.posto.unidade.contrato&&h.jsxs("p",{className:"text-sm text-muted-foreground",children:[h.jsx("span",{className:"font-medium",children:"Contrato:"})," ",tt.posto.unidade.contrato.codigo," - ",tt.posto.unidade.contrato.nome]}),h.jsxs("p",{className:"text-sm text-muted-foreground",children:[h.jsx("span",{className:"font-medium",children:"Unidade:"})," ",tt.posto.unidade.nome,"  ",tt.posto.nome]})]}),tt.colaborador?h.jsxs("div",{className:"space-y-1",children:[h.jsxs("div",{className:"text-sm",children:[h.jsx("span",{className:"text-muted-foreground",children:"Colaborador: "}),h.jsx("span",{className:"font-medium",children:tt.colaborador.nome_completo})]}),h.jsxs("div",{className:"text-sm",children:[h.jsx("span",{className:"text-muted-foreground",children:"Cargo: "}),h.jsx("span",{className:"font-medium",children:tt.colaborador.cargo})]})]}):h.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Sem colaborador atribudo"}),tt.motivo&&h.jsxs("div",{className:"mt-2 text-sm",children:[h.jsx("span",{className:"text-muted-foreground",children:"Motivo: "}),h.jsx(ai,{variant:"secondary",children:tt.motivo==="falta_justificada"?"Falta Justificada":tt.motivo==="falta_injustificada"?"Falta Injustificada":tt.motivo==="pedido"?"Pedido":tt.motivo==="afastamento_inss"?"Afastamento INSS":tt.motivo==="folga"?"Folga":tt.motivo==="ferias"?"Frias":tt.motivo==="suspensao"?"Suspenso":tt.motivo})]})]})})})},tt.id)),N.length>0&&h.jsxs("div",{className:"mt-6 pt-6 border-t",children:[h.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[h.jsx(Ld,{className:"h-5 w-5 text-blue-500"}),"Diaristas Disponveis (",N.length,")"]}),h.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:N.map(tt=>h.jsx(kr,{className:"border-blue-200",children:h.jsx(tn,{className:"p-3",children:h.jsxs("div",{children:[h.jsx("h4",{className:"font-semibold text-sm mb-2",children:tt.nome_completo}),h.jsxs("div",{className:"space-y-1",children:[h.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[h.jsx("span",{className:"text-muted-foreground",children:"Telefone:"}),h.jsx("span",{className:"font-medium",children:tt.telefone})]}),h.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[h.jsx("span",{className:"text-muted-foreground",children:"Cidade:"}),h.jsx("span",{className:"font-medium",children:tt.cidade||"No informada"})]})]}),h.jsx(ai,{variant:"outline",className:"text-xs bg-blue-50 mt-2",children:"Diarista"})]})})},tt.id))})]})]})})]})]})]})})}const Zle=()=>{const e=cu(),t=V.useRef(null),i=V.useRef(null),[c,f]=V.useState([]),[_,x]=V.useState(null),[o,I]=V.useState(!0),[P,N]=V.useState(""),[U,$]=V.useState(!1),[B,Y]=V.useState({}),H=V.useRef(!0);V.useEffect(()=>{re(),K();const be=Qe.channel("incidentes-changes").on("postgres_changes",{event:"*",schema:"public",table:"incidentes"},()=>{re()}).subscribe(),je=Qe.channel("chamados-changes").on("postgres_changes",{event:"*",schema:"public",table:"chamados"},()=>{re()}).subscribe(),Ye=Qe.channel("colaboradores-changes").on("postgres_changes",{event:"*",schema:"public",table:"colaboradores"},()=>{re()}).subscribe(),qe=Qe.channel("inspecoes-changes").on("postgres_changes",{event:"*",schema:"public",table:"inspecoes"},()=>{re()}).subscribe();return()=>{Qe.removeChannel(be),Qe.removeChannel(je),Qe.removeChannel(Ye),Qe.removeChannel(qe)}},[]);const K=async()=>{try{const{data:be,error:je}=await Qe.functions.invoke("get-mapbox-token");if(je)throw je;be!=null&&be.token?N(be.token):Hn({title:"Token do Mapbox no configurado",description:"Configure o token MAPBOX_PUBLIC_TOKEN nos secrets do projeto",variant:"destructive"})}catch(be){console.error("Erro ao buscar token do Mapbox:",be),Hn({title:"Erro ao carregar token do Mapbox",description:"Usando formulrio manual",variant:"destructive"})}};V.useEffect(()=>{P&&c.length>0&&t.current&&!i.current&&Ne()});const re=async()=>{try{const{data:be,error:je}=await Qe.from("unidades").select(`
          id,
          nome,
          codigo,
          latitude,
          longitude,
          cidade,
          uf,
          status,
          contrato_id,
          contratos (
            nome,
            sla_alvo_pct
          )
        `).eq("status","ativo").not("latitude","is",null).not("longitude","is",null);if(je)throw je;const Ye=await Promise.all((be||[]).map(async qe=>{var _t,mt;const We=await Ee(qe.id),$e=await G(qe.id);return{id:qe.id,nome:qe.nome,codigo:qe.codigo,latitude:Number(qe.latitude),longitude:Number(qe.longitude),cidade:qe.cidade||"",uf:qe.uf||"",contrato:{nome:((_t=qe.contratos)==null?void 0:_t.nome)||"Sem contrato",sla_alvo_pct:Number(((mt=qe.contratos)==null?void 0:mt.sla_alvo_pct)||95)},sla_atual:We,postos_total:$e.total,postos_preenchidos:$e.preenchidos,porcentagem_preenchimento:$e.porcentagem}}));f(Ye),await X((be||[]).map(qe=>qe.id))}catch(be){Hn({title:"Erro ao carregar unidades",description:be.message,variant:"destructive"})}finally{I(!1)}},G=async be=>{const{data:je}=await Qe.from("postos_servico").select("id, efetivo_planejado, escala").eq("unidade_id",be).eq("status","ativo");if(!je)return{total:0,preenchidos:0,porcentagem:0};const Ye=je.length;let qe=0;for(const $e of je){const{data:_t}=await Qe.from("colaboradores").select("id").eq("posto_servico_id",$e.id).eq("status","ativo"),mt=(_t==null?void 0:_t.length)||0,{estaCoberto:rt}=SP(mt,$e);rt&&(qe+=1)}const We=Ye>0?Math.round(qe/Ye*100):0;return{total:Ye,preenchidos:qe,porcentagem:We}},X=async be=>{var $e;if(be.length===0){Y({});return}const je=new Date(Date.now()-30*24*60*60*1e3).toISOString(),Ye=_t=>{const mt={};_t.forEach(rt=>{if(!rt.unidade_id||!be.includes(rt.unidade_id))return;const Tt=mt[rt.unidade_id]||{total30d:0,ultima:null};Tt.total30d+=1,(!Tt.ultima||rt.dia_inspecao&&rt.dia_inspecao>Tt.ultima)&&(Tt.ultima=rt.dia_inspecao),mt[rt.unidade_id]=Tt}),Y(mt)};if(H.current){const{data:_t,error:mt}=await Qe.from("inspecoes").select("unidade_id, dia_inspecao").in("unidade_id",be).gte("dia_inspecao",je);if(!mt){Ye(_t||[]);return}if(($e=mt.message)!=null&&$e.toLowerCase().includes("unidade_id"))H.current=!1;else{console.error("Erro ao carregar inspees:",mt),Y({});return}}const qe=await ue(je);if(!qe){Y({});return}const We=qe.map(_t=>({unidade_id:_t.unidade_id,dia_inspecao:_t.dia_inspecao}));Ye(We)},ue=async be=>{var mt,rt;const je=["posto_servico_id","posto_id"];let Ye=null;for(const Tt of je){const{data:Vt,error:it}=await Qe.from("inspecoes").select(`${Tt}, dia_inspecao`).not(Tt,"is",null).gte("dia_inspecao",be);if(!it){Ye=Vt.map(wr=>({postoId:wr[Tt],dia_inspecao:wr.dia_inspecao}));break}if(!(it.code==="42703"||((mt=it.message)==null?void 0:mt.toLowerCase().includes(Tt.toLowerCase()))||((rt=it.message)==null?void 0:rt.toLowerCase().includes(`inspecoes.${Tt.toLowerCase()}`))))return console.error("Erro ao carregar inspees (fallback):",it),null}if(!Ye||Ye.length===0)return[];const qe=Array.from(new Set(Ye.map(Tt=>Tt.postoId).filter(Boolean)));if(qe.length===0)return[];const{data:We,error:$e}=await Qe.from("postos_servico").select("id, unidade_id").in("id",qe);if($e)return console.error("Erro ao carregar postos (fallback):",$e),null;const _t=new Map((We||[]).filter(Tt=>Tt.id&&Tt.unidade_id).map(Tt=>[Tt.id,Tt.unidade_id]));return Ye.map(Tt=>({unidade_id:_t.get(Tt.postoId)??null,dia_inspecao:Tt.dia_inspecao}))},Ee=async be=>{const{data:je}=await Qe.from("ordens_servico").select("status").eq("unidade_id",be);if(!je||je.length===0)return 100;const Ye=je.filter(qe=>qe.status==="concluida").length;return Math.round(Ye/je.length*100)},xe=be=>be===100?"#22c55e":be>=70?"#eab308":"#ef4444",Ne=()=>{t.current&&(Nu.accessToken=P,i.current=new Nu.Map({container:t.current,style:"mapbox://styles/mapbox/light-v11",center:[-47.9292,-15.7801],zoom:4}),i.current.addControl(new Nu.NavigationControl,"top-right"),c.forEach(be=>{if(!i.current)return;const je=document.createElement("div");je.className="marker",je.style.backgroundColor=xe(be.porcentagem_preenchimento),je.style.width="24px",je.style.height="24px",je.style.borderRadius="50%",je.style.border="3px solid white",je.style.cursor="pointer",je.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)";const Ye=new Nu.Marker(je).setLngLat([be.longitude,be.latitude]).addTo(i.current);je.addEventListener("click",()=>{x(be)});const qe=new Nu.Popup({offset:25}).setHTML(`<div style="padding: 12px; min-width: 200px;">
          <h3 style="font-weight: bold; margin-bottom: 8px; font-size: 14px;">${be.nome}</h3>
          <p style="font-size: 12px; color: #666; margin-bottom: 8px;">${be.cidade}/${be.uf}</p>
          <div style="border-top: 1px solid #e5e7eb; padding-top: 8px;">
            <p style="font-size: 12px; margin-bottom: 4px;">Meta de SLA: <strong>${be.contrato.sla_alvo_pct}%</strong></p>
            <p style="font-size: 12px; margin-bottom: 4px;">Postos Preenchidos: <strong>${be.postos_preenchidos}/${be.postos_total}</strong></p>
            <p style="font-size: 12px;">Taxa de Ocupao: <strong style="color: ${be.porcentagem_preenchimento>=90?"#22c55e":be.porcentagem_preenchimento>=70?"#eab308":"#ef4444"};">${be.porcentagem_preenchimento}%</strong></p>
          </div>
        </div>`);Ye.setPopup(qe)}))},lt=be=>{be.preventDefault();const Ye=new FormData(be.currentTarget).get("token");Ye&&(N(Ye),Hn({title:"Token configurado",description:"Carregando mapa..."}))},Pt={total:c.length,slaVerde:c.filter(be=>be.sla_atual>=100).length,slaAmarelo:c.filter(be=>be.sla_atual>=90&&be.sla_atual<100).length,slaVermelho:c.filter(be=>be.sla_atual<90).length},tt=c.reduce((be,je)=>{const Ye=`${je.cidade}/${je.uf}`;return be[Ye]||(be[Ye]={cidade:je.cidade,uf:je.uf,postos_total:0,postos_preenchidos:0,unidades_count:0}),be[Ye].postos_total+=je.postos_total,be[Ye].postos_preenchidos+=je.postos_preenchidos,be[Ye].unidades_count+=1,be},{}),yt=Object.entries(tt).map(([be,je])=>({cidadeUf:be,...je,porcentagem_ocupacao:je.postos_total>0?Math.round(je.postos_preenchidos/je.postos_total*100):0})).sort((be,je)=>je.porcentagem_ocupacao-be.porcentagem_ocupacao),Me=_?B[_.id]:void 0;return o?h.jsx("div",{className:"flex items-center justify-center h-screen",children:h.jsxs("div",{className:"text-center",children:[h.jsx(ES,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),h.jsx("p",{className:"text-muted-foreground",children:"Carregando dados..."})]})}):P?h.jsxs($o,{children:[h.jsxs("div",{className:"h-screen flex flex-col",children:[h.jsx("div",{className:"border-b bg-background p-4",children:h.jsxs("div",{className:"container mx-auto",children:[h.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-3xl font-bold",children:"Mesa de Operaes 24/7"}),h.jsx("p",{className:"text-muted-foreground",children:"Monitoramento em tempo real de todas as unidades"})]}),h.jsxs(tr,{onClick:()=>$(!0),variant:"default",className:"gap-2",children:[h.jsx(rT,{className:"h-4 w-4"}),"Gesto de Cobertura"]})]}),h.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[h.jsx(kr,{children:h.jsx(tn,{className:"p-4",children:h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(Nf,{className:"h-4 w-4 text-primary"}),h.jsxs("div",{children:[h.jsx("p",{className:"text-2xl font-bold",children:Pt.total}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Unidades"})]})]})})}),h.jsx(kr,{className:"border-green-500/50",children:h.jsx(tn,{className:"p-4",children:h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(Ok,{className:"h-4 w-4 text-green-500"}),h.jsxs("div",{children:[h.jsx("p",{className:"text-2xl font-bold text-green-500",children:Pt.slaVerde}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"SLA 100%"})]})]})})}),h.jsx(kr,{className:"border-yellow-500/50",children:h.jsx(tn,{className:"p-4",children:h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(ES,{className:"h-4 w-4 text-yellow-500"}),h.jsxs("div",{children:[h.jsx("p",{className:"text-2xl font-bold text-yellow-500",children:Pt.slaAmarelo}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"SLA 90-99%"})]})]})})}),h.jsx(kr,{className:"border-red-500/50",children:h.jsx(tn,{className:"p-4",children:h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(V_,{className:"h-4 w-4 text-red-500"}),h.jsxs("div",{children:[h.jsx("p",{className:"text-2xl font-bold text-red-500",children:Pt.slaVermelho}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"SLA <90%"})]})]})})})]}),yt.length>0&&h.jsxs("div",{className:"mt-4",children:[h.jsx("h3",{className:"text-sm font-semibold mb-3 text-muted-foreground uppercase",children:"Ocupao por Regio"}),h.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-3",children:yt.map(be=>h.jsx(kr,{className:`transition-all hover:shadow-md ${be.porcentagem_ocupacao===100?"border-green-500/50":be.porcentagem_ocupacao>=70?"border-yellow-500/50":"border-red-500/50"}`,children:h.jsx(tn,{className:"p-4",children:h.jsxs("div",{className:"space-y-2",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(Nf,{className:"h-3 w-3 text-muted-foreground"}),h.jsx("p",{className:"text-sm font-semibold truncate",children:be.cidade})]}),h.jsxs("div",{children:[h.jsxs("p",{className:`text-2xl font-bold ${be.porcentagem_ocupacao===100?"text-green-500":be.porcentagem_ocupacao>=70?"text-yellow-500":"text-red-500"}`,children:[be.porcentagem_ocupacao,"%"]}),h.jsxs("p",{className:"text-xs text-muted-foreground",children:[be.postos_preenchidos,"/",be.postos_total," ","postos"]})]}),h.jsxs(ai,{variant:"outline",className:"text-xs",children:[be.unidades_count," ",be.unidades_count===1?"unidade":"unidades"]})]})})},be.cidadeUf))})]})]})}),h.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[h.jsx("div",{className:"flex-1 relative",children:h.jsx("div",{ref:t,className:"absolute inset-0"})}),_&&h.jsxs("div",{className:"w-96 border-l bg-background p-6 overflow-y-auto",children:[h.jsxs("div",{className:"flex items-start justify-between mb-4",children:[h.jsxs("div",{children:[h.jsx("h2",{className:"text-xl font-bold",children:_.nome}),h.jsx("p",{className:"text-sm text-muted-foreground",children:_.codigo})]}),h.jsx(tr,{variant:"ghost",size:"sm",onClick:()=>x(null),children:""})]}),h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium mb-1",children:"Localizao"}),h.jsxs("p",{className:"text-sm text-muted-foreground",children:[_.cidade,"/",_.uf]})]}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium mb-1",children:"Contrato"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:_.contrato.nome})]}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium mb-1",children:"Meta de SLA"}),h.jsxs("p",{className:"text-sm text-muted-foreground",children:[_.contrato.sla_alvo_pct,"%"]})]}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium mb-2",children:"Postos de Servio"}),h.jsxs("div",{className:"space-y-2",children:[h.jsxs("div",{className:"flex justify-between text-sm",children:[h.jsx("span",{className:"text-muted-foreground",children:"Preenchidos"}),h.jsxs("span",{className:"font-medium",children:[_.postos_preenchidos,"/",_.postos_total]})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("div",{className:"flex-1 bg-secondary rounded-full h-2",children:h.jsx("div",{className:"h-2 rounded-full transition-all",style:{width:`${_.porcentagem_preenchimento}%`,backgroundColor:_.porcentagem_preenchimento>=90?"#22c55e":_.porcentagem_preenchimento>=70?"#eab308":"#ef4444"}})}),h.jsxs(ai,{variant:_.porcentagem_preenchimento>=90?"default":_.porcentagem_preenchimento>=70?"secondary":"destructive",children:[_.porcentagem_preenchimento,"%"]})]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("p",{className:"text-sm font-medium flex items-center gap-2",children:[h.jsx(Mk,{className:"h-4 w-4 text-primary"}),"Inspees (30 dias)"]}),h.jsx(ai,{variant:"outline",children:(Me==null?void 0:Me.total30d)??0})]}),h.jsxs("div",{className:"bg-muted/40 rounded-lg p-3 space-y-2",children:[h.jsx("p",{className:"text-xs text-muted-foreground",children:Me!=null&&Me.ultima?`ltima em ${new Date(Me.ultima).toLocaleString("pt-BR")}`:"Sem inspees recentes"}),h.jsx(tr,{size:"sm",variant:"outline",className:"w-full",onClick:()=>e("/inspecao"),children:"Abrir painel de inspees"})]})]}),h.jsx(tr,{className:"w-full",onClick:()=>e("/contratos"),children:"Ver Detalhes Completos"})]})]})]})]}),h.jsx(Hle,{open:U,onClose:()=>$(!1)})]}):h.jsx($o,{children:h.jsx("div",{className:"container mx-auto p-6",children:h.jsxs(kr,{className:"max-w-md mx-auto mt-20",children:[h.jsx(Mn,{children:h.jsx(Zn,{children:"Carregando Mapa"})}),h.jsxs(tn,{children:[h.jsxs("div",{className:"text-center py-8",children:[h.jsx(ES,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando token do Mapbox..."})]}),h.jsxs("div",{className:"mt-6 border-t pt-6",children:[h.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Ou insira manualmente seu token pblico do Mapbox:"}),h.jsxs("form",{onSubmit:lt,className:"space-y-4",children:[h.jsx("input",{name:"token",type:"text",placeholder:"pk.eyJ1...",className:"w-full px-3 py-2 border rounded-md"}),h.jsx(tr,{type:"submit",className:"w-full",children:"Usar Token Manual"})]})]})]})]})})})};function Xle({os:e,open:t,onClose:i,onSuccess:c}){const[f,_]=V.useState(!1),[x,o]=V.useState({numero:"",titulo:"",descricao:"",tipo:"corretiva",prioridade:"media",status:"aberta",unidade_id:"",ativo_id:"",responsavel_id:"",data_prevista:"",observacoes:""}),{data:I}=vo({queryKey:["unidades"],queryFn:async()=>{const{data:B,error:Y}=await Qe.from("unidades").select("id, nome").eq("status","ativo").order("nome");if(Y)throw Y;return B}}),{data:P}=vo({queryKey:["usuarios"],queryFn:async()=>{const{data:B,error:Y}=await Qe.from("profiles").select("id, full_name").order("full_name");if(Y)throw Y;return B}}),{data:N}=vo({queryKey:["ativos"],queryFn:async()=>{const{data:B,error:Y}=await Qe.from("ativos").select("id, tag_patrimonio, categoria, modelo").eq("status","operacional").order("tag_patrimonio");if(Y)throw Y;return B}});V.useEffect(()=>{e?o({numero:e.numero||"",titulo:e.titulo||"",descricao:e.descricao||"",tipo:e.tipo||"corretiva",prioridade:e.prioridade||"media",status:e.status||"aberta",unidade_id:e.unidade_id||"",ativo_id:e.ativo_id||"",responsavel_id:e.responsavel_id||"",data_prevista:e.data_prevista||"",observacoes:e.observacoes||""}):U()},[e]);const U=async()=>{const{data:B}=await Qe.from("ordens_servico").select("numero").order("created_at",{ascending:!1}).limit(1);let Y="OS-0001";if(B&&B.length>0){const H=parseInt(B[0].numero.split("-")[1]);Y=`OS-${String(H+1).padStart(4,"0")}`}o(H=>({...H,numero:Y}))},$=async B=>{B.preventDefault(),_(!0);try{const{data:{user:Y}}=await Qe.auth.getUser();if(!Y)throw new Error("Usurio no autenticado");const H={...x,solicitante_id:(e==null?void 0:e.solicitante_id)||Y.id,data_prevista:x.data_prevista||null,responsavel_id:x.responsavel_id||null,ativo_id:x.ativo_id||null};if(e){const{error:K}=await Qe.from("ordens_servico").update(H).eq("id",e.id);if(K)throw K;mr.success("OS atualizada com sucesso")}else{const{error:K}=await Qe.from("ordens_servico").insert(H);if(K)throw K;mr.success("OS criada com sucesso")}c()}catch(Y){mr.error("Erro ao salvar OS: "+Y.message)}finally{_(!1)}};return h.jsx(fo,{open:t,onOpenChange:i,children:h.jsxs(Js,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[h.jsx(Qs,{children:h.jsx(eo,{children:e?"Editar Ordem de Servio":"Nova Ordem de Servio"})}),h.jsxs("form",{onSubmit:$,className:"space-y-4",children:[h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"numero",children:"Nmero *"}),h.jsx(_r,{id:"numero",value:x.numero,onChange:B=>o({...x,numero:B.target.value}),required:!0,disabled:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"tipo",children:"Tipo *"}),h.jsxs(un,{value:x.tipo,onValueChange:B=>o({...x,tipo:B}),children:[h.jsx(on,{children:h.jsx(dn,{})}),h.jsxs(an,{children:[h.jsx(kt,{value:"preventiva",children:"Preventiva"}),h.jsx(kt,{value:"corretiva",children:"Corretiva"}),h.jsx(kt,{value:"emergencial",children:"Emergencial"}),h.jsx(kt,{value:"melhoria",children:"Melhoria"})]})]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"titulo",children:"Ttulo *"}),h.jsx(_r,{id:"titulo",value:x.titulo,onChange:B=>o({...x,titulo:B.target.value}),required:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"descricao",children:"Descrio"}),h.jsx(Tl,{id:"descricao",value:x.descricao,onChange:B=>o({...x,descricao:B.target.value}),rows:3})]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"prioridade",children:"Prioridade *"}),h.jsxs(un,{value:x.prioridade,onValueChange:B=>o({...x,prioridade:B}),children:[h.jsx(on,{children:h.jsx(dn,{})}),h.jsxs(an,{children:[h.jsx(kt,{value:"baixa",children:"Baixa"}),h.jsx(kt,{value:"media",children:"Mdia"}),h.jsx(kt,{value:"alta",children:"Alta"}),h.jsx(kt,{value:"urgente",children:"Urgente"})]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"status",children:"Status *"}),h.jsxs(un,{value:x.status,onValueChange:B=>o({...x,status:B}),children:[h.jsx(on,{children:h.jsx(dn,{})}),h.jsxs(an,{children:[h.jsx(kt,{value:"aberta",children:"Aberta"}),h.jsx(kt,{value:"em_andamento",children:"Em Andamento"}),h.jsx(kt,{value:"concluida",children:"Concluda"}),h.jsx(kt,{value:"cancelada",children:"Cancelada"})]})]})]})]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"unidade_id",children:"Unidade"}),h.jsxs(un,{value:x.unidade_id,onValueChange:B=>o({...x,unidade_id:B}),children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Selecione..."})}),h.jsx(an,{children:I==null?void 0:I.map(B=>h.jsx(kt,{value:B.id,children:B.nome},B.id))})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"ativo_id",children:"Ativo"}),h.jsxs(un,{value:x.ativo_id,onValueChange:B=>o({...x,ativo_id:B}),children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Selecione..."})}),h.jsx(an,{children:N==null?void 0:N.map(B=>h.jsxs(kt,{value:B.id,children:[B.tag_patrimonio," - ",B.categoria," ",B.modelo]},B.id))})]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"responsavel_id",children:"Responsvel"}),h.jsxs(un,{value:x.responsavel_id,onValueChange:B=>o({...x,responsavel_id:B}),children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Selecione..."})}),h.jsx(an,{children:P==null?void 0:P.map(B=>h.jsx(kt,{value:B.id,children:B.full_name},B.id))})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"data_prevista",children:"Data Prevista"}),h.jsx(_r,{id:"data_prevista",type:"date",value:x.data_prevista,onChange:B=>o({...x,data_prevista:B.target.value})})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"observacoes",children:"Observaes"}),h.jsx(Tl,{id:"observacoes",value:x.observacoes,onChange:B=>o({...x,observacoes:B.target.value}),rows:3})]}),h.jsxs("div",{className:"flex justify-end gap-2",children:[h.jsx(tr,{type:"button",variant:"outline",onClick:i,children:"Cancelar"}),h.jsx(tr,{type:"submit",disabled:f,children:f?"Salvando...":e?"Atualizar":"Criar"})]})]})]})})}function Kle({osId:e}){const[t,i]=V.useState(!1),[c,f]=V.useState(null),_=V.useRef(null),{data:x,refetch:o}=vo({queryKey:["os-anexos",e],queryFn:async()=>{const{data:B,error:Y}=await Qe.from("os_anexos").select("*").eq("os_id",e).order("created_at",{ascending:!1});if(Y)throw Y;return await Promise.all((B||[]).map(async K=>{const{data:re}=await Qe.from("profiles").select("full_name").eq("id",K.uploaded_by).single();return{...K,uploader:re}}))}}),I=async B=>{var H;const Y=(H=B.target.files)==null?void 0:H[0];if(Y){i(!0);try{const{data:{user:K}}=await Qe.auth.getUser();if(!K)throw new Error("Usurio no autenticado");const re=Y.name.split(".").pop(),G=`${e}/${Date.now()}.${re}`,{error:X}=await Qe.storage.from("os-anexos").upload(G,Y);if(X)throw X;const{error:ue}=await Qe.from("os_anexos").insert({os_id:e,nome_arquivo:Y.name,caminho_storage:G,tamanho_bytes:Y.size,tipo_arquivo:Y.type,uploaded_by:K.id});if(ue)throw ue;mr.success("Arquivo enviado com sucesso"),o()}catch(K){mr.error("Erro ao enviar arquivo: "+K.message)}finally{i(!1),_.current&&(_.current.value="")}}},P=async B=>{try{const{data:Y,error:H}=await Qe.storage.from("os-anexos").download(B.caminho_storage);if(H)throw H;const K=URL.createObjectURL(Y),re=document.createElement("a");re.href=K,re.download=B.nome_arquivo,document.body.appendChild(re),re.click(),document.body.removeChild(re),URL.revokeObjectURL(K)}catch(Y){mr.error("Erro ao baixar arquivo: "+Y.message)}},N=async()=>{if(c)try{const B=x==null?void 0:x.find(K=>K.id===c);if(!B)return;const{error:Y}=await Qe.storage.from("os-anexos").remove([B.caminho_storage]);if(Y)throw Y;const{error:H}=await Qe.from("os_anexos").delete().eq("id",c);if(H)throw H;mr.success("Arquivo excludo com sucesso"),o()}catch(B){mr.error("Erro ao excluir arquivo: "+B.message)}finally{f(null)}},U=B=>B.startsWith("image/")?h.jsx(Z7,{className:"h-5 w-5"}):B.includes("pdf")?h.jsx(Gd,{className:"h-5 w-5"}):h.jsx(W7,{className:"h-5 w-5"}),$=B=>B<1024?B+" B":B<1024*1024?(B/1024).toFixed(1)+" KB":(B/(1024*1024)).toFixed(1)+" MB";return h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{children:[h.jsx("input",{ref:_,type:"file",onChange:I,className:"hidden"}),h.jsxs(tr,{onClick:()=>{var B;return(B=_.current)==null?void 0:B.click()},disabled:t,children:[h.jsx(oZ,{className:"mr-2 h-4 w-4"}),t?"Enviando...":"Adicionar Anexo"]})]}),x&&x.length>0?h.jsx("div",{className:"space-y-2",children:x.map(B=>{var Y;return h.jsx(kr,{children:h.jsx(tn,{className:"p-4",children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[U(B.tipo_arquivo||""),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsx("p",{className:"font-medium truncate",children:B.nome_arquivo}),h.jsxs("p",{className:"text-sm text-muted-foreground",children:[$(B.tamanho_bytes||0),"  ",(Y=B.uploader)==null?void 0:Y.full_name," "," ",new Date(B.created_at).toLocaleDateString("pt-BR")]})]})]}),h.jsxs("div",{className:"flex gap-1",children:[h.jsx(tr,{variant:"ghost",size:"icon",onClick:()=>P(B),children:h.jsx(G7,{className:"h-4 w-4"})}),h.jsx(tr,{variant:"ghost",size:"icon",onClick:()=>f(B.id),children:h.jsx(El,{className:"h-4 w-4 text-destructive"})})]})]})})},B.id)})}):h.jsx(kr,{children:h.jsx(tn,{className:"py-8 text-center text-muted-foreground",children:"Nenhum anexo adicionado"})}),h.jsx(Hu,{open:!!c,onOpenChange:()=>f(null),children:h.jsxs(ru,{children:[h.jsxs(nu,{children:[h.jsx(su,{children:"Confirmar excluso"}),h.jsx(ou,{children:"Tem certeza que deseja excluir este arquivo? Esta ao no pode ser desfeita."})]}),h.jsxs(iu,{children:[h.jsx(Zu,{children:"Cancelar"}),h.jsx(au,{onClick:N,className:"bg-destructive text-destructive-foreground",children:"Excluir"})]})]})})]})}function Yle({osId:e}){const{data:t,isLoading:i}=vo({queryKey:["os-historico",e],queryFn:async()=>{const{data:x,error:o}=await Qe.from("os_historico").select("*").eq("os_id",e).order("created_at",{ascending:!1});if(o)throw o;return await Promise.all((x||[]).map(async P=>{const{data:N}=await Qe.from("profiles").select("full_name").eq("id",P.usuario_id).single();return{...P,usuario:N}}))}}),c=x=>new Date(x).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),f=x=>{switch(x){case"criacao":return"Criao";case"atualizacao":return"Atualizao";case"exclusao":return"Excluso";default:return x}},_=x=>{switch(x){case"status":return"Status";case"responsavel_id":return"Responsvel";case"prioridade":return"Prioridade";case"tipo":return"Tipo";default:return x}};return i?h.jsx(kr,{children:h.jsx(tn,{className:"py-8 text-center text-muted-foreground",children:"Carregando histrico..."})}):!t||t.length===0?h.jsx(kr,{children:h.jsx(tn,{className:"py-8 text-center text-muted-foreground",children:"Nenhuma alterao registrada"})}):h.jsx("div",{className:"space-y-4",children:t.map((x,o)=>{var I;return h.jsx(kr,{children:h.jsx(tn,{className:"p-4",children:h.jsx("div",{className:"flex items-start gap-3",children:h.jsxs("div",{className:"flex-1 space-y-2",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(ai,{variant:"outline",children:f(x.acao)}),x.campo_alterado&&h.jsx("span",{className:"text-sm text-muted-foreground",children:_(x.campo_alterado)})]}),x.campo_alterado&&h.jsxs("div",{className:"text-sm space-y-1",children:[x.valor_anterior&&h.jsxs("div",{children:[h.jsx("span",{className:"text-muted-foreground",children:"De: "}),h.jsx("span",{className:"line-through",children:x.valor_anterior})]}),x.valor_novo&&h.jsxs("div",{children:[h.jsx("span",{className:"text-muted-foreground",children:"Para: "}),h.jsx("span",{className:"font-medium",children:x.valor_novo})]})]}),x.observacao&&h.jsx("p",{className:"text-sm text-muted-foreground",children:x.observacao}),h.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground pt-2",children:[h.jsxs("div",{className:"flex items-center gap-1",children:[h.jsx(W0,{className:"h-3 w-3"}),h.jsx("span",{children:((I=x.usuario)==null?void 0:I.full_name)||"Sistema"})]}),h.jsxs("div",{className:"flex items-center gap-1",children:[h.jsx(vb,{className:"h-3 w-3"}),h.jsx("span",{children:c(x.created_at)})]})]})]})})})},x.id)})})}function Jle({os:e,open:t,onClose:i}){var _,x,o;const c=I=>new Date(I).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}),f=I=>new Date(I).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return h.jsx(fo,{open:t,onOpenChange:i,children:h.jsxs(Js,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[h.jsx(Qs,{children:h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs(eo,{children:["Ordem de Servio ",e.numero]}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx(ai,{children:e.tipo}),h.jsx(ai,{children:e.prioridade}),h.jsx(ai,{children:e.status.replace("_"," ")})]})]})}),h.jsxs(n$,{defaultValue:"detalhes",className:"w-full",children:[h.jsxs(jj,{className:"grid w-full grid-cols-3",children:[h.jsxs(vf,{value:"detalhes",children:[h.jsx(Gd,{className:"h-4 w-4 mr-2"}),"Detalhes"]}),h.jsxs(vf,{value:"anexos",children:[h.jsx(g4,{className:"h-4 w-4 mr-2"}),"Anexos"]}),h.jsxs(vf,{value:"historico",children:[h.jsx(m4,{className:"h-4 w-4 mr-2"}),"Histrico"]})]}),h.jsx(xf,{value:"detalhes",className:"space-y-4",children:h.jsxs(kr,{children:[h.jsx(Mn,{children:h.jsx(Zn,{className:"text-lg",children:"Informaes Gerais"})}),h.jsxs(tn,{className:"space-y-4",children:[h.jsxs("div",{children:[h.jsx("h4",{className:"font-semibold mb-1",children:e.titulo}),e.descricao&&h.jsx("p",{className:"text-sm text-muted-foreground",children:e.descricao})]}),h.jsx(ib,{}),h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[((_=e.unidade)==null?void 0:_.nome)&&h.jsxs("div",{className:"flex items-start gap-2",children:[h.jsx(Nf,{className:"h-4 w-4 text-muted-foreground mt-1"}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium",children:"Unidade"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:e.unidade.nome})]})]}),((x=e.responsavel)==null?void 0:x.full_name)&&h.jsxs("div",{className:"flex items-start gap-2",children:[h.jsx(W0,{className:"h-4 w-4 text-muted-foreground mt-1"}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium",children:"Responsvel"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:e.responsavel.full_name})]})]}),((o=e.solicitante)==null?void 0:o.full_name)&&h.jsxs("div",{className:"flex items-start gap-2",children:[h.jsx(W0,{className:"h-4 w-4 text-muted-foreground mt-1"}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium",children:"Solicitante"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:e.solicitante.full_name})]})]}),e.data_abertura&&h.jsxs("div",{className:"flex items-start gap-2",children:[h.jsx(vb,{className:"h-4 w-4 text-muted-foreground mt-1"}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium",children:"Data de Abertura"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:f(e.data_abertura)})]})]}),e.data_prevista&&h.jsxs("div",{className:"flex items-start gap-2",children:[h.jsx($u,{className:"h-4 w-4 text-muted-foreground mt-1"}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium",children:"Data Prevista"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:c(e.data_prevista)})]})]}),e.data_conclusao&&h.jsxs("div",{className:"flex items-start gap-2",children:[h.jsx($u,{className:"h-4 w-4 text-muted-foreground mt-1"}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium",children:"Data de Concluso"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:f(e.data_conclusao)})]})]})]}),e.observacoes&&h.jsxs(h.Fragment,{children:[h.jsx(ib,{}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium mb-1",children:"Observaes"}),h.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:e.observacoes})]})]})]})]})}),h.jsx(xf,{value:"anexos",children:h.jsx(Kle,{osId:e.id})}),h.jsx(xf,{value:"historico",children:h.jsx(Yle,{osId:e.id})})]})]})})}function Qle({os:e,onEdit:t,onDelete:i,onConcluir:c}){var Y,H;const[f,_]=V.useState(!1),[x,o]=V.useState(!1),[I,P]=V.useState(!1),N=K=>{switch(K){case"aberta":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100";case"em_andamento":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100";case"concluida":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100";case"cancelada":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-100"}},U=K=>{switch(K){case"baixa":return"bg-gray-100 text-gray-800";case"media":return"bg-blue-100 text-blue-800";case"alta":return"bg-orange-100 text-orange-800";case"urgente":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},$=K=>{switch(K){case"preventiva":return"bg-green-100 text-green-800";case"corretiva":return"bg-yellow-100 text-yellow-800";case"emergencial":return"bg-red-100 text-red-800";case"melhoria":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},B=K=>new Date(K).toLocaleDateString("pt-BR");return h.jsxs(h.Fragment,{children:[h.jsxs(kr,{className:"hover:shadow-md transition-shadow",children:[h.jsx(Mn,{className:"pb-3",children:h.jsxs("div",{className:"flex items-start justify-between",children:[h.jsxs("div",{className:"space-y-1 flex-1",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("span",{className:"font-mono text-sm text-muted-foreground",children:e.numero}),h.jsx(ai,{className:$(e.tipo),children:e.tipo}),h.jsx(ai,{className:U(e.prioridade),children:e.prioridade}),h.jsx(ai,{className:N(e.status),children:e.status.replace("_"," ")})]}),h.jsx("h3",{className:"text-lg font-semibold",children:e.titulo})]}),h.jsxs("div",{className:"flex gap-1",children:[h.jsx(tr,{variant:"ghost",size:"icon",onClick:()=>_(!0),children:h.jsx(Dk,{className:"h-4 w-4"})}),e.status!=="concluida"&&h.jsxs(h.Fragment,{children:[h.jsx(tr,{variant:"ghost",size:"icon",onClick:()=>P(!0),className:"text-green-600 hover:text-green-700 hover:bg-green-50",children:h.jsx(yb,{className:"h-4 w-4"})}),h.jsx(tr,{variant:"ghost",size:"icon",onClick:()=>t(e),children:h.jsx(eZ,{className:"h-4 w-4"})})]}),h.jsx(tr,{variant:"ghost",size:"icon",onClick:()=>o(!0),children:h.jsx(El,{className:"h-4 w-4 text-destructive"})})]})]})}),h.jsxs(tn,{children:[e.descricao&&h.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:e.descricao}),h.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[((Y=e.unidade)==null?void 0:Y.nome)&&h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(Nf,{className:"h-4 w-4 text-muted-foreground"}),h.jsx("span",{className:"truncate",children:e.unidade.nome})]}),((H=e.responsavel)==null?void 0:H.full_name)&&h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(W0,{className:"h-4 w-4 text-muted-foreground"}),h.jsx("span",{className:"truncate",children:e.responsavel.full_name})]}),e.data_abertura&&h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(vb,{className:"h-4 w-4 text-muted-foreground"}),h.jsx("span",{children:B(e.data_abertura)})]}),e.data_prevista&&h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx($u,{className:"h-4 w-4 text-muted-foreground"}),h.jsx("span",{children:B(e.data_prevista)})]})]})]})]}),f&&h.jsx(Jle,{os:e,open:f,onClose:()=>_(!1)}),h.jsx(Hu,{open:x,onOpenChange:o,children:h.jsxs(ru,{children:[h.jsxs(nu,{children:[h.jsx(su,{children:"Confirmar excluso"}),h.jsxs(ou,{children:["Tem certeza que deseja excluir a OS ",e.numero,"? Esta ao no pode ser desfeita."]})]}),h.jsxs(iu,{children:[h.jsx(Zu,{children:"Cancelar"}),h.jsx(au,{onClick:()=>i(e.id),className:"bg-destructive text-destructive-foreground",children:"Excluir"})]})]})}),h.jsx(Hu,{open:I,onOpenChange:P,children:h.jsxs(ru,{children:[h.jsxs(nu,{children:[h.jsx(su,{children:"Concluir Ordem de Servio"}),h.jsxs(ou,{children:["Tem certeza que deseja concluir a OS ",e.numero,"? Esta ao marcar a ordem como concluda."]})]}),h.jsxs(iu,{children:[h.jsx(Zu,{children:"Cancelar"}),h.jsx(au,{onClick:()=>c(e.id),className:"bg-green-600 hover:bg-green-700",children:"Concluir"})]})]})})]})}function ece(){const[e,t]=V.useState(""),[i,c]=V.useState("ativas"),[f,_]=V.useState("all"),[x,o]=V.useState("all"),[I,P]=V.useState(!1),[N,U]=V.useState(null),{data:$,isLoading:B,refetch:Y}=vo({queryKey:["ordens-servico",i,f,x],queryFn:async()=>{let ue=Qe.from("ordens_servico").select(`
          *,
          unidade:unidades(nome),
          solicitante:profiles!ordens_servico_solicitante_id_fkey(full_name),
          responsavel:profiles!ordens_servico_responsavel_id_fkey(full_name)
        `).order("created_at",{ascending:!1});i==="ativas"?ue=ue.neq("status","concluida"):i!=="all"&&(ue=ue.eq("status",i)),f!=="all"&&(ue=ue.eq("prioridade",f)),x!=="all"&&(ue=ue.eq("tipo",x));const{data:Ee,error:xe}=await ue;if(xe)throw xe;return Ee}}),H=$==null?void 0:$.filter(ue=>{var Ee;return ue.numero.toLowerCase().includes(e.toLowerCase())||ue.titulo.toLowerCase().includes(e.toLowerCase())||((Ee=ue.descricao)==null?void 0:Ee.toLowerCase().includes(e.toLowerCase()))}),K={total:($==null?void 0:$.length)||0,abertas:($==null?void 0:$.filter(ue=>ue.status==="aberta").length)||0,emAndamento:($==null?void 0:$.filter(ue=>ue.status==="em_andamento").length)||0,concluidas:($==null?void 0:$.filter(ue=>ue.status==="concluida").length)||0},re=ue=>{U(ue),P(!0)},G=async ue=>{try{const{error:Ee}=await Qe.from("ordens_servico").delete().eq("id",ue);if(Ee)throw Ee;mr.success("OS excluda com sucesso"),Y()}catch(Ee){mr.error("Erro ao excluir OS: "+Ee.message)}},X=async ue=>{try{const{error:Ee}=await Qe.from("ordens_servico").update({status:"concluida",data_conclusao:new Date().toISOString()}).eq("id",ue);if(Ee)throw Ee;mr.success("OS concluda com sucesso"),Y()}catch(Ee){mr.error("Erro ao concluir OS: "+Ee.message)}};return h.jsx($o,{children:h.jsx("div",{className:"min-h-screen bg-background p-8",children:h.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-4xl font-bold text-foreground",children:"Ordens de Servio"}),h.jsx("p",{className:"text-muted-foreground mt-2",children:"Gesto completa de ordens de servio preventivas, corretivas e emergenciais"})]}),h.jsxs(tr,{onClick:()=>{U(null),P(!0)},children:[h.jsx(oa,{className:"mr-2 h-4 w-4"}),"Nova OS"]})]}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[h.jsxs(kr,{children:[h.jsxs(Mn,{className:"pb-2",children:[h.jsx(Xa,{children:"Total de OS"}),h.jsx(Zn,{className:"text-3xl",children:K.total})]}),h.jsx(tn,{children:h.jsx(Gd,{className:"h-4 w-4 text-muted-foreground"})})]}),h.jsxs(kr,{children:[h.jsxs(Mn,{className:"pb-2",children:[h.jsx(Xa,{children:"Abertas"}),h.jsx(Zn,{className:"text-3xl text-yellow-600",children:K.abertas})]}),h.jsx(tn,{children:h.jsx(rT,{className:"h-4 w-4 text-yellow-600"})})]}),h.jsxs(kr,{children:[h.jsxs(Mn,{className:"pb-2",children:[h.jsx(Xa,{children:"Em Andamento"}),h.jsx(Zn,{className:"text-3xl text-blue-600",children:K.emAndamento})]}),h.jsx(tn,{children:h.jsx(rT,{className:"h-4 w-4 text-blue-600"})})]}),h.jsxs(kr,{children:[h.jsxs(Mn,{className:"pb-2",children:[h.jsx(Xa,{children:"Concludas"}),h.jsx(Zn,{className:"text-3xl text-green-600",children:K.concluidas})]}),h.jsx(tn,{children:h.jsx(yb,{className:"h-4 w-4 text-green-600"})})]})]}),h.jsx(kr,{children:h.jsx(tn,{className:"pt-6",children:h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[h.jsxs("div",{className:"relative",children:[h.jsx(Xc,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),h.jsx(_r,{placeholder:"Buscar por nmero, ttulo...",value:e,onChange:ue=>t(ue.target.value),className:"pl-9"})]}),h.jsxs(un,{value:i,onValueChange:c,children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Status"})}),h.jsxs(an,{children:[h.jsx(kt,{value:"ativas",children:"Ativas (Abertas e Em Andamento)"}),h.jsx(kt,{value:"all",children:"Todos os Status"}),h.jsx(kt,{value:"aberta",children:"Aberta"}),h.jsx(kt,{value:"em_andamento",children:"Em Andamento"}),h.jsx(kt,{value:"concluida",children:"Concluda"}),h.jsx(kt,{value:"cancelada",children:"Cancelada"})]})]}),h.jsxs(un,{value:f,onValueChange:_,children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Prioridade"})}),h.jsxs(an,{children:[h.jsx(kt,{value:"all",children:"Todas as Prioridades"}),h.jsx(kt,{value:"baixa",children:"Baixa"}),h.jsx(kt,{value:"media",children:"Mdia"}),h.jsx(kt,{value:"alta",children:"Alta"}),h.jsx(kt,{value:"urgente",children:"Urgente"})]})]}),h.jsxs(un,{value:x,onValueChange:o,children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Tipo"})}),h.jsxs(an,{children:[h.jsx(kt,{value:"all",children:"Todos os Tipos"}),h.jsx(kt,{value:"preventiva",children:"Preventiva"}),h.jsx(kt,{value:"corretiva",children:"Corretiva"}),h.jsx(kt,{value:"emergencial",children:"Emergencial"}),h.jsx(kt,{value:"melhoria",children:"Melhoria"})]})]})]})})}),h.jsx("div",{className:"space-y-4",children:B?h.jsx("div",{className:"text-center py-12",children:h.jsx("p",{className:"text-muted-foreground",children:"Carregando ordens de servio..."})}):H&&H.length>0?h.jsx("div",{className:"grid gap-4",children:H.map(ue=>h.jsx(Qle,{os:ue,onEdit:re,onDelete:G,onConcluir:X},ue.id))}):h.jsx(kr,{children:h.jsxs(tn,{className:"py-12 text-center",children:[h.jsx(Gd,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),h.jsx("p",{className:"text-muted-foreground",children:"Nenhuma ordem de servio encontrada"}),h.jsxs(tr,{onClick:()=>P(!0),className:"mt-4",children:[h.jsx(oa,{className:"mr-2 h-4 w-4"}),"Criar primeira OS"]})]})})}),I&&h.jsx(Xle,{os:N,open:I,onClose:()=>{P(!1),U(null)},onSuccess:()=>{P(!1),U(null),Y()}})]})})})}function tce({colaborador:e,open:t,onClose:i,onSuccess:c}){const[f,_]=V.useState(!1),[x,o]=V.useState({nome_completo:"",cpf:"",telefone:"",email:"",data_admissao:"",data_desligamento:"",cargo:"",status:"ativo",observacoes:""});V.useEffect(()=>{e&&o({nome_completo:e.nome_completo||"",cpf:e.cpf||"",telefone:e.telefone||"",email:e.email||"",data_admissao:e.data_admissao||"",data_desligamento:e.data_desligamento||"",cargo:e.cargo||"",status:e.status||"ativo",observacoes:e.observacoes||""})},[e]);const I=async P=>{P.preventDefault(),_(!0);try{const N={...x,cargo:x.cargo||null,data_desligamento:x.data_desligamento||null};if(e){const{error:U}=await Qe.from("colaboradores").update(N).eq("id",e.id);if(U)throw U;mr.success("Colaborador atualizado com sucesso")}else{const{error:U}=await Qe.from("colaboradores").insert(N);if(U)throw U;mr.success("Colaborador cadastrado com sucesso")}c()}catch(N){mr.error("Erro ao salvar colaborador: "+N.message)}finally{_(!1)}};return h.jsx(fo,{open:t,onOpenChange:i,children:h.jsxs(Js,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[h.jsx(Qs,{children:h.jsx(eo,{children:e?"Editar Colaborador":"Novo Colaborador"})}),h.jsxs("form",{onSubmit:I,className:"space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"nome_completo",children:"Nome Completo *"}),h.jsx(_r,{id:"nome_completo",value:x.nome_completo,onChange:P=>o({...x,nome_completo:P.target.value}),required:!0})]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"cpf",children:"CPF *"}),h.jsx(_r,{id:"cpf",value:x.cpf,onChange:P=>o({...x,cpf:P.target.value}),placeholder:"000.000.000-00",required:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"telefone",children:"Telefone"}),h.jsx(_r,{id:"telefone",value:x.telefone,onChange:P=>o({...x,telefone:P.target.value}),placeholder:"(00) 00000-0000"})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"email",children:"Email"}),h.jsx(_r,{id:"email",type:"email",value:x.email,onChange:P=>o({...x,email:P.target.value})})]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"data_admissao",children:"Data de Admisso"}),h.jsx(_r,{id:"data_admissao",type:"date",value:x.data_admissao,onChange:P=>o({...x,data_admissao:P.target.value})})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"status",children:"Status *"}),h.jsxs(un,{value:x.status,onValueChange:P=>o({...x,status:P}),children:[h.jsx(on,{children:h.jsx(dn,{})}),h.jsxs(an,{children:[h.jsx(kt,{value:"ativo",children:"Ativo"}),h.jsx(kt,{value:"inativo",children:"Inativo"}),h.jsx(kt,{value:"ferias",children:"Frias"}),h.jsx(kt,{value:"afastado",children:"Afastado"})]})]})]})]}),x.status==="inativo"&&h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"data_desligamento",children:"Data de Desligamento"}),h.jsx(_r,{id:"data_desligamento",type:"date",value:x.data_desligamento,onChange:P=>o({...x,data_desligamento:P.target.value})})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"cargo",children:"Cargo"}),h.jsx(_r,{id:"cargo",value:x.cargo,onChange:P=>o({...x,cargo:P.target.value}),placeholder:"Ex: Vigilante, Supervisor, etc."})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"observacoes",children:"Observaes"}),h.jsx(Tl,{id:"observacoes",value:x.observacoes,onChange:P=>o({...x,observacoes:P.target.value}),rows:3})]}),h.jsxs("div",{className:"flex justify-end gap-2",children:[h.jsx(tr,{type:"button",variant:"outline",onClick:i,children:"Cancelar"}),h.jsx(tr,{type:"submit",disabled:f,children:f?"Salvando...":e?"Atualizar":"Cadastrar"})]})]})]})})}function rce({colaborador:e,open:t,onClose:i,onSuccess:c}){const[f,_]=V.useState(!1),[x,o]=V.useState({data:new Date().toISOString().split("T")[0],tipo:"presente",horario_entrada:"",horario_saida:"",observacao:""}),I=async P=>{P.preventDefault(),_(!0);try{const{data:{user:N}}=await Qe.auth.getUser();if(!N)throw new Error("Usurio no autenticado");const U={colaborador_id:e.id,data:x.data,tipo:x.tipo,horario_entrada:x.horario_entrada?new Date(`${x.data}T${x.horario_entrada}`).toISOString():null,horario_saida:x.horario_saida?new Date(`${x.data}T${x.horario_saida}`).toISOString():null,observacao:x.observacao||null,registrado_por:N.id},{error:$}=await Qe.from("presencas").insert(U);if($)throw $;mr.success("Presena registrada com sucesso"),c()}catch(N){N.message.includes("duplicate key")?mr.error("J existe um registro de presena para este colaborador nesta data"):mr.error("Erro ao registrar presena: "+N.message)}finally{_(!1)}};return h.jsx(fo,{open:t,onOpenChange:i,children:h.jsxs(Js,{className:"max-w-md",children:[h.jsxs(Qs,{children:[h.jsx(eo,{children:"Registrar Presena"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:e.nome_completo})]}),h.jsxs("form",{onSubmit:I,className:"space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"data",children:"Data *"}),h.jsx(_r,{id:"data",type:"date",value:x.data,onChange:P=>o({...x,data:P.target.value}),required:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"tipo",children:"Tipo *"}),h.jsxs(un,{value:x.tipo,onValueChange:P=>o({...x,tipo:P}),children:[h.jsx(on,{children:h.jsx(dn,{})}),h.jsxs(an,{children:[h.jsx(kt,{value:"presente",children:"Presente"}),h.jsx(kt,{value:"falta",children:"Falta"}),h.jsx(kt,{value:"falta_justificada",children:"Falta Justificada"}),h.jsx(kt,{value:"ferias",children:"Frias"}),h.jsx(kt,{value:"atestado",children:"Atestado"}),h.jsx(kt,{value:"folga",children:"Folga"})]})]})]}),x.tipo==="presente"&&h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"horario_entrada",children:"Horrio Entrada"}),h.jsx(_r,{id:"horario_entrada",type:"time",value:x.horario_entrada,onChange:P=>o({...x,horario_entrada:P.target.value})})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"horario_saida",children:"Horrio Sada"}),h.jsx(_r,{id:"horario_saida",type:"time",value:x.horario_saida,onChange:P=>o({...x,horario_saida:P.target.value})})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"observacao",children:"Observao"}),h.jsx(Tl,{id:"observacao",value:x.observacao,onChange:P=>o({...x,observacao:P.target.value}),rows:3,placeholder:"Informaes adicionais..."})]}),h.jsxs("div",{className:"flex justify-end gap-2",children:[h.jsx(tr,{type:"button",variant:"outline",onClick:i,children:"Cancelar"}),h.jsx(tr,{type:"submit",disabled:f,children:f?"Registrando...":"Registrar"})]})]})]})})}function nce({open:e,onClose:t,missingEntities:i}){return h.jsx(Hu,{open:e,onOpenChange:t,children:h.jsxs(ru,{children:[h.jsxs(nu,{children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(vm,{className:"h-5 w-5 text-destructive"}),h.jsx(su,{children:"Requisitos No Atendidos"})]}),h.jsxs(ou,{className:"space-y-3",children:[h.jsx("p",{children:"Para cadastrar um colaborador,  necessrio ter pelo menos uma instncia cadastrada de cada uma das seguintes entidades:"}),h.jsxs("div",{className:"bg-muted p-3 rounded-md",children:[h.jsx("p",{className:"font-medium mb-2",children:"Entidades faltantes:"}),h.jsx("ul",{className:"list-disc list-inside space-y-1",children:i.map(c=>h.jsx("li",{className:"text-sm",children:c},c))})]}),h.jsx("p",{className:"text-sm",children:"Por favor, cadastre as entidades necessrias antes de adicionar colaboradores."})]})]}),h.jsx(iu,{children:h.jsx(au,{onClick:t,children:"Entendi"})})]})})}function ice({colaborador:e,open:t,onClose:i,onSuccess:c}){const[f,_]=V.useState(!1),[x,o]=V.useState((e==null?void 0:e.escala_id)||""),{data:I,isLoading:P}=vo({queryKey:["escalas"],queryFn:async()=>{const{data:U,error:$}=await Qe.from("escalas").select("id, nome, tipo, descricao").order("nome");if($)throw $;return U}}),N=async U=>{if(U.preventDefault(),!x){mr.error("Selecione uma escala");return}_(!0);try{const{error:$}=await Qe.from("colaboradores").update({escala_id:x}).eq("id",e.id);if($)throw $;mr.success("Escala atribuda com sucesso"),c()}catch($){mr.error("Erro ao atribuir escala: "+$.message)}finally{_(!1)}};return h.jsx(fo,{open:t,onOpenChange:i,children:h.jsxs(Js,{className:"max-w-md",children:[h.jsxs(Qs,{children:[h.jsxs(eo,{className:"flex items-center gap-2",children:[h.jsx($u,{className:"h-5 w-5"}),"Atribuir Escala"]}),h.jsxs(Yu,{children:["Atribuir escala ao colaborador ",h.jsx("strong",{children:e==null?void 0:e.nome_completo})]})]}),P?h.jsx("div",{className:"text-center py-8",children:h.jsx("p",{className:"text-muted-foreground",children:"Carregando escalas..."})}):!I||I.length===0?h.jsxs("div",{className:"text-center py-8 space-y-4",children:[h.jsx("p",{className:"text-muted-foreground",children:"Nenhuma escala cadastrada. Crie uma escala primeiro no mdulo de Escalas."}),h.jsx(tr,{variant:"outline",onClick:i,children:"Fechar"})]}):h.jsxs("form",{onSubmit:N,className:"space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"escala",children:"Escala *"}),h.jsxs(un,{value:x,onValueChange:o,children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Selecione uma escala..."})}),h.jsx(an,{children:I.map(U=>h.jsxs(kt,{value:U.id,children:[U.nome," - ",U.tipo,U.descricao&&` (${U.descricao})`]},U.id))})]})]}),h.jsxs("div",{className:"flex justify-end gap-2",children:[h.jsx(tr,{type:"button",variant:"outline",onClick:i,children:"Cancelar"}),h.jsx(tr,{type:"submit",disabled:f,children:f?"Atribuindo...":"Atribuir Escala"})]})]})]})})}function sce({colaborador:e,open:t,onClose:i,onSuccess:c}){const[f,_]=V.useState(!1),[x,o]=V.useState((e==null?void 0:e.unidade_id)||""),[I,P]=V.useState((e==null?void 0:e.posto_servico_id)||""),{data:N,isLoading:U}=vo({queryKey:["unidades-ativas"],queryFn:async()=>{const{data:Y,error:H}=await Qe.from("unidades").select("id, nome, codigo").eq("status","ativo").order("nome");if(H)throw H;return Y}}),{data:$}=vo({queryKey:["postos-unidade",x],queryFn:async()=>{if(!x)return[];const{data:Y,error:H}=await Qe.from("postos_servico").select("id, nome, codigo").eq("unidade_id",x).eq("status","ativo").order("nome");if(H)throw H;return Y},enabled:!!x}),B=async Y=>{if(Y.preventDefault(),!x){mr.error("Selecione uma unidade");return}_(!0);try{const{error:H}=await Qe.from("colaboradores").update({unidade_id:x,posto_servico_id:I||null}).eq("id",e.id);if(H)throw H;mr.success("Unidade atribuda com sucesso"),c(),i()}catch(H){mr.error("Erro ao atribuir unidade: "+H.message)}finally{_(!1)}};return h.jsx(fo,{open:t,onOpenChange:i,children:h.jsxs(Js,{children:[h.jsx(Qs,{children:h.jsxs(eo,{children:["Atribuir Unidade - ",e==null?void 0:e.nome_completo]})}),h.jsxs("form",{onSubmit:B,className:"space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"unidade",children:"Unidade *"}),U?h.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando unidades..."}):!N||N.length===0?h.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhuma unidade ativa encontrada. Cadastre unidades primeiro."}):h.jsxs(un,{value:x,onValueChange:Y=>{o(Y),P("")},children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Selecione uma unidade..."})}),h.jsx(an,{children:N.map(Y=>h.jsxs(kt,{value:Y.id,children:[Y.codigo," - ",Y.nome]},Y.id))})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"posto",children:"Posto de Servio (Opcional)"}),h.jsxs(un,{value:I,onValueChange:P,disabled:!x,children:[h.jsx(on,{children:h.jsx(dn,{placeholder:x?"Selecione um posto...":"Selecione uma unidade primeiro..."})}),h.jsx(an,{children:$==null?void 0:$.map(Y=>h.jsxs(kt,{value:Y.id,children:[Y.codigo," - ",Y.nome]},Y.id))})]})]}),h.jsxs("div",{className:"flex justify-end gap-2",children:[h.jsx(tr,{type:"button",variant:"outline",onClick:i,children:"Cancelar"}),h.jsx(tr,{type:"submit",disabled:f||!x,children:f?"Atribuindo...":"Atribuir"})]})]})]})})}function oce({colaborador:e,open:t,onClose:i}){var G;const[c,f]=V.useState(new Date),[_,x]=V.useState([]),[o,I]=V.useState(!1),[P,N]=V.useState(null);V.useEffect(()=>{t&&(f(new Date),N(null))},[t,e==null?void 0:e.id]),V.useEffect(()=>{if(!t||!(e!=null&&e.id))return;(async()=>{try{I(!0);const ue=Sa(c),Ee=ob(c),{data:xe,error:Ne}=await Qe.from("presencas").select("*").eq("colaborador_id",e.id).gte("data",Hs(ue,"yyyy-MM-dd")).lte("data",Hs(Ee,"yyyy-MM-dd")).order("data",{ascending:!0});if(Ne)throw Ne;x(xe||[])}catch(ue){console.error("Erro ao carregar presenas:",ue)}finally{I(!1)}})()},[t,e==null?void 0:e.id,c]);const U=V.useMemo(()=>{const X=Sa(c),ue=ob(c),Ee=tu(X,{weekStartsOn:0}),xe=v2(ue,{weekStartsOn:0});return tse({start:Ee,end:xe})},[c]),$=V.useMemo(()=>{const X=new Map;return _.forEach(ue=>{X.set(ue.data,ue)}),X},[_]),B=["Dom","Seg","Ter","Qua","Qui","Sex","Sb"],Y=(X,ue)=>{if(!X)return yr("border border-dashed bg-muted/30",ue?"text-muted-foreground":"text-muted-foreground/50 opacity-60");const Ee=ue?"":"opacity-60";return yr(X==="presente"?"border border-emerald-200 bg-emerald-50 text-emerald-700":X==="falta"||X==="falta_justificada"?"border border-red-200 bg-red-50 text-red-700":X==="folga"?"border border-slate-200 bg-slate-50 text-slate-700":X==="ferias"?"border border-amber-200 bg-amber-50 text-amber-700":X==="atestado"?"border border-sky-200 bg-sky-50 text-sky-700":"border bg-muted/40 text-muted-foreground",Ee)},H=(X,ue)=>{ue&&(ue.tipo==="falta"||ue.tipo==="falta_justificada")&&N({date:Hs(new Date(X),"dd 'de' MMMM",{locale:Fd}),tipo:ue.tipo,observacao:ue.observacao})},K=()=>{f(X=>Wl(X,-1)),N(null)},re=()=>{f(X=>Wl(X,1)),N(null)};return h.jsx(fo,{open:t,onOpenChange:i,children:h.jsxs(Js,{className:"max-w-3xl",children:[h.jsxs(Qs,{children:[h.jsx(eo,{children:"Calendrio de Presenas"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:e==null?void 0:e.nome_completo})]}),h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx(tr,{variant:"ghost",size:"icon",onClick:K,disabled:o,children:h.jsx(h4,{className:"h-4 w-4"})}),h.jsx("div",{className:"text-lg font-semibold",children:Hs(c,"MMMM 'de' yyyy",{locale:Fd})}),h.jsx(tr,{variant:"ghost",size:"icon",onClick:re,disabled:o,children:h.jsx(f4,{className:"h-4 w-4"})})]}),o?h.jsx("div",{className:"flex items-center justify-center py-16",children:h.jsx(Xu,{className:"h-6 w-6 animate-spin text-primary"})}):h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"grid grid-cols-7 gap-2 text-center text-xs font-medium text-muted-foreground",children:B.map(X=>h.jsx("div",{children:X},X))}),h.jsx("div",{className:"grid grid-cols-7 gap-2",children:U.map(X=>{const ue=Hs(X,"yyyy-MM-dd"),Ee=$.get(ue),xe=Ee&&(Ee.tipo==="falta"||Ee.tipo==="falta_justificada"),Ne=x2(X,c);return h.jsxs("button",{type:"button",onClick:()=>H(ue,Ee),className:yr("flex min-h-[68px] flex-col items-center justify-center rounded-md border p-2 text-xs transition-colors",Y(Ee==null?void 0:Ee.tipo,Ne),xe?"cursor-pointer hover:border-red-400":"cursor-default"),children:[h.jsx("span",{className:"text-sm font-semibold",children:X.getDate()}),Ee?h.jsx("span",{className:"mt-1 text-[11px] capitalize",children:Ee.tipo.replace("_"," ")}):h.jsx("span",{className:"mt-1 text-[11px] text-muted-foreground/70",children:"--"})]},ue)})})]}),h.jsxs("div",{className:"flex flex-wrap gap-4 text-xs text-muted-foreground",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("span",{className:"h-3 w-3 rounded bg-emerald-200"})," Presente"]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("span",{className:"h-3 w-3 rounded bg-red-200"})," Falta / Falta justificada"]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("span",{className:"h-3 w-3 rounded bg-amber-200"})," Frias"]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("span",{className:"h-3 w-3 rounded bg-slate-200"})," Folga"]})]}),P&&h.jsxs("div",{className:"rounded-md border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:[h.jsxs("div",{className:"font-semibold",children:[P.tipo==="falta_justificada"?"Falta justificada":"Falta"," em"," ",P.date]}),h.jsx("p",{className:"mt-1 text-red-600",children:(G=P.observacao)!=null&&G.trim()?P.observacao:"Motivo no informado"})]})]})]})})}function ace(){const[e,t]=V.useState(""),[i,c]=V.useState("all"),[f,_]=V.useState("all"),[x,o]=V.useState(!1),[I,P]=V.useState(null),[N,U]=V.useState(null),[$,B]=V.useState(!1),[Y,H]=V.useState([]),[K,re]=V.useState(null),[G,X]=V.useState(null),[ue,Ee]=V.useState(null),{data:xe,refetch:Ne}=vo({queryKey:["colaboradores",i,f],queryFn:async()=>{let je=Qe.from("colaboradores").select(`
          *,
          unidade:unidades(nome),
          escala:escalas(nome, tipo),
          posto:postos_servico(nome, codigo)
        `).order("nome_completo");i!=="all"&&(je=je.eq("status",i)),f!=="all"&&(je=je.eq("unidade_id",f));const{data:Ye,error:qe}=await je;if(qe)throw qe;return Ye}}),{data:lt}=vo({queryKey:["unidades"],queryFn:async()=>{const{data:je,error:Ye}=await Qe.from("unidades").select("id, nome").eq("status","ativo").order("nome");if(Ye)throw Ye;return je}}),Pt=xe==null?void 0:xe.filter(je=>{var Ye,qe;return je.nome_completo.toLowerCase().includes(e.toLowerCase())||((Ye=je.cpf)==null?void 0:Ye.includes(e))||((qe=je.email)==null?void 0:qe.toLowerCase().includes(e.toLowerCase()))}),tt=je=>{P(je),o(!0)},yt=async je=>{try{const{error:Ye}=await Qe.from("colaboradores").delete().eq("id",je);if(Ye)throw Ye;mr.success("Colaborador excludo com sucesso"),Ne()}catch(Ye){mr.error(Ye.message||"Erro ao excluir colaborador")}},Me=async je=>{try{const{error:Ye}=await Qe.from("colaboradores").update({posto_servico_id:null}).eq("id",je);if(Ye)throw Ye;mr.success("Posto de servio desvinculado com sucesso"),Ne()}catch(Ye){mr.error(Ye.message||"Erro ao desvincular posto de servio")}},be=()=>{const je=[];if((!lt||lt.length===0)&&je.push("Unidades"),je.length>0){H(je),B(!0);return}o(!0)};return h.jsx($o,{children:h.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("h1",{className:"text-3xl font-bold",children:"Colaboradores"}),h.jsxs(tr,{onClick:be,children:[h.jsx(oa,{className:"mr-2 h-4 w-4"}),"Novo Colaborador"]})]}),h.jsxs("div",{className:"flex flex-col gap-4 md:flex-row",children:[h.jsxs("div",{className:"relative flex-1",children:[h.jsx(Xc,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),h.jsx(_r,{placeholder:"Buscar por nome, CPF ou email...",value:e,onChange:je=>t(je.target.value),className:"pl-9"})]}),h.jsxs(un,{value:i,onValueChange:c,children:[h.jsx(on,{className:"w-full md:w-[180px]",children:h.jsx(dn,{placeholder:"Status"})}),h.jsxs(an,{children:[h.jsx(kt,{value:"all",children:"Todos Status"}),h.jsx(kt,{value:"ativo",children:"Ativo"}),h.jsx(kt,{value:"afastado",children:"Afastado"}),h.jsx(kt,{value:"ferias",children:"Frias"}),h.jsx(kt,{value:"desligado",children:"Desligado"})]})]}),h.jsxs(un,{value:f,onValueChange:_,children:[h.jsx(on,{className:"w-full md:w-[180px]",children:h.jsx(dn,{placeholder:"Unidade"})}),h.jsxs(an,{children:[h.jsx(kt,{value:"all",children:"Todas Unidades"}),lt==null?void 0:lt.map(je=>h.jsx(kt,{value:je.id,children:je.nome},je.id))]})]})]}),h.jsx("div",{className:"rounded-md border",children:h.jsxs(Yd,{children:[h.jsx(Jd,{children:h.jsxs(Zs,{children:[h.jsx(xn,{children:"Nome"}),h.jsx(xn,{children:"Cargo"}),h.jsx(xn,{children:"Funo"}),h.jsx(xn,{children:"Tipo"}),h.jsx(xn,{children:"Status"}),h.jsx(xn,{children:"Unidade Padro"}),h.jsx(xn,{className:"text-right",children:"Aes"})]})}),h.jsx(Qd,{children:Pt==null?void 0:Pt.map(je=>{var Ye,qe,We,$e,_t;return h.jsxs(Zs,{children:[h.jsx(cn,{className:"font-medium",children:je.nome_completo}),h.jsx(cn,{children:je.cargo||"-"}),h.jsx(cn,{children:((Ye=je.posto)==null?void 0:Ye.nome)||"-"}),h.jsx(cn,{children:((qe=je.escala)==null?void 0:qe.tipo)==="12x36"?"escala_12x36":((We=je.escala)==null?void 0:We.tipo)==="diarista"?"diarista":(($e=je.escala)==null?void 0:$e.tipo)||"efetivo"}),h.jsx(cn,{children:h.jsx(ai,{variant:je.status==="ativo"?"default":je.status==="ferias"?"secondary":"outline",children:je.status})}),h.jsx(cn,{children:((_t=je.unidade)==null?void 0:_t.nome)||"-"}),h.jsx(cn,{className:"text-right",children:h.jsxs("div",{className:"flex items-center justify-end gap-2",children:[!je.posto_servico_id&&h.jsx(tr,{variant:"ghost",size:"icon",onClick:()=>X(je),title:"Atribuir Unidade/Posto",children:h.jsx(Nf,{className:"h-4 w-4"})}),je.posto_servico_id&&h.jsx(tr,{variant:"ghost",size:"icon",onClick:()=>Me(je.id),title:"Desvincular Posto de Servio",children:h.jsx(sZ,{className:"h-4 w-4 text-orange-500"})}),h.jsx(tr,{variant:"ghost",size:"icon",onClick:()=>U(je),title:"Histrico de Presena",children:h.jsx(m4,{className:"h-4 w-4"})}),h.jsx(tr,{variant:"ghost",size:"icon",onClick:()=>tt(je),children:h.jsx(mc,{className:"h-4 w-4"})}),h.jsxs(Hu,{children:[h.jsx(Rb,{asChild:!0,children:h.jsx(tr,{variant:"ghost",size:"icon",children:h.jsx(El,{className:"h-4 w-4 text-destructive"})})}),h.jsxs(ru,{children:[h.jsxs(nu,{children:[h.jsx(su,{children:"Confirmar excluso"}),h.jsx(ou,{children:"Tem certeza que deseja excluir este colaborador?"})]}),h.jsxs(iu,{children:[h.jsx(Zu,{children:"Cancelar"}),h.jsx(au,{onClick:()=>yt(je.id),children:"Excluir"})]})]})]})]})})]},je.id)})})]})}),x&&h.jsx(tce,{open:x,onClose:()=>{o(!1),P(null)},colaborador:I,onSuccess:()=>{o(!1),P(null),Ne()}}),N&&h.jsx(rce,{open:!!N,onClose:()=>U(null),colaborador:N,onSuccess:Ne}),$&&h.jsx(nce,{open:$,onClose:()=>B(!1),missingEntities:Y}),K&&h.jsx(ice,{open:!!K,onClose:()=>re(null),colaborador:K,onSuccess:Ne}),G&&h.jsx(sce,{open:!!G,onClose:()=>X(null),colaborador:G,onSuccess:Ne}),ue&&h.jsx(oce,{open:!!ue,onClose:()=>Ee(null),colaborador:ue})]})})}function lce({escala:e,open:t,onClose:i,onSuccess:c}){const[f,_]=V.useState(!1),[x,o]=V.useState({nome:"",tipo:"fixa",descricao:"",dias_trabalhados:"",dias_folga:""});V.useEffect(()=>{var P,N;e&&o({nome:e.nome||"",tipo:e.tipo||"fixa",descricao:e.descricao||"",dias_trabalhados:((P=e.dias_trabalhados)==null?void 0:P.toString())||"",dias_folga:((N=e.dias_folga)==null?void 0:N.toString())||""})},[e]);const I=async P=>{P.preventDefault(),_(!0);try{const N={nome:x.nome,tipo:x.tipo,descricao:x.descricao||null,dias_trabalhados:x.dias_trabalhados?parseInt(x.dias_trabalhados):null,dias_folga:x.dias_folga?parseInt(x.dias_folga):null};if(e){const{error:U}=await Qe.from("escalas").update(N).eq("id",e.id);if(U)throw U;mr.success("Escala atualizada com sucesso")}else{const{error:U}=await Qe.from("escalas").insert(N);if(U)throw U;mr.success("Escala cadastrada com sucesso")}c()}catch(N){mr.error("Erro ao salvar escala: "+N.message)}finally{_(!1)}};return h.jsx(fo,{open:t,onOpenChange:i,children:h.jsxs(Js,{className:"max-w-md",children:[h.jsx(Qs,{children:h.jsx(eo,{children:e?"Editar Escala Modelo":"Nova Escala Modelo"})}),h.jsxs("form",{onSubmit:I,className:"space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"nome",children:"Nome *"}),h.jsx(_r,{id:"nome",value:x.nome,onChange:P=>o({...x,nome:P.target.value}),placeholder:"Ex: 12x36, 5x2",required:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"tipo",children:"Tipo *"}),h.jsxs(un,{value:x.tipo,onValueChange:P=>o({...x,tipo:P}),children:[h.jsx(on,{children:h.jsx(dn,{})}),h.jsxs(an,{children:[h.jsx(kt,{value:"fixa",children:"Fixa"}),h.jsx(kt,{value:"alternada",children:"Alternada"}),h.jsx(kt,{value:"flexivel",children:"Flexvel"}),h.jsx(kt,{value:"plantao",children:"Planto"})]})]})]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"dias_trabalhados",children:"Dias Trabalhados"}),h.jsx(_r,{id:"dias_trabalhados",type:"number",min:"1",value:x.dias_trabalhados,onChange:P=>o({...x,dias_trabalhados:P.target.value}),placeholder:"Ex: 12"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"dias_folga",children:"Dias de Folga"}),h.jsx(_r,{id:"dias_folga",type:"number",min:"1",value:x.dias_folga,onChange:P=>o({...x,dias_folga:P.target.value}),placeholder:"Ex: 36"})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"descricao",children:"Descrio"}),h.jsx(Tl,{id:"descricao",value:x.descricao,onChange:P=>o({...x,descricao:P.target.value}),rows:3,placeholder:"Descreva os detalhes da escala..."})]}),h.jsxs("div",{className:"flex justify-end gap-2",children:[h.jsx(tr,{type:"button",variant:"outline",onClick:i,children:"Cancelar"}),h.jsx(tr,{type:"submit",disabled:f,children:f?"Salvando...":e?"Atualizar":"Cadastrar"})]})]})]})})}function cce(){const[e,t]=V.useState(!1),[i,c]=V.useState(null),{data:f,isLoading:_,refetch:x}=vo({queryKey:["escalas-detalhes"],queryFn:async()=>{const{data:P,error:N}=await Qe.from("postos_servico").select(`
          id,
          nome,
          codigo,
          escala,
          turno,
          jornada,
          horario_inicio,
          horario_fim,
          de,
          ate,
          dias_semana,
          unidade:unidades(nome, codigo)
        `).eq("status","ativo").order("escala");if(N)throw N;const U=new Map;return P==null||P.forEach($=>{if($.escala){U.has($.escala)||U.set($.escala,{escala:$.escala,turno:$.turno,jornada:$.jornada,horario_inicio:$.horario_inicio,horario_fim:$.horario_fim,dias_semana:$.dias_semana,postos:[]});const B=U.get($.escala);!B.turno&&$.turno&&(B.turno=$.turno),B.jornada==null&&$.jornada!=null&&(B.jornada=$.jornada),!B.horario_inicio&&$.horario_inicio&&(B.horario_inicio=$.horario_inicio),!B.horario_fim&&$.horario_fim&&(B.horario_fim=$.horario_fim),B.postos.push({id:$.id,nome:$.nome,codigo:$.codigo,unidade:$.unidade})}}),Array.from(U.values())}}),{data:o}=vo({queryKey:["escalas-modelo"],queryFn:async()=>{const{data:P,error:N}=await Qe.from("escalas").select("*").order("nome");if(N)throw N;return P}}),I=async P=>{try{const{error:N}=await Qe.from("escalas").delete().eq("id",P);if(N)throw N;mr.success("Escala excluda com sucesso"),x()}catch(N){mr.error("Erro ao excluir escala: "+N.message)}};return h.jsxs($o,{children:[h.jsx("div",{className:"min-h-screen bg-background p-8",children:h.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-4xl font-bold text-foreground",children:"Escalas"}),h.jsx("p",{className:"text-muted-foreground mt-2",children:"Gesto de escalas e turnos de trabalho"})]}),h.jsxs(tr,{onClick:()=>{c(null),t(!0)},children:[h.jsx(oa,{className:"mr-2 h-4 w-4"}),"Nova Escala Modelo"]})]}),h.jsxs("div",{className:"space-y-4",children:[h.jsx("h2",{className:"text-2xl font-semibold",children:"Escalas em Uso"}),_?h.jsx("div",{className:"text-center py-12",children:h.jsx("p",{className:"text-muted-foreground",children:"Carregando escalas..."})}):f&&f.length>0?h.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:f.map((P,N)=>{const U=!!P.turno&&(P.escala||"").toLowerCase()!=="12x36";return h.jsxs(kr,{children:[h.jsx(Mn,{children:h.jsxs("div",{className:"flex items-start justify-between",children:[h.jsxs("div",{children:[h.jsxs(Zn,{className:"flex items-center gap-2",children:[h.jsx($u,{className:"h-5 w-5"}),P.escala]}),h.jsxs(Xa,{className:"mt-2",children:[P.postos.length," posto(s) de servio"]})]}),U&&h.jsx(ai,{variant:"outline",children:P.turno})]})}),h.jsxs(tn,{className:"space-y-4",children:[P.horario_inicio&&P.horario_fim&&h.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[h.jsx(vb,{className:"h-4 w-4 text-muted-foreground"}),h.jsxs("span",{children:[P.horario_inicio.slice(0,5)," s ",P.horario_fim.slice(0,5)]})]}),U&&h.jsxs("div",{className:"text-sm",children:[h.jsx("span",{className:"font-medium",children:"Turno:"})," ",P.turno]}),typeof P.jornada=="number"&&h.jsxs("div",{className:"text-sm",children:[h.jsx("span",{className:"font-medium",children:"Jornada:"})," ",P.jornada,"h"]}),P.dias_semana&&P.dias_semana.length>0&&h.jsxs("div",{className:"text-sm",children:[h.jsx("span",{className:"font-medium",children:"Dias:"})," ",P.dias_semana.join(", ")]}),h.jsxs("div",{className:"pt-3 border-t",children:[h.jsx("p",{className:"text-sm font-medium mb-2",children:"Postos de Servio:"}),h.jsx("div",{className:"space-y-2",children:P.postos.map($=>h.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[h.jsx(Nf,{className:"h-3 w-3 text-muted-foreground"}),h.jsxs("span",{children:[$.codigo," - ",$.nome,$.unidade&&h.jsxs("span",{className:"text-muted-foreground ml-1",children:["(",$.unidade.nome,")"]})]})]},$.id))})]})]})]},N)})}):h.jsx(kr,{children:h.jsxs(tn,{className:"py-12 text-center",children:[h.jsx($u,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),h.jsx("p",{className:"text-muted-foreground",children:"Nenhuma escala em uso. Crie postos de servio com escalas definidas."})]})})]}),h.jsxs("div",{className:"space-y-4",children:[h.jsx("h2",{className:"text-2xl font-semibold",children:"Escalas Modelo"}),o&&o.length>0?h.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:o.map(P=>{const N=!!P.turno&&(P.tipo||"").toLowerCase()!=="12x36";return h.jsxs(kr,{children:[h.jsx(Mn,{children:h.jsxs("div",{className:"flex items-start justify-between",children:[h.jsxs("div",{children:[h.jsx(Zn,{children:P.nome}),P.descricao&&h.jsx(Xa,{className:"mt-2",children:P.descricao})]}),h.jsx(ai,{variant:"outline",children:P.tipo})]})}),h.jsxs(tn,{className:"space-y-2",children:[P.dias_trabalhados&&P.dias_folga&&h.jsxs("div",{className:"text-sm",children:[h.jsx("span",{className:"font-medium",children:"Regime:"})," ",P.dias_trabalhados,"x",P.dias_folga]}),N&&h.jsxs("div",{className:"text-sm",children:[h.jsx("span",{className:"font-medium",children:"Turno:"})," ",P.turno]}),typeof P.jornada=="number"&&h.jsxs("div",{className:"text-sm",children:[h.jsx("span",{className:"font-medium",children:"Jornada:"})," ",P.jornada,"h"]}),P.horario_inicio&&P.horario_fim&&h.jsxs("div",{className:"text-sm",children:[h.jsx("span",{className:"font-medium",children:"Horrio:"})," ",P.horario_inicio.slice(0,5)," s ",P.horario_fim.slice(0,5)]}),h.jsxs("div",{className:"flex gap-2 pt-3",children:[h.jsx(tr,{variant:"outline",size:"sm",onClick:()=>{c(P),t(!0)},children:"Editar"}),h.jsx(tr,{variant:"outline",size:"sm",onClick:()=>I(P.id),children:"Excluir"})]})]})]},P.id)})}):h.jsx(kr,{children:h.jsxs(tn,{className:"py-12 text-center",children:[h.jsx($u,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),h.jsx("p",{className:"text-muted-foreground",children:"Nenhuma escala modelo cadastrada"}),h.jsxs(tr,{onClick:()=>t(!0),className:"mt-4",children:[h.jsx(oa,{className:"mr-2 h-4 w-4"}),"Criar primeira escala modelo"]})]})})]})]})}),e&&h.jsx(lce,{escala:i,open:e,onClose:()=>{t(!1),c(null)},onSuccess:()=>{t(!1),c(null),x()}})]})}function uce({open:e,onOpenChange:t,ativo:i,onSuccess:c}){var H;const[f,_]=V.useState(!1),[x,o]=V.useState([]),{register:I,handleSubmit:P,setValue:N,watch:U,reset:$}=Aj({defaultValues:{unidade_id:(i==null?void 0:i.unidade_id)||"",categoria:(i==null?void 0:i.categoria)||"",tag_patrimonio:(i==null?void 0:i.tag_patrimonio)||"",fabricante:(i==null?void 0:i.fabricante)||"",modelo:(i==null?void 0:i.modelo)||"",numero_serie:(i==null?void 0:i.numero_serie)||"",status:(i==null?void 0:i.status)||"operacional",critico:(i==null?void 0:i.critico)||!1,data_instalacao:(i==null?void 0:i.data_instalacao)||"",frequencia_preventiva_dias:(i==null?void 0:i.frequencia_preventiva_dias)||90}});V.useEffect(()=>{B()},[]),V.useEffect(()=>{i&&$({unidade_id:i.unidade_id||"",categoria:i.categoria||"",tag_patrimonio:i.tag_patrimonio||"",fabricante:i.fabricante||"",modelo:i.modelo||"",numero_serie:i.numero_serie||"",status:i.status||"operacional",critico:i.critico||!1,data_instalacao:i.data_instalacao||"",frequencia_preventiva_dias:i.frequencia_preventiva_dias||90})},[i,$]);const B=async()=>{const{data:K}=await Qe.from("unidades").select("*").order("nome");o(K||[])},Y=async K=>{_(!0);try{const re={...K,critico:K.critico==="true"||K.critico===!0};if(i){const{error:G}=await Qe.from("ativos").update(re).eq("id",i.id);if(G)throw G;mr.success("Ativo atualizado com sucesso!")}else{const{error:G}=await Qe.from("ativos").insert([re]);if(G)throw G;mr.success("Ativo cadastrado com sucesso!")}c(),t(!1),$()}catch(re){mr.error(re.message)}finally{_(!1)}};return h.jsx(fo,{open:e,onOpenChange:t,children:h.jsxs(Js,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[h.jsx(Qs,{children:h.jsx(eo,{children:i?"Editar Ativo":"Cadastrar Novo Ativo"})}),h.jsxs("form",{onSubmit:P(Y),className:"space-y-4",children:[h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"unidade_id",children:"Unidade *"}),h.jsxs(un,{value:U("unidade_id"),onValueChange:K=>N("unidade_id",K),children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Selecione"})}),h.jsx(an,{children:x.map(K=>h.jsx(kt,{value:K.id,children:K.nome},K.id))})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"categoria",children:"Categoria *"}),h.jsx(_r,{...I("categoria",{required:!0})})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"tag_patrimonio",children:"Tag Patrimnio *"}),h.jsx(_r,{...I("tag_patrimonio",{required:!0})})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"fabricante",children:"Fabricante"}),h.jsx(_r,{...I("fabricante")})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"modelo",children:"Modelo"}),h.jsx(_r,{...I("modelo")})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"numero_serie",children:"Nmero de Srie"}),h.jsx(_r,{...I("numero_serie")})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"status",children:"Status *"}),h.jsxs(un,{value:U("status"),onValueChange:K=>N("status",K),children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Operacional"})}),h.jsxs(an,{children:[h.jsx(kt,{value:"operacional",children:"Operacional"}),h.jsx(kt,{value:"manutencao",children:"Manuteno"}),h.jsx(kt,{value:"inativo",children:"Inativo"}),h.jsx(kt,{value:"descartado",children:"Descartado"})]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"critico",children:"Crtico *"}),h.jsxs(un,{value:(H=U("critico"))==null?void 0:H.toString(),onValueChange:K=>N("critico",K==="true"),children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"No"})}),h.jsxs(an,{children:[h.jsx(kt,{value:"false",children:"No"}),h.jsx(kt,{value:"true",children:"Sim"})]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"data_instalacao",children:"Data Instalao"}),h.jsx(_r,{type:"date",...I("data_instalacao")})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"frequencia_preventiva_dias",children:"Frequncia Preventiva (dias)"}),h.jsx(_r,{type:"number",...I("frequencia_preventiva_dias")})]})]}),h.jsxs("div",{className:"flex justify-end gap-2",children:[h.jsx(tr,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancelar"}),h.jsx(tr,{type:"submit",disabled:f,children:f?"Salvando...":"Cadastrar"})]})]})]})})}function dce(){const[e,t]=V.useState([]),[i,c]=V.useState([]),[f,_]=V.useState(""),[x,o]=V.useState(!1),[I,P]=V.useState(null),[N,U]=V.useState({});V.useEffect(()=>{$()},[]),V.useEffect(()=>{const re=e.filter(G=>{var X,ue,Ee,xe;return((X=G.tag_patrimonio)==null?void 0:X.toLowerCase().includes(f.toLowerCase()))||((ue=G.categoria)==null?void 0:ue.toLowerCase().includes(f.toLowerCase()))||((Ee=G.fabricante)==null?void 0:Ee.toLowerCase().includes(f.toLowerCase()))||((xe=G.modelo)==null?void 0:xe.toLowerCase().includes(f.toLowerCase()))});c(re)},[f,e]);const $=async()=>{const{data:re,error:G}=await Qe.from("ativos").select("*, unidades(nome)").order("created_at",{ascending:!1});if(G){mr.error("Erro ao carregar ativos");return}t(re||[]),B(re||[])},B=re=>{const G=re.length,X=re.reduce((xe,Ne)=>{const lt=Ne.categoria||"Sem categoria";return xe[lt]=(xe[lt]||0)+1,xe},{}),ue=re.filter(xe=>xe.status==="operacional").length,Ee=re.filter(xe=>xe.critico).length;U({totalAtivos:G,categorias:X,operacionais:ue,criticos:Ee})},Y=async re=>{if(!confirm("Tem certeza que deseja deletar este ativo?"))return;const{error:G}=await Qe.from("ativos").delete().eq("id",re);if(G){mr.error("Erro ao deletar ativo");return}mr.success("Ativo deletado com sucesso!"),$()},H=re=>{P(re),o(!0)},K=()=>{P(null),o(!0)};return h.jsxs($o,{children:[h.jsxs("div",{className:"p-6 space-y-6",children:[h.jsxs("div",{className:"flex justify-between items-center",children:[h.jsx("h1",{className:"text-3xl font-bold",children:"Gesto de Ativos"}),h.jsxs(tr,{onClick:K,children:[h.jsx(oa,{className:"h-4 w-4 mr-2"}),"Novo Ativo"]})]}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[h.jsxs(kr,{children:[h.jsxs(Mn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[h.jsx(Zn,{className:"text-sm font-medium",children:"Total de Ativos"}),h.jsx(Dd,{className:"h-4 w-4 text-muted-foreground"})]}),h.jsx(tn,{children:h.jsx("div",{className:"text-2xl font-bold",children:N.totalAtivos||0})})]}),h.jsxs(kr,{children:[h.jsxs(Mn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[h.jsx(Zn,{className:"text-sm font-medium",children:"Operacionais"}),h.jsx(Dd,{className:"h-4 w-4 text-muted-foreground"})]}),h.jsx(tn,{children:h.jsx("div",{className:"text-2xl font-bold",children:N.operacionais||0})})]}),h.jsxs(kr,{children:[h.jsxs(Mn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[h.jsx(Zn,{className:"text-sm font-medium",children:"Crticos"}),h.jsx(Dd,{className:"h-4 w-4 text-muted-foreground"})]}),h.jsx(tn,{children:h.jsx("div",{className:"text-2xl font-bold",children:N.criticos||0})})]})]}),h.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:Object.entries(N.categorias||{}).map(([re,G])=>h.jsxs(kr,{children:[h.jsxs(Mn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[h.jsx(Zn,{className:"text-sm font-medium capitalize",children:re}),h.jsx(Dd,{className:"h-4 w-4 text-muted-foreground"})]}),h.jsx(tn,{children:h.jsx("div",{className:"text-2xl font-bold",children:G})})]},re))}),h.jsxs(kr,{children:[h.jsx(Mn,{children:h.jsx("div",{className:"flex items-center gap-4",children:h.jsxs("div",{className:"relative flex-1",children:[h.jsx(Xc,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),h.jsx(_r,{placeholder:"Buscar por tag, categoria, fabricante ou modelo...",value:f,onChange:re=>_(re.target.value),className:"pl-8"})]})})}),h.jsx(tn,{children:h.jsxs(Yd,{children:[h.jsx(Jd,{children:h.jsxs(Zs,{children:[h.jsx(xn,{children:"Tag Patrimnio"}),h.jsx(xn,{children:"Categoria"}),h.jsx(xn,{children:"Fabricante"}),h.jsx(xn,{children:"Modelo"}),h.jsx(xn,{children:"Unidade"}),h.jsx(xn,{children:"Status"}),h.jsx(xn,{children:"Crtico"}),h.jsx(xn,{children:"Aes"})]})}),h.jsx(Qd,{children:i.map(re=>{var G;return h.jsxs(Zs,{children:[h.jsx(cn,{className:"font-medium",children:re.tag_patrimonio}),h.jsx(cn,{children:re.categoria}),h.jsx(cn,{children:re.fabricante}),h.jsx(cn,{children:re.modelo}),h.jsx(cn,{children:(G=re.unidades)==null?void 0:G.nome}),h.jsx(cn,{children:h.jsx(ai,{variant:re.status==="operacional"?"default":re.status==="manutencao"?"secondary":"outline",children:re.status})}),h.jsx(cn,{children:re.critico?h.jsx(ai,{variant:"destructive",children:"Sim"}):h.jsx(ai,{variant:"outline",children:"No"})}),h.jsx(cn,{children:h.jsxs("div",{className:"flex gap-2",children:[h.jsx(tr,{variant:"ghost",size:"icon",onClick:()=>H(re),children:h.jsx(mc,{className:"h-4 w-4"})}),h.jsx(tr,{variant:"ghost",size:"icon",onClick:()=>Y(re.id),children:h.jsx(El,{className:"h-4 w-4"})})]})})]},re.id)})})]})})]})]}),h.jsx(uce,{open:x,onOpenChange:o,ativo:I,onSuccess:$})]})}function hce({open:e,onOpenChange:t,item:i,onSuccess:c}){const[f,_]=V.useState(!1),[x,o]=V.useState([]),{register:I,handleSubmit:P,setValue:N,watch:U,reset:$}=Aj({defaultValues:{unidade_id:(i==null?void 0:i.unidade_id)||"",nome:(i==null?void 0:i.nome)||"",sku:(i==null?void 0:i.sku)||"",descricao:(i==null?void 0:i.descricao)||"",unidade_medida:(i==null?void 0:i.unidade_medida)||"",quantidade_minima:(i==null?void 0:i.quantidade_minima)||0,quantidade_atual:(i==null?void 0:i.quantidade_atual)||0}});V.useEffect(()=>{B()},[]),V.useEffect(()=>{$(i?{unidade_id:i.unidade_id||"",nome:i.nome||"",sku:i.sku||"",descricao:i.descricao||"",unidade_medida:i.unidade_medida||"",quantidade_minima:i.quantidade_minima||0,quantidade_atual:i.quantidade_atual||0}:{unidade_id:"",nome:"",sku:"",descricao:"",unidade_medida:"",quantidade_minima:0,quantidade_atual:0})},[i,$]);const B=async()=>{const{data:H,error:K}=await Qe.from("unidades").select("id, nome").order("nome");if(K){mr.error("Erro ao carregar unidades");return}o(H||[])},Y=async H=>{_(!0);try{if(i){const{error:K}=await Qe.from("itens_estoque").update(H).eq("id",i.id);if(K)throw K;mr.success("Item atualizado com sucesso!")}else{const{error:K}=await Qe.from("itens_estoque").insert([H]);if(K)throw K;mr.success("Item cadastrado com sucesso!")}c(),t(!1),$()}catch(K){mr.error(K.message)}finally{_(!1)}};return h.jsx(fo,{open:e,onOpenChange:t,children:h.jsxs(Js,{className:"max-w-xl max-h-[90vh] overflow-y-auto",children:[h.jsx(Qs,{children:h.jsx(eo,{children:i?"Editar Item":"Cadastrar Novo Item"})}),h.jsxs("form",{onSubmit:P(Y),className:"space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"unidade_id",children:"Unidade *"}),h.jsxs(un,{value:U("unidade_id"),onValueChange:H=>N("unidade_id",H),children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Selecione"})}),h.jsx(an,{children:x.map(H=>h.jsx(kt,{value:H.id,children:H.nome},H.id))})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"sku",children:"SKU *"}),h.jsx(_r,{...I("sku",{required:!0})})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"nome",children:"Nome *"}),h.jsx(_r,{...I("nome",{required:!0})})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"descricao",children:"Descrio *"}),h.jsx(_r,{...I("descricao",{required:!0})})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"unidade_medida",children:"Unidade de Medida *"}),h.jsx(_r,{placeholder:"Ex: UN, KG, L",...I("unidade_medida",{required:!0})})]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"quantidade_minima",children:"Quantidade Mnima *"}),h.jsx(_r,{type:"number",...I("quantidade_minima",{required:!0,min:0})})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"quantidade_atual",children:"Quantidade Atual *"}),h.jsx(_r,{type:"number",...I("quantidade_atual",{required:!0,min:0})})]})]}),h.jsxs("div",{className:"flex justify-end gap-2",children:[h.jsx(tr,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancelar"}),h.jsx(tr,{type:"submit",disabled:f,children:f?"Salvando...":i?"Atualizar":"Cadastrar"})]})]})]})})}const fce=()=>{const[e,t]=V.useState([]),[i,c]=V.useState(""),[f,_]=V.useState(!1),[x,o]=V.useState(null),[I,P]=V.useState({total:0,abaixoMinimo:0,quantidadeTotal:0});V.useEffect(()=>{N()},[]);const N=async()=>{const{data:G,error:X}=await Qe.from("itens_estoque").select("*, unidades(nome)").order("created_at",{ascending:!1});if(X){mr.error("Erro ao carregar itens");return}t(G||[]),U(G||[])},U=G=>{const X=G.length,ue=G.filter(xe=>xe.quantidade_atual<xe.quantidade_minima).length,Ee=G.reduce((xe,Ne)=>xe+(Ne.quantidade_atual||0),0);P({total:X,abaixoMinimo:ue,quantidadeTotal:Ee})},$=V.useMemo(()=>{const G=i.toLowerCase();return e.filter(X=>{var ue,Ee,xe;return((ue=X.sku)==null?void 0:ue.toLowerCase().includes(G))||((Ee=X.nome)==null?void 0:Ee.toLowerCase().includes(G))||((xe=X.descricao)==null?void 0:xe.toLowerCase().includes(G))})},[e,i]),B=async G=>{if(!confirm("Tem certeza que deseja deletar este item?"))return;const{error:X}=await Qe.from("itens_estoque").delete().eq("id",G);if(X){mr.error("Erro ao deletar item");return}mr.success("Item deletado com sucesso!"),N()},Y=G=>{o(G),_(!0)},H=()=>{o(null),_(!0)},K=G=>G.quantidade_atual<G.quantidade_minima,re=G=>G.quantidade_atual<G.quantidade_minima?{borderClass:"border-red-500",textClass:"text-red-600",label:"Abaixo do mnimo",Icon:vm}:G.quantidade_atual===G.quantidade_minima?{borderClass:"border-amber-400",textClass:"text-amber-500",label:"No limite",Icon:vm}:{borderClass:"border-emerald-500",textClass:"text-emerald-600",label:"Estoque saudvel",Icon:yb};return h.jsxs($o,{children:[h.jsxs("div",{className:"p-6 space-y-6",children:[h.jsxs("div",{className:"flex items-center justify-between gap-4",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-3xl font-bold",children:"Estoque"}),h.jsx("p",{className:"text-muted-foreground",children:"Controle de materiais e insumos."})]}),h.jsxs(tr,{onClick:H,children:[h.jsx(oa,{className:"h-4 w-4 mr-2"}),"Novo Item"]})]}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[h.jsxs(kr,{children:[h.jsxs(Mn,{className:"flex items-center justify-between space-y-0 pb-2",children:[h.jsx(Zn,{className:"text-sm font-medium",children:"Total de itens"}),h.jsx(Dd,{className:"h-4 w-4 text-muted-foreground"})]}),h.jsx(tn,{className:"text-center",children:h.jsx("div",{className:"text-lg font-bold",children:I.total})})]}),h.jsxs(kr,{children:[h.jsxs(Mn,{className:"flex items-center justify-between space-y-0 pb-2",children:[h.jsx(Zn,{className:"text-sm font-medium",children:"Abaixo do mnimo"}),h.jsx(vm,{className:"h-4 w-4 text-muted-foreground"})]}),h.jsx(tn,{className:"text-center",children:h.jsx("div",{className:"text-lg font-bold",children:I.abaixoMinimo})})]}),h.jsxs(kr,{children:[h.jsxs(Mn,{className:"flex items-center justify-between space-y-0 pb-2",children:[h.jsx(Zn,{className:"text-sm font-medium",children:"Quantidade total"}),h.jsx(Dd,{className:"h-4 w-4 text-muted-foreground"})]}),h.jsx(tn,{className:"text-center",children:h.jsx("div",{className:"text-lg font-bold",children:I.quantidadeTotal})})]})]}),h.jsxs(kr,{children:[h.jsx(Mn,{children:h.jsxs("div",{className:"relative flex-1",children:[h.jsx(Xc,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),h.jsx(_r,{placeholder:"Buscar por SKU, nome ou descricao...",value:i,onChange:G=>c(G.target.value),className:"pl-9"})]})}),h.jsxs(tn,{children:[h.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[$.map(G=>{const X=re(G);return h.jsx(kr,{className:`border-2 ${X.borderClass} bg-transparent`,children:h.jsxs(tn,{className:"py-4 flex flex-col items-center text-center space-y-2",children:[h.jsx(X.Icon,{className:`h-6 w-6 ${X.textClass}`}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-semibold",children:G.nome}),h.jsx("p",{className:`text-xs ${X.textClass}`,children:X.label})]}),h.jsxs("div",{className:"text-lg font-bold",children:[G.quantidade_atual," ",h.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:["/ ",G.quantidade_minima]})]})]})},`indicator-${G.id}`)}),$.length===0&&h.jsx("div",{className:"col-span-full text-center text-sm text-muted-foreground",children:"Nenhum item para exibir nos indicadores."})]}),h.jsxs(Yd,{children:[h.jsx(Jd,{children:h.jsxs(Zs,{children:[h.jsx(xn,{children:"SKU"}),h.jsx(xn,{children:"Nome"}),h.jsx(xn,{children:"Descricao"}),h.jsx(xn,{children:"Unidade"}),h.jsx(xn,{children:"Un. Medida"}),h.jsx(xn,{children:"Qtd. Minima"}),h.jsx(xn,{children:"Qtd. Atual"}),h.jsx(xn,{children:"Status"}),h.jsx(xn,{children:"Acoes"})]})}),h.jsxs(Qd,{children:[$.map(G=>{var X;return h.jsxs(Zs,{children:[h.jsx(cn,{className:"font-medium",children:G.sku}),h.jsx(cn,{children:G.nome}),h.jsx(cn,{children:G.descricao}),h.jsx(cn,{children:((X=G.unidades)==null?void 0:X.nome)||"-"}),h.jsx(cn,{children:G.unidade_medida}),h.jsx(cn,{children:G.quantidade_minima}),h.jsx(cn,{children:G.quantidade_atual}),h.jsx(cn,{children:K(G)?h.jsx(ai,{variant:"destructive",children:"Abaixo do minimo"}):h.jsx(ai,{children:"Normal"})}),h.jsx(cn,{children:h.jsxs("div",{className:"flex gap-2",children:[h.jsx(tr,{variant:"ghost",size:"icon",onClick:()=>Y(G),children:h.jsx(mc,{className:"h-4 w-4"})}),h.jsx(tr,{variant:"ghost",size:"icon",onClick:()=>B(G.id),children:h.jsx(El,{className:"h-4 w-4"})})]})})]},G.id)}),$.length===0&&h.jsx(Zs,{children:h.jsx(cn,{colSpan:9,className:"text-center text-sm text-muted-foreground",children:"Nenhum item encontrado"})})]})]})]})]})]}),h.jsx(hce,{open:f,onOpenChange:_,item:x,onSuccess:N})]})};function pce({open:e,onClose:t,onSuccess:i,diarista:c}){const[f,_]=V.useState(!1),[x,o]=V.useState({nome_completo:"",rg:"",cnh:"",endereco:"",cidade:"",telefone:"",email:"",possui_antecedente:!1,status:"ativo"});V.useEffect(()=>{o(c?{nome_completo:c.nome_completo||"",rg:c.rg||"",cnh:c.cnh||"",endereco:c.endereco||"",cidade:c.cidade||"",telefone:c.telefone||"",email:c.email||"",possui_antecedente:c.possui_antecedente||!1,status:c.status||"ativo"}:{nome_completo:"",rg:"",cnh:"",endereco:"",cidade:"",telefone:"",email:"",possui_antecedente:!1,status:"ativo"})},[c,e]);const I=async P=>{if(P.preventDefault(),x.possui_antecedente){mr.error("No  permitido cadastrar diaristas com antecedentes criminais");return}_(!0);try{if(c){const{error:N}=await Qe.from("diaristas").update(x).eq("id",c.id);if(N)throw N;mr.success("Diarista atualizado com sucesso")}else{const{error:N}=await Qe.from("diaristas").insert([x]);if(N)throw N;mr.success("Diarista cadastrado com sucesso")}i()}catch(N){mr.error("Erro ao salvar diarista: "+N.message)}finally{_(!1)}};return h.jsx(fo,{open:e,onOpenChange:t,children:h.jsxs(Js,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[h.jsx(Qs,{children:h.jsx(eo,{children:c?"Editar Diarista":"Novo Diarista"})}),h.jsxs("form",{onSubmit:I,className:"space-y-4",children:[h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2 col-span-2",children:[h.jsx(Kt,{htmlFor:"nome_completo",children:"Nome Completo *"}),h.jsx(_r,{id:"nome_completo",value:x.nome_completo,onChange:P=>o({...x,nome_completo:P.target.value}),required:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"rg",children:"RG *"}),h.jsx(_r,{id:"rg",value:x.rg,onChange:P=>o({...x,rg:P.target.value}),required:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"cnh",children:"CNH *"}),h.jsx(_r,{id:"cnh",value:x.cnh,onChange:P=>o({...x,cnh:P.target.value}),required:!0})]}),h.jsxs("div",{className:"space-y-2 col-span-2",children:[h.jsx(Kt,{htmlFor:"endereco",children:"Endereo *"}),h.jsx(_r,{id:"endereco",value:x.endereco,onChange:P=>o({...x,endereco:P.target.value}),required:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"cidade",children:"Cidade"}),h.jsx(_r,{id:"cidade",value:x.cidade,onChange:P=>o({...x,cidade:P.target.value})})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"telefone",children:"Telefone *"}),h.jsx(_r,{id:"telefone",type:"tel",value:x.telefone,onChange:P=>o({...x,telefone:P.target.value}),required:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"email",children:"Email *"}),h.jsx(_r,{id:"email",type:"email",value:x.email,onChange:P=>o({...x,email:P.target.value}),required:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"possui_antecedente",children:"Possui Antecedente Criminal? *"}),h.jsxs(un,{value:x.possui_antecedente?"true":"false",onValueChange:P=>o({...x,possui_antecedente:P==="true"}),children:[h.jsx(on,{children:h.jsx(dn,{})}),h.jsxs(an,{children:[h.jsx(kt,{value:"false",children:"No"}),h.jsx(kt,{value:"true",children:"Sim"})]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{htmlFor:"status",children:"Status"}),h.jsxs(un,{value:x.status,onValueChange:P=>o({...x,status:P}),children:[h.jsx(on,{children:h.jsx(dn,{})}),h.jsxs(an,{children:[h.jsx(kt,{value:"ativo",children:"Ativo"}),h.jsx(kt,{value:"inativo",children:"Inativo"})]})]})]})]}),h.jsxs("div",{className:"flex justify-end gap-2",children:[h.jsx(tr,{type:"button",variant:"outline",onClick:t,children:"Cancelar"}),h.jsx(tr,{type:"submit",disabled:f,children:f?"Salvando...":c?"Atualizar":"Cadastrar"})]})]})]})})}function mce(){const[e,t]=V.useState(""),[i,c]=V.useState(!1),[f,_]=V.useState(null),[x,o]=V.useState(null),I=i2(),{data:P,isLoading:N}=vo({queryKey:["diaristas"],queryFn:async()=>{const{data:Y,error:H}=await Qe.from("diaristas").select("*").order("nome_completo");if(H)throw H;return Y||[]}}),U=P==null?void 0:P.filter(Y=>Y.nome_completo.toLowerCase().includes(e.toLowerCase())||Y.email.toLowerCase().includes(e.toLowerCase())||Y.telefone.includes(e)),$=Y=>{_(Y),c(!0)},B=async Y=>{try{const{error:H}=await Qe.from("diaristas").delete().eq("id",Y);if(H)throw H;mr.success("Diarista excludo com sucesso"),I.invalidateQueries({queryKey:["diaristas"]}),o(null)}catch(H){mr.error("Erro ao excluir diarista: "+H.message)}};return h.jsxs($o,{children:[h.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[h.jsxs("div",{className:"flex justify-between items-center",children:[h.jsx("h1",{className:"text-3xl font-bold",children:"Diaristas"}),h.jsxs(tr,{onClick:()=>{_(null),c(!0)},children:[h.jsx(oa,{className:"mr-2 h-4 w-4"}),"Novo Diarista"]})]}),h.jsx("div",{className:"flex items-center gap-4",children:h.jsxs("div",{className:"relative flex-1",children:[h.jsx(Xc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),h.jsx(_r,{placeholder:"Buscar por nome, email ou telefone...",value:e,onChange:Y=>t(Y.target.value),className:"pl-10"})]})}),h.jsx("div",{className:"border rounded-lg",children:h.jsxs(Yd,{children:[h.jsx(Jd,{children:h.jsxs(Zs,{children:[h.jsx(xn,{children:"Nome"}),h.jsx(xn,{children:"RG"}),h.jsx(xn,{children:"CNH"}),h.jsx(xn,{children:"Cidade"}),h.jsx(xn,{children:"Telefone"}),h.jsx(xn,{children:"Email"}),h.jsx(xn,{children:"Status"}),h.jsx(xn,{className:"text-right",children:"Aes"})]})}),h.jsx(Qd,{children:N?h.jsx(Zs,{children:h.jsx(cn,{colSpan:8,className:"text-center",children:"Carregando..."})}):(U==null?void 0:U.length)===0?h.jsx(Zs,{children:h.jsx(cn,{colSpan:8,className:"text-center",children:"Nenhum diarista encontrado"})}):U==null?void 0:U.map(Y=>h.jsxs(Zs,{children:[h.jsx(cn,{className:"font-medium",children:Y.nome_completo}),h.jsx(cn,{children:Y.rg}),h.jsx(cn,{children:Y.cnh}),h.jsx(cn,{children:Y.cidade||"-"}),h.jsx(cn,{children:Y.telefone}),h.jsx(cn,{children:Y.email}),h.jsx(cn,{children:h.jsx(ai,{variant:Y.status==="ativo"?"default":"secondary",children:Y.status})}),h.jsx(cn,{className:"text-right",children:h.jsxs("div",{className:"flex justify-end gap-2",children:[h.jsx(tr,{variant:"ghost",size:"icon",onClick:()=>$(Y),children:h.jsx(mc,{className:"h-4 w-4"})}),h.jsx(tr,{variant:"ghost",size:"icon",onClick:()=>o(Y.id),children:h.jsx(El,{className:"h-4 w-4"})})]})})]},Y.id))})]})})]}),h.jsx(pce,{open:i,onClose:()=>{c(!1),_(null)},onSuccess:()=>{I.invalidateQueries({queryKey:["diaristas"]}),c(!1),_(null)},diarista:f}),h.jsx(Hu,{open:!!x,onOpenChange:()=>o(null),children:h.jsxs(ru,{children:[h.jsxs(nu,{children:[h.jsx(su,{children:"Confirmar excluso"}),h.jsx(ou,{children:"Tem certeza que deseja excluir este diarista? Esta ao no pode ser desfeita."})]}),h.jsxs(iu,{children:[h.jsx(Zu,{children:"Cancelar"}),h.jsx(au,{onClick:()=>x&&B(x),children:"Excluir"})]})]})})]})}const rF={unidade_id:"",posto_id:"",dia_inspecao:"",responsavel:"",checklistIds:[],checklistItemIds:[]},gce=["supervisor","gestor_operacoes","admin"],_ce=()=>{const[e,t]=V.useState([]),[i,c]=V.useState([]),[f,_]=V.useState([]),[x,o]=V.useState([]),[I,P]=V.useState([]),[N,U]=V.useState([]),[$,B]=V.useState(rF),[Y,H]=V.useState(null),[K,re]=V.useState(!1),[G,X]=V.useState(!1),ue=V.useCallback((rt,Tt)=>{const Vt=new Set(N.filter(it=>it.checklist_id!==null&&rt.includes(it.checklist_id)).map(it=>it.id));return Tt.filter(it=>Vt.has(it))},[N]),Ee=V.useCallback(async()=>{const{data:rt,error:Tt}=await Qe.from("inspecoes").select(`
        id,
        unidade_id,
        posto_id,
        responsavel,
        dia_inspecao,
        unidade:unidades ( nome ),
        posto:postos_servico ( nome ),
        responsavel_profile:profiles ( full_name ),
        rel_checklists:inspecoes_checklists (
          checklist_id,
          checklist:checklists (
            id,
            nome,
            periodicidade
          )
        ),
        rel_checklist_itens:inspecoes_checklist_itens (
          checklist_item_id,
          checklist_item:checklist_itens (
            id,
            descricao,
            checklist_id
          )
        )
      `).order("dia_inspecao",{ascending:!1});if(Tt){console.error(Tt),mr.error("Nao foi possivel carregar as inspecoes");return}t(rt??[])},[]),xe=V.useCallback(async()=>{const{data:rt,error:Tt}=await Qe.from("unidades").select("id, nome").order("nome");if(Tt){mr.error("Nao foi possivel carregar as unidades");return}c(rt??[])},[]),Ne=V.useCallback(async()=>{const{data:rt,error:Tt}=await Qe.from("postos_servico").select("id, nome, unidade_id").order("nome");if(Tt){mr.error("Nao foi possivel carregar os postos");return}_(rt??[])},[]),lt=V.useCallback(async()=>{const{data:rt,error:Tt}=await Qe.from("user_roles").select("user_id, role").in("role",gce);if(Tt){mr.error("Nao foi possivel carregar os responsaveis");return}const Vt=(rt==null?void 0:rt.map(wr=>wr.user_id))??[];if(Vt.length===0){o([]);return}const{data:it,error:ir}=await Qe.from("profiles").select("id, full_name, email").in("id",Vt);if(ir){mr.error("Nao foi possivel carregar os perfis");return}o((it??[]).map(wr=>({id:wr.id,nome:wr.full_name||wr.email||"Usuario sem nome"})))},[]),Pt=V.useCallback(async()=>{const{data:rt,error:Tt}=await Qe.from("checklists").select("id, nome, periodicidade").order("nome");if(Tt){mr.error("Nao foi possivel carregar os checklists");return}P(rt??[])},[]),tt=V.useCallback(async()=>{const{data:rt,error:Tt}=await Qe.from("checklist_itens").select("id, descricao, checklist_id, ordem").order("ordem",{ascending:!0});if(Tt){mr.error("Nao foi possivel carregar os itens de checklist");return}U(rt??[])},[]),yt=V.useCallback(async()=>{re(!0);try{await Promise.all([Ee(),xe(),Ne(),lt(),Pt(),tt()])}finally{re(!1)}},[Ee,xe,Ne,lt,Pt,tt]);V.useEffect(()=>{yt()},[yt]);const Me=V.useMemo(()=>$.unidade_id?f.filter(rt=>rt.unidade_id===$.unidade_id):f,[f,$.unidade_id]),be=V.useMemo(()=>$.checklistIds.length?N.filter(rt=>rt.checklist_id&&$.checklistIds.includes(rt.checklist_id)):[],[N,$.checklistIds]),je=V.useCallback(async(rt,Tt,Vt)=>{if(await Qe.from("inspecoes_checklists").delete().eq("inspecao_id",rt),Tt.length){const it=Tt.map(wr=>({inspecao_id:rt,checklist_id:wr})),{error:ir}=await Qe.from("inspecoes_checklists").insert(it);if(ir)throw ir}if(await Qe.from("inspecoes_checklist_itens").delete().eq("inspecao_id",rt),Vt.length){const it=Vt.map(wr=>({inspecao_id:rt,checklist_item_id:wr})),{error:ir}=await Qe.from("inspecoes_checklist_itens").insert(it);if(ir)throw ir}},[]),Ye=async rt=>{if(rt.preventDefault(),!$.unidade_id||!$.posto_id||!$.dia_inspecao||!$.responsavel||$.checklistIds.length===0){mr.warning("Preencha todos os campos obrigatorios e selecione ao menos um checklist");return}X(!0);const Tt={unidade_id:$.unidade_id,posto_id:$.posto_id,responsavel:$.responsavel,dia_inspecao:new Date($.dia_inspecao).toISOString()},Vt=ue($.checklistIds,$.checklistItemIds);try{let it=Y;if(Y){const{error:ir}=await Qe.from("inspecoes").update(Tt).eq("id",Y);if(ir)throw ir}else{const{data:ir,error:wr}=await Qe.from("inspecoes").insert(Tt).select("id").single();if(wr)throw wr;it=(ir==null?void 0:ir.id)??null}if(!it)throw new Error("Nao foi possivel identificar a inspecao criada/atualizada.");await je(it,$.checklistIds,Vt),mr.success("Inspecao salva com sucesso"),$e(),Ee()}catch(it){console.error(it),mr.error("Erro ao salvar inspecao")}finally{X(!1)}},qe=rt=>{const Tt=(rt.rel_checklists??[]).map(it=>it.checklist_id),Vt=(rt.rel_checklist_itens??[]).map(it=>it.checklist_item_id);H(rt.id),B({unidade_id:rt.unidade_id,posto_id:rt.posto_id,responsavel:rt.responsavel,dia_inspecao:rt.dia_inspecao?new Date(rt.dia_inspecao).toISOString().slice(0,16):"",checklistIds:Tt,checklistItemIds:ue(Tt,Vt)})},We=async rt=>{if(!confirm("Deseja realmente excluir esta inspecao?"))return;const{error:Tt}=await Qe.from("inspecoes").delete().eq("id",rt);if(Tt){mr.error("Erro ao excluir inspecao");return}mr.success("Inspecao excluida"),Ee()},$e=()=>{B(rF),H(null)},_t=(rt,Tt)=>{B(Vt=>{const it=Tt?Array.from(new Set([...Vt.checklistIds,rt])):Vt.checklistIds.filter(wr=>wr!==rt),ir=ue(it,Vt.checklistItemIds);return{...Vt,checklistIds:it,checklistItemIds:ir}})},mt=(rt,Tt)=>{B(Vt=>{const it=Tt?Array.from(new Set([...Vt.checklistItemIds,rt])):Vt.checklistItemIds.filter(ir=>ir!==rt);return{...Vt,checklistItemIds:it}})};return h.jsx($o,{children:h.jsxs("div",{className:"p-6 space-y-6",children:[h.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-3xl font-bold",children:"Inspecoes"}),h.jsx("p",{className:"text-muted-foreground",children:"Cadastre e acompanhe inspecoes realizadas em campo."})]}),h.jsxs(tr,{variant:"outline",onClick:yt,disabled:K,children:[h.jsx(xb,{className:`h-4 w-4 mr-2 ${K?"animate-spin":""}`}),"Atualizar"]})]}),h.jsxs(kr,{children:[h.jsx(Mn,{children:h.jsx(Zn,{children:Y?"Editar inspecao":"Nova inspecao"})}),h.jsx(tn,{children:h.jsxs("form",{onSubmit:Ye,className:"space-y-4",children:[h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{children:"Unidade *"}),h.jsxs(un,{value:$.unidade_id,onValueChange:rt=>B(Tt=>({...Tt,unidade_id:rt,posto_id:""})),children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Selecione"})}),h.jsxs(an,{children:[i.map(rt=>h.jsx(kt,{value:rt.id,children:rt.nome},rt.id)),i.length===0&&h.jsx(kt,{value:"__placeholder",disabled:!0,children:"Nenhuma unidade cadastrada"})]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{children:"Posto *"}),h.jsxs(un,{value:$.posto_id,onValueChange:rt=>B(Tt=>({...Tt,posto_id:rt})),disabled:!$.unidade_id,children:[h.jsx(on,{children:h.jsx(dn,{placeholder:$.unidade_id?"Selecione":"Escolha uma unidade primeiro"})}),h.jsxs(an,{children:[Me.map(rt=>h.jsx(kt,{value:rt.id,children:rt.nome},rt.id)),Me.length===0&&h.jsx(kt,{value:"__placeholder",disabled:!0,children:"Nenhum posto encontrado"})]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{children:"Responsavel *"}),h.jsxs(un,{value:$.responsavel,onValueChange:rt=>B(Tt=>({...Tt,responsavel:rt})),children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Selecione"})}),h.jsxs(an,{children:[x.map(rt=>h.jsx(kt,{value:rt.id,children:rt.nome},rt.id)),x.length===0&&h.jsx(kt,{value:"__placeholder",disabled:!0,children:"Nenhum responsavel encontrado"})]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{children:"Data da inspecao *"}),h.jsx(_r,{type:"datetime-local",value:$.dia_inspecao,onChange:rt=>B(Tt=>({...Tt,dia_inspecao:rt.target.value}))})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{children:"Checklists vinculados *"}),I.length>0?h.jsx("div",{className:"grid gap-2 md:grid-cols-2",children:I.map(rt=>{const Tt=$.checklistIds.includes(rt.id);return h.jsxs("label",{className:`flex cursor-pointer items-center justify-between rounded-md border p-3 text-sm ${Tt?"border-primary bg-primary/5":"border-muted"}`,children:[h.jsxs("span",{className:"flex flex-col",children:[h.jsx("span",{className:"font-medium",children:rt.nome}),h.jsxs("span",{className:"text-xs text-muted-foreground",children:[rt.periodicidade," dias"]})]}),h.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:Tt,onChange:Vt=>_t(rt.id,Vt.target.checked)})]},rt.id)})}):h.jsx("p",{className:"text-sm text-muted-foreground",children:"Cadastre um checklist antes de criar uma inspecao."})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{children:"Itens de checklist (opcional)"}),$.checklistIds.length===0?h.jsx("p",{className:"text-sm text-muted-foreground",children:"Selecione um checklist para visualizar os itens disponiveis."}):h.jsxs("div",{className:"max-h-48 space-y-1 overflow-y-auto rounded-md border p-3",children:[be.map(rt=>{const Tt=$.checklistItemIds.includes(rt.id);return h.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[h.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:Tt,onChange:Vt=>mt(rt.id,Vt.target.checked)}),h.jsx("span",{children:rt.descricao})]},rt.id)}),be.length===0&&h.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum item cadastrado para os checklists selecionados."})]})]}),h.jsxs("div",{className:"flex gap-2 flex-wrap",children:[h.jsx(tr,{type:"submit",disabled:G||I.length===0,children:G?"Salvando...":Y?"Atualizar inspecao":"Cadastrar inspecao"}),Y&&h.jsx(tr,{type:"button",variant:"secondary",onClick:$e,children:"Cancelar"})]})]})})]}),h.jsxs(kr,{children:[h.jsx(Mn,{children:h.jsx(Zn,{children:"Historico de inspecoes"})}),h.jsx(tn,{children:h.jsxs(Yd,{children:[h.jsx(Jd,{children:h.jsxs(Zs,{children:[h.jsx(xn,{children:"ID"}),h.jsx(xn,{children:"Data"}),h.jsx(xn,{children:"Unidade"}),h.jsx(xn,{children:"Posto"}),h.jsx(xn,{children:"Responsavel"}),h.jsx(xn,{children:"Checklists"}),h.jsx(xn,{children:"Itens selecionados"}),h.jsx(xn,{children:"Acoes"})]})}),h.jsxs(Qd,{children:[e.map(rt=>{var Tt,Vt,it,ir,wr;return h.jsxs(Zs,{children:[h.jsx(cn,{children:rt.id}),h.jsx(cn,{children:rt.dia_inspecao?Hs(new Date(rt.dia_inspecao),"dd/MM/yyyy HH:mm",{locale:Fd}):"-"}),h.jsx(cn,{children:((Tt=rt.unidade)==null?void 0:Tt.nome)??"-"}),h.jsx(cn,{children:((Vt=rt.posto)==null?void 0:Vt.nome)??"-"}),h.jsx(cn,{children:((it=rt.responsavel_profile)==null?void 0:it.full_name)??"-"}),h.jsx(cn,{className:"max-w-xs",children:(ir=rt.rel_checklists)!=null&&ir.length?rt.rel_checklists.map(Bt=>{var Wr;return(Wr=Bt.checklist)==null?void 0:Wr.nome}).filter(Boolean).join(", "):"-"}),h.jsx(cn,{children:(wr=rt.rel_checklist_itens)!=null&&wr.length?`${rt.rel_checklist_itens.length} item(ns)`:"-"}),h.jsx(cn,{children:h.jsxs("div",{className:"flex gap-2",children:[h.jsx(tr,{size:"icon",variant:"ghost",onClick:()=>qe(rt),children:h.jsx(mc,{className:"h-4 w-4"})}),h.jsx(tr,{size:"icon",variant:"ghost",onClick:()=>We(rt.id),children:h.jsx(El,{className:"h-4 w-4"})})]})})]},rt.id)}),!K&&e.length===0&&h.jsx(Zs,{children:h.jsx(cn,{colSpan:8,className:"text-center text-sm text-muted-foreground",children:"Nenhuma inspecao cadastrada"})})]})]})})]})]})})},nF=["diario","semanal","mensal","pontual"],iF=["ativo","inativo"],sF={nome:"",descricao:"",tipo:"diario",unidade_id:"",status:"ativo"},MA="__none__",yce=()=>{const[e,t]=V.useState([]),[i,c]=V.useState([]),[f,_]=V.useState(!1),[x,o]=V.useState(!1),[I,P]=V.useState(sF),[N,U]=V.useState(null),$=V.useCallback(async()=>{_(!0);try{const{data:X,error:ue}=await Qe.from("checklists").select("id, nome, descricao, tipo, unidade_id, status, created_at, updated_at").order("created_at",{ascending:!1});if(ue)throw ue;t(X??[])}catch(X){console.error(X),mr.error("No foi possvel carregar os checklists")}finally{_(!1)}},[]),B=V.useCallback(async()=>{const{data:X,error:ue}=await Qe.from("unidades").select("id, nome").order("nome");if(ue){mr.error("No foi possvel carregar as unidades");return}c(X??[])},[]);V.useEffect(()=>{$(),B()},[$,B]);const Y=V.useMemo(()=>{const X=new Map;return i.forEach(ue=>X.set(ue.id,ue.nome)),X},[i]),H=()=>{P(sF),U(null)},K=async X=>{if(X.preventDefault(),!I.nome.trim()){mr.warning("Informe o nome do checklist");return}o(!0);const ue={nome:I.nome.trim(),descricao:I.descricao.trim()||null,tipo:I.tipo,unidade_id:I.unidade_id||null,status:I.status||"ativo"};try{if(N){const{error:Ee}=await Qe.from("checklists").update(ue).eq("id",N);if(Ee)throw Ee}else{const{error:Ee}=await Qe.from("checklists").insert(ue);if(Ee)throw Ee}mr.success(`Checklist ${N?"atualizado":"criado"} com sucesso`),H(),$()}catch{mr.error("Erro ao salvar checklist")}finally{o(!1)}},re=X=>{U(X.id),P({nome:X.nome,descricao:X.descricao??"",tipo:X.tipo&&nF.includes(X.tipo)?X.tipo:"diario",unidade_id:X.unidade_id??"",status:X.status&&iF.includes(X.status)?X.status:"ativo"})},G=async X=>{if(!confirm("Deseja realmente excluir este checklist?"))return;const{error:ue}=await Qe.from("checklists").delete().eq("id",X);if(ue){mr.error("Erro ao excluir checklist");return}mr.success("Checklist excludo"),$()};return h.jsx($o,{children:h.jsxs("div",{className:"p-6 space-y-6",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-3xl font-bold",children:"Checklists"}),h.jsx("p",{className:"text-muted-foreground",children:"Cadastre e acompanhe os modelos utilizados nas inspees."})]}),h.jsxs(tr,{variant:"outline",onClick:$,disabled:f,children:[h.jsx(xb,{className:`h-4 w-4 mr-2 ${f?"animate-spin":""}`}),"Atualizar"]})]}),h.jsxs(kr,{children:[h.jsx(Mn,{children:h.jsx(Zn,{children:N?"Editar checklist":"Novo checklist"})}),h.jsx(tn,{children:h.jsxs("form",{onSubmit:K,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[N&&h.jsxs("div",{className:"space-y-2 md:col-span-2",children:[h.jsx(Kt,{children:"ID"}),h.jsx(_r,{value:N,disabled:!0})]}),h.jsxs("div",{className:"space-y-2 md:col-span-2",children:[h.jsx(Kt,{htmlFor:"nome",children:"Nome *"}),h.jsx(_r,{id:"nome",value:I.nome,onChange:X=>P(ue=>({...ue,nome:X.target.value})),placeholder:"Ex: Checklist semanal de segurana"})]}),h.jsxs("div",{className:"space-y-2 md:col-span-2",children:[h.jsx(Kt,{htmlFor:"descricao",children:"Descrio"}),h.jsx(Tl,{id:"descricao",value:I.descricao,onChange:X=>P(ue=>({...ue,descricao:X.target.value})),placeholder:"Detalhe o objetivo do checklist"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{children:"Tipo *"}),h.jsxs(un,{value:I.tipo,onValueChange:X=>P(ue=>({...ue,tipo:X})),children:[h.jsx(on,{children:h.jsx(dn,{})}),h.jsx(an,{children:nF.map(X=>h.jsx(kt,{value:X,children:X},X))})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{children:"Unidade"}),h.jsxs(un,{value:I.unidade_id||MA,onValueChange:X=>P(ue=>({...ue,unidade_id:X===MA?"":X})),children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Opcional"})}),h.jsxs(an,{children:[h.jsx(kt,{value:MA,children:"Sem unidade"}),i.map(X=>h.jsx(kt,{value:X.id,children:X.nome},X.id))]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{children:"Status"}),h.jsxs(un,{value:I.status,onValueChange:X=>P(ue=>({...ue,status:X})),children:[h.jsx(on,{children:h.jsx(dn,{})}),h.jsx(an,{children:iF.map(X=>h.jsx(kt,{value:X,children:X},X))})]})]}),h.jsxs("div",{className:"flex gap-2 md:col-span-2",children:[h.jsx(tr,{type:"submit",disabled:x,children:x?h.jsxs(h.Fragment,{children:[h.jsx(KT,{className:"h-4 w-4 mr-2 animate-spin"}),"Salvando"]}):h.jsxs(h.Fragment,{children:[h.jsx(oa,{className:"h-4 w-4 mr-2"}),N?"Atualizar":"Cadastrar"]})}),N&&h.jsxs(tr,{type:"button",variant:"secondary",onClick:H,children:[h.jsx(Vm,{className:"h-4 w-4 mr-2"}),"Cancelar"]})]})]})})]}),h.jsxs(kr,{children:[h.jsx(Mn,{children:h.jsx(Zn,{children:"Checklists cadastrados"})}),h.jsx(tn,{children:h.jsxs(Yd,{children:[h.jsx(Jd,{children:h.jsxs(Zs,{children:[h.jsx(xn,{children:"Nome"}),h.jsx(xn,{children:"Tipo"}),h.jsx(xn,{children:"Unidade"}),h.jsx(xn,{children:"Unidade"}),h.jsx(xn,{children:"Criado em"}),h.jsx(xn,{children:"Atualizado em"}),h.jsx(xn,{children:"Aes"})]})}),h.jsxs(Qd,{children:[e.map(X=>h.jsxs(Zs,{children:[h.jsx(cn,{children:X.nome}),h.jsx(cn,{children:X.tipo||"-"}),h.jsx(cn,{children:(X.unidade_id&&Y.get(X.unidade_id))??"-"}),h.jsx(cn,{children:h.jsx(ai,{variant:X.status==="ativo"?"default":"secondary",children:X.status})}),h.jsx(cn,{children:X.created_at?new Date(X.created_at).toLocaleString("pt-BR"):"-"}),h.jsx(cn,{children:X.updated_at?new Date(X.updated_at).toLocaleString("pt-BR"):"-"}),h.jsx(cn,{children:h.jsxs("div",{className:"flex gap-2",children:[h.jsx(tr,{size:"icon",variant:"ghost",onClick:()=>re(X),children:h.jsx(mc,{className:"h-4 w-4"})}),h.jsx(tr,{size:"icon",variant:"ghost",onClick:()=>G(X.id),children:h.jsx(El,{className:"h-4 w-4"})})]})})]},X.id)),!f&&e.length===0&&h.jsx(Zs,{children:h.jsx(cn,{colSpan:9,className:"text-center text-sm text-muted-foreground",children:"Nenhum checklist cadastrado"})})]})]})})]})]})})},vce=["sim_nao","texto","numero","foto"],oF={checklist_id:"",descricao:"",tipo_resposta:"sim_nao",obrigatorio:"true"},xce=()=>{const[e,t]=V.useState([]),[i,c]=V.useState([]),[f,_]=V.useState(oF),[x,o]=V.useState(null),[I,P]=V.useState(""),[N,U]=V.useState(!1),[$,B]=V.useState(!1);V.useEffect(()=>{Y()},[]);const Y=async()=>{U(!0);try{await Promise.all([H(),K()])}finally{U(!1)}},H=async()=>{const{data:xe,error:Ne}=await Qe.from("checklist_itens").select(`
        id,
        checklist_id,
        ordem,
        descricao,
        tipo_resposta,
        obrigatorio,
        created_at,
        checklist:checklists ( nome )
      `).order("checklist_id",{ascending:!0}).order("ordem",{ascending:!0});if(Ne){mr.error("Erro ao carregar itens");return}t(xe??[])},K=async()=>{const{data:xe,error:Ne}=await Qe.from("checklists").select("id, nome").order("nome");if(Ne){mr.error("Erro ao carregar checklists");return}c(xe??[])},re=V.useMemo(()=>{const xe=I.toLowerCase();return e.filter(Ne=>{var lt,Pt;return Ne.descricao.toLowerCase().includes(xe)||((Pt=(lt=Ne.checklist)==null?void 0:lt.nome)==null?void 0:Pt.toLowerCase().includes(xe))||`${Ne.ordem}`.includes(xe)})},[e,I]),G=()=>{_(oF),o(null)},X=async xe=>{if(xe.preventDefault(),!f.checklist_id||!f.descricao.trim()){mr.warning("Preencha checklist e descrio");return}B(!0);const Ne=async()=>{let Me=0;for(;Me<50;){Me++;const be=Math.floor(Math.random()*999999)+1,{count:je,error:Ye}=await Qe.from("checklist_itens").select("id",{count:"exact",head:!0}).eq("ordem",be);if(Ye)throw Ye;if(!je||je===0)return be}throw new Error("No foi possvel gerar uma ordem nica. Tente novamente.")};let lt=0;try{lt=await Ne()}catch(tt){mr.error(tt.message||"Erro ao gerar ordem aleatria"),B(!1);return}const Pt={checklist_id:f.checklist_id,ordem:lt,descricao:f.descricao.trim(),tipo_resposta:f.tipo_resposta,obrigatorio:f.obrigatorio==="true"};try{if(x){const{error:tt}=await Qe.from("checklist_itens").update(Pt).eq("id",x);if(tt)throw tt}else{const{error:tt}=await Qe.from("checklist_itens").insert(Pt);if(tt)throw tt}mr.success(`Item ${x?"atualizado":"criado"} com sucesso!`),G(),H()}catch(tt){mr.error(tt.message||"Erro ao salvar item")}finally{B(!1)}},ue=xe=>{var Ne;o(xe.id),_({checklist_id:((Ne=xe.checklist_id)==null?void 0:Ne.toString())??"",descricao:xe.descricao??"",tipo_resposta:xe.tipo_resposta??"sim_nao",obrigatorio:xe.obrigatorio?"true":"false"})},Ee=async xe=>{if(!confirm("Deseja realmente excluir este item?"))return;const{error:Ne}=await Qe.from("checklist_itens").delete().eq("id",xe);if(Ne){mr.error("Erro ao excluir item");return}mr.success("Item excludo"),H()};return h.jsx($o,{children:h.jsxs("div",{className:"p-6 space-y-6",children:[h.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-3xl font-bold",children:"Itens de Checklist"}),h.jsx("p",{className:"text-muted-foreground",children:"Gerencie os itens vinculados a cada checklist."})]}),h.jsxs(tr,{variant:"outline",onClick:Y,disabled:N,children:[h.jsx(xb,{className:`h-4 w-4 mr-2 ${N?"animate-spin":""}`}),"Atualizar"]})]}),h.jsxs(kr,{children:[h.jsx(Mn,{children:h.jsx(Zn,{children:x?"Editar item":"Novo item"})}),h.jsx(tn,{children:h.jsxs("form",{onSubmit:X,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[x&&h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{children:"ID (somente leitura)"}),h.jsx(_r,{value:x,disabled:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{children:"Checklist *"}),h.jsxs(un,{value:f.checklist_id,onValueChange:xe=>_(Ne=>({...Ne,checklist_id:xe})),children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Selecione"})}),h.jsxs(an,{children:[i.map(xe=>h.jsx(kt,{value:xe.id,children:xe.nome},xe.id)),i.length===0&&h.jsx(kt,{value:"__placeholder",disabled:!0,children:"Cadastre um checklist primeiro"})]})]})]}),h.jsxs("div",{className:"space-y-2 md:col-span-2",children:[h.jsx(Kt,{children:"Descrio *"}),h.jsx(Tl,{value:f.descricao,onChange:xe=>_(Ne=>({...Ne,descricao:xe.target.value})),placeholder:"Descreva o item do checklist"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{children:"Tipo de resposta *"}),h.jsxs(un,{value:f.tipo_resposta,onValueChange:xe=>_(Ne=>({...Ne,tipo_resposta:xe})),children:[h.jsx(on,{children:h.jsx(dn,{})}),h.jsx(an,{children:vce.map(xe=>h.jsx(kt,{value:xe,children:xe.replace("_"," ")},xe))})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{children:"Obrigatrio *"}),h.jsxs(un,{value:f.obrigatorio,onValueChange:xe=>_(Ne=>({...Ne,obrigatorio:xe})),children:[h.jsx(on,{children:h.jsx(dn,{})}),h.jsxs(an,{children:[h.jsx(kt,{value:"true",children:"Sim"}),h.jsx(kt,{value:"false",children:"No"})]})]})]}),h.jsxs("div",{className:"flex gap-2 md:col-span-2",children:[h.jsx(tr,{type:"submit",disabled:$,children:$?h.jsxs(h.Fragment,{children:[h.jsx(KT,{className:"h-4 w-4 mr-2 animate-spin"}),"Salvando"]}):h.jsxs(h.Fragment,{children:[h.jsx(oa,{className:"h-4 w-4 mr-2"}),x?"Atualizar":"Cadastrar"]})}),x&&h.jsxs(tr,{type:"button",variant:"secondary",onClick:G,children:[h.jsx(Vm,{className:"h-4 w-4 mr-2"}),"Cancelar"]})]})]})})]}),h.jsxs(kr,{children:[h.jsx(Mn,{children:h.jsxs("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[h.jsx(Zn,{children:"Itens cadastrados"}),h.jsx(_r,{placeholder:"Buscar por checklist, ordem ou descrio",value:I,onChange:xe=>P(xe.target.value),className:"max-w-xs"})]})}),h.jsx(tn,{children:h.jsxs(Yd,{children:[h.jsx(Jd,{children:h.jsxs(Zs,{children:[h.jsx(xn,{children:"Checklist"}),h.jsx(xn,{children:"Descrio"}),h.jsx(xn,{children:"Criado em"}),h.jsx(xn,{children:"Aes"})]})}),h.jsxs(Qd,{children:[re.map(xe=>{var Ne;return h.jsxs(Zs,{children:[h.jsx(cn,{children:((Ne=xe.checklist)==null?void 0:Ne.nome)??"-"}),h.jsx(cn,{className:"max-w-lg text-sm text-muted-foreground",children:xe.descricao}),h.jsx(cn,{children:xe.created_at?new Date(xe.created_at).toLocaleString("pt-BR"):"-"}),h.jsx(cn,{children:h.jsxs("div",{className:"flex gap-2",children:[h.jsx(tr,{size:"icon",variant:"ghost",onClick:()=>ue(xe),children:h.jsx(mc,{className:"h-4 w-4"})}),h.jsx(tr,{size:"icon",variant:"ghost",onClick:()=>Ee(xe.id),children:h.jsx(El,{className:"h-4 w-4"})})]})})]},xe.id)}),!N&&re.length===0&&h.jsx(Zs,{children:h.jsx(cn,{colSpan:8,className:"text-center text-sm text-muted-foreground",children:"Nenhum item cadastrado"})})]})]})})]})]})})},aF={checklist_id:"",colaborador_id:"",data_execucao:"",status:"em_andamento",observacoes:""},lF=["em_andamento","concluido"],bce=()=>{const[e,t]=V.useState([]),[i,c]=V.useState([]),[f,_]=V.useState([]),[x,o]=V.useState(aF),[I,P]=V.useState(null),[N,U]=V.useState(""),[$,B]=V.useState("all"),[Y,H]=V.useState("all"),[K,re]=V.useState(!1),[G,X]=V.useState(!1),[ue,Ee]=V.useState(null),[xe,Ne]=V.useState(Hs(new Date,"yyyy-MM")),[lt,Pt]=V.useState({});V.useEffect(()=>{tt()},[]);const tt=async()=>{re(!0);try{await Promise.all([yt(),Me(),be(),je()])}finally{re(!1)}},yt=async()=>{const{data:it,error:ir}=await Qe.from("checklist_execucoes").select("id, checklist_id, colaborador_id, data_execucao, status, observacoes, created_at").order("data_execucao",{ascending:!1});if(ir){mr.error("Erro ao carregar execues");return}t(it??[])},Me=async()=>{const{data:it,error:ir}=await Qe.from("checklists").select("id, nome").order("nome");if(ir){mr.error("Erro ao carregar checklists");return}c(it??[])},be=async()=>{const{data:it,error:ir}=await Qe.from("colaboradores").select("id, nome_completo").order("nome_completo");if(ir){mr.error("Erro ao carregar colaboradores");return}_(it??[])},je=async()=>{const{data:it,error:ir}=await Qe.from("checklist_respostas").select("execucao_id, created_at").order("created_at",{ascending:!0});if(ir){console.error("Erro ao carregar conclusoes de execucoes:",ir);return}const wr={};it==null||it.forEach(Bt=>{Bt.execucao_id&&!wr[Bt.execucao_id]&&(wr[Bt.execucao_id]=Bt.created_at??"")}),Pt(wr)},Ye=V.useMemo(()=>{const it=new Map;return i.forEach(ir=>it.set(ir.id,ir.nome)),it},[i]),qe=V.useMemo(()=>{const it=new Map;return f.forEach(ir=>ir.id&&it.set(ir.id,ir.nome_completo??"")),it},[f]),We=V.useMemo(()=>{const it=new Set;return e.forEach(ir=>{ir.data_execucao&&it.add(Hs(new Date(ir.data_execucao),"yyyy-MM"))}),Array.from(it).sort().reverse()},[e]);V.useEffect(()=>{We.length>0&&!We.includes(xe)&&Ne(We[0])},[We,xe]);const $e=V.useMemo(()=>xe?e.filter(it=>it.status==="concluido"&&it.data_execucao&&Hs(new Date(it.data_execucao),"yyyy-MM")===xe).length:0,[e,xe]),_t=V.useMemo(()=>{const it=N.toLowerCase();return e.filter(ir=>{var Ur,jn;const wr=Ye.get(Number(ir.checklist_id))??"",Bt=ir.colaborador_id?qe.get(ir.colaborador_id)??"":"",Wr=wr.toLowerCase().includes(it)||Bt.toLowerCase().includes(it)||`${ir.checklist_id}`.includes(it)||((Ur=ir.colaborador_id)==null?void 0:Ur.toLowerCase().includes(it))||((jn=ir.status)==null?void 0:jn.toLowerCase().includes(it)),Er=$==="all"||ir.colaborador_id===$,Vr=Y==="all"||ir.status===Y;return Wr&&Er&&Vr})},[e,N,$,Y,Ye,qe]),mt=()=>{o(aF),P(null)},rt=async it=>{if(it.preventDefault(),!x.checklist_id||!x.colaborador_id||!x.data_execucao){mr.warning("Preencha checklist, colaborador e data de execuo");return}X(!0);const ir={checklist_id:Number(x.checklist_id),colaborador_id:x.colaborador_id,data_execucao:new Date(x.data_execucao).toISOString(),status:x.status,observacoes:x.observacoes.trim()||null};try{if(I){const{error:wr}=await Qe.from("checklist_execucoes").update(ir).eq("id",I);if(wr)throw wr}else{const{error:wr}=await Qe.from("checklist_execucoes").insert(ir);if(wr)throw wr}mr.success(`Execuo ${I?"atualizada":"criada"} com sucesso!`),mt(),yt()}catch(wr){console.error(wr),mr.error("Erro ao salvar execuo")}finally{X(!1)}},Tt=it=>{P(it.id),o({checklist_id:String(it.checklist_id??""),colaborador_id:it.colaborador_id??"",data_execucao:it.data_execucao?new Date(it.data_execucao).toISOString().slice(0,16):"",status:it.status??"em_andamento",observacoes:it.observacoes??""})},Vt=async it=>{if(!confirm("Deseja realmente excluir esta execuo?"))return;const{error:ir}=await Qe.from("checklist_execucoes").delete().eq("id",it);if(ir){mr.error("Erro ao excluir execuo");return}mr.success("Execuo excluda"),Ee(wr=>wr===it?null:wr),await Promise.all([yt(),je()])};return h.jsx($o,{children:h.jsxs("div",{className:"p-6 space-y-6",children:[h.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"text-3xl font-bold",children:"Execues de Checklist"}),h.jsx("p",{className:"text-muted-foreground",children:"Registre as execues realizadas em campo."})]}),h.jsxs(tr,{variant:"outline",onClick:tt,disabled:K,children:[h.jsx(xb,{className:`h-4 w-4 mr-2 ${K?"animate-spin":""}`}),"Atualizar"]})]}),h.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:h.jsxs(kr,{children:[h.jsx(Mn,{className:"flex flex-col gap-2",children:h.jsxs("div",{className:"flex items-center justify-between gap-2",children:[h.jsx(Zn,{children:"Execues concludas"}),h.jsxs(un,{value:xe,onValueChange:Ne,disabled:We.length===0,children:[h.jsx(on,{className:"w-[180px]",children:h.jsx(dn,{placeholder:"Selecione o ms"})}),h.jsx(an,{children:We.map(it=>{const[ir,wr]=it.split("-"),Bt=new Date(Number(ir),Number(wr)-1,1).toLocaleDateString("pt-BR",{month:"long",year:"numeric"});return h.jsx(kt,{value:it,children:Bt},it)})})]})]})}),h.jsxs(tn,{children:[h.jsx("p",{className:"text-4xl font-bold",children:$e}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Execues marcadas como concludas no ms selecionado"})]})]})}),h.jsxs(kr,{children:[h.jsx(Mn,{children:h.jsx(Zn,{children:I?"Editar execuo":"Nova execuo"})}),h.jsx(tn,{children:h.jsxs("form",{onSubmit:rt,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{children:"Checklist *"}),h.jsxs(un,{value:x.checklist_id,onValueChange:it=>o(ir=>({...ir,checklist_id:it})),children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Selecione"})}),h.jsxs(an,{children:[i.map(it=>h.jsx(kt,{value:String(it.id),children:it.nome},it.id)),i.length===0&&h.jsx(kt,{value:"__placeholder",disabled:!0,children:"Cadastre um checklist primeiro"})]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{children:"Colaborador *"}),h.jsxs(un,{value:x.colaborador_id,onValueChange:it=>o(ir=>({...ir,colaborador_id:it})),children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Selecione"})}),h.jsxs(an,{children:[f.map(it=>h.jsx(kt,{value:it.id,children:it.nome_completo},it.id)),f.length===0&&h.jsx(kt,{value:"__placeholder",disabled:!0,children:"Nenhum colaborador cadastrado"})]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{children:"Data da execuo *"}),h.jsx(_r,{type:"datetime-local",value:x.data_execucao,onChange:it=>o(ir=>({...ir,data_execucao:it.target.value}))})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{children:"Status *"}),h.jsxs(un,{value:x.status,onValueChange:it=>o(ir=>({...ir,status:it})),children:[h.jsx(on,{children:h.jsx(dn,{})}),h.jsx(an,{children:lF.map(it=>h.jsx(kt,{value:it,children:it.replace("_"," ")},it))})]})]}),h.jsxs("div",{className:"space-y-2 md:col-span-2",children:[h.jsx(Kt,{children:"Observaes"}),h.jsx(Tl,{value:x.observacoes,onChange:it=>o(ir=>({...ir,observacoes:it.target.value})),placeholder:"Anote observaes relevantes"})]}),h.jsxs("div",{className:"flex gap-2 md:col-span-2",children:[h.jsx(tr,{type:"submit",disabled:G,children:G?h.jsxs(h.Fragment,{children:[h.jsx(KT,{className:"h-4 w-4 mr-2 animate-spin"}),"Salvando"]}):h.jsxs(h.Fragment,{children:[h.jsx(oa,{className:"h-4 w-4 mr-2"}),I?"Atualizar":"Cadastrar"]})}),I&&h.jsxs(tr,{type:"button",variant:"secondary",onClick:mt,children:[h.jsx(Vm,{className:"h-4 w-4 mr-2"}),"Cancelar"]})]})]})})]}),h.jsxs(kr,{children:[h.jsx(Mn,{children:h.jsxs("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[h.jsx(Zn,{children:"Execues cadastradas"}),h.jsx(_r,{placeholder:"Buscar por checklist, colaborador ou status",value:N,onChange:it=>U(it.target.value),className:"max-w-xs"})]})}),h.jsxs(tn,{children:[h.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between mb-4",children:[h.jsxs(un,{value:$,onValueChange:B,children:[h.jsx(on,{className:"w-full md:w-[240px]",children:h.jsx(dn,{placeholder:"Colaborador"})}),h.jsxs(an,{children:[h.jsx(kt,{value:"all",children:"Todos os colaboradores"}),f.map(it=>h.jsx(kt,{value:it.id??"",children:it.nome_completo},it.id))]})]}),h.jsxs(un,{value:Y,onValueChange:H,children:[h.jsx(on,{className:"w-full md:w-[200px]",children:h.jsx(dn,{placeholder:"Status"})}),h.jsxs(an,{children:[h.jsx(kt,{value:"all",children:"Todos os status"}),lF.map(it=>h.jsx(kt,{value:it,children:it.replace("_"," ")},it))]})]})]}),h.jsxs("div",{className:"space-y-4",children:[_t.map(it=>{var Wr;const ir=ue===it.id,wr=Ye.get(Number(it.checklist_id))??it.checklist_id,Bt=it.colaborador_id?qe.get(it.colaborador_id)??it.colaborador_id:"-";return h.jsxs("div",{className:"rounded-lg border p-4 transition hover:shadow-sm cursor-pointer",onClick:()=>Ee(Er=>Er===it.id?null:it.id),children:[h.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[h.jsxs("div",{children:[h.jsx("p",{className:"font-semibold",children:wr}),h.jsxs("p",{className:"text-sm text-muted-foreground",children:["Colaborador: ",Bt]})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(ai,{variant:"outline",className:"capitalize",children:it.status?it.status.replace("_"," "):"sem status"}),h.jsxs("div",{className:"flex gap-1",children:[h.jsx(tr,{size:"icon",variant:"ghost",onClick:Er=>{Er.stopPropagation(),Tt(it)},children:h.jsx(mc,{className:"h-4 w-4"})}),h.jsx(tr,{size:"icon",variant:"ghost",onClick:Er=>{Er.stopPropagation(),Vt(it.id)},children:h.jsx(El,{className:"h-4 w-4"})})]})]})]}),h.jsxs("div",{className:"mt-3 text-sm text-muted-foreground",children:["Execuo:"," ",it.data_execucao?new Date(it.data_execucao).toLocaleString("pt-BR"):"-"]}),ir&&h.jsxs("div",{className:"mt-4 space-y-2 text-sm text-muted-foreground",children:[h.jsx("div",{className:"font-medium text-foreground",children:"Detalhes da execuo"}),h.jsxs("div",{children:["ID da execuo: ",it.id]}),lt[it.id]&&h.jsxs("div",{children:["Concluido em:"," ",new Date(lt[it.id]).toLocaleString("pt-BR")]}),h.jsxs("div",{children:["Observaes:"," ",((Wr=it.observacoes)==null?void 0:Wr.trim())||"Sem observaes"]})]})]},it.id)}),!K&&_t.length===0&&h.jsx("div",{className:"text-center text-sm text-muted-foreground py-6",children:"Nenhuma execuo encontrada"})]})]})]})]})})},cF={execucao_id:"",item_id:"",resposta:"",conforme:"null",foto_url:"",observacao:"",created_at:""},wce=()=>{var lt,Pt,tt,yt,Me,be;const[e,t]=V.useState([]),[i,c]=V.useState([]),[f,_]=V.useState([]),[x,o]=V.useState(cF),[I,P]=V.useState(null),[N,U]=V.useState(""),[$,B]=V.useState(!1),[Y,H]=V.useState(!1),[K,re]=V.useState(null);V.useEffect(()=>{G()},[]);const G=async()=>{B(!0);try{await Promise.all([X(),ue(),Ee()])}finally{B(!1)}},X=async()=>{const{data:je,error:Ye}=await Qe.from("checklist_respostas").select(`
        id,
        execucao_id,
        item_id,
        resposta,
        conforme,
        foto_url,
        observacao,
        created_at,
        execucao:checklist_execucoes (
          id,
          data_execucao,
          status,
          checklist:checklists ( nome ),
          colaborador:colaboradores ( id, nome_completo )
        ),
        item:checklist_itens ( descricao )
      `).order("created_at",{ascending:!1});if(Ye){mr.error("Erro ao carregar respostas");return}t(je??[])},ue=async()=>{const{data:je,error:Ye}=await Qe.from("checklist_execucoes").select(`
        id,
        checklist_id,
        data_execucao,
        status,
        checklist:checklists ( nome ),
        colaborador:colaboradores ( id, nome_completo )
      `).order("data_execucao",{ascending:!1});if(Ye){mr.error("Erro ao carregar execues");return}c(je??[])},Ee=async()=>{const{data:je,error:Ye}=await Qe.from("checklist_itens").select("id, descricao, checklist_id").order("descricao");if(Ye){mr.error("Erro ao carregar itens");return}_(je??[])};V.useMemo(()=>{const je=N.toLowerCase();return e.filter(Ye=>{var qe,We,$e,_t,mt,rt,Tt,Vt,it;return((We=(qe=Ye.item)==null?void 0:qe.descricao)==null?void 0:We.toLowerCase().includes(je))||((mt=(_t=($e=Ye.execucao)==null?void 0:$e.checklist)==null?void 0:_t.nome)==null?void 0:mt.toLowerCase().includes(je))||((Vt=(Tt=(rt=Ye.execucao)==null?void 0:rt.colaborador)==null?void 0:Tt.nome_completo)==null?void 0:Vt.toLowerCase().includes(je))||((it=Ye.resposta)==null?void 0:it.toLowerCase().includes(je))})},[e,N]);const xe=()=>{o(cF),P(null)},Ne=async je=>{if(je.preventDefault(),!x.execucao_id){mr.warning("Selecione uma execuo");return}const Ye=i.find(We=>We.id===x.execucao_id);if((Ye==null?void 0:Ye.status)==="concluido"){mr.warning("Esta execuo j est concluda. Edite a execuo e altere o status para registrar novas respostas.");return}H(!0);const qe={execucao_id:x.execucao_id,item_id:x.item_id||null,resposta:x.resposta.trim()||null,conforme:x.conforme==="null"?null:x.conforme==="true",foto_url:x.foto_url.trim()||null,observacao:x.observacao.trim()||null,created_at:x.created_at?new Date(x.created_at).toISOString():void 0};try{if(I){const{error:We}=await Qe.from("checklist_respostas").update(qe).eq("id",I);if(We)throw We}else{const{error:We}=await Qe.from("checklist_respostas").insert(qe);if(We)throw We}mr.success(`Resposta ${I?"atualizada":"registrada"} com sucesso!`),xe(),X()}catch(We){console.error(We),mr.error("Erro ao salvar resposta")}finally{H(!1)}};return h.jsxs($o,{children:[h.jsxs("div",{className:"p-6 space-y-6",children:[h.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[h.jsx("div",{children:h.jsx("h1",{className:"text-3xl font-bold",children:"Responder Checklist"})}),h.jsxs(tr,{variant:"outline",onClick:G,disabled:$,children:[h.jsx(xb,{className:`h-4 w-4 mr-2 ${$?"animate-spin":""}`}),"Atualizar"]})]}),h.jsxs(kr,{children:[h.jsx(Mn,{children:h.jsx(Zn,{children:I?"Editar resposta":"Registrar resposta"})}),h.jsx(tn,{children:h.jsxs("form",{onSubmit:Ne,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[I&&h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{children:"ID (somente leitura)"}),h.jsx(_r,{value:I,disabled:!0})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{children:"Execuo *"}),h.jsxs(un,{value:x.execucao_id,onValueChange:je=>o(Ye=>({...Ye,execucao_id:je})),children:[h.jsx(on,{children:h.jsx(dn,{placeholder:"Selecione"})}),h.jsxs(an,{children:[i.map(je=>{var Ye,qe;return h.jsxs(kt,{value:je.id,children:[((Ye=je.checklist)==null?void 0:Ye.nome)??je.id," -"," ",je.data_execucao?new Date(je.data_execucao).toLocaleString("pt-BR"):"Sem data"," ","-"," ",((qe=je.colaborador)==null?void 0:qe.nome_completo)??"Sem responsvel"," ","- Status:"," ",je.status?je.status.replace("_"," "):"sem status"]},je.id)}),i.length===0&&h.jsx(kt,{value:"__placeholder",disabled:!0,children:"Cadastre uma execuo primeiro"})]})]}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"No  possvel registrar respostas em execues concludas. Edite a execuo e altere o status para responder novamente."})]}),h.jsxs("div",{className:"space-y-2 md:col-span-2",children:[h.jsx(Kt,{children:"Resposta"}),h.jsx(Tl,{value:x.resposta,onChange:je=>o(Ye=>({...Ye,resposta:je.target.value})),placeholder:"Contedo da resposta"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{children:"Conforme?"}),h.jsxs(un,{value:x.conforme,onValueChange:je=>o(Ye=>({...Ye,conforme:je})),children:[h.jsx(on,{children:h.jsx(dn,{})}),h.jsxs(an,{children:[h.jsx(kt,{value:"null",children:"No informado"}),h.jsx(kt,{value:"true",children:"Sim"}),h.jsx(kt,{value:"false",children:"No"})]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Kt,{children:"Data de criao"}),h.jsx(_r,{type:"datetime-local",value:x.created_at,onChange:je=>o(Ye=>({...Ye,created_at:je.target.value})),placeholder:"Opcional"})]}),h.jsxs("div",{className:"space-y-2 md:col-span-2",children:[h.jsx(Kt,{children:"Observao"}),h.jsx(Tl,{value:x.observacao,onChange:je=>o(Ye=>({...Ye,observacao:je.target.value})),placeholder:"Observaes adicionais"})]}),h.jsxs("div",{className:"flex gap-2 md:col-span-2",children:[h.jsx(tr,{type:"submit",disabled:Y,children:Y?h.jsxs(h.Fragment,{children:[h.jsx(KT,{className:"h-4 w-4 mr-2 animate-spin"}),"Salvando"]}):h.jsxs(h.Fragment,{children:[h.jsx(oa,{className:"h-4 w-4 mr-2"}),I?"Atualizar":"Cadastrar"]})}),I&&h.jsxs(tr,{type:"button",variant:"secondary",onClick:xe,children:[h.jsx(Vm,{className:"h-4 w-4 mr-2"}),"Cancelar"]})]})]})})]})]}),h.jsx(fo,{open:!!K,onOpenChange:()=>re(null),children:h.jsxs(Js,{className:"max-w-2xl",children:[h.jsx(Qs,{children:h.jsx(eo,{children:"Detalhes da resposta"})}),K&&h.jsxs("div",{className:"space-y-3 text-sm text-muted-foreground",children:[h.jsxs("div",{children:[h.jsx("span",{className:"font-medium text-foreground",children:"ID:"})," ",K.id]}),h.jsxs("div",{children:[h.jsx("span",{className:"font-medium text-foreground",children:"Checklist:"})," ",((Pt=(lt=K.execucao)==null?void 0:lt.checklist)==null?void 0:Pt.nome)??"No informado"]}),h.jsxs("div",{children:[h.jsx("span",{className:"font-medium text-foreground",children:"Execuo:"})," ",(tt=K.execucao)==null?void 0:tt.id]}),h.jsxs("div",{children:[h.jsx("span",{className:"font-medium text-foreground",children:"Responsvel:"})," ",((Me=(yt=K.execucao)==null?void 0:yt.colaborador)==null?void 0:Me.nome_completo)??"No informado"]}),h.jsxs("div",{children:[h.jsx("span",{className:"font-medium text-foreground",children:"Item:"})," ",((be=K.item)==null?void 0:be.descricao)??"Sem item vinculado"]}),h.jsxs("div",{children:[h.jsx("span",{className:"font-medium text-foreground",children:"Resposta:"})," ",K.resposta||"Sem resposta"]}),h.jsxs("div",{children:[h.jsx("span",{className:"font-medium text-foreground",children:"Conforme:"})," ",K.conforme===null?"No informado":K.conforme?"Conforme":"No conforme"]}),h.jsxs("div",{children:[h.jsx("span",{className:"font-medium text-foreground",children:"Observao:"})," ",K.observacao||"Sem observaes"]}),h.jsxs("div",{children:[h.jsx("span",{className:"font-medium text-foreground",children:"Registrada em:"})," ",K.created_at?new Date(K.created_at).toLocaleString("pt-BR"):"-"]})]})]})})]})},Sce=()=>{const e=Gf();return V.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),h.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-100",children:h.jsxs("div",{className:"text-center",children:[h.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),h.jsx("p",{className:"mb-4 text-xl text-gray-600",children:"Oops! Page not found"}),h.jsx("a",{href:"/",className:"text-blue-500 underline hover:text-blue-700",children:"Return to Home"})]})})},Tce=new EY,Ece=()=>h.jsx(kY,{client:Tce,children:h.jsxs(o5,{children:[h.jsx($Z,{}),h.jsx(bX,{}),h.jsx(zJ,{children:h.jsxs(kJ,{children:[h.jsx(lo,{path:"/",element:h.jsx(hte,{})}),h.jsx(lo,{path:"/auth",element:h.jsx(Yre,{})}),h.jsx(lo,{path:"/reset-password",element:h.jsx(mie,{})}),h.jsx(lo,{path:"/dashboard",element:h.jsx(na,{children:h.jsx(Pne,{})})}),h.jsx(lo,{path:"/dashboard-24h",element:h.jsx(na,{children:h.jsx(Dne,{})})}),h.jsx(lo,{path:"/users",element:h.jsx(na,{children:h.jsx(fie,{})})}),h.jsx(lo,{path:"/contratos",element:h.jsx(na,{children:h.jsx(Wle,{})})}),h.jsx(lo,{path:"/mesa-operacoes",element:h.jsx(na,{children:h.jsx(Zle,{})})}),h.jsx(lo,{path:"/chamados",element:h.jsx(na,{children:h.jsx(joe,{})})}),h.jsx(lo,{path:"/ordens-servico",element:h.jsx(na,{children:h.jsx(ece,{})})}),h.jsx(lo,{path:"/colaboradores",element:h.jsx(na,{children:h.jsx(ace,{})})}),h.jsx(lo,{path:"/escalas",element:h.jsx(na,{children:h.jsx(cce,{})})}),h.jsx(lo,{path:"/ativos",element:h.jsx(na,{children:h.jsx(dce,{})})}),h.jsx(lo,{path:"/estoque",element:h.jsx(na,{children:h.jsx(fce,{})})}),h.jsx(lo,{path:"/diaristas",element:h.jsx(na,{children:h.jsx(mce,{})})}),h.jsx(lo,{path:"/inspecao",element:h.jsx(na,{children:h.jsx(_ce,{})})}),h.jsx(lo,{path:"/checklists",element:h.jsx(na,{children:h.jsx(yce,{})})}),h.jsx(lo,{path:"/checklist-itens",element:h.jsx(na,{children:h.jsx(xce,{})})}),h.jsx(lo,{path:"/checklist-execucoes",element:h.jsx(na,{children:h.jsx(bce,{})})}),h.jsx(lo,{path:"/checklist-respostas",element:h.jsx(na,{children:h.jsx(wce,{})})}),h.jsx(lo,{path:"*",element:h.jsx(Sce,{})})]})})]})});DB(document.getElementById("root")).render(h.jsx(Ece,{}));
